{"version":3,"file":"static/js/557.9acd8978.chunk.js","mappings":"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","sources":["Admin/Pages/AdminLogin.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\nimport { useNavigate } from 'react-router-dom';\nimport { API_BASE_URL } from '../../config/api.config';\nimport '../style/AdminLogin.css';\n\n// MSG91 Widget Configuration\n// These should match backend config\nconst MSG91_WIDGET_ID = '356c786a314c303532313736';\nconst MSG91_AUTH_TOKEN = '481618TheXzNLL2u694bc65aP1';\n\n// HARDCODED ADMIN MOBILE NUMBER - Only this number can login\nconst ADMIN_MOBILE_NUMBER = '+917888076881';\n\nconst AdminLogin = () => {\n  const navigate = useNavigate();\n  const [step, setStep] = useState('mobile'); // 'mobile', 'otp'\n  const [mobile, setMobile] = useState('');\n  const [validatedMobile, setValidatedMobile] = useState(null); // Store validated mobile (internal use only)\n  const [maskedMobile, setMaskedMobile] = useState(''); // Masked version to display\n  const [validationToken, setValidationToken] = useState(null);\n  const [error, setError] = useState('');\n  const [loading, setLoading] = useState(false);\n  const [mobileLocked, setMobileLocked] = useState(false);\n  const widgetInitializedRef = useRef(false); // Track if widget was already initialized\n\n  // Helper function to load MSG91 script dynamically if not already loaded\n  const loadMSG91Script = () => {\n    return new Promise((resolve, reject) => {\n      // Check if script is already loaded\n      if (window.initSendOTP && typeof window.initSendOTP === 'function') {\n        resolve();\n        return;\n      }\n\n      // Check if script tag already exists\n      const existingScript = document.querySelector('script[src*=\"otp-provider.js\"]');\n      if (existingScript) {\n        // Script tag exists, wait for it to load\n        existingScript.addEventListener('load', () => resolve());\n        existingScript.addEventListener('error', () => reject(new Error('Failed to load MSG91 script')));\n        return;\n      }\n\n      // Load script dynamically\n      const script = document.createElement('script');\n      script.type = 'text/javascript';\n      script.src = 'https://verify.msg91.com/otp-provider.js';\n      script.async = true;\n      \n      script.onload = () => {\n        // Wait a bit more for the function to be available\n        setTimeout(() => {\n          if (window.initSendOTP && typeof window.initSendOTP === 'function') {\n            resolve();\n          } else {\n            reject(new Error('MSG91 script loaded but initSendOTP function not available'));\n          }\n        }, 100);\n      };\n      \n      script.onerror = () => {\n        reject(new Error('Failed to load MSG91 script'));\n      };\n      \n      document.head.appendChild(script);\n    });\n  };\n\n  // Helper function to normalize mobile number for comparison (remove spaces, dashes, etc.)\n  const normalizeMobile = (mobileNumber) => {\n    if (!mobileNumber) return '';\n    // Remove all non-digit characters except +\n    return mobileNumber.replace(/[^0-9+]/g, '');\n  };\n\n  // Helper function to mask mobile number\n  const maskMobileNumber = (mobileNumber) => {\n    if (!mobileNumber) return '';\n    const cleaned = mobileNumber.replace(/[^0-9+]/g, '');\n    if (cleaned.length >= 6) {\n      // Show first 4 chars and last 4 chars, mask the middle\n      const start = cleaned.substring(0, 4);\n      const end = cleaned.substring(cleaned.length - 4);\n      return start + '****' + end;\n    }\n    return '****' + cleaned.substring(Math.max(0, cleaned.length - 4));\n  };\n\n  // Check if already authenticated\n  useEffect(() => {\n    const checkAuth = async () => {\n      try {\n        const response = await fetch(`${API_BASE_URL}/admin/auth/verify.php`, {\n          method: 'GET',\n          credentials: 'include',\n          headers: {\n            'Content-Type': 'application/json',\n          },\n        });\n\n        // 401 is expected when not authenticated - handle silently\n        if (response.status === 401) {\n          // Not authenticated, continue to login page\n          return;\n        }\n\n        // Check if response is JSON before parsing\n        const contentType = response.headers.get('content-type');\n        if (contentType && contentType.includes('application/json') && response.ok) {\n          const data = await response.json();\n          if (data.success && data.data && data.data.admin) {\n            navigate('/admin/dashboard', { replace: true });\n          }\n        }\n      } catch (err) {\n        // Not authenticated or network error, continue to login\n        // Silently ignore - 401 is expected behavior\n      }\n    };\n\n    checkAuth();\n  }, [navigate]);\n\n  // Step 1: Validate mobile number against hardcoded admin number (frontend-only validation)\n  const handleValidateMobile = (e) => {\n    e.preventDefault();\n    setError('');\n    setLoading(true);\n\n    if (!mobile || mobile.trim().length === 0) {\n      setError('Please enter your mobile number');\n      setLoading(false);\n      return;\n    }\n\n    // Normalize both mobile numbers for comparison\n    const enteredMobile = normalizeMobile(mobile.trim());\n    const adminMobile = normalizeMobile(ADMIN_MOBILE_NUMBER);\n\n    // Compare the normalized mobile numbers\n    if (enteredMobile !== adminMobile) {\n      // Mobile number doesn't match - show error popup\n      setError('Invalid mobile number. Access denied.');\n      setLoading(false);\n      return;\n    }\n\n    // Mobile number matches - proceed to OTP widget\n    // Generate a simple local validation token (not used by backend, just for local state)\n    const localToken = 'local_' + Date.now();\n    setValidationToken(localToken);\n    \n    // Store the validated mobile (keep it for internal use but don't display it)\n    const mobileToStore = mobile.trim();\n    setValidatedMobile(mobileToStore);\n    \n    // Create masked version for display only\n    setMaskedMobile(maskMobileNumber(mobileToStore));\n    \n    // Clear the actual mobile number from the input field\n    setMobile('');\n    setMobileLocked(true); // Lock mobile number\n    setStep('otp');\n    setLoading(false);\n    \n    // Widget will be initialized by useEffect when step changes to 'otp'\n  };\n\n  // Helper function to wait for MSG91 script to load\n  const waitForMSG91Script = (maxAttempts = 20, delay = 200) => {\n    return new Promise((resolve, reject) => {\n      let attempts = 0;\n      \n      const checkScript = () => {\n        attempts++;\n        \n        if (window.initSendOTP && typeof window.initSendOTP === 'function') {\n          resolve(true);\n          return;\n        }\n        \n        if (attempts >= maxAttempts) {\n          reject(new Error('MSG91 script failed to load after multiple attempts'));\n          return;\n        }\n        \n        setTimeout(checkScript, delay);\n      };\n      \n      checkScript();\n    });\n  };\n\n  // Step 2: Initialize MSG91 Widget (after frontend validation)\n  const initializeMSG91Widget = useCallback(async (mobileNumber = null) => {\n    // Prevent double initialization\n    if (widgetInitializedRef.current) {\n      return;\n    }\n\n    // Try to load MSG91 script if not already loaded\n    try {\n      // First try to load script dynamically\n      await loadMSG91Script();\n    } catch (loadError) {\n      console.warn('Failed to load MSG91 script dynamically, waiting for existing script:', loadError);\n      // If dynamic load fails, wait for existing script to load\n      try {\n        await waitForMSG91Script(20, 200); // Wait up to 4 seconds (20 * 200ms)\n      } catch (waitError) {\n        console.error('MSG91 script loading error:', waitError);\n        setError('MSG91 widget is not loaded. Please refresh the page and try again.');\n        widgetInitializedRef.current = false;\n        return;\n      }\n    }\n\n    // Final check\n    if (!window.initSendOTP || typeof window.initSendOTP !== 'function') {\n      setError('MSG91 widget is not loaded. Please refresh the page and try again.');\n      widgetInitializedRef.current = false;\n      return;\n    }\n\n    // Use passed mobile number or fallback to state\n    const mobileToUse = mobileNumber || validatedMobile;\n\n    if (!mobileToUse) {\n      setError('Mobile number validation missing. Please restart the login process.');\n      return;\n    }\n\n    // Mark as initialized\n    widgetInitializedRef.current = true;\n    \n    // Format mobile for MSG91 (remove + and spaces)\n    const formattedMobile = mobileToUse.replace(/[^0-9]/g, '');\n    // MSG91 expects format: 91XXXXXXXXXX (country code + number, no + sign)\n    const msg91Mobile = formattedMobile.startsWith('91') ? formattedMobile : '91' + formattedMobile.slice(-10);\n\n    try {\n      const configuration = {\n        widgetId: MSG91_WIDGET_ID,\n        tokenAuth: MSG91_AUTH_TOKEN,\n        identifier: msg91Mobile, // Mobile number for OTP\n        success: async (widgetData) => {\n          // Widget OTP verification successful\n          console.log('MSG91 Widget Success:', widgetData);\n          \n          // Extract widget token\n          let widgetToken = null;\n          if (typeof widgetData === 'string') {\n            widgetToken = widgetData;\n          } else if (widgetData?.token) {\n            widgetToken = widgetData.token;\n          } else if (widgetData?.verificationToken) {\n            widgetToken = widgetData.verificationToken;\n          } else if (widgetData?.data?.token) {\n            widgetToken = widgetData.data.token;\n          } else {\n            widgetToken = JSON.stringify(widgetData);\n          }\n\n          // Step 3: Verify OTP with backend\n          await handleVerifyOTP(widgetToken);\n        },\n        failure: (error) => {\n          // Extract error message from various possible formats\n          let errorMessage = 'OTP verification failed. Please try again.';\n          \n          if (error) {\n            if (typeof error === 'string') {\n              errorMessage = error;\n            } else if (error.message) {\n              errorMessage = error.message;\n            } else if (error.error) {\n              errorMessage = typeof error.error === 'string' ? error.error : error.error.message || errorMessage;\n            } else if (error.reason) {\n              errorMessage = error.reason;\n            } else if (error.description) {\n              errorMessage = error.description;\n            } else if (typeof error === 'object') {\n              // Try to stringify and extract meaningful info\n              try {\n                const errorStr = JSON.stringify(error);\n                if (errorStr !== '{}') {\n                  errorMessage = `OTP verification failed: ${errorStr}`;\n                }\n              } catch (e) {\n                errorMessage = error.toString() || errorMessage;\n              }\n            } else {\n              errorMessage = error.toString() || errorMessage;\n            }\n          }\n          \n          // Don't log IPBlocked errors (they're expected and handled gracefully)\n          const isIPBlocked = \n            errorMessage.toLowerCase().includes('ipblocked') || \n            errorMessage.toLowerCase().includes('ip blocked') ||\n            (error && typeof error === 'object' && (error.code === '408' || error.message === 'IPBlocked'));\n          \n          if (!isIPBlocked) {\n            console.error('MSG91 Widget Error:', error);\n          }\n          \n          setError(errorMessage);\n          widgetInitializedRef.current = false; // Reset on failure so user can retry\n        },\n      };\n\n      window.initSendOTP(configuration);\n    } catch (error) {\n      console.error('Error initializing MSG91 widget:', error);\n      setError('Failed to open OTP widget. Please try again.');\n      widgetInitializedRef.current = false; // Reset on error\n    }\n  }, [validatedMobile]);\n\n  // Step 3: Verify OTP with backend and create session\n  const handleVerifyOTP = async (widgetToken) => {\n    setError('');\n    setLoading(true);\n\n    if (!validatedMobile || !widgetToken) {\n      setError('Missing verification data. Please restart the login process.');\n      setLoading(false);\n      return;\n    }\n\n    // Re-validate mobile number against hardcoded admin number before sending to backend\n    const enteredMobile = normalizeMobile(validatedMobile);\n    const adminMobile = normalizeMobile(ADMIN_MOBILE_NUMBER);\n    \n    if (enteredMobile !== adminMobile) {\n      setError('Invalid mobile number. Access denied.');\n      setStep('mobile');\n      setValidationToken(null);\n      setMobileLocked(false);\n      setLoading(false);\n      return;\n    }\n\n    try {\n      // Send to backend for session creation (backend will still verify mobile against whitelist)\n      const response = await fetch(`${API_BASE_URL}/admin/auth/verify-otp.php`, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        credentials: 'include',\n        body: JSON.stringify({\n          validationToken: validationToken || 'frontend_validated', // Use local token or fallback\n          mobile: validatedMobile, // Use validated mobile\n          widgetToken: widgetToken,\n        }),\n      });\n\n      // Check response status first\n      if (!response.ok) {\n        // Try to get error message from response\n        let errorMessage = 'OTP verification failed. Please try again.';\n        try {\n          const contentType = response.headers.get('content-type');\n          if (contentType && contentType.includes('application/json')) {\n            const errorData = await response.json();\n            errorMessage = errorData.message || errorMessage;\n          } else {\n            const text = await response.text();\n            if (text) {\n              // Try to parse as JSON even if content-type is wrong\n              try {\n                const errorData = JSON.parse(text);\n                errorMessage = errorData.message || errorMessage;\n              } catch (e) {\n                // Not JSON, use text or default message\n                errorMessage = text.substring(0, 200) || errorMessage;\n              }\n            }\n          }\n        } catch (parseError) {\n          // If we can't parse the error, use status-based message\n          if (response.status === 500) {\n            errorMessage = 'Server error occurred. Please try again or contact support.';\n          } else if (response.status === 403) {\n            errorMessage = 'Access denied. Please check your credentials.';\n          }\n        }\n        \n        setError(errorMessage);\n        setStep('mobile');\n        setValidationToken(null);\n        setMobileLocked(false);\n        setLoading(false);\n        return;\n      }\n\n      // Check if response is JSON before parsing\n      const contentType = response.headers.get('content-type');\n      if (!contentType || !contentType.includes('application/json')) {\n        const text = await response.text();\n        console.error('Non-JSON response:', text.substring(0, 500));\n        setError('Server returned an invalid response. Please try again or contact support.');\n        setStep('mobile');\n        setValidationToken(null);\n        setMobileLocked(false);\n        setLoading(false);\n        return;\n      }\n\n      // Try to parse JSON, handle empty responses\n      let data;\n      try {\n        const text = await response.text();\n        if (!text || text.trim() === '') {\n          setError('Server returned an empty response. Please try again.');\n          setStep('mobile');\n          setValidationToken(null);\n          setMobileLocked(false);\n          setLoading(false);\n          return;\n        }\n        data = JSON.parse(text);\n      } catch (jsonError) {\n        console.error('JSON parse error:', jsonError);\n        setError('Server returned an invalid response. Please try again or contact support.');\n        setStep('mobile');\n        setValidationToken(null);\n        setMobileLocked(false);\n        setLoading(false);\n        return;\n      }\n\n      if (data.success) {\n        // Login successful - session created via HTTP-only cookie\n        // Clear loading state\n        setLoading(false);\n        \n        // Redirect immediately - session is already created and will be verified by dashboard\n        // No need to verify immediately as it can cause race conditions\n        console.log('Admin login successful, redirecting to dashboard');\n        navigate('/admin/dashboard', { replace: true });\n      } else {\n        setError(data.message || 'OTP verification failed. Please try again.');\n        // Reset to mobile step on failure\n        setStep('mobile');\n        setValidationToken(null);\n        setMobileLocked(false);\n      }\n    } catch (err) {\n      console.error('OTP verification error:', err);\n      if (err.message && err.message.includes('JSON')) {\n        setError('Server returned an invalid response. The API endpoint may not be available.');\n      } else {\n        setError('Connection error. Please check your internet connection and try again.');\n      }\n      setStep('mobile');\n      setValidationToken(null);\n      setMobileLocked(false);\n    }\n\n    setLoading(false);\n  };\n\n  // Handle mobile input change (only if not locked)\n  const handleMobileChange = (e) => {\n    if (!mobileLocked) {\n      setMobile(e.target.value);\n    }\n  };\n\n  // Initialize widget when step changes to OTP and validatedMobile is set\n  useEffect(() => {\n    if (step === 'otp' && validatedMobile && !loading && !widgetInitializedRef.current) {\n      // Small delay to ensure DOM is ready and state is fully updated\n      const timer = setTimeout(async () => {\n        await initializeMSG91Widget(validatedMobile);\n      }, 500); // Increased delay to ensure script is loaded\n      return () => clearTimeout(timer);\n    }\n  }, [step, validatedMobile, loading, initializeMSG91Widget]); // Include all dependencies\n\n  // Reset form\n  const handleReset = () => {\n    setStep('mobile');\n    setMobile('');\n    setValidatedMobile(null);\n    setMaskedMobile('');\n    setValidationToken(null);\n    setMobileLocked(false);\n    setError('');\n    widgetInitializedRef.current = false; // Reset widget initialization flag\n  };\n\n  return (\n    <div className=\"admin-login-page\">\n      <div className=\"admin-login-container\">\n        <div className=\"admin-login-card\">\n          <h1>Admin Login</h1>\n          <p className=\"admin-login-subtitle\">\n            {step === 'mobile'\n              ? 'Enter your mobile number to receive OTP'\n              : 'Enter the OTP sent to your mobile number'}\n          </p>\n\n          {error && (\n            <div className=\"admin-error-alert\">\n              {error}\n            </div>\n          )}\n\n          {step === 'mobile' && (\n            <form onSubmit={handleValidateMobile} className=\"admin-login-form\">\n              <div className=\"admin-form-group\">\n                <label htmlFor=\"mobile\">Mobile Number</label>\n                <input\n                  type=\"tel\"\n                  id=\"mobile\"\n                  name=\"mobile\"\n                  value={mobile}\n                  onChange={handleMobileChange}\n                  required\n                  autoComplete=\"tel\"\n                  disabled={loading || mobileLocked}\n                  pattern=\"^\\+91[6-9]\\d{9}$\"\n                />\n              </div>\n\n              <button\n                type=\"submit\"\n                className=\"admin-login-button\"\n                disabled={loading || !mobile || mobileLocked}\n              >\n                {loading ? 'Validating...' : 'Send OTP'}\n              </button>\n            </form>\n          )}\n\n          {step === 'otp' && (\n            <div className=\"admin-login-form\">\n              <div className=\"admin-form-group\">\n                <label>Mobile Number Verified</label>\n                <input\n                  type=\"text\"\n                  value={maskedMobile || '****'}\n                  disabled\n                  className=\"admin-mobile-locked\"\n                  readOnly\n                />\n              </div>\n\n              {loading && (\n                <div className=\"admin-loading\">\n                  <p>Verifying OTP...</p>\n                </div>\n              )}\n\n              <button\n                type=\"button\"\n                className=\"admin-back-link\"\n                onClick={handleReset}\n                disabled={loading}\n              >\n                ‚Üê Change Mobile Number\n              </button>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default AdminLogin;\n"],"names":["ADMIN_MOBILE_NUMBER","AdminLogin","navigate","useNavigate","step","setStep","useState","mobile","setMobile","validatedMobile","setValidatedMobile","maskedMobile","setMaskedMobile","validationToken","setValidationToken","error","setError","loading","setLoading","mobileLocked","setMobileLocked","widgetInitializedRef","useRef","normalizeMobile","mobileNumber","replace","useEffect","async","response","fetch","concat","API_BASE_URL","method","credentials","headers","status","contentType","get","includes","ok","data","json","success","admin","err","checkAuth","initializeMSG91Widget","useCallback","arguments","length","undefined","current","Promise","resolve","reject","window","initSendOTP","existingScript","document","querySelector","addEventListener","Error","script","createElement","type","src","onload","setTimeout","onerror","head","appendChild","loadError","console","warn","maxAttempts","delay","attempts","checkScript","waitForMSG91Script","waitError","mobileToUse","formattedMobile","msg91Mobile","startsWith","slice","configuration","widgetId","tokenAuth","identifier","_widgetData$data","log","widgetData","widgetToken","token","verificationToken","JSON","stringify","handleVerifyOTP","failure","errorMessage","message","reason","description","errorStr","e","toString","toLowerCase","code","body","text","parse","substring","parseError","trim","jsonError","timer","clearTimeout","_jsx","className","children","_jsxs","onSubmit","preventDefault","localToken","Date","now","mobileToStore","cleaned","Math","max","maskMobileNumber","htmlFor","id","name","value","onChange","target","required","autoComplete","disabled","pattern","readOnly","onClick","handleReset"],"ignoreList":[],"sourceRoot":""}