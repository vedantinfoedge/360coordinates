/*! For license information please see 321.9a59e0bf.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[321],{292(e,s,a){a.d(s,{A:()=>n});const n=(0,a(784).A)("search",[["path",{d:"m21 21-4.34-4.34",key:"14j7rj"}],["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}]])},321(e,s,a){a.r(s),a.d(s,{default:()=>h});var n=a(555),r=a(43),t=a(292),i=a(580),l=a(54);const o=(0,a(784).A)("ban",[["path",{d:"M4.929 4.929 19.07 19.071",key:"196cmz"}],["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);var d=a(855),c=a(375),p=a(579);const h=()=>{const[e,s]=(0,r.useState)(""),[a,h]=(0,r.useState)("All Roles"),[u,x]=(0,r.useState)(!1),[m,g]=(0,r.useState)([]),[j,f]=(0,r.useState)(!0),[b,y]=(0,r.useState)(null),[v,N]=(0,r.useState)({page:1,total:0,pages:0}),[S,A]=(0,r.useState)(20);(0,r.useEffect)(()=>{N(e=>(0,n.A)((0,n.A)({},e),{},{page:1}))},[a,e,S]),(0,r.useEffect)(()=>{w()},[v.page,a,e]);const w=async()=>{f(!0),y(null);try{const o=new URLSearchParams({page:v.page.toString(),limit:S.toString()});"All Roles"!==a&&o.append("user_type",a.toLowerCase()),e&&o.append("search",e);const d=await fetch("".concat(c.JR).concat(c.Sn.ADMIN_USERS_LIST,"?").concat(o),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}),p=await d.text();if(console.log("Raw response:",p),!d.ok){var s,n,r;let e=null;try{e=JSON.parse(p)}catch(l){}throw new Error((null===(s=e)||void 0===s?void 0:s.message)||(null===(n=e)||void 0===n||null===(r=n.data)||void 0===r?void 0:r.message)||"HTTP error! status: ".concat(d.status," - ").concat(p.substring(0,200)))}let h;try{h=JSON.parse(p)}catch(l){throw console.error("Failed to parse JSON:",l),console.error("Response text:",p),new Error("Invalid JSON response from server: "+p.substring(0,200))}if(console.log("Users API Response:",h),console.log("Response status:",d.status),h.success){var t,i;const e=(null===(t=h.data)||void 0===t?void 0:t.users)||[],s=(null===(i=h.data)||void 0===i?void 0:i.pagination)||{page:1,total:0,pages:0};console.log("Users received:",e.length,"users"),console.log("Pagination:",s),console.log("First user sample:",e[0]),e.length>0?(g(e),N(s),y(null)):s.total>0?(g([]),N(s),y(null)):(g([]),N(s),y("No users found in database"))}else console.error("API Error:",h.message),console.error("Full error data:",h),y(h.message||"Failed to load users"),g([])}catch(o){console.error("Error fetching users:",o),y("Failed to load users: ".concat(o.message))}finally{f(!1)}},k=e=>{switch(e){case"Verified":return"#10b981";case"Partial":case"Pending":return"#f59e0b";default:return"#64748b"}},E=e=>e?"#ef4444":"#10b981",R=e=>{if(!e)return"N/A";return new Date(e).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric"})};return(0,p.jsxs)("div",{className:"admin-users",children:[(0,p.jsx)("div",{className:"admin-page-header",children:(0,p.jsxs)("div",{children:[(0,p.jsx)("h1",{children:"Manage Users"}),(0,p.jsx)("p",{children:j?"Loading...":"".concat(m.length," of ").concat(v.total," users")})]})}),(0,p.jsxs)("div",{className:"admin-filters-bar",children:[(0,p.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"10px"},children:[(0,p.jsx)("label",{style:{fontSize:"14px",color:"#64748b"},children:"Items per page:"}),(0,p.jsxs)("select",{value:S,onChange:e=>A(Number(e.target.value)),style:{padding:"6px 12px",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"14px",cursor:"pointer"},children:[(0,p.jsx)("option",{value:10,children:"10"}),(0,p.jsx)("option",{value:20,children:"20"}),(0,p.jsx)("option",{value:50,children:"50"}),(0,p.jsx)("option",{value:100,children:"100"})]})]}),(0,p.jsxs)("div",{className:"admin-search-box",children:[(0,p.jsxs)("div",{className:"admin-search-input-wrapper",children:[(0,p.jsx)(t.A,{}),(0,p.jsx)("input",{type:"text",placeholder:"Search by name, email, or phone...",value:e,onChange:e=>s(e.target.value),onKeyPress:e=>{"Enter"===e.key&&w()}})]}),(0,p.jsx)("button",{className:"admin-search-btn",onClick:w,children:"Search"})]}),(0,p.jsxs)("div",{style:{position:"relative"},children:[(0,p.jsxs)("button",{className:"admin-filter-btn",onClick:()=>x(!u),children:[(0,p.jsx)(i.A,{}),a]}),u&&(0,p.jsx)("div",{className:"admin-filter-dropdown",children:["All Roles","Buyer","Seller"].map(e=>(0,p.jsx)("div",{className:"admin-filter-option ".concat(a===e?"admin-active":""),onClick:()=>{h(e),x(!1)},children:e},e))})]})]}),b&&(0,p.jsxs)("div",{style:{background:"#fee2e2",color:"#dc2626",padding:"12px 16px",borderRadius:"6px",marginBottom:"20px",border:"1px solid #fecaca"},children:[(0,p.jsx)("strong",{children:"Error:"})," ",b]}),(0,p.jsx)("div",{className:"admin-users-table-container",children:j?(0,p.jsxs)("div",{className:"admin-no-results",children:[(0,p.jsx)("h3",{children:"Loading users..."}),(0,p.jsx)("p",{children:"Please wait while we fetch user data..."})]}):b&&0===m.length?(0,p.jsxs)("div",{className:"admin-no-results",children:[(0,p.jsx)("h3",{children:"Unable to Load Users"}),(0,p.jsx)("p",{children:b}),(0,p.jsx)("button",{onClick:w,style:{marginTop:"15px",padding:"10px 20px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Retry"})]}):m.length>0?(0,p.jsxs)(p.Fragment,{children:[(0,p.jsxs)("div",{style:{marginBottom:"15px",color:"#64748b",fontSize:"14px"},children:["Showing ",m.length," of ",v.total," users (Page ",v.page," of ",v.pages,")"]}),(0,p.jsxs)("table",{className:"admin-users-table",children:[(0,p.jsx)("thead",{children:(0,p.jsxs)("tr",{children:[(0,p.jsx)("th",{children:"USER"}),(0,p.jsx)("th",{children:"PHONE"}),(0,p.jsx)("th",{children:"ROLE"}),(0,p.jsx)("th",{children:"KYC STATUS"}),(0,p.jsx)("th",{children:"PROPERTIES"}),(0,p.jsx)("th",{children:"INQUIRIES"}),(0,p.jsx)("th",{children:"STATUS"}),(0,p.jsx)("th",{children:"JOINED"}),(0,p.jsx)("th",{children:"ACTIONS"})]})}),(0,p.jsx)("tbody",{children:m.map((e,s)=>{console.log("Rendering user ".concat(s,":"),e);const a=(e=>e.email_verified&&e.phone_verified?"Verified":e.email_verified||e.phone_verified?"Partial":"Pending")(e),n=e.is_banned||!1;return e&&e.id?(0,p.jsxs)("tr",{children:[(0,p.jsx)("td",{children:(0,p.jsxs)("div",{className:"admin-user-cell",children:[(0,p.jsx)("div",{className:"admin-user-avatar",children:(t=e.full_name,t?t.split(" ").map(e=>e[0]).join("").toUpperCase().substring(0,2):"U")}),(0,p.jsxs)("div",{className:"admin-user-info",children:[(0,p.jsx)("div",{className:"admin-user-name",children:e.full_name||"N/A"}),(0,p.jsx)("div",{className:"admin-user-email",children:e.email||"No email"})]})]})}),(0,p.jsx)("td",{className:"admin-phone-cell",children:(0,p.jsxs)("div",{children:[(0,p.jsx)("div",{children:e.phone||"N/A"}),e.phone_verified&&(0,p.jsx)("span",{style:{fontSize:"11px",color:"#10b981"},children:"\u2713 Verified"})]})}),(0,p.jsx)("td",{className:"admin-role-cell",children:(0,p.jsx)("span",{style:{padding:"4px 8px",borderRadius:"4px",background:"agent"===e.user_type?"#06b6d420":"seller"===e.user_type?"#8b5cf620":"#3b82f620",color:"agent"===e.user_type?"#06b6d4":"seller"===e.user_type?"#8b5cf6":"#3b82f6",fontSize:"12px",fontWeight:"500"},children:(r=e.user_type,r?r.charAt(0).toUpperCase()+r.slice(1):"N/A")})}),(0,p.jsx)("td",{children:(0,p.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"4px"},children:[(0,p.jsx)("span",{className:"admin-status-badge",style:{background:"".concat(k(a),"20"),color:k(a),fontSize:"11px"},children:a}),(0,p.jsxs)("div",{style:{fontSize:"10px",color:"#64748b"},children:[e.email_verified?"\u2713 Email":"\u2717 Email"," | ",e.phone_verified?"\u2713 Phone":"\u2717 Phone"]})]})}),(0,p.jsx)("td",{style:{textAlign:"center"},children:(0,p.jsx)("span",{style:{fontWeight:"600",color:"#3b82f6"},children:e.property_count||0})}),(0,p.jsx)("td",{style:{textAlign:"center"},children:(0,p.jsx)("span",{style:{fontWeight:"600",color:"#10b981"},children:e.inquiry_count||0})}),(0,p.jsx)("td",{children:(0,p.jsx)("span",{className:"admin-status-badge",style:{background:"".concat(E(n),"20"),color:E(n)},children:n?"Banned":"Active"})}),(0,p.jsx)("td",{className:"admin-joined-cell",children:R(e.created_at)}),(0,p.jsx)("td",{className:"admin-actions-column",children:(0,p.jsxs)("div",{className:"admin-action-buttons",children:[(0,p.jsx)("button",{className:"admin-icon-btn ".concat(n?"admin-success":"admin-warning"),title:n?"Unban User":"Ban User",onClick:()=>(async(e,s)=>{try{const a=await fetch("".concat(c.JR).concat(c.Sn.ADMIN_USERS_UPDATE,"?id=").concat(e.id),{method:"PUT",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({is_banned:!s})}),n=await a.json();n.success?w():alert(n.message||"Failed to update user")}catch(a){console.error("Error updating user:",a),alert("Failed to update user")}})(e,n),children:n?(0,p.jsx)(l.A,{}):(0,p.jsx)(o,{})}),(0,p.jsx)("button",{className:"admin-icon-btn admin-danger",title:"Delete User",onClick:()=>(async e=>{if(window.confirm("Are you sure you want to delete this user? This action cannot be undone."))try{const s=await fetch("".concat(c.JR).concat(c.Sn.ADMIN_USERS_DELETE,"?id=").concat(e),{method:"DELETE",headers:{"Content-Type":"application/json"},credentials:"include"}),a=await s.json();a.success?w():alert(a.message||"Failed to delete user")}catch(s){console.error("Error deleting user:",s),alert("Failed to delete user")}})(e.id),children:(0,p.jsx)(d.A,{})})]})})]},e.id||"user-".concat(s)):(console.warn("Invalid user data:",e),null);var r,t})})]}),v.pages>1&&(0,p.jsxs)("div",{className:"admin-pagination",style:{marginTop:"20px",display:"flex",justifyContent:"center",alignItems:"center",gap:"10px"},children:[(0,p.jsx)("button",{onClick:()=>N(e=>(0,n.A)((0,n.A)({},e),{},{page:Math.max(1,e.page-1)})),disabled:1===v.page,style:{padding:"8px 16px",border:"1px solid #e2e8f0",borderRadius:"6px",background:1===v.page?"#f1f5f9":"white",cursor:1===v.page?"not-allowed":"pointer"},children:"Previous"}),(0,p.jsxs)("span",{style:{padding:"0 10px"},children:["Page ",v.page," of ",v.pages," (",v.total," total users)"]}),(0,p.jsx)("button",{onClick:()=>N(e=>(0,n.A)((0,n.A)({},e),{},{page:Math.min(e.pages,e.page+1)})),disabled:v.page===v.pages,style:{padding:"8px 16px",border:"1px solid #e2e8f0",borderRadius:"6px",background:v.page===v.pages?"#f1f5f9":"white",cursor:v.page===v.pages?"not-allowed":"pointer"},children:"Next"})]})]}):(0,p.jsxs)("div",{className:"admin-no-results",children:[(0,p.jsx)("h3",{children:"No users found"}),(0,p.jsx)("p",{children:"Try adjusting your search or filters"})]})})]})}},855(e,s,a){a.d(s,{A:()=>n});const n=(0,a(784).A)("trash-2",[["path",{d:"M10 11v6",key:"nco0om"}],["path",{d:"M14 11v6",key:"outv1u"}],["path",{d:"M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6",key:"miytrc"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M8 6V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2",key:"e791ji"}]])}}]);
//# sourceMappingURL=321.9a59e0bf.chunk.js.map