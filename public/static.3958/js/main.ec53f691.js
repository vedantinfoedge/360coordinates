/*! For license information please see main.ec53f691.js.LICENSE.txt */
(()=>{var e={4(e,t,r){"use strict";var n=r(853),i=r(43),s=r(950);function o(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function a(e){return!(!e||1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType)}function l(e){var t=e,r=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do{0!==(4098&(t=e).flags)&&(r=t.return),e=t.return}while(e)}return 3===t.tag?r:null}function c(e){if(13===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function u(e){if(31===e.tag){var t=e.memoizedState;if(null===t&&(null!==(e=e.alternate)&&(t=e.memoizedState)),null!==t)return t.dehydrated}return null}function d(e){if(l(e)!==e)throw Error(o(188))}function h(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e;for(e=e.child;null!==e;){if(null!==(t=h(e)))return t;e=e.sibling}return null}var p=Object.assign,m=Symbol.for("react.element"),f=Symbol.for("react.transitional.element"),g=Symbol.for("react.portal"),y=Symbol.for("react.fragment"),_=Symbol.for("react.strict_mode"),v=Symbol.for("react.profiler"),x=Symbol.for("react.consumer"),b=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),j=Symbol.for("react.suspense"),S=Symbol.for("react.suspense_list"),T=Symbol.for("react.memo"),k=Symbol.for("react.lazy");Symbol.for("react.scope");var A=Symbol.for("react.activity");Symbol.for("react.legacy_hidden"),Symbol.for("react.tracing_marker");var C=Symbol.for("react.memo_cache_sentinel");Symbol.for("react.view_transition");var E=Symbol.iterator;function N(e){return null===e||"object"!==typeof e?null:"function"===typeof(e=E&&e[E]||e["@@iterator"])?e:null}var I=Symbol.for("react.client.reference");function P(e){if(null==e)return null;if("function"===typeof e)return e.$$typeof===I?null:e.displayName||e.name||null;if("string"===typeof e)return e;switch(e){case y:return"Fragment";case v:return"Profiler";case _:return"StrictMode";case j:return"Suspense";case S:return"SuspenseList";case A:return"Activity"}if("object"===typeof e)switch(e.$$typeof){case g:return"Portal";case b:return e.displayName||"Context";case x:return(e._context.displayName||"Context")+".Consumer";case w:var t=e.render;return(e=e.displayName)||(e=""!==(e=t.displayName||t.name||"")?"ForwardRef("+e+")":"ForwardRef"),e;case T:return null!==(t=e.displayName||null)?t:P(e.type)||"Memo";case k:t=e._payload,e=e._init;try{return P(e(t))}catch(r){}}return null}var M=Array.isArray,L=i.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,R=s.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,D={pending:!1,data:null,method:null,action:null},F=[],O=-1;function z(e){return{current:e}}function B(e){0>O||(e.current=F[O],F[O]=null,O--)}function U(e,t){O++,F[O]=e.current,e.current=t}var V,q,W=z(null),H=z(null),G=z(null),Z=z(null);function K(e,t){switch(U(G,t),U(H,e),U(W,null),t.nodeType){case 9:case 11:e=(e=t.documentElement)&&(e=e.namespaceURI)?yd(e):0;break;default:if(e=t.tagName,t=t.namespaceURI)e=_d(t=yd(t),e);else switch(e){case"svg":e=1;break;case"math":e=2;break;default:e=0}}B(W),U(W,e)}function Y(){B(W),B(H),B(G)}function X(e){null!==e.memoizedState&&U(Z,e);var t=W.current,r=_d(t,e.type);t!==r&&(U(H,e),U(W,r))}function J(e){H.current===e&&(B(W),B(H)),Z.current===e&&(B(Z),uh._currentValue=D)}function Q(e){if(void 0===V)try{throw Error()}catch(r){var t=r.stack.trim().match(/\n( *(at )?)/);V=t&&t[1]||"",q=-1<r.stack.indexOf("\n    at")?" (<anonymous>)":-1<r.stack.indexOf("@")?"@unknown:0:0":""}return"\n"+V+e+q}var $=!1;function ee(e,t){if(!e||$)return"";$=!0;var r=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var n={DetermineComponentFrameRoot:function(){try{if(t){var r=function(){throw Error()};if(Object.defineProperty(r.prototype,"props",{set:function(){throw Error()}}),"object"===typeof Reflect&&Reflect.construct){try{Reflect.construct(r,[])}catch(i){var n=i}Reflect.construct(e,[],r)}else{try{r.call()}catch(s){n=s}e.call(r.prototype)}}else{try{throw Error()}catch(o){n=o}(r=e())&&"function"===typeof r.catch&&r.catch(function(){})}}catch(a){if(a&&n&&"string"===typeof a.stack)return[a.stack,n.stack]}return[null,null]}};n.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var i=Object.getOwnPropertyDescriptor(n.DetermineComponentFrameRoot,"name");i&&i.configurable&&Object.defineProperty(n.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var s=n.DetermineComponentFrameRoot(),o=s[0],a=s[1];if(o&&a){var l=o.split("\n"),c=a.split("\n");for(i=n=0;n<l.length&&!l[n].includes("DetermineComponentFrameRoot");)n++;for(;i<c.length&&!c[i].includes("DetermineComponentFrameRoot");)i++;if(n===l.length||i===c.length)for(n=l.length-1,i=c.length-1;1<=n&&0<=i&&l[n]!==c[i];)i--;for(;1<=n&&0<=i;n--,i--)if(l[n]!==c[i]){if(1!==n||1!==i)do{if(n--,0>--i||l[n]!==c[i]){var u="\n"+l[n].replace(" at new "," at ");return e.displayName&&u.includes("<anonymous>")&&(u=u.replace("<anonymous>",e.displayName)),u}}while(1<=n&&0<=i);break}}}finally{$=!1,Error.prepareStackTrace=r}return(r=e?e.displayName||e.name:"")?Q(r):""}function te(e,t){switch(e.tag){case 26:case 27:case 5:return Q(e.type);case 16:return Q("Lazy");case 13:return e.child!==t&&null!==t?Q("Suspense Fallback"):Q("Suspense");case 19:return Q("SuspenseList");case 0:case 15:return ee(e.type,!1);case 11:return ee(e.type.render,!1);case 1:return ee(e.type,!0);case 31:return Q("Activity");default:return""}}function re(e){try{var t="",r=null;do{t+=te(e,r),r=e,e=e.return}while(e);return t}catch(n){return"\nError generating stack: "+n.message+"\n"+n.stack}}var ne=Object.prototype.hasOwnProperty,ie=n.unstable_scheduleCallback,se=n.unstable_cancelCallback,oe=n.unstable_shouldYield,ae=n.unstable_requestPaint,le=n.unstable_now,ce=n.unstable_getCurrentPriorityLevel,ue=n.unstable_ImmediatePriority,de=n.unstable_UserBlockingPriority,he=n.unstable_NormalPriority,pe=n.unstable_LowPriority,me=n.unstable_IdlePriority,fe=n.log,ge=n.unstable_setDisableYieldValue,ye=null,_e=null;function ve(e){if("function"===typeof fe&&ge(e),_e&&"function"===typeof _e.setStrictMode)try{_e.setStrictMode(ye,e)}catch(t){}}var xe=Math.clz32?Math.clz32:function(e){return 0===(e>>>=0)?32:31-(be(e)/we|0)|0},be=Math.log,we=Math.LN2;var je=256,Se=262144,Te=4194304;function ke(e){var t=42&e;if(0!==t)return t;switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:return 261888&e;case 262144:case 524288:case 1048576:case 2097152:return 3932160&e;case 4194304:case 8388608:case 16777216:case 33554432:return 62914560&e;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return e}}function Ae(e,t,r){var n=e.pendingLanes;if(0===n)return 0;var i=0,s=e.suspendedLanes,o=e.pingedLanes;e=e.warmLanes;var a=134217727&n;return 0!==a?0!==(n=a&~s)?i=ke(n):0!==(o&=a)?i=ke(o):r||0!==(r=a&~e)&&(i=ke(r)):0!==(a=n&~s)?i=ke(a):0!==o?i=ke(o):r||0!==(r=n&~e)&&(i=ke(r)),0===i?0:0!==t&&t!==i&&0===(t&s)&&((s=i&-i)>=(r=t&-t)||32===s&&0!==(4194048&r))?t:i}function Ce(e,t){return 0===(e.pendingLanes&~(e.suspendedLanes&~e.pingedLanes)&t)}function Ee(e,t){switch(e){case 1:case 2:case 4:case 8:case 64:return t+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;default:return-1}}function Ne(){var e=Te;return 0===(62914560&(Te<<=1))&&(Te=4194304),e}function Ie(e){for(var t=[],r=0;31>r;r++)t.push(e);return t}function Pe(e,t){e.pendingLanes|=t,268435456!==t&&(e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0)}function Me(e,t,r){e.pendingLanes|=t,e.suspendedLanes&=~t;var n=31-xe(t);e.entangledLanes|=t,e.entanglements[n]=1073741824|e.entanglements[n]|261930&r}function Le(e,t){var r=e.entangledLanes|=t;for(e=e.entanglements;r;){var n=31-xe(r),i=1<<n;i&t|e[n]&t&&(e[n]|=t),r&=~i}}function Re(e,t){var r=t&-t;return 0!==((r=0!==(42&r)?1:De(r))&(e.suspendedLanes|t))?0:r}function De(e){switch(e){case 2:e=1;break;case 8:e=4;break;case 32:e=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:e=128;break;case 268435456:e=134217728;break;default:e=0}return e}function Fe(e){return 2<(e&=-e)?8<e?0!==(134217727&e)?32:268435456:8:2}function Oe(){var e=R.p;return 0!==e?e:void 0===(e=window.event)?32:kh(e.type)}function ze(e,t){var r=R.p;try{return R.p=e,t()}finally{R.p=r}}var Be=Math.random().toString(36).slice(2),Ue="__reactFiber$"+Be,Ve="__reactProps$"+Be,qe="__reactContainer$"+Be,We="__reactEvents$"+Be,He="__reactListeners$"+Be,Ge="__reactHandles$"+Be,Ze="__reactResources$"+Be,Ke="__reactMarker$"+Be;function Ye(e){delete e[Ue],delete e[Ve],delete e[We],delete e[He],delete e[Ge]}function Xe(e){var t=e[Ue];if(t)return t;for(var r=e.parentNode;r;){if(t=r[qe]||r[Ue]){if(r=t.alternate,null!==t.child||null!==r&&null!==r.child)for(e=Dd(e);null!==e;){if(r=e[Ue])return r;e=Dd(e)}return t}r=(e=r).parentNode}return null}function Je(e){if(e=e[Ue]||e[qe]){var t=e.tag;if(5===t||6===t||13===t||31===t||26===t||27===t||3===t)return e}return null}function Qe(e){var t=e.tag;if(5===t||26===t||27===t||6===t)return e.stateNode;throw Error(o(33))}function $e(e){var t=e[Ze];return t||(t=e[Ze]={hoistableStyles:new Map,hoistableScripts:new Map}),t}function et(e){e[Ke]=!0}var tt=new Set,rt={};function nt(e,t){it(e,t),it(e+"Capture",t)}function it(e,t){for(rt[e]=t,e=0;e<t.length;e++)tt.add(t[e])}var st=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),ot={},at={};function lt(e,t,r){if(i=t,ne.call(at,i)||!ne.call(ot,i)&&(st.test(i)?at[i]=!0:(ot[i]=!0,0)))if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":return void e.removeAttribute(t);case"boolean":var n=t.toLowerCase().slice(0,5);if("data-"!==n&&"aria-"!==n)return void e.removeAttribute(t)}e.setAttribute(t,""+r)}var i}function ct(e,t,r){if(null===r)e.removeAttribute(t);else{switch(typeof r){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(t)}e.setAttribute(t,""+r)}}function ut(e,t,r,n){if(null===n)e.removeAttribute(r);else{switch(typeof n){case"undefined":case"function":case"symbol":case"boolean":return void e.removeAttribute(r)}e.setAttributeNS(t,r,""+n)}}function dt(e){switch(typeof e){case"bigint":case"boolean":case"number":case"string":case"undefined":case"object":return e;default:return""}}function ht(e){var t=e.type;return(e=e.nodeName)&&"input"===e.toLowerCase()&&("checkbox"===t||"radio"===t)}function pt(e){if(!e._valueTracker){var t=ht(e)?"checked":"value";e._valueTracker=function(e,t,r){var n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t);if(!e.hasOwnProperty(t)&&"undefined"!==typeof n&&"function"===typeof n.get&&"function"===typeof n.set){var i=n.get,s=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return i.call(this)},set:function(e){r=""+e,s.call(this,e)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return r},setValue:function(e){r=""+e},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}(e,t,""+e[t])}}function mt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var r=t.getValue(),n="";return e&&(n=ht(e)?e.checked?"true":"false":e.value),(e=n)!==r&&(t.setValue(e),!0)}function ft(e){if("undefined"===typeof(e=e||("undefined"!==typeof document?document:void 0)))return null;try{return e.activeElement||e.body}catch(t){return e.body}}var gt=/[\n"\\]/g;function yt(e){return e.replace(gt,function(e){return"\\"+e.charCodeAt(0).toString(16)+" "})}function _t(e,t,r,n,i,s,o,a){e.name="",null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o?e.type=o:e.removeAttribute("type"),null!=t?"number"===o?(0===t&&""===e.value||e.value!=t)&&(e.value=""+dt(t)):e.value!==""+dt(t)&&(e.value=""+dt(t)):"submit"!==o&&"reset"!==o||e.removeAttribute("value"),null!=t?xt(e,o,dt(t)):null!=r?xt(e,o,dt(r)):null!=n&&e.removeAttribute("value"),null==i&&null!=s&&(e.defaultChecked=!!s),null!=i&&(e.checked=i&&"function"!==typeof i&&"symbol"!==typeof i),null!=a&&"function"!==typeof a&&"symbol"!==typeof a&&"boolean"!==typeof a?e.name=""+dt(a):e.removeAttribute("name")}function vt(e,t,r,n,i,s,o,a){if(null!=s&&"function"!==typeof s&&"symbol"!==typeof s&&"boolean"!==typeof s&&(e.type=s),null!=t||null!=r){if(!("submit"!==s&&"reset"!==s||void 0!==t&&null!==t))return void pt(e);r=null!=r?""+dt(r):"",t=null!=t?""+dt(t):r,a||t===e.value||(e.value=t),e.defaultValue=t}n="function"!==typeof(n=null!=n?n:i)&&"symbol"!==typeof n&&!!n,e.checked=a?e.checked:!!n,e.defaultChecked=!!n,null!=o&&"function"!==typeof o&&"symbol"!==typeof o&&"boolean"!==typeof o&&(e.name=o),pt(e)}function xt(e,t,r){"number"===t&&ft(e.ownerDocument)===e||e.defaultValue===""+r||(e.defaultValue=""+r)}function bt(e,t,r,n){if(e=e.options,t){t={};for(var i=0;i<r.length;i++)t["$"+r[i]]=!0;for(r=0;r<e.length;r++)i=t.hasOwnProperty("$"+e[r].value),e[r].selected!==i&&(e[r].selected=i),i&&n&&(e[r].defaultSelected=!0)}else{for(r=""+dt(r),t=null,i=0;i<e.length;i++){if(e[i].value===r)return e[i].selected=!0,void(n&&(e[i].defaultSelected=!0));null!==t||e[i].disabled||(t=e[i])}null!==t&&(t.selected=!0)}}function wt(e,t,r){null==t||((t=""+dt(t))!==e.value&&(e.value=t),null!=r)?e.defaultValue=null!=r?""+dt(r):"":e.defaultValue!==t&&(e.defaultValue=t)}function jt(e,t,r,n){if(null==t){if(null!=n){if(null!=r)throw Error(o(92));if(M(n)){if(1<n.length)throw Error(o(93));n=n[0]}r=n}null==r&&(r=""),t=r}r=dt(t),e.defaultValue=r,(n=e.textContent)===r&&""!==n&&null!==n&&(e.value=n),pt(e)}function St(e,t){if(t){var r=e.firstChild;if(r&&r===e.lastChild&&3===r.nodeType)return void(r.nodeValue=t)}e.textContent=t}var Tt=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function kt(e,t,r){var n=0===t.indexOf("--");null==r||"boolean"===typeof r||""===r?n?e.setProperty(t,""):"float"===t?e.cssFloat="":e[t]="":n?e.setProperty(t,r):"number"!==typeof r||0===r||Tt.has(t)?"float"===t?e.cssFloat=r:e[t]=(""+r).trim():e[t]=r+"px"}function At(e,t,r){if(null!=t&&"object"!==typeof t)throw Error(o(62));if(e=e.style,null!=r){for(var n in r)!r.hasOwnProperty(n)||null!=t&&t.hasOwnProperty(n)||(0===n.indexOf("--")?e.setProperty(n,""):"float"===n?e.cssFloat="":e[n]="");for(var i in t)n=t[i],t.hasOwnProperty(i)&&r[i]!==n&&kt(e,i,n)}else for(var s in t)t.hasOwnProperty(s)&&kt(e,s,t[s])}function Ct(e){if(-1===e.indexOf("-"))return!1;switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Et=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Nt=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function It(e){return Nt.test(""+e)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":e}function Pt(){}var Mt=null;function Lt(e){return(e=e.target||e.srcElement||window).correspondingUseElement&&(e=e.correspondingUseElement),3===e.nodeType?e.parentNode:e}var Rt=null,Dt=null;function Ft(e){var t=Je(e);if(t&&(e=t.stateNode)){var r=e[Ve]||null;e:switch(e=t.stateNode,t.type){case"input":if(_t(e,r.value,r.defaultValue,r.defaultValue,r.checked,r.defaultChecked,r.type,r.name),t=r.name,"radio"===r.type&&null!=t){for(r=e;r.parentNode;)r=r.parentNode;for(r=r.querySelectorAll('input[name="'+yt(""+t)+'"][type="radio"]'),t=0;t<r.length;t++){var n=r[t];if(n!==e&&n.form===e.form){var i=n[Ve]||null;if(!i)throw Error(o(90));_t(n,i.value,i.defaultValue,i.defaultValue,i.checked,i.defaultChecked,i.type,i.name)}}for(t=0;t<r.length;t++)(n=r[t]).form===e.form&&mt(n)}break e;case"textarea":wt(e,r.value,r.defaultValue);break e;case"select":null!=(t=r.value)&&bt(e,!!r.multiple,t,!1)}}}var Ot=!1;function zt(e,t,r){if(Ot)return e(t,r);Ot=!0;try{return e(t)}finally{if(Ot=!1,(null!==Rt||null!==Dt)&&($c(),Rt&&(t=Rt,e=Dt,Dt=Rt=null,Ft(t),e)))for(t=0;t<e.length;t++)Ft(e[t])}}function Bt(e,t){var r=e.stateNode;if(null===r)return null;var n=r[Ve]||null;if(null===n)return null;r=n[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(n=!n.disabled)||(n=!("button"===(e=e.type)||"input"===e||"select"===e||"textarea"===e)),e=!n;break e;default:e=!1}if(e)return null;if(r&&"function"!==typeof r)throw Error(o(231,t,typeof r));return r}var Ut=!("undefined"===typeof window||"undefined"===typeof window.document||"undefined"===typeof window.document.createElement),Vt=!1;if(Ut)try{var qt={};Object.defineProperty(qt,"passive",{get:function(){Vt=!0}}),window.addEventListener("test",qt,qt),window.removeEventListener("test",qt,qt)}catch(Jh){Vt=!1}var Wt=null,Ht=null,Gt=null;function Zt(){if(Gt)return Gt;var e,t,r=Ht,n=r.length,i="value"in Wt?Wt.value:Wt.textContent,s=i.length;for(e=0;e<n&&r[e]===i[e];e++);var o=n-e;for(t=1;t<=o&&r[n-t]===i[s-t];t++);return Gt=i.slice(e,1<t?1-t:void 0)}function Kt(e){var t=e.keyCode;return"charCode"in e?0===(e=e.charCode)&&13===t&&(e=13):e=t,10===e&&(e=13),32<=e||13===e?e:0}function Yt(){return!0}function Xt(){return!1}function Jt(e){function t(t,r,n,i,s){for(var o in this._reactName=t,this._targetInst=n,this.type=r,this.nativeEvent=i,this.target=s,this.currentTarget=null,e)e.hasOwnProperty(o)&&(t=e[o],this[o]=t?t(i):i[o]);return this.isDefaultPrevented=(null!=i.defaultPrevented?i.defaultPrevented:!1===i.returnValue)?Yt:Xt,this.isPropagationStopped=Xt,this}return p(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var e=this.nativeEvent;e&&(e.preventDefault?e.preventDefault():"unknown"!==typeof e.returnValue&&(e.returnValue=!1),this.isDefaultPrevented=Yt)},stopPropagation:function(){var e=this.nativeEvent;e&&(e.stopPropagation?e.stopPropagation():"unknown"!==typeof e.cancelBubble&&(e.cancelBubble=!0),this.isPropagationStopped=Yt)},persist:function(){},isPersistent:Yt}),t}var Qt,$t,er,tr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},rr=Jt(tr),nr=p({},tr,{view:0,detail:0}),ir=Jt(nr),sr=p({},nr,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:gr,button:0,buttons:0,relatedTarget:function(e){return void 0===e.relatedTarget?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==er&&(er&&"mousemove"===e.type?(Qt=e.screenX-er.screenX,$t=e.screenY-er.screenY):$t=Qt=0,er=e),Qt)},movementY:function(e){return"movementY"in e?e.movementY:$t}}),or=Jt(sr),ar=Jt(p({},sr,{dataTransfer:0})),lr=Jt(p({},nr,{relatedTarget:0})),cr=Jt(p({},tr,{animationName:0,elapsedTime:0,pseudoElement:0})),ur=Jt(p({},tr,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}})),dr=Jt(p({},tr,{data:0})),hr={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},pr={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},mr={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function fr(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):!!(e=mr[e])&&!!t[e]}function gr(){return fr}var yr=Jt(p({},nr,{key:function(e){if(e.key){var t=hr[e.key]||e.key;if("Unidentified"!==t)return t}return"keypress"===e.type?13===(e=Kt(e))?"Enter":String.fromCharCode(e):"keydown"===e.type||"keyup"===e.type?pr[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:gr,charCode:function(e){return"keypress"===e.type?Kt(e):0},keyCode:function(e){return"keydown"===e.type||"keyup"===e.type?e.keyCode:0},which:function(e){return"keypress"===e.type?Kt(e):"keydown"===e.type||"keyup"===e.type?e.keyCode:0}})),_r=Jt(p({},sr,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0})),vr=Jt(p({},nr,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:gr})),xr=Jt(p({},tr,{propertyName:0,elapsedTime:0,pseudoElement:0})),br=Jt(p({},sr,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0})),wr=Jt(p({},tr,{newState:0,oldState:0})),jr=[9,13,27,32],Sr=Ut&&"CompositionEvent"in window,Tr=null;Ut&&"documentMode"in document&&(Tr=document.documentMode);var kr=Ut&&"TextEvent"in window&&!Tr,Ar=Ut&&(!Sr||Tr&&8<Tr&&11>=Tr),Cr=String.fromCharCode(32),Er=!1;function Nr(e,t){switch(e){case"keyup":return-1!==jr.indexOf(t.keyCode);case"keydown":return 229!==t.keyCode;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function Ir(e){return"object"===typeof(e=e.detail)&&"data"in e?e.data:null}var Pr=!1;var Mr={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Lr(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return"input"===t?!!Mr[e.type]:"textarea"===t}function Rr(e,t,r,n){Rt?Dt?Dt.push(n):Dt=[n]:Rt=n,0<(t=nd(t,"onChange")).length&&(r=new rr("onChange","change",null,r,n),e.push({event:r,listeners:t}))}var Dr=null,Fr=null;function Or(e){Yu(e,0)}function zr(e){if(mt(Qe(e)))return e}function Br(e,t){if("change"===e)return t}var Ur=!1;if(Ut){var Vr;if(Ut){var qr="oninput"in document;if(!qr){var Wr=document.createElement("div");Wr.setAttribute("oninput","return;"),qr="function"===typeof Wr.oninput}Vr=qr}else Vr=!1;Ur=Vr&&(!document.documentMode||9<document.documentMode)}function Hr(){Dr&&(Dr.detachEvent("onpropertychange",Gr),Fr=Dr=null)}function Gr(e){if("value"===e.propertyName&&zr(Fr)){var t=[];Rr(t,Fr,e,Lt(e)),zt(Or,t)}}function Zr(e,t,r){"focusin"===e?(Hr(),Fr=r,(Dr=t).attachEvent("onpropertychange",Gr)):"focusout"===e&&Hr()}function Kr(e){if("selectionchange"===e||"keyup"===e||"keydown"===e)return zr(Fr)}function Yr(e,t){if("click"===e)return zr(t)}function Xr(e,t){if("input"===e||"change"===e)return zr(t)}var Jr="function"===typeof Object.is?Object.is:function(e,t){return e===t&&(0!==e||1/e===1/t)||e!==e&&t!==t};function Qr(e,t){if(Jr(e,t))return!0;if("object"!==typeof e||null===e||"object"!==typeof t||null===t)return!1;var r=Object.keys(e),n=Object.keys(t);if(r.length!==n.length)return!1;for(n=0;n<r.length;n++){var i=r[n];if(!ne.call(t,i)||!Jr(e[i],t[i]))return!1}return!0}function $r(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function en(e,t){var r,n=$r(e);for(e=0;n;){if(3===n.nodeType){if(r=e+n.textContent.length,e<=t&&r>=t)return{node:n,offset:t-e};e=r}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=$r(n)}}function tn(e,t){return!(!e||!t)&&(e===t||(!e||3!==e.nodeType)&&(t&&3===t.nodeType?tn(e,t.parentNode):"contains"in e?e.contains(t):!!e.compareDocumentPosition&&!!(16&e.compareDocumentPosition(t))))}function rn(e){for(var t=ft((e=null!=e&&null!=e.ownerDocument&&null!=e.ownerDocument.defaultView?e.ownerDocument.defaultView:window).document);t instanceof e.HTMLIFrameElement;){try{var r="string"===typeof t.contentWindow.location.href}catch(n){r=!1}if(!r)break;t=ft((e=t.contentWindow).document)}return t}function nn(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&("input"===t&&("text"===e.type||"search"===e.type||"tel"===e.type||"url"===e.type||"password"===e.type)||"textarea"===t||"true"===e.contentEditable)}var sn=Ut&&"documentMode"in document&&11>=document.documentMode,on=null,an=null,ln=null,cn=!1;function un(e,t,r){var n=r.window===r?r.document:9===r.nodeType?r:r.ownerDocument;cn||null==on||on!==ft(n)||("selectionStart"in(n=on)&&nn(n)?n={start:n.selectionStart,end:n.selectionEnd}:n={anchorNode:(n=(n.ownerDocument&&n.ownerDocument.defaultView||window).getSelection()).anchorNode,anchorOffset:n.anchorOffset,focusNode:n.focusNode,focusOffset:n.focusOffset},ln&&Qr(ln,n)||(ln=n,0<(n=nd(an,"onSelect")).length&&(t=new rr("onSelect","select",null,t,r),e.push({event:t,listeners:n}),t.target=on)))}function dn(e,t){var r={};return r[e.toLowerCase()]=t.toLowerCase(),r["Webkit"+e]="webkit"+t,r["Moz"+e]="moz"+t,r}var hn={animationend:dn("Animation","AnimationEnd"),animationiteration:dn("Animation","AnimationIteration"),animationstart:dn("Animation","AnimationStart"),transitionrun:dn("Transition","TransitionRun"),transitionstart:dn("Transition","TransitionStart"),transitioncancel:dn("Transition","TransitionCancel"),transitionend:dn("Transition","TransitionEnd")},pn={},mn={};function fn(e){if(pn[e])return pn[e];if(!hn[e])return e;var t,r=hn[e];for(t in r)if(r.hasOwnProperty(t)&&t in mn)return pn[e]=r[t];return e}Ut&&(mn=document.createElement("div").style,"AnimationEvent"in window||(delete hn.animationend.animation,delete hn.animationiteration.animation,delete hn.animationstart.animation),"TransitionEvent"in window||delete hn.transitionend.transition);var gn=fn("animationend"),yn=fn("animationiteration"),_n=fn("animationstart"),vn=fn("transitionrun"),xn=fn("transitionstart"),bn=fn("transitioncancel"),wn=fn("transitionend"),jn=new Map,Sn="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function Tn(e,t){jn.set(e,t),nt(t,[e])}Sn.push("scrollEnd");var kn="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},An=[],Cn=0,En=0;function Nn(){for(var e=Cn,t=En=Cn=0;t<e;){var r=An[t];An[t++]=null;var n=An[t];An[t++]=null;var i=An[t];An[t++]=null;var s=An[t];if(An[t++]=null,null!==n&&null!==i){var o=n.pending;null===o?i.next=i:(i.next=o.next,o.next=i),n.pending=i}0!==s&&Ln(r,i,s)}}function In(e,t,r,n){An[Cn++]=e,An[Cn++]=t,An[Cn++]=r,An[Cn++]=n,En|=n,e.lanes|=n,null!==(e=e.alternate)&&(e.lanes|=n)}function Pn(e,t,r,n){return In(e,t,r,n),Rn(e)}function Mn(e,t){return In(e,null,null,t),Rn(e)}function Ln(e,t,r){e.lanes|=r;var n=e.alternate;null!==n&&(n.lanes|=r);for(var i=!1,s=e.return;null!==s;)s.childLanes|=r,null!==(n=s.alternate)&&(n.childLanes|=r),22===s.tag&&(null===(e=s.stateNode)||1&e._visibility||(i=!0)),e=s,s=s.return;return 3===e.tag?(s=e.stateNode,i&&null!==t&&(i=31-xe(r),null===(n=(e=s.hiddenUpdates)[i])?e[i]=[t]:n.push(t),t.lane=536870912|r),s):null}function Rn(e){if(50<Wc)throw Wc=0,Hc=null,Error(o(185));for(var t=e.return;null!==t;)t=(e=t).return;return 3===e.tag?e.stateNode:null}var Dn={};function Fn(e,t,r,n){this.tag=e,this.key=r,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=n,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function On(e,t,r,n){return new Fn(e,t,r,n)}function zn(e){return!(!(e=e.prototype)||!e.isReactComponent)}function Bn(e,t){var r=e.alternate;return null===r?((r=On(e.tag,t,e.key,e.mode)).elementType=e.elementType,r.type=e.type,r.stateNode=e.stateNode,r.alternate=e,e.alternate=r):(r.pendingProps=t,r.type=e.type,r.flags=0,r.subtreeFlags=0,r.deletions=null),r.flags=65011712&e.flags,r.childLanes=e.childLanes,r.lanes=e.lanes,r.child=e.child,r.memoizedProps=e.memoizedProps,r.memoizedState=e.memoizedState,r.updateQueue=e.updateQueue,t=e.dependencies,r.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext},r.sibling=e.sibling,r.index=e.index,r.ref=e.ref,r.refCleanup=e.refCleanup,r}function Un(e,t){e.flags&=65011714;var r=e.alternate;return null===r?(e.childLanes=0,e.lanes=t,e.child=null,e.subtreeFlags=0,e.memoizedProps=null,e.memoizedState=null,e.updateQueue=null,e.dependencies=null,e.stateNode=null):(e.childLanes=r.childLanes,e.lanes=r.lanes,e.child=r.child,e.subtreeFlags=0,e.deletions=null,e.memoizedProps=r.memoizedProps,e.memoizedState=r.memoizedState,e.updateQueue=r.updateQueue,e.type=r.type,t=r.dependencies,e.dependencies=null===t?null:{lanes:t.lanes,firstContext:t.firstContext}),e}function Vn(e,t,r,n,i,s){var a=0;if(n=e,"function"===typeof e)zn(e)&&(a=1);else if("string"===typeof e)a=function(e,t,r){if(1===r||null!=t.itemProp)return!1;switch(e){case"meta":case"title":return!0;case"style":if("string"!==typeof t.precedence||"string"!==typeof t.href||""===t.href)break;return!0;case"link":if("string"!==typeof t.rel||"string"!==typeof t.href||""===t.href||t.onLoad||t.onError)break;return"stylesheet"!==t.rel||(e=t.disabled,"string"===typeof t.precedence&&null==e);case"script":if(t.async&&"function"!==typeof t.async&&"symbol"!==typeof t.async&&!t.onLoad&&!t.onError&&t.src&&"string"===typeof t.src)return!0}return!1}(e,r,W.current)?26:"html"===e||"head"===e||"body"===e?27:5;else e:switch(e){case A:return(e=On(31,r,t,i)).elementType=A,e.lanes=s,e;case y:return qn(r.children,i,s,t);case _:a=8,i|=24;break;case v:return(e=On(12,r,t,2|i)).elementType=v,e.lanes=s,e;case j:return(e=On(13,r,t,i)).elementType=j,e.lanes=s,e;case S:return(e=On(19,r,t,i)).elementType=S,e.lanes=s,e;default:if("object"===typeof e&&null!==e)switch(e.$$typeof){case b:a=10;break e;case x:a=9;break e;case w:a=11;break e;case T:a=14;break e;case k:a=16,n=null;break e}a=29,r=Error(o(130,null===e?"null":typeof e,"")),n=null}return(t=On(a,r,t,i)).elementType=e,t.type=n,t.lanes=s,t}function qn(e,t,r,n){return(e=On(7,e,n,t)).lanes=r,e}function Wn(e,t,r){return(e=On(6,e,null,t)).lanes=r,e}function Hn(e){var t=On(18,null,null,0);return t.stateNode=e,t}function Gn(e,t,r){return(t=On(4,null!==e.children?e.children:[],e.key,t)).lanes=r,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}var Zn=new WeakMap;function Kn(e,t){if("object"===typeof e&&null!==e){var r=Zn.get(e);return void 0!==r?r:(t={value:e,source:t,stack:re(t)},Zn.set(e,t),t)}return{value:e,source:t,stack:re(t)}}var Yn=[],Xn=0,Jn=null,Qn=0,$n=[],ei=0,ti=null,ri=1,ni="";function ii(e,t){Yn[Xn++]=Qn,Yn[Xn++]=Jn,Jn=e,Qn=t}function si(e,t,r){$n[ei++]=ri,$n[ei++]=ni,$n[ei++]=ti,ti=e;var n=ri;e=ni;var i=32-xe(n)-1;n&=~(1<<i),r+=1;var s=32-xe(t)+i;if(30<s){var o=i-i%5;s=(n&(1<<o)-1).toString(32),n>>=o,i-=o,ri=1<<32-xe(t)+i|r<<i|n,ni=s+e}else ri=1<<s|r<<i|n,ni=e}function oi(e){null!==e.return&&(ii(e,1),si(e,1,0))}function ai(e){for(;e===Jn;)Jn=Yn[--Xn],Yn[Xn]=null,Qn=Yn[--Xn],Yn[Xn]=null;for(;e===ti;)ti=$n[--ei],$n[ei]=null,ni=$n[--ei],$n[ei]=null,ri=$n[--ei],$n[ei]=null}function li(e,t){$n[ei++]=ri,$n[ei++]=ni,$n[ei++]=ti,ri=t.id,ni=t.overflow,ti=e}var ci=null,ui=null,di=!1,hi=null,pi=!1,mi=Error(o(519));function fi(e){throw bi(Kn(Error(o(418,1<arguments.length&&void 0!==arguments[1]&&arguments[1]?"text":"HTML","")),e)),mi}function gi(e){var t=e.stateNode,r=e.type,n=e.memoizedProps;switch(t[Ue]=e,t[Ve]=n,r){case"dialog":Xu("cancel",t),Xu("close",t);break;case"iframe":case"object":case"embed":Xu("load",t);break;case"video":case"audio":for(r=0;r<Zu.length;r++)Xu(Zu[r],t);break;case"source":Xu("error",t);break;case"img":case"image":case"link":Xu("error",t),Xu("load",t);break;case"details":Xu("toggle",t);break;case"input":Xu("invalid",t),vt(t,n.value,n.defaultValue,n.checked,n.defaultChecked,n.type,n.name,!0);break;case"select":Xu("invalid",t);break;case"textarea":Xu("invalid",t),jt(t,n.value,n.defaultValue,n.children)}"string"!==typeof(r=n.children)&&"number"!==typeof r&&"bigint"!==typeof r||t.textContent===""+r||!0===n.suppressHydrationWarning||cd(t.textContent,r)?(null!=n.popover&&(Xu("beforetoggle",t),Xu("toggle",t)),null!=n.onScroll&&Xu("scroll",t),null!=n.onScrollEnd&&Xu("scrollend",t),null!=n.onClick&&(t.onclick=Pt),t=!0):t=!1,t||fi(e,!0)}function yi(e){for(ci=e.return;ci;)switch(ci.tag){case 5:case 31:case 13:return void(pi=!1);case 27:case 3:return void(pi=!0);default:ci=ci.return}}function _i(e){if(e!==ci)return!1;if(!di)return yi(e),di=!0,!1;var t,r=e.tag;if((t=3!==r&&27!==r)&&((t=5===r)&&(t=!("form"!==(t=e.type)&&"button"!==t)||vd(e.type,e.memoizedProps)),t=!t),t&&ui&&fi(e),yi(e),13===r){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));ui=Rd(e)}else if(31===r){if(!(e=null!==(e=e.memoizedState)?e.dehydrated:null))throw Error(o(317));ui=Rd(e)}else 27===r?(r=ui,kd(e.type)?(e=Ld,Ld=null,ui=e):ui=r):ui=ci?Md(e.stateNode.nextSibling):null;return!0}function vi(){ui=ci=null,di=!1}function xi(){var e=hi;return null!==e&&(null===Nc?Nc=e:Nc.push.apply(Nc,e),hi=null),e}function bi(e){null===hi?hi=[e]:hi.push(e)}var wi=z(null),ji=null,Si=null;function Ti(e,t,r){U(wi,t._currentValue),t._currentValue=r}function ki(e){e._currentValue=wi.current,B(wi)}function Ai(e,t,r){for(;null!==e;){var n=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,null!==n&&(n.childLanes|=t)):null!==n&&(n.childLanes&t)!==t&&(n.childLanes|=t),e===r)break;e=e.return}}function Ci(e,t,r,n){var i=e.child;for(null!==i&&(i.return=e);null!==i;){var s=i.dependencies;if(null!==s){var a=i.child;s=s.firstContext;e:for(;null!==s;){var l=s;s=i;for(var c=0;c<t.length;c++)if(l.context===t[c]){s.lanes|=r,null!==(l=s.alternate)&&(l.lanes|=r),Ai(s.return,r,e),n||(a=null);break e}s=l.next}}else if(18===i.tag){if(null===(a=i.return))throw Error(o(341));a.lanes|=r,null!==(s=a.alternate)&&(s.lanes|=r),Ai(a,r,e),a=null}else a=i.child;if(null!==a)a.return=i;else for(a=i;null!==a;){if(a===e){a=null;break}if(null!==(i=a.sibling)){i.return=a.return,a=i;break}a=a.return}i=a}}function Ei(e,t,r,n){e=null;for(var i=t,s=!1;null!==i;){if(!s)if(0!==(524288&i.flags))s=!0;else if(0!==(262144&i.flags))break;if(10===i.tag){var a=i.alternate;if(null===a)throw Error(o(387));if(null!==(a=a.memoizedProps)){var l=i.type;Jr(i.pendingProps.value,a.value)||(null!==e?e.push(l):e=[l])}}else if(i===Z.current){if(null===(a=i.alternate))throw Error(o(387));a.memoizedState.memoizedState!==i.memoizedState.memoizedState&&(null!==e?e.push(uh):e=[uh])}i=i.return}null!==e&&Ci(t,e,r,n),t.flags|=262144}function Ni(e){for(e=e.firstContext;null!==e;){if(!Jr(e.context._currentValue,e.memoizedValue))return!0;e=e.next}return!1}function Ii(e){ji=e,Si=null,null!==(e=e.dependencies)&&(e.firstContext=null)}function Pi(e){return Li(ji,e)}function Mi(e,t){return null===ji&&Ii(e),Li(e,t)}function Li(e,t){var r=t._currentValue;if(t={context:t,memoizedValue:r,next:null},null===Si){if(null===e)throw Error(o(308));Si=t,e.dependencies={lanes:0,firstContext:t},e.flags|=524288}else Si=Si.next=t;return r}var Ri="undefined"!==typeof AbortController?AbortController:function(){var e=[],t=this.signal={aborted:!1,addEventListener:function(t,r){e.push(r)}};this.abort=function(){t.aborted=!0,e.forEach(function(e){return e()})}},Di=n.unstable_scheduleCallback,Fi=n.unstable_NormalPriority,Oi={$$typeof:b,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function zi(){return{controller:new Ri,data:new Map,refCount:0}}function Bi(e){e.refCount--,0===e.refCount&&Di(Fi,function(){e.controller.abort()})}var Ui=null,Vi=0,qi=0,Wi=null;function Hi(){if(0===--Vi&&null!==Ui){null!==Wi&&(Wi.status="fulfilled");var e=Ui;Ui=null,qi=0,Wi=null;for(var t=0;t<e.length;t++)(0,e[t])()}}var Gi=L.S;L.S=function(e,t){Mc=le(),"object"===typeof t&&null!==t&&"function"===typeof t.then&&function(e,t){if(null===Ui){var r=Ui=[];Vi=0,qi=Vu(),Wi={status:"pending",value:void 0,then:function(e){r.push(e)}}}Vi++,t.then(Hi,Hi)}(0,t),null!==Gi&&Gi(e,t)};var Zi=z(null);function Ki(){var e=Zi.current;return null!==e?e:mc.pooledCache}function Yi(e,t){U(Zi,null===t?Zi.current:t.pool)}function Xi(){var e=Ki();return null===e?null:{parent:Oi._currentValue,pool:e}}var Ji=Error(o(460)),Qi=Error(o(474)),$i=Error(o(542)),es={then:function(){}};function ts(e){return"fulfilled"===(e=e.status)||"rejected"===e}function rs(e,t,r){switch(void 0===(r=e[r])?e.push(t):r!==t&&(t.then(Pt,Pt),t=r),t.status){case"fulfilled":return t.value;case"rejected":throw os(e=t.reason),e;default:if("string"===typeof t.status)t.then(Pt,Pt);else{if(null!==(e=mc)&&100<e.shellSuspendCounter)throw Error(o(482));(e=t).status="pending",e.then(function(e){if("pending"===t.status){var r=t;r.status="fulfilled",r.value=e}},function(e){if("pending"===t.status){var r=t;r.status="rejected",r.reason=e}})}switch(t.status){case"fulfilled":return t.value;case"rejected":throw os(e=t.reason),e}throw is=t,Ji}}function ns(e){try{return(0,e._init)(e._payload)}catch(t){if(null!==t&&"object"===typeof t&&"function"===typeof t.then)throw is=t,Ji;throw t}}var is=null;function ss(){if(null===is)throw Error(o(459));var e=is;return is=null,e}function os(e){if(e===Ji||e===$i)throw Error(o(483))}var as=null,ls=0;function cs(e){var t=ls;return ls+=1,null===as&&(as=[]),rs(as,e,t)}function us(e,t){t=t.props.ref,e.ref=void 0!==t?t:null}function ds(e,t){if(t.$$typeof===m)throw Error(o(525));throw e=Object.prototype.toString.call(t),Error(o(31,"[object Object]"===e?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function hs(e){function t(t,r){if(e){var n=t.deletions;null===n?(t.deletions=[r],t.flags|=16):n.push(r)}}function r(r,n){if(!e)return null;for(;null!==n;)t(r,n),n=n.sibling;return null}function n(e){for(var t=new Map;null!==e;)null!==e.key?t.set(e.key,e):t.set(e.index,e),e=e.sibling;return t}function i(e,t){return(e=Bn(e,t)).index=0,e.sibling=null,e}function s(t,r,n){return t.index=n,e?null!==(n=t.alternate)?(n=n.index)<r?(t.flags|=67108866,r):n:(t.flags|=67108866,r):(t.flags|=1048576,r)}function a(t){return e&&null===t.alternate&&(t.flags|=67108866),t}function l(e,t,r,n){return null===t||6!==t.tag?((t=Wn(r,e.mode,n)).return=e,t):((t=i(t,r)).return=e,t)}function c(e,t,r,n){var s=r.type;return s===y?d(e,t,r.props.children,n,r.key):null!==t&&(t.elementType===s||"object"===typeof s&&null!==s&&s.$$typeof===k&&ns(s)===t.type)?(us(t=i(t,r.props),r),t.return=e,t):(us(t=Vn(r.type,r.key,r.props,null,e.mode,n),r),t.return=e,t)}function u(e,t,r,n){return null===t||4!==t.tag||t.stateNode.containerInfo!==r.containerInfo||t.stateNode.implementation!==r.implementation?((t=Gn(r,e.mode,n)).return=e,t):((t=i(t,r.children||[])).return=e,t)}function d(e,t,r,n,s){return null===t||7!==t.tag?((t=qn(r,e.mode,n,s)).return=e,t):((t=i(t,r)).return=e,t)}function h(e,t,r){if("string"===typeof t&&""!==t||"number"===typeof t||"bigint"===typeof t)return(t=Wn(""+t,e.mode,r)).return=e,t;if("object"===typeof t&&null!==t){switch(t.$$typeof){case f:return us(r=Vn(t.type,t.key,t.props,null,e.mode,r),t),r.return=e,r;case g:return(t=Gn(t,e.mode,r)).return=e,t;case k:return h(e,t=ns(t),r)}if(M(t)||N(t))return(t=qn(t,e.mode,r,null)).return=e,t;if("function"===typeof t.then)return h(e,cs(t),r);if(t.$$typeof===b)return h(e,Mi(e,t),r);ds(e,t)}return null}function p(e,t,r,n){var i=null!==t?t.key:null;if("string"===typeof r&&""!==r||"number"===typeof r||"bigint"===typeof r)return null!==i?null:l(e,t,""+r,n);if("object"===typeof r&&null!==r){switch(r.$$typeof){case f:return r.key===i?c(e,t,r,n):null;case g:return r.key===i?u(e,t,r,n):null;case k:return p(e,t,r=ns(r),n)}if(M(r)||N(r))return null!==i?null:d(e,t,r,n,null);if("function"===typeof r.then)return p(e,t,cs(r),n);if(r.$$typeof===b)return p(e,t,Mi(e,r),n);ds(e,r)}return null}function m(e,t,r,n,i){if("string"===typeof n&&""!==n||"number"===typeof n||"bigint"===typeof n)return l(t,e=e.get(r)||null,""+n,i);if("object"===typeof n&&null!==n){switch(n.$$typeof){case f:return c(t,e=e.get(null===n.key?r:n.key)||null,n,i);case g:return u(t,e=e.get(null===n.key?r:n.key)||null,n,i);case k:return m(e,t,r,n=ns(n),i)}if(M(n)||N(n))return d(t,e=e.get(r)||null,n,i,null);if("function"===typeof n.then)return m(e,t,r,cs(n),i);if(n.$$typeof===b)return m(e,t,r,Mi(t,n),i);ds(t,n)}return null}function _(l,c,u,d){if("object"===typeof u&&null!==u&&u.type===y&&null===u.key&&(u=u.props.children),"object"===typeof u&&null!==u){switch(u.$$typeof){case f:e:{for(var v=u.key;null!==c;){if(c.key===v){if((v=u.type)===y){if(7===c.tag){r(l,c.sibling),(d=i(c,u.props.children)).return=l,l=d;break e}}else if(c.elementType===v||"object"===typeof v&&null!==v&&v.$$typeof===k&&ns(v)===c.type){r(l,c.sibling),us(d=i(c,u.props),u),d.return=l,l=d;break e}r(l,c);break}t(l,c),c=c.sibling}u.type===y?((d=qn(u.props.children,l.mode,d,u.key)).return=l,l=d):(us(d=Vn(u.type,u.key,u.props,null,l.mode,d),u),d.return=l,l=d)}return a(l);case g:e:{for(v=u.key;null!==c;){if(c.key===v){if(4===c.tag&&c.stateNode.containerInfo===u.containerInfo&&c.stateNode.implementation===u.implementation){r(l,c.sibling),(d=i(c,u.children||[])).return=l,l=d;break e}r(l,c);break}t(l,c),c=c.sibling}(d=Gn(u,l.mode,d)).return=l,l=d}return a(l);case k:return _(l,c,u=ns(u),d)}if(M(u))return function(i,o,a,l){for(var c=null,u=null,d=o,f=o=0,g=null;null!==d&&f<a.length;f++){d.index>f?(g=d,d=null):g=d.sibling;var y=p(i,d,a[f],l);if(null===y){null===d&&(d=g);break}e&&d&&null===y.alternate&&t(i,d),o=s(y,o,f),null===u?c=y:u.sibling=y,u=y,d=g}if(f===a.length)return r(i,d),di&&ii(i,f),c;if(null===d){for(;f<a.length;f++)null!==(d=h(i,a[f],l))&&(o=s(d,o,f),null===u?c=d:u.sibling=d,u=d);return di&&ii(i,f),c}for(d=n(d);f<a.length;f++)null!==(g=m(d,i,f,a[f],l))&&(e&&null!==g.alternate&&d.delete(null===g.key?f:g.key),o=s(g,o,f),null===u?c=g:u.sibling=g,u=g);return e&&d.forEach(function(e){return t(i,e)}),di&&ii(i,f),c}(l,c,u,d);if(N(u)){if("function"!==typeof(v=N(u)))throw Error(o(150));return function(i,a,l,c){if(null==l)throw Error(o(151));for(var u=null,d=null,f=a,g=a=0,y=null,_=l.next();null!==f&&!_.done;g++,_=l.next()){f.index>g?(y=f,f=null):y=f.sibling;var v=p(i,f,_.value,c);if(null===v){null===f&&(f=y);break}e&&f&&null===v.alternate&&t(i,f),a=s(v,a,g),null===d?u=v:d.sibling=v,d=v,f=y}if(_.done)return r(i,f),di&&ii(i,g),u;if(null===f){for(;!_.done;g++,_=l.next())null!==(_=h(i,_.value,c))&&(a=s(_,a,g),null===d?u=_:d.sibling=_,d=_);return di&&ii(i,g),u}for(f=n(f);!_.done;g++,_=l.next())null!==(_=m(f,i,g,_.value,c))&&(e&&null!==_.alternate&&f.delete(null===_.key?g:_.key),a=s(_,a,g),null===d?u=_:d.sibling=_,d=_);return e&&f.forEach(function(e){return t(i,e)}),di&&ii(i,g),u}(l,c,u=v.call(u),d)}if("function"===typeof u.then)return _(l,c,cs(u),d);if(u.$$typeof===b)return _(l,c,Mi(l,u),d);ds(l,u)}return"string"===typeof u&&""!==u||"number"===typeof u||"bigint"===typeof u?(u=""+u,null!==c&&6===c.tag?(r(l,c.sibling),(d=i(c,u)).return=l,l=d):(r(l,c),(d=Wn(u,l.mode,d)).return=l,l=d),a(l)):r(l,c)}return function(e,t,r,n){try{ls=0;var i=_(e,t,r,n);return as=null,i}catch(o){if(o===Ji||o===$i)throw o;var s=On(29,o,null,e.mode);return s.lanes=n,s.return=e,s}}}var ps=hs(!0),ms=hs(!1),fs=!1;function gs(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function ys(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,callbacks:null})}function _s(e){return{lane:e,tag:0,payload:null,callback:null,next:null}}function vs(e,t,r){var n=e.updateQueue;if(null===n)return null;if(n=n.shared,0!==(2&pc)){var i=n.pending;return null===i?t.next=t:(t.next=i.next,i.next=t),n.pending=t,t=Rn(e),Ln(e,null,r),t}return In(e,n,t,r),Rn(e)}function xs(e,t,r){if(null!==(t=t.updateQueue)&&(t=t.shared,0!==(4194048&r))){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,Le(e,r)}}function bs(e,t){var r=e.updateQueue,n=e.alternate;if(null!==n&&r===(n=n.updateQueue)){var i=null,s=null;if(null!==(r=r.firstBaseUpdate)){do{var o={lane:r.lane,tag:r.tag,payload:r.payload,callback:null,next:null};null===s?i=s=o:s=s.next=o,r=r.next}while(null!==r);null===s?i=s=t:s=s.next=t}else i=s=t;return r={baseState:n.baseState,firstBaseUpdate:i,lastBaseUpdate:s,shared:n.shared,callbacks:n.callbacks},void(e.updateQueue=r)}null===(e=r.lastBaseUpdate)?r.firstBaseUpdate=t:e.next=t,r.lastBaseUpdate=t}var ws=!1;function js(){if(ws){if(null!==Wi)throw Wi}}function Ss(e,t,r,n){ws=!1;var i=e.updateQueue;fs=!1;var s=i.firstBaseUpdate,o=i.lastBaseUpdate,a=i.shared.pending;if(null!==a){i.shared.pending=null;var l=a,c=l.next;l.next=null,null===o?s=c:o.next=c,o=l;var u=e.alternate;null!==u&&((a=(u=u.updateQueue).lastBaseUpdate)!==o&&(null===a?u.firstBaseUpdate=c:a.next=c,u.lastBaseUpdate=l))}if(null!==s){var d=i.baseState;for(o=0,u=c=l=null,a=s;;){var h=-536870913&a.lane,m=h!==a.lane;if(m?(gc&h)===h:(n&h)===h){0!==h&&h===qi&&(ws=!0),null!==u&&(u=u.next={lane:0,tag:a.tag,payload:a.payload,callback:null,next:null});e:{var f=e,g=a;h=t;var y=r;switch(g.tag){case 1:if("function"===typeof(f=g.payload)){d=f.call(y,d,h);break e}d=f;break e;case 3:f.flags=-65537&f.flags|128;case 0:if(null===(h="function"===typeof(f=g.payload)?f.call(y,d,h):f)||void 0===h)break e;d=p({},d,h);break e;case 2:fs=!0}}null!==(h=a.callback)&&(e.flags|=64,m&&(e.flags|=8192),null===(m=i.callbacks)?i.callbacks=[h]:m.push(h))}else m={lane:h,tag:a.tag,payload:a.payload,callback:a.callback,next:null},null===u?(c=u=m,l=d):u=u.next=m,o|=h;if(null===(a=a.next)){if(null===(a=i.shared.pending))break;a=(m=a).next,m.next=null,i.lastBaseUpdate=m,i.shared.pending=null}}null===u&&(l=d),i.baseState=l,i.firstBaseUpdate=c,i.lastBaseUpdate=u,null===s&&(i.shared.lanes=0),Sc|=o,e.lanes=o,e.memoizedState=d}}function Ts(e,t){if("function"!==typeof e)throw Error(o(191,e));e.call(t)}function ks(e,t){var r=e.callbacks;if(null!==r)for(e.callbacks=null,e=0;e<r.length;e++)Ts(r[e],t)}var As=z(null),Cs=z(0);function Es(e,t){U(Cs,e=wc),U(As,t),wc=e|t.baseLanes}function Ns(){U(Cs,wc),U(As,As.current)}function Is(){wc=Cs.current,B(As),B(Cs)}var Ps=z(null),Ms=null;function Ls(e){var t=e.alternate;U(zs,1&zs.current),U(Ps,e),null===Ms&&(null===t||null!==As.current||null!==t.memoizedState)&&(Ms=e)}function Rs(e){U(zs,zs.current),U(Ps,e),null===Ms&&(Ms=e)}function Ds(e){22===e.tag?(U(zs,zs.current),U(Ps,e),null===Ms&&(Ms=e)):Fs()}function Fs(){U(zs,zs.current),U(Ps,Ps.current)}function Os(e){B(Ps),Ms===e&&(Ms=null),B(zs)}var zs=z(0);function Bs(e){for(var t=e;null!==t;){if(13===t.tag){var r=t.memoizedState;if(null!==r&&(null===(r=r.dehydrated)||Id(r)||Pd(r)))return t}else if(19!==t.tag||"forwards"!==t.memoizedProps.revealOrder&&"backwards"!==t.memoizedProps.revealOrder&&"unstable_legacy-backwards"!==t.memoizedProps.revealOrder&&"together"!==t.memoizedProps.revealOrder){if(null!==t.child){t.child.return=t,t=t.child;continue}}else if(0!==(128&t.flags))return t;if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var Us=0,Vs=null,qs=null,Ws=null,Hs=!1,Gs=!1,Zs=!1,Ks=0,Ys=0,Xs=null,Js=0;function Qs(){throw Error(o(321))}function $s(e,t){if(null===t)return!1;for(var r=0;r<t.length&&r<e.length;r++)if(!Jr(e[r],t[r]))return!1;return!0}function eo(e,t,r,n,i,s){return Us=s,Vs=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,L.H=null===e||null===e.memoizedState?ga:ya,Zs=!1,s=r(n,i),Zs=!1,Gs&&(s=ro(t,r,n,i)),to(e),s}function to(e){L.H=fa;var t=null!==qs&&null!==qs.next;if(Us=0,Ws=qs=Vs=null,Hs=!1,Ys=0,Xs=null,t)throw Error(o(300));null===e||Ma||null!==(e=e.dependencies)&&Ni(e)&&(Ma=!0)}function ro(e,t,r,n){Vs=e;var i=0;do{if(Gs&&(Xs=null),Ys=0,Gs=!1,25<=i)throw Error(o(301));if(i+=1,Ws=qs=null,null!=e.updateQueue){var s=e.updateQueue;s.lastEffect=null,s.events=null,s.stores=null,null!=s.memoCache&&(s.memoCache.index=0)}L.H=_a,s=t(r,n)}while(Gs);return s}function no(){var e=L.H,t=e.useState()[0];return t="function"===typeof t.then?co(t):t,e=e.useState()[0],(null!==qs?qs.memoizedState:null)!==e&&(Vs.flags|=1024),t}function io(){var e=0!==Ks;return Ks=0,e}function so(e,t,r){t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~r}function oo(e){if(Hs){for(e=e.memoizedState;null!==e;){var t=e.queue;null!==t&&(t.pending=null),e=e.next}Hs=!1}Us=0,Ws=qs=Vs=null,Gs=!1,Ys=Ks=0,Xs=null}function ao(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return null===Ws?Vs.memoizedState=Ws=e:Ws=Ws.next=e,Ws}function lo(){if(null===qs){var e=Vs.alternate;e=null!==e?e.memoizedState:null}else e=qs.next;var t=null===Ws?Vs.memoizedState:Ws.next;if(null!==t)Ws=t,qs=e;else{if(null===e){if(null===Vs.alternate)throw Error(o(467));throw Error(o(310))}e={memoizedState:(qs=e).memoizedState,baseState:qs.baseState,baseQueue:qs.baseQueue,queue:qs.queue,next:null},null===Ws?Vs.memoizedState=Ws=e:Ws=Ws.next=e}return Ws}function co(e){var t=Ys;return Ys+=1,null===Xs&&(Xs=[]),e=rs(Xs,e,t),t=Vs,null===(null===Ws?t.memoizedState:Ws.next)&&(t=t.alternate,L.H=null===t||null===t.memoizedState?ga:ya),e}function uo(e){if(null!==e&&"object"===typeof e){if("function"===typeof e.then)return co(e);if(e.$$typeof===b)return Pi(e)}throw Error(o(438,String(e)))}function ho(e){var t=null,r=Vs.updateQueue;if(null!==r&&(t=r.memoCache),null==t){var n=Vs.alternate;null!==n&&(null!==(n=n.updateQueue)&&(null!=(n=n.memoCache)&&(t={data:n.data.map(function(e){return e.slice()}),index:0})))}if(null==t&&(t={data:[],index:0}),null===r&&(r={lastEffect:null,events:null,stores:null,memoCache:null},Vs.updateQueue=r),r.memoCache=t,void 0===(r=t.data[t.index]))for(r=t.data[t.index]=Array(e),n=0;n<e;n++)r[n]=C;return t.index++,r}function po(e,t){return"function"===typeof t?t(e):t}function mo(e){return fo(lo(),qs,e)}function fo(e,t,r){var n=e.queue;if(null===n)throw Error(o(311));n.lastRenderedReducer=r;var i=e.baseQueue,s=n.pending;if(null!==s){if(null!==i){var a=i.next;i.next=s.next,s.next=a}t.baseQueue=i=s,n.pending=null}if(s=e.baseState,null===i)e.memoizedState=s;else{var l=a=null,c=null,u=t=i.next,d=!1;do{var h=-536870913&u.lane;if(h!==u.lane?(gc&h)===h:(Us&h)===h){var p=u.revertLane;if(0===p)null!==c&&(c=c.next={lane:0,revertLane:0,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null}),h===qi&&(d=!0);else{if((Us&p)===p){u=u.next,p===qi&&(d=!0);continue}h={lane:0,revertLane:u.revertLane,gesture:null,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=h,a=s):c=c.next=h,Vs.lanes|=p,Sc|=p}h=u.action,Zs&&r(s,h),s=u.hasEagerState?u.eagerState:r(s,h)}else p={lane:h,revertLane:u.revertLane,gesture:u.gesture,action:u.action,hasEagerState:u.hasEagerState,eagerState:u.eagerState,next:null},null===c?(l=c=p,a=s):c=c.next=p,Vs.lanes|=h,Sc|=h;u=u.next}while(null!==u&&u!==t);if(null===c?a=s:c.next=l,!Jr(s,e.memoizedState)&&(Ma=!0,d&&null!==(r=Wi)))throw r;e.memoizedState=s,e.baseState=a,e.baseQueue=c,n.lastRenderedState=s}return null===i&&(n.lanes=0),[e.memoizedState,n.dispatch]}function go(e){var t=lo(),r=t.queue;if(null===r)throw Error(o(311));r.lastRenderedReducer=e;var n=r.dispatch,i=r.pending,s=t.memoizedState;if(null!==i){r.pending=null;var a=i=i.next;do{s=e(s,a.action),a=a.next}while(a!==i);Jr(s,t.memoizedState)||(Ma=!0),t.memoizedState=s,null===t.baseQueue&&(t.baseState=s),r.lastRenderedState=s}return[s,n]}function yo(e,t,r){var n=Vs,i=lo(),s=di;if(s){if(void 0===r)throw Error(o(407));r=r()}else r=t();var a=!Jr((qs||i).memoizedState,r);if(a&&(i.memoizedState=r,Ma=!0),i=i.queue,Vo(xo.bind(null,n,i,e),[e]),i.getSnapshot!==t||a||null!==Ws&&1&Ws.memoizedState.tag){if(n.flags|=2048,Fo(9,{destroy:void 0},vo.bind(null,n,i,r,t),null),null===mc)throw Error(o(349));s||0!==(127&Us)||_o(n,t,r)}return r}function _o(e,t,r){e.flags|=16384,e={getSnapshot:t,value:r},null===(t=Vs.updateQueue)?(t={lastEffect:null,events:null,stores:null,memoCache:null},Vs.updateQueue=t,t.stores=[e]):null===(r=t.stores)?t.stores=[e]:r.push(e)}function vo(e,t,r,n){t.value=r,t.getSnapshot=n,bo(t)&&wo(e)}function xo(e,t,r){return r(function(){bo(t)&&wo(e)})}function bo(e){var t=e.getSnapshot;e=e.value;try{var r=t();return!Jr(e,r)}catch(n){return!0}}function wo(e){var t=Mn(e,2);null!==t&&Kc(t,e,2)}function jo(e){var t=ao();if("function"===typeof e){var r=e;if(e=r(),Zs){ve(!0);try{r()}finally{ve(!1)}}}return t.memoizedState=t.baseState=e,t.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:e},t}function So(e,t,r,n){return e.baseState=r,fo(e,qs,"function"===typeof n?n:po)}function To(e,t,r,n,i){if(ha(e))throw Error(o(485));if(null!==(e=t.action)){var s={payload:i,action:e,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(e){s.listeners.push(e)}};null!==L.T?r(!0):s.isTransition=!1,n(s),null===(r=t.pending)?(s.next=t.pending=s,ko(t,s)):(s.next=r.next,t.pending=r.next=s)}}function ko(e,t){var r=t.action,n=t.payload,i=e.state;if(t.isTransition){var s=L.T,o={};L.T=o;try{var a=r(i,n),l=L.S;null!==l&&l(o,a),Ao(e,t,a)}catch(c){Eo(e,t,c)}finally{null!==s&&null!==o.types&&(s.types=o.types),L.T=s}}else try{Ao(e,t,s=r(i,n))}catch(u){Eo(e,t,u)}}function Ao(e,t,r){null!==r&&"object"===typeof r&&"function"===typeof r.then?r.then(function(r){Co(e,t,r)},function(r){return Eo(e,t,r)}):Co(e,t,r)}function Co(e,t,r){t.status="fulfilled",t.value=r,No(t),e.state=r,null!==(t=e.pending)&&((r=t.next)===t?e.pending=null:(r=r.next,t.next=r,ko(e,r)))}function Eo(e,t,r){var n=e.pending;if(e.pending=null,null!==n){n=n.next;do{t.status="rejected",t.reason=r,No(t),t=t.next}while(t!==n)}e.action=null}function No(e){e=e.listeners;for(var t=0;t<e.length;t++)(0,e[t])()}function Io(e,t){return t}function Po(e,t){if(di){var r=mc.formState;if(null!==r){e:{var n=Vs;if(di){if(ui){t:{for(var i=ui,s=pi;8!==i.nodeType;){if(!s){i=null;break t}if(null===(i=Md(i.nextSibling))){i=null;break t}}i="F!"===(s=i.data)||"F"===s?i:null}if(i){ui=Md(i.nextSibling),n="F!"===i.data;break e}}fi(n)}n=!1}n&&(t=r[0])}}return(r=ao()).memoizedState=r.baseState=t,n={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Io,lastRenderedState:t},r.queue=n,r=ca.bind(null,Vs,n),n.dispatch=r,n=jo(!1),s=da.bind(null,Vs,!1,n.queue),i={state:t,dispatch:null,action:e,pending:null},(n=ao()).queue=i,r=To.bind(null,Vs,i,s,r),i.dispatch=r,n.memoizedState=e,[t,r,!1]}function Mo(e){return Lo(lo(),qs,e)}function Lo(e,t,r){if(t=fo(e,t,Io)[0],e=mo(po)[0],"object"===typeof t&&null!==t&&"function"===typeof t.then)try{var n=co(t)}catch(o){if(o===Ji)throw $i;throw o}else n=t;var i=(t=lo()).queue,s=i.dispatch;return r!==t.memoizedState&&(Vs.flags|=2048,Fo(9,{destroy:void 0},Ro.bind(null,i,r),null)),[n,s,e]}function Ro(e,t){e.action=t}function Do(e){var t=lo(),r=qs;if(null!==r)return Lo(t,r,e);lo(),t=t.memoizedState;var n=(r=lo()).queue.dispatch;return r.memoizedState=e,[t,n,!1]}function Fo(e,t,r,n){return e={tag:e,create:r,deps:n,inst:t,next:null},null===(t=Vs.updateQueue)&&(t={lastEffect:null,events:null,stores:null,memoCache:null},Vs.updateQueue=t),null===(r=t.lastEffect)?t.lastEffect=e.next=e:(n=r.next,r.next=e,e.next=n,t.lastEffect=e),e}function Oo(){return lo().memoizedState}function zo(e,t,r,n){var i=ao();Vs.flags|=e,i.memoizedState=Fo(1|t,{destroy:void 0},r,void 0===n?null:n)}function Bo(e,t,r,n){var i=lo();n=void 0===n?null:n;var s=i.memoizedState.inst;null!==qs&&null!==n&&$s(n,qs.memoizedState.deps)?i.memoizedState=Fo(t,s,r,n):(Vs.flags|=e,i.memoizedState=Fo(1|t,s,r,n))}function Uo(e,t){zo(8390656,8,e,t)}function Vo(e,t){Bo(2048,8,e,t)}function qo(e){var t=lo().memoizedState;return function(e){Vs.flags|=4;var t=Vs.updateQueue;if(null===t)t={lastEffect:null,events:null,stores:null,memoCache:null},Vs.updateQueue=t,t.events=[e];else{var r=t.events;null===r?t.events=[e]:r.push(e)}}({ref:t,nextImpl:e}),function(){if(0!==(2&pc))throw Error(o(440));return t.impl.apply(void 0,arguments)}}function Wo(e,t){return Bo(4,2,e,t)}function Ho(e,t){return Bo(4,4,e,t)}function Go(e,t){if("function"===typeof t){e=e();var r=t(e);return function(){"function"===typeof r?r():t(null)}}if(null!==t&&void 0!==t)return e=e(),t.current=e,function(){t.current=null}}function Zo(e,t,r){r=null!==r&&void 0!==r?r.concat([e]):null,Bo(4,4,Go.bind(null,t,e),r)}function Ko(){}function Yo(e,t){var r=lo();t=void 0===t?null:t;var n=r.memoizedState;return null!==t&&$s(t,n[1])?n[0]:(r.memoizedState=[e,t],e)}function Xo(e,t){var r=lo();t=void 0===t?null:t;var n=r.memoizedState;if(null!==t&&$s(t,n[1]))return n[0];if(n=e(),Zs){ve(!0);try{e()}finally{ve(!1)}}return r.memoizedState=[n,t],n}function Jo(e,t,r){return void 0===r||0!==(1073741824&Us)&&0===(261930&gc)?e.memoizedState=t:(e.memoizedState=r,e=Zc(),Vs.lanes|=e,Sc|=e,r)}function Qo(e,t,r,n){return Jr(r,t)?r:null!==As.current?(e=Jo(e,r,n),Jr(e,t)||(Ma=!0),e):0===(42&Us)||0!==(1073741824&Us)&&0===(261930&gc)?(Ma=!0,e.memoizedState=r):(e=Zc(),Vs.lanes|=e,Sc|=e,t)}function $o(e,t,r,n,i){var s=R.p;R.p=0!==s&&8>s?s:8;var o=L.T,a={};L.T=a,da(e,!1,t,r);try{var l=i(),c=L.S;if(null!==c&&c(a,l),null!==l&&"object"===typeof l&&"function"===typeof l.then)ua(e,t,function(e,t){var r=[],n={status:"pending",value:null,reason:null,then:function(e){r.push(e)}};return e.then(function(){n.status="fulfilled",n.value=t;for(var e=0;e<r.length;e++)(0,r[e])(t)},function(e){for(n.status="rejected",n.reason=e,e=0;e<r.length;e++)(0,r[e])(void 0)}),n}(l,n),Gc());else ua(e,t,n,Gc())}catch(u){ua(e,t,{then:function(){},status:"rejected",reason:u},Gc())}finally{R.p=s,null!==o&&null!==a.types&&(o.types=a.types),L.T=o}}function ea(){}function ta(e,t,r,n){if(5!==e.tag)throw Error(o(476));var i=ra(e).queue;$o(e,i,t,D,null===r?ea:function(){return na(e),r(n)})}function ra(e){var t=e.memoizedState;if(null!==t)return t;var r={};return(t={memoizedState:D,baseState:D,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:D},next:null}).next={memoizedState:r,baseState:r,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:po,lastRenderedState:r},next:null},e.memoizedState=t,null!==(e=e.alternate)&&(e.memoizedState=t),t}function na(e){var t=ra(e);null===t.next&&(t=e.alternate.memoizedState),ua(e,t.next.queue,{},Gc())}function ia(){return Pi(uh)}function sa(){return lo().memoizedState}function oa(){return lo().memoizedState}function aa(e){for(var t=e.return;null!==t;){switch(t.tag){case 24:case 3:var r=Gc(),n=vs(t,e=_s(r),r);return null!==n&&(Kc(n,t,r),xs(n,t,r)),t={cache:zi()},void(e.payload=t)}t=t.return}}function la(e,t,r){var n=Gc();r={lane:n,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null},ha(e)?pa(t,r):null!==(r=Pn(e,t,r,n))&&(Kc(r,e,n),ma(r,t,n))}function ca(e,t,r){ua(e,t,r,Gc())}function ua(e,t,r,n){var i={lane:n,revertLane:0,gesture:null,action:r,hasEagerState:!1,eagerState:null,next:null};if(ha(e))pa(t,i);else{var s=e.alternate;if(0===e.lanes&&(null===s||0===s.lanes)&&null!==(s=t.lastRenderedReducer))try{var o=t.lastRenderedState,a=s(o,r);if(i.hasEagerState=!0,i.eagerState=a,Jr(a,o))return In(e,t,i,0),null===mc&&Nn(),!1}catch(l){}if(null!==(r=Pn(e,t,i,n)))return Kc(r,e,n),ma(r,t,n),!0}return!1}function da(e,t,r,n){if(n={lane:2,revertLane:Vu(),gesture:null,action:n,hasEagerState:!1,eagerState:null,next:null},ha(e)){if(t)throw Error(o(479))}else null!==(t=Pn(e,r,n,2))&&Kc(t,e,2)}function ha(e){var t=e.alternate;return e===Vs||null!==t&&t===Vs}function pa(e,t){Gs=Hs=!0;var r=e.pending;null===r?t.next=t:(t.next=r.next,r.next=t),e.pending=t}function ma(e,t,r){if(0!==(4194048&r)){var n=t.lanes;r|=n&=e.pendingLanes,t.lanes=r,Le(e,r)}}var fa={readContext:Pi,use:uo,useCallback:Qs,useContext:Qs,useEffect:Qs,useImperativeHandle:Qs,useLayoutEffect:Qs,useInsertionEffect:Qs,useMemo:Qs,useReducer:Qs,useRef:Qs,useState:Qs,useDebugValue:Qs,useDeferredValue:Qs,useTransition:Qs,useSyncExternalStore:Qs,useId:Qs,useHostTransitionStatus:Qs,useFormState:Qs,useActionState:Qs,useOptimistic:Qs,useMemoCache:Qs,useCacheRefresh:Qs};fa.useEffectEvent=Qs;var ga={readContext:Pi,use:uo,useCallback:function(e,t){return ao().memoizedState=[e,void 0===t?null:t],e},useContext:Pi,useEffect:Uo,useImperativeHandle:function(e,t,r){r=null!==r&&void 0!==r?r.concat([e]):null,zo(4194308,4,Go.bind(null,t,e),r)},useLayoutEffect:function(e,t){return zo(4194308,4,e,t)},useInsertionEffect:function(e,t){zo(4,2,e,t)},useMemo:function(e,t){var r=ao();t=void 0===t?null:t;var n=e();if(Zs){ve(!0);try{e()}finally{ve(!1)}}return r.memoizedState=[n,t],n},useReducer:function(e,t,r){var n=ao();if(void 0!==r){var i=r(t);if(Zs){ve(!0);try{r(t)}finally{ve(!1)}}}else i=t;return n.memoizedState=n.baseState=i,e={pending:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:i},n.queue=e,e=e.dispatch=la.bind(null,Vs,e),[n.memoizedState,e]},useRef:function(e){return e={current:e},ao().memoizedState=e},useState:function(e){var t=(e=jo(e)).queue,r=ca.bind(null,Vs,t);return t.dispatch=r,[e.memoizedState,r]},useDebugValue:Ko,useDeferredValue:function(e,t){return Jo(ao(),e,t)},useTransition:function(){var e=jo(!1);return e=$o.bind(null,Vs,e.queue,!0,!1),ao().memoizedState=e,[!1,e]},useSyncExternalStore:function(e,t,r){var n=Vs,i=ao();if(di){if(void 0===r)throw Error(o(407));r=r()}else{if(r=t(),null===mc)throw Error(o(349));0!==(127&gc)||_o(n,t,r)}i.memoizedState=r;var s={value:r,getSnapshot:t};return i.queue=s,Uo(xo.bind(null,n,s,e),[e]),n.flags|=2048,Fo(9,{destroy:void 0},vo.bind(null,n,s,r,t),null),r},useId:function(){var e=ao(),t=mc.identifierPrefix;if(di){var r=ni;t="_"+t+"R_"+(r=(ri&~(1<<32-xe(ri)-1)).toString(32)+r),0<(r=Ks++)&&(t+="H"+r.toString(32)),t+="_"}else t="_"+t+"r_"+(r=Js++).toString(32)+"_";return e.memoizedState=t},useHostTransitionStatus:ia,useFormState:Po,useActionState:Po,useOptimistic:function(e){var t=ao();t.memoizedState=t.baseState=e;var r={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return t.queue=r,t=da.bind(null,Vs,!0,r),r.dispatch=t,[e,t]},useMemoCache:ho,useCacheRefresh:function(){return ao().memoizedState=aa.bind(null,Vs)},useEffectEvent:function(e){var t=ao(),r={impl:e};return t.memoizedState=r,function(){if(0!==(2&pc))throw Error(o(440));return r.impl.apply(void 0,arguments)}}},ya={readContext:Pi,use:uo,useCallback:Yo,useContext:Pi,useEffect:Vo,useImperativeHandle:Zo,useInsertionEffect:Wo,useLayoutEffect:Ho,useMemo:Xo,useReducer:mo,useRef:Oo,useState:function(){return mo(po)},useDebugValue:Ko,useDeferredValue:function(e,t){return Qo(lo(),qs.memoizedState,e,t)},useTransition:function(){var e=mo(po)[0],t=lo().memoizedState;return["boolean"===typeof e?e:co(e),t]},useSyncExternalStore:yo,useId:sa,useHostTransitionStatus:ia,useFormState:Mo,useActionState:Mo,useOptimistic:function(e,t){return So(lo(),0,e,t)},useMemoCache:ho,useCacheRefresh:oa};ya.useEffectEvent=qo;var _a={readContext:Pi,use:uo,useCallback:Yo,useContext:Pi,useEffect:Vo,useImperativeHandle:Zo,useInsertionEffect:Wo,useLayoutEffect:Ho,useMemo:Xo,useReducer:go,useRef:Oo,useState:function(){return go(po)},useDebugValue:Ko,useDeferredValue:function(e,t){var r=lo();return null===qs?Jo(r,e,t):Qo(r,qs.memoizedState,e,t)},useTransition:function(){var e=go(po)[0],t=lo().memoizedState;return["boolean"===typeof e?e:co(e),t]},useSyncExternalStore:yo,useId:sa,useHostTransitionStatus:ia,useFormState:Do,useActionState:Do,useOptimistic:function(e,t){var r=lo();return null!==qs?So(r,0,e,t):(r.baseState=e,[e,r.queue.dispatch])},useMemoCache:ho,useCacheRefresh:oa};function va(e,t,r,n){r=null===(r=r(n,t=e.memoizedState))||void 0===r?t:p({},t,r),e.memoizedState=r,0===e.lanes&&(e.updateQueue.baseState=r)}_a.useEffectEvent=qo;var xa={enqueueSetState:function(e,t,r){e=e._reactInternals;var n=Gc(),i=_s(n);i.payload=t,void 0!==r&&null!==r&&(i.callback=r),null!==(t=vs(e,i,n))&&(Kc(t,e,n),xs(t,e,n))},enqueueReplaceState:function(e,t,r){e=e._reactInternals;var n=Gc(),i=_s(n);i.tag=1,i.payload=t,void 0!==r&&null!==r&&(i.callback=r),null!==(t=vs(e,i,n))&&(Kc(t,e,n),xs(t,e,n))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var r=Gc(),n=_s(r);n.tag=2,void 0!==t&&null!==t&&(n.callback=t),null!==(t=vs(e,n,r))&&(Kc(t,e,r),xs(t,e,r))}};function ba(e,t,r,n,i,s,o){return"function"===typeof(e=e.stateNode).shouldComponentUpdate?e.shouldComponentUpdate(n,s,o):!t.prototype||!t.prototype.isPureReactComponent||(!Qr(r,n)||!Qr(i,s))}function wa(e,t,r,n){e=t.state,"function"===typeof t.componentWillReceiveProps&&t.componentWillReceiveProps(r,n),"function"===typeof t.UNSAFE_componentWillReceiveProps&&t.UNSAFE_componentWillReceiveProps(r,n),t.state!==e&&xa.enqueueReplaceState(t,t.state,null)}function ja(e,t){var r=t;if("ref"in t)for(var n in r={},t)"ref"!==n&&(r[n]=t[n]);if(e=e.defaultProps)for(var i in r===t&&(r=p({},r)),e)void 0===r[i]&&(r[i]=e[i]);return r}function Sa(e){kn(e)}function Ta(e){console.error(e)}function ka(e){kn(e)}function Aa(e,t){try{(0,e.onUncaughtError)(t.value,{componentStack:t.stack})}catch(r){setTimeout(function(){throw r})}}function Ca(e,t,r){try{(0,e.onCaughtError)(r.value,{componentStack:r.stack,errorBoundary:1===t.tag?t.stateNode:null})}catch(n){setTimeout(function(){throw n})}}function Ea(e,t,r){return(r=_s(r)).tag=3,r.payload={element:null},r.callback=function(){Aa(e,t)},r}function Na(e){return(e=_s(e)).tag=3,e}function Ia(e,t,r,n){var i=r.type.getDerivedStateFromError;if("function"===typeof i){var s=n.value;e.payload=function(){return i(s)},e.callback=function(){Ca(t,r,n)}}var o=r.stateNode;null!==o&&"function"===typeof o.componentDidCatch&&(e.callback=function(){Ca(t,r,n),"function"!==typeof i&&(null===Dc?Dc=new Set([this]):Dc.add(this));var e=n.stack;this.componentDidCatch(n.value,{componentStack:null!==e?e:""})})}var Pa=Error(o(461)),Ma=!1;function La(e,t,r,n){t.child=null===e?ms(t,null,r,n):ps(t,e.child,r,n)}function Ra(e,t,r,n,i){r=r.render;var s=t.ref;if("ref"in n){var o={};for(var a in n)"ref"!==a&&(o[a]=n[a])}else o=n;return Ii(t),n=eo(e,t,r,o,s,i),a=io(),null===e||Ma?(di&&a&&oi(t),t.flags|=1,La(e,t,n,i),t.child):(so(e,t,i),il(e,t,i))}function Da(e,t,r,n,i){if(null===e){var s=r.type;return"function"!==typeof s||zn(s)||void 0!==s.defaultProps||null!==r.compare?((e=Vn(r.type,null,n,t,t.mode,i)).ref=t.ref,e.return=t,t.child=e):(t.tag=15,t.type=s,Fa(e,t,s,n,i))}if(s=e.child,!sl(e,i)){var o=s.memoizedProps;if((r=null!==(r=r.compare)?r:Qr)(o,n)&&e.ref===t.ref)return il(e,t,i)}return t.flags|=1,(e=Bn(s,n)).ref=t.ref,e.return=t,t.child=e}function Fa(e,t,r,n,i){if(null!==e){var s=e.memoizedProps;if(Qr(s,n)&&e.ref===t.ref){if(Ma=!1,t.pendingProps=n=s,!sl(e,i))return t.lanes=e.lanes,il(e,t,i);0!==(131072&e.flags)&&(Ma=!0)}}return Wa(e,t,r,n,i)}function Oa(e,t,r,n){var i=n.children,s=null!==e?e.memoizedState:null;if(null===e&&null===t.stateNode&&(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),"hidden"===n.mode){if(0!==(128&t.flags)){if(s=null!==s?s.baseLanes|r:r,null!==e){for(n=t.child=e.child,i=0;null!==n;)i=i|n.lanes|n.childLanes,n=n.sibling;n=i&~s}else n=0,t.child=null;return Ba(e,t,s,r,n)}if(0===(536870912&r))return n=t.lanes=536870912,Ba(e,t,null!==s?s.baseLanes|r:r,r,n);t.memoizedState={baseLanes:0,cachePool:null},null!==e&&Yi(0,null!==s?s.cachePool:null),null!==s?Es(t,s):Ns(),Ds(t)}else null!==s?(Yi(0,s.cachePool),Es(t,s),Fs(),t.memoizedState=null):(null!==e&&Yi(0,null),Ns(),Fs());return La(e,t,i,r),t.child}function za(e,t){return null!==e&&22===e.tag||null!==t.stateNode||(t.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null}),t.sibling}function Ba(e,t,r,n,i){var s=Ki();return s=null===s?null:{parent:Oi._currentValue,pool:s},t.memoizedState={baseLanes:r,cachePool:s},null!==e&&Yi(0,null),Ns(),Ds(t),null!==e&&Ei(e,t,n,!0),t.childLanes=i,null}function Ua(e,t){return(t=$a({mode:t.mode,children:t.children},e.mode)).ref=e.ref,e.child=t,t.return=e,t}function Va(e,t,r){return ps(t,e.child,null,r),(e=Ua(t,t.pendingProps)).flags|=2,Os(t),t.memoizedState=null,e}function qa(e,t){var r=t.ref;if(null===r)null!==e&&null!==e.ref&&(t.flags|=4194816);else{if("function"!==typeof r&&"object"!==typeof r)throw Error(o(284));null!==e&&e.ref===r||(t.flags|=4194816)}}function Wa(e,t,r,n,i){return Ii(t),r=eo(e,t,r,n,void 0,i),n=io(),null===e||Ma?(di&&n&&oi(t),t.flags|=1,La(e,t,r,i),t.child):(so(e,t,i),il(e,t,i))}function Ha(e,t,r,n,i,s){return Ii(t),t.updateQueue=null,r=ro(t,n,r,i),to(e),n=io(),null===e||Ma?(di&&n&&oi(t),t.flags|=1,La(e,t,r,s),t.child):(so(e,t,s),il(e,t,s))}function Ga(e,t,r,n,i){if(Ii(t),null===t.stateNode){var s=Dn,o=r.contextType;"object"===typeof o&&null!==o&&(s=Pi(o)),s=new r(n,s),t.memoizedState=null!==s.state&&void 0!==s.state?s.state:null,s.updater=xa,t.stateNode=s,s._reactInternals=t,(s=t.stateNode).props=n,s.state=t.memoizedState,s.refs={},gs(t),o=r.contextType,s.context="object"===typeof o&&null!==o?Pi(o):Dn,s.state=t.memoizedState,"function"===typeof(o=r.getDerivedStateFromProps)&&(va(t,r,o,n),s.state=t.memoizedState),"function"===typeof r.getDerivedStateFromProps||"function"===typeof s.getSnapshotBeforeUpdate||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||(o=s.state,"function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount(),o!==s.state&&xa.enqueueReplaceState(s,s.state,null),Ss(t,n,s,i),js(),s.state=t.memoizedState),"function"===typeof s.componentDidMount&&(t.flags|=4194308),n=!0}else if(null===e){s=t.stateNode;var a=t.memoizedProps,l=ja(r,a);s.props=l;var c=s.context,u=r.contextType;o=Dn,"object"===typeof u&&null!==u&&(o=Pi(u));var d=r.getDerivedStateFromProps;u="function"===typeof d||"function"===typeof s.getSnapshotBeforeUpdate,a=t.pendingProps!==a,u||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(a||c!==o)&&wa(t,s,n,o),fs=!1;var h=t.memoizedState;s.state=h,Ss(t,n,s,i),js(),c=t.memoizedState,a||h!==c||fs?("function"===typeof d&&(va(t,r,d,n),c=t.memoizedState),(l=fs||ba(t,r,l,n,h,c,o))?(u||"function"!==typeof s.UNSAFE_componentWillMount&&"function"!==typeof s.componentWillMount||("function"===typeof s.componentWillMount&&s.componentWillMount(),"function"===typeof s.UNSAFE_componentWillMount&&s.UNSAFE_componentWillMount()),"function"===typeof s.componentDidMount&&(t.flags|=4194308)):("function"===typeof s.componentDidMount&&(t.flags|=4194308),t.memoizedProps=n,t.memoizedState=c),s.props=n,s.state=c,s.context=o,n=l):("function"===typeof s.componentDidMount&&(t.flags|=4194308),n=!1)}else{s=t.stateNode,ys(e,t),u=ja(r,o=t.memoizedProps),s.props=u,d=t.pendingProps,h=s.context,c=r.contextType,l=Dn,"object"===typeof c&&null!==c&&(l=Pi(c)),(c="function"===typeof(a=r.getDerivedStateFromProps)||"function"===typeof s.getSnapshotBeforeUpdate)||"function"!==typeof s.UNSAFE_componentWillReceiveProps&&"function"!==typeof s.componentWillReceiveProps||(o!==d||h!==l)&&wa(t,s,n,l),fs=!1,h=t.memoizedState,s.state=h,Ss(t,n,s,i),js();var p=t.memoizedState;o!==d||h!==p||fs||null!==e&&null!==e.dependencies&&Ni(e.dependencies)?("function"===typeof a&&(va(t,r,a,n),p=t.memoizedState),(u=fs||ba(t,r,u,n,h,p,l)||null!==e&&null!==e.dependencies&&Ni(e.dependencies))?(c||"function"!==typeof s.UNSAFE_componentWillUpdate&&"function"!==typeof s.componentWillUpdate||("function"===typeof s.componentWillUpdate&&s.componentWillUpdate(n,p,l),"function"===typeof s.UNSAFE_componentWillUpdate&&s.UNSAFE_componentWillUpdate(n,p,l)),"function"===typeof s.componentDidUpdate&&(t.flags|=4),"function"===typeof s.getSnapshotBeforeUpdate&&(t.flags|=1024)):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),t.memoizedProps=n,t.memoizedState=p),s.props=n,s.state=p,s.context=l,n=u):("function"!==typeof s.componentDidUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=4),"function"!==typeof s.getSnapshotBeforeUpdate||o===e.memoizedProps&&h===e.memoizedState||(t.flags|=1024),n=!1)}return s=n,qa(e,t),n=0!==(128&t.flags),s||n?(s=t.stateNode,r=n&&"function"!==typeof r.getDerivedStateFromError?null:s.render(),t.flags|=1,null!==e&&n?(t.child=ps(t,e.child,null,i),t.child=ps(t,null,r,i)):La(e,t,r,i),t.memoizedState=s.state,e=t.child):e=il(e,t,i),e}function Za(e,t,r,n){return vi(),t.flags|=256,La(e,t,r,n),t.child}var Ka={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Ya(e){return{baseLanes:e,cachePool:Xi()}}function Xa(e,t,r){return e=null!==e?e.childLanes&~r:0,t&&(e|=Ac),e}function Ja(e,t,r){var n,i=t.pendingProps,s=!1,a=0!==(128&t.flags);if((n=a)||(n=(null===e||null!==e.memoizedState)&&0!==(2&zs.current)),n&&(s=!0,t.flags&=-129),n=0!==(32&t.flags),t.flags&=-33,null===e){if(di){if(s?Ls(t):Fs(),(e=ui)?null!==(e=null!==(e=Nd(e,pi))&&"&"!==e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ti?{id:ri,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},(r=Hn(e)).return=t,t.child=r,ci=t,ui=null):e=null,null===e)throw fi(t);return Pd(e)?t.lanes=32:t.lanes=536870912,null}var l=i.children;return i=i.fallback,s?(Fs(),l=$a({mode:"hidden",children:l},s=t.mode),i=qn(i,s,r,null),l.return=t,i.return=t,l.sibling=i,t.child=l,(i=t.child).memoizedState=Ya(r),i.childLanes=Xa(e,n,r),t.memoizedState=Ka,za(null,i)):(Ls(t),Qa(t,l))}var c=e.memoizedState;if(null!==c&&null!==(l=c.dehydrated)){if(a)256&t.flags?(Ls(t),t.flags&=-257,t=el(e,t,r)):null!==t.memoizedState?(Fs(),t.child=e.child,t.flags|=128,t=null):(Fs(),l=i.fallback,s=t.mode,i=$a({mode:"visible",children:i.children},s),(l=qn(l,s,r,null)).flags|=2,i.return=t,l.return=t,i.sibling=l,t.child=i,ps(t,e.child,null,r),(i=t.child).memoizedState=Ya(r),i.childLanes=Xa(e,n,r),t.memoizedState=Ka,t=za(null,i));else if(Ls(t),Pd(l)){if(n=l.nextSibling&&l.nextSibling.dataset)var u=n.dgst;n=u,(i=Error(o(419))).stack="",i.digest=n,bi({value:i,source:null,stack:null}),t=el(e,t,r)}else if(Ma||Ei(e,t,r,!1),n=0!==(r&e.childLanes),Ma||n){if(null!==(n=mc)&&(0!==(i=Re(n,r))&&i!==c.retryLane))throw c.retryLane=i,Mn(e,i),Kc(n,e,i),Pa;Id(l)||ou(),t=el(e,t,r)}else Id(l)?(t.flags|=192,t.child=e.child,t=null):(e=c.treeContext,ui=Md(l.nextSibling),ci=t,di=!0,hi=null,pi=!1,null!==e&&li(t,e),(t=Qa(t,i.children)).flags|=4096);return t}return s?(Fs(),l=i.fallback,s=t.mode,u=(c=e.child).sibling,(i=Bn(c,{mode:"hidden",children:i.children})).subtreeFlags=65011712&c.subtreeFlags,null!==u?l=Bn(u,l):(l=qn(l,s,r,null)).flags|=2,l.return=t,i.return=t,i.sibling=l,t.child=i,za(null,i),i=t.child,null===(l=e.child.memoizedState)?l=Ya(r):(null!==(s=l.cachePool)?(c=Oi._currentValue,s=s.parent!==c?{parent:c,pool:c}:s):s=Xi(),l={baseLanes:l.baseLanes|r,cachePool:s}),i.memoizedState=l,i.childLanes=Xa(e,n,r),t.memoizedState=Ka,za(e.child,i)):(Ls(t),e=(r=e.child).sibling,(r=Bn(r,{mode:"visible",children:i.children})).return=t,r.sibling=null,null!==e&&(null===(n=t.deletions)?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=r,t.memoizedState=null,r)}function Qa(e,t){return(t=$a({mode:"visible",children:t},e.mode)).return=e,e.child=t}function $a(e,t){return(e=On(22,e,null,t)).lanes=0,e}function el(e,t,r){return ps(t,e.child,null,r),(e=Qa(t,t.pendingProps.children)).flags|=2,t.memoizedState=null,e}function tl(e,t,r){e.lanes|=t;var n=e.alternate;null!==n&&(n.lanes|=t),Ai(e.return,t,r)}function rl(e,t,r,n,i,s){var o=e.memoizedState;null===o?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:n,tail:r,tailMode:i,treeForkCount:s}:(o.isBackwards=t,o.rendering=null,o.renderingStartTime=0,o.last=n,o.tail=r,o.tailMode=i,o.treeForkCount=s)}function nl(e,t,r){var n=t.pendingProps,i=n.revealOrder,s=n.tail;n=n.children;var o=zs.current,a=0!==(2&o);if(a?(o=1&o|2,t.flags|=128):o&=1,U(zs,o),La(e,t,n,r),n=di?Qn:0,!a&&null!==e&&0!==(128&e.flags))e:for(e=t.child;null!==e;){if(13===e.tag)null!==e.memoizedState&&tl(e,r,t);else if(19===e.tag)tl(e,r,t);else if(null!==e.child){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;null===e.sibling;){if(null===e.return||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}switch(i){case"forwards":for(r=t.child,i=null;null!==r;)null!==(e=r.alternate)&&null===Bs(e)&&(i=r),r=r.sibling;null===(r=i)?(i=t.child,t.child=null):(i=r.sibling,r.sibling=null),rl(t,!1,i,r,s,n);break;case"backwards":case"unstable_legacy-backwards":for(r=null,i=t.child,t.child=null;null!==i;){if(null!==(e=i.alternate)&&null===Bs(e)){t.child=i;break}e=i.sibling,i.sibling=r,r=i,i=e}rl(t,!0,r,null,s,n);break;case"together":rl(t,!1,null,null,void 0,n);break;default:t.memoizedState=null}return t.child}function il(e,t,r){if(null!==e&&(t.dependencies=e.dependencies),Sc|=t.lanes,0===(r&t.childLanes)){if(null===e)return null;if(Ei(e,t,r,!1),0===(r&t.childLanes))return null}if(null!==e&&t.child!==e.child)throw Error(o(153));if(null!==t.child){for(r=Bn(e=t.child,e.pendingProps),t.child=r,r.return=t;null!==e.sibling;)e=e.sibling,(r=r.sibling=Bn(e,e.pendingProps)).return=t;r.sibling=null}return t.child}function sl(e,t){return 0!==(e.lanes&t)||!(null===(e=e.dependencies)||!Ni(e))}function ol(e,t,r){if(null!==e)if(e.memoizedProps!==t.pendingProps)Ma=!0;else{if(!sl(e,r)&&0===(128&t.flags))return Ma=!1,function(e,t,r){switch(t.tag){case 3:K(t,t.stateNode.containerInfo),Ti(0,Oi,e.memoizedState.cache),vi();break;case 27:case 5:X(t);break;case 4:K(t,t.stateNode.containerInfo);break;case 10:Ti(0,t.type,t.memoizedProps.value);break;case 31:if(null!==t.memoizedState)return t.flags|=128,Rs(t),null;break;case 13:var n=t.memoizedState;if(null!==n)return null!==n.dehydrated?(Ls(t),t.flags|=128,null):0!==(r&t.child.childLanes)?Ja(e,t,r):(Ls(t),null!==(e=il(e,t,r))?e.sibling:null);Ls(t);break;case 19:var i=0!==(128&e.flags);if((n=0!==(r&t.childLanes))||(Ei(e,t,r,!1),n=0!==(r&t.childLanes)),i){if(n)return nl(e,t,r);t.flags|=128}if(null!==(i=t.memoizedState)&&(i.rendering=null,i.tail=null,i.lastEffect=null),U(zs,zs.current),n)break;return null;case 22:return t.lanes=0,Oa(e,t,r,t.pendingProps);case 24:Ti(0,Oi,e.memoizedState.cache)}return il(e,t,r)}(e,t,r);Ma=0!==(131072&e.flags)}else Ma=!1,di&&0!==(1048576&t.flags)&&si(t,Qn,t.index);switch(t.lanes=0,t.tag){case 16:e:{var n=t.pendingProps;if(e=ns(t.elementType),t.type=e,"function"!==typeof e){if(void 0!==e&&null!==e){var i=e.$$typeof;if(i===w){t.tag=11,t=Ra(null,t,e,n,r);break e}if(i===T){t.tag=14,t=Da(null,t,e,n,r);break e}}throw t=P(e)||e,Error(o(306,t,""))}zn(e)?(n=ja(e,n),t.tag=1,t=Ga(null,t,e,n,r)):(t.tag=0,t=Wa(null,t,e,n,r))}return t;case 0:return Wa(e,t,t.type,t.pendingProps,r);case 1:return Ga(e,t,n=t.type,i=ja(n,t.pendingProps),r);case 3:e:{if(K(t,t.stateNode.containerInfo),null===e)throw Error(o(387));n=t.pendingProps;var s=t.memoizedState;i=s.element,ys(e,t),Ss(t,n,null,r);var a=t.memoizedState;if(n=a.cache,Ti(0,Oi,n),n!==s.cache&&Ci(t,[Oi],r,!0),js(),n=a.element,s.isDehydrated){if(s={element:n,isDehydrated:!1,cache:a.cache},t.updateQueue.baseState=s,t.memoizedState=s,256&t.flags){t=Za(e,t,n,r);break e}if(n!==i){bi(i=Kn(Error(o(424)),t)),t=Za(e,t,n,r);break e}if(9===(e=t.stateNode.containerInfo).nodeType)e=e.body;else e="HTML"===e.nodeName?e.ownerDocument.body:e;for(ui=Md(e.firstChild),ci=t,di=!0,hi=null,pi=!0,r=ms(t,null,n,r),t.child=r;r;)r.flags=-3&r.flags|4096,r=r.sibling}else{if(vi(),n===i){t=il(e,t,r);break e}La(e,t,n,r)}t=t.child}return t;case 26:return qa(e,t),null===e?(r=Hd(t.type,null,t.pendingProps,null))?t.memoizedState=r:di||(r=t.type,e=t.pendingProps,(n=gd(G.current).createElement(r))[Ue]=t,n[Ve]=e,hd(n,r,e),et(n),t.stateNode=n):t.memoizedState=Hd(t.type,e.memoizedProps,t.pendingProps,e.memoizedState),null;case 27:return X(t),null===e&&di&&(n=t.stateNode=Fd(t.type,t.pendingProps,G.current),ci=t,pi=!0,i=ui,kd(t.type)?(Ld=i,ui=Md(n.firstChild)):ui=i),La(e,t,t.pendingProps.children,r),qa(e,t),null===e&&(t.flags|=4194304),t.child;case 5:return null===e&&di&&((i=n=ui)&&(null!==(n=function(e,t,r,n){for(;1===e.nodeType;){var i=r;if(e.nodeName.toLowerCase()!==t.toLowerCase()){if(!n&&("INPUT"!==e.nodeName||"hidden"!==e.type))break}else if(n){if(!e[Ke])switch(t){case"meta":if(!e.hasAttribute("itemprop"))break;return e;case"link":if("stylesheet"===(s=e.getAttribute("rel"))&&e.hasAttribute("data-precedence"))break;if(s!==i.rel||e.getAttribute("href")!==(null==i.href||""===i.href?null:i.href)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin)||e.getAttribute("title")!==(null==i.title?null:i.title))break;return e;case"style":if(e.hasAttribute("data-precedence"))break;return e;case"script":if(((s=e.getAttribute("src"))!==(null==i.src?null:i.src)||e.getAttribute("type")!==(null==i.type?null:i.type)||e.getAttribute("crossorigin")!==(null==i.crossOrigin?null:i.crossOrigin))&&s&&e.hasAttribute("async")&&!e.hasAttribute("itemprop"))break;return e;default:return e}}else{if("input"!==t||"hidden"!==e.type)return e;var s=null==i.name?null:""+i.name;if("hidden"===i.type&&e.getAttribute("name")===s)return e}if(null===(e=Md(e.nextSibling)))break}return null}(n,t.type,t.pendingProps,pi))?(t.stateNode=n,ci=t,ui=Md(n.firstChild),pi=!1,i=!0):i=!1),i||fi(t)),X(t),i=t.type,s=t.pendingProps,a=null!==e?e.memoizedProps:null,n=s.children,vd(i,s)?n=null:null!==a&&vd(i,a)&&(t.flags|=32),null!==t.memoizedState&&(i=eo(e,t,no,null,null,r),uh._currentValue=i),qa(e,t),La(e,t,n,r),t.child;case 6:return null===e&&di&&((e=r=ui)&&(null!==(r=function(e,t,r){if(""===t)return null;for(;3!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!r)return null;if(null===(e=Md(e.nextSibling)))return null}return e}(r,t.pendingProps,pi))?(t.stateNode=r,ci=t,ui=null,e=!0):e=!1),e||fi(t)),null;case 13:return Ja(e,t,r);case 4:return K(t,t.stateNode.containerInfo),n=t.pendingProps,null===e?t.child=ps(t,null,n,r):La(e,t,n,r),t.child;case 11:return Ra(e,t,t.type,t.pendingProps,r);case 7:return La(e,t,t.pendingProps,r),t.child;case 8:case 12:return La(e,t,t.pendingProps.children,r),t.child;case 10:return n=t.pendingProps,Ti(0,t.type,n.value),La(e,t,n.children,r),t.child;case 9:return i=t.type._context,n=t.pendingProps.children,Ii(t),n=n(i=Pi(i)),t.flags|=1,La(e,t,n,r),t.child;case 14:return Da(e,t,t.type,t.pendingProps,r);case 15:return Fa(e,t,t.type,t.pendingProps,r);case 19:return nl(e,t,r);case 31:return function(e,t,r){var n=t.pendingProps,i=0!==(128&t.flags);if(t.flags&=-129,null===e){if(di){if("hidden"===n.mode)return e=Ua(t,n),t.lanes=536870912,za(null,e);if(Rs(t),(e=ui)?null!==(e=null!==(e=Nd(e,pi))&&"&"===e.data?e:null)&&(t.memoizedState={dehydrated:e,treeContext:null!==ti?{id:ri,overflow:ni}:null,retryLane:536870912,hydrationErrors:null},(r=Hn(e)).return=t,t.child=r,ci=t,ui=null):e=null,null===e)throw fi(t);return t.lanes=536870912,null}return Ua(t,n)}var s=e.memoizedState;if(null!==s){var a=s.dehydrated;if(Rs(t),i)if(256&t.flags)t.flags&=-257,t=Va(e,t,r);else{if(null===t.memoizedState)throw Error(o(558));t.child=e.child,t.flags|=128,t=null}else if(Ma||Ei(e,t,r,!1),i=0!==(r&e.childLanes),Ma||i){if(null!==(n=mc)&&0!==(a=Re(n,r))&&a!==s.retryLane)throw s.retryLane=a,Mn(e,a),Kc(n,e,a),Pa;ou(),t=Va(e,t,r)}else e=s.treeContext,ui=Md(a.nextSibling),ci=t,di=!0,hi=null,pi=!1,null!==e&&li(t,e),(t=Ua(t,n)).flags|=4096;return t}return(e=Bn(e.child,{mode:n.mode,children:n.children})).ref=t.ref,t.child=e,e.return=t,e}(e,t,r);case 22:return Oa(e,t,r,t.pendingProps);case 24:return Ii(t),n=Pi(Oi),null===e?(null===(i=Ki())&&(i=mc,s=zi(),i.pooledCache=s,s.refCount++,null!==s&&(i.pooledCacheLanes|=r),i=s),t.memoizedState={parent:n,cache:i},gs(t),Ti(0,Oi,i)):(0!==(e.lanes&r)&&(ys(e,t),Ss(t,null,null,r),js()),i=e.memoizedState,s=t.memoizedState,i.parent!==n?(i={parent:n,cache:n},t.memoizedState=i,0===t.lanes&&(t.memoizedState=t.updateQueue.baseState=i),Ti(0,Oi,n)):(n=s.cache,Ti(0,Oi,n),n!==i.cache&&Ci(t,[Oi],r,!0))),La(e,t,t.pendingProps.children,r),t.child;case 29:throw t.pendingProps}throw Error(o(156,t.tag))}function al(e){e.flags|=4}function ll(e,t,r,n,i){if((t=0!==(32&e.mode))&&(t=!1),t){if(e.flags|=16777216,(335544128&i)===i)if(e.stateNode.complete)e.flags|=8192;else{if(!nu())throw is=es,Qi;e.flags|=8192}}else e.flags&=-16777217}function cl(e,t){if("stylesheet"!==t.type||0!==(4&t.state.loading))e.flags&=-16777217;else if(e.flags|=16777216,!ih(t)){if(!nu())throw is=es,Qi;e.flags|=8192}}function ul(e,t){null!==t&&(e.flags|=4),16384&e.flags&&(t=22!==e.tag?Ne():536870912,e.lanes|=t,Cc|=t)}function dl(e,t){if(!di)switch(e.tailMode){case"hidden":t=e.tail;for(var r=null;null!==t;)null!==t.alternate&&(r=t),t=t.sibling;null===r?e.tail=null:r.sibling=null;break;case"collapsed":r=e.tail;for(var n=null;null!==r;)null!==r.alternate&&(n=r),r=r.sibling;null===n?t||null===e.tail?e.tail=null:e.tail.sibling=null:n.sibling=null}}function hl(e){var t=null!==e.alternate&&e.alternate.child===e.child,r=0,n=0;if(t)for(var i=e.child;null!==i;)r|=i.lanes|i.childLanes,n|=65011712&i.subtreeFlags,n|=65011712&i.flags,i.return=e,i=i.sibling;else for(i=e.child;null!==i;)r|=i.lanes|i.childLanes,n|=i.subtreeFlags,n|=i.flags,i.return=e,i=i.sibling;return e.subtreeFlags|=n,e.childLanes=r,t}function pl(e,t,r){var n=t.pendingProps;switch(ai(t),t.tag){case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:case 1:return hl(t),null;case 3:return r=t.stateNode,n=null,null!==e&&(n=e.memoizedState.cache),t.memoizedState.cache!==n&&(t.flags|=2048),ki(Oi),Y(),r.pendingContext&&(r.context=r.pendingContext,r.pendingContext=null),null!==e&&null!==e.child||(_i(t)?al(t):null===e||e.memoizedState.isDehydrated&&0===(256&t.flags)||(t.flags|=1024,xi())),hl(t),null;case 26:var i=t.type,s=t.memoizedState;return null===e?(al(t),null!==s?(hl(t),cl(t,s)):(hl(t),ll(t,i,0,0,r))):s?s!==e.memoizedState?(al(t),hl(t),cl(t,s)):(hl(t),t.flags&=-16777217):((e=e.memoizedProps)!==n&&al(t),hl(t),ll(t,i,0,0,r)),null;case 27:if(J(t),r=G.current,i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==n&&al(t);else{if(!n){if(null===t.stateNode)throw Error(o(166));return hl(t),null}e=W.current,_i(t)?gi(t):(e=Fd(i,n,r),t.stateNode=e,al(t))}return hl(t),null;case 5:if(J(t),i=t.type,null!==e&&null!=t.stateNode)e.memoizedProps!==n&&al(t);else{if(!n){if(null===t.stateNode)throw Error(o(166));return hl(t),null}if(s=W.current,_i(t))gi(t);else{var a=gd(G.current);switch(s){case 1:s=a.createElementNS("http://www.w3.org/2000/svg",i);break;case 2:s=a.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;default:switch(i){case"svg":s=a.createElementNS("http://www.w3.org/2000/svg",i);break;case"math":s=a.createElementNS("http://www.w3.org/1998/Math/MathML",i);break;case"script":(s=a.createElement("div")).innerHTML="<script><\/script>",s=s.removeChild(s.firstChild);break;case"select":s="string"===typeof n.is?a.createElement("select",{is:n.is}):a.createElement("select"),n.multiple?s.multiple=!0:n.size&&(s.size=n.size);break;default:s="string"===typeof n.is?a.createElement(i,{is:n.is}):a.createElement(i)}}s[Ue]=t,s[Ve]=n;e:for(a=t.child;null!==a;){if(5===a.tag||6===a.tag)s.appendChild(a.stateNode);else if(4!==a.tag&&27!==a.tag&&null!==a.child){a.child.return=a,a=a.child;continue}if(a===t)break e;for(;null===a.sibling;){if(null===a.return||a.return===t)break e;a=a.return}a.sibling.return=a.return,a=a.sibling}t.stateNode=s;e:switch(hd(s,i,n),i){case"button":case"input":case"select":case"textarea":n=!!n.autoFocus;break e;case"img":n=!0;break e;default:n=!1}n&&al(t)}}return hl(t),ll(t,t.type,null===e||e.memoizedProps,t.pendingProps,r),null;case 6:if(e&&null!=t.stateNode)e.memoizedProps!==n&&al(t);else{if("string"!==typeof n&&null===t.stateNode)throw Error(o(166));if(e=G.current,_i(t)){if(e=t.stateNode,r=t.memoizedProps,n=null,null!==(i=ci))switch(i.tag){case 27:case 5:n=i.memoizedProps}e[Ue]=t,(e=!!(e.nodeValue===r||null!==n&&!0===n.suppressHydrationWarning||cd(e.nodeValue,r)))||fi(t,!0)}else(e=gd(e).createTextNode(n))[Ue]=t,t.stateNode=e}return hl(t),null;case 31:if(r=t.memoizedState,null===e||null!==e.memoizedState){if(n=_i(t),null!==r){if(null===e){if(!n)throw Error(o(318));if(!(e=null!==(e=t.memoizedState)?e.dehydrated:null))throw Error(o(557));e[Ue]=t}else vi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;hl(t),e=!1}else r=xi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=r),e=!0;if(!e)return 256&t.flags?(Os(t),t):(Os(t),null);if(0!==(128&t.flags))throw Error(o(558))}return hl(t),null;case 13:if(n=t.memoizedState,null===e||null!==e.memoizedState&&null!==e.memoizedState.dehydrated){if(i=_i(t),null!==n&&null!==n.dehydrated){if(null===e){if(!i)throw Error(o(318));if(!(i=null!==(i=t.memoizedState)?i.dehydrated:null))throw Error(o(317));i[Ue]=t}else vi(),0===(128&t.flags)&&(t.memoizedState=null),t.flags|=4;hl(t),i=!1}else i=xi(),null!==e&&null!==e.memoizedState&&(e.memoizedState.hydrationErrors=i),i=!0;if(!i)return 256&t.flags?(Os(t),t):(Os(t),null)}return Os(t),0!==(128&t.flags)?(t.lanes=r,t):(r=null!==n,e=null!==e&&null!==e.memoizedState,r&&(i=null,null!==(n=t.child).alternate&&null!==n.alternate.memoizedState&&null!==n.alternate.memoizedState.cachePool&&(i=n.alternate.memoizedState.cachePool.pool),s=null,null!==n.memoizedState&&null!==n.memoizedState.cachePool&&(s=n.memoizedState.cachePool.pool),s!==i&&(n.flags|=2048)),r!==e&&r&&(t.child.flags|=8192),ul(t,t.updateQueue),hl(t),null);case 4:return Y(),null===e&&$u(t.stateNode.containerInfo),hl(t),null;case 10:return ki(t.type),hl(t),null;case 19:if(B(zs),null===(n=t.memoizedState))return hl(t),null;if(i=0!==(128&t.flags),null===(s=n.rendering))if(i)dl(n,!1);else{if(0!==jc||null!==e&&0!==(128&e.flags))for(e=t.child;null!==e;){if(null!==(s=Bs(e))){for(t.flags|=128,dl(n,!1),e=s.updateQueue,t.updateQueue=e,ul(t,e),t.subtreeFlags=0,e=r,r=t.child;null!==r;)Un(r,e),r=r.sibling;return U(zs,1&zs.current|2),di&&ii(t,n.treeForkCount),t.child}e=e.sibling}null!==n.tail&&le()>Lc&&(t.flags|=128,i=!0,dl(n,!1),t.lanes=4194304)}else{if(!i)if(null!==(e=Bs(s))){if(t.flags|=128,i=!0,e=e.updateQueue,t.updateQueue=e,ul(t,e),dl(n,!0),null===n.tail&&"hidden"===n.tailMode&&!s.alternate&&!di)return hl(t),null}else 2*le()-n.renderingStartTime>Lc&&536870912!==r&&(t.flags|=128,i=!0,dl(n,!1),t.lanes=4194304);n.isBackwards?(s.sibling=t.child,t.child=s):(null!==(e=n.last)?e.sibling=s:t.child=s,n.last=s)}return null!==n.tail?(e=n.tail,n.rendering=e,n.tail=e.sibling,n.renderingStartTime=le(),e.sibling=null,r=zs.current,U(zs,i?1&r|2:1&r),di&&ii(t,n.treeForkCount),e):(hl(t),null);case 22:case 23:return Os(t),Is(),n=null!==t.memoizedState,null!==e?null!==e.memoizedState!==n&&(t.flags|=8192):n&&(t.flags|=8192),n?0!==(536870912&r)&&0===(128&t.flags)&&(hl(t),6&t.subtreeFlags&&(t.flags|=8192)):hl(t),null!==(r=t.updateQueue)&&ul(t,r.retryQueue),r=null,null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),n=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(n=t.memoizedState.cachePool.pool),n!==r&&(t.flags|=2048),null!==e&&B(Zi),null;case 24:return r=null,null!==e&&(r=e.memoizedState.cache),t.memoizedState.cache!==r&&(t.flags|=2048),ki(Oi),hl(t),null;case 25:case 30:return null}throw Error(o(156,t.tag))}function ml(e,t){switch(ai(t),t.tag){case 1:return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 3:return ki(Oi),Y(),0!==(65536&(e=t.flags))&&0===(128&e)?(t.flags=-65537&e|128,t):null;case 26:case 27:case 5:return J(t),null;case 31:if(null!==t.memoizedState){if(Os(t),null===t.alternate)throw Error(o(340));vi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 13:if(Os(t),null!==(e=t.memoizedState)&&null!==e.dehydrated){if(null===t.alternate)throw Error(o(340));vi()}return 65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 19:return B(zs),null;case 4:return Y(),null;case 10:return ki(t.type),null;case 22:case 23:return Os(t),Is(),null!==e&&B(Zi),65536&(e=t.flags)?(t.flags=-65537&e|128,t):null;case 24:return ki(Oi),null;default:return null}}function fl(e,t){switch(ai(t),t.tag){case 3:ki(Oi),Y();break;case 26:case 27:case 5:J(t);break;case 4:Y();break;case 31:null!==t.memoizedState&&Os(t);break;case 13:Os(t);break;case 19:B(zs);break;case 10:ki(t.type);break;case 22:case 23:Os(t),Is(),null!==e&&B(Zi);break;case 24:ki(Oi)}}function gl(e,t){try{var r=t.updateQueue,n=null!==r?r.lastEffect:null;if(null!==n){var i=n.next;r=i;do{if((r.tag&e)===e){n=void 0;var s=r.create,o=r.inst;n=s(),o.destroy=n}r=r.next}while(r!==i)}}catch(a){ju(t,t.return,a)}}function yl(e,t,r){try{var n=t.updateQueue,i=null!==n?n.lastEffect:null;if(null!==i){var s=i.next;n=s;do{if((n.tag&e)===e){var o=n.inst,a=o.destroy;if(void 0!==a){o.destroy=void 0,i=t;var l=r,c=a;try{c()}catch(u){ju(i,l,u)}}}n=n.next}while(n!==s)}}catch(u){ju(t,t.return,u)}}function _l(e){var t=e.updateQueue;if(null!==t){var r=e.stateNode;try{ks(t,r)}catch(n){ju(e,e.return,n)}}}function vl(e,t,r){r.props=ja(e.type,e.memoizedProps),r.state=e.memoizedState;try{r.componentWillUnmount()}catch(n){ju(e,t,n)}}function xl(e,t){try{var r=e.ref;if(null!==r){switch(e.tag){case 26:case 27:case 5:var n=e.stateNode;break;default:n=e.stateNode}"function"===typeof r?e.refCleanup=r(n):r.current=n}}catch(i){ju(e,t,i)}}function bl(e,t){var r=e.ref,n=e.refCleanup;if(null!==r)if("function"===typeof n)try{n()}catch(i){ju(e,t,i)}finally{e.refCleanup=null,null!=(e=e.alternate)&&(e.refCleanup=null)}else if("function"===typeof r)try{r(null)}catch(s){ju(e,t,s)}else r.current=null}function wl(e){var t=e.type,r=e.memoizedProps,n=e.stateNode;try{e:switch(t){case"button":case"input":case"select":case"textarea":r.autoFocus&&n.focus();break e;case"img":r.src?n.src=r.src:r.srcSet&&(n.srcset=r.srcSet)}}catch(i){ju(e,e.return,i)}}function jl(e,t,r){try{var n=e.stateNode;!function(e,t,r,n){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var i=null,s=null,a=null,l=null,c=null,u=null,d=null;for(m in r){var h=r[m];if(r.hasOwnProperty(m)&&null!=h)switch(m){case"checked":case"value":break;case"defaultValue":c=h;default:n.hasOwnProperty(m)||ud(e,t,m,null,n,h)}}for(var p in n){var m=n[p];if(h=r[p],n.hasOwnProperty(p)&&(null!=m||null!=h))switch(p){case"type":s=m;break;case"name":i=m;break;case"checked":u=m;break;case"defaultChecked":d=m;break;case"value":a=m;break;case"defaultValue":l=m;break;case"children":case"dangerouslySetInnerHTML":if(null!=m)throw Error(o(137,t));break;default:m!==h&&ud(e,t,p,m,n,h)}}return void _t(e,a,l,c,u,d,s,i);case"select":for(s in m=a=l=p=null,r)if(c=r[s],r.hasOwnProperty(s)&&null!=c)switch(s){case"value":break;case"multiple":m=c;default:n.hasOwnProperty(s)||ud(e,t,s,null,n,c)}for(i in n)if(s=n[i],c=r[i],n.hasOwnProperty(i)&&(null!=s||null!=c))switch(i){case"value":p=s;break;case"defaultValue":l=s;break;case"multiple":a=s;default:s!==c&&ud(e,t,i,s,n,c)}return t=l,r=a,n=m,void(null!=p?bt(e,!!r,p,!1):!!n!==!!r&&(null!=t?bt(e,!!r,t,!0):bt(e,!!r,r?[]:"",!1)));case"textarea":for(l in m=p=null,r)if(i=r[l],r.hasOwnProperty(l)&&null!=i&&!n.hasOwnProperty(l))switch(l){case"value":case"children":break;default:ud(e,t,l,null,n,i)}for(a in n)if(i=n[a],s=r[a],n.hasOwnProperty(a)&&(null!=i||null!=s))switch(a){case"value":p=i;break;case"defaultValue":m=i;break;case"children":break;case"dangerouslySetInnerHTML":if(null!=i)throw Error(o(91));break;default:i!==s&&ud(e,t,a,i,n,s)}return void wt(e,p,m);case"option":for(var f in r)if(p=r[f],r.hasOwnProperty(f)&&null!=p&&!n.hasOwnProperty(f))if("selected"===f)e.selected=!1;else ud(e,t,f,null,n,p);for(c in n)if(p=n[c],m=r[c],n.hasOwnProperty(c)&&p!==m&&(null!=p||null!=m))if("selected"===c)e.selected=p&&"function"!==typeof p&&"symbol"!==typeof p;else ud(e,t,c,p,n,m);return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var g in r)p=r[g],r.hasOwnProperty(g)&&null!=p&&!n.hasOwnProperty(g)&&ud(e,t,g,null,n,p);for(u in n)if(p=n[u],m=r[u],n.hasOwnProperty(u)&&p!==m&&(null!=p||null!=m))switch(u){case"children":case"dangerouslySetInnerHTML":if(null!=p)throw Error(o(137,t));break;default:ud(e,t,u,p,n,m)}return;default:if(Ct(t)){for(var y in r)p=r[y],r.hasOwnProperty(y)&&void 0!==p&&!n.hasOwnProperty(y)&&dd(e,t,y,void 0,n,p);for(d in n)p=n[d],m=r[d],!n.hasOwnProperty(d)||p===m||void 0===p&&void 0===m||dd(e,t,d,p,n,m);return}}for(var _ in r)p=r[_],r.hasOwnProperty(_)&&null!=p&&!n.hasOwnProperty(_)&&ud(e,t,_,null,n,p);for(h in n)p=n[h],m=r[h],!n.hasOwnProperty(h)||p===m||null==p&&null==m||ud(e,t,h,p,n,m)}(n,e.type,r,t),n[Ve]=t}catch(i){ju(e,e.return,i)}}function Sl(e){return 5===e.tag||3===e.tag||26===e.tag||27===e.tag&&kd(e.type)||4===e.tag}function Tl(e){e:for(;;){for(;null===e.sibling;){if(null===e.return||Sl(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;5!==e.tag&&6!==e.tag&&18!==e.tag;){if(27===e.tag&&kd(e.type))continue e;if(2&e.flags)continue e;if(null===e.child||4===e.tag)continue e;e.child.return=e,e=e.child}if(!(2&e.flags))return e.stateNode}}function kl(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?(9===r.nodeType?r.body:"HTML"===r.nodeName?r.ownerDocument.body:r).insertBefore(e,t):((t=9===r.nodeType?r.body:"HTML"===r.nodeName?r.ownerDocument.body:r).appendChild(e),null!==(r=r._reactRootContainer)&&void 0!==r||null!==t.onclick||(t.onclick=Pt));else if(4!==n&&(27===n&&kd(e.type)&&(r=e.stateNode,t=null),null!==(e=e.child)))for(kl(e,t,r),e=e.sibling;null!==e;)kl(e,t,r),e=e.sibling}function Al(e,t,r){var n=e.tag;if(5===n||6===n)e=e.stateNode,t?r.insertBefore(e,t):r.appendChild(e);else if(4!==n&&(27===n&&kd(e.type)&&(r=e.stateNode),null!==(e=e.child)))for(Al(e,t,r),e=e.sibling;null!==e;)Al(e,t,r),e=e.sibling}function Cl(e){var t=e.stateNode,r=e.memoizedProps;try{for(var n=e.type,i=t.attributes;i.length;)t.removeAttributeNode(i[0]);hd(t,n,r),t[Ue]=e,t[Ve]=r}catch(s){ju(e,e.return,s)}}var El=!1,Nl=!1,Il=!1,Pl="function"===typeof WeakSet?WeakSet:Set,Ml=null;function Ll(e,t,r){var n=r.flags;switch(r.tag){case 0:case 11:case 15:Kl(e,r),4&n&&gl(5,r);break;case 1:if(Kl(e,r),4&n)if(e=r.stateNode,null===t)try{e.componentDidMount()}catch(o){ju(r,r.return,o)}else{var i=ja(r.type,t.memoizedProps);t=t.memoizedState;try{e.componentDidUpdate(i,t,e.__reactInternalSnapshotBeforeUpdate)}catch(a){ju(r,r.return,a)}}64&n&&_l(r),512&n&&xl(r,r.return);break;case 3:if(Kl(e,r),64&n&&null!==(e=r.updateQueue)){if(t=null,null!==r.child)switch(r.child.tag){case 27:case 5:case 1:t=r.child.stateNode}try{ks(e,t)}catch(o){ju(r,r.return,o)}}break;case 27:null===t&&4&n&&Cl(r);case 26:case 5:Kl(e,r),null===t&&4&n&&wl(r),512&n&&xl(r,r.return);break;case 12:Kl(e,r);break;case 31:Kl(e,r),4&n&&Bl(e,r);break;case 13:Kl(e,r),4&n&&Ul(e,r),64&n&&(null!==(e=r.memoizedState)&&(null!==(e=e.dehydrated)&&function(e,t){var r=e.ownerDocument;if("$~"===e.data)e._reactRetry=t;else if("$?"!==e.data||"loading"!==r.readyState)t();else{var n=function(){t(),r.removeEventListener("DOMContentLoaded",n)};r.addEventListener("DOMContentLoaded",n),e._reactRetry=n}}(e,r=Au.bind(null,r))));break;case 22:if(!(n=null!==r.memoizedState||El)){t=null!==t&&null!==t.memoizedState||Nl,i=El;var s=Nl;El=n,(Nl=t)&&!s?Xl(e,r,0!==(8772&r.subtreeFlags)):Kl(e,r),El=i,Nl=s}break;case 30:break;default:Kl(e,r)}}function Rl(e){var t=e.alternate;null!==t&&(e.alternate=null,Rl(t)),e.child=null,e.deletions=null,e.sibling=null,5===e.tag&&(null!==(t=e.stateNode)&&Ye(t)),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}var Dl=null,Fl=!1;function Ol(e,t,r){for(r=r.child;null!==r;)zl(e,t,r),r=r.sibling}function zl(e,t,r){if(_e&&"function"===typeof _e.onCommitFiberUnmount)try{_e.onCommitFiberUnmount(ye,r)}catch(s){}switch(r.tag){case 26:Nl||bl(r,t),Ol(e,t,r),r.memoizedState?r.memoizedState.count--:r.stateNode&&(r=r.stateNode).parentNode.removeChild(r);break;case 27:Nl||bl(r,t);var n=Dl,i=Fl;kd(r.type)&&(Dl=r.stateNode,Fl=!1),Ol(e,t,r),Od(r.stateNode),Dl=n,Fl=i;break;case 5:Nl||bl(r,t);case 6:if(n=Dl,i=Fl,Dl=null,Ol(e,t,r),Fl=i,null!==(Dl=n))if(Fl)try{(9===Dl.nodeType?Dl.body:"HTML"===Dl.nodeName?Dl.ownerDocument.body:Dl).removeChild(r.stateNode)}catch(o){ju(r,t,o)}else try{Dl.removeChild(r.stateNode)}catch(o){ju(r,t,o)}break;case 18:null!==Dl&&(Fl?(Ad(9===(e=Dl).nodeType?e.body:"HTML"===e.nodeName?e.ownerDocument.body:e,r.stateNode),Wh(e)):Ad(Dl,r.stateNode));break;case 4:n=Dl,i=Fl,Dl=r.stateNode.containerInfo,Fl=!0,Ol(e,t,r),Dl=n,Fl=i;break;case 0:case 11:case 14:case 15:yl(2,r,t),Nl||yl(4,r,t),Ol(e,t,r);break;case 1:Nl||(bl(r,t),"function"===typeof(n=r.stateNode).componentWillUnmount&&vl(r,t,n)),Ol(e,t,r);break;case 21:Ol(e,t,r);break;case 22:Nl=(n=Nl)||null!==r.memoizedState,Ol(e,t,r),Nl=n;break;default:Ol(e,t,r)}}function Bl(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&null!==(e=e.memoizedState))){e=e.dehydrated;try{Wh(e)}catch(r){ju(t,t.return,r)}}}function Ul(e,t){if(null===t.memoizedState&&(null!==(e=t.alternate)&&(null!==(e=e.memoizedState)&&null!==(e=e.dehydrated))))try{Wh(e)}catch(r){ju(t,t.return,r)}}function Vl(e,t){var r=function(e){switch(e.tag){case 31:case 13:case 19:var t=e.stateNode;return null===t&&(t=e.stateNode=new Pl),t;case 22:return null===(t=(e=e.stateNode)._retryCache)&&(t=e._retryCache=new Pl),t;default:throw Error(o(435,e.tag))}}(e);t.forEach(function(t){if(!r.has(t)){r.add(t);var n=Cu.bind(null,e,t);t.then(n,n)}})}function ql(e,t){var r=t.deletions;if(null!==r)for(var n=0;n<r.length;n++){var i=r[n],s=e,a=t,l=a;e:for(;null!==l;){switch(l.tag){case 27:if(kd(l.type)){Dl=l.stateNode,Fl=!1;break e}break;case 5:Dl=l.stateNode,Fl=!1;break e;case 3:case 4:Dl=l.stateNode.containerInfo,Fl=!0;break e}l=l.return}if(null===Dl)throw Error(o(160));zl(s,a,i),Dl=null,Fl=!1,null!==(s=i.alternate)&&(s.return=null),i.return=null}if(13886&t.subtreeFlags)for(t=t.child;null!==t;)Hl(t,e),t=t.sibling}var Wl=null;function Hl(e,t){var r=e.alternate,n=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:ql(t,e),Gl(e),4&n&&(yl(3,e,e.return),gl(3,e),yl(5,e,e.return));break;case 1:ql(t,e),Gl(e),512&n&&(Nl||null===r||bl(r,r.return)),64&n&&El&&(null!==(e=e.updateQueue)&&(null!==(n=e.callbacks)&&(r=e.shared.hiddenCallbacks,e.shared.hiddenCallbacks=null===r?n:r.concat(n))));break;case 26:var i=Wl;if(ql(t,e),Gl(e),512&n&&(Nl||null===r||bl(r,r.return)),4&n){var s=null!==r?r.memoizedState:null;if(n=e.memoizedState,null===r)if(null===n)if(null===e.stateNode){e:{n=e.type,r=e.memoizedProps,i=i.ownerDocument||i;t:switch(n){case"title":(!(s=i.getElementsByTagName("title")[0])||s[Ke]||s[Ue]||"http://www.w3.org/2000/svg"===s.namespaceURI||s.hasAttribute("itemprop"))&&(s=i.createElement(n),i.head.insertBefore(s,i.querySelector("head > title"))),hd(s,n,r),s[Ue]=e,et(s),n=s;break e;case"link":var a=rh("link","href",i).get(n+(r.href||""));if(a)for(var l=0;l<a.length;l++)if((s=a[l]).getAttribute("href")===(null==r.href||""===r.href?null:r.href)&&s.getAttribute("rel")===(null==r.rel?null:r.rel)&&s.getAttribute("title")===(null==r.title?null:r.title)&&s.getAttribute("crossorigin")===(null==r.crossOrigin?null:r.crossOrigin)){a.splice(l,1);break t}hd(s=i.createElement(n),n,r),i.head.appendChild(s);break;case"meta":if(a=rh("meta","content",i).get(n+(r.content||"")))for(l=0;l<a.length;l++)if((s=a[l]).getAttribute("content")===(null==r.content?null:""+r.content)&&s.getAttribute("name")===(null==r.name?null:r.name)&&s.getAttribute("property")===(null==r.property?null:r.property)&&s.getAttribute("http-equiv")===(null==r.httpEquiv?null:r.httpEquiv)&&s.getAttribute("charset")===(null==r.charSet?null:r.charSet)){a.splice(l,1);break t}hd(s=i.createElement(n),n,r),i.head.appendChild(s);break;default:throw Error(o(468,n))}s[Ue]=e,et(s),n=s}e.stateNode=n}else nh(i,e.type,e.stateNode);else e.stateNode=Jd(i,n,e.memoizedProps);else s!==n?(null===s?null!==r.stateNode&&(r=r.stateNode).parentNode.removeChild(r):s.count--,null===n?nh(i,e.type,e.stateNode):Jd(i,n,e.memoizedProps)):null===n&&null!==e.stateNode&&jl(e,e.memoizedProps,r.memoizedProps)}break;case 27:ql(t,e),Gl(e),512&n&&(Nl||null===r||bl(r,r.return)),null!==r&&4&n&&jl(e,e.memoizedProps,r.memoizedProps);break;case 5:if(ql(t,e),Gl(e),512&n&&(Nl||null===r||bl(r,r.return)),32&e.flags){i=e.stateNode;try{St(i,"")}catch(f){ju(e,e.return,f)}}4&n&&null!=e.stateNode&&jl(e,i=e.memoizedProps,null!==r?r.memoizedProps:i),1024&n&&(Il=!0);break;case 6:if(ql(t,e),Gl(e),4&n){if(null===e.stateNode)throw Error(o(162));n=e.memoizedProps,r=e.stateNode;try{r.nodeValue=n}catch(f){ju(e,e.return,f)}}break;case 3:if(th=null,i=Wl,Wl=Ud(t.containerInfo),ql(t,e),Wl=i,Gl(e),4&n&&null!==r&&r.memoizedState.isDehydrated)try{Wh(t.containerInfo)}catch(f){ju(e,e.return,f)}Il&&(Il=!1,Zl(e));break;case 4:n=Wl,Wl=Ud(e.stateNode.containerInfo),ql(t,e),Gl(e),Wl=n;break;case 12:default:ql(t,e),Gl(e);break;case 31:case 19:ql(t,e),Gl(e),4&n&&(null!==(n=e.updateQueue)&&(e.updateQueue=null,Vl(e,n)));break;case 13:ql(t,e),Gl(e),8192&e.child.flags&&null!==e.memoizedState!==(null!==r&&null!==r.memoizedState)&&(Pc=le()),4&n&&(null!==(n=e.updateQueue)&&(e.updateQueue=null,Vl(e,n)));break;case 22:i=null!==e.memoizedState;var c=null!==r&&null!==r.memoizedState,u=El,d=Nl;if(El=u||i,Nl=d||c,ql(t,e),Nl=d,El=u,Gl(e),8192&n)e:for(t=e.stateNode,t._visibility=i?-2&t._visibility:1|t._visibility,i&&(null===r||c||El||Nl||Yl(e)),r=null,t=e;;){if(5===t.tag||26===t.tag){if(null===r){c=r=t;try{if(s=c.stateNode,i)"function"===typeof(a=s.style).setProperty?a.setProperty("display","none","important"):a.display="none";else{l=c.stateNode;var h=c.memoizedProps.style,p=void 0!==h&&null!==h&&h.hasOwnProperty("display")?h.display:null;l.style.display=null==p||"boolean"===typeof p?"":(""+p).trim()}}catch(f){ju(c,c.return,f)}}}else if(6===t.tag){if(null===r){c=t;try{c.stateNode.nodeValue=i?"":c.memoizedProps}catch(f){ju(c,c.return,f)}}}else if(18===t.tag){if(null===r){c=t;try{var m=c.stateNode;i?Cd(m,!0):Cd(c.stateNode,!1)}catch(f){ju(c,c.return,f)}}}else if((22!==t.tag&&23!==t.tag||null===t.memoizedState||t===e)&&null!==t.child){t.child.return=t,t=t.child;continue}if(t===e)break e;for(;null===t.sibling;){if(null===t.return||t.return===e)break e;r===t&&(r=null),t=t.return}r===t&&(r=null),t.sibling.return=t.return,t=t.sibling}4&n&&(null!==(n=e.updateQueue)&&(null!==(r=n.retryQueue)&&(n.retryQueue=null,Vl(e,r))));case 30:case 21:}}function Gl(e){var t=e.flags;if(2&t){try{for(var r,n=e.return;null!==n;){if(Sl(n)){r=n;break}n=n.return}if(null==r)throw Error(o(160));switch(r.tag){case 27:var i=r.stateNode;Al(e,Tl(e),i);break;case 5:var s=r.stateNode;32&r.flags&&(St(s,""),r.flags&=-33),Al(e,Tl(e),s);break;case 3:case 4:var a=r.stateNode.containerInfo;kl(e,Tl(e),a);break;default:throw Error(o(161))}}catch(l){ju(e,e.return,l)}e.flags&=-3}4096&t&&(e.flags&=-4097)}function Zl(e){if(1024&e.subtreeFlags)for(e=e.child;null!==e;){var t=e;Zl(t),5===t.tag&&1024&t.flags&&t.stateNode.reset(),e=e.sibling}}function Kl(e,t){if(8772&t.subtreeFlags)for(t=t.child;null!==t;)Ll(e,t.alternate,t),t=t.sibling}function Yl(e){for(e=e.child;null!==e;){var t=e;switch(t.tag){case 0:case 11:case 14:case 15:yl(4,t,t.return),Yl(t);break;case 1:bl(t,t.return);var r=t.stateNode;"function"===typeof r.componentWillUnmount&&vl(t,t.return,r),Yl(t);break;case 27:Od(t.stateNode);case 26:case 5:bl(t,t.return),Yl(t);break;case 22:null===t.memoizedState&&Yl(t);break;default:Yl(t)}e=e.sibling}}function Xl(e,t,r){for(r=r&&0!==(8772&t.subtreeFlags),t=t.child;null!==t;){var n=t.alternate,i=e,s=t,o=s.flags;switch(s.tag){case 0:case 11:case 15:Xl(i,s,r),gl(4,s);break;case 1:if(Xl(i,s,r),"function"===typeof(i=(n=s).stateNode).componentDidMount)try{i.componentDidMount()}catch(c){ju(n,n.return,c)}if(null!==(i=(n=s).updateQueue)){var a=n.stateNode;try{var l=i.shared.hiddenCallbacks;if(null!==l)for(i.shared.hiddenCallbacks=null,i=0;i<l.length;i++)Ts(l[i],a)}catch(c){ju(n,n.return,c)}}r&&64&o&&_l(s),xl(s,s.return);break;case 27:Cl(s);case 26:case 5:Xl(i,s,r),r&&null===n&&4&o&&wl(s),xl(s,s.return);break;case 12:Xl(i,s,r);break;case 31:Xl(i,s,r),r&&4&o&&Bl(i,s);break;case 13:Xl(i,s,r),r&&4&o&&Ul(i,s);break;case 22:null===s.memoizedState&&Xl(i,s,r),xl(s,s.return);break;case 30:break;default:Xl(i,s,r)}t=t.sibling}}function Jl(e,t){var r=null;null!==e&&null!==e.memoizedState&&null!==e.memoizedState.cachePool&&(r=e.memoizedState.cachePool.pool),e=null,null!==t.memoizedState&&null!==t.memoizedState.cachePool&&(e=t.memoizedState.cachePool.pool),e!==r&&(null!=e&&e.refCount++,null!=r&&Bi(r))}function Ql(e,t){e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Bi(e))}function $l(e,t,r,n){if(10256&t.subtreeFlags)for(t=t.child;null!==t;)ec(e,t,r,n),t=t.sibling}function ec(e,t,r,n){var i=t.flags;switch(t.tag){case 0:case 11:case 15:$l(e,t,r,n),2048&i&&gl(9,t);break;case 1:case 31:case 13:default:$l(e,t,r,n);break;case 3:$l(e,t,r,n),2048&i&&(e=null,null!==t.alternate&&(e=t.alternate.memoizedState.cache),(t=t.memoizedState.cache)!==e&&(t.refCount++,null!=e&&Bi(e)));break;case 12:if(2048&i){$l(e,t,r,n),e=t.stateNode;try{var s=t.memoizedProps,o=s.id,a=s.onPostCommit;"function"===typeof a&&a(o,null===t.alternate?"mount":"update",e.passiveEffectDuration,-0)}catch(l){ju(t,t.return,l)}}else $l(e,t,r,n);break;case 23:break;case 22:s=t.stateNode,o=t.alternate,null!==t.memoizedState?2&s._visibility?$l(e,t,r,n):rc(e,t):2&s._visibility?$l(e,t,r,n):(s._visibility|=2,tc(e,t,r,n,0!==(10256&t.subtreeFlags)||!1)),2048&i&&Jl(o,t);break;case 24:$l(e,t,r,n),2048&i&&Ql(t.alternate,t)}}function tc(e,t,r,n,i){for(i=i&&(0!==(10256&t.subtreeFlags)||!1),t=t.child;null!==t;){var s=e,o=t,a=r,l=n,c=o.flags;switch(o.tag){case 0:case 11:case 15:tc(s,o,a,l,i),gl(8,o);break;case 23:break;case 22:var u=o.stateNode;null!==o.memoizedState?2&u._visibility?tc(s,o,a,l,i):rc(s,o):(u._visibility|=2,tc(s,o,a,l,i)),i&&2048&c&&Jl(o.alternate,o);break;case 24:tc(s,o,a,l,i),i&&2048&c&&Ql(o.alternate,o);break;default:tc(s,o,a,l,i)}t=t.sibling}}function rc(e,t){if(10256&t.subtreeFlags)for(t=t.child;null!==t;){var r=e,n=t,i=n.flags;switch(n.tag){case 22:rc(r,n),2048&i&&Jl(n.alternate,n);break;case 24:rc(r,n),2048&i&&Ql(n.alternate,n);break;default:rc(r,n)}t=t.sibling}}var nc=8192;function ic(e,t,r){if(e.subtreeFlags&nc)for(e=e.child;null!==e;)sc(e,t,r),e=e.sibling}function sc(e,t,r){switch(e.tag){case 26:ic(e,t,r),e.flags&nc&&null!==e.memoizedState&&function(e,t,r,n){if("stylesheet"===r.type&&("string"!==typeof n.media||!1!==matchMedia(n.media).matches)&&0===(4&r.state.loading)){if(null===r.instance){var i=Gd(n.href),s=t.querySelector(Zd(i));if(s)return null!==(t=s._p)&&"object"===typeof t&&"function"===typeof t.then&&(e.count++,e=oh.bind(e),t.then(e,e)),r.state.loading|=4,r.instance=s,void et(s);s=t.ownerDocument||t,n=Kd(n),(i=zd.get(i))&&$d(n,i),et(s=s.createElement("link"));var o=s;o._p=new Promise(function(e,t){o.onload=e,o.onerror=t}),hd(s,"link",n),r.instance=s}null===e.stylesheets&&(e.stylesheets=new Map),e.stylesheets.set(r,t),(t=r.state.preload)&&0===(3&r.state.loading)&&(e.count++,r=oh.bind(e),t.addEventListener("load",r),t.addEventListener("error",r))}}(r,Wl,e.memoizedState,e.memoizedProps);break;case 5:default:ic(e,t,r);break;case 3:case 4:var n=Wl;Wl=Ud(e.stateNode.containerInfo),ic(e,t,r),Wl=n;break;case 22:null===e.memoizedState&&(null!==(n=e.alternate)&&null!==n.memoizedState?(n=nc,nc=16777216,ic(e,t,r),nc=n):ic(e,t,r))}}function oc(e){var t=e.alternate;if(null!==t&&null!==(e=t.child)){t.child=null;do{t=e.sibling,e.sibling=null,e=t}while(null!==e)}}function ac(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var r=0;r<t.length;r++){var n=t[r];Ml=n,uc(n,e)}oc(e)}if(10256&e.subtreeFlags)for(e=e.child;null!==e;)lc(e),e=e.sibling}function lc(e){switch(e.tag){case 0:case 11:case 15:ac(e),2048&e.flags&&yl(9,e,e.return);break;case 3:case 12:default:ac(e);break;case 22:var t=e.stateNode;null!==e.memoizedState&&2&t._visibility&&(null===e.return||13!==e.return.tag)?(t._visibility&=-3,cc(e)):ac(e)}}function cc(e){var t=e.deletions;if(0!==(16&e.flags)){if(null!==t)for(var r=0;r<t.length;r++){var n=t[r];Ml=n,uc(n,e)}oc(e)}for(e=e.child;null!==e;){switch((t=e).tag){case 0:case 11:case 15:yl(8,t,t.return),cc(t);break;case 22:2&(r=t.stateNode)._visibility&&(r._visibility&=-3,cc(t));break;default:cc(t)}e=e.sibling}}function uc(e,t){for(;null!==Ml;){var r=Ml;switch(r.tag){case 0:case 11:case 15:yl(8,r,t);break;case 23:case 22:if(null!==r.memoizedState&&null!==r.memoizedState.cachePool){var n=r.memoizedState.cachePool.pool;null!=n&&n.refCount++}break;case 24:Bi(r.memoizedState.cache)}if(null!==(n=r.child))n.return=r,Ml=n;else e:for(r=e;null!==Ml;){var i=(n=Ml).sibling,s=n.return;if(Rl(n),n===r){Ml=null;break e}if(null!==i){i.return=s,Ml=i;break e}Ml=s}}}var dc={getCacheForType:function(e){var t=Pi(Oi),r=t.data.get(e);return void 0===r&&(r=e(),t.data.set(e,r)),r},cacheSignal:function(){return Pi(Oi).controller.signal}},hc="function"===typeof WeakMap?WeakMap:Map,pc=0,mc=null,fc=null,gc=0,yc=0,_c=null,vc=!1,xc=!1,bc=!1,wc=0,jc=0,Sc=0,Tc=0,kc=0,Ac=0,Cc=0,Ec=null,Nc=null,Ic=!1,Pc=0,Mc=0,Lc=1/0,Rc=null,Dc=null,Fc=0,Oc=null,zc=null,Bc=0,Uc=0,Vc=null,qc=null,Wc=0,Hc=null;function Gc(){return 0!==(2&pc)&&0!==gc?gc&-gc:null!==L.T?Vu():Oe()}function Zc(){if(0===Ac)if(0===(536870912&gc)||di){var e=Se;0===(3932160&(Se<<=1))&&(Se=262144),Ac=e}else Ac=536870912;return null!==(e=Ps.current)&&(e.flags|=32),Ac}function Kc(e,t,r){(e!==mc||2!==yc&&9!==yc)&&null===e.cancelPendingCommit||(tu(e,0),Qc(e,gc,Ac,!1)),Pe(e,r),0!==(2&pc)&&e===mc||(e===mc&&(0===(2&pc)&&(Tc|=r),4===jc&&Qc(e,gc,Ac,!1)),Ru(e))}function Yc(e,t,r){if(0!==(6&pc))throw Error(o(327));for(var n=!r&&0===(127&t)&&0===(t&e.expiredLanes)||Ce(e,t),i=n?function(e,t){var r=pc;pc|=2;var n=iu(),i=su();mc!==e||gc!==t?(Rc=null,Lc=le()+500,tu(e,t)):xc=Ce(e,t);e:for(;;)try{if(0!==yc&&null!==fc){t=fc;var s=_c;t:switch(yc){case 1:yc=0,_c=null,hu(e,t,s,1);break;case 2:case 9:if(ts(s)){yc=0,_c=null,du(t);break}t=function(){2!==yc&&9!==yc||mc!==e||(yc=7),Ru(e)},s.then(t,t);break e;case 3:yc=7;break e;case 4:yc=5;break e;case 7:ts(s)?(yc=0,_c=null,du(t)):(yc=0,_c=null,hu(e,t,s,7));break;case 5:var a=null;switch(fc.tag){case 26:a=fc.memoizedState;case 5:case 27:var l=fc;if(a?ih(a):l.stateNode.complete){yc=0,_c=null;var c=l.sibling;if(null!==c)fc=c;else{var u=l.return;null!==u?(fc=u,pu(u)):fc=null}break t}}yc=0,_c=null,hu(e,t,s,5);break;case 6:yc=0,_c=null,hu(e,t,s,6);break;case 8:eu(),jc=6;break e;default:throw Error(o(462))}}cu();break}catch(d){ru(e,d)}return Si=ji=null,L.H=n,L.A=i,pc=r,null!==fc?0:(mc=null,gc=0,Nn(),jc)}(e,t):au(e,t,!0),s=n;;){if(0===i){xc&&!n&&Qc(e,t,0,!1);break}if(r=e.current.alternate,!s||Jc(r)){if(2===i){if(s=t,e.errorRecoveryDisabledLanes&s)var a=0;else a=0!==(a=-536870913&e.pendingLanes)?a:536870912&a?536870912:0;if(0!==a){t=a;e:{var l=e;i=Ec;var c=l.current.memoizedState.isDehydrated;if(c&&(tu(l,a).flags|=256),2!==(a=au(l,a,!1))){if(bc&&!c){l.errorRecoveryDisabledLanes|=s,Tc|=s,i=4;break e}s=Nc,Nc=i,null!==s&&(null===Nc?Nc=s:Nc.push.apply(Nc,s))}i=a}if(s=!1,2!==i)continue}}if(1===i){tu(e,0),Qc(e,t,0,!0);break}e:{switch(n=e,s=i){case 0:case 1:throw Error(o(345));case 4:if((4194048&t)!==t)break;case 6:Qc(n,t,Ac,!vc);break e;case 2:Nc=null;break;case 3:case 5:break;default:throw Error(o(329))}if((62914560&t)===t&&10<(i=Pc+300-le())){if(Qc(n,t,Ac,!vc),0!==Ae(n,0,!0))break e;Bc=t,n.timeoutHandle=bd(Xc.bind(null,n,r,Nc,Rc,Ic,t,Ac,Tc,Cc,vc,s,"Throttled",-0,0),i)}else Xc(n,r,Nc,Rc,Ic,t,Ac,Tc,Cc,vc,s,null,-0,0)}break}i=au(e,t,!1),s=!1}Ru(e)}function Xc(e,t,r,n,i,s,o,a,l,c,u,d,h,p){if(e.timeoutHandle=-1,8192&(d=t.subtreeFlags)||16785408===(16785408&d)){sc(t,s,d={stylesheets:null,count:0,imgCount:0,imgBytes:0,suspenseyImages:[],waitingForImages:!0,waitingForViewTransition:!1,unsuspend:Pt});var m=(62914560&s)===s?Pc-le():(4194048&s)===s?Mc-le():0;if(null!==(m=function(e,t){return e.stylesheets&&0===e.count&&lh(e,e.stylesheets),0<e.count||0<e.imgCount?function(r){var n=setTimeout(function(){if(e.stylesheets&&lh(e,e.stylesheets),e.unsuspend){var t=e.unsuspend;e.unsuspend=null,t()}},6e4+t);0<e.imgBytes&&0===sh&&(sh=62500*function(){if("function"===typeof performance.getEntriesByType){for(var e=0,t=0,r=performance.getEntriesByType("resource"),n=0;n<r.length;n++){var i=r[n],s=i.transferSize,o=i.initiatorType,a=i.duration;if(s&&a&&pd(o)){for(o=0,a=i.responseEnd,n+=1;n<r.length;n++){var l=r[n],c=l.startTime;if(c>a)break;var u=l.transferSize,d=l.initiatorType;u&&pd(d)&&(o+=u*((l=l.responseEnd)<a?1:(a-c)/(l-c)))}if(--n,t+=8*(s+o)/(i.duration/1e3),10<++e)break}}if(0<e)return t/e/1e6}return navigator.connection&&"number"===typeof(e=navigator.connection.downlink)?e:5}());var i=setTimeout(function(){if(e.waitingForImages=!1,0===e.count&&(e.stylesheets&&lh(e,e.stylesheets),e.unsuspend)){var t=e.unsuspend;e.unsuspend=null,t()}},(e.imgBytes>sh?50:800)+t);return e.unsuspend=r,function(){e.unsuspend=null,clearTimeout(n),clearTimeout(i)}}:null}(d,m)))return Bc=s,e.cancelPendingCommit=m(fu.bind(null,e,t,s,r,n,i,o,a,l,u,d,null,h,p)),void Qc(e,s,o,!c)}fu(e,t,s,r,n,i,o,a,l)}function Jc(e){for(var t=e;;){var r=t.tag;if((0===r||11===r||15===r)&&16384&t.flags&&(null!==(r=t.updateQueue)&&null!==(r=r.stores)))for(var n=0;n<r.length;n++){var i=r[n],s=i.getSnapshot;i=i.value;try{if(!Jr(s(),i))return!1}catch(o){return!1}}if(r=t.child,16384&t.subtreeFlags&&null!==r)r.return=t,t=r;else{if(t===e)break;for(;null===t.sibling;){if(null===t.return||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function Qc(e,t,r,n){t&=~kc,t&=~Tc,e.suspendedLanes|=t,e.pingedLanes&=~t,n&&(e.warmLanes|=t),n=e.expirationTimes;for(var i=t;0<i;){var s=31-xe(i),o=1<<s;n[s]=-1,i&=~o}0!==r&&Me(e,r,t)}function $c(){return 0!==(6&pc)||(Du(0,!1),!1)}function eu(){if(null!==fc){if(0===yc)var e=fc.return;else Si=ji=null,oo(e=fc),as=null,ls=0,e=fc;for(;null!==e;)fl(e.alternate,e),e=e.return;fc=null}}function tu(e,t){var r=e.timeoutHandle;-1!==r&&(e.timeoutHandle=-1,wd(r)),null!==(r=e.cancelPendingCommit)&&(e.cancelPendingCommit=null,r()),Bc=0,eu(),mc=e,fc=r=Bn(e.current,null),gc=t,yc=0,_c=null,vc=!1,xc=Ce(e,t),bc=!1,Cc=Ac=kc=Tc=Sc=jc=0,Nc=Ec=null,Ic=!1,0!==(8&t)&&(t|=32&t);var n=e.entangledLanes;if(0!==n)for(e=e.entanglements,n&=t;0<n;){var i=31-xe(n),s=1<<i;t|=e[i],n&=~s}return wc=t,Nn(),r}function ru(e,t){Vs=null,L.H=fa,t===Ji||t===$i?(t=ss(),yc=3):t===Qi?(t=ss(),yc=4):yc=t===Pa?8:null!==t&&"object"===typeof t&&"function"===typeof t.then?6:1,_c=t,null===fc&&(jc=1,Aa(e,Kn(t,e.current)))}function nu(){var e=Ps.current;return null===e||((4194048&gc)===gc?null===Ms:((62914560&gc)===gc||0!==(536870912&gc))&&e===Ms)}function iu(){var e=L.H;return L.H=fa,null===e?fa:e}function su(){var e=L.A;return L.A=dc,e}function ou(){jc=4,vc||(4194048&gc)!==gc&&null!==Ps.current||(xc=!0),0===(134217727&Sc)&&0===(134217727&Tc)||null===mc||Qc(mc,gc,Ac,!1)}function au(e,t,r){var n=pc;pc|=2;var i=iu(),s=su();mc===e&&gc===t||(Rc=null,tu(e,t)),t=!1;var o=jc;e:for(;;)try{if(0!==yc&&null!==fc){var a=fc,l=_c;switch(yc){case 8:eu(),o=6;break e;case 3:case 2:case 9:case 6:null===Ps.current&&(t=!0);var c=yc;if(yc=0,_c=null,hu(e,a,l,c),r&&xc){o=0;break e}break;default:c=yc,yc=0,_c=null,hu(e,a,l,c)}}lu(),o=jc;break}catch(u){ru(e,u)}return t&&e.shellSuspendCounter++,Si=ji=null,pc=n,L.H=i,L.A=s,null===fc&&(mc=null,gc=0,Nn()),o}function lu(){for(;null!==fc;)uu(fc)}function cu(){for(;null!==fc&&!oe();)uu(fc)}function uu(e){var t=ol(e.alternate,e,wc);e.memoizedProps=e.pendingProps,null===t?pu(e):fc=t}function du(e){var t=e,r=t.alternate;switch(t.tag){case 15:case 0:t=Ha(r,t,t.pendingProps,t.type,void 0,gc);break;case 11:t=Ha(r,t,t.pendingProps,t.type.render,t.ref,gc);break;case 5:oo(t);default:fl(r,t),t=ol(r,t=fc=Un(t,wc),wc)}e.memoizedProps=e.pendingProps,null===t?pu(e):fc=t}function hu(e,t,r,n){Si=ji=null,oo(t),as=null,ls=0;var i=t.return;try{if(function(e,t,r,n,i){if(r.flags|=32768,null!==n&&"object"===typeof n&&"function"===typeof n.then){if(null!==(t=r.alternate)&&Ei(t,r,i,!0),null!==(r=Ps.current)){switch(r.tag){case 31:case 13:return null===Ms?ou():null===r.alternate&&0===jc&&(jc=3),r.flags&=-257,r.flags|=65536,r.lanes=i,n===es?r.flags|=16384:(null===(t=r.updateQueue)?r.updateQueue=new Set([n]):t.add(n),Su(e,n,i)),!1;case 22:return r.flags|=65536,n===es?r.flags|=16384:(null===(t=r.updateQueue)?(t={transitions:null,markerInstances:null,retryQueue:new Set([n])},r.updateQueue=t):null===(r=t.retryQueue)?t.retryQueue=new Set([n]):r.add(n),Su(e,n,i)),!1}throw Error(o(435,r.tag))}return Su(e,n,i),ou(),!1}if(di)return null!==(t=Ps.current)?(0===(65536&t.flags)&&(t.flags|=256),t.flags|=65536,t.lanes=i,n!==mi&&bi(Kn(e=Error(o(422),{cause:n}),r))):(n!==mi&&bi(Kn(t=Error(o(423),{cause:n}),r)),(e=e.current.alternate).flags|=65536,i&=-i,e.lanes|=i,n=Kn(n,r),bs(e,i=Ea(e.stateNode,n,i)),4!==jc&&(jc=2)),!1;var s=Error(o(520),{cause:n});if(s=Kn(s,r),null===Ec?Ec=[s]:Ec.push(s),4!==jc&&(jc=2),null===t)return!0;n=Kn(n,r),r=t;do{switch(r.tag){case 3:return r.flags|=65536,e=i&-i,r.lanes|=e,bs(r,e=Ea(r.stateNode,n,e)),!1;case 1:if(t=r.type,s=r.stateNode,0===(128&r.flags)&&("function"===typeof t.getDerivedStateFromError||null!==s&&"function"===typeof s.componentDidCatch&&(null===Dc||!Dc.has(s))))return r.flags|=65536,i&=-i,r.lanes|=i,Ia(i=Na(i),e,r,n),bs(r,i),!1}r=r.return}while(null!==r);return!1}(e,i,t,r,gc))return jc=1,Aa(e,Kn(r,e.current)),void(fc=null)}catch(s){if(null!==i)throw fc=i,s;return jc=1,Aa(e,Kn(r,e.current)),void(fc=null)}32768&t.flags?(di||1===n?e=!0:xc||0!==(536870912&gc)?e=!1:(vc=e=!0,(2===n||9===n||3===n||6===n)&&(null!==(n=Ps.current)&&13===n.tag&&(n.flags|=16384))),mu(t,e)):pu(t)}function pu(e){var t=e;do{if(0!==(32768&t.flags))return void mu(t,vc);e=t.return;var r=pl(t.alternate,t,wc);if(null!==r)return void(fc=r);if(null!==(t=t.sibling))return void(fc=t);fc=t=e}while(null!==t);0===jc&&(jc=5)}function mu(e,t){do{var r=ml(e.alternate,e);if(null!==r)return r.flags&=32767,void(fc=r);if(null!==(r=e.return)&&(r.flags|=32768,r.subtreeFlags=0,r.deletions=null),!t&&null!==(e=e.sibling))return void(fc=e);fc=e=r}while(null!==e);jc=6,fc=null}function fu(e,t,r,n,i,s,a,l,c){e.cancelPendingCommit=null;do{xu()}while(0!==Fc);if(0!==(6&pc))throw Error(o(327));if(null!==t){if(t===e.current)throw Error(o(177));if(s=t.lanes|t.childLanes,function(e,t,r,n,i,s){var o=e.pendingLanes;e.pendingLanes=r,e.suspendedLanes=0,e.pingedLanes=0,e.warmLanes=0,e.expiredLanes&=r,e.entangledLanes&=r,e.errorRecoveryDisabledLanes&=r,e.shellSuspendCounter=0;var a=e.entanglements,l=e.expirationTimes,c=e.hiddenUpdates;for(r=o&~r;0<r;){var u=31-xe(r),d=1<<u;a[u]=0,l[u]=-1;var h=c[u];if(null!==h)for(c[u]=null,u=0;u<h.length;u++){var p=h[u];null!==p&&(p.lane&=-536870913)}r&=~d}0!==n&&Me(e,n,0),0!==s&&0===i&&0!==e.tag&&(e.suspendedLanes|=s&~(o&~t))}(e,r,s|=En,a,l,c),e===mc&&(fc=mc=null,gc=0),zc=t,Oc=e,Bc=r,Uc=s,Vc=i,qc=n,0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?(e.callbackNode=null,e.callbackPriority=0,ie(he,function(){return bu(),null})):(e.callbackNode=null,e.callbackPriority=0),n=0!==(13878&t.flags),0!==(13878&t.subtreeFlags)||n){n=L.T,L.T=null,i=R.p,R.p=2,a=pc,pc|=4;try{!function(e,t){if(e=e.containerInfo,md=vh,nn(e=rn(e))){if("selectionStart"in e)var r={start:e.selectionStart,end:e.selectionEnd};else e:{var n=(r=(r=e.ownerDocument)&&r.defaultView||window).getSelection&&r.getSelection();if(n&&0!==n.rangeCount){r=n.anchorNode;var i=n.anchorOffset,s=n.focusNode;n=n.focusOffset;try{r.nodeType,s.nodeType}catch(g){r=null;break e}var a=0,l=-1,c=-1,u=0,d=0,h=e,p=null;t:for(;;){for(var m;h!==r||0!==i&&3!==h.nodeType||(l=a+i),h!==s||0!==n&&3!==h.nodeType||(c=a+n),3===h.nodeType&&(a+=h.nodeValue.length),null!==(m=h.firstChild);)p=h,h=m;for(;;){if(h===e)break t;if(p===r&&++u===i&&(l=a),p===s&&++d===n&&(c=a),null!==(m=h.nextSibling))break;p=(h=p).parentNode}h=m}r=-1===l||-1===c?null:{start:l,end:c}}else r=null}r=r||{start:0,end:0}}else r=null;for(fd={focusedElem:e,selectionRange:r},vh=!1,Ml=t;null!==Ml;)if(e=(t=Ml).child,0!==(1028&t.subtreeFlags)&&null!==e)e.return=t,Ml=e;else for(;null!==Ml;){switch(s=(t=Ml).alternate,e=t.flags,t.tag){case 0:if(0!==(4&e)&&null!==(e=null!==(e=t.updateQueue)?e.events:null))for(r=0;r<e.length;r++)(i=e[r]).ref.impl=i.nextImpl;break;case 11:case 15:case 5:case 26:case 27:case 6:case 4:case 17:break;case 1:if(0!==(1024&e)&&null!==s){e=void 0,r=t,i=s.memoizedProps,s=s.memoizedState,n=r.stateNode;try{var f=ja(r.type,i);e=n.getSnapshotBeforeUpdate(f,s),n.__reactInternalSnapshotBeforeUpdate=e}catch(y){ju(r,r.return,y)}}break;case 3:if(0!==(1024&e))if(9===(r=(e=t.stateNode.containerInfo).nodeType))Ed(e);else if(1===r)switch(e.nodeName){case"HEAD":case"HTML":case"BODY":Ed(e);break;default:e.textContent=""}break;default:if(0!==(1024&e))throw Error(o(163))}if(null!==(e=t.sibling)){e.return=t.return,Ml=e;break}Ml=t.return}}(e,t)}finally{pc=a,R.p=i,L.T=n}}Fc=1,gu(),yu(),_u()}}function gu(){if(1===Fc){Fc=0;var e=Oc,t=zc,r=0!==(13878&t.flags);if(0!==(13878&t.subtreeFlags)||r){r=L.T,L.T=null;var n=R.p;R.p=2;var i=pc;pc|=4;try{Hl(t,e);var s=fd,o=rn(e.containerInfo),a=s.focusedElem,l=s.selectionRange;if(o!==a&&a&&a.ownerDocument&&tn(a.ownerDocument.documentElement,a)){if(null!==l&&nn(a)){var c=l.start,u=l.end;if(void 0===u&&(u=c),"selectionStart"in a)a.selectionStart=c,a.selectionEnd=Math.min(u,a.value.length);else{var d=a.ownerDocument||document,h=d&&d.defaultView||window;if(h.getSelection){var p=h.getSelection(),m=a.textContent.length,f=Math.min(l.start,m),g=void 0===l.end?f:Math.min(l.end,m);!p.extend&&f>g&&(o=g,g=f,f=o);var y=en(a,f),_=en(a,g);if(y&&_&&(1!==p.rangeCount||p.anchorNode!==y.node||p.anchorOffset!==y.offset||p.focusNode!==_.node||p.focusOffset!==_.offset)){var v=d.createRange();v.setStart(y.node,y.offset),p.removeAllRanges(),f>g?(p.addRange(v),p.extend(_.node,_.offset)):(v.setEnd(_.node,_.offset),p.addRange(v))}}}}for(d=[],p=a;p=p.parentNode;)1===p.nodeType&&d.push({element:p,left:p.scrollLeft,top:p.scrollTop});for("function"===typeof a.focus&&a.focus(),a=0;a<d.length;a++){var x=d[a];x.element.scrollLeft=x.left,x.element.scrollTop=x.top}}vh=!!md,fd=md=null}finally{pc=i,R.p=n,L.T=r}}e.current=t,Fc=2}}function yu(){if(2===Fc){Fc=0;var e=Oc,t=zc,r=0!==(8772&t.flags);if(0!==(8772&t.subtreeFlags)||r){r=L.T,L.T=null;var n=R.p;R.p=2;var i=pc;pc|=4;try{Ll(e,t.alternate,t)}finally{pc=i,R.p=n,L.T=r}}Fc=3}}function _u(){if(4===Fc||3===Fc){Fc=0,ae();var e=Oc,t=zc,r=Bc,n=qc;0!==(10256&t.subtreeFlags)||0!==(10256&t.flags)?Fc=5:(Fc=0,zc=Oc=null,vu(e,e.pendingLanes));var i=e.pendingLanes;if(0===i&&(Dc=null),Fe(r),t=t.stateNode,_e&&"function"===typeof _e.onCommitFiberRoot)try{_e.onCommitFiberRoot(ye,t,void 0,128===(128&t.current.flags))}catch(l){}if(null!==n){t=L.T,i=R.p,R.p=2,L.T=null;try{for(var s=e.onRecoverableError,o=0;o<n.length;o++){var a=n[o];s(a.value,{componentStack:a.stack})}}finally{L.T=t,R.p=i}}0!==(3&Bc)&&xu(),Ru(e),i=e.pendingLanes,0!==(261930&r)&&0!==(42&i)?e===Hc?Wc++:(Wc=0,Hc=e):Wc=0,Du(0,!1)}}function vu(e,t){0===(e.pooledCacheLanes&=t)&&(null!=(t=e.pooledCache)&&(e.pooledCache=null,Bi(t)))}function xu(){return gu(),yu(),_u(),bu()}function bu(){if(5!==Fc)return!1;var e=Oc,t=Uc;Uc=0;var r=Fe(Bc),n=L.T,i=R.p;try{R.p=32>r?32:r,L.T=null,r=Vc,Vc=null;var s=Oc,a=Bc;if(Fc=0,zc=Oc=null,Bc=0,0!==(6&pc))throw Error(o(331));var l=pc;if(pc|=4,lc(s.current),ec(s,s.current,a,r),pc=l,Du(0,!1),_e&&"function"===typeof _e.onPostCommitFiberRoot)try{_e.onPostCommitFiberRoot(ye,s)}catch(c){}return!0}finally{R.p=i,L.T=n,vu(e,t)}}function wu(e,t,r){t=Kn(r,t),null!==(e=vs(e,t=Ea(e.stateNode,t,2),2))&&(Pe(e,2),Ru(e))}function ju(e,t,r){if(3===e.tag)wu(e,e,r);else for(;null!==t;){if(3===t.tag){wu(t,e,r);break}if(1===t.tag){var n=t.stateNode;if("function"===typeof t.type.getDerivedStateFromError||"function"===typeof n.componentDidCatch&&(null===Dc||!Dc.has(n))){e=Kn(r,e),null!==(n=vs(t,r=Na(2),2))&&(Ia(r,n,t,e),Pe(n,2),Ru(n));break}}t=t.return}}function Su(e,t,r){var n=e.pingCache;if(null===n){n=e.pingCache=new hc;var i=new Set;n.set(t,i)}else void 0===(i=n.get(t))&&(i=new Set,n.set(t,i));i.has(r)||(bc=!0,i.add(r),e=Tu.bind(null,e,t,r),t.then(e,e))}function Tu(e,t,r){var n=e.pingCache;null!==n&&n.delete(t),e.pingedLanes|=e.suspendedLanes&r,e.warmLanes&=~r,mc===e&&(gc&r)===r&&(4===jc||3===jc&&(62914560&gc)===gc&&300>le()-Pc?0===(2&pc)&&tu(e,0):kc|=r,Cc===gc&&(Cc=0)),Ru(e)}function ku(e,t){0===t&&(t=Ne()),null!==(e=Mn(e,t))&&(Pe(e,t),Ru(e))}function Au(e){var t=e.memoizedState,r=0;null!==t&&(r=t.retryLane),ku(e,r)}function Cu(e,t){var r=0;switch(e.tag){case 31:case 13:var n=e.stateNode,i=e.memoizedState;null!==i&&(r=i.retryLane);break;case 19:n=e.stateNode;break;case 22:n=e.stateNode._retryCache;break;default:throw Error(o(314))}null!==n&&n.delete(t),ku(e,r)}var Eu=null,Nu=null,Iu=!1,Pu=!1,Mu=!1,Lu=0;function Ru(e){e!==Nu&&null===e.next&&(null===Nu?Eu=Nu=e:Nu=Nu.next=e),Pu=!0,Iu||(Iu=!0,Sd(function(){0!==(6&pc)?ie(ue,Fu):Ou()}))}function Du(e,t){if(!Mu&&Pu){Mu=!0;do{for(var r=!1,n=Eu;null!==n;){if(!t)if(0!==e){var i=n.pendingLanes;if(0===i)var s=0;else{var o=n.suspendedLanes,a=n.pingedLanes;s=(1<<31-xe(42|e)+1)-1,s=201326741&(s&=i&~(o&~a))?201326741&s|1:s?2|s:0}0!==s&&(r=!0,Uu(n,s))}else s=gc,0===(3&(s=Ae(n,n===mc?s:0,null!==n.cancelPendingCommit||-1!==n.timeoutHandle)))||Ce(n,s)||(r=!0,Uu(n,s));n=n.next}}while(r);Mu=!1}}function Fu(){Ou()}function Ou(){Pu=Iu=!1;var e=0;0!==Lu&&function(){var e=window.event;if(e&&"popstate"===e.type)return e!==xd&&(xd=e,!0);return xd=null,!1}()&&(e=Lu);for(var t=le(),r=null,n=Eu;null!==n;){var i=n.next,s=zu(n,t);0===s?(n.next=null,null===r?Eu=i:r.next=i,null===i&&(Nu=r)):(r=n,(0!==e||0!==(3&s))&&(Pu=!0)),n=i}0!==Fc&&5!==Fc||Du(e,!1),0!==Lu&&(Lu=0)}function zu(e,t){for(var r=e.suspendedLanes,n=e.pingedLanes,i=e.expirationTimes,s=-62914561&e.pendingLanes;0<s;){var o=31-xe(s),a=1<<o,l=i[o];-1===l?0!==(a&r)&&0===(a&n)||(i[o]=Ee(a,t)):l<=t&&(e.expiredLanes|=a),s&=~a}if(r=gc,r=Ae(e,e===(t=mc)?r:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle),n=e.callbackNode,0===r||e===t&&(2===yc||9===yc)||null!==e.cancelPendingCommit)return null!==n&&null!==n&&se(n),e.callbackNode=null,e.callbackPriority=0;if(0===(3&r)||Ce(e,r)){if((t=r&-r)===e.callbackPriority)return t;switch(null!==n&&se(n),Fe(r)){case 2:case 8:r=de;break;case 32:default:r=he;break;case 268435456:r=me}return n=Bu.bind(null,e),r=ie(r,n),e.callbackPriority=t,e.callbackNode=r,t}return null!==n&&null!==n&&se(n),e.callbackPriority=2,e.callbackNode=null,2}function Bu(e,t){if(0!==Fc&&5!==Fc)return e.callbackNode=null,e.callbackPriority=0,null;var r=e.callbackNode;if(xu()&&e.callbackNode!==r)return null;var n=gc;return 0===(n=Ae(e,e===mc?n:0,null!==e.cancelPendingCommit||-1!==e.timeoutHandle))?null:(Yc(e,n,t),zu(e,le()),null!=e.callbackNode&&e.callbackNode===r?Bu.bind(null,e):null)}function Uu(e,t){if(xu())return null;Yc(e,t,!0)}function Vu(){if(0===Lu){var e=qi;0===e&&(e=je,0===(261888&(je<<=1))&&(je=256)),Lu=e}return Lu}function qu(e){return null==e||"symbol"===typeof e||"boolean"===typeof e?null:"function"===typeof e?e:It(""+e)}function Wu(e,t){var r=t.ownerDocument.createElement("input");return r.name=t.name,r.value=t.value,e.id&&r.setAttribute("form",e.id),t.parentNode.insertBefore(r,t),e=new FormData(e),r.parentNode.removeChild(r),e}for(var Hu=0;Hu<Sn.length;Hu++){var Gu=Sn[Hu];Tn(Gu.toLowerCase(),"on"+(Gu[0].toUpperCase()+Gu.slice(1)))}Tn(gn,"onAnimationEnd"),Tn(yn,"onAnimationIteration"),Tn(_n,"onAnimationStart"),Tn("dblclick","onDoubleClick"),Tn("focusin","onFocus"),Tn("focusout","onBlur"),Tn(vn,"onTransitionRun"),Tn(xn,"onTransitionStart"),Tn(bn,"onTransitionCancel"),Tn(wn,"onTransitionEnd"),it("onMouseEnter",["mouseout","mouseover"]),it("onMouseLeave",["mouseout","mouseover"]),it("onPointerEnter",["pointerout","pointerover"]),it("onPointerLeave",["pointerout","pointerover"]),nt("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),nt("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),nt("onBeforeInput",["compositionend","keypress","textInput","paste"]),nt("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),nt("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Zu="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Ku=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Zu));function Yu(e,t){t=0!==(4&t);for(var r=0;r<e.length;r++){var n=e[r],i=n.event;n=n.listeners;e:{var s=void 0;if(t)for(var o=n.length-1;0<=o;o--){var a=n[o],l=a.instance,c=a.currentTarget;if(a=a.listener,l!==s&&i.isPropagationStopped())break e;s=a,i.currentTarget=c;try{s(i)}catch(u){kn(u)}i.currentTarget=null,s=l}else for(o=0;o<n.length;o++){if(l=(a=n[o]).instance,c=a.currentTarget,a=a.listener,l!==s&&i.isPropagationStopped())break e;s=a,i.currentTarget=c;try{s(i)}catch(u){kn(u)}i.currentTarget=null,s=l}}}}function Xu(e,t){var r=t[We];void 0===r&&(r=t[We]=new Set);var n=e+"__bubble";r.has(n)||(ed(t,e,2,!1),r.add(n))}function Ju(e,t,r){var n=0;t&&(n|=4),ed(r,e,n,t)}var Qu="_reactListening"+Math.random().toString(36).slice(2);function $u(e){if(!e[Qu]){e[Qu]=!0,tt.forEach(function(t){"selectionchange"!==t&&(Ku.has(t)||Ju(t,!1,e),Ju(t,!0,e))});var t=9===e.nodeType?e:e.ownerDocument;null===t||t[Qu]||(t[Qu]=!0,Ju("selectionchange",!1,t))}}function ed(e,t,r,n){switch(kh(t)){case 2:var i=xh;break;case 8:i=bh;break;default:i=wh}r=i.bind(null,t,r,e),i=void 0,!Vt||"touchstart"!==t&&"touchmove"!==t&&"wheel"!==t||(i=!0),n?void 0!==i?e.addEventListener(t,r,{capture:!0,passive:i}):e.addEventListener(t,r,!0):void 0!==i?e.addEventListener(t,r,{passive:i}):e.addEventListener(t,r,!1)}function td(e,t,r,n,i){var s=n;if(0===(1&t)&&0===(2&t)&&null!==n)e:for(;;){if(null===n)return;var o=n.tag;if(3===o||4===o){var a=n.stateNode.containerInfo;if(a===i)break;if(4===o)for(o=n.return;null!==o;){var c=o.tag;if((3===c||4===c)&&o.stateNode.containerInfo===i)return;o=o.return}for(;null!==a;){if(null===(o=Xe(a)))return;if(5===(c=o.tag)||6===c||26===c||27===c){n=s=o;continue e}a=a.parentNode}}n=n.return}zt(function(){var n=s,i=Lt(r),o=[];e:{var a=jn.get(e);if(void 0!==a){var c=rr,u=e;switch(e){case"keypress":if(0===Kt(r))break e;case"keydown":case"keyup":c=yr;break;case"focusin":u="focus",c=lr;break;case"focusout":u="blur",c=lr;break;case"beforeblur":case"afterblur":c=lr;break;case"click":if(2===r.button)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":c=or;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":c=ar;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":c=vr;break;case gn:case yn:case _n:c=cr;break;case wn:c=xr;break;case"scroll":case"scrollend":c=ir;break;case"wheel":c=br;break;case"copy":case"cut":case"paste":c=ur;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":c=_r;break;case"toggle":case"beforetoggle":c=wr}var d=0!==(4&t),h=!d&&("scroll"===e||"scrollend"===e),p=d?null!==a?a+"Capture":null:a;d=[];for(var m,f=n;null!==f;){var g=f;if(m=g.stateNode,5!==(g=g.tag)&&26!==g&&27!==g||null===m||null===p||null!=(g=Bt(f,p))&&d.push(rd(f,g,m)),h)break;f=f.return}0<d.length&&(a=new c(a,u,null,r,i),o.push({event:a,listeners:d}))}}if(0===(7&t)){if(c="mouseout"===e||"pointerout"===e,(!(a="mouseover"===e||"pointerover"===e)||r===Mt||!(u=r.relatedTarget||r.fromElement)||!Xe(u)&&!u[qe])&&(c||a)&&(a=i.window===i?i:(a=i.ownerDocument)?a.defaultView||a.parentWindow:window,c?(c=n,null!==(u=(u=r.relatedTarget||r.toElement)?Xe(u):null)&&(h=l(u),d=u.tag,u!==h||5!==d&&27!==d&&6!==d)&&(u=null)):(c=null,u=n),c!==u)){if(d=or,g="onMouseLeave",p="onMouseEnter",f="mouse","pointerout"!==e&&"pointerover"!==e||(d=_r,g="onPointerLeave",p="onPointerEnter",f="pointer"),h=null==c?a:Qe(c),m=null==u?a:Qe(u),(a=new d(g,f+"leave",c,r,i)).target=h,a.relatedTarget=m,g=null,Xe(i)===n&&((d=new d(p,f+"enter",u,r,i)).target=m,d.relatedTarget=h,g=d),h=g,c&&u)e:{for(d=id,f=u,m=0,g=p=c;g;g=d(g))m++;g=0;for(var y=f;y;y=d(y))g++;for(;0<m-g;)p=d(p),m--;for(;0<g-m;)f=d(f),g--;for(;m--;){if(p===f||null!==f&&p===f.alternate){d=p;break e}p=d(p),f=d(f)}d=null}else d=null;null!==c&&sd(o,a,c,d,!1),null!==u&&null!==h&&sd(o,h,u,d,!0)}if("select"===(c=(a=n?Qe(n):window).nodeName&&a.nodeName.toLowerCase())||"input"===c&&"file"===a.type)var _=Br;else if(Lr(a))if(Ur)_=Xr;else{_=Kr;var v=Zr}else!(c=a.nodeName)||"input"!==c.toLowerCase()||"checkbox"!==a.type&&"radio"!==a.type?n&&Ct(n.elementType)&&(_=Br):_=Yr;switch(_&&(_=_(e,n))?Rr(o,_,r,i):(v&&v(e,a,n),"focusout"===e&&n&&"number"===a.type&&null!=n.memoizedProps.value&&xt(a,"number",a.value)),v=n?Qe(n):window,e){case"focusin":(Lr(v)||"true"===v.contentEditable)&&(on=v,an=n,ln=null);break;case"focusout":ln=an=on=null;break;case"mousedown":cn=!0;break;case"contextmenu":case"mouseup":case"dragend":cn=!1,un(o,r,i);break;case"selectionchange":if(sn)break;case"keydown":case"keyup":un(o,r,i)}var x;if(Sr)e:{switch(e){case"compositionstart":var b="onCompositionStart";break e;case"compositionend":b="onCompositionEnd";break e;case"compositionupdate":b="onCompositionUpdate";break e}b=void 0}else Pr?Nr(e,r)&&(b="onCompositionEnd"):"keydown"===e&&229===r.keyCode&&(b="onCompositionStart");b&&(Ar&&"ko"!==r.locale&&(Pr||"onCompositionStart"!==b?"onCompositionEnd"===b&&Pr&&(x=Zt()):(Ht="value"in(Wt=i)?Wt.value:Wt.textContent,Pr=!0)),0<(v=nd(n,b)).length&&(b=new dr(b,e,null,r,i),o.push({event:b,listeners:v}),x?b.data=x:null!==(x=Ir(r))&&(b.data=x))),(x=kr?function(e,t){switch(e){case"compositionend":return Ir(t);case"keypress":return 32!==t.which?null:(Er=!0,Cr);case"textInput":return(e=t.data)===Cr&&Er?null:e;default:return null}}(e,r):function(e,t){if(Pr)return"compositionend"===e||!Sr&&Nr(e,t)?(e=Zt(),Gt=Ht=Wt=null,Pr=!1,e):null;switch(e){case"paste":default:return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return Ar&&"ko"!==t.locale?null:t.data}}(e,r))&&(0<(b=nd(n,"onBeforeInput")).length&&(v=new dr("onBeforeInput","beforeinput",null,r,i),o.push({event:v,listeners:b}),v.data=x)),function(e,t,r,n,i){if("submit"===t&&r&&r.stateNode===i){var s=qu((i[Ve]||null).action),o=n.submitter;o&&null!==(t=(t=o[Ve]||null)?qu(t.formAction):o.getAttribute("formAction"))&&(s=t,o=null);var a=new rr("action","action",null,n,i);e.push({event:a,listeners:[{instance:null,listener:function(){if(n.defaultPrevented){if(0!==Lu){var e=o?Wu(i,o):new FormData(i);ta(r,{pending:!0,data:e,method:i.method,action:s},null,e)}}else"function"===typeof s&&(a.preventDefault(),e=o?Wu(i,o):new FormData(i),ta(r,{pending:!0,data:e,method:i.method,action:s},s,e))},currentTarget:i}]})}}(o,e,n,r,i)}Yu(o,t)})}function rd(e,t,r){return{instance:e,listener:t,currentTarget:r}}function nd(e,t){for(var r=t+"Capture",n=[];null!==e;){var i=e,s=i.stateNode;if(5!==(i=i.tag)&&26!==i&&27!==i||null===s||(null!=(i=Bt(e,r))&&n.unshift(rd(e,i,s)),null!=(i=Bt(e,t))&&n.push(rd(e,i,s))),3===e.tag)return n;e=e.return}return[]}function id(e){if(null===e)return null;do{e=e.return}while(e&&5!==e.tag&&27!==e.tag);return e||null}function sd(e,t,r,n,i){for(var s=t._reactName,o=[];null!==r&&r!==n;){var a=r,l=a.alternate,c=a.stateNode;if(a=a.tag,null!==l&&l===n)break;5!==a&&26!==a&&27!==a||null===c||(l=c,i?null!=(c=Bt(r,s))&&o.unshift(rd(r,c,l)):i||null!=(c=Bt(r,s))&&o.push(rd(r,c,l))),r=r.return}0!==o.length&&e.push({event:t,listeners:o})}var od=/\r\n?/g,ad=/\u0000|\uFFFD/g;function ld(e){return("string"===typeof e?e:""+e).replace(od,"\n").replace(ad,"")}function cd(e,t){return t=ld(t),ld(e)===t}function ud(e,t,r,n,i,s){switch(r){case"children":"string"===typeof n?"body"===t||"textarea"===t&&""===n||St(e,n):("number"===typeof n||"bigint"===typeof n)&&"body"!==t&&St(e,""+n);break;case"className":ct(e,"class",n);break;case"tabIndex":ct(e,"tabindex",n);break;case"dir":case"role":case"viewBox":case"width":case"height":ct(e,r,n);break;case"style":At(e,n,s);break;case"data":if("object"!==t){ct(e,"data",n);break}case"src":case"href":if(""===n&&("a"!==t||"href"!==r)){e.removeAttribute(r);break}if(null==n||"function"===typeof n||"symbol"===typeof n||"boolean"===typeof n){e.removeAttribute(r);break}n=It(""+n),e.setAttribute(r,n);break;case"action":case"formAction":if("function"===typeof n){e.setAttribute(r,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}if("function"===typeof s&&("formAction"===r?("input"!==t&&ud(e,t,"name",i.name,i,null),ud(e,t,"formEncType",i.formEncType,i,null),ud(e,t,"formMethod",i.formMethod,i,null),ud(e,t,"formTarget",i.formTarget,i,null)):(ud(e,t,"encType",i.encType,i,null),ud(e,t,"method",i.method,i,null),ud(e,t,"target",i.target,i,null))),null==n||"symbol"===typeof n||"boolean"===typeof n){e.removeAttribute(r);break}n=It(""+n),e.setAttribute(r,n);break;case"onClick":null!=n&&(e.onclick=Pt);break;case"onScroll":null!=n&&Xu("scroll",e);break;case"onScrollEnd":null!=n&&Xu("scrollend",e);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(o(61));if(null!=(r=n.__html)){if(null!=i.children)throw Error(o(60));e.innerHTML=r}}break;case"multiple":e.multiple=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"muted":e.muted=n&&"function"!==typeof n&&"symbol"!==typeof n;break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":case"autoFocus":break;case"xlinkHref":if(null==n||"function"===typeof n||"boolean"===typeof n||"symbol"===typeof n){e.removeAttribute("xlink:href");break}r=It(""+n),e.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",r);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":null!=n&&"function"!==typeof n&&"symbol"!==typeof n?e.setAttribute(r,""+n):e.removeAttribute(r);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":n&&"function"!==typeof n&&"symbol"!==typeof n?e.setAttribute(r,""):e.removeAttribute(r);break;case"capture":case"download":!0===n?e.setAttribute(r,""):!1!==n&&null!=n&&"function"!==typeof n&&"symbol"!==typeof n?e.setAttribute(r,n):e.removeAttribute(r);break;case"cols":case"rows":case"size":case"span":null!=n&&"function"!==typeof n&&"symbol"!==typeof n&&!isNaN(n)&&1<=n?e.setAttribute(r,n):e.removeAttribute(r);break;case"rowSpan":case"start":null==n||"function"===typeof n||"symbol"===typeof n||isNaN(n)?e.removeAttribute(r):e.setAttribute(r,n);break;case"popover":Xu("beforetoggle",e),Xu("toggle",e),lt(e,"popover",n);break;case"xlinkActuate":ut(e,"http://www.w3.org/1999/xlink","xlink:actuate",n);break;case"xlinkArcrole":ut(e,"http://www.w3.org/1999/xlink","xlink:arcrole",n);break;case"xlinkRole":ut(e,"http://www.w3.org/1999/xlink","xlink:role",n);break;case"xlinkShow":ut(e,"http://www.w3.org/1999/xlink","xlink:show",n);break;case"xlinkTitle":ut(e,"http://www.w3.org/1999/xlink","xlink:title",n);break;case"xlinkType":ut(e,"http://www.w3.org/1999/xlink","xlink:type",n);break;case"xmlBase":ut(e,"http://www.w3.org/XML/1998/namespace","xml:base",n);break;case"xmlLang":ut(e,"http://www.w3.org/XML/1998/namespace","xml:lang",n);break;case"xmlSpace":ut(e,"http://www.w3.org/XML/1998/namespace","xml:space",n);break;case"is":lt(e,"is",n);break;case"innerText":case"textContent":break;default:(!(2<r.length)||"o"!==r[0]&&"O"!==r[0]||"n"!==r[1]&&"N"!==r[1])&&lt(e,r=Et.get(r)||r,n)}}function dd(e,t,r,n,i,s){switch(r){case"style":At(e,n,s);break;case"dangerouslySetInnerHTML":if(null!=n){if("object"!==typeof n||!("__html"in n))throw Error(o(61));if(null!=(r=n.__html)){if(null!=i.children)throw Error(o(60));e.innerHTML=r}}break;case"children":"string"===typeof n?St(e,n):("number"===typeof n||"bigint"===typeof n)&&St(e,""+n);break;case"onScroll":null!=n&&Xu("scroll",e);break;case"onScrollEnd":null!=n&&Xu("scrollend",e);break;case"onClick":null!=n&&(e.onclick=Pt);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":case"innerText":case"textContent":break;default:rt.hasOwnProperty(r)||("o"!==r[0]||"n"!==r[1]||(i=r.endsWith("Capture"),t=r.slice(2,i?r.length-7:void 0),"function"===typeof(s=null!=(s=e[Ve]||null)?s[r]:null)&&e.removeEventListener(t,s,i),"function"!==typeof n)?r in e?e[r]=n:!0===n?e.setAttribute(r,""):lt(e,r,n):("function"!==typeof s&&null!==s&&(r in e?e[r]=null:e.hasAttribute(r)&&e.removeAttribute(r)),e.addEventListener(t,n,i)))}}function hd(e,t,r){switch(t){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":Xu("error",e),Xu("load",e);var n,i=!1,s=!1;for(n in r)if(r.hasOwnProperty(n)){var a=r[n];if(null!=a)switch(n){case"src":i=!0;break;case"srcSet":s=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:ud(e,t,n,a,r,null)}}return s&&ud(e,t,"srcSet",r.srcSet,r,null),void(i&&ud(e,t,"src",r.src,r,null));case"input":Xu("invalid",e);var l=n=a=s=null,c=null,u=null;for(i in r)if(r.hasOwnProperty(i)){var d=r[i];if(null!=d)switch(i){case"name":s=d;break;case"type":a=d;break;case"checked":c=d;break;case"defaultChecked":u=d;break;case"value":n=d;break;case"defaultValue":l=d;break;case"children":case"dangerouslySetInnerHTML":if(null!=d)throw Error(o(137,t));break;default:ud(e,t,i,d,r,null)}}return void vt(e,n,l,c,u,a,s,!1);case"select":for(s in Xu("invalid",e),i=a=n=null,r)if(r.hasOwnProperty(s)&&null!=(l=r[s]))switch(s){case"value":n=l;break;case"defaultValue":a=l;break;case"multiple":i=l;default:ud(e,t,s,l,r,null)}return t=n,r=a,e.multiple=!!i,void(null!=t?bt(e,!!i,t,!1):null!=r&&bt(e,!!i,r,!0));case"textarea":for(a in Xu("invalid",e),n=s=i=null,r)if(r.hasOwnProperty(a)&&null!=(l=r[a]))switch(a){case"value":i=l;break;case"defaultValue":s=l;break;case"children":n=l;break;case"dangerouslySetInnerHTML":if(null!=l)throw Error(o(91));break;default:ud(e,t,a,l,r,null)}return void jt(e,i,s,n);case"option":for(c in r)if(r.hasOwnProperty(c)&&null!=(i=r[c]))if("selected"===c)e.selected=i&&"function"!==typeof i&&"symbol"!==typeof i;else ud(e,t,c,i,r,null);return;case"dialog":Xu("beforetoggle",e),Xu("toggle",e),Xu("cancel",e),Xu("close",e);break;case"iframe":case"object":Xu("load",e);break;case"video":case"audio":for(i=0;i<Zu.length;i++)Xu(Zu[i],e);break;case"image":Xu("error",e),Xu("load",e);break;case"details":Xu("toggle",e);break;case"embed":case"source":case"link":Xu("error",e),Xu("load",e);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(u in r)if(r.hasOwnProperty(u)&&null!=(i=r[u]))switch(u){case"children":case"dangerouslySetInnerHTML":throw Error(o(137,t));default:ud(e,t,u,i,r,null)}return;default:if(Ct(t)){for(d in r)r.hasOwnProperty(d)&&(void 0!==(i=r[d])&&dd(e,t,d,i,r,void 0));return}}for(l in r)r.hasOwnProperty(l)&&(null!=(i=r[l])&&ud(e,t,l,i,r,null))}function pd(e){switch(e){case"css":case"script":case"font":case"img":case"image":case"input":case"link":return!0;default:return!1}}var md=null,fd=null;function gd(e){return 9===e.nodeType?e:e.ownerDocument}function yd(e){switch(e){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function _d(e,t){if(0===e)switch(t){case"svg":return 1;case"math":return 2;default:return 0}return 1===e&&"foreignObject"===t?0:e}function vd(e,t){return"textarea"===e||"noscript"===e||"string"===typeof t.children||"number"===typeof t.children||"bigint"===typeof t.children||"object"===typeof t.dangerouslySetInnerHTML&&null!==t.dangerouslySetInnerHTML&&null!=t.dangerouslySetInnerHTML.__html}var xd=null;var bd="function"===typeof setTimeout?setTimeout:void 0,wd="function"===typeof clearTimeout?clearTimeout:void 0,jd="function"===typeof Promise?Promise:void 0,Sd="function"===typeof queueMicrotask?queueMicrotask:"undefined"!==typeof jd?function(e){return jd.resolve(null).then(e).catch(Td)}:bd;function Td(e){setTimeout(function(){throw e})}function kd(e){return"head"===e}function Ad(e,t){var r=t,n=0;do{var i=r.nextSibling;if(e.removeChild(r),i&&8===i.nodeType)if("/$"===(r=i.data)||"/&"===r){if(0===n)return e.removeChild(i),void Wh(t);n--}else if("$"===r||"$?"===r||"$~"===r||"$!"===r||"&"===r)n++;else if("html"===r)Od(e.ownerDocument.documentElement);else if("head"===r){Od(r=e.ownerDocument.head);for(var s=r.firstChild;s;){var o=s.nextSibling,a=s.nodeName;s[Ke]||"SCRIPT"===a||"STYLE"===a||"LINK"===a&&"stylesheet"===s.rel.toLowerCase()||r.removeChild(s),s=o}}else"body"===r&&Od(e.ownerDocument.body);r=i}while(r);Wh(t)}function Cd(e,t){var r=e;e=0;do{var n=r.nextSibling;if(1===r.nodeType?t?(r._stashedDisplay=r.style.display,r.style.display="none"):(r.style.display=r._stashedDisplay||"",""===r.getAttribute("style")&&r.removeAttribute("style")):3===r.nodeType&&(t?(r._stashedText=r.nodeValue,r.nodeValue=""):r.nodeValue=r._stashedText||""),n&&8===n.nodeType)if("/$"===(r=n.data)){if(0===e)break;e--}else"$"!==r&&"$?"!==r&&"$~"!==r&&"$!"!==r||e++;r=n}while(r)}function Ed(e){var t=e.firstChild;for(t&&10===t.nodeType&&(t=t.nextSibling);t;){var r=t;switch(t=t.nextSibling,r.nodeName){case"HTML":case"HEAD":case"BODY":Ed(r),Ye(r);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if("stylesheet"===r.rel.toLowerCase())continue}e.removeChild(r)}}function Nd(e,t){for(;8!==e.nodeType;){if((1!==e.nodeType||"INPUT"!==e.nodeName||"hidden"!==e.type)&&!t)return null;if(null===(e=Md(e.nextSibling)))return null}return e}function Id(e){return"$?"===e.data||"$~"===e.data}function Pd(e){return"$!"===e.data||"$?"===e.data&&"loading"!==e.ownerDocument.readyState}function Md(e){for(;null!=e;e=e.nextSibling){var t=e.nodeType;if(1===t||3===t)break;if(8===t){if("$"===(t=e.data)||"$!"===t||"$?"===t||"$~"===t||"&"===t||"F!"===t||"F"===t)break;if("/$"===t||"/&"===t)return null}}return e}var Ld=null;function Rd(e){e=e.nextSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("/$"===r||"/&"===r){if(0===t)return Md(e.nextSibling);t--}else"$"!==r&&"$!"!==r&&"$?"!==r&&"$~"!==r&&"&"!==r||t++}e=e.nextSibling}return null}function Dd(e){e=e.previousSibling;for(var t=0;e;){if(8===e.nodeType){var r=e.data;if("$"===r||"$!"===r||"$?"===r||"$~"===r||"&"===r){if(0===t)return e;t--}else"/$"!==r&&"/&"!==r||t++}e=e.previousSibling}return null}function Fd(e,t,r){switch(t=gd(r),e){case"html":if(!(e=t.documentElement))throw Error(o(452));return e;case"head":if(!(e=t.head))throw Error(o(453));return e;case"body":if(!(e=t.body))throw Error(o(454));return e;default:throw Error(o(451))}}function Od(e){for(var t=e.attributes;t.length;)e.removeAttributeNode(t[0]);Ye(e)}var zd=new Map,Bd=new Set;function Ud(e){return"function"===typeof e.getRootNode?e.getRootNode():9===e.nodeType?e:e.ownerDocument}var Vd=R.d;R.d={f:function(){var e=Vd.f(),t=$c();return e||t},r:function(e){var t=Je(e);null!==t&&5===t.tag&&"form"===t.type?na(t):Vd.r(e)},D:function(e){Vd.D(e),Wd("dns-prefetch",e,null)},C:function(e,t){Vd.C(e,t),Wd("preconnect",e,t)},L:function(e,t,r){Vd.L(e,t,r);var n=qd;if(n&&e&&t){var i='link[rel="preload"][as="'+yt(t)+'"]';"image"===t&&r&&r.imageSrcSet?(i+='[imagesrcset="'+yt(r.imageSrcSet)+'"]',"string"===typeof r.imageSizes&&(i+='[imagesizes="'+yt(r.imageSizes)+'"]')):i+='[href="'+yt(e)+'"]';var s=i;switch(t){case"style":s=Gd(e);break;case"script":s=Yd(e)}zd.has(s)||(e=p({rel:"preload",href:"image"===t&&r&&r.imageSrcSet?void 0:e,as:t},r),zd.set(s,e),null!==n.querySelector(i)||"style"===t&&n.querySelector(Zd(s))||"script"===t&&n.querySelector(Xd(s))||(hd(t=n.createElement("link"),"link",e),et(t),n.head.appendChild(t)))}},m:function(e,t){Vd.m(e,t);var r=qd;if(r&&e){var n=t&&"string"===typeof t.as?t.as:"script",i='link[rel="modulepreload"][as="'+yt(n)+'"][href="'+yt(e)+'"]',s=i;switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":s=Yd(e)}if(!zd.has(s)&&(e=p({rel:"modulepreload",href:e},t),zd.set(s,e),null===r.querySelector(i))){switch(n){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(r.querySelector(Xd(s)))return}hd(n=r.createElement("link"),"link",e),et(n),r.head.appendChild(n)}}},X:function(e,t){Vd.X(e,t);var r=qd;if(r&&e){var n=$e(r).hoistableScripts,i=Yd(e),s=n.get(i);s||((s=r.querySelector(Xd(i)))||(e=p({src:e,async:!0},t),(t=zd.get(i))&&eh(e,t),et(s=r.createElement("script")),hd(s,"link",e),r.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},n.set(i,s))}},S:function(e,t,r){Vd.S(e,t,r);var n=qd;if(n&&e){var i=$e(n).hoistableStyles,s=Gd(e);t=t||"default";var o=i.get(s);if(!o){var a={loading:0,preload:null};if(o=n.querySelector(Zd(s)))a.loading=5;else{e=p({rel:"stylesheet",href:e,"data-precedence":t},r),(r=zd.get(s))&&$d(e,r);var l=o=n.createElement("link");et(l),hd(l,"link",e),l._p=new Promise(function(e,t){l.onload=e,l.onerror=t}),l.addEventListener("load",function(){a.loading|=1}),l.addEventListener("error",function(){a.loading|=2}),a.loading|=4,Qd(o,t,n)}o={type:"stylesheet",instance:o,count:1,state:a},i.set(s,o)}}},M:function(e,t){Vd.M(e,t);var r=qd;if(r&&e){var n=$e(r).hoistableScripts,i=Yd(e),s=n.get(i);s||((s=r.querySelector(Xd(i)))||(e=p({src:e,async:!0,type:"module"},t),(t=zd.get(i))&&eh(e,t),et(s=r.createElement("script")),hd(s,"link",e),r.head.appendChild(s)),s={type:"script",instance:s,count:1,state:null},n.set(i,s))}}};var qd="undefined"===typeof document?null:document;function Wd(e,t,r){var n=qd;if(n&&"string"===typeof t&&t){var i=yt(t);i='link[rel="'+e+'"][href="'+i+'"]',"string"===typeof r&&(i+='[crossorigin="'+r+'"]'),Bd.has(i)||(Bd.add(i),e={rel:e,crossOrigin:r,href:t},null===n.querySelector(i)&&(hd(t=n.createElement("link"),"link",e),et(t),n.head.appendChild(t)))}}function Hd(e,t,r,n){var i,s,a,l,c=(c=G.current)?Ud(c):null;if(!c)throw Error(o(446));switch(e){case"meta":case"title":return null;case"style":return"string"===typeof r.precedence&&"string"===typeof r.href?(t=Gd(r.href),(n=(r=$e(c).hoistableStyles).get(t))||(n={type:"style",instance:null,count:0,state:null},r.set(t,n)),n):{type:"void",instance:null,count:0,state:null};case"link":if("stylesheet"===r.rel&&"string"===typeof r.href&&"string"===typeof r.precedence){e=Gd(r.href);var u=$e(c).hoistableStyles,d=u.get(e);if(d||(c=c.ownerDocument||c,d={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},u.set(e,d),(u=c.querySelector(Zd(e)))&&!u._p&&(d.instance=u,d.state.loading=5),zd.has(e)||(r={rel:"preload",as:"style",href:r.href,crossOrigin:r.crossOrigin,integrity:r.integrity,media:r.media,hrefLang:r.hrefLang,referrerPolicy:r.referrerPolicy},zd.set(e,r),u||(i=c,s=e,a=r,l=d.state,i.querySelector('link[rel="preload"][as="style"]['+s+"]")?l.loading=1:(s=i.createElement("link"),l.preload=s,s.addEventListener("load",function(){return l.loading|=1}),s.addEventListener("error",function(){return l.loading|=2}),hd(s,"link",a),et(s),i.head.appendChild(s))))),t&&null===n)throw Error(o(528,""));return d}if(t&&null!==n)throw Error(o(529,""));return null;case"script":return t=r.async,"string"===typeof(r=r.src)&&t&&"function"!==typeof t&&"symbol"!==typeof t?(t=Yd(r),(n=(r=$e(c).hoistableScripts).get(t))||(n={type:"script",instance:null,count:0,state:null},r.set(t,n)),n):{type:"void",instance:null,count:0,state:null};default:throw Error(o(444,e))}}function Gd(e){return'href="'+yt(e)+'"'}function Zd(e){return'link[rel="stylesheet"]['+e+"]"}function Kd(e){return p({},e,{"data-precedence":e.precedence,precedence:null})}function Yd(e){return'[src="'+yt(e)+'"]'}function Xd(e){return"script[async]"+e}function Jd(e,t,r){if(t.count++,null===t.instance)switch(t.type){case"style":var n=e.querySelector('style[data-href~="'+yt(r.href)+'"]');if(n)return t.instance=n,et(n),n;var i=p({},r,{"data-href":r.href,"data-precedence":r.precedence,href:null,precedence:null});return et(n=(e.ownerDocument||e).createElement("style")),hd(n,"style",i),Qd(n,r.precedence,e),t.instance=n;case"stylesheet":i=Gd(r.href);var s=e.querySelector(Zd(i));if(s)return t.state.loading|=4,t.instance=s,et(s),s;n=Kd(r),(i=zd.get(i))&&$d(n,i),et(s=(e.ownerDocument||e).createElement("link"));var a=s;return a._p=new Promise(function(e,t){a.onload=e,a.onerror=t}),hd(s,"link",n),t.state.loading|=4,Qd(s,r.precedence,e),t.instance=s;case"script":return s=Yd(r.src),(i=e.querySelector(Xd(s)))?(t.instance=i,et(i),i):(n=r,(i=zd.get(s))&&eh(n=p({},r),i),et(i=(e=e.ownerDocument||e).createElement("script")),hd(i,"link",n),e.head.appendChild(i),t.instance=i);case"void":return null;default:throw Error(o(443,t.type))}else"stylesheet"===t.type&&0===(4&t.state.loading)&&(n=t.instance,t.state.loading|=4,Qd(n,r.precedence,e));return t.instance}function Qd(e,t,r){for(var n=r.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),i=n.length?n[n.length-1]:null,s=i,o=0;o<n.length;o++){var a=n[o];if(a.dataset.precedence===t)s=a;else if(s!==i)break}s?s.parentNode.insertBefore(e,s.nextSibling):(t=9===r.nodeType?r.head:r).insertBefore(e,t.firstChild)}function $d(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.title&&(e.title=t.title)}function eh(e,t){null==e.crossOrigin&&(e.crossOrigin=t.crossOrigin),null==e.referrerPolicy&&(e.referrerPolicy=t.referrerPolicy),null==e.integrity&&(e.integrity=t.integrity)}var th=null;function rh(e,t,r){if(null===th){var n=new Map,i=th=new Map;i.set(r,n)}else(n=(i=th).get(r))||(n=new Map,i.set(r,n));if(n.has(e))return n;for(n.set(e,null),r=r.getElementsByTagName(e),i=0;i<r.length;i++){var s=r[i];if(!(s[Ke]||s[Ue]||"link"===e&&"stylesheet"===s.getAttribute("rel"))&&"http://www.w3.org/2000/svg"!==s.namespaceURI){var o=s.getAttribute(t)||"";o=e+o;var a=n.get(o);a?a.push(s):n.set(o,[s])}}return n}function nh(e,t,r){(e=e.ownerDocument||e).head.insertBefore(r,"title"===t?e.querySelector("head > title"):null)}function ih(e){return"stylesheet"!==e.type||0!==(3&e.state.loading)}var sh=0;function oh(){if(this.count--,0===this.count&&(0===this.imgCount||!this.waitingForImages))if(this.stylesheets)lh(this,this.stylesheets);else if(this.unsuspend){var e=this.unsuspend;this.unsuspend=null,e()}}var ah=null;function lh(e,t){e.stylesheets=null,null!==e.unsuspend&&(e.count++,ah=new Map,t.forEach(ch,e),ah=null,oh.call(e))}function ch(e,t){if(!(4&t.state.loading)){var r=ah.get(e);if(r)var n=r.get(null);else{r=new Map,ah.set(e,r);for(var i=e.querySelectorAll("link[data-precedence],style[data-precedence]"),s=0;s<i.length;s++){var o=i[s];"LINK"!==o.nodeName&&"not all"===o.getAttribute("media")||(r.set(o.dataset.precedence,o),n=o)}n&&r.set(null,n)}o=(i=t.instance).getAttribute("data-precedence"),(s=r.get(o)||n)===n&&r.set(null,i),r.set(o,i),this.count++,n=oh.bind(this),i.addEventListener("load",n),i.addEventListener("error",n),s?s.parentNode.insertBefore(i,s.nextSibling):(e=9===e.nodeType?e.head:e).insertBefore(i,e.firstChild),t.state.loading|=4}}var uh={$$typeof:b,Provider:null,Consumer:null,_currentValue:D,_currentValue2:D,_threadCount:0};function dh(e,t,r,n,i,s,o,a,l){this.tag=1,this.containerInfo=e,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Ie(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ie(0),this.hiddenUpdates=Ie(null),this.identifierPrefix=n,this.onUncaughtError=i,this.onCaughtError=s,this.onRecoverableError=o,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=l,this.incompleteTransitions=new Map}function hh(e,t,r,n,i,s,o,a,l,c,u,d){return e=new dh(e,t,r,o,l,c,u,d,a),t=1,!0===s&&(t|=24),s=On(3,null,null,t),e.current=s,s.stateNode=e,(t=zi()).refCount++,e.pooledCache=t,t.refCount++,s.memoizedState={element:n,isDehydrated:r,cache:t},gs(s),e}function ph(e){return e?e=Dn:Dn}function mh(e,t,r,n,i,s){i=ph(i),null===n.context?n.context=i:n.pendingContext=i,(n=_s(t)).payload={element:r},null!==(s=void 0===s?null:s)&&(n.callback=s),null!==(r=vs(e,n,t))&&(Kc(r,0,t),xs(r,e,t))}function fh(e,t){if(null!==(e=e.memoizedState)&&null!==e.dehydrated){var r=e.retryLane;e.retryLane=0!==r&&r<t?r:t}}function gh(e,t){fh(e,t),(e=e.alternate)&&fh(e,t)}function yh(e){if(13===e.tag||31===e.tag){var t=Mn(e,67108864);null!==t&&Kc(t,0,67108864),gh(e,67108864)}}function _h(e){if(13===e.tag||31===e.tag){var t=Gc(),r=Mn(e,t=De(t));null!==r&&Kc(r,0,t),gh(e,t)}}var vh=!0;function xh(e,t,r,n){var i=L.T;L.T=null;var s=R.p;try{R.p=2,wh(e,t,r,n)}finally{R.p=s,L.T=i}}function bh(e,t,r,n){var i=L.T;L.T=null;var s=R.p;try{R.p=8,wh(e,t,r,n)}finally{R.p=s,L.T=i}}function wh(e,t,r,n){if(vh){var i=jh(n);if(null===i)td(e,t,n,Sh,r),Rh(e,n);else if(function(e,t,r,n,i){switch(t){case"focusin":return Ch=Dh(Ch,e,t,r,n,i),!0;case"dragenter":return Eh=Dh(Eh,e,t,r,n,i),!0;case"mouseover":return Nh=Dh(Nh,e,t,r,n,i),!0;case"pointerover":var s=i.pointerId;return Ih.set(s,Dh(Ih.get(s)||null,e,t,r,n,i)),!0;case"gotpointercapture":return s=i.pointerId,Ph.set(s,Dh(Ph.get(s)||null,e,t,r,n,i)),!0}return!1}(i,e,t,r,n))n.stopPropagation();else if(Rh(e,n),4&t&&-1<Lh.indexOf(e)){for(;null!==i;){var s=Je(i);if(null!==s)switch(s.tag){case 3:if((s=s.stateNode).current.memoizedState.isDehydrated){var o=ke(s.pendingLanes);if(0!==o){var a=s;for(a.pendingLanes|=2,a.entangledLanes|=2;o;){var l=1<<31-xe(o);a.entanglements[1]|=l,o&=~l}Ru(s),0===(6&pc)&&(Lc=le()+500,Du(0,!1))}}break;case 31:case 13:null!==(a=Mn(s,2))&&Kc(a,0,2),$c(),gh(s,2)}if(null===(s=jh(n))&&td(e,t,n,Sh,r),s===i)break;i=s}null!==i&&n.stopPropagation()}else td(e,t,n,null,r)}}function jh(e){return Th(e=Lt(e))}var Sh=null;function Th(e){if(Sh=null,null!==(e=Xe(e))){var t=l(e);if(null===t)e=null;else{var r=t.tag;if(13===r){if(null!==(e=c(t)))return e;e=null}else if(31===r){if(null!==(e=u(t)))return e;e=null}else if(3===r){if(t.stateNode.current.memoizedState.isDehydrated)return 3===t.tag?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null)}}return Sh=e,null}function kh(e){switch(e){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(ce()){case ue:return 2;case de:return 8;case he:case pe:return 32;case me:return 268435456;default:return 32}default:return 32}}var Ah=!1,Ch=null,Eh=null,Nh=null,Ih=new Map,Ph=new Map,Mh=[],Lh="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function Rh(e,t){switch(e){case"focusin":case"focusout":Ch=null;break;case"dragenter":case"dragleave":Eh=null;break;case"mouseover":case"mouseout":Nh=null;break;case"pointerover":case"pointerout":Ih.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":Ph.delete(t.pointerId)}}function Dh(e,t,r,n,i,s){return null===e||e.nativeEvent!==s?(e={blockedOn:t,domEventName:r,eventSystemFlags:n,nativeEvent:s,targetContainers:[i]},null!==t&&(null!==(t=Je(t))&&yh(t)),e):(e.eventSystemFlags|=n,t=e.targetContainers,null!==i&&-1===t.indexOf(i)&&t.push(i),e)}function Fh(e){var t=Xe(e.target);if(null!==t){var r=l(t);if(null!==r)if(13===(t=r.tag)){if(null!==(t=c(r)))return e.blockedOn=t,void ze(e.priority,function(){_h(r)})}else if(31===t){if(null!==(t=u(r)))return e.blockedOn=t,void ze(e.priority,function(){_h(r)})}else if(3===t&&r.stateNode.current.memoizedState.isDehydrated)return void(e.blockedOn=3===r.tag?r.stateNode.containerInfo:null)}e.blockedOn=null}function Oh(e){if(null!==e.blockedOn)return!1;for(var t=e.targetContainers;0<t.length;){var r=jh(e.nativeEvent);if(null!==r)return null!==(t=Je(r))&&yh(t),e.blockedOn=r,!1;var n=new(r=e.nativeEvent).constructor(r.type,r);Mt=n,r.target.dispatchEvent(n),Mt=null,t.shift()}return!0}function zh(e,t,r){Oh(e)&&r.delete(t)}function Bh(){Ah=!1,null!==Ch&&Oh(Ch)&&(Ch=null),null!==Eh&&Oh(Eh)&&(Eh=null),null!==Nh&&Oh(Nh)&&(Nh=null),Ih.forEach(zh),Ph.forEach(zh)}function Uh(e,t){e.blockedOn===t&&(e.blockedOn=null,Ah||(Ah=!0,n.unstable_scheduleCallback(n.unstable_NormalPriority,Bh)))}var Vh=null;function qh(e){Vh!==e&&(Vh=e,n.unstable_scheduleCallback(n.unstable_NormalPriority,function(){Vh===e&&(Vh=null);for(var t=0;t<e.length;t+=3){var r=e[t],n=e[t+1],i=e[t+2];if("function"!==typeof n){if(null===Th(n||r))continue;break}var s=Je(r);null!==s&&(e.splice(t,3),t-=3,ta(s,{pending:!0,data:i,method:r.method,action:n},n,i))}}))}function Wh(e){function t(t){return Uh(t,e)}null!==Ch&&Uh(Ch,e),null!==Eh&&Uh(Eh,e),null!==Nh&&Uh(Nh,e),Ih.forEach(t),Ph.forEach(t);for(var r=0;r<Mh.length;r++){var n=Mh[r];n.blockedOn===e&&(n.blockedOn=null)}for(;0<Mh.length&&null===(r=Mh[0]).blockedOn;)Fh(r),null===r.blockedOn&&Mh.shift();if(null!=(r=(e.ownerDocument||e).$$reactFormReplay))for(n=0;n<r.length;n+=3){var i=r[n],s=r[n+1],o=i[Ve]||null;if("function"===typeof s)o||qh(r);else if(o){var a=null;if(s&&s.hasAttribute("formAction")){if(i=s,o=s[Ve]||null)a=o.formAction;else if(null!==Th(i))continue}else a=o.action;"function"===typeof a?r[n+1]=a:(r.splice(n,3),n-=3),qh(r)}}}function Hh(){function e(e){e.canIntercept&&"react-transition"===e.info&&e.intercept({handler:function(){return new Promise(function(e){return i=e})},focusReset:"manual",scroll:"manual"})}function t(){null!==i&&(i(),i=null),n||setTimeout(r,20)}function r(){if(!n&&!navigation.transition){var e=navigation.currentEntry;e&&null!=e.url&&navigation.navigate(e.url,{state:e.getState(),info:"react-transition",history:"replace"})}}if("object"===typeof navigation){var n=!1,i=null;return navigation.addEventListener("navigate",e),navigation.addEventListener("navigatesuccess",t),navigation.addEventListener("navigateerror",t),setTimeout(r,100),function(){n=!0,navigation.removeEventListener("navigate",e),navigation.removeEventListener("navigatesuccess",t),navigation.removeEventListener("navigateerror",t),null!==i&&(i(),i=null)}}}function Gh(e){this._internalRoot=e}function Zh(e){this._internalRoot=e}Zh.prototype.render=Gh.prototype.render=function(e){var t=this._internalRoot;if(null===t)throw Error(o(409));mh(t.current,Gc(),e,t,null,null)},Zh.prototype.unmount=Gh.prototype.unmount=function(){var e=this._internalRoot;if(null!==e){this._internalRoot=null;var t=e.containerInfo;mh(e.current,2,null,e,null,null),$c(),t[qe]=null}},Zh.prototype.unstable_scheduleHydration=function(e){if(e){var t=Oe();e={blockedOn:null,target:e,priority:t};for(var r=0;r<Mh.length&&0!==t&&t<Mh[r].priority;r++);Mh.splice(r,0,e),0===r&&Fh(e)}};var Kh=i.version;if("19.2.3"!==Kh)throw Error(o(527,Kh,"19.2.3"));R.findDOMNode=function(e){var t=e._reactInternals;if(void 0===t){if("function"===typeof e.render)throw Error(o(188));throw e=Object.keys(e).join(","),Error(o(268,e))}return e=function(e){var t=e.alternate;if(!t){if(null===(t=l(e)))throw Error(o(188));return t!==e?null:e}for(var r=e,n=t;;){var i=r.return;if(null===i)break;var s=i.alternate;if(null===s){if(null!==(n=i.return)){r=n;continue}break}if(i.child===s.child){for(s=i.child;s;){if(s===r)return d(i),e;if(s===n)return d(i),t;s=s.sibling}throw Error(o(188))}if(r.return!==n.return)r=i,n=s;else{for(var a=!1,c=i.child;c;){if(c===r){a=!0,r=i,n=s;break}if(c===n){a=!0,n=i,r=s;break}c=c.sibling}if(!a){for(c=s.child;c;){if(c===r){a=!0,r=s,n=i;break}if(c===n){a=!0,n=s,r=i;break}c=c.sibling}if(!a)throw Error(o(189))}}if(r.alternate!==n)throw Error(o(190))}if(3!==r.tag)throw Error(o(188));return r.stateNode.current===r?e:t}(t),e=null===(e=null!==e?h(e):null)?null:e.stateNode};var Yh={bundleType:0,version:"19.2.3",rendererPackageName:"react-dom",currentDispatcherRef:L,reconcilerVersion:"19.2.3"};if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__){var Xh=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xh.isDisabled&&Xh.supportsFiber)try{ye=Xh.inject(Yh),_e=Xh}catch(Qh){}}t.createRoot=function(e,t){if(!a(e))throw Error(o(299));var r=!1,n="",i=Sa,s=Ta,l=ka;return null!==t&&void 0!==t&&(!0===t.unstable_strictMode&&(r=!0),void 0!==t.identifierPrefix&&(n=t.identifierPrefix),void 0!==t.onUncaughtError&&(i=t.onUncaughtError),void 0!==t.onCaughtError&&(s=t.onCaughtError),void 0!==t.onRecoverableError&&(l=t.onRecoverableError)),t=hh(e,1,!1,null,0,r,n,null,i,s,l,Hh),e[qe]=t.current,$u(e),new Gh(t)},t.hydrateRoot=function(e,t,r){if(!a(e))throw Error(o(299));var n=!1,i="",s=Sa,l=Ta,c=ka,u=null;return null!==r&&void 0!==r&&(!0===r.unstable_strictMode&&(n=!0),void 0!==r.identifierPrefix&&(i=r.identifierPrefix),void 0!==r.onUncaughtError&&(s=r.onUncaughtError),void 0!==r.onCaughtError&&(l=r.onCaughtError),void 0!==r.onRecoverableError&&(c=r.onRecoverableError),void 0!==r.formState&&(u=r.formState)),(t=hh(e,1,!0,t,0,n,i,u,s,l,c,Hh)).context=ph(null),r=t.current,(i=_s(n=De(n=Gc()))).callback=null,vs(r,i,n),r=n,t.current.lanes=r,Pe(t,r),Ru(t),e[qe]=t.current,$u(e),new Zh(t)},t.version="19.2.3"},43(e,t,r){"use strict";e.exports=r(288)},54(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("circle-check-big",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]])},87(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]])},118(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["path",{d:"M16 3.128a4 4 0 0 1 0 7.744",key:"16gr8j"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},254(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("user-check",[["path",{d:"m16 11 2 2 4-4",key:"9rsbq5"}],["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}]])},288(e,t){"use strict";var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.portal"),i=Symbol.for("react.fragment"),s=Symbol.for("react.strict_mode"),o=Symbol.for("react.profiler"),a=Symbol.for("react.consumer"),l=Symbol.for("react.context"),c=Symbol.for("react.forward_ref"),u=Symbol.for("react.suspense"),d=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),p=Symbol.for("react.activity"),m=Symbol.iterator;var f={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},g=Object.assign,y={};function _(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||f}function v(){}function x(e,t,r){this.props=e,this.context=t,this.refs=y,this.updater=r||f}_.prototype.isReactComponent={},_.prototype.setState=function(e,t){if("object"!==typeof e&&"function"!==typeof e&&null!=e)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,t,"setState")},_.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")},v.prototype=_.prototype;var b=x.prototype=new v;b.constructor=x,g(b,_.prototype),b.isPureReactComponent=!0;var w=Array.isArray;function j(){}var S={H:null,A:null,T:null,S:null},T=Object.prototype.hasOwnProperty;function k(e,t,n){var i=n.ref;return{$$typeof:r,type:e,key:t,ref:void 0!==i?i:null,props:n}}function A(e){return"object"===typeof e&&null!==e&&e.$$typeof===r}var C=/\/+/g;function E(e,t){return"object"===typeof e&&null!==e&&null!=e.key?function(e){var t={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(e){return t[e]})}(""+e.key):t.toString(36)}function N(e,t,i,s,o){var a=typeof e;"undefined"!==a&&"boolean"!==a||(e=null);var l,c,u=!1;if(null===e)u=!0;else switch(a){case"bigint":case"string":case"number":u=!0;break;case"object":switch(e.$$typeof){case r:case n:u=!0;break;case h:return N((u=e._init)(e._payload),t,i,s,o)}}if(u)return o=o(e),u=""===s?"."+E(e,0):s,w(o)?(i="",null!=u&&(i=u.replace(C,"$&/")+"/"),N(o,t,i,"",function(e){return e})):null!=o&&(A(o)&&(l=o,c=i+(null==o.key||e&&e.key===o.key?"":(""+o.key).replace(C,"$&/")+"/")+u,o=k(l.type,c,l.props)),t.push(o)),1;u=0;var d,p=""===s?".":s+":";if(w(e))for(var f=0;f<e.length;f++)u+=N(s=e[f],t,i,a=p+E(s,f),o);else if("function"===typeof(f=null===(d=e)||"object"!==typeof d?null:"function"===typeof(d=m&&d[m]||d["@@iterator"])?d:null))for(e=f.call(e),f=0;!(s=e.next()).done;)u+=N(s=s.value,t,i,a=p+E(s,f++),o);else if("object"===a){if("function"===typeof e.then)return N(function(e){switch(e.status){case"fulfilled":return e.value;case"rejected":throw e.reason;default:switch("string"===typeof e.status?e.then(j,j):(e.status="pending",e.then(function(t){"pending"===e.status&&(e.status="fulfilled",e.value=t)},function(t){"pending"===e.status&&(e.status="rejected",e.reason=t)})),e.status){case"fulfilled":return e.value;case"rejected":throw e.reason}}throw e}(e),t,i,s,o);throw t=String(e),Error("Objects are not valid as a React child (found: "+("[object Object]"===t?"object with keys {"+Object.keys(e).join(", ")+"}":t)+"). If you meant to render a collection of children, use an array instead.")}return u}function I(e,t,r){if(null==e)return e;var n=[],i=0;return N(e,n,"","",function(e){return t.call(r,e,i++)}),n}function P(e){if(-1===e._status){var t=e._result;(t=t()).then(function(t){0!==e._status&&-1!==e._status||(e._status=1,e._result=t)},function(t){0!==e._status&&-1!==e._status||(e._status=2,e._result=t)}),-1===e._status&&(e._status=0,e._result=t)}if(1===e._status)return e._result.default;throw e._result}var M="function"===typeof reportError?reportError:function(e){if("object"===typeof window&&"function"===typeof window.ErrorEvent){var t=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:"object"===typeof e&&null!==e&&"string"===typeof e.message?String(e.message):String(e),error:e});if(!window.dispatchEvent(t))return}else if("object"===typeof process&&"function"===typeof process.emit)return void process.emit("uncaughtException",e);console.error(e)},L={map:I,forEach:function(e,t,r){I(e,function(){t.apply(this,arguments)},r)},count:function(e){var t=0;return I(e,function(){t++}),t},toArray:function(e){return I(e,function(e){return e})||[]},only:function(e){if(!A(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};t.Activity=p,t.Children=L,t.Component=_,t.Fragment=i,t.Profiler=o,t.PureComponent=x,t.StrictMode=s,t.Suspense=u,t.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=S,t.__COMPILER_RUNTIME={__proto__:null,c:function(e){return S.H.useMemoCache(e)}},t.cache=function(e){return function(){return e.apply(null,arguments)}},t.cacheSignal=function(){return null},t.cloneElement=function(e,t,r){if(null===e||void 0===e)throw Error("The argument must be a React element, but you passed "+e+".");var n=g({},e.props),i=e.key;if(null!=t)for(s in void 0!==t.key&&(i=""+t.key),t)!T.call(t,s)||"key"===s||"__self"===s||"__source"===s||"ref"===s&&void 0===t.ref||(n[s]=t[s]);var s=arguments.length-2;if(1===s)n.children=r;else if(1<s){for(var o=Array(s),a=0;a<s;a++)o[a]=arguments[a+2];n.children=o}return k(e.type,i,n)},t.createContext=function(e){return(e={$$typeof:l,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null}).Provider=e,e.Consumer={$$typeof:a,_context:e},e},t.createElement=function(e,t,r){var n,i={},s=null;if(null!=t)for(n in void 0!==t.key&&(s=""+t.key),t)T.call(t,n)&&"key"!==n&&"__self"!==n&&"__source"!==n&&(i[n]=t[n]);var o=arguments.length-2;if(1===o)i.children=r;else if(1<o){for(var a=Array(o),l=0;l<o;l++)a[l]=arguments[l+2];i.children=a}if(e&&e.defaultProps)for(n in o=e.defaultProps)void 0===i[n]&&(i[n]=o[n]);return k(e,s,i)},t.createRef=function(){return{current:null}},t.forwardRef=function(e){return{$$typeof:c,render:e}},t.isValidElement=A,t.lazy=function(e){return{$$typeof:h,_payload:{_status:-1,_result:e},_init:P}},t.memo=function(e,t){return{$$typeof:d,type:e,compare:void 0===t?null:t}},t.startTransition=function(e){var t=S.T,r={};S.T=r;try{var n=e(),i=S.S;null!==i&&i(r,n),"object"===typeof n&&null!==n&&"function"===typeof n.then&&n.then(j,M)}catch(s){M(s)}finally{null!==t&&null!==r.types&&(t.types=r.types),S.T=t}},t.unstable_useCacheRefresh=function(){return S.H.useCacheRefresh()},t.use=function(e){return S.H.use(e)},t.useActionState=function(e,t,r){return S.H.useActionState(e,t,r)},t.useCallback=function(e,t){return S.H.useCallback(e,t)},t.useContext=function(e){return S.H.useContext(e)},t.useDebugValue=function(){},t.useDeferredValue=function(e,t){return S.H.useDeferredValue(e,t)},t.useEffect=function(e,t){return S.H.useEffect(e,t)},t.useEffectEvent=function(e){return S.H.useEffectEvent(e)},t.useId=function(){return S.H.useId()},t.useImperativeHandle=function(e,t,r){return S.H.useImperativeHandle(e,t,r)},t.useInsertionEffect=function(e,t){return S.H.useInsertionEffect(e,t)},t.useLayoutEffect=function(e,t){return S.H.useLayoutEffect(e,t)},t.useMemo=function(e,t){return S.H.useMemo(e,t)},t.useOptimistic=function(e,t){return S.H.useOptimistic(e,t)},t.useReducer=function(e,t,r){return S.H.useReducer(e,t,r)},t.useRef=function(e){return S.H.useRef(e)},t.useState=function(e){return S.H.useState(e)},t.useSyncExternalStore=function(e,t,r){return S.H.useSyncExternalStore(e,t,r)},t.useTransition=function(){return S.H.useTransition()},t.version="19.2.3"},295(e,t,r){"use strict";r.d(t,{A:()=>s});var n=r(43),i=r(579);const s=e=>{let{isOpen:t,onClose:r,onConfirm:s}=e;const[o,a]=(0,n.useState)(!1);if(!t)return null;const l=()=>{a(!1),r()};return(0,i.jsx)("div",{className:"delete-property-modal-overlay",onClick:l,children:(0,i.jsxs)("div",{className:"delete-property-modal-content",onClick:e=>e.stopPropagation(),children:[(0,i.jsx)("div",{className:"delete-property-modal-header",children:(0,i.jsx)("h3",{children:"\u26a0\ufe0f Delete Property?"})}),(0,i.jsxs)("div",{className:"delete-property-modal-body",children:[(0,i.jsx)("p",{className:"delete-property-warning-text",children:"This action is permanent. All data will be lost and cannot be restored. You'll need to add the property again from scratch."}),(0,i.jsxs)("label",{className:"delete-property-checkbox-label",children:[(0,i.jsx)("input",{type:"checkbox",checked:o,onChange:e=>a(e.target.checked),className:"delete-property-checkbox"}),(0,i.jsx)("span",{children:"I agree to permanently delete this property."})]})]}),(0,i.jsxs)("div",{className:"delete-property-modal-footer",children:[(0,i.jsx)("button",{className:"delete-property-cancel-btn ".concat(o?"":"primary"),onClick:l,children:"Cancel"}),(0,i.jsx)("button",{className:"delete-property-confirm-btn ".concat(o?"destructive":""),onClick:()=>{o&&(s(),a(!1),r())},disabled:!o,children:"Delete"})]})]})})}},375(e,t,r){"use strict";r.d(t,{JR:()=>i,Sn:()=>s});const n="https://360coordinates.com/backend/api";const i=function(){if({NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL)return{NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_API_BASE_URL;if("undefined"!==typeof window&&window.location&&window.location.hostname){return window.location.hostname.toLowerCase().startsWith("demo1.")?"https://demo1.360coordinates.com/backend/api":n}return n}(),s={LOGIN:"/auth/login.php",REGISTER:"/auth/register.php",VERIFY_TOKEN:"/auth/verify.php",SWITCH_ROLE:"/auth/switch-role.php",FORGOT_PASSWORD_INIT:"/auth/forgot-password-init.php",RESET_PASSWORD:"/auth/reset-password.php",SELLER_PROPERTIES:"/seller/properties/list.php",SELLER_ADD_PROPERTY:"/seller/properties/add.php",SELLER_UPDATE_PROPERTY:"/seller/properties/update.php",SELLER_DELETE_PROPERTY:"/seller/properties/delete.php",SELLER_STATS:"/seller/dashboard/stats.php",SELLER_INQUIRIES:"/seller/inquiries/list.php",SELLER_UPDATE_INQUIRY:"/seller/inquiries/updateStatus.php",SELLER_GET_BUYER:"/seller/buyers/get.php",SELLER_LEADS:"/seller/leads/list.php",SELLER_PROFILE:"/seller/profile/get.php",SELLER_UPDATE_PROFILE:"/seller/profile/update.php",PROPERTIES:"/buyer/properties/list.php",PROPERTY_DETAILS:"/buyer/properties/details.php",SEND_INQUIRY:"/buyer/inquiries/send.php",BUYER_PROFILE:"/buyer/profile/get.php",BUYER_UPDATE_PROFILE:"/buyer/profile/update.php",TOGGLE_FAVORITE:"/buyer/favorites/toggle.php",FAVORITES_LIST:"/buyer/favorites/list.php",HISTORY_ADD:"/buyer/history/add.php",HISTORY_LIST:"/buyer/history/list.php",SEND_EMAIL_OTP:"/otp/send-email.php",VERIFY_EMAIL_OTP:"/otp/verify-email.php",SEND_SMS_OTP:"/otp/send-sms.php",VERIFY_SMS_OTP:"/otp/verify-sms.php",RESEND_SMS_OTP:"/otp/resend-sms.php",UPLOAD_PROFILE_IMAGE:"/upload/profile-image.php",UPLOAD_PROPERTY_FILES:"/upload/property-files.php",MODERATE_AND_UPLOAD:"/images/moderate-and-upload.php",ADMIN_LOGIN:"/admin/auth/login.php",ADMIN_VERIFY:"/admin/auth/verify.php",ADMIN_SEND_OTP:"/admin/auth/send-otp.php",ADMIN_VERIFY_OTP:"/admin/auth/verify-otp.php",ADMIN_RESEND_OTP:"/admin/auth/resend-otp.php",ADMIN_DASHBOARD_STATS:"/admin/dashboard/stats.php",ADMIN_USERS_LIST:"/admin/users/list.php",ADMIN_USERS_UPDATE:"/admin/users/update.php",ADMIN_USERS_DELETE:"/admin/users/delete.php",ADMIN_PROPERTIES_LIST:"/admin/properties/list.php",ADMIN_PROPERTIES_APPROVE:"/admin/properties/approve.php",ADMIN_PROPERTIES_REJECT:"/admin/properties/reject.php",ADMIN_PROPERTIES_DELETE:"/admin/properties/delete.php",ADMIN_AGENTS_LIST:"/admin/agents/list.php",ADMIN_AGENTS_VERIFY:"/admin/agents/verify.php",ADMIN_AGENTS_UNVERIFY:"/admin/agents/unverify.php",ADMIN_INQUIRIES_LIST:"/admin/inquiries/list.php",ADMIN_SUBSCRIPTIONS_LIST:"/admin/subscriptions/list.php",ADMIN_SUPPORT_LIST:"/admin/support/list.php",ADMIN_SUPPORT_UPDATE_STATUS:"/admin/support/update-status.php",ADMIN_CHANGE_PASSWORD:"/admin/auth/change-password.php",ADMIN_MODERATION_QUEUE:"/admin/moderation-queue/list.php",ADMIN_MODERATION_APPROVE:"/admin/moderation-queue/approve.php",ADMIN_MODERATION_REJECT:"/admin/moderation-queue/reject.php",CHAT_CREATE_ROOM:"/chat/create-room.php",CHAT_LIST_ROOMS:"/chat/list-rooms.php",BUYER_INTERACTIONS_CHECK:"/buyer/interactions/check.php",BUYER_INTERACTIONS_RECORD:"/buyer/interactions/record.php",PUBLIC_STATS:"/public/stats.php",PUBLIC_CONFIG:"/public/config.php"}},376(e,t,r){"use strict";r.d(t,{BZ:()=>p,Hs:()=>g,IA:()=>x,NY:()=>u,R2:()=>c,S3:()=>d,Vp:()=>b,favoritesAPI:()=>y,h2:()=>v,historyAPI:()=>_,propertiesAPI:()=>f,r7:()=>h,v5:()=>m});var n=r(555),i=r(375);const s=()=>localStorage.getItem("authToken"),o=()=>{const e=localStorage.getItem("userData");return e?JSON.parse(e):null},a=e=>localStorage.setItem("userData",JSON.stringify(e)),l=async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};const r="".concat(i.JR).concat(e),o=s(),a={"Content-Type":"application/json"};o&&(a.Authorization="Bearer ".concat(o));const l=(0,n.A)((0,n.A)({},t),{},{headers:(0,n.A)((0,n.A)({},a),t.headers)});try{const e=await fetch(r,l),t=await e.text();if(!t||""===t.trim())throw console.error("Empty response from server:",r),{status:e.status||500,message:"Empty response from server. The API may have encountered an error.",errors:null};const n=e.headers.get("content-type");let i;if(!n||!n.includes("application/json"))throw console.error("Non-JSON response:",t.substring(0,500)),{status:e.status||500,message:t.substring(0,200)||"Invalid response from server",errors:null,rawResponse:t.substring(0,500)};try{i=JSON.parse(t)}catch(c){throw console.error("JSON parse error:",c),console.error("Response text:",t.substring(0,500)),{status:e.status||500,message:"Invalid JSON response from server. Response: "+t.substring(0,200),errors:null,rawResponse:t.substring(0,500)}}if(!e.ok){throw{status:e.status,message:i.message||"Request failed",errors:i.errors||null,data:i}}return i}catch(u){if(u.status)throw u.message&&"Request failed"!==u.message||(401===u.status?u.message="Authentication required. Please log in to add properties.":403===u.status&&(u.message="Access denied. You do not have permission to perform this action.")),u;if("TypeError"===u.name&&u.message.includes("fetch"))throw{status:0,message:"Network error. Please check your connection and ensure the backend server is running."};throw{status:0,message:u.message||"Network error. Please check your connection and ensure the backend server is running.",originalError:u.message}}},c={login:async(e,t,r)=>{console.log("authAPI.login called:",{email:e,userType:r});try{const n=await l(i.Sn.LOGIN,{method:"POST",body:JSON.stringify({email:e,password:t,userType:r})});return console.log("authAPI.login response:",n),n}catch(n){throw console.error("authAPI.login error:",n),n}},register:async e=>await l(i.Sn.REGISTER,{method:"POST",body:JSON.stringify(e)}),verifyToken:async()=>{if(!s())return{success:!1,message:"No token"};try{return await l(i.Sn.VERIFY_TOKEN,{method:"GET"})}catch(e){throw e}},switchRole:async e=>{try{return await l(i.Sn.SWITCH_ROLE,{method:"POST",body:JSON.stringify({targetRole:e})})}catch(t){throw console.error("authAPI.switchRole error:",t),t}},logout:()=>{localStorage.removeItem("authToken"),localStorage.removeItem("userData"),localStorage.removeItem("currentSession"),localStorage.removeItem("registeredUser")},getToken:s,getUser:o,setToken:e=>localStorage.setItem("authToken",e),setUser:a,isAuthenticated:()=>!!s()},u={list:async function(){const e=new URLSearchParams(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toString();return l("".concat(i.Sn.SELLER_PROPERTIES,"?").concat(e))},add:async e=>l(i.Sn.SELLER_ADD_PROPERTY,{method:"POST",body:JSON.stringify(e)}),update:async(e,t)=>l("".concat(i.Sn.SELLER_UPDATE_PROPERTY,"?id=").concat(e),{method:"PUT",body:JSON.stringify(t)}),delete:async e=>l("".concat(i.Sn.SELLER_DELETE_PROPERTY,"?id=").concat(e),{method:"DELETE"}),uploadImage:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(!t||t<=0)throw{status:400,message:"Property ID is required for image upload",errors:["Property ID is required"]};let l=null;if(n)try{var u;const{uploadPropertyImageToFirebase:i}=await Promise.resolve().then(r.bind(r,935));let p=o(),m=null===(u=p)||void 0===u?void 0:u.id;if(console.log("\ud83d\udd0d User object check:",{userExists:!!p,userId:m,userType:typeof p,userKeys:p?Object.keys(p):[],fullUser:p}),!m){console.warn("\u26a0\ufe0f User ID not in localStorage, fetching from backend...");try{if(s()){var d;const e=await c.verifyToken();var h;if(console.log("\ud83d\udd0d Verify token response:",e),e.success&&null!==(d=e.data)&&void 0!==d&&d.user)p=e.data.user,m=p.id||p.user_id,p&&(a(p),console.log("\u2705 User saved to localStorage")),console.log("\u2705 User ID fetched from backend:",m);else console.warn("\u26a0\ufe0f Failed to get user from backend verify response"),console.warn("Response structure:",{success:e.success,hasData:!!e.data,hasUser:!(null===(h=e.data)||void 0===h||!h.user),dataKeys:e.data?Object.keys(e.data):[]})}else console.warn("\u26a0\ufe0f No token found, cannot fetch user from backend")}catch(P){console.error("\u274c Failed to fetch user from backend:",P)}}if(!m&&p&&(m=p.user_id||p.id||p.ID,m&&console.log("\u2705 Found user ID using alternative field:",m)),m){console.log("\u2705 User ID found, uploading to Firebase:",m),console.log("\ud83d\udce4 Upload details:",{fileName:e.name,fileSize:e.size,fileType:e.type,userId:m,propertyId:t});try{const r=await i(e,m,t);l=r.url,console.log("\u2705 Image uploaded to Firebase successfully!"),console.log("\ud83d\udcce Firebase URL:",l),console.log("\ud83d\udcce Storage path:",r.path)}catch(M){throw console.error("\u274c Firebase upload error in uploadImage:",M),M}}else console.warn("\u26a0\ufe0f User ID not found, falling back to server upload"),console.warn("User object:",p),console.warn("Available user fields:",p?Object.keys(p):"null"),n=!1}catch(L){console.error("\u274c Firebase upload failed, falling back to server upload:",L),console.error("Firebase error details:",L.message,L.stack),n=!1}const p=new FormData;n&&l?(p.append("firebase_url",l),p.append("property_id",t.toString())):(p.append("image",e),p.append("property_id",t.toString()));const m="".concat(i.JR).concat(i.Sn.MODERATE_AND_UPLOAD),f=s();console.log("\ud83d\udd35 Image Upload Request:",{url:m,method:"POST",hasFormData:!!p,formDataKeys:p?Array.from(p.keys()):[],hasToken:!!f,useFirebase:n,hasFirebaseUrl:!!l,firebaseUrl:l?l.substring(0,100)+"...":null,formDataEntries:p?Array.from(p.entries()).map(e=>{let[t,r]=e;return[t,r instanceof File?"File: ".concat(r.name):r]}):[]});try{var g,y;const e={method:"POST",headers:{Authorization:"Bearer ".concat(f)},body:p,redirect:"error"};let t;console.log("\ud83d\udd35 Fetch options:",{method:e.method,hasBody:!!e.body,redirect:e.redirect,url:m});try{t=await fetch(m,e)}catch(R){if(R.message&&R.message.includes("redirect"))throw console.error("\u274c Redirect detected - this may be converting POST to GET"),console.error("Redirect error:",R),{status:500,message:"Server redirect detected. This may be converting POST to GET. Please check server configuration.",error_code:"redirect_detected",originalError:R.message};throw R}if(console.log("\ud83d\udd35 Response received:",{status:t.status,statusText:t.statusText,type:t.type,ok:t.ok,url:t.url,redirected:t.redirected}),!t.ok&&405===t.status){const e=await t.text();let r;try{r=JSON.parse(e)}catch(D){r={message:e}}if("method_not_allowed"===r.error_code&&"GET"===r.received_method)throw console.error("\u274c CRITICAL: POST request was converted to GET by server!"),console.error("This is a server configuration issue. The server is converting POST to GET."),{status:500,message:"Server configuration error: POST requests are being converted to GET. This is a server-side issue that needs to be fixed by your hosting provider.",error_code:"post_to_get_conversion",details:r,solution:"Contact your hosting provider (Hostinger) to fix the server configuration that is converting POST requests to GET. This is typically caused by redirects or proxy settings."}}if("opaqueredirect"===t.type||t.status>=300&&t.status<400){console.warn("\u26a0\ufe0f Redirect detected - this may cause POST to GET conversion");const r=t.headers.get("Location");if(r){console.log("\ud83d\udd04 Following redirect to:",r);const t=r.startsWith("http")?r:"".concat(i.JR).concat(r);return await fetch(t,e)}}const r=await t.text();if(!r||""===r.trim())throw{status:t.status||500,message:"Empty response from server. The upload may have failed.",errors:null};let s;try{s=JSON.parse(r)}catch(F){throw console.error("JSON parse error:",F),console.error("Response text:",r.substring(0,500)),{status:t.status||500,message:"Invalid JSON response from server",errors:null,rawResponse:r.substring(0,500)}}if(!t.ok)throw console.error("Image upload HTTP error:",t.status,r),{status:t.status,message:s.message||"Server error (".concat(t.status,")"),errors:s.errors||null,data:s,rawResponse:r};console.log("\ud83d\udd0d Backend response structure:",{status:s.status,hasData:!!s.data,dataKeys:s.data?Object.keys(s.data):[],moderationStatus:null===(g=s.data)||void 0===g?void 0:g.moderation_status,fullData:s.data});const o=null===(y=s.data)||void 0===y?void 0:y.moderation_status;if("success"===s.status){if("SAFE"===o){var _,v,x,b;return{success:!0,data:{url:n&&l?l:(null===(_=s.data)||void 0===_?void 0:_.image_url)||(null===(v=s.data)||void 0===v?void 0:v.url),image_id:null===(x=s.data)||void 0===x?void 0:x.image_id,filename:null===(b=s.data)||void 0===b?void 0:b.filename,moderation_status:"SAFE",storage_type:n&&l?"firebase":"server"},message:s.message||"Image uploaded successfully"}}if("PENDING"===o||"NEEDS_REVIEW"===o){var w,j,S,T;return{success:!0,pending:!0,data:{url:n&&l?l:(null===(w=s.data)||void 0===w?void 0:w.image_url)||null,image_id:null===(j=s.data)||void 0===j?void 0:j.image_id,filename:null===(S=s.data)||void 0===S?void 0:S.filename,moderation_status:o,moderation_reason:(null===(T=s.data)||void 0===T?void 0:T.moderation_reason)||s.message,storage_type:n&&l?"firebase":"server"},message:s.message||"Image is under review"}}var k,A,C;return console.warn("Response missing moderation_status, treating as pending review"),{success:!0,pending:!0,data:{url:(null===(k=s.data)||void 0===k?void 0:k.image_url)||null,image_id:null===(A=s.data)||void 0===A?void 0:A.image_id,filename:null===(C=s.data)||void 0===C?void 0:C.filename,moderation_status:"PENDING",moderation_reason:"Moderation status not provided"},message:s.message||"Image is under review"}}var E,N,I;if("pending_review"===s.status)return{success:!0,pending:!0,data:{url:(null===(E=s.data)||void 0===E?void 0:E.image_url)||null,image_id:null===(N=s.data)||void 0===N?void 0:N.image_id,moderation_status:o||"NEEDS_REVIEW",moderation_reason:(null===(I=s.data)||void 0===I?void 0:I.moderation_reason)||s.message},message:s.message||"Image is under review"};throw"error"===s.status?{status:t.status||400,message:s.message||"Image was rejected",error_code:s.error_code||"rejected",details:s.details||{},rejected:!0,data:s}:{status:t.status||500,message:s.message||"Upload failed",errors:s.errors||null,data:s}}catch(O){if(O.status)throw O;if("TypeError"===O.name&&O.message.includes("fetch"))throw{status:0,message:"Network error. Please check your connection and ensure the backend server is running."};throw{status:0,message:O.message||"Unknown error occurred"}}},uploadVideo:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;if(!t||t<=0)throw{status:400,message:"Property ID is required for video upload",errors:["Property ID is required"]};const r=new FormData;r.append("file",e),r.append("file_type","video"),r.append("property_id",t);const n="".concat(i.JR).concat(i.Sn.UPLOAD_PROPERTY_FILES),o=s();try{const e=await fetch(n,{method:"POST",headers:{Authorization:"Bearer ".concat(o)},body:r}),t=await e.text();if(!t||""===t.trim())throw{status:e.status||500,message:"Empty response from server. The upload may have failed.",errors:null};let i;try{i=JSON.parse(t)}catch(c){throw console.error("JSON parse error:",c),console.error("Response text:",t.substring(0,500)),{status:e.status||500,message:"Invalid JSON response from server",errors:null,rawResponse:t.substring(0,500)}}if(!e.ok)throw console.error("Video upload HTTP error:",e.status,t),{status:e.status,message:i.message||"Server error (".concat(e.status,")"),errors:i.errors||null,data:i,rawResponse:t};var a,l;if("success"===i.status)return{success:!0,data:{url:null===(a=i.data)||void 0===a?void 0:a.url,filename:null===(l=i.data)||void 0===l?void 0:l.filename},message:i.message||"Video uploaded successfully"};throw{status:e.status||500,message:i.message||"Video upload failed",errors:i.errors||null,data:i}}catch(u){if(u.status)throw u;if("TypeError"===u.name&&u.message.includes("fetch"))throw{status:0,message:"Network error. Please check your connection and ensure the backend server is running."};throw{status:0,message:u.message||"Unknown error occurred"}}}},d={getStats:async()=>l(i.Sn.SELLER_STATS)},h={list:async function(){const e=new URLSearchParams(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toString();return l("".concat(i.Sn.SELLER_INQUIRIES,"?").concat(e))},updateStatus:async(e,t)=>l("".concat(i.Sn.SELLER_UPDATE_INQUIRY,"?id=").concat(e),{method:"PUT",body:JSON.stringify({status:t})}),getBuyer:async e=>l("".concat(i.Sn.SELLER_GET_BUYER,"?id=").concat(e))},p={list:async()=>l(i.Sn.SELLER_LEADS)},m={get:async()=>l(i.Sn.SELLER_PROFILE),update:async e=>l(i.Sn.SELLER_UPDATE_PROFILE,{method:"PUT",body:JSON.stringify(e)}),uploadProfileImage:async function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];const n="".concat(i.JR).concat(i.Sn.UPLOAD_PROFILE_IMAGE),l=s(),u=new FormData;let d=null;if(t)try{var h;const{uploadProfileImageToFirebase:n}=await Promise.resolve().then(r.bind(r,935));let i=o(),s=null===(h=i)||void 0===h?void 0:h.id;if(!s){console.warn("\u26a0\ufe0f User ID not in localStorage for profile upload, fetching from backend...");try{var p;const e=await c.verifyToken();e.success&&null!==(p=e.data)&&void 0!==p&&p.user?(i=e.data.user,s=i.id||i.user_id,i&&a(i),console.log("\u2705 User ID fetched from backend for profile upload:",s)):console.warn("\u26a0\ufe0f Failed to get user from backend verify response for profile upload")}catch(m){console.error("\u274c Failed to fetch user from backend for profile upload:",m)}}if(!s&&i&&(s=i.user_id||i.id||i.ID),s){console.log("\u2705 User ID found, uploading profile image to Firebase:",s);d=(await n(e,s)).url,console.log("\u2705 Profile image uploaded to Firebase. URL:",d)}else console.warn("\u26a0\ufe0f User ID not found for profile upload, falling back to server upload"),t=!1}catch(f){console.error("\u274c Firebase profile upload failed, falling back to server upload:",f),t=!1}t&&d?u.append("firebase_url",d):u.append("file",e);try{const e=await fetch(n,{method:"POST",headers:{Authorization:"Bearer ".concat(l)},body:u}),t=await e.text();if(!t||""===t.trim())throw{status:e.status||500,message:"Empty response from server. The upload may have failed.",errors:null};const r=e.headers.get("content-type");let i;if(!r||!r.includes("application/json"))throw console.error("Non-JSON response (profile image):",t.substring(0,500)),{status:e.status||500,message:t.substring(0,200)||"Invalid response from server",errors:null,rawResponse:t.substring(0,500)};try{i=JSON.parse(t)}catch(g){throw console.error("JSON parse error (profile image):",g),console.error("Response text:",t.substring(0,500)),{status:e.status||500,message:"Invalid JSON response from server. Response: "+t.substring(0,200),errors:null,rawResponse:t.substring(0,500)}}if(!e.ok)throw{status:e.status,message:i.message||"Upload failed",errors:i.errors||null,data:i};return i}catch(y){if(y.status)throw y;if("TypeError"===y.name&&y.message.includes("fetch"))throw{status:0,message:"Network error. Please check your connection and ensure the backend server is running."};throw{status:0,message:y.message||"Upload failed. Please try again.",originalError:y.message}}}},f={list:async function(){const e=new URLSearchParams(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toString();return l("".concat(i.Sn.PROPERTIES,"?").concat(e))},getDetails:async e=>l("".concat(i.Sn.PROPERTY_DETAILS,"?id=").concat(e)),sendInquiry:async e=>l(i.Sn.SEND_INQUIRY,{method:"POST",body:JSON.stringify(e)})},g={get:async()=>l(i.Sn.BUYER_PROFILE),update:async e=>l(i.Sn.BUYER_UPDATE_PROFILE,{method:"PUT",body:JSON.stringify(e)})},y={toggle:async e=>l(i.Sn.TOGGLE_FAVORITE,{method:"POST",body:JSON.stringify({property_id:e})}),list:async function(){const e=new URLSearchParams(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toString();return l("".concat(i.Sn.FAVORITES_LIST,"?").concat(e))}},_={add:async function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"viewed_owner_details";return l(i.Sn.HISTORY_ADD,{method:"POST",body:JSON.stringify({property_id:e,action_type:t})})},list:async function(){const e=new URLSearchParams(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).toString();return l("".concat(i.Sn.HISTORY_LIST,"?").concat(e))}},v={createRoom:async(e,t)=>l(i.Sn.CHAT_CREATE_ROOM,{method:"POST",body:JSON.stringify({receiverId:e,propertyId:t})}),listRooms:async()=>l(i.Sn.CHAT_LIST_ROOMS,{method:"GET"})},x={getConfig:async()=>l(i.Sn.PUBLIC_CONFIG,{method:"GET"})},b={checkLimit:async(e,t)=>{const r=new URLSearchParams({property_id:e,action_type:t}).toString();return l("".concat(i.Sn.BUYER_INTERACTIONS_CHECK,"?").concat(r))},recordInteraction:async(e,t)=>l(i.Sn.BUYER_INTERACTIONS_RECORD,{method:"POST",body:JSON.stringify({property_id:e,action_type:t})})}},391(e,t,r){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(4)},555(e,t,r){"use strict";function n(e){return n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},n(e)}function i(e){var t=function(e,t){if("object"!=n(e)||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var i=r.call(e,t||"default");if("object"!=n(i))return i;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==n(t)?t:t+""}function s(e,t,r){return(t=i(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function o(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function a(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?o(Object(r),!0).forEach(function(t){s(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):o(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}r.d(t,{A:()=>a})},579(e,t,r){"use strict";e.exports=r(799)},580(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("funnel",[["path",{d:"M10 20a1 1 0 0 0 .553.895l2 1A1 1 0 0 0 14 21v-7a2 2 0 0 1 .517-1.341L21.74 4.67A1 1 0 0 0 21 3H3a1 1 0 0 0-.742 1.67l7.225 7.989A2 2 0 0 1 10 14z",key:"sc7q7i"}]])},614(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("x",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]])},639(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("building-2",[["path",{d:"M10 12h4",key:"a56b0p"}],["path",{d:"M10 8h4",key:"1sr2af"}],["path",{d:"M14 21v-3a2 2 0 0 0-4 0v3",key:"1rgiei"}],["path",{d:"M6 10H4a2 2 0 0 0-2 2v7a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-2",key:"secmi2"}],["path",{d:"M6 21V5a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v16",key:"16ra0t"}]])},669(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("message-square",[["path",{d:"M22 17a2 2 0 0 1-2 2H6.828a2 2 0 0 0-1.414.586l-2.202 2.202A.71.71 0 0 1 2 21.286V5a2 2 0 0 1 2-2h16a2 2 0 0 1 2 2z",key:"18887p"}]])},672(e,t,r){"use strict";var n=r(43);function i(e){var t="https://react.dev/errors/"+e;if(1<arguments.length){t+="?args[]="+encodeURIComponent(arguments[1]);for(var r=2;r<arguments.length;r++)t+="&args[]="+encodeURIComponent(arguments[r])}return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function s(){}var o={d:{f:s,r:function(){throw Error(i(522))},D:s,C:s,L:s,m:s,X:s,S:s,M:s},p:0,findDOMNode:null},a=Symbol.for("react.portal");var l=n.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function c(e,t){return"font"===e?"":"string"===typeof t?"use-credentials"===t?t:"":void 0}t.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=o,t.createPortal=function(e,t){var r=2<arguments.length&&void 0!==arguments[2]?arguments[2]:null;if(!t||1!==t.nodeType&&9!==t.nodeType&&11!==t.nodeType)throw Error(i(299));return function(e,t,r){var n=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;return{$$typeof:a,key:null==n?null:""+n,children:e,containerInfo:t,implementation:r}}(e,t,null,r)},t.flushSync=function(e){var t=l.T,r=o.p;try{if(l.T=null,o.p=2,e)return e()}finally{l.T=t,o.p=r,o.d.f()}},t.preconnect=function(e,t){"string"===typeof e&&(t?t="string"===typeof(t=t.crossOrigin)?"use-credentials"===t?t:"":void 0:t=null,o.d.C(e,t))},t.prefetchDNS=function(e){"string"===typeof e&&o.d.D(e)},t.preinit=function(e,t){if("string"===typeof e&&t&&"string"===typeof t.as){var r=t.as,n=c(r,t.crossOrigin),i="string"===typeof t.integrity?t.integrity:void 0,s="string"===typeof t.fetchPriority?t.fetchPriority:void 0;"style"===r?o.d.S(e,"string"===typeof t.precedence?t.precedence:void 0,{crossOrigin:n,integrity:i,fetchPriority:s}):"script"===r&&o.d.X(e,{crossOrigin:n,integrity:i,fetchPriority:s,nonce:"string"===typeof t.nonce?t.nonce:void 0})}},t.preinitModule=function(e,t){if("string"===typeof e)if("object"===typeof t&&null!==t){if(null==t.as||"script"===t.as){var r=c(t.as,t.crossOrigin);o.d.M(e,{crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0})}}else null==t&&o.d.M(e)},t.preload=function(e,t){if("string"===typeof e&&"object"===typeof t&&null!==t&&"string"===typeof t.as){var r=t.as,n=c(r,t.crossOrigin);o.d.L(e,r,{crossOrigin:n,integrity:"string"===typeof t.integrity?t.integrity:void 0,nonce:"string"===typeof t.nonce?t.nonce:void 0,type:"string"===typeof t.type?t.type:void 0,fetchPriority:"string"===typeof t.fetchPriority?t.fetchPriority:void 0,referrerPolicy:"string"===typeof t.referrerPolicy?t.referrerPolicy:void 0,imageSrcSet:"string"===typeof t.imageSrcSet?t.imageSrcSet:void 0,imageSizes:"string"===typeof t.imageSizes?t.imageSizes:void 0,media:"string"===typeof t.media?t.media:void 0})}},t.preloadModule=function(e,t){if("string"===typeof e)if(t){var r=c(t.as,t.crossOrigin);o.d.m(e,{as:"string"===typeof t.as&&"script"!==t.as?t.as:void 0,crossOrigin:r,integrity:"string"===typeof t.integrity?t.integrity:void 0})}else o.d.m(e)},t.requestFormReset=function(e){o.d.r(e)},t.unstable_batchedUpdates=function(e,t){return e(t)},t.useFormState=function(e,t,r){return l.H.useFormState(e,t,r)},t.useFormStatus=function(){return l.H.useHostTransitionStatus()},t.version="19.2.3"},685(e,t,r){"use strict";var n;r.d(t,{BV:()=>Oe,C5:()=>Re,Kd:()=>_t,N_:()=>xt,Zp:()=>fe,g:()=>ge,ok:()=>Tt,qh:()=>De,zy:()=>he});var i=r(986),s=r(555),o=r(43);const a=["sri"],l=["page"],c=["page","matches"],u=["onClick","discover","prefetch","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"],d=["aria-current","caseSensitive","className","end","style","to","viewTransition","children"],h=["discover","fetcherKey","navigate","reloadDocument","replace","state","method","action","onSubmit","relative","preventScrollReset","viewTransition","unstable_defaultShouldRevalidate"];var p="popstate";function m(){return b(function(e,t){let{pathname:r,search:n,hash:i}=e.location;return _("",{pathname:r,search:n,hash:i},t.state&&t.state.usr||null,t.state&&t.state.key||"default")},function(e,t){return"string"===typeof t?t:v(t)},null,arguments.length>0&&void 0!==arguments[0]?arguments[0]:{})}function f(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}function g(e,t){if(!e){"undefined"!==typeof console&&console.warn(t);try{throw new Error(t)}catch(r){}}}function y(e,t){return{usr:e.state,key:e.key,idx:t}}function _(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3?arguments[3]:void 0;return(0,s.A)((0,s.A)({pathname:"string"===typeof e?e:e.pathname,search:"",hash:""},"string"===typeof t?x(t):t),{},{state:r,key:t&&t.key||n||Math.random().toString(36).substring(2,10)})}function v(e){let{pathname:t="/",search:r="",hash:n=""}=e;return r&&"?"!==r&&(t+="?"===r.charAt(0)?r:"?"+r),n&&"#"!==n&&(t+="#"===n.charAt(0)?n:"#"+n),t}function x(e){let t={};if(e){let r=e.indexOf("#");r>=0&&(t.hash=e.substring(r),e=e.substring(0,r));let n=e.indexOf("?");n>=0&&(t.search=e.substring(n),e=e.substring(0,n)),e&&(t.pathname=e)}return t}function b(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},{window:i=document.defaultView,v5Compat:o=!1}=n,a=i.history,l="POP",c=null,u=d();function d(){return(a.state||{idx:null}).idx}function h(){l="POP";let e=d(),t=null==e?null:e-u;u=e,c&&c({action:l,location:f.location,delta:t})}function m(e){return w(e)}null==u&&(u=0,a.replaceState((0,s.A)((0,s.A)({},a.state),{},{idx:u}),""));let f={get action(){return l},get location(){return e(i,a)},listen(e){if(c)throw new Error("A history only accepts one active listener");return i.addEventListener(p,h),c=e,()=>{i.removeEventListener(p,h),c=null}},createHref:e=>t(i,e),createURL:m,encodeLocation(e){let t=m(e);return{pathname:t.pathname,search:t.search,hash:t.hash}},push:function(e,t){l="PUSH";let n=_(f.location,e,t);r&&r(n,e),u=d()+1;let s=y(n,u),h=f.createHref(n);try{a.pushState(s,"",h)}catch(p){if(p instanceof DOMException&&"DataCloneError"===p.name)throw p;i.location.assign(h)}o&&c&&c({action:l,location:f.location,delta:1})},replace:function(e,t){l="REPLACE";let n=_(f.location,e,t);r&&r(n,e),u=d();let i=y(n,u),s=f.createHref(n);a.replaceState(i,"",s),o&&c&&c({action:l,location:f.location,delta:0})},go:e=>a.go(e)};return f}function w(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r="http://localhost";"undefined"!==typeof window&&(r="null"!==window.location.origin?window.location.origin:window.location.href),f(r,"No window.location.(origin|href) available to create URL");let n="string"===typeof e?e:v(e);return n=n.replace(/ $/,"%20"),!t&&n.startsWith("//")&&(n=r+n),new URL(n,r)}new WeakMap;function j(e,t){return S(e,t,arguments.length>2&&void 0!==arguments[2]?arguments[2]:"/",!1)}function S(e,t,r,n){let i=L(("string"===typeof t?x(t):t).pathname||"/",r);if(null==i)return null;let s=T(e);!function(e){e.sort((e,t)=>e.score!==t.score?t.score-e.score:function(e,t){let r=e.length===t.length&&e.slice(0,-1).every((e,r)=>e===t[r]);return r?e[e.length-1]-t[t.length-1]:0}(e.routesMeta.map(e=>e.childrenIndex),t.routesMeta.map(e=>e.childrenIndex)))}(s);let o=null;for(let a=0;null==o&&a<s.length;++a){let e=M(i);o=N(s[a],e,n)}return o}function T(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"",i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=function(e,s){let o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:i,a=arguments.length>3?arguments[3]:void 0,l={relativePath:void 0===a?e.path||"":a,caseSensitive:!0===e.caseSensitive,childrenIndex:s,route:e};if(l.relativePath.startsWith("/")){if(!l.relativePath.startsWith(n)&&o)return;f(l.relativePath.startsWith(n),'Absolute route path "'.concat(l.relativePath,'" nested under path "').concat(n,'" is not valid. An absolute child route path must start with the combined path of all its parent routes.')),l.relativePath=l.relativePath.slice(n.length)}let c=V([n,l.relativePath]),u=r.concat(l);e.children&&e.children.length>0&&(f(!0!==e.index,'Index routes must not have child routes. Please remove all child routes from route path "'.concat(c,'".')),T(e.children,t,u,c,o)),(null!=e.path||e.index)&&t.push({path:c,score:E(c,e.index),routesMeta:u})};return e.forEach((e,t)=>{var r;if(""!==e.path&&null!==(r=e.path)&&void 0!==r&&r.includes("?"))for(let n of k(e.path))s(e,t,!0,n);else s(e,t)}),t}function k(e){let t=e.split("/");if(0===t.length)return[];let[r,...n]=t,i=r.endsWith("?"),s=r.replace(/\?$/,"");if(0===n.length)return i?[s,""]:[s];let o=k(n.join("/")),a=[];return a.push(...o.map(e=>""===e?s:[s,e].join("/"))),i&&a.push(...o),a.map(t=>e.startsWith("/")&&""===t?"/":t)}var A=/^:[\w-]+$/,C=e=>"*"===e;function E(e,t){let r=e.split("/"),n=r.length;return r.some(C)&&(n+=-2),t&&(n+=2),r.filter(e=>!C(e)).reduce((e,t)=>e+(A.test(t)?3:""===t?1:10),n)}function N(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],{routesMeta:n}=e,i={},s="/",o=[];for(let a=0;a<n.length;++a){let e=n[a],l=a===n.length-1,c="/"===s?t:t.slice(s.length)||"/",u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:l},c),d=e.route;if(!u&&l&&r&&!n[n.length-1].route.index&&(u=I({path:e.relativePath,caseSensitive:e.caseSensitive,end:!1},c)),!u)return null;Object.assign(i,u.params),o.push({params:i,pathname:V([s,u.pathname]),pathnameBase:q(V([s,u.pathnameBase])),route:d}),"/"!==u.pathnameBase&&(s=V([s,u.pathnameBase]))}return o}function I(e,t){"string"===typeof e&&(e={path:e,caseSensitive:!1,end:!0});let[r,n]=P(e.path,e.caseSensitive,e.end),i=t.match(r);if(!i)return null;let s=i[0],o=s.replace(/(.)\/+$/,"$1"),a=i.slice(1);return{params:n.reduce((e,t,r)=>{let{paramName:n,isOptional:i}=t;if("*"===n){let e=a[r]||"";o=s.slice(0,s.length-e.length).replace(/(.)\/+$/,"$1")}const l=a[r];return e[n]=i&&!l?void 0:(l||"").replace(/%2F/g,"/"),e},{}),pathname:s,pathnameBase:o,pattern:e}}function P(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];g("*"===e||!e.endsWith("*")||e.endsWith("/*"),'Route path "'.concat(e,'" will be treated as if it were "').concat(e.replace(/\*$/,"/*"),'" because the `*` character must always follow a `/` in the pattern. To get rid of this warning, please change the route path to "').concat(e.replace(/\*$/,"/*"),'".'));let n=[],i="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(e,t,r)=>(n.push({paramName:t,isOptional:null!=r}),r?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return e.endsWith("*")?(n.push({paramName:"*"}),i+="*"===e||"/*"===e?"(.*)$":"(?:\\/(.+)|\\/*)$"):r?i+="\\/*$":""!==e&&"/"!==e&&(i+="(?:(?=\\/|$))"),[new RegExp(i,t?void 0:"i"),n]}function M(e){try{return e.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(t){return g(!1,'The URL path "'.concat(e,'" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (').concat(t,").")),e}}function L(e,t){if("/"===t)return e;if(!e.toLowerCase().startsWith(t.toLowerCase()))return null;let r=t.endsWith("/")?t.length-1:t.length,n=e.charAt(r);return n&&"/"!==n?null:e.slice(r)||"/"}var R=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,D=e=>R.test(e);function F(e,t){let r=t.replace(/\/+$/,"").split("/");return e.split("/").forEach(e=>{".."===e?r.length>1&&r.pop():"."!==e&&r.push(e)}),r.length>1?r.join("/"):"/"}function O(e,t,r,n){return"Cannot include a '".concat(e,"' character in a manually specified `to.").concat(t,"` field [").concat(JSON.stringify(n),"].  Please separate it out to the `to.").concat(r,'` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.')}function z(e){return e.filter((e,t)=>0===t||e.route.path&&e.route.path.length>0)}function B(e){let t=z(e);return t.map((e,r)=>r===t.length-1?e.pathname:e.pathnameBase)}function U(e,t,r){let n,i=arguments.length>3&&void 0!==arguments[3]&&arguments[3];"string"===typeof e?n=x(e):(n=(0,s.A)({},e),f(!n.pathname||!n.pathname.includes("?"),O("?","pathname","search",n)),f(!n.pathname||!n.pathname.includes("#"),O("#","pathname","hash",n)),f(!n.search||!n.search.includes("#"),O("#","search","hash",n)));let o,a=""===e||""===n.pathname,l=a?"/":n.pathname;if(null==l)o=r;else{let e=t.length-1;if(!i&&l.startsWith("..")){let t=l.split("/");for(;".."===t[0];)t.shift(),e-=1;n.pathname=t.join("/")}o=e>=0?t[e]:"/"}let c=function(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"/",{pathname:n,search:i="",hash:s=""}="string"===typeof e?x(e):e;if(n)if(D(n))t=n;else{if(n.includes("//")){let e=n;n=n.replace(/\/\/+/g,"/"),g(!1,"Pathnames cannot have embedded double slashes - normalizing ".concat(e," -> ").concat(n))}t=n.startsWith("/")?F(n.substring(1),"/"):F(n,r)}else t=r;return{pathname:t,search:W(i),hash:H(s)}}(n,o),u=l&&"/"!==l&&l.endsWith("/"),d=(a||"."===l)&&r.endsWith("/");return c.pathname.endsWith("/")||!u&&!d||(c.pathname+="/"),c}var V=e=>e.join("/").replace(/\/\/+/g,"/"),q=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),W=e=>e&&"?"!==e?e.startsWith("?")?e:"?"+e:"",H=e=>e&&"#"!==e?e.startsWith("#")?e:"#"+e:"";var G=class{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.status=e,this.statusText=t||"",this.internal=n,r instanceof Error?(this.data=r.toString(),this.error=r):this.data=r}};function Z(e){return null!=e&&"number"===typeof e.status&&"string"===typeof e.statusText&&"boolean"===typeof e.internal&&"data"in e}function K(e){return e.map(e=>e.route.path).filter(Boolean).join("/").replace(/\/\/*/g,"/")||"/"}var Y="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;function X(e,t){let r=e;if("string"!==typeof r||!R.test(r))return{absoluteURL:void 0,isExternal:!1,to:r};let n=r,i=!1;if(Y)try{let e=new URL(window.location.href),n=r.startsWith("//")?new URL(e.protocol+r):new URL(r),s=L(n.pathname,t);n.origin===e.origin&&null!=s?r=s+n.search+n.hash:i=!0}catch(s){g(!1,'<Link to="'.concat(r,'"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.'))}return{absoluteURL:n,isExternal:i,to:r}}Symbol("Uninstrumented");Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var J=["POST","PUT","PATCH","DELETE"],Q=(new Set(J),["GET",...J]);new Set(Q),Symbol("ResetLoaderData");var $=o.createContext(null);$.displayName="DataRouter";var ee=o.createContext(null);ee.displayName="DataRouterState";var te=o.createContext(!1);function re(){return o.useContext(te)}var ne=o.createContext({isTransitioning:!1});ne.displayName="ViewTransition";var ie=o.createContext(new Map);ie.displayName="Fetchers";var se=o.createContext(null);se.displayName="Await";var oe=o.createContext(null);oe.displayName="Navigation";var ae=o.createContext(null);ae.displayName="Location";var le=o.createContext({outlet:null,matches:[],isDataRoute:!1});le.displayName="Route";var ce=o.createContext(null);ce.displayName="RouteError";var ue="REACT_ROUTER_ERROR";function de(){return null!=o.useContext(ae)}function he(){return f(de(),"useLocation() may be used only in the context of a <Router> component."),o.useContext(ae).location}var pe="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function me(e){o.useContext(oe).static||o.useLayoutEffect(e)}function fe(){let{isDataRoute:e}=o.useContext(le);return e?function(){let{router:e}=Ae("useNavigate"),t=Ee("useNavigate"),r=o.useRef(!1);me(()=>{r.current=!0});let n=o.useCallback(async function(n){let i=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};g(r.current,pe),r.current&&("number"===typeof n?await e.navigate(n):await e.navigate(n,(0,s.A)({fromRouteId:t},i)))},[e,t]);return n}():function(){f(de(),"useNavigate() may be used only in the context of a <Router> component.");let e=o.useContext($),{basename:t,navigator:r}=o.useContext(oe),{matches:n}=o.useContext(le),{pathname:i}=he(),s=JSON.stringify(B(n)),a=o.useRef(!1);me(()=>{a.current=!0});let l=o.useCallback(function(n){let o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(g(a.current,pe),!a.current)return;if("number"===typeof n)return void r.go(n);let l=U(n,JSON.parse(s),i,"path"===o.relative);null==e&&"/"!==t&&(l.pathname="/"===l.pathname?t:V([t,l.pathname])),(o.replace?r.replace:r.push)(l,o.state,o)},[t,r,s,i,e]);return l}()}o.createContext(null);function ge(){let{matches:e}=o.useContext(le),t=e[e.length-1];return t?t.params:{}}function ye(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{matches:r}=o.useContext(le),{pathname:n}=he(),i=JSON.stringify(B(r));return o.useMemo(()=>U(e,JSON.parse(i),n,"path"===t),[e,i,n,t])}function _e(e,t,r,n,i){f(de(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:a}=o.useContext(oe),{matches:l}=o.useContext(le),c=l[l.length-1],u=c?c.params:{},d=c?c.pathname:"/",h=c?c.pathnameBase:"/",p=c&&c.route;{let e=p&&p.path||"";Pe(d,!p||e.endsWith("*")||e.endsWith("*?"),'You rendered descendant <Routes> (or called `useRoutes()`) at "'.concat(d,'" (under <Route path="').concat(e,'">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won\'t match anymore and therefore the child routes will never render.\n\nPlease change the parent <Route path="').concat(e,'"> to <Route path="').concat("/"===e?"*":"".concat(e,"/*"),'">.'))}let m,y=he();if(t){var _;let e="string"===typeof t?x(t):t;f("/"===h||(null===(_=e.pathname)||void 0===_?void 0:_.startsWith(h)),'When overriding the location using `<Routes location>` or `useRoutes(routes, location)`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "'.concat(h,'" but pathname "').concat(e.pathname,'" was given in the `location` prop.')),m=e}else m=y;let v=m.pathname||"/",b=v;if("/"!==h){let e=h.replace(/^\//,"").split("/");b="/"+v.replace(/^\//,"").split("/").slice(e.length).join("/")}let w=j(e,{pathname:b});g(p||null!=w,'No routes matched location "'.concat(m.pathname).concat(m.search).concat(m.hash,'" ')),g(null==w||void 0!==w[w.length-1].route.element||void 0!==w[w.length-1].route.Component||void 0!==w[w.length-1].route.lazy,'Matched leaf route at location "'.concat(m.pathname).concat(m.search).concat(m.hash,'" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.'));let S=Te(w&&w.map(e=>Object.assign({},e,{params:Object.assign({},u,e.params),pathname:V([h,a.encodeLocation?a.encodeLocation(e.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathname]),pathnameBase:"/"===e.pathnameBase?h:V([h,a.encodeLocation?a.encodeLocation(e.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:e.pathnameBase])})),l,r,n,i);return t&&S?o.createElement(ae.Provider,{value:{location:(0,s.A)({pathname:"/",search:"",hash:"",state:null,key:"default"},m),navigationType:"POP"}},S):S}function ve(){let e=Ne(),t=Z(e)?"".concat(e.status," ").concat(e.statusText):e instanceof Error?e.message:JSON.stringify(e),r=e instanceof Error?e.stack:null,n="rgba(200,200,200, 0.5)",i={padding:"0.5rem",backgroundColor:n},s={padding:"2px 4px",backgroundColor:n},a=null;return console.error("Error handled by React Router default ErrorBoundary:",e),a=o.createElement(o.Fragment,null,o.createElement("p",null,"\ud83d\udcbf Hey developer \ud83d\udc4b"),o.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",o.createElement("code",{style:s},"ErrorBoundary")," or"," ",o.createElement("code",{style:s},"errorElement")," prop on your route.")),o.createElement(o.Fragment,null,o.createElement("h2",null,"Unexpected Application Error!"),o.createElement("h3",{style:{fontStyle:"italic"}},t),r?o.createElement("pre",{style:i},r):null,a)}var xe=o.createElement(ve,null),be=class extends o.Component{constructor(e){super(e),this.state={location:e.location,revalidation:e.revalidation,error:e.error}}static getDerivedStateFromError(e){return{error:e}}static getDerivedStateFromProps(e,t){return t.location!==e.location||"idle"!==t.revalidation&&"idle"===e.revalidation?{error:e.error,location:e.location,revalidation:e.revalidation}:{error:void 0!==e.error?e.error:t.error,location:t.location,revalidation:e.revalidation||t.revalidation}}componentDidCatch(e,t){this.props.onError?this.props.onError(e,t):console.error("React Router caught the following error during render",e)}render(){let e=this.state.error;if(this.context&&"object"===typeof e&&e&&"digest"in e&&"string"===typeof e.digest){const t=function(e){if(e.startsWith("".concat(ue,":").concat("ROUTE_ERROR_RESPONSE",":{")))try{let t=JSON.parse(e.slice(40));if("object"===typeof t&&t&&"number"===typeof t.status&&"string"===typeof t.statusText)return new G(t.status,t.statusText,t.data)}catch(t){}}(e.digest);t&&(e=t)}let t=void 0!==e?o.createElement(le.Provider,{value:this.props.routeContext},o.createElement(ce.Provider,{value:e,children:this.props.component})):this.props.children;return this.context?o.createElement(je,{error:e},t):t}};be.contextType=te;var we=new WeakMap;function je(e){let{children:t,error:r}=e,{basename:n}=o.useContext(oe);if("object"===typeof r&&r&&"digest"in r&&"string"===typeof r.digest){let e=function(e){if(e.startsWith("".concat(ue,":").concat("REDIRECT",":{")))try{let t=JSON.parse(e.slice(28));if("object"===typeof t&&t&&"number"===typeof t.status&&"string"===typeof t.statusText&&"string"===typeof t.location&&"boolean"===typeof t.reloadDocument&&"boolean"===typeof t.replace)return t}catch(t){}}(r.digest);if(e){let t=we.get(r);if(t)throw t;let i=X(e.location,n);if(Y&&!we.get(r)){if(!i.isExternal&&!e.reloadDocument){const t=Promise.resolve().then(()=>window.__reactRouterDataRouter.navigate(i.to,{replace:e.replace}));throw we.set(r,t),t}window.location.href=i.absoluteURL||i.to}return o.createElement("meta",{httpEquiv:"refresh",content:"0;url=".concat(i.absoluteURL||i.to)})}}return t}function Se(e){let{routeContext:t,match:r,children:n}=e,i=o.useContext($);return i&&i.static&&i.staticContext&&(r.route.errorElement||r.route.ErrorBoundary)&&(i.staticContext._deepestRenderedBoundaryId=r.route.id),o.createElement(le.Provider,{value:t},n)}function Te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(null==e){if(!r)return null;if(r.errors)e=r.matches;else{if(0!==t.length||r.initialized||!(r.matches.length>0))return null;e=r.matches}}let i=e,s=null===r||void 0===r?void 0:r.errors;if(null!=s){let e=i.findIndex(e=>e.route.id&&void 0!==(null===s||void 0===s?void 0:s[e.route.id]));f(e>=0,"Could not find a matching route for errors on route IDs: ".concat(Object.keys(s).join(","))),i=i.slice(0,Math.min(i.length,e+1))}let a=!1,l=-1;if(r)for(let o=0;o<i.length;o++){let e=i[o];if((e.route.HydrateFallback||e.route.hydrateFallbackElement)&&(l=o),e.route.id){let{loaderData:t,errors:n}=r,s=e.route.loader&&!t.hasOwnProperty(e.route.id)&&(!n||void 0===n[e.route.id]);if(e.route.lazy||s){a=!0,i=l>=0?i.slice(0,l+1):[i[0]];break}}}let c=r&&n?(e,t)=>{var i,s;n(e,{location:r.location,params:null!==(i=null===(s=r.matches)||void 0===s||null===(s=s[0])||void 0===s?void 0:s.params)&&void 0!==i?i:{},unstable_pattern:K(r.matches),errorInfo:t})}:void 0;return i.reduceRight((e,n,u)=>{let d,h=!1,p=null,m=null;r&&(d=s&&n.route.id?s[n.route.id]:void 0,p=n.route.errorElement||xe,a&&(l<0&&0===u?(Pe("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),h=!0,m=null):l===u&&(h=!0,m=n.route.hydrateFallbackElement||null)));let f=t.concat(i.slice(0,u+1)),g=()=>{let t;return t=d?p:h?m:n.route.Component?o.createElement(n.route.Component,null):n.route.element?n.route.element:e,o.createElement(Se,{match:n,routeContext:{outlet:e,matches:f,isDataRoute:null!=r},children:t})};return r&&(n.route.ErrorBoundary||n.route.errorElement||0===u)?o.createElement(be,{location:r.location,revalidation:r.revalidation,component:p,error:d,children:g(),routeContext:{outlet:null,matches:f,isDataRoute:!0},onError:c}):g()},null)}function ke(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function Ae(e){let t=o.useContext($);return f(t,ke(e)),t}function Ce(e){let t=o.useContext(ee);return f(t,ke(e)),t}function Ee(e){let t=function(e){let t=o.useContext(le);return f(t,ke(e)),t}(e),r=t.matches[t.matches.length-1];return f(r.route.id,"".concat(e,' can only be used on routes that contain a unique "id"')),r.route.id}function Ne(){var e;let t=o.useContext(ce),r=Ce("useRouteError"),n=Ee("useRouteError");return void 0!==t?t:null===(e=r.errors)||void 0===e?void 0:e[n]}var Ie={};function Pe(e,t,r){t||Ie[e]||(Ie[e]=!0,g(!1,r))}var Me={};function Le(e,t){e||Me[t]||(Me[t]=!0,console.warn(t))}(n||(n=r.t(o,2))).useOptimistic;o.memo(function(e){let{routes:t,future:r,state:n,onError:i}=e;return _e(t,void 0,n,i,r)});function Re(e){let{to:t,replace:r,state:n,relative:i}=e;f(de(),"<Navigate> may be used only in the context of a <Router> component.");let{static:s}=o.useContext(oe);g(!s,"<Navigate> must not be used on the initial render in a <StaticRouter>. This is a no-op, but you should modify your code so the <Navigate> is only ever rendered in response to some user interaction or state change.");let{matches:a}=o.useContext(le),{pathname:l}=he(),c=fe(),u=U(t,B(a),l,"path"===i),d=JSON.stringify(u);return o.useEffect(()=>{c(JSON.parse(d),{replace:r,state:n,relative:i})},[c,d,i,r,n]),null}function De(e){f(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function Fe(e){let{basename:t="/",children:r=null,location:n,navigationType:i="POP",navigator:s,static:a=!1,unstable_useTransitions:l}=e;f(!de(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let c=t.replace(/^\/*/,"/"),u=o.useMemo(()=>({basename:c,navigator:s,static:a,unstable_useTransitions:l,future:{}}),[c,s,a,l]);"string"===typeof n&&(n=x(n));let{pathname:d="/",search:h="",hash:p="",state:m=null,key:y="default"}=n,_=o.useMemo(()=>{let e=L(d,c);return null==e?null:{location:{pathname:e,search:h,hash:p,state:m,key:y},navigationType:i}},[c,d,h,p,m,y,i]);return g(null!=_,'<Router basename="'.concat(c,'"> is not able to match the URL "').concat(d).concat(h).concat(p,"\" because it does not start with the basename, so the <Router> won't render anything.")),null==_?null:o.createElement(oe.Provider,{value:u},o.createElement(ae.Provider,{children:r,value:_}))}function Oe(e){let{children:t,location:r}=e;return _e(ze(t),r)}o.Component;function ze(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=[];return o.Children.forEach(e,(e,n)=>{if(!o.isValidElement(e))return;let i=[...t,n];if(e.type===o.Fragment)return void r.push.apply(r,ze(e.props.children,i));f(e.type===De,"[".concat("string"===typeof e.type?e.type:e.type.name,"] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>")),f(!e.props.index||!e.props.children,"An index route cannot have child routes.");let s={id:e.props.id||i.join("-"),caseSensitive:e.props.caseSensitive,element:e.props.element,Component:e.props.Component,index:e.props.index,path:e.props.path,middleware:e.props.middleware,loader:e.props.loader,action:e.props.action,hydrateFallbackElement:e.props.hydrateFallbackElement,HydrateFallback:e.props.HydrateFallback,errorElement:e.props.errorElement,ErrorBoundary:e.props.ErrorBoundary,hasErrorBoundary:!0===e.props.hasErrorBoundary||null!=e.props.ErrorBoundary||null!=e.props.errorElement,shouldRevalidate:e.props.shouldRevalidate,handle:e.props.handle,lazy:e.props.lazy};e.props.children&&(s.children=ze(e.props.children,i)),r.push(s)}),r}var Be="get",Ue="application/x-www-form-urlencoded";function Ve(e){return"undefined"!==typeof HTMLElement&&e instanceof HTMLElement}function qe(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"";return new URLSearchParams("string"===typeof e||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((t,r)=>{let n=e[r];return t.concat(Array.isArray(n)?n.map(e=>[r,e]):[[r,n]])},[]))}var We=null;var He=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Ge(e){return null==e||He.has(e)?e:(g(!1,'"'.concat(e,'" is not a valid `encType` for `<Form>`/`<fetcher.Form>` and will default to "').concat(Ue,'"')),null)}function Ze(e,t){let r,n,i,s,o;if(Ve(a=e)&&"form"===a.tagName.toLowerCase()){let o=e.getAttribute("action");n=o?L(o,t):null,r=e.getAttribute("method")||Be,i=Ge(e.getAttribute("enctype"))||Ue,s=new FormData(e)}else if(function(e){return Ve(e)&&"button"===e.tagName.toLowerCase()}(e)||function(e){return Ve(e)&&"input"===e.tagName.toLowerCase()}(e)&&("submit"===e.type||"image"===e.type)){let o=e.form;if(null==o)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let a=e.getAttribute("formaction")||o.getAttribute("action");if(n=a?L(a,t):null,r=e.getAttribute("formmethod")||o.getAttribute("method")||Be,i=Ge(e.getAttribute("formenctype"))||Ge(o.getAttribute("enctype"))||Ue,s=new FormData(o,e),!function(){if(null===We)try{new FormData(document.createElement("form"),0),We=!1}catch(e){We=!0}return We}()){let{name:t,type:r,value:n}=e;if("image"===r){let e=t?"".concat(t,"."):"";s.append("".concat(e,"x"),"0"),s.append("".concat(e,"y"),"0")}else t&&s.append(t,n)}}else{if(Ve(e))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');r=Be,n=null,i=Ue,o=e}var a;return s&&"text/plain"===i&&(o=s,s=void 0),{action:n,method:r.toLowerCase(),encType:i,formData:s,body:o}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");"undefined"!==typeof window?window:"undefined"!==typeof globalThis&&globalThis;function Ke(e,t){if(!1===e||null===e||"undefined"===typeof e)throw new Error(t)}Symbol("SingleFetchRedirect");function Ye(e,t,r){let n="string"===typeof e?new URL(e,"undefined"===typeof window?"server://singlefetch/":window.location.origin):e;return"/"===n.pathname?n.pathname="_root.".concat(r):t&&"/"===L(n.pathname,t)?n.pathname="".concat(t.replace(/\/$/,""),"/_root.").concat(r):n.pathname="".concat(n.pathname.replace(/\/$/,""),".").concat(r),n}async function Xe(e,t){if(e.id in t)return t[e.id];try{let r=await import(e.module);return t[e.id]=r,r}catch(r){return console.error("Error loading route module `".concat(e.module,"`, reloading page...")),console.error(r),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Je(e){return null!=e&&"string"===typeof e.page}function Qe(e){return null!=e&&(null==e.href?"preload"===e.rel&&"string"===typeof e.imageSrcSet&&"string"===typeof e.imageSizes:"string"===typeof e.rel&&"string"===typeof e.href)}function $e(e,t,r,n,i,s){let o=(e,t)=>!r[t]||e.route.id!==r[t].route.id,a=(e,t)=>{var n;return r[t].pathname!==e.pathname||(null===(n=r[t].route.path)||void 0===n?void 0:n.endsWith("*"))&&r[t].params["*"]!==e.params["*"]};return"assets"===s?t.filter((e,t)=>o(e,t)||a(e,t)):"data"===s?t.filter((t,s)=>{let l=n.routes[t.route.id];if(!l||!l.hasLoader)return!1;if(o(t,s)||a(t,s))return!0;if(t.route.shouldRevalidate){var c;let n=t.route.shouldRevalidate({currentUrl:new URL(i.pathname+i.search+i.hash,window.origin),currentParams:(null===(c=r[0])||void 0===c?void 0:c.params)||{},nextUrl:new URL(e,window.origin),nextParams:t.params,defaultShouldRevalidate:!0});if("boolean"===typeof n)return n}return!0}):[]}function et(e,t){let{includeHydrateFallback:r}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return n=e.map(e=>{let n=t.routes[e.route.id];if(!n)return[];let i=[n.module];return n.clientActionModule&&(i=i.concat(n.clientActionModule)),n.clientLoaderModule&&(i=i.concat(n.clientLoaderModule)),r&&n.hydrateFallbackModule&&(i=i.concat(n.hydrateFallbackModule)),n.imports&&(i=i.concat(n.imports)),i}).flat(1),[...new Set(n)];var n}function tt(e,t){let r=new Set,n=new Set(t);return e.reduce((e,i)=>{if(t&&!Je(i)&&"script"===i.as&&i.href&&n.has(i.href))return e;let s=JSON.stringify(function(e){let t={},r=Object.keys(e).sort();for(let n of r)t[n]=e[n];return t}(i));return r.has(s)||(r.add(s),e.push({key:s,link:i})),e},[])}function rt(e,t){return"lazy"===e.mode&&!0===t}function nt(){let e=o.useContext($);return Ke(e,"You must render this element inside a <DataRouterContext.Provider> element"),e}function it(){let e=o.useContext(ee);return Ke(e,"You must render this element inside a <DataRouterStateContext.Provider> element"),e}var st=o.createContext(void 0);function ot(){let e=o.useContext(st);return Ke(e,"You must render this element inside a <HydratedRouter> element"),e}function at(e,t){return r=>{e&&e(r),r.defaultPrevented||t(r)}}function lt(e,t,r){if(r&&!ht)return[e[0]];if(t){let r=e.findIndex(e=>void 0!==t[e.route.id]);return e.slice(0,r+1)}return e}st.displayName="FrameworkContext";function ct(e){let{page:t}=e,r=(0,i.A)(e,l),{router:n}=nt(),a=o.useMemo(()=>j(n.routes,t,n.basename),[n.routes,t,n.basename]);return a?o.createElement(dt,(0,s.A)({page:t,matches:a},r)):null}function ut(e){let{manifest:t,routeModules:r}=ot(),[n,i]=o.useState([]);return o.useEffect(()=>{let n=!1;return async function(e,t,r){return tt((await Promise.all(e.map(async e=>{let n=t.routes[e.route.id];if(n){let e=await Xe(n,r);return e.links?e.links():[]}return[]}))).flat(1).filter(Qe).filter(e=>"stylesheet"===e.rel||"preload"===e.rel).map(e=>"stylesheet"===e.rel?(0,s.A)((0,s.A)({},e),{},{rel:"prefetch",as:"style"}):(0,s.A)((0,s.A)({},e),{},{rel:"prefetch"})))}(e,t,r).then(e=>{n||i(e)}),()=>{n=!0}},[e,t,r]),n}function dt(e){let{page:t,matches:r}=e,n=(0,i.A)(e,c),a=he(),{manifest:l,routeModules:u}=ot(),{basename:d}=nt(),{loaderData:h,matches:p}=it(),m=o.useMemo(()=>$e(t,r,p,l,a,"data"),[t,r,p,l,a]),f=o.useMemo(()=>$e(t,r,p,l,a,"assets"),[t,r,p,l,a]),g=o.useMemo(()=>{if(t===a.pathname+a.search+a.hash)return[];let e=new Set,n=!1;if(r.forEach(t=>{var r;let i=l.routes[t.route.id];i&&i.hasLoader&&(!m.some(e=>e.route.id===t.route.id)&&t.route.id in h&&null!==(r=u[t.route.id])&&void 0!==r&&r.shouldRevalidate||i.hasClientLoader?n=!0:e.add(t.route.id))}),0===e.size)return[];let i=Ye(t,d,"data");return n&&e.size>0&&i.searchParams.set("_routes",r.filter(t=>e.has(t.route.id)).map(e=>e.route.id).join(",")),[i.pathname+i.search]},[d,h,a,l,m,r,t,u]),y=o.useMemo(()=>et(f,l),[f,l]),_=ut(f);return o.createElement(o.Fragment,null,g.map(e=>o.createElement("link",(0,s.A)({key:e,rel:"prefetch",as:"fetch",href:e},n))),y.map(e=>o.createElement("link",(0,s.A)({key:e,rel:"modulepreload",href:e},n))),_.map(e=>{let{key:t,link:r}=e;return o.createElement("link",(0,s.A)({key:t,nonce:n.nonce},r))}))}var ht=!1;function pt(e){let{manifest:t,serverHandoffString:r,isSpaMode:n,renderMeta:l,routeDiscovery:c,ssr:u}=ot(),{router:d,static:h,staticContext:p}=nt(),{matches:m}=it(),f=re(),g=rt(c,u);l&&(l.didRenderScripts=!0);let y=lt(m,null,n);o.useEffect(()=>{ht=!0},[]);let _=o.useMemo(()=>{var n;if(f)return null;let l=p?"window.__reactRouterContext = ".concat(r,";").concat("window.__reactRouterContext.stream = new ReadableStream({start(controller){window.__reactRouterContext.streamController = controller;}}).pipeThrough(new TextEncoderStream());"):" ",c=h?"".concat(null!==(n=t.hmr)&&void 0!==n&&n.runtime?"import ".concat(JSON.stringify(t.hmr.runtime),";"):"").concat(g?"":"import ".concat(JSON.stringify(t.url)),";\n").concat(y.map((e,r)=>{let n="route".concat(r),i=t.routes[e.route.id];Ke(i,"Route ".concat(e.route.id," not found in manifest"));let{clientActionModule:s,clientLoaderModule:o,clientMiddlewareModule:a,hydrateFallbackModule:l,module:c}=i,u=[...s?[{module:s,varName:"".concat(n,"_clientAction")}]:[],...o?[{module:o,varName:"".concat(n,"_clientLoader")}]:[],...a?[{module:a,varName:"".concat(n,"_clientMiddleware")}]:[],...l?[{module:l,varName:"".concat(n,"_HydrateFallback")}]:[],{module:c,varName:"".concat(n,"_main")}];return 1===u.length?"import * as ".concat(n," from ").concat(JSON.stringify(c),";"):[u.map(e=>"import * as ".concat(e.varName,' from "').concat(e.module,'";')).join("\n"),"const ".concat(n," = {").concat(u.map(e=>"...".concat(e.varName)).join(","),"};")].join("\n")}).join("\n"),"\n  ").concat(g?"window.__reactRouterManifest = ".concat(JSON.stringify(function(e,t){let{sri:r}=e,n=(0,i.A)(e,a),o=new Set(t.state.matches.map(e=>e.route.id)),l=t.state.location.pathname.split("/").filter(Boolean),c=["/"];for(l.pop();l.length>0;)c.push("/".concat(l.join("/"))),l.pop();c.forEach(e=>{let r=j(t.routes,e,t.basename);r&&r.forEach(e=>o.add(e.route.id))});let u=[...o].reduce((e,t)=>Object.assign(e,{[t]:n.routes[t]}),{});return(0,s.A)((0,s.A)({},n),{},{routes:u,sri:!!r||void 0})}(t,d),null,2),";"):"","\n  window.__reactRouterRouteModules = {").concat(y.map((e,t)=>"".concat(JSON.stringify(e.route.id),":route").concat(t)).join(","),"};\n\nimport(").concat(JSON.stringify(t.entry.module),");"):" ";return o.createElement(o.Fragment,null,o.createElement("script",(0,s.A)((0,s.A)({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:l},type:void 0})),o.createElement("script",(0,s.A)((0,s.A)({},e),{},{suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:c},type:"module",async:!0})))},[]),v=ht||f?[]:(x=t.entry.imports.concat(et(y,t,{includeHydrateFallback:!0})),[...new Set(x)]);var x;let b="object"===typeof t.sri?t.sri:{};return Le(!f,"The <Scripts /> element is a no-op when using RSC and can be safely removed."),ht||f?null:o.createElement(o.Fragment,null,"object"===typeof t.sri?o.createElement("script",{"rr-importmap":"",type:"importmap",suppressHydrationWarning:!0,dangerouslySetInnerHTML:{__html:JSON.stringify({integrity:b})}}):null,g?null:o.createElement("link",{rel:"modulepreload",href:t.url,crossOrigin:e.crossOrigin,integrity:b[t.url],suppressHydrationWarning:!0}),o.createElement("link",{rel:"modulepreload",href:t.entry.module,crossOrigin:e.crossOrigin,integrity:b[t.entry.module],suppressHydrationWarning:!0}),v.map(t=>o.createElement("link",{key:t,rel:"modulepreload",href:t,crossOrigin:e.crossOrigin,integrity:b[t],suppressHydrationWarning:!0})),_)}function mt(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return e=>{t.forEach(t=>{"function"===typeof t?t(e):null!=t&&(t.current=e)})}}o.Component;function ft(e){let{error:t,isOutsideRemixApp:r}=e;console.error(t);let n,i=o.createElement("script",{dangerouslySetInnerHTML:{__html:'\n        console.log(\n          "\ud83d\udcbf Hey developer \ud83d\udc4b. You can provide a way better UX than this when your app throws errors. Check out https://reactrouter.com/how-to/error-boundary for more information."\n        );\n      '}});if(Z(t))return o.createElement(gt,{title:"Unhandled Thrown Response!"},o.createElement("h1",{style:{fontSize:"24px"}},t.status," ",t.statusText),i);if(t instanceof Error)n=t;else{let e=null==t?"Unknown Error":"object"===typeof t&&"toString"in t?t.toString():JSON.stringify(t);n=new Error(e)}return o.createElement(gt,{title:"Application Error!",isOutsideRemixApp:r},o.createElement("h1",{style:{fontSize:"24px"}},"Application Error"),o.createElement("pre",{style:{padding:"2rem",background:"hsla(10, 50%, 50%, 0.1)",color:"red",overflow:"auto"}},n.stack),i)}function gt(e){var t;let{title:r,renderScripts:n,isOutsideRemixApp:i,children:s}=e,{routeModules:a}=ot();return null!==(t=a.root)&&void 0!==t&&t.Layout&&!i?s:o.createElement("html",{lang:"en"},o.createElement("head",null,o.createElement("meta",{charSet:"utf-8"}),o.createElement("meta",{name:"viewport",content:"width=device-width,initial-scale=1,viewport-fit=cover"}),o.createElement("title",null,r)),o.createElement("body",null,o.createElement("main",{style:{fontFamily:"system-ui, sans-serif",padding:"2rem"}},s,n?o.createElement(pt,null):null)))}var yt="undefined"!==typeof window&&"undefined"!==typeof window.document&&"undefined"!==typeof window.document.createElement;try{yt&&(window.__reactRouterVersion="7.11.0")}catch(Ct){}function _t(e){let{basename:t,children:r,unstable_useTransitions:n,window:i}=e,s=o.useRef();null==s.current&&(s.current=m({window:i,v5Compat:!0}));let a=s.current,[l,c]=o.useState({action:a.action,location:a.location}),u=o.useCallback(e=>{!1===n?c(e):o.startTransition(()=>c(e))},[n]);return o.useLayoutEffect(()=>a.listen(u),[a,u]),o.createElement(Fe,{basename:t,children:r,location:l.location,navigationType:l.action,navigator:a,unstable_useTransitions:n})}var vt=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,xt=o.forwardRef(function(e,t){let{onClick:r,discover:n="render",prefetch:a="none",relative:l,reloadDocument:c,replace:d,state:h,target:p,to:m,preventScrollReset:g,viewTransition:y,unstable_defaultShouldRevalidate:_}=e,x=(0,i.A)(e,u),{basename:b,unstable_useTransitions:w}=o.useContext(oe),j="string"===typeof m&&vt.test(m),S=X(m,b);m=S.to;let T=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};f(de(),"useHref() may be used only in the context of a <Router> component.");let{basename:r,navigator:n}=o.useContext(oe),{hash:i,pathname:s,search:a}=ye(e,{relative:t}),l=s;return"/"!==r&&(l="/"===s?r:V([r,s])),n.createHref({pathname:l,search:a,hash:i})}(m,{relative:l}),[k,A,C]=function(e,t){let r=o.useContext(st),[n,i]=o.useState(!1),[s,a]=o.useState(!1),{onFocus:l,onBlur:c,onMouseEnter:u,onMouseLeave:d,onTouchStart:h}=t,p=o.useRef(null);o.useEffect(()=>{if("render"===e&&a(!0),"viewport"===e){let e=new IntersectionObserver(e=>{e.forEach(e=>{a(e.isIntersecting)})},{threshold:.5});return p.current&&e.observe(p.current),()=>{e.disconnect()}}},[e]),o.useEffect(()=>{if(n){let e=setTimeout(()=>{a(!0)},100);return()=>{clearTimeout(e)}}},[n]);let m=()=>{i(!0)},f=()=>{i(!1),a(!1)};return r?"intent"!==e?[s,p,{}]:[s,p,{onFocus:at(l,m),onBlur:at(c,f),onMouseEnter:at(u,m),onMouseLeave:at(d,f),onTouchStart:at(h,m)}]:[!1,p,{}]}(a,x),E=function(e){let{target:t,replace:r,state:n,preventScrollReset:i,relative:s,viewTransition:a,unstable_defaultShouldRevalidate:l,unstable_useTransitions:c}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},u=fe(),d=he(),h=ye(e,{relative:s});return o.useCallback(p=>{if(function(e,t){return 0===e.button&&(!t||"_self"===t)&&!function(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}(e)}(p,t)){p.preventDefault();let t=void 0!==r?r:v(d)===v(h),m=()=>u(e,{replace:t,state:n,preventScrollReset:i,relative:s,viewTransition:a,unstable_defaultShouldRevalidate:l});c?o.startTransition(()=>m()):m()}},[d,u,h,r,n,t,e,i,s,a,l,c])}(m,{replace:d,state:h,target:p,preventScrollReset:g,relative:l,viewTransition:y,unstable_defaultShouldRevalidate:_,unstable_useTransitions:w});let N=o.createElement("a",(0,s.A)((0,s.A)((0,s.A)({},x),C),{},{href:S.absoluteURL||T,onClick:S.isExternal||c?r:function(e){r&&r(e),e.defaultPrevented||E(e)},ref:mt(t,A),target:p,"data-discover":j||"render"!==n?void 0:"true"}));return k&&!j?o.createElement(o.Fragment,null,N,o.createElement(ct,{page:T})):N});xt.displayName="Link";var bt=o.forwardRef(function(e,t){let{"aria-current":r="page",caseSensitive:n=!1,className:a="",end:l=!1,style:c,to:u,viewTransition:h,children:p}=e,m=(0,i.A)(e,d),g=ye(u,{relative:m.relative}),y=he(),_=o.useContext(ee),{navigator:v,basename:x}=o.useContext(oe),b=null!=_&&function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=o.useContext(ne);f(null!=r,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=St("useViewTransitionState"),i=ye(e,{relative:t});if(!r.isTransitioning)return!1;let s=L(r.currentLocation.pathname,n)||r.currentLocation.pathname,a=L(r.nextLocation.pathname,n)||r.nextLocation.pathname;return null!=I(i.pathname,a)||null!=I(i.pathname,s)}(g)&&!0===h,w=v.encodeLocation?v.encodeLocation(g).pathname:g.pathname,j=y.pathname,S=_&&_.navigation&&_.navigation.location?_.navigation.location.pathname:null;n||(j=j.toLowerCase(),S=S?S.toLowerCase():null,w=w.toLowerCase()),S&&x&&(S=L(S,x)||S);const T="/"!==w&&w.endsWith("/")?w.length-1:w.length;let k,A=j===w||!l&&j.startsWith(w)&&"/"===j.charAt(T),C=null!=S&&(S===w||!l&&S.startsWith(w)&&"/"===S.charAt(w.length)),E={isActive:A,isPending:C,isTransitioning:b},N=A?r:void 0;k="function"===typeof a?a(E):[a,A?"active":null,C?"pending":null,b?"transitioning":null].filter(Boolean).join(" ");let P="function"===typeof c?c(E):c;return o.createElement(xt,(0,s.A)((0,s.A)({},m),{},{"aria-current":N,className:k,ref:t,style:P,to:u,viewTransition:h}),"function"===typeof p?p(E):p)});bt.displayName="NavLink";var wt=o.forwardRef((e,t)=>{let{discover:r="render",fetcherKey:n,navigate:a,reloadDocument:l,replace:c,state:u,method:d=Be,action:p,onSubmit:m,relative:g,preventScrollReset:y,viewTransition:_,unstable_defaultShouldRevalidate:x}=e,b=(0,i.A)(e,h),{unstable_useTransitions:w}=o.useContext(oe),j=At(),S=function(e){let{relative:t}=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{basename:r}=o.useContext(oe),n=o.useContext(le);f(n,"useFormAction must be used inside a RouteContext");let[i]=n.matches.slice(-1),a=(0,s.A)({},ye(e||".",{relative:t})),l=he();if(null==e){a.search=l.search;let e=new URLSearchParams(a.search),t=e.getAll("index");if(t.some(e=>""===e)){e.delete("index"),t.filter(e=>e).forEach(t=>e.append("index",t));let r=e.toString();a.search=r?"?".concat(r):""}}e&&"."!==e||!i.route.index||(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index");"/"!==r&&(a.pathname="/"===a.pathname?r:V([r,a.pathname]));return v(a)}(p,{relative:g}),T="get"===d.toLowerCase()?"get":"post",k="string"===typeof p&&vt.test(p);return o.createElement("form",(0,s.A)((0,s.A)({ref:t,method:T,action:S,onSubmit:l?m:e=>{if(m&&m(e),e.defaultPrevented)return;e.preventDefault();let t=e.nativeEvent.submitter,r=(null===t||void 0===t?void 0:t.getAttribute("formmethod"))||d,i=()=>j(t||e.currentTarget,{fetcherKey:n,method:r,navigate:a,replace:c,state:u,relative:g,preventScrollReset:y,viewTransition:_,unstable_defaultShouldRevalidate:x});w&&!1!==a?o.startTransition(()=>i()):i()}},b),{},{"data-discover":k||"render"!==r?void 0:"true"}))});function jt(e){return"".concat(e," must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.")}function St(e){let t=o.useContext($);return f(t,jt(e)),t}function Tt(e){g("undefined"!==typeof URLSearchParams,"You cannot use the `useSearchParams` hook in a browser that does not support the URLSearchParams API. If you need to support Internet Explorer 11, we recommend you load a polyfill such as https://github.com/ungap/url-search-params.");let t=o.useRef(qe(e)),r=o.useRef(!1),n=he(),i=o.useMemo(()=>function(e,t){let r=qe(e);return t&&t.forEach((e,n)=>{r.has(n)||t.getAll(n).forEach(e=>{r.append(n,e)})}),r}(n.search,r.current?null:t.current),[n.search]),s=fe(),a=o.useCallback((e,t)=>{const n=qe("function"===typeof e?e(new URLSearchParams(i)):e);r.current=!0,s("?"+n,t)},[s,i]);return[i,a]}wt.displayName="Form";var kt=0;function At(){let{router:e}=St("useSubmit"),{basename:t}=o.useContext(oe),r=Ee("useRouteId"),n=e.fetch,i=e.navigate;return o.useCallback(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},{action:o,method:a,encType:l,formData:c,body:u}=Ze(e,t);if(!1===s.navigate){let e=s.fetcherKey||"__".concat(String(++kt),"__");await n(e,r,s.action||o,{unstable_defaultShouldRevalidate:s.unstable_defaultShouldRevalidate,preventScrollReset:s.preventScrollReset,formData:c,body:u,formMethod:s.method||a,formEncType:s.encType||l,flushSync:s.flushSync})}else await i(s.action||o,{unstable_defaultShouldRevalidate:s.unstable_defaultShouldRevalidate,preventScrollReset:s.preventScrollReset,formData:c,body:u,formMethod:s.method||a,formEncType:s.encType||l,replace:s.replace,state:s.state,fromRouteId:r,flushSync:s.flushSync,viewTransition:s.viewTransition})},[n,i,t,r])}},784(e,t,r){"use strict";r.d(t,{A:()=>h});var n=r(555),i=r(986),s=r(43);const o=e=>{const t=(e=>e.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,t,r)=>r?r.toUpperCase():t.toLowerCase()))(e);return t.charAt(0).toUpperCase()+t.slice(1)},a=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];return t.filter((e,t,r)=>Boolean(e)&&""!==e.trim()&&r.indexOf(e)===t).join(" ").trim()};var l={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};const c=["color","size","strokeWidth","absoluteStrokeWidth","className","children","iconNode"],u=(0,s.forwardRef)((e,t)=>{let{color:r="currentColor",size:o=24,strokeWidth:u=2,absoluteStrokeWidth:d,className:h="",children:p,iconNode:m}=e,f=(0,i.A)(e,c);return(0,s.createElement)("svg",(0,n.A)((0,n.A)((0,n.A)({ref:t},l),{},{width:o,height:o,stroke:r,strokeWidth:d?24*Number(u)/Number(o):u,className:a("lucide",h)},!p&&!(e=>{for(const t in e)if(t.startsWith("aria-")||"role"===t||"title"===t)return!0})(f)&&{"aria-hidden":"true"}),f),[...m.map(e=>{let[t,r]=e;return(0,s.createElement)(t,r)}),...Array.isArray(p)?p:[p]])}),d=["className"],h=(e,t)=>{const r=(0,s.forwardRef)((r,l)=>{let{className:c}=r,h=(0,i.A)(r,d);return(0,s.createElement)(u,(0,n.A)({ref:l,iconNode:t,className:a("lucide-".concat((p=o(e),p.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase())),"lucide-".concat(e),c)},h));var p});return r.displayName=o(e),r}},799(e,t){"use strict";var r=Symbol.for("react.transitional.element"),n=Symbol.for("react.fragment");function i(e,t,n){var i=null;if(void 0!==n&&(i=""+n),void 0!==t.key&&(i=""+t.key),"key"in t)for(var s in n={},t)"key"!==s&&(n[s]=t[s]);else n=t;return t=n.ref,{$$typeof:r,type:e,key:i,ref:void 0!==t?t:null,props:n}}t.Fragment=n,t.jsx=i,t.jsxs=i},819(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("circle-alert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]])},847(e,t,r){var n=r(893);e.exports=function(e,t){if(null==e)return{};var r,i,s=n(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(i=0;i<o.length;i++)r=o[i],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(s[r]=e[r])}return s},e.exports.__esModule=!0,e.exports.default=e.exports},853(e,t,r){"use strict";e.exports=r(896)},879(e,t,r){var n=r(847).default;const i=["data"],s=["data"];e.exports=function(){"use strict";var e,t,r;function o(n,i){if(e)if(t){var s="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+e+")(sharedChunk); ("+t+")(sharedChunk); self.onerror = null;",o={};e(o),r=i(o),"undefined"!==typeof window&&window&&window.URL&&window.URL.createObjectURL&&(r.workerUrl=window.URL.createObjectURL(new Blob([s],{type:"text/javascript"})))}else t=i;else e=i}return o(["exports"],function(e){var t=1e-6,r="undefined"!=typeof Float32Array?Float32Array:Array;function n(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],o=r*s-i*n;return o?(e[0]=s*(o=1/o),e[1]=-n*o,e[2]=-i*o,e[3]=r*o,e):null}function i(){var e=new r(9);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[5]=0,e[6]=0,e[7]=0),e[0]=1,e[4]=1,e[8]=1,e}function s(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8];return e[0]=o*u-a*c,e[1]=i*c-n*u,e[2]=n*a-i*o,e[3]=a*l-s*u,e[4]=r*u-i*l,e[5]=i*s-r*a,e[6]=s*c-o*l,e[7]=n*l-r*c,e[8]=r*o-n*s,e}function o(e,t,r){var n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=r[0],p=r[1],m=r[2],f=r[3],g=r[4],y=r[5],_=r[6],v=r[7],x=r[8];return e[0]=h*n+p*o+m*c,e[1]=h*i+p*a+m*u,e[2]=h*s+p*l+m*d,e[3]=f*n+g*o+y*c,e[4]=f*i+g*a+y*u,e[5]=f*s+g*l+y*d,e[6]=_*n+v*o+x*c,e[7]=_*i+v*a+x*u,e[8]=_*s+v*l+x*d,e}function a(){var e=new r(16);return r!=Float32Array&&(e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=0,e[12]=0,e[13]=0,e[14]=0),e[0]=1,e[5]=1,e[10]=1,e[15]=1,e}function l(e){var t=new r(16);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t[3]=e[3],t[4]=e[4],t[5]=e[5],t[6]=e[6],t[7]=e[7],t[8]=e[8],t[9]=e[9],t[10]=e[10],t[11]=e[11],t[12]=e[12],t[13]=e[13],t[14]=e[14],t[15]=e[15],t}function c(e){return e[0]=1,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=1,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=1,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function u(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=t[9],h=t[10],p=t[11],m=t[12],f=t[13],g=t[14],y=t[15],_=r*a-n*o,v=r*l-i*o,x=r*c-s*o,b=n*l-i*a,w=n*c-s*a,j=i*c-s*l,S=u*f-d*m,T=u*g-h*m,k=u*y-p*m,A=d*g-h*f,C=d*y-p*f,E=h*y-p*g,N=_*E-v*C+x*A+b*k-w*T+j*S;return N?(e[0]=(a*E-l*C+c*A)*(N=1/N),e[1]=(i*C-n*E-s*A)*N,e[2]=(f*j-g*w+y*b)*N,e[3]=(h*w-d*j-p*b)*N,e[4]=(l*k-o*E-c*T)*N,e[5]=(r*E-i*k+s*T)*N,e[6]=(g*x-m*j-y*v)*N,e[7]=(u*j-h*x+p*v)*N,e[8]=(o*C-a*k+c*S)*N,e[9]=(n*k-r*C-s*S)*N,e[10]=(m*w-f*x+y*_)*N,e[11]=(d*x-u*w-p*_)*N,e[12]=(a*T-o*A-l*S)*N,e[13]=(r*A-n*T+i*S)*N,e[14]=(f*v-m*b-g*_)*N,e[15]=(u*b-d*v+h*_)*N,e):null}function d(e,t,r){var n=t[0],i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],m=t[11],f=t[12],g=t[13],y=t[14],_=t[15],v=r[0],x=r[1],b=r[2],w=r[3];return e[0]=v*n+x*a+b*d+w*f,e[1]=v*i+x*l+b*h+w*g,e[2]=v*s+x*c+b*p+w*y,e[3]=v*o+x*u+b*m+w*_,e[4]=(v=r[4])*n+(x=r[5])*a+(b=r[6])*d+(w=r[7])*f,e[5]=v*i+x*l+b*h+w*g,e[6]=v*s+x*c+b*p+w*y,e[7]=v*o+x*u+b*m+w*_,e[8]=(v=r[8])*n+(x=r[9])*a+(b=r[10])*d+(w=r[11])*f,e[9]=v*i+x*l+b*h+w*g,e[10]=v*s+x*c+b*p+w*y,e[11]=v*o+x*u+b*m+w*_,e[12]=(v=r[12])*n+(x=r[13])*a+(b=r[14])*d+(w=r[15])*f,e[13]=v*i+x*l+b*h+w*g,e[14]=v*s+x*c+b*p+w*y,e[15]=v*o+x*u+b*m+w*_,e}function h(e,t,r){var n,i,s,o,a,l,c,u,d,h,p,m,f=r[0],g=r[1],y=r[2];return t===e?(e[12]=t[0]*f+t[4]*g+t[8]*y+t[12],e[13]=t[1]*f+t[5]*g+t[9]*y+t[13],e[14]=t[2]*f+t[6]*g+t[10]*y+t[14],e[15]=t[3]*f+t[7]*g+t[11]*y+t[15]):(i=t[1],s=t[2],o=t[3],a=t[4],l=t[5],c=t[6],u=t[7],d=t[8],h=t[9],p=t[10],m=t[11],e[0]=n=t[0],e[1]=i,e[2]=s,e[3]=o,e[4]=a,e[5]=l,e[6]=c,e[7]=u,e[8]=d,e[9]=h,e[10]=p,e[11]=m,e[12]=n*f+a*g+d*y+t[12],e[13]=i*f+l*g+h*y+t[13],e[14]=s*f+c*g+p*y+t[14],e[15]=o*f+u*g+m*y+t[15]),e}function p(e,t,r){var n=r[0],i=r[1],s=r[2];return e[0]=t[0]*n,e[1]=t[1]*n,e[2]=t[2]*n,e[3]=t[3]*n,e[4]=t[4]*i,e[5]=t[5]*i,e[6]=t[6]*i,e[7]=t[7]*i,e[8]=t[8]*s,e[9]=t[9]*s,e[10]=t[10]*s,e[11]=t[11]*s,e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15],e}function m(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[4],o=t[5],a=t[6],l=t[7],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[3],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[4]=s*i+c*n,e[5]=o*i+u*n,e[6]=a*i+d*n,e[7]=l*i+h*n,e[8]=c*i-s*n,e[9]=u*i-o*n,e[10]=d*i-a*n,e[11]=h*i-l*n,e}function f(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],c=t[8],u=t[9],d=t[10],h=t[11];return t!==e&&(e[4]=t[4],e[5]=t[5],e[6]=t[6],e[7]=t[7],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i-c*n,e[1]=o*i-u*n,e[2]=a*i-d*n,e[3]=l*i-h*n,e[8]=s*n+c*i,e[9]=o*n+u*i,e[10]=a*n+d*i,e[11]=l*n+h*i,e}function g(e,t,r){var n=Math.sin(r),i=Math.cos(r),s=t[0],o=t[1],a=t[2],l=t[3],c=t[4],u=t[5],d=t[6],h=t[7];return t!==e&&(e[8]=t[8],e[9]=t[9],e[10]=t[10],e[11]=t[11],e[12]=t[12],e[13]=t[13],e[14]=t[14],e[15]=t[15]),e[0]=s*i+c*n,e[1]=o*i+u*n,e[2]=a*i+d*n,e[3]=l*i+h*n,e[4]=c*i-s*n,e[5]=u*i-o*n,e[6]=d*i-a*n,e[7]=h*i-l*n,e}function y(e,t){return e[0]=t[0],e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=t[1],e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=t[2],e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}function _(e,r,n){var i,s,o,a=n[0],l=n[1],c=n[2],u=Math.sqrt(a*a+l*l+c*c);return u<t?null:(a*=u=1/u,l*=u,c*=u,i=Math.sin(r),s=Math.cos(r),e[0]=a*a*(o=1-s)+s,e[1]=l*a*o+c*i,e[2]=c*a*o-l*i,e[3]=0,e[4]=a*l*o-c*i,e[5]=l*l*o+s,e[6]=c*l*o+a*i,e[7]=0,e[8]=a*c*o+l*i,e[9]=l*c*o-a*i,e[10]=c*c*o+s,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e)}function v(e,t){var r=t[0],n=t[1],i=t[2],s=t[4],o=t[5],a=t[6],l=t[8],c=t[9],u=t[10];return e[0]=Math.sqrt(r*r+n*n+i*i),e[1]=Math.sqrt(s*s+o*o+a*a),e[2]=Math.sqrt(l*l+c*c+u*u),e}function x(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],o=r+r,a=n+n,l=i+i,c=r*o,u=n*o,d=n*a,h=i*o,p=i*a,m=i*l,f=s*o,g=s*a,y=s*l;return e[0]=1-d-m,e[1]=u+y,e[2]=h-g,e[3]=0,e[4]=u-y,e[5]=1-c-m,e[6]=p+f,e[7]=0,e[8]=h+g,e[9]=p-f,e[10]=1-c-d,e[11]=0,e[12]=0,e[13]=0,e[14]=0,e[15]=1,e}var b=d;function w(){var e=new r(3);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e}function j(e){var t=new r(3);return t[0]=e[0],t[1]=e[1],t[2]=e[2],t}function S(e){var t=e[0],r=e[1],n=e[2];return Math.sqrt(t*t+r*r+n*n)}function T(e,t,n){var i=new r(3);return i[0]=e,i[1]=t,i[2]=n,i}function k(e,t,r,n){return e[0]=t,e[1]=r,e[2]=n,e}function A(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e[2]=t[2]+r[2],e}function C(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e[2]=t[2]-r[2],e}function E(e,t,r){return e[0]=t[0]*r[0],e[1]=t[1]*r[1],e[2]=t[2]*r[2],e}function N(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e}function I(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e}function P(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e}function M(e,t,r,n){return e[0]=t[0]+r[0]*n,e[1]=t[1]+r[1]*n,e[2]=t[2]+r[2]*n,e}function L(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return Math.sqrt(r*r+n*n+i*i)}function R(e,t){var r=t[0]-e[0],n=t[1]-e[1],i=t[2]-e[2];return r*r+n*n+i*i}function D(e){var t=e[0],r=e[1],n=e[2];return t*t+r*r+n*n}function F(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e}function O(e,t){var r=t[0],n=t[1],i=t[2],s=r*r+n*n+i*i;return s>0&&(s=1/Math.sqrt(s)),e[0]=t[0]*s,e[1]=t[1]*s,e[2]=t[2]*s,e}function z(e,t){return e[0]*t[0]+e[1]*t[1]+e[2]*t[2]}function B(e,t,r){var n=t[0],i=t[1],s=t[2],o=r[0],a=r[1],l=r[2];return e[0]=i*l-s*a,e[1]=s*o-n*l,e[2]=n*a-i*o,e}function U(e,t,r,n){var i=t[0],s=t[1],o=t[2];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=o+n*(r[2]-o),e}function V(e,t,r){var n=t[0],i=t[1],s=t[2],o=r[3]*n+r[7]*i+r[11]*s+r[15];return e[0]=(r[0]*n+r[4]*i+r[8]*s+r[12])/(o=o||1),e[1]=(r[1]*n+r[5]*i+r[9]*s+r[13])/o,e[2]=(r[2]*n+r[6]*i+r[10]*s+r[14])/o,e}function q(e,t,r){var n=t[0],i=t[1],s=t[2];return e[0]=n*r[0]+i*r[3]+s*r[6],e[1]=n*r[1]+i*r[4]+s*r[7],e[2]=n*r[2]+i*r[5]+s*r[8],e}function W(e,t,r){var n=r[0],i=r[1],s=r[2],o=r[3],a=t[0],l=t[1],c=t[2],u=i*c-s*l,d=s*a-n*c,h=n*l-i*a;return e[0]=a+o*(u+=u)+i*(h+=h)-s*(d+=d),e[1]=l+o*d+s*u-n*h,e[2]=c+o*h+n*d-i*u,e}function H(e){return e[0]=0,e[1]=0,e[2]=0,e}function G(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]}var Z=C,K=E,Y=S;function X(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0,e[3]=0),e}function J(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e[2]=t[2]*r,e[3]=t[3]*r,e}function Q(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],o=r*r+n*n+i*i+s*s;return o>0&&(o=1/Math.sqrt(o)),e[0]=r*o,e[1]=n*o,e[2]=i*o,e[3]=s*o,e}function $(e,t,r){var n=t[0],i=t[1],s=t[2],o=t[3];return e[0]=r[0]*n+r[4]*i+r[8]*s+r[12]*o,e[1]=r[1]*n+r[5]*i+r[9]*s+r[13]*o,e[2]=r[2]*n+r[6]*i+r[10]*s+r[14]*o,e[3]=r[3]*n+r[7]*i+r[11]*s+r[15]*o,e}function ee(){var e=new r(4);return r!=Float32Array&&(e[0]=0,e[1]=0,e[2]=0),e[3]=1,e}function te(e){return e[0]=0,e[1]=0,e[2]=0,e[3]=1,e}function re(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=n*l+o*a,e[1]=i*l+s*a,e[2]=s*l-i*a,e[3]=o*l-n*a,e}function ne(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=n*l-s*a,e[1]=i*l+o*a,e[2]=s*l+n*a,e[3]=o*l-i*a,e}w(),X();var ie,se,oe,ae=Q,le=(ie=w(),se=T(1,0,0),oe=T(0,1,0),function(e,t,r){var n=z(t,r);return n<-.999999?(B(ie,se,t),Y(ie)<1e-6&&B(ie,oe,t),O(ie,ie),function(e,t,r){r*=.5;var n=Math.sin(r);e[0]=n*t[0],e[1]=n*t[1],e[2]=n*t[2],e[3]=Math.cos(r)}(e,ie,Math.PI),e):n>.999999?(e[0]=0,e[1]=0,e[2]=0,e[3]=1,e):(B(ie,t,r),e[0]=ie[0],e[1]=ie[1],e[2]=ie[2],e[3]=1+n,ae(e,e))});function ce(){var e=new r(2);return r!=Float32Array&&(e[0]=0,e[1]=0),e}function ue(e,t){var n=new r(2);return n[0]=e,n[1]=t,n}function de(e,t,r){return e[0]=t,e[1]=r,e}function he(e,t,r){return e[0]=t[0]+r[0],e[1]=t[1]+r[1],e}function pe(e,t,r){return e[0]=t[0]-r[0],e[1]=t[1]-r[1],e}function me(e,t,r){return e[0]=t[0]*r,e[1]=t[1]*r,e}function fe(e){var t=e[0],r=e[1];return Math.sqrt(t*t+r*r)}function ge(e,t){var r=t[0],n=t[1],i=r*r+n*n;return i>0&&(i=1/Math.sqrt(i)),e[0]=t[0]*i,e[1]=t[1]*i,e}function ye(e,t){return e[0]*t[0]+e[1]*t[1]}ee(),ee(),i();var _e,ve,xe=pe;function be(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}ce();var we=function(){if(ve)return _e;function e(e,t,r,n){this.cx=3*e,this.bx=3*(r-e)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*t,this.by=3*(n-t)-this.cy,this.ay=1-this.cy-this.by,this.p1x=e,this.p1y=t,this.p2x=r,this.p2y=n}return ve=1,_e=e,e.prototype={sampleCurveX:function(e){return((this.ax*e+this.bx)*e+this.cx)*e},sampleCurveY:function(e){return((this.ay*e+this.by)*e+this.cy)*e},sampleCurveDerivativeX:function(e){return(3*this.ax*e+2*this.bx)*e+this.cx},solveCurveX:function(e,t){if(void 0===t&&(t=1e-6),e<0)return 0;if(e>1)return 1;for(var r=e,n=0;n<8;n++){var i=this.sampleCurveX(r)-e;if(Math.abs(i)<t)return r;var s=this.sampleCurveDerivativeX(r);if(Math.abs(s)<1e-6)break;r-=i/s}var o=0,a=1;for(r=e,n=0;n<20&&(i=this.sampleCurveX(r),!(Math.abs(i-e)<t));n++)e>i?o=r:a=r,r=.5*(a-o)+o;return r},solve:function(e,t){return this.sampleCurveY(this.solveCurveX(e,t))}},_e}(),je=be(we);function Se(e,t){this.x=e,this.y=t}function Te(e,t){if(Array.isArray(e)){if(!Array.isArray(t)||e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(!Te(e[r],t[r]))return!1;return!0}if("object"==typeof e&&null!==e&&null!==t){if("object"!=typeof t)return!1;if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const r in e)if(!Te(e[r],t[r]))return!1;return!0}return e===t}Se.prototype={clone(){return new Se(this.x,this.y)},add(e){return this.clone()._add(e)},sub(e){return this.clone()._sub(e)},multByPoint(e){return this.clone()._multByPoint(e)},divByPoint(e){return this.clone()._divByPoint(e)},mult(e){return this.clone()._mult(e)},div(e){return this.clone()._div(e)},rotate(e){return this.clone()._rotate(e)},rotateAround(e,t){return this.clone()._rotateAround(e,t)},matMult(e){return this.clone()._matMult(e)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(e){return this.x===e.x&&this.y===e.y},dist(e){return Math.sqrt(this.distSqr(e))},distSqr(e){const t=e.x-this.x,r=e.y-this.y;return t*t+r*r},angle(){return Math.atan2(this.y,this.x)},angleTo(e){return Math.atan2(this.y-e.y,this.x-e.x)},angleWith(e){return this.angleWithSep(e.x,e.y)},angleWithSep(e,t){return Math.atan2(this.x*t-this.y*e,this.x*e+this.y*t)},_matMult(e){const t=e[2]*this.x+e[3]*this.y;return this.x=e[0]*this.x+e[1]*this.y,this.y=t,this},_add(e){return this.x+=e.x,this.y+=e.y,this},_sub(e){return this.x-=e.x,this.y-=e.y,this},_mult(e){return this.x*=e,this.y*=e,this},_div(e){return this.x/=e,this.y/=e,this},_multByPoint(e){return this.x*=e.x,this.y*=e.y,this},_divByPoint(e){return this.x/=e.x,this.y/=e.y,this},_unit(){return this._div(this.mag()),this},_perp(){const e=this.y;return this.y=this.x,this.x=-e,this},_rotate(e){const t=Math.cos(e),r=Math.sin(e),n=r*this.x+t*this.y;return this.x=t*this.x-r*this.y,this.y=n,this},_rotateAround(e,t){const r=Math.cos(e),n=Math.sin(e),i=t.y+n*(this.x-t.x)+r*(this.y-t.y);return this.x=t.x+r*(this.x-t.x)-n*(this.y-t.y),this.y=i,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Se},Se.convert=function(e){if(e instanceof Se)return e;if(Array.isArray(e))return new Se(+e[0],+e[1]);if(void 0!==e.x&&void 0!==e.y)return new Se(+e.x,+e.y);throw new Error("Expected [x, y] or {x, y} point format")};const ke=Math.PI/180,Ae=180/Math.PI;function Ce(e){return e*ke}function Ee(e){return e*Ae}const Ne=[[0,0],[1,0],[1,1],[0,1]];function Ie(e){if(e<=0)return 0;if(e>=1)return 1;const t=e*e,r=t*e;return 4*(e<.5?r:3*(e-t)+r-.75)}function Pe(e,t,r,n){const i=new je(e,t,r,n);return function(e){return i.solve(e)}}const Me=Pe(.25,.1,.25,1);function Le(e,t,r){return Math.min(r,Math.max(t,e))}function Re(e,t,r){return(r=Le((r-e)/(t-e),0,1))*r*(3-2*r)}function De(e,t,r){const n=r-t,i=((e-t)%n+n)%n+t;return i===t?r:i}function Fe(e,t,r){if(!e.length)return r(null,[]);let n=e.length;const i=new Array(e.length);let s=null;e.forEach((e,o)=>{t(e,(e,t)=>{e&&(s=e),i[o]=t,0==--n&&r(s,i)})})}let Oe=1;function ze(){return Oe++}function Be(e){return e<=1?1:Math.pow(2,Math.ceil(Math.log2(e)))}function Ue(e,t){e.forEach(e=>{t[e]&&(t[e]=t[e].bind(t))})}function Ve(e,t,r){const n={};for(const i in e)n[i]=t.call(this,e[i],i,e);return n}function qe(e,t,r){const n={};for(const i in e)t.call(this,e[i],i,e)&&(n[i]=e[i]);return n}function We(e){return Array.isArray(e)?e.map(We):"object"==typeof e&&e?Ve(e,We):e}function He(e,t){for(let r=0;r<e.length;r++)if(t.indexOf(e[r])>=0)return!0;return!1}const Ge={};function Ze(e){Ge[e]||("undefined"!=typeof console&&console.warn(e),Ge[e]=!0)}function Ke(e,t,r){return(r.y-e.y)*(t.x-e.x)>(t.y-e.y)*(r.x-e.x)}function Ye(e){let t=0;for(let r,n,i=0,s=e.length,o=s-1;i<s;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}function Xe(e){let[t,r,n]=e;const i=Ce(r+90),s=Ce(n);return{x:t*Math.cos(i)*Math.sin(s),y:t*Math.sin(i)*Math.sin(s),z:t*Math.cos(s),azimuthal:r,polar:n}}function Je(e){return("undefined"!=typeof self||void 0!==e)&&"undefined"!=typeof WorkerGlobalScope&&(void 0!==e?e:self)instanceof WorkerGlobalScope}function Qe(e){const t={};if(e.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(e,r,n,i)=>{const s=n||i;return t[r]=!s||s.toLowerCase(),""}),t["max-age"]){const e=parseInt(t["max-age"],10);isNaN(e)?delete t["max-age"]:t["max-age"]=e}return t}let $e=null;function et(e,t){return[e[4*t],e[4*t+1],e[4*t+2],e[4*t+3]]}function tt(e,t,r,n){for(;t<r;){const i=t+r>>1;e[i]<n?t=i+1:r=i}return t}function rt(e,t,r,n){for(;t<r;){const i=t+r>>1;e[i]<=n?t=i+1:r=i}return t}function nt(e){return e>0?1/(1.001-e):1+e}function it(e){return e>0?1-1/(1.001-e):-e}function st(e,t,r){return(e-t.min)*(r.max-r.min)/(t.max-t.min)+r.min}const ot={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!ot.API_URL)return null;try{const e=new URL(ot.API_URL);return"api.mapbox.cn"===e.hostname?"https://events.mapbox.cn/events/v2":"api.mapbox.com"===e.hostname?"https://events.mapbox.com/events/v2":null}catch(e){return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.4.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function at(e){return ot.API_URL_REGEX.test(e)}function lt(e){return ot.API_SPRITE_REGEX.test(e)}let ct,ut,dt,ht,pt,mt;function ft(){return null==ct&&(ct=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&"function"==typeof self.createImageBitmap),ct}const gt={now:()=>void 0!==ht?ht:performance.now(),setNow(e){ht=e},restoreNow(){ht=void 0},frame(e){const t=requestAnimationFrame(e);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const{width:r,height:n}=e;pt||(pt=document.createElement("canvas"));const i=pt.getContext("2d",{willReadFrequently:!0});if(!i)throw new Error("failed to create canvas 2d context");return(r>pt.width||n>pt.height)&&(pt.width=r,pt.height=n),i.clearRect(-t,-t,r+2*t,n+2*t),i.drawImage(e,0,0,r,n),i.getImageData(-t,-t,r+2*t,n+2*t)},resolveURL:e=>(ut||(ut=document.createElement("a")),ut.href=e,ut.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(null==dt&&(dt=window.matchMedia("(prefers-reduced-motion: reduce)")),dt.matches)},hasCanvasFingerprintNoise(){if(void 0!==mt)return mt;if(!ft())return mt=!1,!1;const e=new OffscreenCanvas(85,1),t=e.getContext("2d",{willReadFrequently:!0});let r=0;for(let i=0;i<e.width;++i)t.fillStyle="rgba(".concat(r++,",").concat(r++,",").concat(r++,", 255)"),t.fillRect(i,0,1,1);const n=t.getImageData(0,0,e.width,e.height);r=0;for(let i=0;i<n.data.length;++i)if(i%4!=3&&r++!==n.data[i])return mt=!0,!0;return mt=!1,!1}};function yt(e,t){const r=e.indexOf("?");if(r<0)return"".concat(e,"?").concat(new URLSearchParams(t).toString());const n=new URLSearchParams(e.slice(r));for(const i in t)n.set(i,t[i]);return"".concat(e.slice(0,r),"?").concat(n.toString())}function _t(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{persistentParams:[]};const r=e.indexOf("?");if(r<0)return e;const n=new URLSearchParams,i=new URLSearchParams(e.slice(r));for(const o of t.persistentParams){const e=i.get(o);e&&n.set(o,e)}const s=n.toString();return"".concat(e.slice(0,r)).concat(s.length>0?"?".concat(s):"")}const vt="mapbox-tiles";let xt=500,bt=50;const wt=["language","worldview","jobid"];let jt,St;function Tt(){try{return caches}catch(e){}}function kt(){const e=Tt();e&&null==jt&&(jt=e.open(vt))}let At=1/0;const Ct={supported:!1,testSupport:function(e){!It&&Nt&&(Pt?Lt(e):Et=e)}};let Et,Nt,It=!1,Pt=!1;const Mt="undefined"!=typeof self?self:{};function Lt(e){const t=e.createTexture();e.bindTexture(e.TEXTURE_2D,t);try{if(e.texImage2D(e.TEXTURE_2D,0,e.RGBA,e.RGBA,e.UNSIGNED_BYTE,Nt),e.isContextLost())return;Ct.supported=!0}catch(e){}e.deleteTexture(t),It=!0}Mt.document&&(Nt=Mt.document.createElement("img"),Nt.onload=function(){Et&&Lt(Et),Et=null,Pt=!0},Nt.onerror=function(){It=!0,Et=null},Nt.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Rt={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};"function"==typeof Object.freeze&&Object.freeze(Rt);class Dt extends Error{constructor(e,t,r){401===t&&at(r)&&(e+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(e),this.status=t,this.url=r}toString(){return"".concat(this.name,": ").concat(this.message," (").concat(this.status,"): ").concat(this.url)}}const Ft=Je()?()=>self.worker.referrer:()=>("blob:"===location.protocol?parent:self).location.href,Ot=function(e,t){if(!(/^file:/.test(r=e.url)||/^file:/.test(Ft())&&!/^\w+:/.test(r))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(e,t){const r=new AbortController,n=new Request(e.url,{method:e.method||"GET",body:e.body,credentials:e.credentials,headers:e.headers,referrer:Ft(),referrerPolicy:e.referrerPolicy,signal:r.signal});let i=!1,s=!1;const o=(a=n.url).indexOf("sku=")>0&&at(a);var a;"json"===e.type&&n.headers.set("Accept","application/json");const l=(r,i,a)=>{if(s)return;if(r&&"SecurityError"!==r.message&&Ze(r.toString()),i&&a)return c(i);const l=Date.now();fetch(n).then(r=>{if(r.ok){const e=o?r.clone():null;return c(r,e,l)}return t(new Dt(r.statusText,r.status,e.url))}).catch(r=>{"AbortError"!==r.name&&t(new Error("".concat(r.message," ").concat(e.url)))})},c=(r,o,a)=>{("arrayBuffer"===e.type?r.arrayBuffer():"json"===e.type?r.json():r.text()).then(e=>{s||(o&&a&&function(e,t,r){if(kt(),null==jt)return;const n=Qe(t.headers.get("Cache-Control")||"");if(n["no-store"])return;const i={status:t.status,statusText:t.statusText,headers:new Headers};t.headers.forEach((e,t)=>i.headers.set(t,e)),n["max-age"]&&i.headers.set("Expires",new Date(r+1e3*n["max-age"]).toUTCString());const s=i.headers.get("Expires");if(!s)return;if(new Date(s).getTime()-r<42e4)return;let o=_t(e.url,{persistentParams:wt});if(206===t.status){const t=e.headers.get("Range");if(!t)return;i.status=200,o=yt(o,{range:t})}!function(e,t){if(void 0===St)try{new Response(new ReadableStream),St=!0}catch(e){St=!1}St?t(e.body):e.blob().then(t).catch(e=>Ze(e.message))}(t,e=>{const r=new Response(200!==(n=t.status)&&404!==n&&[101,103,204,205,304].includes(n)?null:e,i);var n;kt(),null!=jt&&jt.then(e=>e.put(o,r)).catch(e=>Ze(e.message))})}(n,o,a),i=!0,t(null,e,r.headers))}).catch(e=>{s||t(new Error(e.message))})};return o?function(e,t){if(kt(),null==jt)return t(null);jt.then(r=>{let n=_t(e.url,{persistentParams:wt});const i=e.headers.get("Range");i&&(n=yt(n,{range:i})),r.match(n).then(e=>{const i=function(e){if(!e)return!1;const t=new Date(e.headers.get("Expires")||0),r=Qe(e.headers.get("Cache-Control")||"");return Number(t)>Date.now()&&!r["no-cache"]}(e);r.delete(n).catch(t),i&&r.put(n,e.clone()).catch(t),t(null,e,i)}).catch(t)}).catch(t)}(n,l):l(null,null),{cancel:()=>{s=!0,i||r.abort()}}}(e,t);if(Je(self)&&self.worker.actor)return self.worker.actor.send("getResource",e,t,void 0,!0)}var r;return function(e,t){const r=new XMLHttpRequest;r.open(e.method||"GET",e.url,!0),"arrayBuffer"===e.type&&(r.responseType="arraybuffer");for(const n in e.headers)r.setRequestHeader(n,e.headers[n]);return"json"===e.type&&(r.responseType="text",r.setRequestHeader("Accept","application/json")),r.withCredentials="include"===e.credentials,r.onerror=()=>{t(new Error(r.statusText))},r.onload=()=>{if((r.status>=200&&r.status<300||0===r.status)&&null!==r.response){let n=r.response;if("json"===e.type)try{n=JSON.parse(r.response)}catch(e){return t(e)}const i=new Headers;r.getAllResponseHeaders().trim().split(/[\r\n]+/).forEach(e=>{const t=e.split(": "),r=t.shift(),n=t.join(": ");i.append(r,n)}),t(null,n,i)}else t(new Dt(r.statusText,r.status,e.url))},r.send(e.body),{cancel:()=>r.abort()}}(e,t)},zt=function(e,t){return Ot(Object.assign(e,{type:"arrayBuffer"}),t)};function Bt(e){const t=document.createElement("a");return t.href=e,t.protocol===location.protocol&&t.host===location.host}const Ut="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Vt,qt;Vt=[],qt=0;const Wt=function(e,t){if(Ct.supported&&(e.headers||(e.headers={}),e.headers.accept="image/webp,*/*"),qt>=ot.MAX_PARALLEL_IMAGE_REQUESTS){const r={requestParameters:e,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Vt.push(r),r}qt++;let r=!1;const n=()=>{if(!r)for(r=!0,qt--;Vt.length&&qt<ot.MAX_PARALLEL_IMAGE_REQUESTS;){const e=Vt.shift(),{requestParameters:t,callback:r,cancelled:n}=e;n||(e.cancel=Wt(t,r).cancel)}},i=zt(e,(e,r,i)=>{n(),e?t(e):r&&(self.createImageBitmap?function(e,t){const r=new Blob([new Uint8Array(e)],{type:"image/png"});createImageBitmap(r).then(e=>{t(null,e)}).catch(e=>{t(new Error("Could not load image because of ".concat(e.message,". Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.")))})}(r,(e,r)=>t(e,r,i)):function(e,t){const r=new Image;r.onload=()=>{t(null,r),URL.revokeObjectURL(r.src),r.onload=null,requestAnimationFrame(()=>{r.src=Ut})},r.onerror=()=>t(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const n=new Blob([new Uint8Array(e)],{type:"image/png"});r.src=e.byteLength?URL.createObjectURL(n):Ut}(r,(e,r)=>t(e,r,i)))});return{cancel:()=>{i.cancel(),n()}}};var Ht,Gt,Zt,Kt={exports:{}},Yt={exports:{}},Xt={exports:{}},Jt=function(){if(Zt)return Kt.exports;Zt=1;var e=(Ht||(Ht=1,Yt.exports=function(e,t){var r,n,i,s,o,a,l,c;for(n=e.length-(r=3&e.length),i=t,o=3432918353,a=461845907,c=0;c<n;)l=255&e.charCodeAt(c)|(255&e.charCodeAt(++c))<<8|(255&e.charCodeAt(++c))<<16|(255&e.charCodeAt(++c))<<24,++c,i=27492+(65535&(s=5*(65535&(i=(i^=l=(65535&(l=(l=(65535&l)*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295)<<13|i>>>19))+((5*(i>>>16)&65535)<<16)&4294967295))+((58964+(s>>>16)&65535)<<16);switch(l=0,r){case 3:l^=(255&e.charCodeAt(c+2))<<16;case 2:l^=(255&e.charCodeAt(c+1))<<8;case 1:i^=l=(65535&(l=(l=(65535&(l^=255&e.charCodeAt(c)))*o+(((l>>>16)*o&65535)<<16)&4294967295)<<15|l>>>17))*a+(((l>>>16)*a&65535)<<16)&4294967295}return i^=e.length,i=2246822507*(65535&(i^=i>>>16))+((2246822507*(i>>>16)&65535)<<16)&4294967295,i=3266489909*(65535&(i^=i>>>13))+((3266489909*(i>>>16)&65535)<<16)&4294967295,(i^=i>>>16)>>>0}),Yt.exports),t=(Gt||(Gt=1,Xt.exports=function(e,t){for(var r,n=e.length,i=t^n,s=0;n>=4;)r=1540483477*(65535&(r=255&e.charCodeAt(s)|(255&e.charCodeAt(++s))<<8|(255&e.charCodeAt(++s))<<16|(255&e.charCodeAt(++s))<<24))+((1540483477*(r>>>16)&65535)<<16),i=1540483477*(65535&i)+((1540483477*(i>>>16)&65535)<<16)^(r=1540483477*(65535&(r^=r>>>24))+((1540483477*(r>>>16)&65535)<<16)),n-=4,++s;switch(n){case 3:i^=(255&e.charCodeAt(s+2))<<16;case 2:i^=(255&e.charCodeAt(s+1))<<8;case 1:i=1540483477*(65535&(i^=255&e.charCodeAt(s)))+((1540483477*(i>>>16)&65535)<<16)}return i=1540483477*(65535&(i^=i>>>13))+((1540483477*(i>>>16)&65535)<<16),(i^=i>>>15)>>>0}),Xt.exports);return Kt.exports=e,Kt.exports.murmur3=e,Kt.exports.murmur2=t,Kt.exports}(),Qt=be(Jt);class $t{constructor(e){Object.assign(this,(arguments.length<=1?void 0:arguments[1])||{}),this.type=e}}class er extends $t{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super("error",Object.assign({error:e},t))}}function tr(e,t,r){r[e]&&-1!==r[e].indexOf(t)||(r[e]=r[e]||[],r[e].push(t))}function rr(e,t,r){if(r&&r[e]){const n=r[e].indexOf(t);-1!==n&&r[e].splice(n,1)}}class nr{on(e,t){return this._listeners=this._listeners||{},tr(e,t,this._listeners),this}off(e,t){return rr(e,t,this._listeners),rr(e,t,this._oneTimeListeners),this}once(e,t){return t?(this._oneTimeListeners=this._oneTimeListeners||{},tr(e,t,this._oneTimeListeners),this):new Promise(t=>{this.once(e,t)})}fire(e,t){const r="string"==typeof e?new $t(e,t):e,n=r.type;if(this.listens(n)){r.target=this;const e=this._listeners&&this._listeners[n]?this._listeners[n].slice():[];for(const n of e)n.call(this,r);const t=this._oneTimeListeners&&this._oneTimeListeners[n]?this._oneTimeListeners[n].slice():[];for(const s of t)rr(n,s,this._oneTimeListeners),s.call(this,r);const i=this._eventedParent;if(i){const e="function"==typeof this._eventedParentData?this._eventedParentData():this._eventedParentData;Object.assign(r,e),i.fire(r)}}else r instanceof er&&console.error(r.error);return this}listens(e){return!!(this._listeners&&this._listeners[e]&&this._listeners[e].length>0||this._oneTimeListeners&&this._oneTimeListeners[e]&&this._oneTimeListeners[e].length>0||this._eventedParent&&this._eventedParent.listens(e))}setEventedParent(e,t){return this._eventedParent=e,this._eventedParentData=t,this}}class ir{constructor(e){"string"==typeof e?this.name=e:(this.name=e.name,this.iconsetId=e.iconsetId)}static from(e){return new ir(e)}static toString(e){return e.iconsetId?"".concat(e.name,"\x1f").concat(e.iconsetId):e.name}static parse(e){const[t,r]=e.split("\x1f");return new ir({name:t,iconsetId:r})}static isEqual(e,t){return e.name===t.name&&e.iconsetId===t.iconsetId}toString(){return ir.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var sr,or={},ar=function(){if(sr)return or;sr=1;var e={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(e){return(e=Math.round(e))<0?0:e>255?255:e}function r(e){return t("%"===e[e.length-1]?parseFloat(e)/100*255:parseInt(e))}function n(e){return(t="%"===e[e.length-1]?parseFloat(e)/100:parseFloat(e))<0?0:t>1?1:t;var t}function i(e,t,r){return r<0?r+=1:r>1&&(r-=1),6*r<1?e+(t-e)*r*6:2*r<1?t:3*r<2?e+(t-e)*(2/3-r)*6:e}try{or.parseCSSColor=function(s){var o,a=s.replace(/ /g,"").toLowerCase();if(a in e)return e[a].slice();if("#"===a[0])return 4===a.length?(o=parseInt(a.substr(1),16))>=0&&o<=4095?[(3840&o)>>4|(3840&o)>>8,240&o|(240&o)>>4,15&o|(15&o)<<4,1]:null:7===a.length&&(o=parseInt(a.substr(1),16))>=0&&o<=16777215?[(16711680&o)>>16,(65280&o)>>8,255&o,1]:null;var l=a.indexOf("("),c=a.indexOf(")");if(-1!==l&&c+1===a.length){var u=a.substr(0,l),d=a.substr(l+1,c-(l+1)).split(","),h=1;switch(u){case"rgba":if(4!==d.length)return null;h=n(d.pop());case"rgb":return 3!==d.length?null:[r(d[0]),r(d[1]),r(d[2]),h];case"hsla":if(4!==d.length)return null;h=n(d.pop());case"hsl":if(3!==d.length)return null;var p=(parseFloat(d[0])%360+360)%360/360,m=n(d[1]),f=n(d[2]),g=f<=.5?f*(m+1):f+m-f*m,y=2*f-g;return[t(255*i(y,g,p+1/3)),t(255*i(y,g,p)),t(255*i(y,g,p-1/3)),h];default:return null}}return null}}catch(e){}return or}();class lr{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1;this.r=e,this.g=t,this.b=r,this.a=n}static parse(e){if(!e)return;if(e instanceof lr)return e;if("string"!=typeof e)return;const t=ar.parseCSSColor(e);return t?new lr(t[0]/255,t[1]/255,t[2]/255,t[3]):void 0}toString(){const[e,t,r,n]=[this.r,this.g,this.b,this.a];return"rgba(".concat(Math.round(255*e),",").concat(Math.round(255*t),",").concat(Math.round(255*r),",").concat(n,")")}toNonPremultipliedRenderColor(e){const{r:t,g:r,b:n,a:i}=this;return new ur(e,t,r,n,i)}toPremultipliedRenderColor(e){const{r:t,g:r,b:n,a:i}=this;return new dr(e,t*i,r*i,n*i,i)}clone(){return new lr(this.r,this.g,this.b,this.a)}}class cr{constructor(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];if(this.premultiplied=!1,this.premultiplied=s,e){const s=e.image.height,o=s*s;this.premultiplied?(t=0===i?0:t/i*(s-1),r=0===i?0:r/i*(s-1),n=0===i?0:n/i*(s-1)):(t*=s-1,r*=s-1,n*=s-1);const a=Math.floor(t),l=Math.floor(r),c=Math.floor(n),u=Math.ceil(t),d=Math.ceil(r),h=Math.ceil(n),p=t-a,m=r-l,f=n-c,g=e.image.data,y=4*(a+l*o+c*s),_=4*(a+l*o+h*s),v=4*(a+d*o+c*s),x=4*(a+d*o+h*s),b=4*(u+l*o+c*s),w=4*(u+l*o+h*s),j=4*(u+d*o+c*s),S=4*(u+d*o+h*s);if(y<0||S>=g.length)throw new Error("out of range");this.r=hr(hr(hr(g[y],g[_],f),hr(g[v],g[x],f),m),hr(hr(g[b],g[w],f),hr(g[j],g[S],f),m),p)/255*(this.premultiplied?i:1),this.g=hr(hr(hr(g[y+1],g[_+1],f),hr(g[v+1],g[x+1],f),m),hr(hr(g[b+1],g[w+1],f),hr(g[j+1],g[S+1],f),m),p)/255*(this.premultiplied?i:1),this.b=hr(hr(hr(g[y+2],g[_+2],f),hr(g[v+2],g[x+2],f),m),hr(hr(g[b+2],g[w+2],f),hr(g[j+2],g[S+2],f),m),p)/255*(this.premultiplied?i:1),this.a=i}else this.r=t,this.g=r,this.b=n,this.a=i}toArray(){const{r:e,g:t,b:r,a:n}=this;return[255*e,255*t,255*r,n]}toHslaArray(){let{r:e,g:t,b:r,a:n}=this;if(this.premultiplied){if(0===n)return[0,0,0,0];const i=1/n;e*=i,t*=i,r*=i}const i=Math.min(Math.max(e,0),1),s=Math.min(Math.max(t,0),1),o=Math.min(Math.max(r,0),1),a=Math.min(i,s,o),l=Math.max(i,s,o),c=l-a,u=.5*(a+l);if(0===c)return[0,0,100*u,n];const d=u>.5?c/(2-l-a):c/(l+a);let h;switch(l){case i:h=60*((s-o)/c+(s<o?6:0));break;case s:h=60*((o-i)/c+2);break;default:h=60*((i-s)/c+4)}return[h,100*d,100*u,n]}toArray01(){const{r:e,g:t,b:r,a:n}=this;return[e,t,r,n]}toArray01Scaled(e){const{r:t,g:r,b:n}=this;return[t*e,r*e,n*e]}toArray01Linear(){const{r:e,g:t,b:r,a:n}=this;return[Math.pow(e,2.2),Math.pow(t,2.2),Math.pow(r,2.2),n]}}class ur extends cr{constructor(e,t,r,n,i){super(e,t,r,n,i,!1)}}class dr extends cr{constructor(e,t,r,n,i){super(e,t,r,n,i,!0)}}function hr(e,t,r){return e*(1-r)+t*r}function pr(e,t,r){return e.map((e,n)=>hr(e,t[n],r))}lr.black=new lr(0,0,0,1),lr.white=new lr(1,1,1,1),lr.transparent=new lr(0,0,0,0),lr.red=new lr(1,0,0,1),lr.blue=new lr(0,0,1,1);var mr=Object.freeze({__proto__:null,array:pr,color:function(e,t,r){return new lr(hr(e.r,t.r,r),hr(e.g,t.g,r),hr(e.b,t.b,r),hr(e.a,t.a,r))},number:hr});class fr extends Error{constructor(e,t){super(t),this.message=t,this.key=e}}class gr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.parent=e,this.bindings={};for(const[r,n]of t)this.bindings[r]=n}concat(e){return new gr(this,e)}get(e){if(this.bindings[e])return this.bindings[e];if(this.parent)return this.parent.get(e);throw new Error("".concat(e," not found in scope."))}has(e){return!!this.bindings[e]||!!this.parent&&this.parent.has(e)}}const yr={kind:"null"},_r={kind:"number"},vr={kind:"string"},xr={kind:"boolean"},br={kind:"color"},wr={kind:"object"},jr={kind:"value"},Sr={kind:"collator"},Tr={kind:"formatted"},kr={kind:"resolvedImage"};function Ar(e,t){return{kind:"array",itemType:e,N:t}}function Cr(e){if("array"===e.kind){const t=Cr(e.itemType);return"number"==typeof e.N?"array<".concat(t,", ").concat(e.N,">"):"value"===e.itemType.kind?"array":"array<".concat(t,">")}return e.kind}const Er=[yr,_r,vr,xr,br,Tr,wr,Ar(jr),kr];function Nr(e,t){if("error"===t.kind)return null;if("array"===e.kind){if("array"===t.kind&&(0===t.N&&"value"===t.itemType.kind||!Nr(e.itemType,t.itemType))&&("number"!=typeof e.N||e.N===t.N))return null}else{if(e.kind===t.kind)return null;if("value"===e.kind)for(const e of Er)if(!Nr(e,t))return null}return"Expected ".concat(Cr(e)," but found ").concat(Cr(t)," instead.")}function Ir(e,t){return t.some(t=>t.kind===e.kind)}function Pr(e,t){return t.some(t=>"null"===t?null===e:"array"===t?Array.isArray(e):"object"===t?e&&!Array.isArray(e)&&"object"==typeof e:t===typeof e)}function Mr(e,t){return"array"===e.kind&&"array"===t.kind?e.N===t.N&&Mr(e.itemType,t.itemType):e.kind===t.kind}class Lr{constructor(e,t,r){this.sensitivity=e?t?"variant":"case":t?"accent":"base",this.locale=r,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(e,t){return this.collator.compare(e,t)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Rr{constructor(e,t,r,n,i){this.text=e.normalize?e.normalize():e,this.image=t,this.scale=r,this.fontStack=n,this.textColor=i}}class Dr{constructor(e){this.sections=e}static fromString(e){return new Dr([new Rr(e,null,null,null,null)])}isEmpty(){return 0===this.sections.length||!this.sections.some(e=>0!==e.text.length||!!e.image&&e.image.hasPrimary())}static factory(e){return e instanceof Dr?e:Dr.fromString(e)}toString(){return 0===this.sections.length?"":this.sections.map(e=>e.text).join("")}serialize(){const e=["format"];for(const t of this.sections){if(t.image){const r=t.image.getPrimary().id.toString();e.push(["image",r]);continue}e.push(t.text);const r={};t.fontStack&&(r["text-font"]=["literal",t.fontStack.split(",")]),t.scale&&(r["font-scale"]=t.scale),t.textColor&&(r["text-color"]=["rgba"].concat(t.textColor.toNonPremultipliedRenderColor(null).toArray())),e.push(r)}return e}}class Fr{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.id=ir.from(e),this.params=t.params,this.sx=t.sx||1,this.sy=t.sy||1}toString(){return JSON.stringify(this)}static parse(e){let t,r,n,i;try{({id:t,params:r,sx:n,sy:i}=JSON.parse(e)||{})}catch(e){return null}return t?new Fr(t,{params:r,sx:n,sy:i}):null}scaleSelf(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e;return this.sx*=e,this.sy*=t,this}}class Or{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];this.primaryId=ir.from(e),this.primaryOptions=t,r&&(this.secondaryId=ir.from(r)),this.secondaryOptions=n,this.available=i}toString(){return this.primaryId&&this.secondaryId?"[".concat(this.primaryId.name,",").concat(this.secondaryId.name,"]"):this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Fr(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Fr(this.secondaryId,this.secondaryOptions):null}static from(e){return"string"==typeof e?Or.build({name:e}):e}static build(e,t,r,n){return!e||"object"==typeof e&&!("name"in e)?null:new Or(e,r,t,n)}}function zr(e,t,r,n){return"number"==typeof e&&e>=0&&e<=255&&"number"==typeof t&&t>=0&&t<=255&&"number"==typeof r&&r>=0&&r<=255?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid rgba value [".concat([e,t,r,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid rgba value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 'r', 'g', and 'b' must be between 0 and 255.")}function Br(e){if(null===e)return!0;if("string"==typeof e)return!0;if("boolean"==typeof e)return!0;if("number"==typeof e)return!0;if(e instanceof lr)return!0;if(e instanceof Lr)return!0;if(e instanceof Dr)return!0;if(e instanceof Or)return!0;if(Array.isArray(e)){for(const t of e)if(!Br(t))return!1;return!0}if("object"==typeof e){for(const t in e)if(!Br(e[t]))return!1;return!0}return!1}function Ur(e){if(null===e)return yr;if("string"==typeof e)return vr;if("boolean"==typeof e)return xr;if("number"==typeof e)return _r;if(e instanceof lr)return br;if(e instanceof Lr)return Sr;if(e instanceof Dr)return Tr;if(e instanceof Or)return kr;if(Array.isArray(e)){const t=e.length;let r;for(const n of e){const e=Ur(n);if(r){if(r===e)continue;r=jr;break}r=e}return Ar(r||jr,t)}return wr}function Vr(e){const t=typeof e;return null===e?"":"string"===t||"number"===t||"boolean"===t?String(e):e instanceof Dr||e instanceof Or||e instanceof lr?e.toString():JSON.stringify(e)}class qr{constructor(e,t){this.type=e,this.value=t}static parse(e,t){if(2!==e.length)return t.error("'literal' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(!Br(e[1]))return t.error("invalid value");const r=e[1];let n=Ur(r);const i=t.expectedType;return"array"!==n.kind||0!==n.N||!i||"array"!==i.kind||"number"==typeof i.N&&0!==i.N||(n=i),new qr(n,r)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return"array"===this.type.kind||"object"===this.type.kind?["literal",this.value]:this.value instanceof lr?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Dr?this.value.serialize():this.value}}class Wr{constructor(e){this.name="ExpressionEvaluationError",this.message=e}toJSON(){return this.message}}const Hr={string:vr,number:_r,boolean:xr,object:wr};class Gr{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");let r,n=1;const i=e[0];if("array"===i){let i,s;if(e.length>2){const r=e[1];if("string"!=typeof r||!(r in Hr)||"object"===r)return t.error('The item type argument of "array" must be one of string, number, boolean',1);i=Hr[r],n++}else i=jr;if(e.length>3){if(null!==e[2]&&("number"!=typeof e[2]||e[2]<0||e[2]!==Math.floor(e[2])))return t.error('The length argument to "array" must be a positive integer literal',2);s=e[2],n++}r=Ar(i,s)}else r=Hr[i];const s=[];for(;n<e.length;n++){const r=t.parse(e[n],n,jr);if(!r)return null;s.push(r)}return new Gr(r,s)}evaluate(e){for(let t=0;t<this.args.length;t++){const r=this.args[t].evaluate(e);if(!Nr(this.type,Ur(r)))return r;if(t===this.args.length-1)throw new Wr("The expression ".concat(JSON.stringify(this.args[t].serialize())," evaluated to ").concat(Cr(Ur(r))," but was expected to be of type ").concat(Cr(this.type),"."))}return null}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=this.type,t=[e.kind];if("array"===e.kind){const r=e.itemType;if("string"===r.kind||"number"===r.kind||"boolean"===r.kind){t.push(r.kind);const n=e.N;("number"==typeof n||this.args.length>1)&&t.push(n)}}return t.concat(this.args.map(e=>e.serialize()))}}class Zr{constructor(e){this.type=Tr,this.sections=e}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[1];if(!Array.isArray(r)&&"object"==typeof r)return t.error("First argument must be an image or text section.");const n=[];let i=!1;for(let s=1;s<=e.length-1;++s){const r=e[s];if(i&&"object"==typeof r&&!Array.isArray(r)){i=!1;let e=null;if(r["font-scale"]&&(e=t.parseObjectValue(r["font-scale"],s,"font-scale",_r),!e))return null;let o=null;if(r["text-font"]&&(o=t.parseObjectValue(r["text-font"],s,"text-font",Ar(vr)),!o))return null;let a=null;if(r["text-color"]&&(a=t.parseObjectValue(r["text-color"],s,"text-color",br),!a))return null;const l=n[n.length-1];l.scale=e,l.font=o,l.textColor=a}else{const r=t.parse(e[s],s,jr);if(!r)return null;const o=r.type.kind;if("string"!==o&&"value"!==o&&"null"!==o&&"resolvedImage"!==o)return t.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");i=!0,n.push({content:r,scale:null,font:null,textColor:null})}}return new Zr(n)}evaluate(e){return new Dr(this.sections.map(t=>{const r=t.content.evaluate(e);return Mr(Ur(r),kr)?new Rr("",r,null,null,null):new Rr(Vr(r),null,t.scale?t.scale.evaluate(e):null,t.font?t.font.evaluate(e).join(","):null,t.textColor?t.textColor.evaluate(e):null)}))}eachChild(e){for(const t of this.sections)e(t.content),t.scale&&e(t.scale),t.font&&e(t.font),t.textColor&&e(t.textColor)}outputDefined(){return!1}serialize(){const e=["format"];for(const t of this.sections){e.push(t.content.serialize());const r={};t.scale&&(r["font-scale"]=t.scale.serialize()),t.font&&(r["text-font"]=t.font.serialize()),t.textColor&&(r["text-color"]=t.textColor.serialize()),e.push(r)}return e}}class Kr{constructor(e,t,r,n){this._imageWarnHistory={},this.type=kr,this.namePrimary=e,this.nameSecondary=t,r&&(this.paramsPrimary=r.params,this.iconsetIdPrimary=r.iconset?r.iconset.id:void 0),n&&(this.paramsSecondary=n.params,this.iconsetIdSecondary=n.iconset?n.iconset.id:void 0)}static parse(e,t){if(e.length<2)return t.error("Expected two or more arguments.");let r=1;const n=[];function i(){if(r<e.length){const i=t.parse(e[r],r++,vr);return i?(n.push({image:i,options:{}}),!0):(t.error(n.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function s(){if(r<e.length){const s=e[r];if(null===(i=s)||"object"!=typeof i||Array.isArray(i))return!0;const o=s.params,a=s.iconset,l=t.concat(r);if(!o&&!a)return r++,!0;if(o){if("object"!=typeof o||o.constructor!==Object)return l.error('Image options "params" should be an object'),!1;const e={},t=l.concat(void 0,"params");for(const r in o){if(!r)return t.error("Image parameter name should be non-empty"),!1;const n=t.concat(void 0,r).parse(o[r],void 0,br,void 0,{typeAnnotation:"coerce"});if(!n)return!1;e[r]=n}n[n.length-1].options.params=e}if(a){if("object"!=typeof a||a.constructor!==Object)return l.error('Image options "iconset" should be an object'),!1;if(!a.id)return l.error('Image options "iconset" should have an "id" property'),!1;n[n.length-1].options.iconset=a}return r++,!0}var i;return!0}for(let o=0;o<2;o++)if(!i()||!s())return;return new Kr(n[0].image,n[1]?n[1].image:void 0,n[0].options,n[1]?n[1].options:void 0)}evaluateParams(e,t){const r={};if(t){for(const n in t)if(t[n])try{r[n]=t[n].evaluate(e)}catch(e){continue}if(0!==Object.keys(r).length)return{params:r}}}evaluate(e){const t={name:this.namePrimary.evaluate(e),iconsetId:this.iconsetIdPrimary},r=this.nameSecondary?{name:this.nameSecondary.evaluate(e),iconsetId:this.iconsetIdSecondary}:void 0,n=Or.build(t,r,this.paramsPrimary?this.evaluateParams(e,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(e,this.paramsSecondary):void 0);if(n&&e.availableImages){const t=n.getPrimary().id;if(n.available=e.availableImages.some(e=>ir.isEqual(e,t)),n.available){const t=n.getSecondary()?n.getSecondary().id:null;t&&(n.available=e.availableImages.some(e=>ir.isEqual(e,t)))}}return n}eachChild(e){if(e(this.namePrimary),this.paramsPrimary)for(const t in this.paramsPrimary)this.paramsPrimary[t]&&e(this.paramsPrimary[t]);if(this.nameSecondary&&(e(this.nameSecondary),this.paramsSecondary))for(const t in this.paramsSecondary)this.paramsSecondary[t]&&e(this.paramsSecondary[t])}outputDefined(){return!1}serializeOptions(e,t){const r={};if(t&&(r.iconset={id:t}),e){r.params={};for(const t in e)e[t]&&(r.params[t]=e[t].serialize())}return Object.keys(r).length>0?r:void 0}serialize(){const e=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const t=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);t&&e.push(t)}if(this.nameSecondary&&(e.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const t=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);t&&e.push(t)}return e}}function Yr(e){return Jr(e)?"string":Qr(e)?"number":$r(e)?"boolean":Array.isArray(e)?"array":null===e?"null":Xr(e)?"object":typeof e}function Xr(e){return null!=e&&!Array.isArray(e)&&"function"!=typeof e&&!(e instanceof String||e instanceof Number||e instanceof Boolean)&&"object"==typeof e}function Jr(e){return"string"==typeof e||e instanceof String}function Qr(e){return"number"==typeof e||e instanceof Number}function $r(e){return"boolean"==typeof e||e instanceof Boolean}const en={"to-boolean":xr,"to-color":br,"to-number":_r,"to-string":vr};class tn{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expected at least one argument.");const r=e[0],n=[];let i=yr;if("to-array"===r){if(!Array.isArray(e[1]))return null;const r=e[1].length;if(t.expectedType){if("array"!==t.expectedType.kind)return t.error("Expected ".concat(t.expectedType.kind," but found array."));i=Ar(t.expectedType.itemType,r)}else{if(!(r>0&&Br(e[1][0])))return null;i=Ar(Ur(e[1][0]),r)}for(let s=0;s<r;s++){const r=e[1][s];let o;if(Array.isArray(r))o=t.parse(r,void 0,i.itemType);else{const e=Yr(r);if(e!==i.itemType.kind)return t.error("Expected ".concat(i.itemType.kind," but found ").concat(e,"."));o=t.registry.literal.parse(["literal",void 0===r?null:r],t)}if(!o)return null;n.push(o)}}else{if(("to-boolean"===r||"to-string"===r)&&2!==e.length)return t.error("Expected one argument.");i=en[r];for(let r=1;r<e.length;r++){const i=t.parse(e[r],r,jr);if(!i)return null;n.push(i)}}return new tn(i,n)}evaluate(e){if("boolean"===this.type.kind)return Boolean(this.args[0].evaluate(e));if("color"===this.type.kind){let t,r;for(const n of this.args){if(t=n.evaluate(e),r=null,t instanceof lr)return t;if("string"==typeof t){const r=e.parseColor(t);if(r)return r}else if(Array.isArray(t)&&(r=t.length<3||t.length>4?"Invalid rbga value ".concat(JSON.stringify(t),": expected an array containing either three or four numeric values."):zr(t[0],t[1],t[2],t[3]),!r))return new lr(t[0]/255,t[1]/255,t[2]/255,t[3])}throw new Wr(r||"Could not parse color from value '".concat("string"==typeof t?t:String(JSON.stringify(t)),"'"))}if("number"===this.type.kind){let t=null;for(const r of this.args){if(t=r.evaluate(e),null===t)return 0;const n=Number(t);if(!isNaN(n))return n}throw new Wr("Could not convert ".concat(JSON.stringify(t)," to number."))}return"formatted"===this.type.kind?Dr.fromString(Vr(this.args[0].evaluate(e))):"resolvedImage"===this.type.kind?Or.build(Vr(this.args[0].evaluate(e))):"array"===this.type.kind?this.args.map(t=>t.evaluate(e)):Vr(this.args[0].evaluate(e))}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){if("formatted"===this.type.kind)return new Zr([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if("resolvedImage"===this.type.kind)return new Kr(this.args[0]).serialize();const e="array"===this.type.kind?[]:["to-".concat(this.type.kind)];return this.eachChild(t=>{e.push(t.serialize())}),e}}const rn=["Unknown","Point","LineString","Polygon"];class nn{constructor(e,t,r){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=e,this.options=t,this.iconImageUseTheme=r}id(){return this.feature&&void 0!==this.feature.id?this.feature.id:null}geometryType(){return this.feature?"number"==typeof this.feature.type?rn[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(e){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const e=this.featureDistanceData.center,t=this.featureDistanceData.scale,{x:r,y:n}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(r*t-e[0])+this.featureDistanceData.bearing[1]*(n*t-e[1])}return 0}parseColor(e){let t=this._parseColorCache[e];return t||(t=this._parseColorCache[e]=lr.parse(e)),t}getConfig(e){return this.options?this.options.get(e):null}}class sn{constructor(e,t,r,n,i){this.name=e,this.type=t,this._evaluate=r,this.args=n,this._overloadIndex=i}evaluate(e){if(!this._evaluate){const e=sn.definitions[this.name];this._evaluate=Array.isArray(e)?e[2]:e.overloads[this._overloadIndex][1]}return this._evaluate(e,this.args)}eachChild(e){this.args.forEach(e)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(e=>e.serialize()))}static parse(e,t){const r=e[0],n=sn.definitions[r];if(!n)return t.error('Unknown expression "'.concat(r,'". If you wanted a literal array, use ["literal", [...]].'),0);const i=Array.isArray(n)?n[0]:n.type,s=Array.isArray(n)?[[n[1],n[2]]]:n.overloads,o=[];let a=null,l=-1;for(const[c,u]of s){if(Array.isArray(c)&&c.length!==e.length-1)continue;o.push(c),l++,a=new Ti(t.registry,t.path,null,t.scope,void 0,t._scope,t.options,t.iconImageUseTheme);const n=[];let s=!1;for(let t=1;t<e.length;t++){const r=e[t],i=Array.isArray(c)?c[t-1]:c.type,o=a.parse(r,1+n.length,i);if(!o){s=!0;break}n.push(o)}if(!s)if(Array.isArray(c)&&c.length!==n.length)a.error("Expected ".concat(c.length," arguments, but found ").concat(n.length," instead."));else{for(let e=0;e<n.length;e++){const t=Array.isArray(c)?c[e]:c.type,r=n[e];a.concat(e+1).checkSubtype(t,r.type)}if(0===a.errors.length)return new sn(r,i,u,n,l)}}if(1===o.length)t.errors.push(...a.errors);else{const r=(o.length?o:s.map(e=>{let[t]=e;return t})).map(on).join(" | "),n=[];for(let i=1;i<e.length;i++){const r=t.parse(e[i],1+n.length);if(!r)return null;n.push(Cr(r.type))}t.error("Expected arguments of type ".concat(r,", but found (").concat(n.join(", "),") instead."))}return null}static register(e,t){sn.definitions=t;for(const r in t)e[r]=sn}}function on(e){return Array.isArray(e)?"(".concat(e.map(Cr).join(", "),")"):"(".concat(Cr(e.type),"...)")}class an{constructor(e,t,r){this.type=Sr,this.locale=r,this.caseSensitive=e,this.diacriticSensitive=t}static parse(e,t){if(2!==e.length)return t.error("Expected one argument.");const r=e[1];if("object"!=typeof r||Array.isArray(r))return t.error("Collator options argument must be an object.");const n=void 0===r["case-sensitive"]?t.parse(!1,1,xr):t.parseObjectValue(r["case-sensitive"],1,"case-sensitive",xr);if(!n)return null;const i=void 0===r["diacritic-sensitive"]?t.parse(!1,1,xr):t.parseObjectValue(r["diacritic-sensitive"],1,"diacritic-sensitive",xr);if(!i)return null;let s=null;return r.locale&&(s=t.parseObjectValue(r.locale,1,"locale",vr),!s)?null:new an(n,i,s)}evaluate(e){return new Lr(this.caseSensitive.evaluate(e),this.diacriticSensitive.evaluate(e),this.locale?this.locale.evaluate(e):null)}eachChild(e){e(this.caseSensitive),e(this.diacriticSensitive),this.locale&&e(this.locale)}outputDefined(){return!1}serialize(){const e={};return e["case-sensitive"]=this.caseSensitive.serialize(),e["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(e.locale=this.locale.serialize()),["collator",e]}}function ln(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:e.length-1,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:un;for(;n>r;){if(n-r>600){const s=n-r+1,o=t-r+1,a=Math.log(s),l=.5*Math.exp(2*a/3),c=.5*Math.sqrt(a*l*(s-l)/s)*(o-s/2<0?-1:1);ln(e,t,Math.max(r,Math.floor(t-o*l/s+c)),Math.min(n,Math.floor(t+(s-o)*l/s+c)),i)}const s=e[t];let o=r,a=n;for(cn(e,r,t),i(e[n],s)>0&&cn(e,r,n);o<a;){for(cn(e,o,a),o++,a--;i(e[o],s)<0;)o++;for(;i(e[a],s)>0;)a--}0===i(e[r],s)?cn(e,r,a):(a++,cn(e,a,n)),a<=t&&(r=a+1),t<=a&&(n=a-1)}}function cn(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function un(e,t){return e<t?-1:e>t?1:0}function dn(e){let t=0;for(let r,n,i=0,s=e.length,o=s-1;i<s;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}function hn(e,t){e[0]=Math.min(e[0],t[0]),e[1]=Math.min(e[1],t[1]),e[2]=Math.max(e[2],t[0]),e[3]=Math.max(e[3],t[1])}function pn(e,t){return!(e[0]<=t[0]||e[2]>=t[2]||e[1]<=t[1]||e[3]>=t[3])}function mn(e,t,r){const n=e[0]-t[0],i=e[1]-t[1],s=e[0]-r[0],o=e[1]-r[1];return n*o-s*i==0&&n*s<=0&&i*o<=0}function fn(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=!1;for(let a=0,l=t.length;a<l;a++){const l=t[a];for(let t=0,a=l.length,c=a-1;t<a;c=t++){const a=l[c],u=l[t];if(mn(e,a,u))return r;(s=a)[1]>(i=e)[1]!=(o=u)[1]>i[1]&&i[0]<(o[0]-s[0])*(i[1]-s[1])/(o[1]-s[1])+s[0]&&(n=!n)}}var i,s,o;return n}function gn(e,t,r,n){const i=n[0]-r[0],s=n[1]-r[1],o=(e[0]-r[0])*s-i*(e[1]-r[1]),a=(t[0]-r[0])*s-i*(t[1]-r[1]);return o>0&&a<0||o<0&&a>0}function yn(e,t,r,n){return 0!=(i=[n[0]-r[0],n[1]-r[1]])[0]*(s=[t[0]-e[0],t[1]-e[1]])[1]-i[1]*s[0]&&!(!gn(e,t,r,n)||!gn(r,n,e,t));var i,s}function _n(e){const t=new Se(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),r=new Se(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const n of e[0])t.x>n.x&&(t.x=n.x),t.y>n.y&&(t.y=n.y),r.x<n.x&&(r.x=n.x),r.y<n.y&&(r.y=n.y);return{min:t,max:r}}const vn=8192;function xn(e,t){const r=(180+e[0])/360,n=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e[1]*Math.PI/360)))/360,i=Math.pow(2,t.z);return[Math.round(r*i*vn),Math.round(n*i*vn)]}function bn(e,t){for(let r=0;r<t.length;r++)if(fn(e,t[r]))return!0;return!1}function wn(e,t,r){for(const n of r)for(let r=0,i=n.length,s=i-1;r<i;s=r++)if(yn(e,t,n[s],n[r]))return!0;return!1}function jn(e,t){for(let r=0;r<e.length;++r)if(!fn(e[r],t))return!1;for(let r=0;r<e.length-1;++r)if(wn(e[r],e[r+1],t))return!1;return!0}function Sn(e,t){for(let r=0;r<t.length;r++)if(jn(e,t[r]))return!0;return!1}function Tn(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=[];for(let n=0;n<e[i].length;n++){const o=xn(e[i][n],r);hn(t,o),s.push(o)}n.push(s)}return n}function kn(e,t,r){const n=[];for(let i=0;i<e.length;i++){const s=Tn(e[i],t,r);n.push(s)}return n}function An(e,t,r,n){if(e[0]<r[0]||e[0]>r[2]){const t=.5*n;let i=e[0]-r[0]>t?-n:r[0]-e[0]>t?n:0;0===i&&(i=e[0]-r[2]>t?-n:r[2]-e[0]>t?n:0),e[0]+=i}hn(t,e)}function Cn(e,t,r,n){const i=Math.pow(2,n.z)*vn,s=[n.x*vn,n.y*vn],o=[];if(!e)return o;for(const a of e)for(const e of a){const n=[e.x+s[0],e.y+s[1]];An(n,t,r,i),o.push(n)}return o}function En(e,t,r,n){const i=Math.pow(2,n.z)*vn,s=[n.x*vn,n.y*vn],o=[];if(!e)return o;for(const l of e){const e=[];for(const r of l){const n=[r.x+s[0],r.y+s[1]];hn(t,n),e.push(n)}o.push(e)}if(t[2]-t[0]<=i/2){(a=t)[0]=a[1]=1/0,a[2]=a[3]=-1/0;for(const e of o)for(const n of e)An(n,t,r,i)}var a;return o}class Nn{constructor(e,t){this.type=xr,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'within' expression requires exactly one argument, but found ".concat(e.length-1," instead."));if(Br(e[1])){const t=e[1];if("FeatureCollection"===t.type)for(let e=0;e<t.features.length;++e){const r=t.features[e].geometry.type;if("Polygon"===r||"MultiPolygon"===r)return new Nn(t,t.features[e].geometry)}else if("Feature"===t.type){const e=t.geometry.type;if("Polygon"===e||"MultiPolygon"===e)return new Nn(t,t.geometry)}else if("Polygon"===t.type||"MultiPolygon"===t.type)return new Nn(t,t)}return t.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(e){if(null!=e.geometry()&&null!=e.canonicalID()){if("Point"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const s=Tn(t.coordinates,n,i),o=Cn(e.geometry(),r,n,i);if(!pn(r,n))return!1;for(const e of o)if(!fn(e,s))return!1}if("MultiPolygon"===t.type){const s=kn(t.coordinates,n,i),o=Cn(e.geometry(),r,n,i);if(!pn(r,n))return!1;for(const e of o)if(!bn(e,s))return!1}return!0}(e,this.geometries);if("LineString"===e.geometryType())return function(e,t){const r=[1/0,1/0,-1/0,-1/0],n=[1/0,1/0,-1/0,-1/0],i=e.canonicalID();if(!i)return!1;if("Polygon"===t.type){const s=Tn(t.coordinates,n,i),o=En(e.geometry(),r,n,i);if(!pn(r,n))return!1;for(const e of o)if(!jn(e,s))return!1}if("MultiPolygon"===t.type){const s=kn(t.coordinates,n,i),o=En(e.geometry(),r,n,i);if(!pn(r,n))return!1;for(const e of o)if(!Sn(e,s))return!1}return!0}(e,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const In={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Pn=1/298.257223563,Mn=Pn*(2-Pn),Ln=Math.PI/180;class Rn{static fromTile(e,t,r){const n=Math.PI*(1-2*(e+.5)/Math.pow(2,t)),i=Math.atan(.5*(Math.exp(n)-Math.exp(-n)))/Ln;return new Rn(i,r)}static get units(){return In}constructor(e,t){if(void 0===e)throw new Error("No latitude given.");if(t&&!In[t])throw new Error("Unknown unit ".concat(t,". Use one of: ").concat(Object.keys(In).join(", ")));const r=6378.137*Ln*(t?In[t]:1),n=Math.cos(e*Ln),i=1/(1-Mn*(1-n*n)),s=Math.sqrt(i);this.kx=r*s*n,this.ky=r*s*i*(1-Mn)}distance(e,t){const r=On(e[0]-t[0])*this.kx,n=(e[1]-t[1])*this.ky;return Math.sqrt(r*r+n*n)}bearing(e,t){const r=On(t[0]-e[0])*this.kx;return Math.atan2(r,(t[1]-e[1])*this.ky)/Ln}destination(e,t,r){const n=r*Ln;return this.offset(e,Math.sin(n)*t,Math.cos(n)*t)}offset(e,t,r){return[e[0]+t/this.kx,e[1]+r/this.ky]}lineDistance(e){let t=0;for(let r=0;r<e.length-1;r++)t+=this.distance(e[r],e[r+1]);return t}area(e){let t=0;for(let r=0;r<e.length;r++){const n=e[r];for(let e=0,i=n.length,s=i-1;e<i;s=e++)t+=On(n[e][0]-n[s][0])*(n[e][1]+n[s][1])*(r?-1:1)}return Math.abs(t)/2*this.kx*this.ky}along(e,t){let r=0;if(t<=0)return e[0];for(let n=0;n<e.length-1;n++){const i=e[n],s=e[n+1],o=this.distance(i,s);if(r+=o,r>t)return Fn(i,s,(t-(r-o))/o)}return e[e.length-1]}pointToSegmentDistance(e,t,r){let[n,i]=t,s=On(r[0]-n)*this.kx,o=(r[1]-i)*this.ky;if(0!==s||0!==o){const t=(On(e[0]-n)*this.kx*s+(e[1]-i)*this.ky*o)/(s*s+o*o);t>1?(n=r[0],i=r[1]):t>0&&(n+=s/this.kx*t,i+=o/this.ky*t)}return s=On(e[0]-n)*this.kx,o=(e[1]-i)*this.ky,Math.sqrt(s*s+o*o)}pointOnLine(e,t){let r=1/0,n=e[0][0],i=e[0][1],s=0,o=0;for(let a=0;a<e.length-1;a++){let l=e[a][0],c=e[a][1],u=On(e[a+1][0]-l)*this.kx,d=(e[a+1][1]-c)*this.ky,h=0;0===u&&0===d||(h=(On(t[0]-l)*this.kx*u+(t[1]-c)*this.ky*d)/(u*u+d*d),h>1?(l=e[a+1][0],c=e[a+1][1]):h>0&&(l+=u/this.kx*h,c+=d/this.ky*h)),u=On(t[0]-l)*this.kx,d=(t[1]-c)*this.ky;const p=u*u+d*d;p<r&&(r=p,n=l,i=c,s=a,o=h)}return{point:[n,i],index:s,t:Math.max(0,Math.min(1,o))}}lineSlice(e,t,r){let n=this.pointOnLine(r,e),i=this.pointOnLine(r,t);if(n.index>i.index||n.index===i.index&&n.t>i.t){const e=n;n=i,i=e}const s=[n.point],o=n.index+1,a=i.index;!Dn(r[o],s[0])&&o<=a&&s.push(r[o]);for(let l=o+1;l<=a;l++)s.push(r[l]);return Dn(r[a],i.point)||s.push(i.point),s}lineSliceAlong(e,t,r){let n=0;const i=[];for(let s=0;s<r.length-1;s++){const o=r[s],a=r[s+1],l=this.distance(o,a);if(n+=l,n>e&&0===i.length&&i.push(Fn(o,a,(e-(n-l))/l)),n>=t)return i.push(Fn(o,a,(t-(n-l))/l)),i;n>e&&i.push(a)}return i}bufferPoint(e,t){const r=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-r,e[0]+n,e[1]+r]}bufferBBox(e,t){const r=t/this.ky,n=t/this.kx;return[e[0]-n,e[1]-r,e[2]+n,e[3]+r]}insideBBox(e,t){return On(e[0]-t[0])>=0&&On(e[0]-t[2])<=0&&e[1]>=t[1]&&e[1]<=t[3]}}function Dn(e,t){return e[0]===t[0]&&e[1]===t[1]}function Fn(e,t,r){const n=On(t[0]-e[0]);return[e[0]+n*r,e[1]+(t[1]-e[1])*r]}function On(e){for(;e<-180;)e+=360;for(;e>180;)e-=360;return e}class zn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:(e,t)=>e<t?-1:e>t?1:0;if(this.data=e,this.length=this.data.length,this.compare=t,this.length>0)for(let r=(this.length>>1)-1;r>=0;r--)this._down(r)}push(e){this.data.push(e),this._up(this.length++)}pop(){if(0===this.length)return;const e=this.data[0],t=this.data.pop();return--this.length>0&&(this.data[0]=t,this._down(0)),e}peek(){return this.data[0]}_up(e){const{data:t,compare:r}=this,n=t[e];for(;e>0;){const i=e-1>>1,s=t[i];if(r(n,s)>=0)break;t[e]=s,e=i}t[e]=n}_down(e){const{data:t,compare:r}=this,n=this.length>>1,i=t[e];for(;e<n;){let n=1+(e<<1);const s=n+1;if(s<this.length&&r(t[s],t[n])<0&&(n=s),r(t[n],i)>=0)break;t[e]=t[n],e=n}t[e]=i}}var Bn=8192;function Un(e,t){return t.dist-e.dist}const Vn=100,qn=50;function Wn(e){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==e.length)return!1;for(let r=0;r<t.length;r++)if(t[r]!==e[r])return!1;return!0}function Hn(e){return e[1]-e[0]+1}function Gn(e,t){const r=e[1]>=e[0]&&e[1]<t;return r||console.warn("Distance Expression: Index is out of range"),r}function Zn(e,t){if(e[0]>e[1])return[null,null];const r=Hn(e);if(t){if(2===r)return[e,null];const t=Math.floor(r/2);return[[e[0],e[0]+t],[e[0]+t,e[1]]]}{if(1===r)return[e,null];const t=Math.floor(r/2)-1;return[[e[0],e[0]+t],[e[0]+t+1,e[1]]]}}function Kn(e,t){const r=[1/0,1/0,-1/0,-1/0];if(!Gn(t,e.length))return r;for(let n=t[0];n<=t[1];++n)hn(r,e[n]);return r}function Yn(e){const t=[1/0,1/0,-1/0,-1/0];for(let r=0;r<e.length;++r)for(let n=0;n<e[r].length;++n)hn(t,e[r][n]);return t}function Xn(e,t,r){if(Wn(e)||Wn(t))return NaN;let n=0,i=0;return e[2]<t[0]&&(n=t[0]-e[2]),e[0]>t[2]&&(n=e[0]-t[2]),e[1]>t[3]&&(i=e[1]-t[3]),e[3]<t[1]&&(i=t[1]-e[3]),r.distance([0,0],[n,i])}function Jn(e){return 360*e-180}function Qn(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function $n(e,t){const r=Math.pow(2,t.z),n=(e.y/Bn+t.y)/r;return[Jn((e.x/Bn+t.x)/r),Qn(n)]}function ei(e,t){const r=[];for(let n=0;n<e.length;++n)r.push($n(e[n],t));return r}function ti(e,t,r){const n=r.pointOnLine(t,e).point;return r.distance(e,n)}function ri(e,t,r,n,i){const s=r.slice(n[0],n[1]+1);let o=1/0;for(let a=t[0];a<=t[1];++a)if(0===(o=Math.min(o,ti(e[a],s,i))))return 0;return o}function ni(e,t,r,n,i){const s=Math.min(i.pointToSegmentDistance(e,r,n),i.pointToSegmentDistance(t,r,n)),o=Math.min(i.pointToSegmentDistance(r,e,t),i.pointToSegmentDistance(n,e,t));return Math.min(s,o)}function ii(e,t,r,n,i){if(!Gn(t,e.length)||!Gn(n,r.length))return NaN;let s=1/0;for(let o=t[0];o<t[1];++o)for(let t=n[0];t<n[1];++t){if(yn(e[o],e[o+1],r[t],r[t+1]))return 0;s=Math.min(s,ni(e[o],e[o+1],r[t],r[t+1],i))}return s}function si(e,t,r,n,i){if(!Gn(t,e.length)||!Gn(n,r.length))return NaN;let s=1/0;for(let o=t[0];o<=t[1];++o)for(let t=n[0];t<=n[1];++t)if(0===(s=Math.min(s,i.distance(e[o],r[t]))))return s;return s}function oi(e,t,r){if(fn(e,t,!0))return 0;let n=1/0;for(const i of t){const t=i.length;if(t<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(i[0]!==i[t-1]&&0===(n=Math.min(n,r.pointToSegmentDistance(e,i[t-1],i[0]))))return n;if(0===(n=Math.min(n,ti(e,i,r))))return n}return n}function ai(e,t,r,n){if(!Gn(t,e.length))return NaN;for(let s=t[0];s<=t[1];++s)if(fn(e[s],r,!0))return 0;let i=1/0;for(let s=t[0];s<t[1];++s)for(const t of r)for(let r=0,o=t.length,a=o-1;r<o;a=r++){if(yn(e[s],e[s+1],t[a],t[r]))return 0;i=Math.min(i,ni(e[s],e[s+1],t[a],t[r],n))}return i}function li(e,t){for(const r of e)for(let e=0;e<=r.length-1;++e)if(fn(r[e],t,!0))return!0;return!1}function ci(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1/0;const i=Yn(e),s=Yn(t);if(n!==1/0&&Xn(i,s,r)>=n)return n;if(pn(i,s)){if(li(e,t))return 0}else if(li(t,e))return 0;let o=n;for(const a of e)for(let e=0,n=a.length,i=n-1;e<n;i=e++)for(const s of t)for(let t=0,n=s.length,l=n-1;t<n;l=t++){if(yn(a[i],a[e],s[l],s[t]))return 0;o=Math.min(o,ni(a[i],a[e],s[l],s[t],r))}return o}function ui(e,t,r,n,i,s,o){if(null===s||null===o)return;const a=Xn(Kn(n,s),Kn(i,o),r);a<t&&e.push({dist:a,range1:s,range2:o})}function di(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0,s=Math.min(n.distance(e[0],r[0][0]),i);if(0===s)return s;const o=new zn([{dist:0,range1:[0,e.length-1],range2:[0,0]}],Un),a=t?qn:Vn,l=Yn(r);for(;o.length;){const i=o.pop();if(i.dist>=s)continue;const c=i.range1;if(Hn(c)<=a){if(!Gn(c,e.length))return NaN;if(t){const t=ai(e,c,r,n);if(0===(s=Math.min(s,t)))return s}else for(let t=c[0];t<=c[1];++t){const i=oi(e[t],r,n);if(0===(s=Math.min(s,i)))return s}}else{const r=Zn(c,t);if(null!==r[0]){const t=Xn(Kn(e,r[0]),l,n);t<s&&o.push({dist:t,range1:r[0],range2:[0,0]})}if(null!==r[1]){const t=Xn(Kn(e,r[1]),l,n);t<s&&o.push({dist:t,range1:r[1],range2:[0,0]})}}}return s}function hi(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:1/0,o=Math.min(s,i.distance(e[0],r[0]));if(0===o)return o;const a=new zn([{dist:0,range1:[0,e.length-1],range2:[0,r.length-1]}],Un),l=t?qn:Vn,c=n?qn:Vn;for(;a.length;){const s=a.pop();if(s.dist>=o)continue;const u=s.range1,d=s.range2;if(Hn(u)<=l&&Hn(d)<=c){if(!Gn(u,e.length)||!Gn(d,r.length))return NaN;if(t&&n?o=Math.min(o,ii(e,u,r,d,i)):t||n?t&&!n?o=Math.min(o,ri(r,d,e,u,i)):!t&&n&&(o=Math.min(o,ri(e,u,r,d,i))):o=Math.min(o,si(e,u,r,d,i)),0===o)return o}else{const s=Zn(u,t),l=Zn(d,n);ui(a,o,i,e,r,s[0],l[0]),ui(a,o,i,e,r,s[0],l[1]),ui(a,o,i,e,r,s[1],l[0]),ui(a,o,i,e,r,s[1],l[1])}}return o}function pi(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const s=Kn(e,[0,e.length-1]);for(const o of r)if(!(i!==1/0&&Xn(s,Kn(o,[0,o.length-1]),n)>=i)&&(i=Math.min(i,hi(e,t,o,!0,n,i)),0===i))return i;return i}function mi(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const s=Kn(e,[0,e.length-1]);for(const o of r){if(i!==1/0&&Xn(s,Yn(o),n)>=i)continue;const r=di(e,t,o,n,i);if(isNaN(r))return r;if(0===(i=Math.min(i,r)))return i}return i}function fi(e){return"Point"===e||"MultiPoint"===e||"LineString"===e||"MultiLineString"===e||"Polygon"===e||"MultiPolygon"===e}class gi{constructor(e,t){this.type=_r,this.geojson=e,this.geometries=t}static parse(e,t){if(2!==e.length)return t.error("'distance' expression requires either one argument, but found ' ".concat(e.length-1," instead."));if(Br(e[1])){const t=e[1];if("FeatureCollection"===t.type){for(let e=0;e<t.features.length;++e)if(fi(t.features[e].geometry.type))return new gi(t,t.features[e].geometry)}else if("Feature"===t.type){if(fi(t.geometry.type))return new gi(t,t.geometry)}else if(fi(t.type))return new gi(t,t)}return t.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(e){const t=e.geometry(),r=e.canonicalID();if(null!=t&&null!=r){if("Point"===e.geometryType())return function(e,t,r){const n=[];for(const s of e)for(const e of s)n.push($n(e,t));const i=new Rn(n[0][1],"meters");return"Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type?hi(n,!1,"Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,i):"MultiLineString"===r.type?pi(n,!1,r.coordinates,i):"Polygon"===r.type||"MultiPolygon"===r.type?mi(n,!1,"Polygon"===r.type?[r.coordinates]:r.coordinates,i):null}(t,r,this.geometries);if("LineString"===e.geometryType())return function(e,t,r){const n=[];for(const s of e){const e=[];for(const r of s)e.push($n(r,t));n.push(e)}const i=new Rn(n[0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return pi("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const s=pi(r.coordinates[t],!0,n,i,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}if("Polygon"===r.type||"MultiPolygon"===r.type){let e=1/0;for(let t=0;t<n.length;t++){const s=mi(n[t],!0,"Polygon"===r.type?[r.coordinates]:r.coordinates,i,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}return null}(t,r,this.geometries);if("Polygon"===e.geometryType())return function(e,t,r){const n=[];for(const s of function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let s=0;s<t;s++){const t=dn(e[s]);0!==t&&(e[s].area=Math.abs(t),void 0===i&&(i=t<0),i===t<0?(n&&r.push(n),n=[e[s]]):n.push(e[s]))}return n&&r.push(n),r}(e)){const e=[];for(let r=0;r<s.length;++r)e.push(ei(s[r],t));n.push(e)}const i=new Rn(n[0][0][0][1],"meters");if("Point"===r.type||"MultiPoint"===r.type||"LineString"===r.type)return mi("Point"===r.type?[r.coordinates]:r.coordinates,"LineString"===r.type,n,i);if("MultiLineString"===r.type){let e=1/0;for(let t=0;t<r.coordinates.length;t++){const s=mi(r.coordinates[t],!0,n,i,e);if(isNaN(s))return s;if(0===(e=Math.min(e,s)))return e}return e}return"Polygon"===r.type||"MultiPolygon"===r.type?function(e,t,r){let n=1/0;for(const i of e)for(const e of t){const t=ci(i,e,r,n);if(isNaN(t))return t;if(0===(n=Math.min(n,t)))return n}return n}("Polygon"===r.type?[r.coordinates]:r.coordinates,n,i):null}(t,r,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function yi(e){if(e instanceof sn){if("get"===e.name&&1===e.args.length)return!1;if("feature-state"===e.name)return!1;if("has"===e.name&&1===e.args.length)return!1;if("properties"===e.name||"geometry-type"===e.name||"id"===e.name)return!1;if(/^filter-/.test(e.name))return!1}if(e instanceof Nn)return!1;if(e instanceof gi)return!1;if(e instanceof ji)return e.featureConstant;let t=!0;return e.eachChild(e=>{t&&!yi(e)&&(t=!1)}),t}function _i(e){if(e instanceof sn&&"feature-state"===e.name)return!1;let t=!0;return e.eachChild(e=>{t&&!_i(e)&&(t=!1)}),t}function vi(e,t){if(e instanceof sn&&t.indexOf(e.name)>=0)return!1;let r=!0;return e.eachChild(e=>{r&&!vi(e,t)&&(r=!1)}),r}function xi(e,t,r){return[e,t,r].filter(Boolean).join("\x1f")}function bi(e,t){switch(e){case"string":return Vr(t);case"number":return+t;case"boolean":return!!t;case"color":return lr.parse(t);case"formatted":return Dr.fromString(Vr(t));case"resolvedImage":return Or.build(Vr(t))}return t}function wi(e,t,r,n){return void 0!==n&&(e=n*Math.round(e/n)),void 0!==t&&e<t&&(e=t),void 0!==r&&e>r&&(e=r),e}class ji{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.type=e,this.key=t,this.scope=r,this.featureConstant=n}static parse(e,t){let r=t.expectedType;if(null==r&&(r=jr),e.length<2||e.length>3)return t.error("Invalid number of arguments for 'config' expression.");const n=t.parse(e[1],1);if(!(n instanceof qr))return t.error("Key name of 'config' expression must be a string literal.");let i,s=!0;const o=Vr(n.value);if(e.length>=3){const r=t.parse(e[2],2);if(!(r instanceof qr))return t.error("Scope of 'config' expression must be a string literal.");i=Vr(r.value)}if(t.options){const e=xi(o,i,t._scope),r=t.options.get(e);r&&(s=yi(r.value||r.default))}return new ji(r,o,i,s)}evaluate(e){const t=xi(this.key,this.scope,e.scope),r=e.getConfig(t);if(!r)return null;const{type:n,value:i,values:s,minValue:o,maxValue:a,stepValue:l}=r,c=r.default.evaluate(e);let u=c;if(i){const t=e.scope;e.scope=(t||"").split("\x1f").slice(1).join("\x1f"),u=i.evaluate(e),e.scope=t}return n&&(u=bi(n,u)),void 0===u||void 0===o&&void 0===a&&void 0===l||("number"==typeof u?u=wi(u,o,a,l):Array.isArray(u)&&(u=u.map(e=>"number"==typeof e?wi(e,o,a,l):e))),void 0!==i&&void 0!==u&&s&&!s.includes(u)&&(u=c,n&&(u=bi(n,u))),(n&&n!==this.type||void 0!==u&&!Mr(Ur(u),this.type))&&(u=bi(this.type.kind,u)),u}eachChild(){}outputDefined(){return!1}serialize(){const e=["config",this.key];return this.scope&&e.concat(this.scope),e}}class Si{constructor(e,t){this.type=t.type,this.name=e,this.boundExpression=t}static parse(e,t){if(2!==e.length||"string"!=typeof e[1])return t.error("'var' expression requires exactly one string literal argument.");const r=e[1];return t.scope.has(r)?new Si(r,t.scope.get(r)):t.error('Unknown variable "'.concat(r,'". Make sure "').concat(r,'" has been bound in an enclosing "let" expression before using it.'),1)}evaluate(e){return this.boundExpression.evaluate(e)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class Ti{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],r=arguments.length>2?arguments[2]:void 0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new gr,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[],s=arguments.length>5?arguments[5]:void 0,o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;this.registry=e,this.path=t,this.key=t.map(e=>"string"==typeof e?"['".concat(e,"']"):"[".concat(e,"]")).join(""),this.scope=n,this.errors=i,this.expectedType=r,this._scope=s,this.options=o,this.iconImageUseTheme=a}parse(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};return t||r?this.concat(t,null,r,n)._parse(e,i):this._parse(e,i)}parseObjectValue(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};return this.concat(t,r,n,i)._parse(e,s)}_parse(e,t){function r(e,t,r){return"assert"===r?new Gr(t,[e]):"coerce"===r?new tn(t,[e]):e}if(null!==e&&"string"!=typeof e&&"boolean"!=typeof e&&"number"!=typeof e||(e=["literal",e]),Array.isArray(e)){if(0===e.length)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const n="string"==typeof e[0]?this.registry[e[0]]:void 0;if(n){let i=n.parse(e,this);if(!i)return null;if(this.expectedType){const e=this.expectedType,n=i.type;if("string"!==e.kind&&"number"!==e.kind&&"boolean"!==e.kind&&"object"!==e.kind&&"array"!==e.kind||"value"!==n.kind)if("color"!==e.kind&&"formatted"!==e.kind&&"resolvedImage"!==e.kind||"value"!==n.kind&&"string"!==n.kind){if(this.checkSubtype(e,n))return null}else i=r(i,e,t.typeAnnotation||"coerce");else i=r(i,e,t.typeAnnotation||"assert")}if(!(i instanceof qr)&&"resolvedImage"!==i.type.kind&&ki(i)){const t=new nn(this._scope,this.options,this.iconImageUseTheme);try{i=new qr(i.type,i.evaluate(t))}catch(e){return this.error(e.message),null}}return i}return tn.parse(["to-array",e],this)}return this.error(void 0===e?"'undefined' value invalid. Use null instead.":"object"==typeof e?'Bare objects invalid. Use ["literal", {...}] instead.':"Expected an array, but found ".concat(typeof e," instead."))}concat(e,t,r,n){let i="number"==typeof e?this.path.concat(e):this.path;i="string"==typeof t?i.concat(t):i;const s=n?this.scope.concat(n):this.scope;return new Ti(this.registry,i,r||null,s,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const i="".concat(this.key).concat(r.map(e=>"[".concat(e,"]")).join(""));this.errors.push(new fr(i,e))}checkSubtype(e,t){const r=Nr(e,t);return r&&this.error(r),r}}function ki(e){if(e instanceof Si)return ki(e.boundExpression);if(e instanceof sn&&"error"===e.name)return!1;if(e instanceof an)return!1;if(e instanceof Nn)return!1;if(e instanceof gi)return!1;if(e instanceof ji)return!1;const t=e instanceof tn||e instanceof Gr;let r=!0;return e.eachChild(e=>{r=t?r&&ki(e):r&&e instanceof qr}),!!r&&yi(e)&&vi(e,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function Ai(e,t){const r=e.length-1;let n,i,s=0,o=r,a=0;for(;s<=o;)if(a=Math.floor((s+o)/2),n=e[a],i=e[a+1],n<=t){if(a===r||t<i)return a;s=a+1}else{if(!(n>t))throw new Wr("Input is not a number.");o=a-1}return 0}class Ci{constructor(e,t,r){this.type=e,this.input=t,this.labels=[],this.outputs=[];for(const[n,i]of r)this.labels.push(n),this.outputs.push(i)}static parse(e,t){if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if((e.length-1)%2!=0)return t.error("Expected an even number of arguments.");const r=t.parse(e[1],1,_r);if(!r)return null;const n=[];let i=null;t.expectedType&&"value"!==t.expectedType.kind&&(i=t.expectedType);for(let s=1;s<e.length;s+=2){const r=1===s?-1/0:e[s],o=e[s+1],a=s,l=s+1;if("number"!=typeof r)return t.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',a);if(n.length&&n[n.length-1][0]>=r)return t.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',a);const c=t.parse(o,l,i);if(!c)return null;i=i||c.type,n.push([r,c])}return new Ci(i,r,n)}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;return n>=t[i-1]?r[i-1].evaluate(e):r[Ai(t,n)].evaluate(e)}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){const e=["step",this.input.serialize()];for(let t=0;t<this.labels.length;t++)t>0&&e.push(this.labels[t]),e.push(this.outputs[t].serialize());return e}}const Ei=.95047,Ni=1.08883,Ii=4/29,Pi=6/29,Mi=3*Pi*Pi,Li=Pi*Pi*Pi,Ri=Math.PI/180,Di=180/Math.PI;function Fi(e){return e>Li?Math.pow(e,1/3):e/Mi+Ii}function Oi(e){return e>Pi?e*e*e:Mi*(e-Ii)}function zi(e){return 255*(e<=.0031308?12.92*e:1.055*Math.pow(e,1/2.4)-.055)}function Bi(e){return(e/=255)<=.04045?e/12.92:Math.pow((e+.055)/1.055,2.4)}function Ui(e){const t=Bi(e.r),r=Bi(e.g),n=Bi(e.b),i=Fi((.4124564*t+.3575761*r+.1804375*n)/Ei),s=Fi((.2126729*t+.7151522*r+.072175*n)/1);return{l:116*s-16,a:500*(i-s),b:200*(s-Fi((.0193339*t+.119192*r+.9503041*n)/Ni)),alpha:e.a}}function Vi(e){let t=(e.l+16)/116,r=isNaN(e.a)?t:t+e.a/500,n=isNaN(e.b)?t:t-e.b/200;return t=1*Oi(t),r=Ei*Oi(r),n=Ni*Oi(n),new lr(zi(3.2404542*r-1.5371385*t-.4985314*n),zi(-.969266*r+1.8760108*t+.041556*n),zi(.0556434*r-.2040259*t+1.0572252*n),e.alpha)}function qi(e,t,r){const n=t-e;return e+r*(n>180||n<-180?n-360*Math.round(n/360):n)}const Wi={forward:Ui,reverse:Vi,interpolate:function(e,t,r){return{l:hr(e.l,t.l,r),a:hr(e.a,t.a,r),b:hr(e.b,t.b,r),alpha:hr(e.alpha,t.alpha,r)}}},Hi={forward:function(e){const{l:t,a:r,b:n}=Ui(e),i=Math.atan2(n,r)*Di;return{h:i<0?i+360:i,c:Math.sqrt(r*r+n*n),l:t,alpha:e.a}},reverse:function(e){const t=e.h*Ri,r=e.c;return Vi({l:e.l,a:Math.cos(t)*r,b:Math.sin(t)*r,alpha:e.alpha})},interpolate:function(e,t,r){return{h:qi(e.h,t.h,r),c:hr(e.c,t.c,r),l:hr(e.l,t.l,r),alpha:hr(e.alpha,t.alpha,r)}}};var Gi=Object.freeze({__proto__:null,hcl:Hi,lab:Wi});class Zi{constructor(e,t,r,n,i){this.type=e,this.operator=t,this.interpolation=r,this.input=n,this.labels=[],this.outputs=[];for(const[s,o]of i)this.labels.push(s),this.outputs.push(o)}static interpolationFactor(e,t,r,n){let i=0;if("exponential"===e.name)i=Ki(t,e.base,r,n);else if("linear"===e.name)i=Ki(t,1,r,n);else if("cubic-bezier"===e.name){const s=e.controlPoints;i=new je(s[0],s[1],s[2],s[3]).solve(Ki(t,1,r,n))}return i}static parse(e,t){let[r,n,i,...s]=e;if(!Array.isArray(n)||0===n.length)return t.error("Expected an interpolation type expression.",1);if("linear"===n[0])n={name:"linear"};else if("exponential"===n[0]){const e=n[1];if("number"!=typeof e)return t.error("Exponential interpolation requires a numeric base.",1,1);n={name:"exponential",base:e}}else{if("cubic-bezier"!==n[0])return t.error("Unknown interpolation type ".concat(String(n[0])),1,0);{const e=n.slice(1);if(4!==e.length||e.some(e=>"number"!=typeof e||e<0||e>1))return t.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);n={name:"cubic-bezier",controlPoints:e}}}if(e.length-1<4)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length-1>3&&(e.length-1)%2!=0)return t.error("Expected an even number of arguments.");if(i=t.parse(i,2,_r),!i)return null;const o=[];let a=null;"interpolate-hcl"===r||"interpolate-lab"===r?a=br:t.expectedType&&"value"!==t.expectedType.kind&&(a=t.expectedType);for(let l=0;l<s.length;l+=2){const e=s[l],r=s[l+1],n=l+3,i=l+4;if("number"!=typeof e)return t.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',n);if(o.length&&o[o.length-1][0]>=e)return t.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',n);const c=t.parse(r,i,a);if(!c)return null;a=a||c.type,o.push([e,c])}return"number"===a.kind||"color"===a.kind||"array"===a.kind&&"number"===a.itemType.kind&&"number"==typeof a.N?new Zi(a,r,n,i,o):t.error("Type ".concat(Cr(a)," is not interpolatable."))}evaluate(e){const t=this.labels,r=this.outputs;if(1===t.length)return r[0].evaluate(e);const n=this.input.evaluate(e);if(n<=t[0])return r[0].evaluate(e);const i=t.length;if(n>=t[i-1])return r[i-1].evaluate(e);const s=Ai(t,n),o=Zi.interpolationFactor(this.interpolation,n,t[s],t[s+1]),a=r[s].evaluate(e),l=r[s+1].evaluate(e);return"interpolate"===this.operator?mr[this.type.kind.toLowerCase()](a,l,o):"interpolate-hcl"===this.operator?Hi.reverse(Hi.interpolate(Hi.forward(a),Hi.forward(l),o)):Wi.reverse(Wi.interpolate(Wi.forward(a),Wi.forward(l),o))}eachChild(e){e(this.input);for(const t of this.outputs)e(t)}outputDefined(){return this.outputs.every(e=>e.outputDefined())}serialize(){let e;e="linear"===this.interpolation.name?["linear"]:"exponential"===this.interpolation.name?1===this.interpolation.base?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const t=[this.operator,e,this.input.serialize()];for(let r=0;r<this.labels.length;r++)t.push(this.labels[r],this.outputs[r].serialize());return t}}function Ki(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}class Yi{constructor(e,t){this.type=e,this.args=t}static parse(e,t){if(e.length<2)return t.error("Expectected at least one argument.");let r=null;const n=t.expectedType;n&&"value"!==n.kind&&(r=n);const i=[];for(const o of e.slice(1)){const e=t.parse(o,1+i.length,r,void 0,{typeAnnotation:"omit"});if(!e)return null;r=r||e.type,i.push(e)}const s=n&&i.some(e=>Nr(n,e.type));return new Yi(s?jr:r,i)}evaluate(e){let t,r=null,n=0;for(const i of this.args){if(n++,r=i.evaluate(e),r&&r instanceof Or&&!r.available&&(t||(t=r),r=null,n===this.args.length))return t;if(null!==r)break}return r}eachChild(e){this.args.forEach(e)}outputDefined(){return this.args.every(e=>e.outputDefined())}serialize(){const e=["coalesce"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class Xi{constructor(e,t){this.type=t.type,this.bindings=[].concat(e),this.result=t}evaluate(e){return this.result.evaluate(e)}eachChild(e){for(const t of this.bindings)e(t[1]);e(this.result)}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found ".concat(e.length-1," instead."));const r=[];for(let i=1;i<e.length-1;i+=2){const n=e[i];if("string"!=typeof n)return t.error("Expected string, but found ".concat(typeof n," instead."),i);if(/[^a-zA-Z0-9_]/.test(n))return t.error("Variable names must contain only alphanumeric characters or '_'.",i);const s=t.parse(e[i+1],i+1);if(!s)return null;r.push([n,s])}const n=t.parse(e[e.length-1],e.length-1,t.expectedType,r);return n?new Xi(r,n):null}outputDefined(){return this.result.outputDefined()}serialize(){const e=["let"];for(const[t,r]of this.bindings)e.push(t,r.serialize());return e.push(this.result.serialize()),e}}class Ji{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,_r),n=t.parse(e[2],2,Ar(t.expectedType||jr));return r&&n?new Ji(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Wr("Array index out of bounds: negative index");if(t>=r.length)throw new Wr("Array index out of bounds: index exceeds array size");if(t!==Math.floor(t))throw new Wr("Array index must be an integer. Use at-interpolated for fractional indices");return r[t]}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class Qi{constructor(e,t,r){this.type=e,this.index=t,this.input=r}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,_r),n=t.parse(e[2],2,Ar(t.expectedType||jr));return r&&n?new Qi(n.type.itemType,r,n):null}evaluate(e){const t=this.index.evaluate(e),r=this.input.evaluate(e);if(t<0)throw new Wr("Array index out of bounds: ".concat(t," < 0."));if(t>r.length-1)throw new Wr("Array index out of bounds: ".concat(t," > ").concat(r.length-1,"."));if(t===Math.floor(t))return r[t];const n=Math.floor(t),i=Math.ceil(t),s=r[n],o=r[i];if("number"!=typeof s||"number"!=typeof o)throw new Wr("Cannot interpolate between non-number values at index ".concat(t,"."));const a=t-n;return s*(1-a)+o*a}eachChild(e){e(this.index),e(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class $i{constructor(e,t){this.type=xr,this.needle=e,this.haystack=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,jr),n=t.parse(e[2],2,jr);return r&&n?Ir(r.type,[xr,vr,_r,yr,jr])?new $i(r,n):t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Cr(r.type)," instead")):null}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(null==r)return!1;if(!Pr(t,["boolean","string","number","null"]))throw new Wr("Expected first argument to be of type boolean, string, number or null, but found ".concat(Cr(Ur(t))," instead."));if(!Pr(r,["string","array"]))throw new Wr("Expected second argument to be of type array or string, but found ".concat(Cr(Ur(r))," instead."));return r.indexOf(t)>=0}eachChild(e){e(this.needle),e(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class es{constructor(e,t,r){this.type=_r,this.needle=e,this.haystack=t,this.fromIndex=r}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,jr),n=t.parse(e[2],2,jr);if(!r||!n)return null;if(!Ir(r.type,[xr,vr,_r,yr,jr]))return t.error("Expected first argument to be of type boolean, string, number or null, but found ".concat(Cr(r.type)," instead"));if(4===e.length){const i=t.parse(e[3],3,_r);return i?new es(r,n,i):null}return new es(r,n)}evaluate(e){const t=this.needle.evaluate(e),r=this.haystack.evaluate(e);if(!Pr(t,["boolean","string","number","null"]))throw new Wr("Expected first argument to be of type boolean, string, number or null, but found ".concat(Cr(Ur(t))," instead."));if(!Pr(r,["string","array"]))throw new Wr("Expected second argument to be of type array or string, but found ".concat(Cr(Ur(r))," instead."));if(this.fromIndex){const n=this.fromIndex.evaluate(e);return r.indexOf(t,n)}return r.indexOf(t)}eachChild(e){e(this.needle),e(this.haystack),this.fromIndex&&e(this.fromIndex)}outputDefined(){return!1}serialize(){if(null!=this.fromIndex&&void 0!==this.fromIndex){const e=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),e]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class ts{constructor(e,t,r,n,i,s){this.inputType=e,this.type=t,this.input=r,this.cases=n,this.outputs=i,this.otherwise=s}static parse(e,t){if(e.length<5)return t.error("Expected at least 4 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=1)return t.error("Expected an even number of arguments.");let r,n;t.expectedType&&"value"!==t.expectedType.kind&&(n=t.expectedType);const i={},s=[];for(let l=2;l<e.length-1;l+=2){let o=e[l];const a=e[l+1];Array.isArray(o)||(o=[o]);const c=t.concat(l);if(0===o.length)return c.error("Expected at least one branch label.");for(const e of o){if("number"!=typeof e&&"string"!=typeof e)return c.error("Branch labels must be numbers or strings.");if("number"==typeof e&&Math.abs(e)>Number.MAX_SAFE_INTEGER)return c.error("Branch labels must be integers no larger than ".concat(Number.MAX_SAFE_INTEGER,"."));if("number"==typeof e&&Math.floor(e)!==e)return c.error("Numeric branch labels must be integer values.");if(r){if(c.checkSubtype(r,Ur(e)))return null}else r=Ur(e);if(void 0!==i[String(e)])return c.error("Branch labels must be unique.");i[String(e)]=s.length}const u=t.parse(a,l,n);if(!u)return null;n=n||u.type,s.push(u)}const o=t.parse(e[1],1,jr);if(!o)return null;const a=t.parse(e[e.length-1],e.length-1,n);return a?"value"!==o.type.kind&&t.concat(1).checkSubtype(r,o.type)?null:new ts(r,n,o,i,s,a):null}evaluate(e){const t=this.input.evaluate(e);return(Mr(Ur(t),this.inputType)&&this.outputs[this.cases[t]]||this.otherwise).evaluate(e)}eachChild(e){e(this.input),this.outputs.forEach(e),e(this.otherwise)}outputDefined(){return this.outputs.every(e=>e.outputDefined())&&this.otherwise.outputDefined()}serialize(){const e=["match",this.input.serialize()],t=Object.keys(this.cases).sort(),r=[],n={};for(const s of t){const e=n[this.cases[s]];void 0===e?(n[this.cases[s]]=r.length,r.push([this.cases[s],[s]])):r[e][1].push(s)}const i=e=>"number"===this.inputType.kind?Number(e):e;for(const[s,o]of r)e.push(1===o.length?i(o[0]):o.map(i)),e.push(this.outputs[s].serialize());return e.push(this.otherwise.serialize()),e}}class rs{constructor(e,t,r){this.type=e,this.branches=t,this.otherwise=r}static parse(e,t){if(e.length<4)return t.error("Expected at least 3 arguments, but found only ".concat(e.length-1,"."));if(e.length%2!=0)return t.error("Expected an odd number of arguments.");let r;t.expectedType&&"value"!==t.expectedType.kind&&(r=t.expectedType);const n=[];for(let s=1;s<e.length-1;s+=2){const i=t.parse(e[s],s,xr);if(!i)return null;const o=t.parse(e[s+1],s+1,r);if(!o)return null;n.push([i,o]),r=r||o.type}const i=t.parse(e[e.length-1],e.length-1,r);return i?new rs(r,n,i):null}evaluate(e){for(const[t,r]of this.branches)if(t.evaluate(e))return r.evaluate(e);return this.otherwise.evaluate(e)}eachChild(e){for(const[t,r]of this.branches)e(t),e(r);e(this.otherwise)}outputDefined(){return this.branches.every(e=>{let[t,r]=e;return r.outputDefined()})&&this.otherwise.outputDefined()}serialize(){const e=["case"];return this.eachChild(t=>{e.push(t.serialize())}),e}}class ns{constructor(e,t,r,n){this.type=e,this.input=t,this.beginIndex=r,this.endIndex=n}static parse(e,t){if(e.length<=2||e.length>=5)return t.error("Expected 3 or 4 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,jr),n=t.parse(e[2],2,_r);if(!r||!n)return null;if(!Ir(r.type,[Ar(jr),vr,jr]))return t.error("Expected first argument to be of type array or string, but found ".concat(Cr(r.type)," instead"));if(4===e.length){const i=t.parse(e[3],3,_r);return i?new ns(r.type,r,n,i):null}return new ns(r.type,r,n)}evaluate(e){const t=this.input.evaluate(e),r=this.beginIndex.evaluate(e);if(!Pr(t,["string","array"]))throw new Wr("Expected first argument to be of type array or string, but found ".concat(Cr(Ur(t))," instead."));if(this.endIndex){const n=this.endIndex.evaluate(e);return t.slice(r,n)}return t.slice(r)}eachChild(e){e(this.input),e(this.beginIndex),this.endIndex&&e(this.endIndex)}outputDefined(){return!1}serialize(){if(null!=this.endIndex&&void 0!==this.endIndex){const e=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),e]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class is{constructor(e,t){this.type=Ar(vr),this.str=e,this.delimiter=t}static parse(e,t){if(3!==e.length)return t.error("Expected 2 arguments, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1,vr),n=t.parse(e[2],2,vr);return r&&n?new is(r,n):void 0}evaluate(e){const t=this.str.evaluate(e),r=this.delimiter.evaluate(e);return t.split(r)}eachChild(e){e(this.str),e(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function ss(e,t){return"=="===e||"!="===e?"boolean"===t.kind||"string"===t.kind||"number"===t.kind||"null"===t.kind||"value"===t.kind:"string"===t.kind||"number"===t.kind||"value"===t.kind}function os(e,t,r,n){return 0===n.compare(t,r)}function as(e,t,r){const n="=="!==e&&"!="!==e;return class i{constructor(e,t,r){this.type=xr,this.lhs=e,this.rhs=t,this.collator=r,this.hasUntypedArgument="value"===e.type.kind||"value"===t.type.kind}static parse(e,t){if(3!==e.length&&4!==e.length)return t.error("Expected two or three arguments.");const r=e[0];let s=t.parse(e[1],1,jr);if(!s)return null;if(!ss(r,s.type))return t.concat(1).error('"'.concat(r,"\" comparisons are not supported for type '").concat(Cr(s.type),"'."));let o=t.parse(e[2],2,jr);if(!o)return null;if(!ss(r,o.type))return t.concat(2).error('"'.concat(r,"\" comparisons are not supported for type '").concat(Cr(o.type),"'."));if(s.type.kind!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return t.error("Cannot compare types '".concat(Cr(s.type),"' and '").concat(Cr(o.type),"'."));n&&("value"===s.type.kind&&"value"!==o.type.kind?s=new Gr(o.type,[s]):"value"!==s.type.kind&&"value"===o.type.kind&&(o=new Gr(s.type,[o])));let a=null;if(4===e.length){if("string"!==s.type.kind&&"string"!==o.type.kind&&"value"!==s.type.kind&&"value"!==o.type.kind)return t.error("Cannot use collator to compare non-string types.");if(a=t.parse(e[3],3,Sr),!a)return null}return new i(s,o,a)}evaluate(i){const s=this.lhs.evaluate(i),o=this.rhs.evaluate(i);if(n&&this.hasUntypedArgument){const t=Ur(s),r=Ur(o);if(t.kind!==r.kind||"string"!==t.kind&&"number"!==t.kind)throw new Wr('Expected arguments for "'.concat(e,'" to be (string, string) or (number, number), but found (').concat(t.kind,", ").concat(r.kind,") instead."))}if(this.collator&&!n&&this.hasUntypedArgument){const e=Ur(s),r=Ur(o);if("string"!==e.kind||"string"!==r.kind)return t(i,s,o)}return this.collator?r(i,s,o,this.collator.evaluate(i)):t(i,s,o)}eachChild(e){e(this.lhs),e(this.rhs),this.collator&&e(this.collator)}outputDefined(){return!0}serialize(){const t=[e];return this.eachChild(e=>{t.push(e.serialize())}),t}}}const ls=as("==",function(e,t,r){return t===r},os),cs=as("!=",function(e,t,r){return t!==r},function(e,t,r,n){return!os(0,t,r,n)}),us=as("<",function(e,t,r){return t<r},function(e,t,r,n){return n.compare(t,r)<0}),ds=as(">",function(e,t,r){return t>r},function(e,t,r,n){return n.compare(t,r)>0}),hs=as("<=",function(e,t,r){return t<=r},function(e,t,r,n){return n.compare(t,r)<=0}),ps=as(">=",function(e,t,r){return t>=r},function(e,t,r,n){return n.compare(t,r)>=0});class ms{constructor(e,t,r,n,i,s){this.type=vr,this.number=e,this.locale=t,this.currency=r,this.unit=n,this.minFractionDigits=i,this.maxFractionDigits=s}static parse(e,t){if(3!==e.length)return t.error("Expected two arguments.");const r=t.parse(e[1],1,_r);if(!r)return null;const n=e[2];if("object"!=typeof n||Array.isArray(n))return t.error("NumberFormat options argument must be an object.");let i=null;if(n.locale&&(i=t.parseObjectValue(n.locale,2,"locale",vr),!i))return null;let s=null;if(n.currency&&(s=t.parseObjectValue(n.currency,2,"currency",vr),!s))return null;let o=null;if(n.unit&&(o=t.parseObjectValue(n.unit,2,"unit",vr),!o))return null;let a=null;if(n["min-fraction-digits"]&&(a=t.parseObjectValue(n["min-fraction-digits"],2,"min-fraction-digits",_r),!a))return null;let l=null;return n["max-fraction-digits"]&&(l=t.parseObjectValue(n["max-fraction-digits"],2,"max-fraction-digits",_r),!l)?null:new ms(r,i,s,o,a,l)}evaluate(e){return new Intl.NumberFormat(this.locale?this.locale.evaluate(e):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(e):void 0,unit:this.unit?this.unit.evaluate(e):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(e):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(e):void 0}).format(this.number.evaluate(e))}eachChild(e){e(this.number),this.locale&&e(this.locale),this.currency&&e(this.currency),this.unit&&e(this.unit),this.minFractionDigits&&e(this.minFractionDigits),this.maxFractionDigits&&e(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const e={};return this.locale&&(e.locale=this.locale.serialize()),this.currency&&(e.currency=this.currency.serialize()),this.unit&&(e.unit=this.unit.serialize()),this.minFractionDigits&&(e["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(e["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),e]}}class fs{constructor(e){this.type=_r,this.input=e}static parse(e,t){if(2!==e.length)return t.error("Expected 1 argument, but found ".concat(e.length-1," instead."));const r=t.parse(e[1],1);return r?"array"!==r.type.kind&&"string"!==r.type.kind&&"value"!==r.type.kind?t.error("Expected argument of type string or array, but found ".concat(Cr(r.type)," instead.")):new fs(r):null}evaluate(e){const t=this.input.evaluate(e);if("string"==typeof t)return t.length;if(Array.isArray(t))return t.length;throw new Wr("Expected value to be of type string or array, but found ".concat(Cr(Ur(t))," instead."))}eachChild(e){e(this.input)}outputDefined(){return!1}serialize(){const e=["length"];return this.eachChild(t=>{e.push(t.serialize())}),e}}function gs(e){return function(){e=1831565813+(e|=0)|0;let t=Math.imul(e^e>>>15,1|e);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const ys={"==":ls,"!=":cs,">":ds,"<":us,">=":ps,"<=":hs,array:Gr,at:Ji,"at-interpolated":Qi,boolean:Gr,case:rs,coalesce:Yi,collator:an,format:Zr,image:Kr,in:$i,"index-of":es,interpolate:Zi,"interpolate-hcl":Zi,"interpolate-lab":Zi,length:fs,let:Xi,literal:qr,match:ts,number:Gr,"number-format":ms,object:Gr,slice:ns,step:Ci,string:Gr,"to-boolean":tn,"to-color":tn,"to-number":tn,"to-string":tn,var:Si,within:Nn,distance:gi,config:ji,split:is};function _s(e,t){let[r,n,i,s]=t;r=r.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const o=s?s.evaluate(e):1,a=zr(r,n,i,o);if(a)throw new Wr(a);return new lr(r/255,n/255,i/255,o)}function vs(e,t){let[r,n,i,s]=t;r=r.evaluate(e),n=n.evaluate(e),i=i.evaluate(e);const o=s?s.evaluate(e):1,a=function(e,t,r,n){return"number"==typeof e&&e>=0&&e<=360?"number"==typeof t&&t>=0&&t<=100&&"number"==typeof r&&r>=0&&r<=100?void 0===n||"number"==typeof n&&n>=0&&n<=1?null:"Invalid hsla value [".concat([e,t,r,n].join(", "),"]: 'a' must be between 0 and 1."):"Invalid hsla value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 's', and 'l' must be between 0 and 100."):"Invalid hsla value [".concat(("number"==typeof n?[e,t,r,n]:[e,t,r]).join(", "),"]: 'h' must be between 0 and 360.")}(r,n,i,o);if(a)throw new Wr(a);const l="hsla(".concat(r,", ").concat(n,"%, ").concat(i,"%, ").concat(o,")"),c=lr.parse(l);if(!c)throw new Wr("Failed to parse HSLA color: ".concat(l));return c}function xs(e,t){return e in t}function bs(e,t){const r=t[e];return void 0===r?null:r}function ws(e){return{type:e}}function js(e){if(e instanceof ji)return new Set([e.key]);let t=new Set;return e.eachChild(e=>{t=new Set([...t,...js(e)])}),t}function Ss(e){if(e instanceof sn&&"is-active-floor"===e.name)return!0;let t=!1;return e.eachChild(e=>{!t&&Ss(e)&&(t=!0)}),t}function Ts(e){return{result:"success",value:e}}function ks(e){return{result:"error",value:e}}function As(e,t){return!!e&&!!e.parameters&&e.parameters.indexOf(t)>-1}function Cs(e){return"data-driven"===e["property-type"]}function Es(e){return As(e.expression,"measure-light")}function Ns(e){return As(e.expression,"zoom")}function Is(e){return!!e.expression&&e.expression.interpolated}function Ps(e){return"object"==typeof e&&null!==e&&!Array.isArray(e)}function Ms(e){return e}function Ls(e,t){const r="color"===t.type,n=e.stops&&"object"==typeof e.stops[0][0],i=n||!(n||void 0!==e.property),s=e.type||(Is(t)?"exponential":"interval");if(r&&((e=Object.assign({},e)).stops&&(e.stops=e.stops.map(e=>[e[0],lr.parse(e[1])])),e.default=lr.parse(e.default?e.default:t.default)),e.colorSpace&&"rgb"!==e.colorSpace&&!Gi[e.colorSpace])throw new Error("Unknown color space: ".concat(e.colorSpace));let o,a,l;if("exponential"===s)o=Os;else if("interval"===s)o=Fs;else if("categorical"===s){o=Ds,a=Object.create(null);for(const t of e.stops)a[t[0]]=t[1];l=typeof e.stops[0][0]}else{if("identity"!==s)throw new Error('Unknown function type "'.concat(s,'"'));o=zs}if(n){const r={},n=[];for(let t=0;t<e.stops.length;t++){const i=e.stops[t],s=i[0].zoom;void 0===r[s]&&(r[s]={zoom:s,type:e.type,property:e.property,default:e.default,stops:[]},n.push(s)),r[s].stops.push([i[0].value,i[1]])}const i=[];for(const e of n)i.push([r[e].zoom,Ls(r[e],t)]);const s={name:"linear"};return{kind:"composite",interpolationType:s,interpolationFactor:Zi.interpolationFactor.bind(void 0,s),zoomStops:i.map(e=>e[0]),evaluate:(r,n)=>{let{zoom:s}=r;return Os({stops:i,base:e.base},t,s).evaluate(s,n)}}}if(i){const r="exponential"===s?{name:"exponential",base:void 0!==e.base?e.base:1}:null;return{kind:"camera",interpolationType:r,interpolationFactor:Zi.interpolationFactor.bind(void 0,r),zoomStops:e.stops.map(e=>e[0]),evaluate:r=>{let{zoom:n}=r;return o(e,t,n,a,l)}}}return{kind:"source",evaluate(r,n){const i=n&&n.properties?n.properties[e.property]:void 0;return void 0===i?Rs(e.default,t.default):o(e,t,i,a,l)}}}function Rs(e,t,r){return void 0!==e?e:void 0!==t?t:void 0!==r?r:void 0}function Ds(e,t,r,n,i){return Rs(typeof r===i?n[r]:void 0,e.default,t.default)}function Fs(e,t,r){if(!Qr(r))return Rs(e.default,t.default);const n=e.stops.length;if(1===n)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[n-1][0])return e.stops[n-1][1];const i=Ai(e.stops.map(e=>e[0]),r);return e.stops[i][1]}function Os(e,t,r){const n=void 0!==e.base?e.base:1;if(!Qr(r))return Rs(e.default,t.default);const i=e.stops.length;if(1===i)return e.stops[0][1];if(r<=e.stops[0][0])return e.stops[0][1];if(r>=e.stops[i-1][0])return e.stops[i-1][1];const s=Ai(e.stops.map(e=>e[0]),r),o=function(e,t,r,n){const i=n-r,s=e-r;return 0===i?0:1===t?s/i:(Math.pow(t,s)-1)/(Math.pow(t,i)-1)}(r,n,e.stops[s][0],e.stops[s+1][0]),a=e.stops[s][1],l=e.stops[s+1][1];let c=mr[t.type]||Ms;if(e.colorSpace&&"rgb"!==e.colorSpace){const t=Gi[e.colorSpace];c=(e,r)=>t.reverse(t.interpolate(t.forward(e),t.forward(r),o))}return"function"==typeof a.evaluate?{evaluate(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=a.evaluate.apply(void 0,t),i=l.evaluate.apply(void 0,t);if(void 0!==n&&void 0!==i)return c(n,i,o)}}:c(a,l,o)}function zs(e,t,r){return"color"===t.type?r=lr.parse(r):"formatted"===t.type?r=Dr.fromString(r.toString()):"resolvedImage"===t.type?r=Or.build(r.toString()):Yr(r)===t.type||"enum"===t.type&&t.values[r]||(r=void 0),Rs(r,e.default,t.default)}sn.register(ys,{error:[{kind:"error"},[vr],(e,t)=>{let[r]=t;throw new Wr(r.evaluate(e))}],typeof:[vr,[jr],(e,t)=>{let[r]=t;return Cr(Ur(r.evaluate(e)))}],"to-rgba":[Ar(_r,4),[br],(e,t)=>{let[r]=t;return r.evaluate(e).toNonPremultipliedRenderColor(null).toArray()}],"to-hsla":[Ar(_r,4),[br],(e,t)=>{let[r]=t;return r.evaluate(e).toNonPremultipliedRenderColor(null).toHslaArray()}],rgb:[br,[_r,_r,_r],_s],rgba:[br,[_r,_r,_r,_r],_s],hsl:[br,[_r,_r,_r],vs],hsla:[br,[_r,_r,_r,_r],vs],has:{type:xr,overloads:[[[vr],(e,t)=>{let[r]=t;return xs(r.evaluate(e),e.properties())}],[[vr,wr],(e,t)=>{let[r,n]=t;return xs(r.evaluate(e),n.evaluate(e))}]]},get:{type:jr,overloads:[[[vr],(e,t)=>{let[r]=t;return bs(r.evaluate(e),e.properties())}],[[vr,wr],(e,t)=>{let[r,n]=t;return bs(r.evaluate(e),n.evaluate(e))}]]},"feature-state":[jr,[vr],(e,t)=>{let[r]=t;return bs(r.evaluate(e),e.featureState||{})}],properties:[wr,[],e=>e.properties()],"geometry-type":[vr,[],e=>e.geometryType()],worldview:[vr,[],e=>e.globals.worldview||""],"is-active-floor":[xr,ws(vr),(e,t)=>{if(!(e.globals.activeFloors&&e.globals.activeFloors.size>0))return!1;const r=e.globals.activeFloors;return t.some(t=>{const n=t.evaluate(e);return r.has(n)})}],id:[jr,[],e=>e.id()],zoom:[_r,[],e=>e.globals.zoom],pitch:[_r,[],e=>e.globals.pitch||0],"distance-from-center":[_r,[],e=>e.distanceFromCenter()],"measure-light":[_r,[vr],(e,t)=>{let[r]=t;return e.measureLight(r.evaluate(e))}],"heatmap-density":[_r,[],e=>e.globals.heatmapDensity||0],"line-progress":[_r,[],e=>e.globals.lineProgress||0],"raster-value":[_r,[],e=>e.globals.rasterValue||0],"raster-particle-speed":[_r,[],e=>e.globals.rasterParticleSpeed||0],"sky-radial-progress":[_r,[],e=>e.globals.skyRadialProgress||0],accumulated:[jr,[],e=>void 0===e.globals.accumulated?null:e.globals.accumulated],"+":[_r,ws(_r),(e,t)=>{let r=0;for(const n of t)r+=n.evaluate(e);return r}],"*":[_r,ws(_r),(e,t)=>{let r=1;for(const n of t)r*=n.evaluate(e);return r}],"-":{type:_r,overloads:[[[_r,_r],(e,t)=>{let[r,n]=t;return r.evaluate(e)-n.evaluate(e)}],[[_r],(e,t)=>{let[r]=t;return-r.evaluate(e)}]]},"/":[_r,[_r,_r],(e,t)=>{let[r,n]=t;return r.evaluate(e)/n.evaluate(e)}],"%":[_r,[_r,_r],(e,t)=>{let[r,n]=t;return r.evaluate(e)%n.evaluate(e)}],ln2:[_r,[],()=>Math.LN2],pi:[_r,[],()=>Math.PI],e:[_r,[],()=>Math.E],"^":[_r,[_r,_r],(e,t)=>{let[r,n]=t;return Math.pow(r.evaluate(e),n.evaluate(e))}],sqrt:[_r,[_r],(e,t)=>{let[r]=t;return Math.sqrt(r.evaluate(e))}],log10:[_r,[_r],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))/Math.LN10}],ln:[_r,[_r],(e,t)=>{let[r]=t;return Math.log(r.evaluate(e))}],log2:[_r,[_r],(e,t)=>{let[r]=t;return Math.log2(r.evaluate(e))}],sin:[_r,[_r],(e,t)=>{let[r]=t;return Math.sin(r.evaluate(e))}],cos:[_r,[_r],(e,t)=>{let[r]=t;return Math.cos(r.evaluate(e))}],tan:[_r,[_r],(e,t)=>{let[r]=t;return Math.tan(r.evaluate(e))}],asin:[_r,[_r],(e,t)=>{let[r]=t;return Math.asin(r.evaluate(e))}],acos:[_r,[_r],(e,t)=>{let[r]=t;return Math.acos(r.evaluate(e))}],atan:[_r,[_r],(e,t)=>{let[r]=t;return Math.atan(r.evaluate(e))}],min:[_r,ws(_r),(e,t)=>Math.min(...t.map(t=>t.evaluate(e)))],max:[_r,ws(_r),(e,t)=>Math.max(...t.map(t=>t.evaluate(e)))],abs:[_r,[_r],(e,t)=>{let[r]=t;return Math.abs(r.evaluate(e))}],round:[_r,[_r],(e,t)=>{let[r]=t;const n=r.evaluate(e);return n<0?-Math.round(-n):Math.round(n)}],floor:[_r,[_r],(e,t)=>{let[r]=t;return Math.floor(r.evaluate(e))}],ceil:[_r,[_r],(e,t)=>{let[r]=t;return Math.ceil(r.evaluate(e))}],"filter-==":[xr,[vr,jr],(e,t)=>{let[r,n]=t;return e.properties()[r.value]===n.value}],"filter-id-==":[xr,[jr],(e,t)=>{let[r]=t;return e.id()===r.value}],"filter-type-==":[xr,[vr],(e,t)=>{let[r]=t;return e.geometryType()===r.value}],"filter-<":[xr,[vr,jr],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],s=n.value;return typeof i==typeof s&&i<s}],"filter-id-<":[xr,[jr],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n<i}],"filter->":[xr,[vr,jr],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],s=n.value;return typeof i==typeof s&&i>s}],"filter-id->":[xr,[jr],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n>i}],"filter-<=":[xr,[vr,jr],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],s=n.value;return typeof i==typeof s&&i<=s}],"filter-id-<=":[xr,[jr],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n<=i}],"filter->=":[xr,[vr,jr],(e,t)=>{let[r,n]=t;const i=e.properties()[r.value],s=n.value;return typeof i==typeof s&&i>=s}],"filter-id->=":[xr,[jr],(e,t)=>{let[r]=t;const n=e.id(),i=r.value;return typeof n==typeof i&&n>=i}],"filter-has":[xr,[jr],(e,t)=>{let[r]=t;return r.value in e.properties()}],"filter-has-id":[xr,[],e=>null!==e.id()&&void 0!==e.id()],"filter-type-in":[xr,[Ar(vr)],(e,t)=>{let[r]=t;return r.value.indexOf(e.geometryType())>=0}],"filter-id-in":[xr,[Ar(jr)],(e,t)=>{let[r]=t;return r.value.indexOf(e.id())>=0}],"filter-in-small":[xr,[vr,Ar(jr)],(e,t)=>{let[r,n]=t;return n.value.indexOf(e.properties()[r.value])>=0}],"filter-in-large":[xr,[vr,Ar(jr)],(e,t)=>{let[r,n]=t;return function(e,t,r,n){for(;r<=n;){const i=r+n>>1;if(t[i]===e)return!0;t[i]>e?n=i-1:r=i+1}return!1}(e.properties()[r.value],n.value,0,n.value.length-1)}],all:{type:xr,overloads:[[[xr,xr],(e,t)=>{let[r,n]=t;return r.evaluate(e)&&n.evaluate(e)}],[ws(xr),(e,t)=>{for(const r of t)if(!r.evaluate(e))return!1;return!0}]]},any:{type:xr,overloads:[[[xr,xr],(e,t)=>{let[r,n]=t;return r.evaluate(e)||n.evaluate(e)}],[ws(xr),(e,t)=>{for(const r of t)if(r.evaluate(e))return!0;return!1}]]},"!":[xr,[xr],(e,t)=>{let[r]=t;return!r.evaluate(e)}],"is-supported-script":[xr,[vr],(e,t)=>{let[r]=t;const n=e.globals&&e.globals.isSupportedScript;return!n||n(r.evaluate(e))}],upcase:[vr,[vr],(e,t)=>{let[r]=t;return r.evaluate(e).toUpperCase()}],downcase:[vr,[vr],(e,t)=>{let[r]=t;return r.evaluate(e).toLowerCase()}],concat:[vr,ws(jr),(e,t)=>t.map(t=>Vr(t.evaluate(e))).join("")],"resolved-locale":[vr,[Sr],(e,t)=>{let[r]=t;return r.evaluate(e).resolvedLocale()}],random:[_r,[_r,_r,jr],(e,t)=>{const[r,n,i]=t.map(t=>t.evaluate(e));if(r>n)return r;if(r===n)return r;let s;if("string"==typeof i)s=function(e){let t=0;if(0===e.length)return t;for(let r=0;r<e.length;r++)t=(t<<5)-t+e.charCodeAt(r),t|=0;return t}(i);else{if("number"!=typeof i)throw new Wr("Invalid seed input: ".concat(i));s=i}return r+gs(s)()*(n-r)}]});class Bs{constructor(e,t,r,n,i){this.expression=e,this._warningHistory={},this._scope=r,this._options=n,this._iconImageUseTheme=i,this._evaluator=new nn(r,n,i),this._defaultValue=t?function(e){return"color"===e.type&&(Ps(e.default)||Array.isArray(e.default))?new lr(0,0,0,0):"color"===e.type?lr.parse(e.default)||null:void 0===e.default?null:e.default}(t):null,this._enumValues=t&&"enum"===t.type?t.values:null,this.configDependencies=js(e),this.isIndoorDependent=Ss(e)}evaluateWithoutErrorHandling(e,t,r,n,i,s,o,a){return this._evaluator.globals=e,this._evaluator.feature=t,this._evaluator.featureState=r,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null,this.expression.evaluate(this._evaluator)}evaluate(e,t,r,n,i,s,o,a,l){this._evaluator||(this._evaluator=new nn(this._scope,this._options,this._iconImageUseTheme)),this._evaluator.globals=e,this._evaluator.feature=t||null,this._evaluator.featureState=r||null,this._evaluator.canonical=n||null,this._evaluator.availableImages=i||null,this._evaluator.formattedSection=s||null,this._evaluator.featureTileCoord=o||null,this._evaluator.featureDistanceData=a||null,this._evaluator.iconImageUseTheme=l||null;try{const e=this.expression.evaluate(this._evaluator);if(null==e||"number"==typeof e&&e!=e)return this._defaultValue;if(this._enumValues&&!(e in this._enumValues))throw new Wr("Expected value to be one of ".concat(Object.keys(this._enumValues).map(e=>JSON.stringify(e)).join(", "),", but found ").concat(JSON.stringify(e)," instead."));return e}catch(e){const t=e;return this._warningHistory[t.message]||(this._warningHistory[t.message]=!0,"undefined"!=typeof console&&console.warn('Failed to evaluate expression "'.concat(JSON.stringify(this.expression.serialize()),'". ').concat(t.message))),this._defaultValue}}}function Us(e){return Array.isArray(e)&&e.length>0&&"string"==typeof e[0]&&e[0]in ys}function Vs(e,t,r,n,i){const s=new Ti(ys,[],t?function(e){const t={color:br,string:vr,number:_r,enum:vr,boolean:xr,formatted:Tr,resolvedImage:kr};return"array"===e.type?Ar(t[e.value]||jr,e.length):t[e.type]}(t):void 0,void 0,void 0,r,n,i),o=s.parse(e,void 0,void 0,void 0,t&&"string"===t.type?{typeAnnotation:"coerce"}:void 0);return o?Ts(new Bs(o,t,r,n,i)):ks(s.errors)}class qs{constructor(e,t,r,n){this.kind=e,this._styleExpression=t,this.isLightConstant=r,this.isLineProgressConstant=n,this.isStateDependent="constant"!==e&&!_i(t.expression),this.configDependencies=js(t.expression),this.isIndoorDependent=Ss(t.expression)}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s,o){return this._styleExpression.evaluate(e,t,r,n,i,s,void 0,void 0,o)}}class Ws{constructor(e,t,r,n,i,s){this.kind=e,this.zoomStops=r,this._styleExpression=t,this.isStateDependent="camera"!==e&&!_i(t.expression),this.isIndoorDependent=Ss(t.expression),this.isLightConstant=i,this.isLineProgressConstant=s,this.configDependencies=js(t.expression),this.interpolationType=n}evaluateWithoutErrorHandling(e,t,r,n,i,s){return this._styleExpression.evaluateWithoutErrorHandling(e,t,r,n,i,s)}evaluate(e,t,r,n,i,s){return this._styleExpression.evaluate(e,t,r,n,i,s)}interpolationFactor(e,t,r){return this.interpolationType?Zi.interpolationFactor(this.interpolationType,e,t,r):0}}function Hs(e,t,r,n,i){if("error"===(e=Vs(e,t,r,n,i)).result)return e;const s=e.value.expression,o=yi(s);if(!o&&!Cs(t))return ks([new fr("","data expressions not supported")]);const a=vi(s,["zoom","pitch","distance-from-center"]);if(!a&&!Ns(t))return ks([new fr("","zoom expressions not supported")]);const l=vi(s,["measure-light"]);if(!l&&!Es(t))return ks([new fr("","measure-light expression not supported")]);const c=vi(s,["line-progress"]);if(!c&&!function(e){return As(e.expression,"line-progress")}(t))return ks([new fr("","line-progress expression not supported")]);const u=t.expression&&t.expression.relaxZoomRestriction,d=Zs(s);return d||a||u?d instanceof fr?ks([d]):d instanceof Zi&&!Is(t)?ks([new fr("",'"interpolate" expressions cannot be used with this property')]):Ts(d?new Ws(o&&c?"camera":"composite",e.value,d.labels,d instanceof Zi?d.interpolation:void 0,l,c):new qs(o&&c?"constant":"source",e.value,l,c)):ks([new fr("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Gs{constructor(e,t){this._parameters=e,this._specification=t,Object.assign(this,Ls(this._parameters,this._specification))}static deserialize(e){return new Gs(e._parameters,e._specification)}static serialize(e){return{_parameters:e._parameters,_specification:e._specification}}}function Zs(e){let t=null;if(e instanceof Xi)t=Zs(e.result);else if(e instanceof Yi){for(const r of e.args)if(t=Zs(r),t)break}else(e instanceof Ci||e instanceof Zi)&&e.input instanceof sn&&"zoom"===e.input.name&&(t=e);return t instanceof fr||e.eachChild(e=>{const r=Zs(e);r instanceof fr?t=r:t&&r&&t!==r&&(t=new fr("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var Ks,Ys,Xs=function(){if(Ys)return Ks;Ys=1,Ks=t;var e=3;function t(t,r,n){var i=this.cells=[];if(t instanceof ArrayBuffer){this.arrayBuffer=t;var s=new Int32Array(this.arrayBuffer);t=s[0],this.d=(r=s[1])+2*(n=s[2]);for(var o=0;o<this.d*this.d;o++){var a=s[e+o],l=s[e+o+1];i.push(a===l?null:s.subarray(a,l))}var c=s[e+i.length+1];this.keys=s.subarray(s[e+i.length],c),this.bboxes=s.subarray(c),this.insert=this._insertReadonly}else{this.d=r+2*n;for(var u=0;u<this.d*this.d;u++)i.push([]);this.keys=[],this.bboxes=[]}this.n=r,this.extent=t,this.padding=n,this.scale=r/t,this.uid=0;var d=n/r*t;this.min=-d,this.max=t+d}return t.prototype.insert=function(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertCell,this.uid++),this.keys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(e,t,r,n,i,s){this.cells[i].push(s)},t.prototype.query=function(e,t,r,n,i){var s=this.min,o=this.max;if(e<=s&&t<=s&&o<=r&&o<=n&&!i)return Array.prototype.slice.call(this.keys);var a=[];return this._forEachCell(e,t,r,n,this._queryCell,a,{},i),a},t.prototype._queryCell=function(e,t,r,n,i,s,o,a){var l=this.cells[i];if(null!==l)for(var c=this.keys,u=this.bboxes,d=0;d<l.length;d++){var h=l[d];if(void 0===o[h]){var p=4*h;(a?a(u[p+0],u[p+1],u[p+2],u[p+3]):e<=u[p+2]&&t<=u[p+3]&&r>=u[p+0]&&n>=u[p+1])?(o[h]=!0,s.push(c[h])):o[h]=!1}}},t.prototype._forEachCell=function(e,t,r,n,i,s,o,a){for(var l=this._convertToCellCoord(e),c=this._convertToCellCoord(t),u=this._convertToCellCoord(r),d=this._convertToCellCoord(n),h=l;h<=u;h++)for(var p=c;p<=d;p++){var m=this.d*p+h;if((!a||a(this._convertFromCellCoord(h),this._convertFromCellCoord(p),this._convertFromCellCoord(h+1),this._convertFromCellCoord(p+1)))&&i.call(this,e,t,r,n,m,s,o,a))return}},t.prototype._convertFromCellCoord=function(e){return(e-this.padding)/this.scale},t.prototype._convertToCellCoord=function(e){return Math.max(0,Math.min(this.d-1,Math.floor(e*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var t=this.cells,r=e+this.cells.length+1+1,n=0,i=0;i<this.cells.length;i++)n+=this.cells[i].length;var s=new Int32Array(r+n+this.keys.length+this.bboxes.length);s[0]=this.extent,s[1]=this.n,s[2]=this.padding;for(var o=r,a=0;a<t.length;a++){var l=t[a];s[e+a]=o,s.set(l,o),o+=l.length}return s[e+t.length]=o,s.set(this.keys,o),s[e+t.length+1]=o+=this.keys.length,s.set(this.bboxes,o),o+=this.bboxes.length,s.buffer},Ks}(),Js=be(Xs);const Qs={};function $s(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};Object.defineProperty(e,"_classRegistryKey",{value:t,writable:!1}),Qs[t]={klass:e,omit:r.omit||[]}}$s(Object,"Object"),Js.serialize=function(e,t){const r=e.toArrayBuffer();return t&&t.add(r),{buffer:r}},Js.deserialize=function(e){return new Js(e.buffer)},Object.defineProperty(Js,"name",{value:"Grid"}),$s(Js,"Grid"),delete Se.prototype.constructor,$s(lr,"Color"),$s(Error,"Error"),$s(Dr,"Formatted"),$s(Rr,"FormattedSection"),$s(Dt,"AJAXError"),$s(Or,"ResolvedImage"),$s(Gs,"StylePropertyFunction"),$s(Bs,"StyleExpression",{omit:["_evaluator"]}),$s(ir,"ImageId"),$s(Fr,"ImageVariant"),$s(Ws,"ZoomDependentExpression"),$s(qs,"ZoomConstantExpression"),$s(sn,"CompoundExpression",{omit:["_evaluate"]});for(const iw in ys)Qs[ys[iw]._classRegistryKey]||$s(ys[iw],"Expression".concat(iw));function eo(e){return e&&(e instanceof ArrayBuffer||e.constructor&&"ArrayBuffer"===e.constructor.name)}function to(e,t){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp)return e;if(eo(e)||e instanceof ImageBitmap)return t&&t.add(e),e;if(ArrayBuffer.isView(e))return t&&t.add(e.buffer),e;if(e instanceof ImageData)return t&&t.add(e.data.buffer),e;if(Array.isArray(e)){const r=[];for(const n of e)r.push(to(n,t));return r}if(e instanceof Map){const r={$name:"Map",entries:[]};for(const[n,i]of e.entries())r.entries.push(to(n),to(i,t));return r}if(e instanceof Set){const t={$name:"Set"};let r=0;for(const n of e.values())t[++r]=to(n);return t}if("bigint"==typeof e)return{$name:"BigInt",value:e.toString()};if("object"==typeof e){const r=e.constructor,n=r._classRegistryKey;if(!n)throw new Error("Can't serialize object of unregistered class \"".concat(r.name,'".'));const i=r.serialize?r.serialize(e,t):{};if(!r.serialize){for(const r in e)e.hasOwnProperty(r)&&(Qs[n].omit.indexOf(r)>=0||(i[r]=to(e[r],t)));e instanceof Error&&(i.message=e.message)}if(i.$name)throw new Error("$name property is reserved for worker serialization logic.");return"Object"!==n&&(i.$name=n),i}throw new Error("can't serialize object of type "+typeof e)}function ro(e){if(null==e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||e instanceof Boolean||e instanceof Number||e instanceof String||e instanceof Date||e instanceof RegExp||eo(e)||e instanceof ImageBitmap||ArrayBuffer.isView(e)||e instanceof ImageData)return e;if(Array.isArray(e))return e.map(ro);if("object"==typeof e){const t=e.$name||"Object";if("Map"===t){const t=e.entries||[],r=new Map;for(let e=0;e<t.length;e+=2)r.set(ro(t[e]),ro(t[e+1]));return r}if("Set"===t){const t=new Set;for(const r of Object.keys(e))"$name"!==r&&t.add(ro(e[r]));return t}if("BigInt"===t)return BigInt(e.value);const{klass:r}=Qs[t];if(!r)throw new Error("Can't deserialize unregistered class \"".concat(t,'".'));if(r.deserialize)return r.deserialize(e);const n=Object.create(r.prototype);for(const i of Object.keys(e))"$name"!==i&&(n[i]=ro(e[i]));return n}throw new Error("can't deserialize object of type "+typeof e)}const no={"Latin-1 Supplement":e=>e>=128&&e<=255,Arabic:e=>e>=1536&&e<=1791,"Arabic Supplement":e=>e>=1872&&e<=1919,"Arabic Extended-A":e=>e>=2208&&e<=2303,"Hangul Jamo":e=>e>=4352&&e<=4607,"Unified Canadian Aboriginal Syllabics":e=>e>=5120&&e<=5759,Khmer:e=>e>=6016&&e<=6143,"Unified Canadian Aboriginal Syllabics Extended":e=>e>=6320&&e<=6399,"General Punctuation":e=>e>=8192&&e<=8303,"Letterlike Symbols":e=>e>=8448&&e<=8527,"Number Forms":e=>e>=8528&&e<=8591,"Miscellaneous Technical":e=>e>=8960&&e<=9215,"Control Pictures":e=>e>=9216&&e<=9279,"Optical Character Recognition":e=>e>=9280&&e<=9311,"Enclosed Alphanumerics":e=>e>=9312&&e<=9471,"Geometric Shapes":e=>e>=9632&&e<=9727,"Miscellaneous Symbols":e=>e>=9728&&e<=9983,"Miscellaneous Symbols and Arrows":e=>e>=11008&&e<=11263,"CJK Radicals Supplement":e=>e>=11904&&e<=12031,"Kangxi Radicals":e=>e>=12032&&e<=12255,"Ideographic Description Characters":e=>e>=12272&&e<=12287,"CJK Symbols and Punctuation":e=>e>=12288&&e<=12351,Hiragana:e=>e>=12352&&e<=12447,Katakana:e=>e>=12448&&e<=12543,Bopomofo:e=>e>=12544&&e<=12591,"Hangul Compatibility Jamo":e=>e>=12592&&e<=12687,Kanbun:e=>e>=12688&&e<=12703,"Bopomofo Extended":e=>e>=12704&&e<=12735,"CJK Strokes":e=>e>=12736&&e<=12783,"Katakana Phonetic Extensions":e=>e>=12784&&e<=12799,"Enclosed CJK Letters and Months":e=>e>=12800&&e<=13055,"CJK Compatibility":e=>e>=13056&&e<=13311,"CJK Unified Ideographs Extension A":e=>e>=13312&&e<=19903,"Yijing Hexagram Symbols":e=>e>=19904&&e<=19967,"CJK Unified Ideographs":e=>e>=19968&&e<=40959,"Yi Syllables":e=>e>=40960&&e<=42127,"Yi Radicals":e=>e>=42128&&e<=42191,"Hangul Jamo Extended-A":e=>e>=43360&&e<=43391,"Hangul Syllables":e=>e>=44032&&e<=55215,"Hangul Jamo Extended-B":e=>e>=55216&&e<=55295,"Private Use Area":e=>e>=57344&&e<=63743,"CJK Compatibility Ideographs":e=>e>=63744&&e<=64255,"Arabic Presentation Forms-A":e=>e>=64336&&e<=65023,"Vertical Forms":e=>e>=65040&&e<=65055,"CJK Compatibility Forms":e=>e>=65072&&e<=65103,"Small Form Variants":e=>e>=65104&&e<=65135,"Arabic Presentation Forms-B":e=>e>=65136&&e<=65279,"Halfwidth and Fullwidth Forms":e=>e>=65280&&e<=65519,Osage:e=>e>=66736&&e<=66815,"CJK Unified Ideographs Extension B":e=>e>=131072&&e<=173791};function io(e){for(const t of e)if(ao(t.charCodeAt(0)))return!0;return!1}function so(e){for(const t of e)if(!oo(t.charCodeAt(0)))return!1;return!0}function oo(e){return!(no.Arabic(e)||no["Arabic Supplement"](e)||no["Arabic Extended-A"](e)||no["Arabic Presentation Forms-A"](e)||no["Arabic Presentation Forms-B"](e))}function ao(e){return!(746!==e&&747!==e&&(e<4352||!(no["Bopomofo Extended"](e)||no.Bopomofo(e)||no["CJK Compatibility Forms"](e)&&!(e>=65097&&e<=65103)||no["CJK Compatibility Ideographs"](e)||no["CJK Compatibility"](e)||no["CJK Radicals Supplement"](e)||no["CJK Strokes"](e)||!(!no["CJK Symbols and Punctuation"](e)||e>=12296&&e<=12305||e>=12308&&e<=12319||12336===e)||no["CJK Unified Ideographs Extension A"](e)||no["CJK Unified Ideographs"](e)||no["Enclosed CJK Letters and Months"](e)||no["Hangul Compatibility Jamo"](e)||no["Hangul Jamo Extended-A"](e)||no["Hangul Jamo Extended-B"](e)||no["Hangul Jamo"](e)||no["Hangul Syllables"](e)||no.Hiragana(e)||no["Ideographic Description Characters"](e)||no.Kanbun(e)||no["Kangxi Radicals"](e)||no["Katakana Phonetic Extensions"](e)||no.Katakana(e)&&12540!==e||!(!no["Halfwidth and Fullwidth Forms"](e)||65288===e||65289===e||65293===e||e>=65306&&e<=65310||65339===e||65341===e||65343===e||e>=65371&&e<=65503||65507===e||e>=65512&&e<=65519)||!(!no["Small Form Variants"](e)||e>=65112&&e<=65118||e>=65123&&e<=65126)||no["Unified Canadian Aboriginal Syllabics"](e)||no["Unified Canadian Aboriginal Syllabics Extended"](e)||no["Vertical Forms"](e)||no["Yijing Hexagram Symbols"](e)||no["Yi Syllables"](e)||no["Yi Radicals"](e))))}function lo(e){return!(ao(e)||function(e){return!!(no["Latin-1 Supplement"](e)&&(167===e||169===e||174===e||177===e||188===e||189===e||190===e||215===e||247===e)||no["General Punctuation"](e)&&(8214===e||8224===e||8225===e||8240===e||8241===e||8251===e||8252===e||8258===e||8263===e||8264===e||8265===e||8273===e)||no["Letterlike Symbols"](e)||no["Number Forms"](e)||no["Miscellaneous Technical"](e)&&(e>=8960&&e<=8967||e>=8972&&e<=8991||e>=8996&&e<=9e3||9003===e||e>=9085&&e<=9114||e>=9150&&e<=9165||9167===e||e>=9169&&e<=9179||e>=9186&&e<=9215)||no["Control Pictures"](e)&&9251!==e||no["Optical Character Recognition"](e)||no["Enclosed Alphanumerics"](e)||no["Geometric Shapes"](e)||no["Miscellaneous Symbols"](e)&&!(e>=9754&&e<=9759)||no["Miscellaneous Symbols and Arrows"](e)&&(e>=11026&&e<=11055||e>=11088&&e<=11097||e>=11192&&e<=11243)||no["CJK Symbols and Punctuation"](e)||no.Katakana(e)||no["Private Use Area"](e)||no["CJK Compatibility Forms"](e)||no["Small Form Variants"](e)||no["Halfwidth and Fullwidth Forms"](e)||8734===e||8756===e||8757===e||e>=9984&&e<=10087||e>=10102&&e<=10131||65532===e||65533===e)}(e))}function co(e){return no.Arabic(e)||no["Arabic Supplement"](e)||no["Arabic Extended-A"](e)||no["Arabic Presentation Forms-A"](e)||no["Arabic Presentation Forms-B"](e)}function uo(e){return e>=1424&&e<=2303||no["Arabic Presentation Forms-A"](e)||no["Arabic Presentation Forms-B"](e)}function ho(e,t){return!(!t&&uo(e)||e>=2304&&e<=3583||e>=3840&&e<=4255||no.Khmer(e))}function po(e){for(const t of e)if(uo(t.charCodeAt(0)))return!0;return!1}const mo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let fo=null,go=mo.unavailable,yo=null;const _o=function(e){e&&"string"==typeof e&&e.indexOf("NetworkError")>-1&&(go=mo.error),fo&&fo(e)};function vo(){xo.fire(new $t("pluginStateChange",{pluginStatus:go,pluginURL:yo}))}const xo=new nr,bo=function(){return go},wo=function(){if(go!==mo.deferred||!yo)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");go=mo.loading,vo(),yo&&zt({url:yo},e=>{e?_o(e):(go=mo.loaded,vo())})},jo={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>go===mo.loaded||null!=jo.applyArabicShaping,isLoading:()=>go===mo.loading,setState(e){go=e.pluginStatus,yo=e.pluginURL},isParsing:()=>go===mo.parsing,isParsed:()=>go===mo.parsed,getPluginURL:()=>yo};class So{constructor(e,t){this.zoom=e,t?(this.now=t.now,this.fadeDuration=t.fadeDuration,this.transition=t.transition,this.pitch=t.pitch,this.brightness=t.brightness,this.worldview=t.worldview,this.activeFloors=t.activeFloors):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(e){return function(e,t){for(const r of e)if(!ho(r.charCodeAt(0),t))return!1;return!0}(e,jo.isLoaded())}}class To{constructor(e,t,r,n,i){this.property=e,this.value=t,this.expression=function(e,t,r,n,i){if(Ps(e))return new Gs(e,t);if(Us(e)||Array.isArray(e)&&e.length>0){const s=Hs(e,t,r,n,i);if("error"===s.result)throw new Error(s.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));return s.value}{let r=e;return"string"==typeof e&&"color"===t.type&&(r=lr.parse(e)),{kind:"constant",configDependencies:new Set,isIndoorDependent:!1,evaluate:()=>r}}}(void 0===t?e.specification.default:t,e.specification,r,n,i)}isIndoorDependent(){return this.expression.isIndoorDependent}isDataDriven(){return"source"===this.expression.kind||"composite"===this.expression.kind}possiblyEvaluate(e,t,r,n){return this.property.possiblyEvaluate(this,e,t,r,n)}}class ko{constructor(e,t,r,n){this.property=e,this.value=new To(e,void 0,t,r,n)}transitioned(e,t){return new Co(this.property,this.value,t,Object.assign({},e.transition,this.transition),e.now)}untransitioned(){return new Co(this.property,this.value,null,{},0)}}class Ao{constructor(e,t,r,n){this._properties=e,this._values=Object.create(e.defaultTransitionablePropertyValues),this._scope=t,this._options=r,this._iconImageUseTheme=n,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return We(this._values[e].value.value)}setValue(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ko(this._values[e].property,this._scope,this._options,this._iconImageUseTheme)),this._values[e].value=new To(this._values[e].property,null===t?void 0:We(t),this._scope,this._options,this._iconImageUseTheme),this._values[e].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].value.expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].value.isIndoorDependent())}setTransitionOrValue(e,t){t&&(this._options=t);const r=this._properties.properties;if(e)for(const n in e){const t=e[n];if(n.endsWith("-transition")){const e=n.slice(0,-11);r[e]&&this.setTransition(e,t)}else r.hasOwnProperty(n)&&this.setValue(n,t)}}getTransition(e){return We(this._values[e].transition)}setTransition(e,t){this._values.hasOwnProperty(e)||(this._values[e]=new ko(this._values[e].property)),this._values[e].transition=We(t)||void 0}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r);const n=this.getTransition(t);void 0!==n&&(e["".concat(t,"-transition")]=n)}return e}transitioned(e,t){const r=new Eo(this._properties);for(const n of Object.keys(this._values))r._values[n]=this._values[n].transitioned(e,t._values[n]);return r}untransitioned(){const e=new Eo(this._properties);for(const t of Object.keys(this._values))e._values[t]=this._values[t].untransitioned();return e}isIndoorDependent(){return this._isIndoorDependent}}class Co{constructor(e,t,r,n,i){const s=n.delay||0,o=n.duration||0;i=i||0,this.property=e,this.value=t,this.begin=i+s,this.end=this.begin+o,e.specification.transition&&(n.delay||n.duration)&&(this.prior=r)}possiblyEvaluate(e,t,r){const n=e.now||0,i=this.value.possiblyEvaluate(e,t,r),s=this.prior;if(s){if(n>this.end)return this.prior=null,i;if(this.value.isDataDriven())return this.prior=null,i;if(n<this.begin)return s.possiblyEvaluate(e,t,r);{const o=(n-this.begin)/(this.end-this.begin);return this.property.interpolate(s.possiblyEvaluate(e,t,r),i,Ie(o))}}return i}}class Eo{constructor(e){this._properties=e,this._values=Object.create(e.defaultTransitioningPropertyValues)}possiblyEvaluate(e,t,r){const n=new Po(this._properties);for(const i of Object.keys(this._values))n._values[i]=this._values[i].possiblyEvaluate(e,t,r);return n}hasTransition(){for(const e of Object.keys(this._values))if(this._values[e].prior)return!0;return!1}}class No{constructor(e,t,r,n){this._properties=e,this._values=Object.create(e.defaultPropertyValues),this._scope=t,this._options=r,this._iconImageUseTheme=n,this._isIndoorDependent=!1,this.configDependencies=new Set}getValue(e){return We(this._values[e].value)}setValue(e,t){this._values[e]=new To(this._values[e].property,null===t?void 0:We(t),this._scope,this._options,this._iconImageUseTheme),this._values[e].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[e].expression.configDependencies]),this._isIndoorDependent=this._isIndoorDependent||this._values[e].isIndoorDependent())}serialize(){const e={};for(const t of Object.keys(this._values)){const r=this.getValue(t);void 0!==r&&(e[t]=r)}return e}possiblyEvaluate(e,t,r,n){const i=new Po(this._properties);for(const s of Object.keys(this._values))i._values[s]=this._values[s].possiblyEvaluate(e,t,r,n);return i}isIndoorDependent(){return this._isIndoorDependent}}class Io{constructor(e,t,r,n){this.property=e,this.value=t,this.parameters=r,this.iconImageUseTheme=n}isConstant(){return"constant"===this.value.kind}constantOr(e){return"constant"===this.value.kind?this.value.value:e}evaluate(e,t,r,n){return this.property.evaluate(this.value,this.parameters,e,t,r,n,this.iconImageUseTheme)}}class Po{constructor(e){this._properties=e,this._values=Object.create(e.defaultPossiblyEvaluatedValues)}get(e){return this._values[e]}}class Mo{constructor(e){this.specification=e}possiblyEvaluate(e,t){return e.expression.evaluate(t)}interpolate(e,t,r){const n=mr[this.specification.type];return n?n(e,t,r):e}}class Lo{constructor(e,t){this.specification=e,this.overrides=t}possiblyEvaluate(e,t,r,n,i){return"constant"===e.expression.kind||"camera"===e.expression.kind?new Io(this,{kind:"constant",value:e.expression.evaluate(t,null,{},r,n,void 0,i)},t):new Io(this,e.expression,t,i)}interpolate(e,t,r){if("constant"!==e.value.kind||"constant"!==t.value.kind)return e;if(void 0===e.value.value||void 0===t.value.value)return new Io(this,{kind:"constant",value:void 0},e.parameters);const n=mr[this.specification.type];return n?new Io(this,{kind:"constant",value:n(e.value.value,t.value.value,r)},e.parameters):e}evaluate(e,t,r,n,i,s,o){return"constant"===e.kind?e.value:e.evaluate(t,r,n,i,s,void 0,o)}}class Ro{constructor(e){this.specification=e}possiblyEvaluate(e,t,r,n){return!!e.expression.evaluate(t,null,{},r,n)}interpolate(){return!1}}class Do{constructor(e){this.properties=e,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const t=new So(0,{});for(const r in e){const n=e[r];n.specification.overridable&&this.overridableProperties.push(r);const i=this.defaultPropertyValues[r]=new To(n,void 0),s=this.defaultTransitionablePropertyValues[r]=new ko(n);this.defaultTransitioningPropertyValues[r]=s.untransitioned(),this.defaultPossiblyEvaluatedValues[r]=i.possiblyEvaluate(t)}}}$s(Lo,"DataDrivenProperty"),$s(Mo,"DataConstantProperty"),$s(Ro,"ColorRampProperty");var Fo=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"interpolated":true,"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":[0.1,0.1],"maximum":[10,10],"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor_source":{"sourceId":{"type":"string"},"sourceLayers":{"type":"array","value":"string"}},"indoor":{"*":{"type":"indoor_source"}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]},"property-type":"data-driven"},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function Oo(e){return e instanceof Number||e instanceof String||e instanceof Boolean?e.valueOf():e}function zo(e){if(Array.isArray(e))return e.map(zo);if(e instanceof Object&&!(e instanceof Number||e instanceof String||e instanceof Boolean)){const t={};for(const r in e)t[r]=zo(e[r]);return t}return Oo(e)}function Bo(e){if(!0===e||!1===e)return!0;if(!Array.isArray(e)||0===e.length)return!1;switch(e[0]){case"has":return e.length>=2&&"$id"!==e[1]&&"$type"!==e[1];case"in":return e.length>=3&&("string"!=typeof e[1]||Array.isArray(e[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return 3!==e.length||Array.isArray(e[1])||Array.isArray(e[2]);case"any":case"all":for(const t of e.slice(1))if(!Bo(t)&&"boolean"!=typeof t)return!1;return!0;default:return!0}}function Uo(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"",r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"fill";if(null==e)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Bo(e)||(e=Ko(e));const i=e;let s=!0;try{s=function(e){if(!Wo(e))return e;let t=zo(e);return qo(t),t=Vo(t),t}(i)}catch(e){console.warn("Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.\nThis is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md\nand paste the contents of this message in the report.\nThank you!\nFilter Expression:\n".concat(JSON.stringify(i,null,2),"\n        "))}let o=null,a=null;if("background"!==n&&"sky"!==n&&"slot"!==n){a=Fo["filter_".concat(n)];const e=Vs(s,a,t,r);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));o=(t,r,n)=>e.value.evaluate(t,r,{},n)}let l=null,c=null;if(s!==i){const e=Vs(i,a,t,r);if("error"===e.result)throw new Error(e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));l=(t,r,n,i,s)=>e.value.evaluate(t,r,{},n,void 0,void 0,i,s),c=!yi(e.value.expression)}return{filter:o,dynamicFilter:l||void 0,needGeometry:Zo(s),needFeature:!!c}}function Vo(e){if(!Array.isArray(e))return e;const t=function(e){if(Ho.has(e[0]))for(let t=1;t<e.length;t++)if(Wo(e[t]))return!0;return e}(e);return!0===t?t:t.map(e=>Vo(e))}function qo(e){let t=!1;const r=[];if("case"===e[0]){for(let n=1;n<e.length-1;n+=2)t=t||Wo(e[n]),r.push(e[n+1]);r.push(e[e.length-1])}else if("match"===e[0]){t=t||Wo(e[1]);for(let t=2;t<e.length-1;t+=2)r.push(e[t+1]);r.push(e[e.length-1])}else if("step"===e[0]){t=t||Wo(e[1]);for(let t=1;t<e.length-1;t+=2)r.push(e[t+1])}t&&(e.length=0,e.push("any",...r));for(let n=1;n<e.length;n++)qo(e[n])}function Wo(e){if(!Array.isArray(e))return!1;if("pitch"===(t=e[0])||"distance-from-center"===t)return!0;var t;for(let r=1;r<e.length;r++)if(Wo(e[r]))return!0;return!1}const Ho=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Go(e,t){return e<t?-1:e>t?1:0}function Zo(e){if(!Array.isArray(e))return!1;if("within"===e[0]||"distance"===e[0])return!0;for(let t=1;t<e.length;t++)if(Zo(e[t]))return!0;return!1}function Ko(e){if(!e)return!0;const t=e[0];return e.length<=1?"any"!==t:"=="===t?Yo(e[1],e[2],"=="):"!="===t?Qo(Yo(e[1],e[2],"==")):"<"===t||">"===t||"<="===t||">="===t?Yo(e[1],e[2],t):"any"===t?(r=e.slice(1),["any"].concat(r.map(Ko))):"all"===t?["all"].concat(e.slice(1).map(Ko)):"none"===t?["all"].concat(e.slice(1).map(Ko).map(Qo)):"in"===t?Xo(e[1],e.slice(2)):"!in"===t?Qo(Xo(e[1],e.slice(2))):"has"===t?Jo(e[1]):"!has"!==t||Qo(Jo(e[1]));var r}function Yo(e,t,r){switch(e){case"$type":return["filter-type-".concat(r),t];case"$id":return["filter-id-".concat(r),t];default:return["filter-".concat(r),e,t]}}function Xo(e,t){if(0===t.length)return!1;switch(e){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(e=>typeof e!=typeof t[0])?["filter-in-large",e,["literal",t.sort(Go)]]:["filter-in-small",e,["literal",t]]}}function Jo(e){switch(e){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",e]}}function Qo(e){return["!",e]}const $o="\x1f";function ea(e,t){return t?"".concat(e).concat($o).concat(t):e}let ta;const ra=()=>ta||(ta=new Do({"icon-size":new Lo(Fo.layout_symbol["icon-size"]),"icon-image":new Lo(Fo.layout_symbol["icon-image"]),"icon-rotate":new Lo(Fo.layout_symbol["icon-rotate"]),"icon-offset":new Lo(Fo.layout_symbol["icon-offset"]),"text-size":new Lo(Fo.layout_symbol["text-size"]),"text-rotate":new Lo(Fo.layout_symbol["text-rotate"]),"text-offset":new Lo(Fo.layout_symbol["text-offset"])}));class na{constructor(e,t,r,n,i,s){const o=Vs(e,Fo.appearance.condition);if("success"===o.result&&(this.condition=o.value),this.name=t,r){this.properties=new Po(ra()),this.unevaluatedLayout=new No(ra(),n,i,s);for(const e in r)this.unevaluatedLayout.setValue(e,r[e])}}isActive(e){return!(this.condition||!e.isHidden||"hidden"!==this.name)||this.condition.evaluate(e.globals,e.feature,e.featureState,e.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(e){return this.properties.get(e)}getUnevaluatedProperties(){return this.unevaluatedLayout}getUnevaluatedProperty(e){return this.unevaluatedLayout._values[e]}recalculate(e,t,r){this.unevaluatedLayout&&(this.properties=this.unevaluatedLayout.possiblyEvaluate(e,void 0,t,r))}serialize(){const e={};return e.condition=this.condition.expression.serialize(),this.name&&(e.name=this.name),this.unevaluatedLayout&&(e.properties=this.unevaluatedLayout.serialize()),e}hasIconProperties(){const e=this.hasProperty("icon-image"),t=this.hasProperty("icon-size"),r=this.hasProperty("icon-offset"),n=this.hasProperty("icon-rotate");return e||t||r||n}hasTextProperties(){const e=this.hasProperty("text-size"),t=this.hasProperty("text-offset"),r=this.hasProperty("text-rotate");return e||t||r}hasProperty(e){return void 0!==this.getUnevaluatedProperty(e).value}}const ia="-transition",sa=new Set(["fill","line","background","hillshade","raster"]);class oa extends nr{constructor(e,t,r,n,i,s){if(super(),this.id=e.id,this.fqid=ea(this.id,r),this.type=e.type,this.scope=r,this.lut=n,this.options=i,this.iconImageUseTheme=s,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.expressionDependencies={isIndoorDependent:!1,configDependencies:new Set},"custom"!==e.type){if(this.metadata=e.metadata,this.minzoom=e.minzoom,this.maxzoom=e.maxzoom,e.type&&"background"!==e.type&&"sky"!==e.type&&"slot"!==e.type){this.source=e.source,this.sourceLayer=e["source-layer"],this.filter=e.filter;const t=Vs(this.filter,Fo["filter_".concat(e.type)]);"error"!==t.result&&(this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...t.value.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||t.value.isIndoorDependent)}if(e.slot&&(this.slot=e.slot),e.appearances&&this.setAppearances(e.appearances),t.layout&&(this._unevaluatedLayout=new No(t.layout,this.scope,i,this.iconImageUseTheme),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._unevaluatedLayout.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._unevaluatedLayout.isIndoorDependent()),t.paint){this._transitionablePaint=new Ao(t.paint,this.scope,i);for(const t in e.paint)this.setPaintProperty(t,e.paint[t]);for(const t in e.layout)this.setLayoutProperty(t,e.layout[t]);this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...this._transitionablePaint.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||this._transitionablePaint.isIndoorDependent(),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Po(t.paint)}}}onAdd(e){}onRemove(e){}isDraped(e){return!this.is3D(!0)&&sa.has(this.type)}getLayoutProperty(e){return"visibility"===e?this.visibility:this._unevaluatedLayout.getValue(e)}setLayoutProperty(e,t){if("custom"===this.type&&"visibility"===e)return void(this.visibility=t);const r=this._unevaluatedLayout;r._properties.properties[e]&&(r.setValue(e,t),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...r.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||r.isIndoorDependent(),"visibility"===e&&this.possiblyEvaluateVisibility())}setAppearances(e){this.appearances=[],e.forEach(e=>{this.appearances.push(new na(e.condition,e.name,e.properties,this.scope,this.options,this.iconImageUseTheme))})}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(e){return e.endsWith(ia)?this._transitionablePaint.getTransition(e.slice(0,-11)):this._transitionablePaint.getValue(e)}isPaintProperty(e){return!!this._transitionablePaint._properties.properties[e]}setPaintProperty(e,t){const r=this._transitionablePaint,n=r._properties.properties;if(e.endsWith(ia)){const i=e.slice(0,-11);return n[i]&&r.setTransition(i,t||void 0),!1}if(!n[e])return!1;const i=r._values[e],s=i.value.isDataDriven(),o=i.value;r.setValue(e,t),this.expressionDependencies.configDependencies=new Set([...this.expressionDependencies.configDependencies,...r.configDependencies]),this.expressionDependencies.isIndoorDependent=this.expressionDependencies.isIndoorDependent||r.isIndoorDependent(),this._handleSpecialPaintPropertyUpdate(e);const a=r._values[e].value,l=a.isDataDriven(),c=e.endsWith("pattern")||"line-dasharray"===e;return l||s||c||this._handleOverridablePaintPropertyUpdate(e,o,a)}_handleSpecialPaintPropertyUpdate(e){}getProgramIds(){return null}getDefaultProgramParams(e,t,r){return null}_handleOverridablePaintPropertyUpdate(e,t,r){return!1}isHidden(e){return!!(this.minzoom&&e<this.minzoom)||!!(this.maxzoom&&e>=this.maxzoom)||"none"===this.visibility}updateTransitions(e){this._transitioningPaint=this._transitionablePaint.transitioned(e,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(e,t){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(e,void 0,t,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(e,void 0,t)}serialize(){const e={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return 0!==this.appearances.length&&(e.appearances=this.appearances.map(e=>e.serialize())),qe(e,(e,t)=>!(void 0===e||"layout"===t&&!Object.keys(e).length||"paint"===t&&!Object.keys(e).length))}is3D(e){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const e in this.paint._values){const t=this.paint.get(e);if(t instanceof Io&&Cs(t.property.specification)&&("source"===t.value.kind||"composite"===t.value.kind)&&t.value.isStateDependent)return!0}for(const e of this.appearances)if(!_i(e.condition.expression))return!0;return!1}compileFilter(e){this._filterCompiled||(this._featureFilter=Uo(this.filter,this.scope,e),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(e){this._stats&&("shadow"===e.renderPass?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRenderedFeatures(e,t,r){return{}}queryRadius(e){}queryIntersectsFeature(e,t,r,n,i,s,o,a,l){}}const aa={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class la{constructor(e,t){this._structArray=e,this._pos1=t*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}const ca=new ArrayBuffer(0);class ua{constructor(){this._reallocCount=0,this.capacity=0,this.length=0}static serialize(e,t){return e._trim(),t&&e.arrayBuffer&&t.add(e.arrayBuffer),{length:e.length,arrayBuffer:e.arrayBuffer}}static deserialize(e){const t=Object.create(this.prototype);return t.arrayBuffer=e.arrayBuffer,t.length=e.length,e.arrayBuffer?t.capacity=e.arrayBuffer.byteLength/t.bytesPerElement:(t.capacity=0,t.arrayBuffer=ca),t._refreshViews(),t}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(e){this.reserve(e),this.length=e}reserve(e){if(e>this.capacity){this._reallocCount++,this.capacity=Math.max(e,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const t=this.uint8;this._refreshViews(),t&&this.uint8.set(t)}}reserveForAdditional(e){this.reserve(this.length+e)}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function da(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=0,n=0;return{members:e.map(e=>{const i=aa[e.type].BYTES_PER_ELEMENT,s=r=ha(r,Math.max(t,i)),o=e.components||1;return n=Math.max(n,i),r+=i*o,{name:e.name,type:e.type,components:o,offset:s}}),size:ha(r,Math.max(n,t)),alignment:t}}function ha(e,t){return Math.ceil(e/t)*t}class pa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.int16[n+0]=t,this.int16[n+1]=r,e}}pa.prototype.bytesPerElement=4,$s(pa,"StructArrayLayout2i4");class ma extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}ma.prototype.bytesPerElement=6,$s(ma,"StructArrayLayout3i6");class fa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.int16[s+0]=t,this.int16[s+1]=r,this.int16[s+2]=n,this.int16[s+3]=i,e}}fa.prototype.bytesPerElement=8,$s(fa,"StructArrayLayout4i8");class ga extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.float32[1*e+0]=t,e}}ga.prototype.bytesPerElement=4,$s(ga,"StructArrayLayout1f4");class ya extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=4*e,s=2*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.float32[s+1]=n,e}}ya.prototype.bytesPerElement=8,$s(ya,"StructArrayLayout2i1f8");class _a extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=4*e;return this.int16[i+0]=t,this.int16[i+1]=r,this.int16[i+2]=n,e}}_a.prototype.bytesPerElement=8,$s(_a,"StructArrayLayout3i8");class va extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const o=5*e;return this.int16[o+0]=t,this.int16[o+1]=r,this.int16[o+2]=n,this.int16[o+3]=i,this.int16[o+4]=s,e}}va.prototype.bytesPerElement=10,$s(va,"StructArrayLayout5i10");class xa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=6*e,c=12*e,u=3*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.uint8[c+4]=n,this.uint8[c+5]=i,this.uint8[c+6]=s,this.uint8[c+7]=o,this.float32[u+2]=a,e}}xa.prototype.bytesPerElement=12,$s(xa,"StructArrayLayout2i4ub1f12");class ba extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.float32[i+0]=t,this.float32[i+1]=r,this.float32[i+2]=n,e}}ba.prototype.bytesPerElement=12,$s(ba,"StructArrayLayout3f12");class wa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const o=6*e,a=3*e;return this.uint16[o+0]=t,this.uint16[o+1]=r,this.uint16[o+2]=n,this.uint16[o+3]=i,this.float32[a+2]=s,e}}wa.prototype.bytesPerElement=12,$s(wa,"StructArrayLayout4ui1f12");class ja extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.uint16[s+0]=t,this.uint16[s+1]=r,this.uint16[s+2]=n,this.uint16[s+3]=i,e}}ja.prototype.bytesPerElement=8,$s(ja,"StructArrayLayout4ui8");class Sa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,o){const a=6*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.int16[a+3]=i,this.int16[a+4]=s,this.int16[a+5]=o,e}}Sa.prototype.bytesPerElement=12,$s(Sa,"StructArrayLayout6i12");class Ta extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,c,u,d){const h=this.length;return this.resize(h+1),this.emplace(h,e,t,r,n,i,s,o,a,l,c,u,d)}emplace(e,t,r,n,i,s,o,a,l,c,u,d,h){const p=12*e;return this.int16[p+0]=t,this.int16[p+1]=r,this.int16[p+2]=n,this.int16[p+3]=i,this.uint16[p+4]=s,this.uint16[p+5]=o,this.uint16[p+6]=a,this.uint16[p+7]=l,this.int16[p+8]=c,this.int16[p+9]=u,this.int16[p+10]=d,this.int16[p+11]=h,e}}Ta.prototype.bytesPerElement=24,$s(Ta,"StructArrayLayout4i4ui4i24");class ka extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,o){const a=10*e,l=5*e;return this.int16[a+0]=t,this.int16[a+1]=r,this.int16[a+2]=n,this.float32[l+2]=i,this.float32[l+3]=s,this.float32[l+4]=o,e}}ka.prototype.bytesPerElement=20,$s(ka,"StructArrayLayout3i3f20");class Aa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=4*e;return this.float32[s+0]=t,this.float32[s+1]=r,this.float32[s+2]=n,this.float32[s+3]=i,e}}Aa.prototype.bytesPerElement=16,$s(Aa,"StructArrayLayout4f16");class Ca extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint32[1*e+0]=t,e}}Ca.prototype.bytesPerElement=4,$s(Ca,"StructArrayLayout1ul4");class Ea extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.uint16[n+0]=t,this.uint16[n+1]=r,e}}Ea.prototype.bytesPerElement=4,$s(Ea,"StructArrayLayout2ui4");class Na extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,c,u,d,h){const p=this.length;return this.resize(p+1),this.emplace(p,e,t,r,n,i,s,o,a,l,c,u,d,h)}emplace(e,t,r,n,i,s,o,a,l,c,u,d,h,p){const m=20*e,f=10*e;return this.int16[m+0]=t,this.int16[m+1]=r,this.int16[m+2]=n,this.int16[m+3]=i,this.int16[m+4]=s,this.float32[f+3]=o,this.float32[f+4]=a,this.float32[f+5]=l,this.float32[f+6]=c,this.int16[m+14]=u,this.uint32[f+8]=d,this.uint16[m+18]=h,this.uint16[m+19]=p,e}}Na.prototype.bytesPerElement=40,$s(Na,"StructArrayLayout5i4f1i1ul2ui40");class Ia extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=8*e;return this.int16[l+0]=t,this.int16[l+1]=r,this.int16[l+2]=n,this.int16[l+4]=i,this.int16[l+5]=s,this.int16[l+6]=o,this.int16[l+7]=a,e}}Ia.prototype.bytesPerElement=16,$s(Ia,"StructArrayLayout3i2i2i16");class Pa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const o=4*e,a=8*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.int16[a+6]=i,this.int16[a+7]=s,e}}Pa.prototype.bytesPerElement=16,$s(Pa,"StructArrayLayout2f1f2i16");class Ma extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,o){const a=20*e,l=5*e;return this.uint8[a+0]=t,this.uint8[a+1]=r,this.float32[l+1]=n,this.float32[l+2]=i,this.float32[l+3]=s,this.float32[l+4]=o,e}}Ma.prototype.bytesPerElement=20,$s(Ma,"StructArrayLayout2ub4f20");class La extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r){const n=this.length;return this.resize(n+1),this.emplace(n,e,t,r)}emplace(e,t,r,n){const i=3*e;return this.uint16[i+0]=t,this.uint16[i+1]=r,this.uint16[i+2]=n,e}}La.prototype.bytesPerElement=6,$s(La,"StructArrayLayout3ui6");class Ra extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x){const b=this.length;return this.resize(b+1),this.emplace(b,e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x)}emplace(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b){const w=30*e,j=15*e,S=60*e;return this.int16[w+0]=t,this.int16[w+1]=r,this.int16[w+2]=n,this.float32[j+2]=i,this.float32[j+3]=s,this.uint16[w+8]=o,this.uint16[w+9]=a,this.uint32[j+5]=l,this.uint32[j+6]=c,this.uint32[j+7]=u,this.uint16[w+16]=d,this.uint16[w+17]=h,this.uint16[w+18]=p,this.float32[j+10]=m,this.float32[j+11]=f,this.uint8[S+48]=g,this.uint8[S+49]=y,this.uint8[S+50]=_,this.uint32[j+13]=v,this.int16[w+28]=x,this.uint8[S+58]=b,e}}Ra.prototype.bytesPerElement=60,$s(Ra,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Da extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b,w,j,S,T,k,A,C,E,N,I,P){const M=this.length;return this.resize(M+1),this.emplace(M,e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b,w,j,S,T,k,A,C,E,N,I,P)}emplace(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b,w,j,S,T,k,A,C,E,N,I,P,M){const L=20*e,R=40*e,D=80*e;return this.float32[L+0]=t,this.float32[L+1]=r,this.int16[R+4]=n,this.int16[R+5]=i,this.int16[R+6]=s,this.int16[R+7]=o,this.int16[R+8]=a,this.int16[R+9]=l,this.int16[R+10]=c,this.int16[R+11]=u,this.int16[R+12]=d,this.uint16[R+13]=h,this.uint16[R+14]=p,this.uint16[R+15]=m,this.uint16[R+16]=f,this.uint16[R+17]=g,this.uint16[R+18]=y,this.uint16[R+19]=_,this.uint16[R+20]=v,this.uint16[R+21]=x,this.uint16[R+22]=b,this.uint16[R+23]=w,this.uint16[R+24]=j,this.uint16[R+25]=S,this.uint16[R+26]=T,this.uint16[R+27]=k,this.uint32[L+14]=A,this.float32[L+15]=C,this.float32[L+16]=E,this.float32[L+17]=N,this.float32[L+18]=I,this.uint8[D+76]=P,this.uint16[R+39]=M,e}}Da.prototype.bytesPerElement=80,$s(Da,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class Fa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s){const o=this.length;return this.resize(o+1),this.emplace(o,e,t,r,n,i,s)}emplace(e,t,r,n,i,s,o){const a=6*e;return this.float32[a+0]=t,this.float32[a+1]=r,this.float32[a+2]=n,this.float32[a+3]=i,this.float32[a+4]=s,this.float32[a+5]=o,e}}Fa.prototype.bytesPerElement=24,$s(Fa,"StructArrayLayout6f24");class Oa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i){const s=this.length;return this.resize(s+1),this.emplace(s,e,t,r,n,i)}emplace(e,t,r,n,i,s){const o=5*e;return this.float32[o+0]=t,this.float32[o+1]=r,this.float32[o+2]=n,this.float32[o+3]=i,this.float32[o+4]=s,e}}Oa.prototype.bytesPerElement=20,$s(Oa,"StructArrayLayout5f20");class za extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=7*e;return this.float32[l+0]=t,this.float32[l+1]=r,this.float32[l+2]=n,this.float32[l+3]=i,this.float32[l+4]=s,this.float32[l+5]=o,this.float32[l+6]=a,e}}za.prototype.bytesPerElement=28,$s(za,"StructArrayLayout7f28");class Ba extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,c,u){const d=this.length;return this.resize(d+1),this.emplace(d,e,t,r,n,i,s,o,a,l,c,u)}emplace(e,t,r,n,i,s,o,a,l,c,u,d){const h=11*e;return this.float32[h+0]=t,this.float32[h+1]=r,this.float32[h+2]=n,this.float32[h+3]=i,this.float32[h+4]=s,this.float32[h+5]=o,this.float32[h+6]=a,this.float32[h+7]=l,this.float32[h+8]=c,this.float32[h+9]=u,this.float32[h+10]=d,e}}Ba.prototype.bytesPerElement=44,$s(Ba,"StructArrayLayout11f44");class Ua extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l){const c=this.length;return this.resize(c+1),this.emplace(c,e,t,r,n,i,s,o,a,l)}emplace(e,t,r,n,i,s,o,a,l,c){const u=9*e;return this.float32[u+0]=t,this.float32[u+1]=r,this.float32[u+2]=n,this.float32[u+3]=i,this.float32[u+4]=s,this.float32[u+5]=o,this.float32[u+6]=a,this.float32[u+7]=l,this.float32[u+8]=c,e}}Ua.prototype.bytesPerElement=36,$s(Ua,"StructArrayLayout9f36");class Va extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t){const r=this.length;return this.resize(r+1),this.emplace(r,e,t)}emplace(e,t,r){const n=2*e;return this.float32[n+0]=t,this.float32[n+1]=r,e}}Va.prototype.bytesPerElement=8,$s(Va,"StructArrayLayout2f8");class qa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e,t,r,n){const i=this.length;return this.resize(i+1),this.emplace(i,e,t,r,n)}emplace(e,t,r,n,i){const s=6*e;return this.uint32[3*e+0]=t,this.uint16[s+2]=r,this.uint16[s+3]=n,this.uint16[s+4]=i,e}}qa.prototype.bytesPerElement=12,$s(qa,"StructArrayLayout1ul3ui12");class Wa extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint16[1*e+0]=t,e}}Wa.prototype.bytesPerElement=2,$s(Wa,"StructArrayLayout1ui2");class Ha extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f){const g=this.length;return this.resize(g+1),this.emplace(g,e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f)}emplace(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g){const y=16*e;return this.float32[y+0]=t,this.float32[y+1]=r,this.float32[y+2]=n,this.float32[y+3]=i,this.float32[y+4]=s,this.float32[y+5]=o,this.float32[y+6]=a,this.float32[y+7]=l,this.float32[y+8]=c,this.float32[y+9]=u,this.float32[y+10]=d,this.float32[y+11]=h,this.float32[y+12]=p,this.float32[y+13]=m,this.float32[y+14]=f,this.float32[y+15]=g,e}}Ha.prototype.bytesPerElement=64,$s(Ha,"StructArrayLayout16f64");class Ga extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(e,t,r,n,i,s,o){const a=this.length;return this.resize(a+1),this.emplace(a,e,t,r,n,i,s,o)}emplace(e,t,r,n,i,s,o,a){const l=10*e,c=5*e;return this.uint16[l+0]=t,this.uint16[l+1]=r,this.uint16[l+2]=n,this.uint16[l+3]=i,this.float32[c+2]=s,this.float32[c+3]=o,this.float32[c+4]=a,e}}Ga.prototype.bytesPerElement=20,$s(Ga,"StructArrayLayout4ui3f20");class Za extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.int16[1*e+0]=t,e}}Za.prototype.bytesPerElement=2,$s(Za,"StructArrayLayout1i2");class Ka extends ua{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(e){const t=this.length;return this.resize(t+1),this.emplace(t,e)}emplace(e,t){return this.uint8[1*e+0]=t,e}}Ka.prototype.bytesPerElement=1,$s(Ka,"StructArrayLayout1ub1");class Ya extends la{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Ya.prototype.size=40;class Xa extends Na{get(e){return new Ya(this,e)}}$s(Xa,"CollisionBoxArray");class Ja extends la{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(e){this._structArray.uint8[this._pos1+49]=e}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(e){this._structArray.uint8[this._pos1+50]=e}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(e){this._structArray.uint32[this._pos4+13]=e}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(e){this._structArray.uint8[this._pos1+58]=e}}Ja.prototype.size=60;class Qa extends Ra{get(e){return new Ja(this,e)}}$s(Qa,"PlacedSymbolArray");class $a extends la{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(e){this._structArray.uint32[this._pos4+14]=e}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(e){this._structArray.float32[this._pos4+18]=e}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}$a.prototype.size=80;class el extends Da{get(e){return new $a(this,e)}}$s(el,"SymbolInstanceArray");class tl extends ga{getoffsetX(e){return this.float32[1*e+0]}}$s(tl,"GlyphOffsetArray");class rl extends pa{getx(e){return this.int16[2*e+0]}gety(e){return this.int16[2*e+1]}}$s(rl,"SymbolLineVertexArray");class nl extends la{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}nl.prototype.size=12;class il extends qa{get(e){return new nl(this,e)}}$s(il,"FeatureIndexArray");class sl extends Ea{geta_centroid_pos0(e){return this.uint16[2*e+0]}geta_centroid_pos1(e){return this.uint16[2*e+1]}}$s(sl,"FillExtrusionCentroidArray");class ol extends la{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}ol.prototype.size=6;class al extends ma{get(e){return new ol(this,e)}}$s(al,"FillExtrusionWallArray");const ll=da([{name:"a_pos",components:2,type:"Int16"}],4),cl=da([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),ul=da([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class dl{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];this.segments=e}_prepareSegment(e,t,r,n){let i=this.segments[this.segments.length-1];return e>dl.MAX_VERTEX_ARRAY_LENGTH&&Ze("Max vertices per segment is ".concat(dl.MAX_VERTEX_ARRAY_LENGTH,": bucket requested ").concat(e)),(!i||i.vertexLength+e>dl.MAX_VERTEX_ARRAY_LENGTH||i.sortKey!==n)&&(i={vertexOffset:t,primitiveOffset:r,vertexLength:0,primitiveLength:0},void 0!==n&&(i.sortKey=n),this.segments.push(i)),i}prepareSegment(e,t,r,n){return this._prepareSegment(e,t.length,r.length,n)}get(){return this.segments}destroy(){for(const e of this.segments)for(const t in e.vaos)e.vaos[t].destroy()}static simpleSegment(e,t,r,n){return new dl([{vertexOffset:e,primitiveOffset:t,vertexLength:r,primitiveLength:n,vaos:{},sortKey:0}])}}function hl(e,t){return 256*(e=Le(Math.floor(e),0,255))+Le(Math.floor(t),0,255)}dl.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$s(dl,"SegmentVector");const pl=da([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),ml=da([{name:"a_pattern_b",components:4,type:"Uint16"}]),fl=da([{name:"a_dash",components:4,type:"Uint16"}]);class gl{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(e,t,r,n){this.ids.push(yl(e)),this.positions.push(t,r,n)}eachPosition(e,t){const r=yl(e);let n=0,i=this.ids.length-1;for(;n<i;){const e=n+i>>1;this.ids[e]>=r?i=e:n=e+1}for(;this.ids[n]===r;)t(this.positions[3*n],this.positions[3*n+1],this.positions[3*n+2]),n++}static serialize(e,t){const r=new Float64Array(e.ids),n=new Uint32Array(e.positions);return _l(r,n,0,r.length-1),t&&(t.add(r.buffer),t.add(n.buffer)),{ids:r,positions:n}}static deserialize(e){const t=new gl;let r;t.ids=e.ids,t.positions=e.positions;for(const n of t.ids)n!==r&&t.uniqueIds.push(n),r=n;return t.indexed=!0,t}}function yl(e){const t=+e;return Number.isSafeInteger(t)?t:Qt(String(e))}function _l(e,t,r,n){for(;r<n;){const i=e[r+n>>1];let s=r-1,o=n+1;for(;;){do{s++}while(e[s]<i);do{o--}while(e[o]>i);if(s>=o)break;vl(e,s,o),vl(t,3*s,3*o),vl(t,3*s+1,3*o+1),vl(t,3*s+2,3*o+2)}o-r<n-o?(_l(e,t,r,o),r=o+1):(_l(e,t,o+1,n),n=o)}}function vl(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}$s(gl,"FeaturePositionMap");class xl{constructor(e){this.gl=e.gl,this.initialized=!1}fetchUniformLocation(e,t){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(e,t),this.initialized=!0),!!this.location}set(e,t,r){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class bl extends xl{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1i(this.location,r))}}class wl extends xl{constructor(e){super(e),this.current=0}set(e,t,r){this.fetchUniformLocation(e,t)&&this.current!==r&&(this.current=r,this.gl.uniform1f(this.location,r))}}class jl extends xl{constructor(e){super(e),this.current=[0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]||(this.current=r,this.gl.uniform2f(this.location,r[0],r[1])))}}class Sl extends xl{constructor(e){super(e),this.current=[0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]||(this.current=r,this.gl.uniform3f(this.location,r[0],r[1],r[2])))}}class Tl extends xl{constructor(e){super(e),this.current=[0,0,0,0]}set(e,t,r){this.fetchUniformLocation(e,t)&&(r[0]===this.current[0]&&r[1]===this.current[1]&&r[2]===this.current[2]&&r[3]===this.current[3]||(this.current=r,this.gl.uniform4f(this.location,r[0],r[1],r[2],r[3])))}}class kl extends xl{constructor(e){super(e),this.current=lr.transparent.toPremultipliedRenderColor(null)}set(e,t,r){this.fetchUniformLocation(e,t)&&(r.r===this.current.r&&r.g===this.current.g&&r.b===this.current.b&&r.a===this.current.a||(this.current=r,this.gl.uniform4f(this.location,r.r,r.g,r.b,r.a)))}}const Al=new Float32Array(16);class Cl extends xl{constructor(e){super(e),this.current=Al}set(e,t,r){if(this.fetchUniformLocation(e,t)){if(r[12]!==this.current[12]||r[0]!==this.current[0])return this.current=r,void this.gl.uniformMatrix4fv(this.location,!1,r);for(let e=1;e<16;e++)if(r[e]!==this.current[e]){this.current=r,this.gl.uniformMatrix4fv(this.location,!1,r);break}}}}const El=new Float32Array(9),Nl=new Float32Array(4);class Il extends xl{constructor(e){super(e),this.current=Nl}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let n=0;n<4;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix2fv(this.location,!1,r);break}}}function Pl(e){return[hl(255*e.r,255*e.g),hl(255*e.b,255*e.a)]}function Ml(e,t,r,n,i,s,o,a){return!!e&&("composite"===e.kind||"source"===e.kind?"none"===e.evaluate(new So(0,{brightness:s,worldview:a}),t,r,i,n,o):"none"===e.value)}class Ll{constructor(e,t,r,n){this.value=e,this.uniformNames=t.map(e=>"u_".concat(e)),this.type=r,this.context=n}setUniform(e,t,r,n,i){const s=n.constantOr(this.value);t.set(e,i,s instanceof lr?s.toPremultipliedRenderColor(this.lutExpression&&"constant"===this.lutExpression.kind&&"none"===this.lutExpression.value?null:this.context.lut):s)}getBinding(e,t){return"color"===this.type?new kl(e):new wl(e)}}class Rl{constructor(e,t){this.uniformNames=t.map(e=>"u_".concat(e)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(e,t){this.pixelRatio=e.pixelRatio||1,this.pattern=e.tl.concat(e.br),this.patternTransition=t?t.tl.concat(t.br):this.pattern}setUniform(e,t,r,n,i){let s=null;"u_pattern"!==i&&"u_dash"!==i||(s=this.pattern),"u_pattern_b"===i&&(s=this.patternTransition),"u_pixel_ratio"===i&&(s=this.pixelRatio),s&&t.set(e,i,s)}getBinding(e,t){return"u_pattern"===t||"u_pattern_b"===t||"u_dash"===t?new Tl(e):new wl(e)}}class Dl{constructor(e,t,r,n){this.expression=e,this.type=r,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===r?2:1,offset:0})),this.paintVertexArray=new n}populatePaintArray(e,t,r,n,i,s,o,a){const l=this.paintVertexArray.length,c="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate(new So(0,{brightness:s,worldview:a}),t,{},i,n,o):"constant"===this.expression.kind&&this.expression.value,u=Ml(this.lutExpression,t,{},n,i,s,o,a);this.paintVertexArray.resize(e),this._setPaintValue(l,e,c,u?null:this.context.lut)}updatePaintArray(e,t,r,n,i,s,o,a){const l="composite"===this.expression.kind||"source"===this.expression.kind?this.expression.evaluate({zoom:0,brightness:o,worldview:a},r,n,void 0,i):"constant"===this.expression.kind&&this.expression.value,c=Ml(this.lutExpression,r,n,i,void 0,o,void 0,a);this._setPaintValue(e,t,l,c?null:this.context.lut)}_setPaintValue(e,t,r,n){if("color"===this.type){const i=Pl(r.toPremultipliedRenderColor(n));for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,i[0],i[1])}else{for(let n=e;n<t;n++)this.paintVertexArray.emplace(n,r);this.maxValue=Math.max(this.maxValue,Math.abs(r))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&"constant"!==this.lutExpression.kind&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||"constant"!==this.expression.kind&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Fl{constructor(e,t,r,n,i,s){this.expression=e,this.uniformNames=t.map(e=>"u_".concat(e,"_t")),this.type=r,this.useIntegerZoom=n,this.context=i,this.maxValue=0,this.paintVertexAttributes=t.map(e=>({name:"a_".concat(e),type:"Float32",components:"color"===r?4:2,offset:0})),this.paintVertexArray=new s}populatePaintArray(e,t,r,n,i,s,o,a){const l=this.expression.evaluate(new So(this.context.zoom,{brightness:s,worldview:a}),t,{},i,n,o),c=this.expression.evaluate(new So(this.context.zoom+1,{brightness:s,worldview:a}),t,{},i,n,o),u=Ml(this.lutExpression,t,{},n,i,s,o,a),d=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValue(d,e,l,c,u?null:this.context.lut)}updatePaintArray(e,t,r,n,i,s,o,a){const l=this.expression.evaluate({zoom:this.context.zoom,brightness:o,worldview:a},r,n,void 0,i),c=this.expression.evaluate({zoom:this.context.zoom+1,brightness:o,worldview:a},r,n,void 0,i),u=Ml(this.lutExpression,r,n,i,void 0,o,void 0,a);this._setPaintValue(e,t,l,c,u?null:this.context.lut)}_setPaintValue(e,t,r,n,i){if("color"===this.type){const n=Pl(r.toPremultipliedRenderColor(i)),s=Pl(r.toPremultipliedRenderColor(i));for(let r=e;r<t;r++)this.paintVertexArray.emplace(r,n[0],n[1],s[0],s[1])}else{for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r,n);this.maxValue=Math.max(this.maxValue,Math.abs(r),Math.abs(n))}}upload(e){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(e,t,r,n,i){const s=this.useIntegerZoom?Math.floor(r.zoom):r.zoom,o=Le(this.expression.interpolationFactor(s,this.context.zoom,this.context.zoom+1),0,1);t.set(e,i,o)}getBinding(e,t){return new wl(e)}}class Ol{constructor(e,t,r,n,i){this.expression=e,this.layerId=i,this.paintVertexAttributes=("array"===r?fl:pl).members;for(let s=0;s<t.length;++s);this.paintVertexArray=new n,this.paintTransitionVertexArray=new ja}populatePaintArray(e,t,r,n){const i=this.paintVertexArray.length;this.paintVertexArray.resize(e),this._setPaintValues(i,e,t.patterns&&t.patterns[this.layerId],r)}updatePaintArray(e,t,r,n,i,s,o){this._setPaintValues(e,t,r.patterns&&r.patterns[this.layerId],s)}_setPaintValues(e,t,r,n){if(!n||!r)return;const i=n[r[0]],s=n[r[1]];if(i){if(i){const{tl:r,br:n,pixelRatio:s}=i;for(let i=e;i<t;i++)this.paintVertexArray.emplace(i,r[0],r[1],n[0],n[1],s)}if(s){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:r,br:n}=s;for(let i=e;i<t;i++)this.paintTransitionVertexArray.emplace(i,r[0],r[1],n[0],n[1])}}}upload(e){const t=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=e.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,t)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=e.createVertexBuffer(this.paintTransitionVertexArray,ml.members,t))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class zl{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.binders={},this._buffers=[],this.context=t;const n=[];for(const i in e.paint._values){const s=e.paint.get(i);if(i.endsWith("-use-theme"))continue;if(!r(i))continue;if(!(s instanceof Io&&Cs(s.property.specification)))continue;const o=Vl(i,e.type),a=s.value,l=s.property.specification.type,c=!!s.property.useIntegerZoom,u="line-dasharray"===i||i.endsWith("pattern"),d=e.paint.get("".concat(i,"-use-theme")),h="line-dasharray"===i&&"constant"!==e.layout.get("line-cap").value.kind||d&&"constant"!==d.value.kind;if("constant"!==a.kind||h)if("source"===a.kind||h||u){const t=Hl(i,l,"source");this.binders[i]=u?new Ol(a,o,l,t,e.id):new Dl(a,o,l,t),n.push("/a_".concat(i))}else{const e=Hl(i,l,"composite");this.binders[i]=new Fl(a,o,l,c,t,e),n.push("/z_".concat(i))}else this.binders[i]=u?new Rl(a.value,o):new Ll(a.value,o,l,t),n.push("/u_".concat(i));d&&(this.binders[i].lutExpression=d.value)}this.cacheKey=n.sort().join("")}getMaxValue(e){const t=this.binders[e];return t instanceof Dl||t instanceof Fl?t.maxValue:0}populatePaintArrays(e,t,r,n,i,s,o,a){for(const l in this.binders){const c=this.binders[l];c.context=this.context,(c instanceof Dl||c instanceof Fl||c instanceof Ol)&&c.populatePaintArray(e,t,r,n,i,s,o,a)}}setConstantPatternPositions(e,t){for(const r in this.binders){const n=this.binders[r];n instanceof Rl&&n.setConstantPatternPositions(e,t)}}getPatternTransitionVertexBuffer(e){const t=this.binders[e];return t instanceof Ol?t.paintTransitionVertexBuffer:null}updatePaintArrays(e,t,r,n,i,s,o,a,l,c){let u=!1;const d=Object.keys(e),h=0!==d.length&&!a,p=h?d:t.uniqueIds;this.context.lut=i.lut;for(const m in this.binders){const a=this.binders[m];if(a.context=this.context,(a instanceof Dl||a instanceof Fl||a instanceof Ol)&&a.expression&&a.expression.kind&&"constant"!==a.expression.kind&&(!0===a.expression.isStateDependent||!1===a.expression.isLightConstant)){const d=i.paint.get(m);a.expression=d.value;for(const r of p){const i=e[r.toString()];t.eachPosition(r,(e,t,r)=>{const u=n.feature(e);a.updatePaintArray(t,r,u,i,s,o,l,c)})}if(!h)for(const t of r.uniqueIds){const i=e[t.toString()];r.eachPosition(t,(e,t,r)=>{const u=n.feature(e);a.updatePaintArray(t,r,u,i,s,o,l,c)})}u=!0}}return u}defines(){const e=[];for(const t in this.binders){const r=this.binders[t];(r instanceof Ll||r instanceof Rl)&&e.push(...r.uniformNames.map(e=>"#define HAS_UNIFORM_".concat(e)))}return e}getPaintVertexBuffers(){return this._buffers}getUniforms(e){const t=[];for(const r in this.binders){const n=this.binders[r];if(n instanceof Ll||n instanceof Rl||n instanceof Fl)for(const i of n.uniformNames)t.push({name:i,property:r,binding:n.getBinding(e,i)})}return t}setUniforms(e,t,r,n,i){for(const{name:s,property:o,binding:a}of r)this.binders[o].setUniform(e,a,i,n.get(o),s)}updatePaintBuffers(){this._buffers=[];for(const e in this.binders){const t=this.binders[e];(t instanceof Dl||t instanceof Fl||t instanceof Ol)&&t.paintVertexBuffer&&this._buffers.push(t.paintVertexBuffer),t instanceof Ol&&t.paintTransitionVertexBuffer&&this._buffers.push(t.paintTransitionVertexBuffer)}}upload(e){for(const t in this.binders){const r=this.binders[t];(r instanceof Dl||r instanceof Fl||r instanceof Ol)&&r.upload(e)}this.updatePaintBuffers()}destroy(){for(const e in this.binders){const t=this.binders[e];(t instanceof Dl||t instanceof Fl||t instanceof Ol)&&t.destroy()}}}class Bl{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:()=>!0;this.programConfigurations={};for(const n of e)this.programConfigurations[n.id]=new zl(n,t,r);this.needsUpload=!1,this._featureMap=new gl,this._featureMapWithoutIds=new gl,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(e,t,r,n,i,s,o,a,l){for(const c in this.programConfigurations)this.programConfigurations[c].populatePaintArrays(e,t,n,i,s,o,a,l);void 0!==t.id?this._featureMap.add(t.id,r,this._bufferOffset,e):(this._featureMapWithoutIds.add(this._idlessCounter,r,this._bufferOffset,e),this._idlessCounter+=1),this._bufferOffset=e,this.needsUpload=!0}updatePaintArrays(e,t,r,n,i,s,o,a){for(const l of r)this.needsUpload=this.programConfigurations[l.id].updatePaintArrays(e,this._featureMap,this._featureMapWithoutIds,t,l,n,i,s,o||0,a)||this.needsUpload}get(e){return this.programConfigurations[e]}upload(e){if(this.needsUpload){for(const t in this.programConfigurations)this.programConfigurations[t].upload(e);this.needsUpload=!1}}destroy(){for(const e in this.programConfigurations)this.programConfigurations[e].destroy()}}const Ul={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function Vl(e,t){return Ul[e]||[e.replace("".concat(t,"-"),"").replace(/-/g,"_")]}const ql={"line-pattern":{source:wa,composite:wa},"fill-pattern":{source:wa,composite:wa},"fill-extrusion-pattern":{source:wa,composite:wa},"line-dasharray":{source:ja,composite:ja}},Wl={color:{source:Va,composite:Aa},number:{source:ga,composite:Va}};function Hl(e,t,r){const n=ql[e];return n&&n[r]||Wl[t][r]}$s(Ll,"ConstantBinder"),$s(Rl,"PatternConstantBinder"),$s(Dl,"SourceExpressionBinder"),$s(Ol,"PatternCompositeBinder"),$s(Fl,"CompositeExpressionBinder"),$s(zl,"ProgramConfiguration",{omit:["_buffers"]}),$s(Bl,"ProgramConfigurationSet");const Gl=Bn/Math.PI/2,Zl=5,Kl=6,Yl=16383,Xl=64,Jl=[Xl,32,16],Ql=-Gl,$l=Gl;function ec(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Gl;return r=Ce(r),[e*Math.sin(r)*n,-t*n,e*Math.cos(r)*n]}function tc(e,t,r){return ec(Math.cos(Ce(e)),Math.sin(Ce(e)),t,r)}const rc=6371008.8,nc=2*Math.PI*rc;class ic{constructor(e,t){if(isNaN(e)||isNaN(t))throw new Error("Invalid LngLat object: (".concat(e,", ").concat(t,")"));if(this.lng=+e,this.lat=+t,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new ic(De(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return"LngLat(".concat(this.lng,", ").concat(this.lat,")")}distanceTo(e){const t=Math.PI/180,r=this.lat*t,n=e.lat*t,i=Math.sin(r)*Math.sin(n)+Math.cos(r)*Math.cos(n)*Math.cos((e.lng-this.lng)*t);return rc*Math.acos(Math.min(i,1))}toBounds(){const e=360*(arguments.length>0&&void 0!==arguments[0]?arguments[0]:0)/40075017,t=e/Math.cos(Math.PI/180*this.lat);return new sc({lng:this.lng-t,lat:this.lat-e},{lng:this.lng+t,lat:this.lat+e})}toEcef(e){return tc(this.lat,this.lng,Gl+e*Gl/rc)}static convert(e){if(e instanceof ic)return e;if(Array.isArray(e)&&(2===e.length||3===e.length))return new ic(Number(e[0]),Number(e[1]));if(!Array.isArray(e)&&"object"==typeof e&&null!==e)return new ic(Number("lng"in e?e.lng:e.lon),Number(e.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class sc{constructor(e,t){e&&(t?this.setSouthWest(e).setNorthEast(t):Array.isArray(e)&&4===e.length?this.setSouthWest([e[0],e[1]]).setNorthEast([e[2],e[3]]):this.setSouthWest(e[0]).setNorthEast(e[1]))}setNorthEast(e){return this._ne=e instanceof ic?new ic(e.lng,e.lat):ic.convert(e),this}setSouthWest(e){return this._sw=e instanceof ic?new ic(e.lng,e.lat):ic.convert(e),this}extend(e){const t=this._sw,r=this._ne;let n,i;if(e instanceof ic)n=e,i=e;else{if(!(e instanceof sc))return Array.isArray(e)?4===e.length||e.every(Array.isArray)?this.extend(sc.convert(e)):this.extend(ic.convert(e)):"object"==typeof e&&null!==e&&e.hasOwnProperty("lat")&&(e.hasOwnProperty("lon")||e.hasOwnProperty("lng"))?this.extend(ic.convert(e)):this;if(n=e._sw,i=e._ne,!n||!i)return this}return t||r?(t.lng=Math.min(n.lng,t.lng),t.lat=Math.min(n.lat,t.lat),r.lng=Math.max(i.lng,r.lng),r.lat=Math.max(i.lat,r.lat)):(this._sw=new ic(n.lng,n.lat),this._ne=new ic(i.lng,i.lat)),this}getCenter(){return new ic((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new ic(this.getWest(),this.getNorth())}getSouthEast(){return new ic(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return"LngLatBounds(".concat(this._sw.toString(),", ").concat(this._ne.toString(),")")}isEmpty(){return!(this._sw&&this._ne)}contains(e){const{lng:t,lat:r}=ic.convert(e);let n=this._sw.lng<=t&&t<=this._ne.lng;return this._sw.lng>this._ne.lng&&(n=this._sw.lng>=t&&t>=this._ne.lng),this._sw.lat<=r&&r<=this._ne.lat&&n}static convert(e){if(e)return e instanceof sc?e:new sc(e)}}const oc=0,ac=25.5;function lc(e){return nc*Math.cos(e*Math.PI/180)}function cc(e){return(180+e)/360}function uc(e){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+e*Math.PI/360)))/360}function dc(e,t){return e/lc(t)}function hc(e){return 360*e-180}function pc(e){return 360/Math.PI*Math.atan(Math.exp((180-360*e)*Math.PI/180))-90}function mc(e,t){return e*lc(pc(t))}const fc=85.051129;function gc(e){return Math.cos(Ce(Le(e,-fc,fc)))}function yc(e,t){const r=Le(t,oc,ac),n=Math.pow(2,r);return gc(e)*nc/(512*n)}function _c(e){return 1/Math.cos(e*Math.PI/180)}function vc(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=Math.exp(Math.PI*(1-(e.y+t/Bn)/(1<<e.z)*2));return 80150034*r/(r*r+1)/Bn/(1<<e.z)}class xc{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;this.x=+e,this.y=+t,this.z=+r}static fromLngLat(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;const r=ic.convert(e);return new xc(cc(r.lng),uc(r.lat),dc(t,r.lat))}toLngLat(){return new ic(hc(this.x),pc(this.y))}toAltitude(){return mc(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/nc*_c(pc(this.y))}}function bc(e,t,r,n,i,s,o,a,l){const c=(t+n)/2,u=(r+i)/2,d=new Se(c,u);a(d),function(e,t,r,n,i,s){const o=r-i,a=n-s;return Math.abs((n-t)*o-(r-e)*a)/Math.hypot(o,a)}(d.x,d.y,s.x,s.y,o.x,o.y)>=l?(bc(e,t,r,c,u,s,d,a,l),bc(e,c,u,n,i,d,o,a,l)):e.push(o)}function wc(e,t,r){let n=e[0],i=n.x,s=n.y;t(n);const o=[n];for(let a=1;a<e.length;a++){const l=e[a],{x:c,y:u}=l;t(l),bc(o,i,s,c,u,n,l,t,r),i=c,s=u,n=l}return o}function jc(e,t,r,n){if(n(t,r)){const i=t.add(r)._mult(.5);jc(e,t,i,n),jc(e,i,r,n)}else e.push(r)}function Sc(e,t){let r=e[0];const n=[r];for(let i=1;i<e.length;i++){const s=e[i];jc(n,r,s,t),r=s}return n}const Tc=Math.pow(2,14)-1,kc=-Tc-1;function Ac(e,t){const r=Math.round(e.x*t),n=Math.round(e.y*t);return e.x=Le(r,kc,Tc),e.y=Le(n,kc,Tc),(r<e.x||r>e.x+1||n<e.y||n>e.y+1)&&Ze("Geometry exceeds allowed extent, reduce your vector tile buffer size"),e}function Cc(e,t,r){const n=e.loadGeometry(),i=e.extent,s=Bn/i;if(t&&r&&r.projection.isReprojectedInTileSpace){const s=1<<t.z,{scale:o,x:a,y:l,projection:c}=r,u=e=>{const r=hc((t.x+e.x/i)/s),n=pc((t.y+e.y/i)/s),u=c.project(r,n);e.x=(u.x*o-a)*i,e.y=(u.y*o-l)*i};for(let t=0;t<n.length;t++)if(1!==e.type)n[t]=wc(n[t],u,1);else{const e=[];for(const r of n[t])r.x<0||r.x>=i||r.y<0||r.y>=i||(u(r),e.push(r));n[t]=e}}for(const o of n)for(const e of o)Ac(e,s);return n}function Ec(e,t){return{type:e.type,id:e.id,properties:e.properties,geometry:t?Cc(e):[]}}class Nc{constructor(e,t,r,n,i){this.properties={},this.extent=r,this.type=0,this.id=void 0,this._pbf=e,this._geometry=-1,this._keys=n,this._values=i,e.readFields(Ic,this,t)}loadGeometry(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos,r=[];let n,i=1,s=0,o=0,a=0;for(;e.pos<t;){if(s<=0){const t=e.readVarint();i=7&t,s=t>>3}if(s--,1===i||2===i)o+=e.readSVarint(),a+=e.readSVarint(),1===i&&(n&&r.push(n),n=[]),n&&n.push(new Se(o,a));else{if(7!==i)throw new Error("unknown command ".concat(i));n&&n.push(n[0].clone())}}return n&&r.push(n),r}bbox(){const e=this._pbf;e.pos=this._geometry;const t=e.readVarint()+e.pos;let r=1,n=0,i=0,s=0,o=1/0,a=-1/0,l=1/0,c=-1/0;for(;e.pos<t;){if(n<=0){const t=e.readVarint();r=7&t,n=t>>3}if(n--,1===r||2===r)i+=e.readSVarint(),s+=e.readSVarint(),i<o&&(o=i),i>a&&(a=i),s<l&&(l=s),s>c&&(c=s);else if(7!==r)throw new Error("unknown command ".concat(r))}return[o,l,a,c]}toGeoJSON(e,t,r){const n=this.extent*Math.pow(2,r),i=this.extent*e,s=this.extent*t,o=this.loadGeometry();function a(e){return[360*(e.x+i)/n-180,360/Math.PI*Math.atan(Math.exp((1-2*(e.y+s)/n)*Math.PI))-90]}function l(e){return e.map(a)}let c;if(1===this.type){const e=[];for(const r of o)e.push(r[0]);const t=l(e);c=1===e.length?{type:"Point",coordinates:t[0]}:{type:"MultiPoint",coordinates:t}}else if(2===this.type){const e=o.map(l);c=1===e.length?{type:"LineString",coordinates:e[0]}:{type:"MultiLineString",coordinates:e}}else{if(3!==this.type)throw new Error("unknown feature type");{const e=function(e){const t=e.length;if(t<=1)return[e];const r=[];let n,i;for(let s=0;s<t;s++){const t=Pc(e[s]);0!==t&&(void 0===i&&(i=t<0),i===t<0?(n&&r.push(n),n=[e[s]]):n&&n.push(e[s]))}return n&&r.push(n),r}(o),t=[];for(const r of e)t.push(r.map(l));c=1===t.length?{type:"Polygon",coordinates:t[0]}:{type:"MultiPolygon",coordinates:t}}}const u={type:"Feature",geometry:c,properties:this.properties};return null!=this.id&&(u.id=this.id),u}}function Ic(e,t,r){1===e?t.id=r.readVarint():2===e?function(e,t){const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=t._keys[e.readVarint()],n=t._values[e.readVarint()];t.properties[r]=n}}(r,t):3===e?t.type=r.readVarint():4===e&&(t._geometry=r.pos)}function Pc(e){let t=0;for(let r,n,i=0,s=e.length,o=s-1;i<s;o=i++)r=e[i],n=e[o],t+=(n.x-r.x)*(r.y+n.y);return t}Nc.types=["Unknown","Point","LineString","Polygon"];class Mc{constructor(e,t){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=e,this._keys=[],this._values=[],this._features=[],e.readFields(Lc,this,t),this.length=this._features.length}feature(e){if(e<0||e>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[e];const t=this._pbf.readVarint()+this._pbf.pos;return new Nc(this._pbf,t,this.extent,this._keys,this._values)}}function Lc(e,t,r){15===e?t.version=r.readVarint():1===e?t.name=r.readString():5===e?t.extent=r.readVarint():2===e?t._features.push(r.pos):3===e?t._keys.push(r.readString()):4===e&&t._values.push(function(e){let t=null;const r=e.readVarint()+e.pos;for(;e.pos<r;){const r=e.readVarint()>>3;t=1===r?e.readString():2===r?e.readFloat():3===r?e.readDouble():4===r?e.readVarint64():5===r?e.readVarint():6===r?e.readSVarint():7===r?e.readBoolean():null}if(null==t)throw new Error("unknown feature value");return t}(r))}class Rc{constructor(e,t){this.layers=e.readFields(Dc,{},t)}}function Dc(e,t,r){if(3===e){const e=new Mc(r,r.readVarint()+r.pos);e.length&&(t[e.name]=e)}}const Fc="3d_elevation_id",Oc="level";class zc{constructor(){this._valid=!1}reset(e){return this.feature=e,this._valid=!0,this._geometry=e.loadGeometry(),0!==this._geometry.length&&0!==this._geometry[0].length||(this._valid=!1),this}geometry(e,t){return this._valid&&e(t(this._geometry)),this}require(e,t,r){return this.get(e,!0,t,r)}optional(e,t,r){return this.get(e,!1,t,r)}success(){return this._valid}get(e,t,r,n){const i=this.feature.properties.hasOwnProperty(e)?+this.feature.properties[e]:void 0;return this._valid&&void 0!==i&&!Number.isNaN(i)?r(n?n(i):i):t&&(this._valid=!1),this}}class Bc{constructor(e,t){this.featureFunc=e,this.vertexFunc=t}parseFeature(e,t,r){return this.featureFunc(e,t,r)}parseVertex(e,t,r){return this.vertexFunc(e,t,r)}}const Uc=new Bc((e,t,r)=>e.reset(t).require(Fc,e=>{r.id=e}).optional("fixed_height_relative",e=>{r.constantHeight=e},qc.decodeRelativeHeight).geometry(e=>{r.bounds=e},_n).success(),(e,t,r)=>e.reset(t).require(Fc,e=>{r.id=e}).require("elevation_idx",e=>{r.idx=e}).require("extent",e=>{r.extent=e}).require("height_relative",e=>{r.height=e},qc.decodeRelativeHeight).geometry(e=>{r.position=e},qc.getPoint).success()),Vc=new Bc((e,t,r)=>e.reset(t).require(Fc,e=>{r.id=e}).optional("fixed_height",e=>{r.constantHeight=e},qc.decodeMetricHeight).geometry(e=>{r.bounds=e},_n).success(),(e,t,r)=>e.reset(t).require(Fc,e=>{r.id=e}).require("elevation_idx",e=>{r.idx=e}).require("extent",e=>{r.extent=e}).require("height",e=>{r.height=e},qc.decodeMetricHeight).geometry(e=>{r.position=e},qc.getPoint).success());class qc{static getPoint(e){return ue(e[0][0].x,e[0][0].y)}static decodeRelativeHeight(e){return 1e-4*e*5}static decodeMetricHeight(e){return 1e-4*e}static getVersionSchema(e){return e?"1.0.1"===e?Vc:void 0:Uc}static parse(e){const t=[],r=[],n=e.length,i=new zc;for(let s=0;s<n;s++){const n=e.feature(s),o=n.properties.version,a=qc.getVersionSchema(o);if(void 0===a){Ze("Unknown elevation feature version number ".concat(o||"(unknown)"));continue}const l=n.properties.type;if(!l)continue;const c=Nc.types[n.type];if("Point"===c&&"curve_point"===l){const e={};a.parseVertex(i,n,e)&&t.push(e)}else if("Polygon"===c&&"curve_meta"===l){const e={};a.parseFeature(i,n,e)&&r.push(e)}}return{vertices:t,features:r}}}class Wc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=ye(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,!0}}class Hc{constructor(e,t){this.pos=e,this.dir=t}intersectsPlane(e,t,r){const n=z(t,this.dir);if(Math.abs(n)<1e-6)return!1;const i=((e[0]-this.pos[0])*t[0]+(e[1]-this.pos[1])*t[1]+(e[2]-this.pos[2])*t[2])/n;return r[0]=this.pos[0]+this.dir[0]*i,r[1]=this.pos[1]+this.dir[1]*i,r[2]=this.pos[2]+this.dir[2]*i,!0}closestPointOnSphere(e,r,n){if(function(e,r){var n=e[0],i=e[1],s=e[2],o=r[0],a=r[1],l=r[2];return Math.abs(n-o)<=t*Math.max(1,Math.abs(n),Math.abs(o))&&Math.abs(i-a)<=t*Math.max(1,Math.abs(i),Math.abs(a))&&Math.abs(s-l)<=t*Math.max(1,Math.abs(s),Math.abs(l))}(this.pos,e)||0===r)return n[0]=n[1]=n[2]=0,!1;const[i,s,o]=this.dir,a=this.pos[0]-e[0],l=this.pos[1]-e[1],c=this.pos[2]-e[2],u=i*i+s*s+o*o,d=2*(a*i+l*s+c*o),h=d*d-4*u*(a*a+l*l+c*c-r*r);if(h<0){const e=Math.max(-d/2,0),t=a+i*e,u=l+s*e,h=c+o*e,p=Math.hypot(t,u,h);return n[0]=t*r/p,n[1]=u*r/p,n[2]=h*r/p,!1}{const e=(-d-Math.sqrt(h))/(2*u);if(e<0){const e=Math.hypot(a,l,c);return n[0]=a*r/e,n[1]=l*r/e,n[2]=c*r/e,!1}return n[0]=a+i*e,n[1]=l+s*e,n[2]=c+o*e,!0}}}class Gc{constructor(e,t,r,n,i){this.TL=e,this.TR=t,this.BR=r,this.BL=n,this.horizon=i}static fromInvProjectionMatrix(e,t,r){const n=[-1,1,1],i=[1,1,1],s=[1,-1,1],o=[-1,-1,1],a=V(n,n,e),l=V(i,i,e),c=V(s,s,e),u=V(o,o,e);return new Gc(a,l,c,u,t/r)}}function Zc(e,t,r){let n=1/0,i=-1/0;const s=[];for(const o of e){Z(s,o,t);const e=z(s,r);n=Math.min(n,e),i=Math.max(i,e)}return[n,i]}function Kc(e,t){let r=!0;for(let n=0;n<e.planes.length;n++){const i=e.planes[n];let s=0;for(let e=0;e<t.length;e++)s+=+(z(i,t[e])+i[3]>=0);if(0===s)return 0;s!==t.length&&(r=!1)}return r?2:1}function Yc(e,t){for(const r of e.projections){const n=Zc(t,e.points[0],r.axis);if(r.projection[1]<n[0]||r.projection[0]>n[1])return 0}return 1}function Xc(e,t){let r=0;const n=[0,0,0,0];for(let o=0;o<e.length;o++)n[0]=e[o][0],n[1]=e[o][1],n[2]=e[o][2],n[3]=1,(i=n)[0]*(s=t)[0]+i[1]*s[1]+i[2]*s[2]+i[3]*s[3]>=0&&r++;var i,s;return r}class Jc{constructor(e,t){this.points=e||new Array(8).fill([0,0,0]),this.planes=t||new Array(6).fill([0,0,0,0]),this.bounds=Qc.fromPoints(this.points),this.projections=[],this.frustumEdges=[Z([],this.points[2],this.points[3]),Z([],this.points[0],this.points[3]),Z([],this.points[4],this.points[0]),Z([],this.points[5],this.points[1]),Z([],this.points[6],this.points[2]),Z([],this.points[7],this.points[3])];for(const r of this.frustumEdges){const e=[0,-r[2],r[1]],t=[r[2],0,-r[0]];this.projections.push({axis:e,projection:Zc(this.points,this.points[0],e)}),this.projections.push({axis:t,projection:Zc(this.points,this.points[0],t)})}}static fromInvProjectionMatrix(e,t,r,n){const i=Math.pow(2,r),s=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(r=>{const s=$([],r,e),o=1/s[3]/t*i;return(a=s)[0]=(l=s)[0]*(c=[o,o,n?1/s[3]:o,o])[0],a[1]=l[1]*c[1],a[2]=l[2]*c[2],a[3]=l[3]*c[3],a;var a,l,c}),o=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(e=>{const t=O([],B([],Z([],s[e[0]],s[e[1]]),Z([],s[e[2]],s[e[1]]))),r=-z(t,s[e[1]]);return t.concat(r)}),a=[];for(let l=0;l<s.length;l++)a.push([s[l][0],s[l][1],s[l][2]]);return new Jc(a,o)}intersectsPrecise(e,t,r){for(let n=0;n<t.length;n++)if(!Xc(e,t[n]))return 0;for(let n=0;n<this.planes.length;n++)if(!Xc(e,this.planes[n]))return 0;for(const n of r)for(const t of this.frustumEdges){const r=B([],n,t),i=S(r);if(0===i)continue;P(r,r,1/i);const s=Zc(this.points,this.points[0],r),o=Zc(e,this.points[0],r);if(s[0]>o[1]||o[0]>s[1])return 0}return 1}containsPoint(e){for(const t of this.planes){const r=t[3];if(z([t[0],t[1],t[2]],e)+r<0)return!1}return!0}}class Qc{static fromPoints(e){const t=[1/0,1/0,1/0],r=[-1/0,-1/0,-1/0];for(const n of e)N(t,t,n),I(r,r,n);return new Qc(t,r)}static fromTileIdAndHeight(e,t,r){const n=1<<e.canonical.z,i=e.canonical.x,s=e.canonical.y;return new Qc([i/n,s/n,t],[(i+1)/n,(s+1)/n,r])}static applyTransform(e,t){const r=e.getCorners();for(let n=0;n<r.length;++n)V(r[n],r[n],t);return Qc.fromPoints(r)}static applyTransformFast(e,t){const r=[t[12],t[13],t[14]],n=[...r];for(let i=0;i<3;i++)for(let s=0;s<3;s++){const o=t[4*s+i],a=o*e.min[s],l=o*e.max[s];r[i]+=Math.min(a,l),n[i]+=Math.max(a,l)}return new Qc(r,n)}static projectAabbCorners(e,t){const r=e.getCorners();for(let n=0;n<r.length;++n)V(r[n],r[n],t);return r}constructor(e,t){this.min=e,this.max=t,this.center=P([],A([],this.min,this.max),.5)}quadrant(e){const t=[e%2==0,e<2],r=j(this.min),n=j(this.max);for(let i=0;i<t.length;i++)r[i]=t[i]?this.min[i]:this.center[i],n[i]=t[i]?this.center[i]:this.max[i];return n[2]=this.max[2],new Qc(r,n)}distanceX(e){return Math.max(Math.min(this.max[0],e[0]),this.min[0])-e[0]}distanceY(e){return Math.max(Math.min(this.max[1],e[1]),this.min[1])-e[1]}distanceZ(e){return Math.max(Math.min(this.max[2],e[2]),this.min[2])-e[2]}getCorners(){const e=this.min,t=this.max;return[[e[0],e[1],e[2]],[t[0],e[1],e[2]],[t[0],t[1],e[2]],[e[0],t[1],e[2]],[e[0],e[1],t[2]],[t[0],e[1],t[2]],[t[0],t[1],t[2]],[e[0],t[1],t[2]]]}intersects(e){return this.intersectsAabb(e.bounds)?Kc(e,this.getCorners()):0}intersectsFlat(e){return this.intersectsAabb(e.bounds)?Kc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(e,t){return t||this.intersects(e)?Yc(e,this.getCorners()):0}intersectsPreciseFlat(e,t){return t||this.intersectsFlat(e)?Yc(e,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(e){for(let t=0;t<3;++t)if(this.min[t]>e.max[t]||e.min[t]>this.max[t])return!1;return!0}intersectsAabbXY(e){return!(this.min[0]>e.max[0]||e.min[0]>this.max[0]||this.min[1]>e.max[1]||e.min[1]>this.max[1])}encapsulate(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e.min[t]),this.max[t]=Math.max(this.max[t],e.max[t])}encapsulatePoint(e){for(let t=0;t<3;t++)this.min[t]=Math.min(this.min[t],e[t]),this.max[t]=Math.max(this.max[t],e[t])}closestPoint(e){return[Math.max(Math.min(this.max[0],e[0]),this.min[0]),Math.max(Math.min(this.max[1],e[1]),this.min[1]),Math.max(Math.min(this.max[2],e[2]),this.min[2])]}}$s(Qc,"Aabb");class $c{constructor(e,t){this.feature=e,this.metersToTile=t,this.index=0}get(){const e=this.feature.vertices[this.index],t=this.feature.vertexProps[this.index].dir,r=t[1],n=-t[0],i=(e.extent+1)*this.metersToTile;return[new Se(Math.trunc(e.position[0]+r*i),Math.trunc(e.position[1]+n*i)),new Se(Math.trunc(e.position[0]-r*i),Math.trunc(e.position[1]-n*i))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class eu{constructor(e,t,r,n,i,s){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[ce(),ce(),ce(),ce(),ce(),ce(),ce()],this.id=e,this.heightRange={min:r,max:r},this.safeArea=t,this.constantHeight=r,null==this.constantHeight&&(null!=this.constantHeight||0!==n.length)){this.vertices=n,this.edges=i,this.edges=this.edges.filter(e=>{return e.a<this.vertices.length&&e.b<this.vertices.length&&!((t=this.vertices[e.a].position)[0]===(r=this.vertices[e.b].position)[0]&&t[1]===r[1]);var t,r}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const e of this.vertices)this.vertexProps.push({dir:ue(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,e.height),this.heightRange.max=Math.max(this.heightRange.max,e.height);for(const e of this.edges){const t=this.vertices[e.a].position,r=this.vertices[e.b].position,n=pe(ce(),r,t),i=fe(n),s=me(ce(),n,1/i);this.edgeProps.push({vec:n,dir:s,len:i});const o=this.vertexProps[e.a].dir,a=this.vertexProps[e.b].dir;he(o,o,s),he(a,a,s)}for(const e of this.vertexProps)0===e.dir[0]&&0===e.dir[1]||ge(e.dir,e.dir);this.tessellate(s)}}pointElevation(e){if(null!=this.constantHeight)return this.constantHeight;const t=this.getClosestEdge(e);if(null==t)return 0;const[r,n]=t;return hr(this.vertices[this.edges[r].a].height,this.vertices[this.edges[r].b].height,n)}computeSlopeNormal(e,t){const r=this.getClosestEdge(e);if(!r)return T(0,0,1);const n=r[0],i=this.edges[n],s=this.edgeProps[n].vec,o=T(s[0],s[1],(this.vertices[i.b].height-this.vertices[i.a].height)*t),a=T(o[1],-o[0],0);B(a,a,o);const l=S(a);return l>0?P(a,a,1/l):k(a,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(e){if(0===this.edges.length)return;let t=0,r=Number.POSITIVE_INFINITY,n=0;const[i,s,o,a,l,c,u]=this._tmpVec2;de(u,e.x,e.y);const d=new Wc(u,null);for(let h=0;h<this.edges.length;h++){const e=this.edges[h],p=this.edgeProps[h].dir;d.dir=p;const m=this.vertices[e.a].position,f=this.vertices[e.b].position,g=d.intersectsPlane(m,this.vertexProps[e.a].dir,i),y=d.intersectsPlane(f,this.vertexProps[e.b].dir,s);if(!g||!y)continue;pe(o,s,i),pe(a,u,i);const _=ye(o,o),v=_>0?ye(a,o)/_:0,x=Le(v,0,1),b=Math.abs((v-x)*this.edgeProps[h].len);pe(l,u,m),de(c,p[1],-p[0]);const w=b+Math.abs(ye(l,c));w<r&&(t=h,r=w,n=x)}return[t,n]}tessellate(e){const t=w(),r=w(),n=w(),i=w();for(let s=this.edges.length-1;s>=0;--s){const o=this.edges[s].a,a=this.edges[s].b,{position:l,height:c,extent:u}=this.vertices[o],{position:d,height:h,extent:p}=this.vertices[a],m=this.vertexProps[o].dir,f=this.vertexProps[a].dir;if(k(t,l[0]/e,l[1]/e,c),k(r,d[0]/e,d[1]/e,h),k(n,m[1],-m[0],0),P(n,n,u),k(i,f[1],-f[0],0),P(i,i,p),this.distSqLines(T(t[0]+.5*n[0],t[1]+.5*n[1],t[2]+.5*n[2]),T(r[0]-.5*i[0],r[1]-.5*i[1],r[2]-.5*i[2]),T(t[0]-.5*n[0],t[1]-.5*n[1],t[2]-.5*n[2]),T(r[0]+.5*i[0],r[1]+.5*i[1],r[2]+.5*i[2]))<=.0025000000000000005)continue;const g=this.vertices.length,y=he(ce(),l,d);this.vertices.push({position:me(y,y,.5),height:.5*(c+h),extent:.5*(u+p)});const _=he(ce(),m,f);this.vertexProps.push({dir:ge(_,_)}),this.edges.splice(s,1),this.edgeProps.splice(s,1),this.edges.push({a:o,b:g}),this.edges.push({a:g,b:a});const v=pe(ce(),this.vertices[g].position,l),x=fe(v),b={vec:v,dir:me(ce(),v,1/x),len:x};this.edgeProps.push(b),this.edgeProps.push(b)}}distSqLines(e,t,r,n){const i=C(w(),t,e),s=C(w(),n,r),o=C(w(),e,r),a=z(i,i),l=z(i,s),c=z(i,o),u=z(s,s),d=z(s,o),h=a*u-l*l;if(0===h)return R(U(i,r,n,z(o,s)/z(s,s)),e);const p=(a*d-l*c)/h;return R(U(i,e,t,(l*d-c*u)/h),U(s,r,n,p))}}class tu{static parseFrom(e,t){const r=qc.parse(e);if(!r)return[];let{vertices:n,features:i}=r;const s=1/vc(t);i.sort((e,t)=>e.id-t.id),n.sort((e,t)=>e.id-t.id||e.idx-t.idx),n=n.filter((e,t,r)=>t===r.findIndex(t=>t.id===e.id&&t.idx===e.idx));const o=new Array;let a=0;const l=n.length;for(const c of i){if(c.constantHeight){o.push(new eu(c.id,c.bounds,c.constantHeight));continue}for(;a!==l&&n[a].id<c.id;)a++;if(a===l||n[a].id!==c.id)continue;const e=new Array,t=new Array,r=a;for(;a!==l&&n[a].id===c.id;){const i=n[a];if(e.push({position:i.position,height:i.height,extent:i.extent}),a!==r&&n[a-1].idx===i.idx-1){const e=a-r;t.push({a:e-1,b:e})}a++}o.push(new eu(c.id,c.bounds,void 0,e,t,s))}return o}static getElevationFeature(e,t){if(!t)return;const r=+e.properties[Fc];return Number.isNaN(r)?void 0:t.find(e=>e.id===r)}}class ru{constructor(e,t){this.zScale=1,this.xOffset=0,this.yOffset=0,e.equals(t)||(this.zScale=Math.pow(2,t.z-e.z),this.xOffset=(e.x*this.zScale-t.x)*Bn,this.yOffset=(e.y*this.zScale-t.y)*Bn)}constantElevation(e,t){if(null!=e.constantHeight)return this.computeBiasedHeight(e.constantHeight,t)}pointElevation(e,t,r){const n=this.constantElevation(t,r);return null!=n?n:(e.x=e.x*this.zScale+this.xOffset,e.y=e.y*this.zScale+this.yOffset,this.computeBiasedHeight(t.pointElevation(e),r))}computeBiasedHeight(e,t){return t<=0?e:e+t*Re(0,t,e>=0?e:Math.abs(.5*e))}}$s(eu,"ElevationFeature");class nu{constructor(e){this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.projection=e.projection,this.layoutVertexArray=new pa,this.indexArray=new La,this.segments=new dl,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,"none"!==this.elevationMode&&(this.elevatedLayoutVertexArray=new ga),this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){const i=this.layers[0],s=[];let o=null;"circle"===i.type&&(o=i.layout.get("circle-sort-key"));for(const{feature:l,id:c,index:u,sourceLayerIndex:d}of e){const e=this.layers[0]._featureFilter.needGeometry,i=Ec(l,e);if(!this.layers[0]._featureFilter.filter(new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),i,r))continue;const a=o?o.evaluate(i,{},r):void 0,h={id:c,properties:l.properties,type:l.type,sourceLayerIndex:d,index:u,geometry:e?i.geometry:Cc(l,r,n),patterns:{},sortKey:a};s.push(h)}o&&s.sort((e,t)=>e.sortKey-t.sortKey);let a=null;"globe"===n.projection.name&&(this.globeExtVertexArray=new Sa,a=n.projection);for(const l of s){const{geometry:n,index:i,sourceLayerIndex:s}=l,o=e[i].feature;this.addFeature(l,n,i,t.availableImages,r,a,t.brightness,t.elevationFeatures),t.featureIndex.insert(o,n,i,s,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(e,t,r,n,i,s,o){this.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,ll.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,ul.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,cl.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(e,t,r,n,i,s,o,a){let l;"none"!==this.elevationMode&&(l=tu.getElevationFeature(e,a));for(const c of t)for(const t of c){const r=t.x,n=t.y;if(r<0||r>=Bn||n<0||n>=Bn)continue;if(s){const e=s.projectTilePoint(r,n,i),t=s.upVector(i,r,n);this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t),this.addGlobeExtVertex(e,t)}const o=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,e.sortKey),a=o.vertexLength;if(this.addCircleVertex(r,n,-1,-1),this.addCircleVertex(r,n,1,-1),this.addCircleVertex(r,n,1,1),this.addCircleVertex(r,n,-1,1),"none"!==this.elevationMode){const e=l?l.pointElevation(new Se(r,n)):0;this.hasElevation=this.hasElevation||0!==e;for(let t=0;t<4;t++)this.elevatedLayoutVertexArray.emplaceBack(e)}this.indexArray.emplaceBack(a,a+1,a+2),this.indexArray.emplaceBack(a,a+2,a+3),o.vertexLength+=4,o.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,{},n,i,o,void 0,this.worldview)}addCircleVertex(e,t,r,n){this.layoutVertexArray.emplaceBack(2*e+(r+1)/2,2*t+(n+1)/2)}addGlobeExtVertex(e,t){const r=16384;this.globeExtVertexArray.emplaceBack(e.x,e.y,e.z,t[0]*r,t[1]*r,t[2]*r)}}function iu(e,t){for(let r=0;r<e.length;r++)if(fu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(fu(e,t[r]))return!0;return!!lu(e,t)}function su(e,t,r){return!!fu(e,t)||!!hu(t,e,r)}function ou(e,t){if(1===e.length)return mu(t,e[0]);for(let r=0;r<t.length;r++){const n=t[r];for(let t=0;t<n.length;t++)if(fu(e,n[t]))return!0}for(let r=0;r<e.length;r++)if(mu(t,e[r]))return!0;for(let r=0;r<t.length;r++)if(lu(e,t[r]))return!0;return!1}function au(e,t,r){if(e.length>1){if(lu(e,t))return!0;for(let n=0;n<t.length;n++)if(hu(t[n],e,r))return!0}for(let n=0;n<e.length;n++)if(hu(e[n],t,r))return!0;return!1}function lu(e,t){if(0===e.length||0===t.length)return!1;for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)if(cu(n,i,t[e],t[e+1]))return!0}return!1}function cu(e,t,r,n){return Ke(e,r,n)!==Ke(t,r,n)&&Ke(e,t,r)!==Ke(e,t,n)}function uu(e,t,r){return(e.x-r.x)*(t.y-r.y)-(e.y-r.y)*(t.x-r.x)}function du(e,t,r,n){const i=uu(e,t,n),s=uu(e,t,r);if(Math.sign(i)===Math.sign(s))return;const o=uu(r,n,e),a=o+s-i;return Math.sign(o)!==Math.sign(a)?[o/(o-a),s/(s-i)]:void 0}function hu(e,t,r){const n=r*r;if(1===t.length)return e.distSqr(t[0])<n;for(let i=1;i<t.length;i++)if(pu(e,t[i-1],t[i])<n)return!0;return!1}function pu(e,t,r){const n=t.distSqr(r);if(0===n)return e.distSqr(t);const i=((e.x-t.x)*(r.x-t.x)+(e.y-t.y)*(r.y-t.y))/n;return e.distSqr(i<0?t:i>1?r:r.sub(t)._mult(i)._add(t))}function mu(e,t){let r,n,i,s=!1;for(let o=0;o<e.length;o++){r=e[o];for(let e=0,o=r.length-1;e<r.length;o=e++)n=r[e],i=r[o],n.y>t.y!=i.y>t.y&&t.x<(i.x-n.x)*(t.y-n.y)/(i.y-n.y)+n.x&&(s=!s)}return s}function fu(e,t){let r=!1;for(let n=0,i=e.length-1;n<e.length;i=n++){const s=e[n],o=e[i];s.y>t.y!=o.y>t.y&&t.x<(o.x-s.x)*(t.y-s.y)/(o.y-s.y)+s.x&&(r=!r)}return r}function gu(e,t,r,n,i){for(const o of e)if(t<=o.x&&r<=o.y&&n>=o.x&&i>=o.y)return!0;const s=[new Se(t,r),new Se(t,i),new Se(n,i),new Se(n,r)];if(e.length>2)for(const o of s)if(fu(e,o))return!0;for(let o=0;o<e.length-1;o++)if(yu(e[o],e[o+1],s))return!0;return!1}function yu(e,t,r){const n=r[0],i=r[2];if(e.x<n.x&&t.x<n.x||e.x>i.x&&t.x>i.x||e.y<n.y&&t.y<n.y||e.y>i.y&&t.y>i.y)return!1;const s=Ke(e,t,r[0]);return s!==Ke(e,t,r[1])||s!==Ke(e,t,r[2])||s!==Ke(e,t,r[3])}function _u(e,t,r,n,i,s){let o=t.y-e.y,a=e.x-t.x;if(s=s||0){const e=o*o+a*a;if(0===e)return!0;const t=Math.sqrt(e);o/=t,a/=t}return!((r.x-e.x)*o+(r.y-e.y)*a-s<0||(n.x-e.x)*o+(n.y-e.y)*a-s<0||(i.x-e.x)*o+(i.y-e.y)*a-s<0)}function vu(e,t,r,n,i,s,o){return!(_u(e,t,n,i,s,o)||_u(t,r,n,i,s,o)||_u(r,e,n,i,s,o)||_u(n,i,e,t,r,o)||_u(i,s,e,t,r,o)||_u(s,n,e,t,r,o))}function xu(e,t,r){const n=t.paint.get(e).value;return"constant"===n.kind?n.value:r.programConfigurations.get(t.id).getMaxValue(e)}function bu(e){return Math.sqrt(e[0]*e[0]+e[1]*e[1])}function wu(e,t,r,n,i){if(!t[0]&&!t[1])return e;const s=Se.convert(t)._mult(i);"viewport"===r&&s._rotate(-n);const o=[];for(let a=0;a<e.length;a++)o.push(e[a].sub(s));return o}function ju(e,t,r,n){const i=Se.convert(e)._mult(n);return"viewport"===t&&i._rotate(-r),i}let Su,Tu;function ku(e,t,r){var n=2*Math.PI*6378137/256/Math.pow(2,r);return[e*n-2*Math.PI*6378137/2,t*n-2*Math.PI*6378137/2]}$s(nu,"CircleBucket",{omit:["layers"]});class Au{constructor(e,t,r){this.z=e,this.x=t,this.y=r,this.key=Nu(0,e,e,t,r)}equals(e){return this.z===e.z&&this.x===e.x&&this.y===e.y}isChildOf(e){const t=this.z-e.z;return 0===e.z||e.z<this.z&&e.x===this.x>>t&&e.y===this.y>>t}url(e,t){const r=function(e,t,r){var n=ku(256*e,256*(t=Math.pow(2,r)-t-1),r),i=ku(256*(e+1),256*(t+1),r);return n[0]+","+n[1]+","+i[0]+","+i[1]}(this.x,this.y,this.z),n=function(e,t,r){let n,i="";for(let s=e;s>0;s--)n=1<<s-1,i+=(t&n?1:0)+(r&n?2:0);return i}(this.z,this.x,this.y);return e[(this.x+this.y)%e.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String("tms"===t?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",n).replace("{bbox-epsg-3857}",r)}toString(){return"".concat(this.z,"/").concat(this.x,"/").concat(this.y)}}class Cu{constructor(e,t){this.wrap=e,this.canonical=t,this.key=Nu(e,t.z,t.z,t.x,t.y)}}class Eu{constructor(e,t,r,n,i){this.overscaledZ=e,this.wrap=t,this.canonical=new Au(r,+n,+i),this.key=0===t&&e===r?this.canonical.key:Nu(t,e,r,n,i)}equals(e){return this.overscaledZ===e.overscaledZ&&this.wrap===e.wrap&&this.canonical.equals(e.canonical)}scaledTo(e){const t=this.canonical.z-e;return e>this.canonical.z?new Eu(e,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Eu(e,this.wrap,e,this.canonical.x>>t,this.canonical.y>>t)}calculateScaledKey(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(this.overscaledZ===e&&t)return this.key;if(e>this.canonical.z)return Nu(this.wrap*+t,e,this.canonical.z,this.canonical.x,this.canonical.y);{const r=this.canonical.z-e;return Nu(this.wrap*+t,e,e,this.canonical.x>>r,this.canonical.y>>r)}}isChildOf(e){if(e.wrap!==this.wrap)return!1;const t=this.canonical.z-e.canonical.z;return 0===e.overscaledZ||e.overscaledZ<this.overscaledZ&&e.canonical.z<this.canonical.z&&e.canonical.x===this.canonical.x>>t&&e.canonical.y===this.canonical.y>>t}children(e){if(this.overscaledZ>=e)return[new Eu(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const t=this.canonical.z+1,r=2*this.canonical.x,n=2*this.canonical.y;return[new Eu(t,this.wrap,t,r,n),new Eu(t,this.wrap,t,r+1,n),new Eu(t,this.wrap,t,r,n+1),new Eu(t,this.wrap,t,r+1,n+1)]}isLessThan(e){return this.wrap<e.wrap||!(this.wrap>e.wrap)&&(this.overscaledZ<e.overscaledZ||!(this.overscaledZ>e.overscaledZ)&&(this.canonical.x<e.canonical.x||!(this.canonical.x>e.canonical.x)&&this.canonical.y<e.canonical.y))}wrapped(){return new Eu(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(e){return new Eu(this.overscaledZ,e,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Cu(this.wrap,this.canonical)}toString(){return"".concat(this.overscaledZ,"/").concat(this.canonical.x,"/").concat(this.canonical.y)}}function Nu(e,t,r,n,i){const s=1<<Math.min(r,22);let o=s*(i%s)+n%s;return e&&r<22&&(o+=s*s*((e<0?-2*e-1:2*e)%(1<<2*(22-r)))),16*(32*o+r)+(t-r)}const Iu=[e=>{let t=e.canonical.x-1,r=e.wrap;return t<0&&(t=(1<<e.canonical.z)-1,r--),new Eu(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>{let t=e.canonical.x+1,r=e.wrap;return t===1<<e.canonical.z&&(t=0,r++),new Eu(e.overscaledZ,r,e.canonical.z,t,e.canonical.y)},e=>new Eu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,(0===e.canonical.y?1<<e.canonical.z:e.canonical.y)-1),e=>new Eu(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y===(1<<e.canonical.z)-1?0:e.canonical.y+1)];$s(Au,"CanonicalTileID"),$s(Eu,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Pu=da([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Mu}=Pu,Lu=da([{name:"a_pos_3",components:3,type:"Int16"}]);var Ru=da([{name:"a_pos",type:"Int16",components:2}]);function Du(e){return e*Gl/rc}const Fu=[new Qc([Ql,Ql,Ql],[$l,$l,$l]),new Qc([Ql,Ql,Ql],[0,0,$l]),new Qc([0,Ql,Ql],[$l,0,$l]),new Qc([Ql,0,Ql],[0,$l,$l]),new Qc([0,0,Ql],[$l,$l,$l])];function Ou(e,t,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=P([],e._camera.position,e.worldSize),s=[t,r,1,1];$(s,s,e.pixelMatrixInverse),J(s,s,1/s[3]);const o=O([],Z([],s,i)),a=e.globeMatrix,l=[a[12],a[13],a[14]],c=Z([],l,i),u=S(c),d=O([],c),h=e.worldSize/(2*Math.PI),p=z(d,o),m=Math.asin(h/u);if(m<Math.acos(p)){if(!n)return null;const e=[],t=[];P(e,o,u/p),O(t,Z(t,e,c)),O(o,A(o,c,P(o,t,Math.tan(m)*u)))}const f=[];new Hc(i,o).closestPointOnSphere(l,h,f);const g=O([],et(a,0)),y=O([],et(a,1)),_=O([],et(a,2)),v=z(g,f),x=z(y,f),b=z(_,f),w=Ee(Math.asin(-x/h));let j=Ee(Math.atan2(v,b));j=e.center.lng+function(e,t){const r=(t-e+180)%360-180;return r<-180?r+360:r}(e.center.lng,j);const T=cc(j),k=Le(uc(w),0,1);return new xc(T,k)}class zu{constructor(e,t,r){this.a=Z([],e,r),this.b=Z([],t,r),this.center=r;const n=O([],this.a),i=O([],this.b);this.angle=Math.acos(z(n,i))}}function Bu(e,t){if(0===e.angle)return null;let r;return r=0===e.a[t]?1/e.angle*.5*Math.PI:1/e.angle*Math.atan(e.b[t]/e.a[t]/Math.sin(e.angle)-1/Math.tan(e.angle)),r<0||r>1?null:function(e,t,r,n){const i=Math.sin(r);return e*(Math.sin((1-n)*r)/i)+t*(Math.sin(n*r)/i)}(e.a[t],e.b[t],e.angle,Le(r,0,1))+e.center[t]}function Uu(e){if(e.z<=1)return Fu[e.z+2*e.y+e.x];const t=Gu(Hu(e));return Qc.fromPoints(t)}function Vu(e,t,r){return P(e,e,1-r),M(e,e,t,r)}function qu(e,t,r){for(const n of e)V(n,n,t),P(n,n,r)}function Wu(e,t,r,n){const i=t/e.worldSize,s=e.globeMatrix;if(r.z<=1){const e=Uu(r).getCorners();return qu(e,s,i),Qc.fromPoints(e)}const o=Hu(r,n),a=Gu(o,Gl+Du(e._tileCoverLift));qu(a,s,i);const l=Number.MAX_VALUE,c=[-l,-l,-l],u=[l,l,l];if(o.contains(e.center)){for(const e of a)N(u,u,e),I(c,c,e);c[2]=0;const t=e.point,r=[t.x*i,t.y*i,0];return N(u,u,r),I(c,c,r),new Qc(u,c)}if(e._tileCoverLift>0){for(const e of a)N(u,u,e),I(c,c,e);return new Qc(u,c)}const d=[s[12]*i,s[13]*i,s[14]*i],h=o.getCenter(),p=Le(e.center.lat,-fc,fc),m=Le(h.lat,-fc,fc),f=cc(e.center.lng),g=uc(p);let y=f-cc(h.lng);const _=g-uc(m);y>.5?y-=1:y<-.5&&(y+=1);let v=0;Math.abs(y)>Math.abs(_)?v=y>=0?1:3:(v=_>=0?0:2,M(d,d,[s[4]*i,s[5]*i,s[6]*i],-Math.sin(Ce(_>=0?o.getSouth():o.getNorth()))*Gl));const x=a[v],b=a[(v+1)%4],w=new zu(x,b,d),j=[Bu(w,0)||x[0],Bu(w,1)||x[1],Bu(w,2)||x[2]],S=td(e.zoom);if(S>0){const n=function(e,t,r,n,i){let{x:s,y:o,z:a}=e;const l=1/(1<<a);let c=s*l,u=c+l,d=o*l,h=d+l,p=0;const m=(c+u)/2-n;return m>.5?p=-1:m<-.5&&(p=1),c=((c+p)*t-(n*=t))*r+n,u=((u+p)*t-n)*r+n,d=(d*t-(i*=t))*r+i,h=(h*t-i)*r+i,[[c,h,0],[u,h,0],[u,d,0],[c,d,0]]}(r,t,e._pixelsPerMercatorPixel,f,g);for(let e=0;e<a.length;e++)Vu(a[e],n[e],S);const i=A([],n[v],n[(v+1)%4]);P(i,i,.5),Vu(j,i,S)}for(const T of a)N(u,u,T),I(c,c,T);return u[2]=Math.min(x[2],b[2]),N(u,u,j),I(c,c,j),new Qc(u,c)}function Hu(e){let{x:t,y:r,z:n}=e,i=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const s=1/(1<<n),o=new ic(hc(t*s),r===(1<<n)-1&&i?-90:pc((r+1)*s)),a=new ic(hc((t+1)*s),0===r&&i?90:pc(r*s));return new sc(o,a)}function Gu(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gl;const r=Ce(e.getNorth()),n=Ce(e.getSouth()),i=Math.cos(r),s=Math.cos(n),o=Math.sin(r),a=Math.sin(n),l=e.getWest(),c=e.getEast();return[ec(s,a,l,t),ec(s,a,c,t),ec(i,o,c,t),ec(i,o,l,t)]}function Zu(e,t,r,n){const i=1<<r.z,s=(e/Bn+r.x)/i;return tc(pc((t/Bn+r.y)/i),hc(s),n)}function Ku(e){let{min:t,max:r}=e;return Yl/Math.max(r[0]-t[0],r[1]-t[1],r[2]-t[2])}const Yu=new Float64Array(16);function Xu(e){const t=Ku(e),r=y(Yu,[t,t,t]);return h(r,r,F([],e.min))}function Ju(e){const t=(n=e.min,(r=Yu)[0]=1,r[1]=0,r[2]=0,r[3]=0,r[4]=0,r[5]=1,r[6]=0,r[7]=0,r[8]=0,r[9]=0,r[10]=1,r[11]=0,r[12]=n[0],r[13]=n[1],r[14]=n[2],r[15]=1,r);var r,n;const i=1/Ku(e);return p(t,t,[i,i,i])}function Qu(e){const t=Bn/(2*Math.PI);return e/(2*Math.PI)/t}function $u(e,t){return Bn/(512*Math.pow(2,e))*Ku(Uu(t))}function ed(e,t,r,n,i){const s=Qu(r),o=[e,t,-r/(2*Math.PI)],a=c(new Float64Array(16));return h(a,a,o),p(a,a,[s,s,s]),m(a,a,Ce(-i)),f(a,a,Ce(-n)),a}function td(e){return Re(Zl,Kl,e)}function rd(e,t){const r=tc(t.lat,t.lng),n=function(e){const t=tc(e._center.lat,e._center.lng);let r=B([],T(0,1,0),t);const n=_([],-e.angle,t);r=V(r,r,n),_(n,-e._pitch,r);const i=O([],t);return P(i,i,Du(e.cameraToCenterDistance/e.pixelsPerMeter)),V(i,i,n),A([],t,i)}(e);return o=(i=C([],n,r))[0],a=i[1],l=i[2],c=(s=r)[0],u=s[1],d=s[2],p=(h=Math.sqrt((o*o+a*a+l*l)*(c*c+u*u+d*d)))&&z(i,s)/h,Math.acos(Math.min(Math.max(p,-1),1));var i,s,o,a,l,c,u,d,h,p}function nd(e,t){return rd(e,t)>Math.PI/2*1.01}const id=Ce(85),sd=Math.cos(id),od=Math.sin(id),ad=a(),ld=e=>{const t=[];return"map"===e.paint.get("circle-pitch-alignment")&&t.push("PITCH_WITH_MAP"),"map"===e.paint.get("circle-pitch-scale")&&t.push("SCALE_WITH_MAP"),t};function cd(e,t,r,n,i,s,o,a,l){if(s&&e.queryGeometry.isAboveHorizon)return!1;s&&(l*=e.pixelToTileUnitsFactor);const c=e.tileID.canonical,u=r.projection.upVectorScale(c,r.center.lat,r.worldSize).metersToTile;for(const d of t)for(const t of d){const d=t.add(a),h=i&&r.elevation?r.elevation.exaggeration()*i.getElevationAt(d.x,d.y,!0):0,p=r.projection.projectTilePoint(d.x,d.y,c);if(h>0){const e=r.projection.upVector(c,d.x,d.y);p.x+=e[0]*u*h,p.y+=e[1]*u*h,p.z+=e[2]*u*h}const m=s?d:ud(p.x,p.y,p.z,n),f=s?e.tilespaceRays.map(e=>pd(e,h)):e.queryGeometry.screenGeometry,g=$([],[p.x,p.y,p.z,1],n);if(!o&&s?l*=g[3]/r.cameraToCenterDistance:o&&!s&&(l*=r.cameraToCenterDistance/g[3]),s){const e=pc((t.y/Bn+c.y)/(1<<c.z));l/=r.projection.pixelsPerMeter(e,1)/dc(1,e)}if(su(f,m,l))return!0}return!1}function ud(e,t,r,n){const i=$([],[e,t,r,1],n);return new Se(i[0]/i[3],i[1]/i[3])}const dd=T(0,0,0),hd=T(0,0,1);function pd(e,t){const r=w();return dd[2]=t,e.intersectsPlane(dd,hd,r),new Se(r[0],r[1])}class md extends nu{}let fd,gd,yd,_d;function vd(e,t,r,n){let{width:i,height:s}=t;if(n){if(n instanceof Uint8ClampedArray)n=new Uint8Array(n.buffer);else if(n.length!==i*s*r)throw new RangeError("mismatched image size")}else n=new Uint8Array(i*s*r);return e.width=i,e.height=s,e.data=n,e}function xd(e,t,r){const{width:n,height:i}=t;n===e.width&&i===e.height||(bd(e,t,{x:0,y:0},{x:0,y:0},{width:Math.min(e.width,n),height:Math.min(e.height,i)},r,null),e.width=n,e.height=i,e.data=t.data)}function bd(e,t,r,n,i,s,o,a){if(0===i.width||0===i.height)return t;if(i.width>e.width||i.height>e.height||r.x>e.width-i.width||r.y>e.height-i.height)throw new RangeError("out of range source coordinates for image copy");if(i.width>t.width||i.height>t.height||n.x>t.width-i.width||n.y>t.height-i.height)throw new RangeError("out of range destination coordinates for image copy");const l=e.data,c=t.data,u=4===s&&a;for(let d=0;d<i.height;d++){const a=((r.y+d)*e.width+r.x)*s,h=((n.y+d)*t.width+n.x)*s;if(u)for(let e=0;e<i.width;e++){const t=a+e*s+3,r=h+e*s;c[r+0]=255,c[r+1]=255,c[r+2]=255,c[r+3]=l[t]}else if(o)for(let e=0;e<i.width;e++){const t=a+e*s,r=h+e*s,n=new lr(l[t+0]/255,l[t+1]/255,l[t+2]/255,l[t+3]).toNonPremultipliedRenderColor(o).toArray();c[r+0]=n[0],c[r+1]=n[1],c[r+2]=n[2],c[r+3]=n[3]}else for(let e=0;e<i.width*s;e++)c[h+e]=l[a+e]}return t}$s(md,"HeatmapBucket",{omit:["layers"]});class wd{constructor(e,t){vd(this,e,1,t)}resize(e){xd(this,new wd(e),1)}clone(){return new wd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i){bd(e,t,r,n,i,1,null)}}class jd{constructor(e,t){vd(this,e,4,t)}resize(e){xd(this,new jd(e),4)}replace(e,t){t?this.data.set(e):this.data=e instanceof Uint8ClampedArray?new Uint8Array(e.buffer):e}clone(){return new jd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(e,t,r,n,i,s,o){bd(e,t,r,n,i,4,s,o)}}class Sd{constructor(e,t){this.width=e.width,this.height=e.height,this.data=t instanceof Uint8Array?new Float32Array(t.buffer):t}}function Td(e){const t={},r=e.resolution||256,n=e.clips?e.clips.length:1,i=e.image||new jd({width:r,height:n}),s=(r,n,s)=>{t[e.evaluationKey]=s;const o=e.expression.evaluate(t),a=o?o.toNonPremultipliedRenderColor(null):null;a&&(i.data[r+n+0]=Math.floor(255*a.r),i.data[r+n+1]=Math.floor(255*a.g),i.data[r+n+2]=Math.floor(255*a.b),i.data[r+n+3]=Math.floor(255*a.a))};if(e.clips)for(let o=0,a=0;o<n;++o,a+=4*r)for(let t=0,n=0;t<r;t++,n+=4){const i=t/(r-1),{start:l,end:c}=e.clips[o];s(a,n,l*(1-i)+c*i)}else for(let o=0,a=0;o<r;o++,a+=4)s(0,a,o/(r-1));return i}$s(wd,"AlphaImage"),$s(jd,"RGBAImage");const kd=da([{name:"a_pos",components:2,type:"Int16"}],4),Ad=da([{name:"a_road_z_offset",components:1,type:"Float32"}],4),Cd=da([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Ed=da([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Nd(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:2;const n=t&&t.length,i=n?t[0]*r:e.length;let s=Id(e,0,i,r,!0);const o=[];if(!s||s.next===s.prev)return o;let a,l,c;if(n&&(s=function(e,t,r,n){const i=[];for(let s=0,o=t.length;s<o;s++){const r=Id(e,t[s]*n,s<o-1?t[s+1]*n:e.length,n,!1);r===r.next&&(r.steiner=!0),i.push(Vd(r))}i.sort(Od);for(let s=0;s<i.length;s++)r=zd(i[s],r);return r}(e,t,s,r)),e.length>80*r){a=e[0],l=e[1];let t=a,n=l;for(let s=r;s<i;s+=r){const r=e[s],i=e[s+1];r<a&&(a=r),i<l&&(l=i),r>t&&(t=r),i>n&&(n=i)}c=Math.max(t-a,n-l),c=0!==c?32767/c:0}return Md(s,o,r,a,l,c,0),o}function Id(e,t,r,n,i){let s;if(i===function(e,t,r,n){let i=0;for(let s=t,o=r-n;s<r;s+=n)i+=(e[o]-e[s])*(e[s+1]+e[o+1]),o=s;return i}(e,t,r,n)>0)for(let o=t;o<r;o+=n)s=$d(o/n|0,e[o],e[o+1],s);else for(let o=r-n;o>=t;o-=n)s=$d(o/n|0,e[o],e[o+1],s);return s&&Zd(s,s.next)&&(eh(s),s=s.next),s}function Pd(e,t){if(!e)return e;t||(t=e);let r,n=e;do{if(r=!1,n.steiner||!Zd(n,n.next)&&0!==Gd(n.prev,n,n.next))n=n.next;else{if(eh(n),n=t=n.prev,n===n.next)break;r=!0}}while(r||n!==t);return t}function Md(e,t,r,n,i,s,o){if(!e)return;!o&&s&&function(e,t,r,n){let i=e;do{0===i.z&&(i.z=Ud(i.x,i.y,t,r,n)),i.prevZ=i.prev,i.nextZ=i.next,i=i.next}while(i!==e);i.prevZ.nextZ=null,i.prevZ=null,function(e){let t,r=1;do{let n,i=e;e=null;let s=null;for(t=0;i;){t++;let o=i,a=0;for(let e=0;e<r&&(a++,o=o.nextZ,o);e++);let l=r;for(;a>0||l>0&&o;)0!==a&&(0===l||!o||i.z<=o.z)?(n=i,i=i.nextZ,a--):(n=o,o=o.nextZ,l--),s?s.nextZ=n:e=n,n.prevZ=s,s=n;i=o}s.nextZ=null,r*=2}while(t>1)}(i)}(e,n,i,s);let a=e;for(;e.prev!==e.next;){const l=e.prev,c=e.next;if(s?Rd(e,n,i,s):Ld(e))t.push(l.i,e.i,c.i),eh(e),e=c.next,a=c.next;else if((e=c)===a){o?1===o?Md(e=Dd(Pd(e),t),t,r,n,i,s,2):2===o&&Fd(e,t,r,n,i,s):Md(Pd(e),t,r,n,i,s,1);break}}}function Ld(e){const t=e.prev,r=e,n=e.next;if(Gd(t,r,n)>=0)return!1;const i=t.x,s=r.x,o=n.x,a=t.y,l=r.y,c=n.y,u=Math.min(i,s,o),d=Math.min(a,l,c),h=Math.max(i,s,o),p=Math.max(a,l,c);let m=n.next;for(;m!==t;){if(m.x>=u&&m.x<=h&&m.y>=d&&m.y<=p&&Wd(i,a,s,l,o,c,m.x,m.y)&&Gd(m.prev,m,m.next)>=0)return!1;m=m.next}return!0}function Rd(e,t,r,n){const i=e.prev,s=e,o=e.next;if(Gd(i,s,o)>=0)return!1;const a=i.x,l=s.x,c=o.x,u=i.y,d=s.y,h=o.y,p=Math.min(a,l,c),m=Math.min(u,d,h),f=Math.max(a,l,c),g=Math.max(u,d,h),y=Ud(p,m,t,r,n),_=Ud(f,g,t,r,n);let v=e.prevZ,x=e.nextZ;for(;v&&v.z>=y&&x&&x.z<=_;){if(v.x>=p&&v.x<=f&&v.y>=m&&v.y<=g&&v!==i&&v!==o&&Wd(a,u,l,d,c,h,v.x,v.y)&&Gd(v.prev,v,v.next)>=0)return!1;if(v=v.prevZ,x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==i&&x!==o&&Wd(a,u,l,d,c,h,x.x,x.y)&&Gd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}for(;v&&v.z>=y;){if(v.x>=p&&v.x<=f&&v.y>=m&&v.y<=g&&v!==i&&v!==o&&Wd(a,u,l,d,c,h,v.x,v.y)&&Gd(v.prev,v,v.next)>=0)return!1;v=v.prevZ}for(;x&&x.z<=_;){if(x.x>=p&&x.x<=f&&x.y>=m&&x.y<=g&&x!==i&&x!==o&&Wd(a,u,l,d,c,h,x.x,x.y)&&Gd(x.prev,x,x.next)>=0)return!1;x=x.nextZ}return!0}function Dd(e,t){let r=e;do{const n=r.prev,i=r.next.next;!Zd(n,i)&&Kd(n,r,r.next,i)&&Jd(n,i)&&Jd(i,n)&&(t.push(n.i,r.i,i.i),eh(r),eh(r.next),r=e=i),r=r.next}while(r!==e);return Pd(r)}function Fd(e,t,r,n,i,s){let o=e;do{let e=o.next.next;for(;e!==o.prev;){if(o.i!==e.i&&Hd(o,e)){let a=Qd(o,e);return o=Pd(o,o.next),a=Pd(a,a.next),Md(o,t,r,n,i,s,0),void Md(a,t,r,n,i,s,0)}e=e.next}o=o.next}while(o!==e)}function Od(e,t){let r=e.x-t.x;return 0===r&&(r=e.y-t.y,0===r)&&(r=(e.next.y-e.y)/(e.next.x-e.x)-(t.next.y-t.y)/(t.next.x-t.x)),r}function zd(e,t){const r=function(e,t){let r=t;const n=e.x,i=e.y;let s,o=-1/0;if(Zd(e,r))return r;do{if(Zd(e,r.next))return r.next;if(i<=r.y&&i>=r.next.y&&r.next.y!==r.y){const e=r.x+(i-r.y)*(r.next.x-r.x)/(r.next.y-r.y);if(e<=n&&e>o&&(o=e,s=r.x<r.next.x?r:r.next,e===n))return s}r=r.next}while(r!==t);if(!s)return null;const a=s,l=s.x,c=s.y;let u=1/0;r=s;do{if(n>=r.x&&r.x>=l&&n!==r.x&&qd(i<c?n:o,i,l,c,i<c?o:n,i,r.x,r.y)){const t=Math.abs(i-r.y)/(n-r.x);Jd(r,e)&&(t<u||t===u&&(r.x>s.x||r.x===s.x&&Bd(s,r)))&&(s=r,u=t)}r=r.next}while(r!==a);return s}(e,t);if(!r)return t;const n=Qd(r,e);return Pd(n,n.next),Pd(r,r.next)}function Bd(e,t){return Gd(e.prev,e,t.prev)<0&&Gd(t.next,e,e.next)<0}function Ud(e,t,r,n,i){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=(e-r)*i|0)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-n)*i|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function Vd(e){let t=e,r=e;do{(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),t=t.next}while(t!==e);return r}function qd(e,t,r,n,i,s,o,a){return(i-o)*(t-a)>=(e-o)*(s-a)&&(e-o)*(n-a)>=(r-o)*(t-a)&&(r-o)*(s-a)>=(i-o)*(n-a)}function Wd(e,t,r,n,i,s,o,a){return!(e===o&&t===a)&&qd(e,t,r,n,i,s,o,a)}function Hd(e,t){return e.next.i!==t.i&&e.prev.i!==t.i&&!function(e,t){let r=e;do{if(r.i!==e.i&&r.next.i!==e.i&&r.i!==t.i&&r.next.i!==t.i&&Kd(r,r.next,e,t))return!0;r=r.next}while(r!==e);return!1}(e,t)&&(Jd(e,t)&&Jd(t,e)&&function(e,t){let r=e,n=!1;const i=(e.x+t.x)/2,s=(e.y+t.y)/2;do{r.y>s!=r.next.y>s&&r.next.y!==r.y&&i<(r.next.x-r.x)*(s-r.y)/(r.next.y-r.y)+r.x&&(n=!n),r=r.next}while(r!==e);return n}(e,t)&&(Gd(e.prev,e,t.prev)||Gd(e,t.prev,t))||Zd(e,t)&&Gd(e.prev,e,e.next)>0&&Gd(t.prev,t,t.next)>0)}function Gd(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Zd(e,t){return e.x===t.x&&e.y===t.y}function Kd(e,t,r,n){const i=Xd(Gd(e,t,r)),s=Xd(Gd(e,t,n)),o=Xd(Gd(r,n,e)),a=Xd(Gd(r,n,t));return i!==s&&o!==a||!(0!==i||!Yd(e,r,t))||!(0!==s||!Yd(e,n,t))||!(0!==o||!Yd(r,e,n))||!(0!==a||!Yd(r,t,n))}function Yd(e,t,r){return t.x<=Math.max(e.x,r.x)&&t.x>=Math.min(e.x,r.x)&&t.y<=Math.max(e.y,r.y)&&t.y>=Math.min(e.y,r.y)}function Xd(e){return e>0?1:e<0?-1:0}function Jd(e,t){return Gd(e.prev,e,e.next)<0?Gd(e,t,e.next)>=0&&Gd(e,e.prev,t)>=0:Gd(e,t,e.prev)<0||Gd(e,e.next,t)<0}function Qd(e,t){const r=th(e.i,e.x,e.y),n=th(t.i,t.x,t.y),i=e.next,s=t.prev;return e.next=t,t.prev=e,r.next=i,i.prev=r,n.next=r,r.prev=n,s.next=n,n.prev=s,n}function $d(e,t,r,n){const i=th(e,t,r);return n?(i.next=n.next,i.prev=n,n.next.prev=i,n.next=i):(i.prev=i,i.next=i),i}function eh(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function th(e,t,r){return{i:e,x:t,y:r,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function rh(e,t){const r=e.length;if(r<=1)return[e];const n=[];let i,s;for(let o=0;o<r;o++){const t=Ye(e[o]);0!==t&&(e[o].area=Math.abs(t),void 0===s&&(s=t<0),s===t<0?(i&&n.push(i),i=[e[o]]):i.push(e[o]))}if(i&&n.push(i),t>1)for(let o=0;o<n.length;o++)n[o].length<=t||(ln(n[o],t,1,n[o].length-1,nh),n[o]=n[o].slice(0,t));return n}function nh(e,t){return t.area-e.area}function ih(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1;if(!e)return null;const n="string"==typeof e?Or.from(e).getPrimary():e.getPrimary(),i="string"==typeof e?null:e.getSecondary();for(const s of[n,i]){if(!s)continue;const e=s.id.toString();t.has(e)||t.set(e,[]),s.scaleSelf(r),t.get(e).push(s)}return{primary:n.toString(),secondary:i?i.toString():null}}function sh(e,t,r,n){const i=n.patternDependencies;let s=!1;for(const o of t){const t=o.paint.get("".concat(e,"-pattern"));t.isConstant()||(s=!0),ih(t.constantOr(null),i,r)&&(s=!0)}return s}function oh(e,t,r,n,i,s){const o=s.patternDependencies;for(const a of t){const t=a.paint.get("".concat(e,"-pattern")).value;if("constant"!==t.kind){let e=t.evaluate({zoom:n},r,{},s.availableImages);e=e&&e.name?e.name:e;const l=ih(e,o,i);if(!l)continue;const{primary:c,secondary:u}=l;c&&(r.patterns[a.id]=[c,u].filter(Boolean))}}return r}class ah{constructor(){this.polygons=new Map}add(e){const t=this.polygons.get(e);for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];t?t.push(...n):this.polygons.set(e,n)}merge(e){for(const[t,r]of e.polygons)this.add(t,...r)}}class lh{constructor(){this.portals=[]}static isOnBorder(e,t){return e<=0&&t<=0||e>=Bn&&t>=Bn}static evaluate(e){if(0===e.length)return new lh;let t=[];for(const a of e)t.push(...a.portals);if(0===t.length)return new lh;for(const a of t){const e=a.va,t=a.vb;(lh.isOnBorder(e.x,t.x)||lh.isOnBorder(e.y,t.y))&&(a.type="border")}const r=t.filter(e=>"unevaluated"!==e.type),n=t.filter(e=>"unevaluated"===e.type);if(0===n.length)return new lh;n.sort((e,t)=>e.hash===t.hash?e.isTunnel===t.isTunnel?0:e.isTunnel?-1:1:e.hash<t.hash?1:-1),t=r.concat(n);let i=r.length,s=i,o=i;do{if(s++,s===t.length||t[i].hash!==t[s].hash){if(s-i==2){o<i&&(t[o]=t[i],t[i]=null);const e=t[o],r=t[s-1];e.type=e.isTunnel!==r.isTunnel?"tunnel":"polygon",e.connection={a:e.connection.a,b:r.connection.a},o++}i=s}}while(i!==t.length);return t.splice(o),t.sort((e,t)=>e.hash<t.hash?1:-1),{portals:t}}}$s(lh,"ElevationPortalGraph"),$s(ah,"ElevationPolygons");class ch{constructor(e,t,r){this.outPositions=e,this.outNormals=t,this.outIndices=r,this.vertexLookup=new Map}addVertex(e,t,r){let n=e[2];null!=r&&(n*=r);const i="".concat(e[0],",").concat(e[1],",").concat(e[2],",").concat(t[0],",").concat(t[1],",").concat(t[2]),s=this.vertexLookup.get(i);if(null!=s)return s;const o=this.outPositions.length;this.vertexLookup.set(i,o);const a=Math.trunc(16384*t[0]),l=Math.trunc(16384*t[1]),c=Math.trunc(16384*t[2]);return this.outPositions.emplaceBack(e[0],e[1],n),this.outNormals.emplaceBack(a,l,c),o}addTriangle(e,t,r){this.outIndices.emplaceBack(e,t,r)}addTriangles(e,t,r){if(0===e.length)return;const n=1===r.length,i=w(),s=w();for(let o=0;o<e.length;o+=3){const a=t[e[o+0]],l=t[e[o+1]],c=t[e[o+2]],u=n?r[0]:r[e[o+1]],d=n?r[0]:r[e[o+2]];k(i,a.x,a.y,n?r[0]:r[e[o+0]]);const h=this.addVertex(i,s);k(i,l.x,l.y,u);const p=this.addVertex(i,s);k(i,c.x,c.y,d);const m=this.addVertex(i,s);this.outIndices.emplaceBack(h,p,m)}}addQuad(e,t,r,n,i,s){const o=this.addVertex(e,i,s),a=this.addVertex(t,i,s),l=this.addVertex(r,i,s),c=this.addVertex(n,i,s);this.addTriangle(o,a,l),this.addTriangle(l,c,o)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class uh{constructor(e,t,r,n){this.unevaluatedPortals=new lh,this.portalPolygons=new ah,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new ya,this.vertexNormals=new _a,this.indexArray=new La,this.tileToMeters=vc(e),this.bridgeProgramConfigurations=new Bl(t,{zoom:r,lut:n},e=>"fill-tunnel-structure-color"!==e),this.tunnelProgramConfigurations=new Bl(t,{zoom:r,lut:n},e=>"fill-bridge-guard-rail-color"!==e)}addVertices(e,t){const r=this.unevalVertices.length;for(let n=0;n<e.length;n++)this.unevalVertices.push(e[n]),this.unevalHeights.push(t[n]);return r}addTriangles(e,t,r){const n=r?this.unevalTunnelTriangles:this.unevalTriangles;for(const i of e)n.push(i+t)}addRenderableRing(e,t,r,n,i,s){const o=[new Se(i.min.x,i.min.y),new Se(i.max.x,i.min.y),new Se(i.max.x,i.max.y),new Se(i.min.x,i.max.y)];for(let a=0;a<r-1;a++){const r=t+a,l=r+1,c=this.unevalVertices[r],u=this.unevalVertices[l];if(!(c.x>=i.min.x&&c.x<=i.max.x&&c.y>=i.min.y&&c.y<=i.max.y||u.x>=i.min.x&&u.x<=i.max.x&&u.y>=i.min.y&&u.y<=i.max.y||yu(c,u,o)))continue;if(this.isOnBorder(c.x,u.x)||this.isOnBorder(c.y,u.y))continue;const d=uh.computeEdgeHash(this.unevalVertices[r],this.unevalVertices[l]);let h,p=this.vertexHashLookup.get(uh.computePosHash(c));null!=p?h=p.next:(p=this.vertexHashLookup.get(uh.computePosHash(u)),h=null!=p?p.prev:d),this.unevalEdges.push({polygonIdx:e,a:r,b:l,hash:d,portalHash:h,isTunnel:n,type:"unevaluated",featureInfo:s})}}addPortalCandidates(e,t,r,n,i){if(0===t.length)return;this.portalPolygons.add(e,{geometry:t,zLevel:i});const s=t[0];this.vertexHashLookup.clear();let o=uh.computeEdgeHash(s[s.length-2],s[s.length-1]);for(let a=0;a<s.length-1;a++){const t=s[a+0],i=s[a+1],l=ue(i.x-t.x,i.y-t.y),c=fe(l);if(0===c)continue;let u="unevaluated";const d=n.pointElevation(t),h=n.pointElevation(i);Math.abs(d)<.01&&Math.abs(h)<.01?u="entrance":(this.isOnBorder(t.x,i.x)||this.isOnBorder(t.y,i.y))&&(u="border");const p=uh.computeEdgeHash(t,i);this.unevaluatedPortals.portals.push({connection:{a:e,b:void 0},va:t,vb:i,vab:l,length:c,hash:p,isTunnel:r,type:u});const m=uh.computePosHash(t);this.vertexHashLookup.set(m,{prev:o,next:p}),o=p}}construct(e){if(0===this.unevalVertices.length)return;const t=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),r=e=>{e.primitiveLength=this.indexArray.length-e.primitiveOffset},n=new ch(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(e.portals,this.unevalEdges);const i=t(),s=t(),o=t(),a=(e,t)=>{e.sort((e,r)=>e.type===t&&r.type!==t?-1:e.type!==t&&r.type===t?1:0);const r=e.findIndex(e=>e.type!==t);return r>=0?r:e.length};let l=0;this.unevalEdges.length>0&&(l=a(this.unevalEdges,"none"),this.constructBridgeStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},this.tileToMeters)),r(o);const c=t(),u=t();if(this.unevalEdges.length>0){const e=this.unevalEdges.splice(l),t=a(e,"tunnel")+l;this.unevalEdges.push(...e),this.constructTunnelStructures(n,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:l},{min:l,max:t})}r(c),n.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),r(u),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),r(s),n.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),r(i),this.maskSegments=dl.simpleSegment(0,u.primitiveOffset,0,u.primitiveLength),this.depthSegments=dl.simpleSegment(0,s.primitiveOffset,0,s.primitiveLength),this.renderableBridgeSegments=dl.simpleSegment(0,o.primitiveOffset,0,o.primitiveLength),this.renderableTunnelSegments=dl.simpleSegment(0,c.primitiveOffset,0,c.primitiveLength),this.shadowCasterSegments=dl.simpleSegment(0,i.primitiveOffset,0,i.primitiveLength)}update(e,t,r,n,i,s,o,a){this.bridgeProgramConfigurations.updatePaintArrays(e,t,i,r,n,s,o,a),this.tunnelProgramConfigurations.updatePaintArrays(e,t,i,r,n,s,o,a)}upload(e){this.vertexBuffer||0===this.vertexPositions.length||0===this.vertexNormals.length||0===this.indexArray.length||(this.vertexBuffer=e.createVertexBuffer(this.vertexPositions,Cd.members),this.vertexBufferNormal=e.createVertexBuffer(this.vertexNormals,Ed.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(e),this.tunnelProgramConfigurations.upload(e))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(e,t,r,n,i){const s=(s,o)=>{for(let a=0;a<o.length-1;a++){const l=o[a].featureIndex,c=o[a+1].vertexStart,u=e.feature(l);s.populatePaintArrays(c,u,l,{},r,t,n,void 0,i)}};s(this.bridgeProgramConfigurations,this.bridgeFeatureSections),s(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(e,t,r,n,i){const s=new Map;for(let o=n;o<i;o++){const n=r[o],i=n.a,a=n.b,l=uh.computePosHash(e[i]),c=uh.computePosHash(e[a]);let u=s.get(l);u||(u={},s.set(l,u));let d=s.get(c);d||(d={},s.set(c,d)),t[i]<=0&&t[a]<=0||(u.to=a,d.from=i)}return s}isTerminalVertex(e,t){const r=uh.computePosHash(this.unevalVertices[e]),n=t.get(r);return!n||!n.from||!n.to}constructBridgeStructures(e,t,r,n,i,s){e.clearVertexLookup();const o=this.computeVertexConnections(t,r,n,i.min,i.max),a=1/s,l=.5*a,c=(e,n)=>k(e,t[n].x,t[n].y,r[n]*a),u=w(),d=w(),h=w(),p=w(),m=w(),f=(e,r)=>{const n=o.get(uh.computePosHash(t[r])),i=n.from,s=n.to;if(!i||!s)return;c(u,i),c(d,r),c(h,s),H(p),G(u,d)||(Z(m,d,u),O(p,m)),G(h,d)||(Z(m,h,d),A(p,p,O(m,m)));const a=Y(p);return a>0?P(e,p,1/a):void 0};let g=Number.POSITIVE_INFINITY;this.sortSubarray(n,i.min,i.max,(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex);const y=w(),_=w(),v=w(),x=w(),b=w(),j=w(),S=w(),T=w(),C=w(),E=[w(),w(),w(),w()],N=[w(),w(),w(),w()],I=[{coord:new Se(0,0),height:0},{coord:new Se(0,0),height:0}],M=(e,t)=>e>t;for(let w=i.min;w<i.max;w++){const i=n[w];if(!i.featureInfo.guardRailEnabled)continue;if(!this.prepareEdgePoints(I,t,r,i,M))continue;const[c,u]=I;if(k(y,c.coord.x,c.coord.y,a*c.height),k(_,u.coord.x,u.coord.y,a*u.height),G(y,_))continue;Z(v,_,y),O(v,v);const d=f(T,i.a)||v,h=f(C,i.b)||v;k(x,d[1],-d[0],0),O(x,x),k(b,h[1],-h[0],0),O(b,b),B(T,x,d),O(j,T),B(T,b,h),O(S,T),A(E[0],y,P(T,Z(T,x,j),l)),A(E[1],y,P(T,A(T,x,j),l)),A(E[2],y,P(T,j,l)),E[3]=y,A(N[0],_,P(T,Z(T,b,S),l)),A(N[1],_,P(T,A(T,b,S),l)),A(N[2],_,P(T,S,l)),N[3]=_,g=this.addFeatureSection(i.featureInfo.featureIndex,g,this.bridgeFeatureSections,e);const p=e.addVertex(E[0],x,s),m=e.addVertex(E[1],x,s),L=e.addVertex(N[0],b,s),R=e.addVertex(N[1],b,s);e.addTriangle(p,m,L),e.addTriangle(m,R,L);const D=e.addVertex(E[1],j,s),z=e.addVertex(E[2],j,s),U=e.addVertex(N[1],S,s),V=e.addVertex(N[2],S,s);e.addTriangle(D,z,U),e.addTriangle(z,V,U),F(x,x),F(b,b);const q=e.addVertex(E[2],x,s),W=e.addVertex(E[3],x,s),H=e.addVertex(N[2],b,s),K=e.addVertex(N[3],b,s);e.addTriangle(q,W,H),e.addTriangle(W,K,H);const Y=this.isTerminalVertex(i.a,o),X=this.isTerminalVertex(i.b,o);c.height<.01&&Y&&e.addQuad(E[3],E[2],E[1],E[0],F(d,d),s),u.height<.01&&X&&e.addQuad(N[0],N[1],N[2],N[3],h,s)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}constructTunnelStructures(e,t,r,n,i,s){e.clearVertexLookup();let o=Number.POSITIVE_INFINITY;const a=(e,t)=>e.featureInfo.featureIndex-t.featureInfo.featureIndex;this.sortSubarray(n,i.min,i.max,a),this.sortSubarray(n,s.min,s.max,a);const l=e=>O(e,e),c=[{coord:new Se(0,0),height:0},{coord:new Se(0,0),height:0}],u=(e,t)=>e<t,d=w(),h=w(),p=w(),m=w(),f=w();for(let g=i.min;g<i.max;g++){if(!this.prepareEdgePoints(c,t,r,n[g],u))continue;const[i,s]=c,a=l(k(f,-(s.coord.y-i.coord.y),s.coord.x-i.coord.x,0));o=this.addFeatureSection(n[g].featureInfo.featureIndex,o,this.tunnelFeatureSections,e),e.addQuad(k(d,i.coord.x,i.coord.y,i.height),k(h,s.coord.x,s.coord.y,s.height),k(p,s.coord.x,s.coord.y,n[g].isTunnel?-.1:0),k(m,i.coord.x,i.coord.y,n[g].isTunnel?-.1:0),a)}for(let g=s.min;g<s.max;g++){const i=n[g];i.isTunnel&&([i.a,i.b]=[i.b,i.a]);const s=t[i.a],a=t[i.b],c=l(k(f,-(a.y-s.y),a.x-s.x,0));o=this.addFeatureSection(i.featureInfo.featureIndex,o,this.tunnelFeatureSections,e),e.addQuad(k(d,a.x,a.y,0),k(h,s.x,s.y,0),k(p,s.x,s.y,r[i.a]+4),k(m,a.x,a.y,r[i.b]+4),c),e.addQuad(k(d,s.x,s.y,0),k(h,a.x,a.y,0),k(p,a.x,a.y,r[i.b]+4),k(m,s.x,s.y,r[i.a]+4),c)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:e.getVertexCount()})}setElevatedPoint(e,t,r,n){e.coord.x=t,e.coord.y=r,e.height=n}prepareEdgePoints(e,t,r,n,i){let s=t[n.a].x,o=t[n.a].y,a=t[n.b].x,l=t[n.b].y,c=r[n.a],u=r[n.b];const d=i(c,0),h=i(u,0);if(d&&h)return this.setElevatedPoint(e[0],s,o,c),this.setElevatedPoint(e[1],a,l,u),!0;if(!d&&!h)return!1;if(d){if(!h){const e=u/(u-c);a=hr(a,s,e),l=hr(l,o,e),u=hr(u,c,e)}}else{const e=c/(c-u);s=hr(s,a,e),o=hr(o,l,e),c=hr(c,u,e)}return this.setElevatedPoint(e[0],s,o,c),this.setElevatedPoint(e[1],a,l,u),!0}prepareEdges(e,t){if(0===t.length)return;t.sort((e,t)=>e.hash===t.hash?t.polygonIdx-e.polygonIdx:t.hash>e.hash?1:-1);let r=0,n=0,i=0,s=t[r].polygonIdx;do{n++,(n===t.length||t[r].hash!==t[n].hash)&&((1==n-r||t[n-1].polygonIdx!==s)&&(i<r&&(t[i]=t[r],t[r]=null),t[i].type="none",i++),r=n,r!==t.length&&(s=t[r].polygonIdx))}while(r!==t.length);if(t.splice(i),0!==t.length&&0!==e.length){t.sort((e,t)=>e.portalHash<t.portalHash?1:-1);let r=0,n=0;for(;r!==t.length&&n!==e.length;){const i=t[r],s=e[n];i.portalHash>s.hash?r++:s.hash>i.portalHash?n++:(i.type=s.type,r++)}}}isOnBorder(e,t){return e<=0&&t<=0||e>=Bn&&t>=Bn}addFeatureSection(e,t,r,n){return e!==t&&(t=e,r.push({featureIndex:e,vertexStart:n.getVertexCount()}),n.clearVertexLookup()),t}sortSubarray(e,t,r,n){const i=e.slice(t,r);i.sort(n),e.splice(t,i.length,...i)}static computeEdgeHash(e,t){return(e.y===t.y&&e.x>t.x||e.y>t.y)&&([e,t]=[t,e]),BigInt(uh.computePosHash(e))<<32n|BigInt(uh.computePosHash(t))}static computePosHash(e){return((65535&e.x)<<16|65535&e.y)>>>0}}var dh,hh={exports:{}},ph=(dh||(dh=1,function(e){function t(e,t){return e>t?1:e<t?-1:0}var r=function(e,r){void 0===e&&(e=t),void 0===r&&(r=!1),this._compare=e,this._root=null,this._size=0,this._noDuplicates=!!r},n={size:{configurable:!0}};function i(e,t,r,n,s){var o=s-n;if(o>0){var a=n+Math.floor(o/2),l={key:t[a],data:r[a],parent:e};return l.left=i(l,t,r,n,a),l.right=i(l,t,r,a+1,s),l}return null}function s(e,t,r,n,i){if(!(r>=n)){for(var o=e[r+n>>1],a=r-1,l=n+1;;){do{a++}while(i(e[a],o)<0);do{l--}while(i(e[l],o)>0);if(a>=l)break;var c=e[a];e[a]=e[l],e[l]=c,c=t[a],t[a]=t[l],t[l]=c}s(e,t,r,l,i),s(e,t,l+1,n,i)}}r.prototype.rotateLeft=function(e){var t=e.right;t&&(e.right=t.left,t.left&&(t.left.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.left=e),e.parent=t},r.prototype.rotateRight=function(e){var t=e.left;t&&(e.left=t.right,t.right&&(t.right.parent=e),t.parent=e.parent),e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.right=e),e.parent=t},r.prototype._splay=function(e){for(;e.parent;){var t=e.parent;t.parent?t.left===e&&t.parent.left===t?(this.rotateRight(t.parent),this.rotateRight(t)):t.right===e&&t.parent.right===t?(this.rotateLeft(t.parent),this.rotateLeft(t)):t.left===e&&t.parent.right===t?(this.rotateRight(t),this.rotateLeft(t)):(this.rotateLeft(t),this.rotateRight(t)):t.left===e?this.rotateRight(t):this.rotateLeft(t)}},r.prototype.splay=function(e){for(var t,r,n,i,s;e.parent;)(r=(t=e.parent).parent)&&r.parent?((n=r.parent).left===r?n.left=e:n.right=e,e.parent=n):(e.parent=null,this._root=e),i=e.left,s=e.right,e===t.left?(r&&(r.left===t?(t.right?(r.left=t.right,r.left.parent=r):r.left=null,t.right=r,r.parent=t):(i?(r.right=i,i.parent=r):r.right=null,e.left=r,r.parent=e)),s?(t.left=s,s.parent=t):t.left=null,e.right=t,t.parent=e):(r&&(r.right===t?(t.left?(r.right=t.left,r.right.parent=r):r.right=null,t.left=r,r.parent=t):(s?(r.left=s,s.parent=r):r.left=null,e.right=r,r.parent=e)),i?(t.right=i,i.parent=t):t.right=null,e.left=t,t.parent=e)},r.prototype.replace=function(e,t){e.parent?e===e.parent.left?e.parent.left=t:e.parent.right=t:this._root=t,t&&(t.parent=e.parent)},r.prototype.minNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.left;)e=e.left;return e},r.prototype.maxNode=function(e){if(void 0===e&&(e=this._root),e)for(;e.right;)e=e.right;return e},r.prototype.insert=function(e,t){var r=this._root,n=null,i=this._compare;if(this._noDuplicates)for(;r;){if(n=r,0===i(r.key,e))return;r=i(r.key,e)<0?r.right:r.left}else for(;r;)n=r,r=i(r.key,e)<0?r.right:r.left;return r={key:e,data:t,left:null,right:null,parent:n},n?i(n.key,r.key)<0?n.right=r:n.left=r:this._root=r,this.splay(r),this._size++,r},r.prototype.find=function(e){for(var t=this._root,r=this._compare;t;){var n=r(t.key,e);if(n<0)t=t.right;else{if(!(n>0))return t;t=t.left}}return null},r.prototype.contains=function(e){for(var t=this._root,r=this._compare;t;){var n=r(e,t.key);if(0===n)return!0;t=n<0?t.left:t.right}return!1},r.prototype.remove=function(e){var t=this.find(e);if(!t)return!1;if(this.splay(t),t.left)if(t.right){var r=this.minNode(t.right);r.parent!==t&&(this.replace(r,r.right),r.right=t.right,r.right.parent=r),this.replace(t,r),r.left=t.left,r.left.parent=r}else this.replace(t,t.left);else this.replace(t,t.right);return this._size--,!0},r.prototype.removeNode=function(e){if(!e)return!1;if(this.splay(e),e.left)if(e.right){var t=this.minNode(e.right);t.parent!==e&&(this.replace(t,t.right),t.right=e.right,t.right.parent=t),this.replace(e,t),t.left=e.left,t.left.parent=t}else this.replace(e,e.left);else this.replace(e,e.right);return this._size--,!0},r.prototype.erase=function(e){var t=this.find(e);if(t){this.splay(t);var r=t.left,n=t.right,i=null;r&&(r.parent=null,i=this.maxNode(r),this.splay(i),this._root=i),n&&(r?i.right=n:this._root=n,n.parent=i),this._size--}},r.prototype.pop=function(){var e=this._root,t=null;if(e){for(;e.left;)e=e.left;t={key:e.key,data:e.data},this.remove(e.key)}return t},r.prototype.next=function(e){var t=e;if(t)if(t.right)for(t=t.right;t&&t.left;)t=t.left;else for(t=e.parent;t&&t.right===e;)e=t,t=t.parent;return t},r.prototype.prev=function(e){var t=e;if(t)if(t.left)for(t=t.left;t&&t.right;)t=t.right;else for(t=e.parent;t&&t.left===e;)e=t,t=t.parent;return t},r.prototype.forEach=function(e){for(var t=this._root,r=[],n=!1,i=0;!n;)t?(r.push(t),t=t.left):r.length>0?(e(t=r.pop(),i++),t=t.right):n=!0;return this},r.prototype.range=function(e,t,r,n){for(var i=[],s=this._compare,o=this._root;0!==i.length||o;)if(o)i.push(o),o=o.left;else{if(s((o=i.pop()).key,t)>0)break;if(s(o.key,e)>=0&&r.call(n,o))return this;o=o.right}return this},r.prototype.keys=function(){for(var e=this._root,t=[],r=[],n=!1;!n;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.key),e=e.right):n=!0;return r},r.prototype.values=function(){for(var e=this._root,t=[],r=[],n=!1;!n;)e?(t.push(e),e=e.left):t.length>0?(e=t.pop(),r.push(e.data),e=e.right):n=!0;return r},r.prototype.at=function(e){for(var t=this._root,r=[],n=!1,i=0;!n;)if(t)r.push(t),t=t.left;else if(r.length>0){if(t=r.pop(),i===e)return t;i++,t=t.right}else n=!0;return null},r.prototype.load=function(e,t,r){if(void 0===e&&(e=[]),void 0===t&&(t=[]),void 0===r&&(r=!1),0!==this._size)throw new Error("bulk-load: tree is not empty");var n=e.length;return r&&s(e,t,0,n-1,this._compare),this._root=i(null,e,t,0,n),this._size=n,this},r.prototype.min=function(){var e=this.minNode(this._root);return e?e.key:null},r.prototype.max=function(){var e=this.maxNode(this._root);return e?e.key:null},r.prototype.isEmpty=function(){return null===this._root},n.size.get=function(){return this._size},r.createTree=function(e,t,n,i,s){return new r(n,s).load(e,t,i)},Object.defineProperties(r.prototype,n);var o=0,a=1,l=2,c=3,u=0,d=1,h=2,p=3;function m(e,t,r){null===t?(e.inOut=!1,e.otherInOut=!0):(e.isSubject===t.isSubject?(e.inOut=!t.inOut,e.otherInOut=t.otherInOut):(e.inOut=!t.otherInOut,e.otherInOut=t.isVertical()?!t.inOut:t.inOut),t&&(e.prevInResult=!f(t,r)||t.isVertical()?t.prevInResult:t));var n=f(e,r);e.resultTransition=n?function(e,t){var r,n=!e.inOut,i=!e.otherInOut;switch(t){case u:r=n&&i;break;case d:r=n||i;break;case p:r=n^i;break;case h:r=e.isSubject?n&&!i:i&&!n}return r?1:-1}(e,r):0}function f(e,t){switch(e.type){case o:switch(t){case u:return!e.otherInOut;case d:return e.otherInOut;case h:return e.isSubject&&e.otherInOut||!e.isSubject&&!e.otherInOut;case p:return!0}break;case l:return t===u||t===d;case c:return t===h;case a:return!1}return!1}var g=function(e,t,r,n,i){this.left=t,this.point=e,this.otherEvent=r,this.isSubject=n,this.type=i||o,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},y={inResult:{configurable:!0}};function _(e,t){return e[0]===t[0]&&e[1]===t[1]}g.prototype.isBelow=function(e){var t=this.point,r=this.otherEvent.point;return this.left?(t[0]-e[0])*(r[1]-e[1])-(r[0]-e[0])*(t[1]-e[1])>0:(r[0]-e[0])*(t[1]-e[1])-(t[0]-e[0])*(r[1]-e[1])>0},g.prototype.isAbove=function(e){return!this.isBelow(e)},g.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},y.inResult.get=function(){return 0!==this.resultTransition},g.prototype.clone=function(){var e=new g(this.point,this.left,this.otherEvent,this.isSubject,this.type);return e.contourId=this.contourId,e.resultTransition=this.resultTransition,e.prevInResult=this.prevInResult,e.isExteriorRing=this.isExteriorRing,e.inOut=this.inOut,e.otherInOut=this.otherInOut,e},Object.defineProperties(g.prototype,y);var v=11102230246251565e-32,x=134217729,b=(3+8*v)*v;function w(e,t,r,n,i){var s,o,a,l,c=t[0],u=n[0],d=0,h=0;u>c==u>-c?(s=c,c=t[++d]):(s=u,u=n[++h]);var p=0;if(d<e&&h<r)for(u>c==u>-c?(a=s-((o=c+s)-c),c=t[++d]):(a=s-((o=u+s)-u),u=n[++h]),s=o,0!==a&&(i[p++]=a);d<e&&h<r;)u>c==u>-c?(a=s-((o=s+c)-(l=o-s))+(c-l),c=t[++d]):(a=s-((o=s+u)-(l=o-s))+(u-l),u=n[++h]),s=o,0!==a&&(i[p++]=a);for(;d<e;)a=s-((o=s+c)-(l=o-s))+(c-l),c=t[++d],s=o,0!==a&&(i[p++]=a);for(;h<r;)a=s-((o=s+u)-(l=o-s))+(u-l),u=n[++h],s=o,0!==a&&(i[p++]=a);return 0===s&&0!==p||(i[p++]=s),p}function j(e){return new Float64Array(e)}var S=33306690738754716e-32,T=22204460492503146e-32,k=11093356479670487e-47,A=j(4),C=j(8),E=j(12),N=j(16),I=j(4);function P(e,t,r){var n=function(e,t,r,n,i,s){var o=(t-s)*(r-i),a=(e-i)*(n-s),l=o-a;if(0===o||0===a||o>0!=a>0)return l;var c=Math.abs(o+a);return Math.abs(l)>=S*c?l:-function(e,t,r,n,i,s,o){var a,l,c,u,d,h,p,m,f,g,y,_,v,j,S,P,M,L,R=e-i,D=r-i,F=t-s,O=n-s;A[0]=(S=(m=R-(p=(h=x*R)-(h-R)))*(g=O-(f=(h=x*O)-(h-O)))-((j=R*O)-p*f-m*f-p*g))-((y=S-(M=(m=F-(p=(h=x*F)-(h-F)))*(g=D-(f=(h=x*D)-(h-D)))-((P=F*D)-p*f-m*f-p*g)))+(d=S-y))+(d-M),A[1]=(v=j-((_=j+y)-(d=_-j))+(y-d))-((y=v-P)+(d=v-y))+(d-P),A[2]=_-((L=_+y)-(d=L-_))+(y-d),A[3]=L;var z=function(e,t){for(var r=t[0],n=1;n<4;n++)r+=t[n];return r}(0,A),B=T*o;if(z>=B||-z>=B)return z;if(a=e-(R+(d=e-R))+(d-i),c=r-(D+(d=r-D))+(d-i),l=t-(F+(d=t-F))+(d-s),u=n-(O+(d=n-O))+(d-s),0===a&&0===l&&0===c&&0===u)return z;if(B=k*o+b*Math.abs(z),(z+=R*u+O*a-(F*c+D*l))>=B||-z>=B)return z;I[0]=(S=(m=a-(p=(h=x*a)-(h-a)))*(g=O-(f=(h=x*O)-(h-O)))-((j=a*O)-p*f-m*f-p*g))-((y=S-(M=(m=l-(p=(h=x*l)-(h-l)))*(g=D-(f=(h=x*D)-(h-D)))-((P=l*D)-p*f-m*f-p*g)))+(d=S-y))+(d-M),I[1]=(v=j-((_=j+y)-(d=_-j))+(y-d))-((y=v-P)+(d=v-y))+(d-P),I[2]=_-((L=_+y)-(d=L-_))+(y-d),I[3]=L;var U=w(4,A,4,I,C);I[0]=(S=(m=R-(p=(h=x*R)-(h-R)))*(g=u-(f=(h=x*u)-(h-u)))-((j=R*u)-p*f-m*f-p*g))-((y=S-(M=(m=F-(p=(h=x*F)-(h-F)))*(g=c-(f=(h=x*c)-(h-c)))-((P=F*c)-p*f-m*f-p*g)))+(d=S-y))+(d-M),I[1]=(v=j-((_=j+y)-(d=_-j))+(y-d))-((y=v-P)+(d=v-y))+(d-P),I[2]=_-((L=_+y)-(d=L-_))+(y-d),I[3]=L;var V=w(U,C,4,I,E);I[0]=(S=(m=a-(p=(h=x*a)-(h-a)))*(g=u-(f=(h=x*u)-(h-u)))-((j=a*u)-p*f-m*f-p*g))-((y=S-(M=(m=l-(p=(h=x*l)-(h-l)))*(g=c-(f=(h=x*c)-(h-c)))-((P=l*c)-p*f-m*f-p*g)))+(d=S-y))+(d-M),I[1]=(v=j-((_=j+y)-(d=_-j))+(y-d))-((y=v-P)+(d=v-y))+(d-P),I[2]=_-((L=_+y)-(d=L-_))+(y-d),I[3]=L;var q=w(V,E,4,I,N);return N[q-1]}(e,t,r,n,i,s,c)}(e[0],e[1],t[0],t[1],r[0],r[1]);return n>0?-1:n<0?1:0}function M(e,t){var r=e.point,n=t.point;return r[0]>n[0]?1:r[0]<n[0]?-1:r[1]!==n[1]?r[1]>n[1]?1:-1:function(e,t,r){return e.left!==t.left?e.left?1:-1:0!==P(r,e.otherEvent.point,t.otherEvent.point)?e.isBelow(t.otherEvent.point)?-1:1:!e.isSubject&&t.isSubject?1:-1}(e,t,r)}function L(e,t,r){var n=new g(t,!1,e,e.isSubject),i=new g(t,!0,e.otherEvent,e.isSubject);return _(e.point,e.otherEvent.point)&&console.warn("what is that, a collapsed segment?",e),n.contourId=i.contourId=e.contourId,M(i,e.otherEvent)>0&&(e.otherEvent.left=!0,i.left=!1),e.otherEvent.otherEvent=i,e.otherEvent=n,r.push(i),r.push(n),r}function R(e,t){return e[0]*t[1]-e[1]*t[0]}function D(e,t){return e[0]*t[0]+e[1]*t[1]}function F(e,t,r){var n=function(e,t,r,n){var i=[t[0]-e[0],t[1]-e[1]],s=[n[0]-r[0],n[1]-r[1]];function o(e,t,r){return[e[0]+t*r[0],e[1]+t*r[1]]}var a=[r[0]-e[0],r[1]-e[1]],l=R(i,s),c=l*l,u=D(i,i);if(c>0){var d=R(a,s)/l;if(d<0||d>1)return null;var h=R(a,i)/l;return h<0||h>1?null:0===d||1===d?[o(e,d,i)]:0===h||1===h?[o(r,h,s)]:[o(e,d,i)]}if((c=(l=R(a,i))*l)>0)return null;var p=D(i,a)/u,m=p+D(i,s)/u,f=Math.min(p,m),g=Math.max(p,m);return f<=1&&g>=0?1===f?[o(e,f>0?f:0,i)]:0===g?[o(e,g<1?g:1,i)]:[o(e,f>0?f:0,i),o(e,g<1?g:1,i)]:null}(e.point,e.otherEvent.point,t.point,t.otherEvent.point),i=n?n.length:0;if(0===i)return 0;if(1===i&&(_(e.point,t.point)||_(e.otherEvent.point,t.otherEvent.point)))return 0;if(2===i&&e.isSubject===t.isSubject)return 0;if(1===i)return _(e.point,n[0])||_(e.otherEvent.point,n[0])||L(e,n[0],r),_(t.point,n[0])||_(t.otherEvent.point,n[0])||L(t,n[0],r),1;var s=[],o=!1,u=!1;return _(e.point,t.point)?o=!0:1===M(e,t)?s.push(t,e):s.push(e,t),_(e.otherEvent.point,t.otherEvent.point)?u=!0:1===M(e.otherEvent,t.otherEvent)?s.push(t.otherEvent,e.otherEvent):s.push(e.otherEvent,t.otherEvent),o&&u||o?(t.type=a,e.type=t.inOut===e.inOut?l:c,o&&!u&&L(s[1].otherEvent,s[0].point,r),2):u?(L(s[0],s[1].point,r),3):s[0]!==s[3].otherEvent?(L(s[0],s[1].point,r),L(s[1],s[2].point,r),3):(L(s[0],s[1].point,r),L(s[3].otherEvent,s[2].point,r),3)}function O(e,t){if(e===t)return 0;if(0!==P(e.point,e.otherEvent.point,t.point)||0!==P(e.point,e.otherEvent.point,t.otherEvent.point))return _(e.point,t.point)?e.isBelow(t.otherEvent.point)?-1:1:e.point[0]===t.point[0]?e.point[1]<t.point[1]?-1:1:1===M(e,t)?t.isAbove(e.point)?-1:1:e.isBelow(t.point)?-1:1;if(e.isSubject!==t.isSubject)return e.isSubject?-1:1;var r=e.point,n=t.point;return r[0]===n[0]&&r[1]===n[1]?(r=e.otherEvent.point)[0]===(n=t.otherEvent.point)[0]&&r[1]===n[1]?0:e.contourId>t.contourId?1:-1:1===M(e,t)?1:-1}var z=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function B(e,t,r,n){var i,s=e+1,o=t[e].point,a=t.length;for(s<a&&(i=t[s].point);s<a&&i[0]===o[0]&&i[1]===o[1];){if(!r[s])return s;++s<a&&(i=t[s].point)}for(s=e-1;r[s]&&s>n;)s--;return s}z.prototype.isExterior=function(){return null==this.holeOf};var U=q,V=q;function q(e,t){if(!(this instanceof q))return new q(e,t);if(this.data=e||[],this.length=this.data.length,this.compare=t||W,this.length>0)for(var r=(this.length>>1)-1;r>=0;r--)this._down(r)}function W(e,t){return e<t?-1:e>t?1:0}q.prototype={push:function(e){this.data.push(e),this.length++,this._up(this.length-1)},pop:function(){if(0!==this.length){var e=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),e}},peek:function(){return this.data[0]},_up:function(e){for(var t=this.data,r=this.compare,n=t[e];e>0;){var i=e-1>>1,s=t[i];if(r(n,s)>=0)break;t[e]=s,e=i}t[e]=n},_down:function(e){for(var t=this.data,r=this.compare,n=this.length>>1,i=t[e];e<n;){var s=1+(e<<1),o=s+1,a=t[s];if(o<this.length&&r(t[o],a)<0&&(s=o,a=t[o]),r(a,i)>=0)break;t[e]=a,e=s}t[e]=i}},U.default=V;var H=Math.max,G=Math.min,Z=0;function K(e,t,r,n,i,s){var o,a,l,c,u,d;for(o=0,a=e.length-1;o<a;o++)if(c=e[o+1],u=new g(l=e[o],!1,void 0,t),d=new g(c,!1,u,t),u.otherEvent=d,l[0]!==c[0]||l[1]!==c[1]){u.contourId=d.contourId=r,s||(u.isExteriorRing=!1,d.isExteriorRing=!1),M(u,d)>0?d.left=!0:u.left=!0;var h=l[0],p=l[1];i[0]=G(i[0],h),i[1]=G(i[1],p),i[2]=H(i[2],h),i[3]=H(i[3],p),n.push(u),n.push(d)}}var Y=[];function X(e,t,n){"number"==typeof e[0][0][0]&&(e=[e]),"number"==typeof t[0][0][0]&&(t=[t]);var i=function(e,t,r){var n=null;return e.length*t.length==0&&(r===u?n=Y:r===h?n=e:r!==d&&r!==p||(n=0===e.length?t:e)),n}(e,t,n);if(i)return i===Y?null:i;var s=[1/0,1/0,-1/0,-1/0],o=[1/0,1/0,-1/0,-1/0],a=function(e,t,r,n,i){var s,o,a,l,c,u,d=new U(null,M);for(a=0,l=e.length;a<l;a++)for(c=0,u=(s=e[a]).length;c<u;c++)(o=0===c)&&Z++,K(s[c],!0,Z,d,r,o);for(a=0,l=t.length;a<l;a++)for(c=0,u=(s=t[a]).length;c<u;c++)o=0===c,i===h&&(o=!1),o&&Z++,K(s[c],!1,Z,d,n,o);return d}(e,t,s,o,n);if(i=function(e,t,r,n,i){var s=null;return(r[0]>n[2]||n[0]>r[2]||r[1]>n[3]||n[1]>r[3])&&(i===u?s=Y:i===h?s=e:i!==d&&i!==p||(s=e.concat(t))),s}(e,t,s,o,n))return i===Y?null:i;for(var l=function(e){var t,r,n=function(e){var t,r,n,i,s=[];for(r=0,n=e.length;r<n;r++)((t=e[r]).left&&t.inResult||!t.left&&t.otherEvent.inResult)&&s.push(t);for(var o=!1;!o;)for(o=!0,r=0,n=s.length;r<n;r++)r+1<n&&1===M(s[r],s[r+1])&&(i=s[r],s[r]=s[r+1],s[r+1]=i,o=!1);for(r=0,n=s.length;r<n;r++)(t=s[r]).otherPos=r;for(r=0,n=s.length;r<n;r++)(t=s[r]).left||(i=t.otherPos,t.otherPos=t.otherEvent.otherPos,t.otherEvent.otherPos=i);return s}(e),i={},s=[],o=function(){if(!i[t]){var e=s.length,r=function(e,t,r){var n=new z;if(null!=e.prevInResult){var i=e.prevInResult,s=i.outputContourId;if(i.resultTransition>0){var o=t[s];if(null!=o.holeOf){var a=o.holeOf;t[a].holeIds.push(r),n.holeOf=a,n.depth=t[s].depth}else t[s].holeIds.push(r),n.holeOf=s,n.depth=t[s].depth+1}else n.holeOf=null,n.depth=t[s].depth}else n.holeOf=null,n.depth=0;return n}(n[t],s,e),o=function(t){i[t]=!0,t<n.length&&n[t]&&(n[t].outputContourId=e)},a=t,l=t;for(r.points.push(n[t].point);o(a),o(a=n[a].otherPos),r.points.push(n[a].point),!((a=B(a,n,i,l))==l||a>=n.length)&&n[a];);s.push(r)}};for(t=0,r=n.length;t<r;t++)o();return s}(function(e,t,n,i,s,o){for(var a,l,c,d=new r(O),p=[],f=Math.min(i[2],s[2]);0!==e.length;){var g=e.pop();if(p.push(g),o===u&&g.point[0]>f||o===h&&g.point[0]>i[2])break;if(g.left){l=a=d.insert(g),a=a!==(c=d.minNode())?d.prev(a):null,l=d.next(l);var y=a?a.key:null;if(m(g,y,o),l&&2===F(g,l.key,e)&&(m(g,y,o),m(l.key,g,o)),a&&2===F(a.key,g,e)){var _=a;m(y,(_=_!==c?d.prev(_):null)?_.key:null,o),m(g,y,o)}}else l=a=d.find(g=g.otherEvent),a&&l&&(a=a!==c?d.prev(a):null,l=d.next(l),d.remove(g),l&&a&&F(a.key,l.key,e))}return p}(a,0,0,s,o,n)),c=[],f=0;f<l.length;f++){var g=l[f];if(g.isExterior()){for(var y=[g.points],_=0;_<g.holeIds.length;_++)y.push(l[g.holeIds[_]].points);c.push(y)}}return c}var J={UNION:d,DIFFERENCE:h,INTERSECTION:u,XOR:p};e.diff=function(e,t){return X(e,t,h)},e.intersection=function(e,t){return X(e,t,u)},e.operations=J,e.union=function(e,t){return X(e,t,d)},e.xor=function(e,t){return X(e,t,p)},Object.defineProperty(e,"__esModule",{value:!0})}(hh.exports)),hh.exports);function mh(e,t,r,n){const i=[],s=0===n?(e,t,r,n,i,s)=>{e.push(new Se(s,r+(s-t)/(n-t)*(i-r)))}:(e,t,r,n,i,s)=>{e.push(new Se(t+(s-r)/(i-r)*(n-t),s))};for(const o of e){const e=[];for(const i of o){if(i.length<=2)continue;const o=[];for(let e=0;e<i.length-1;e++){const a=i[e].x,l=i[e].y,c=i[e+1].x,u=i[e+1].y,d=0===n?a:l,h=0===n?c:u;d<t?h>t&&s(o,a,l,c,u,t):d>r?h<r&&s(o,a,l,c,u,r):o.push(i[e]),h<t&&d>=t&&s(o,a,l,c,u,t),h>r&&d<=r&&s(o,a,l,c,u,r)}let a=i[i.length-1];const l=0===n?a.x:a.y;l>=t&&l<=r&&o.push(a),o.length&&(a=o[o.length-1],o[0].x===a.x&&o[0].y===a.y||o.push(o[0]),e.push(o))}e.length&&i.push(e)}return i}function fh(e,t){const r=yh(e),n=yh([t]),i=ph.intersection(r,n);return null==i?[]:_h(i)}function gh(e,t){const r=65536;let n=yh(e,r);const i=[];for(;t.valid();t.next()){const[e,n]=t.get(),s=e.x*r,o=e.y*r,a=n.x*r,l=n.y*r,c=a-s,u=l-o,d=Math.hypot(c,u);if(0===d)continue;const h=Math.trunc(u/d*3),p=-Math.trunc(c/d*3);i.push([[[s,o],[a,l],[a+h,l+p],[s+h,o+p],[s,o]]])}return i.length>0&&(n=ph.diff(n,i)),_h(n,1/r)}function yh(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return[e.map(e=>e.map(e=>[e.x*t,e.y*t]))]}function _h(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;return e.map(e=>e.map((e,r)=>{const n=e.map(e=>new Se(e[0]*t,e[1]*t).round());return r>0&&n.reverse(),n}))}class vh{constructor(e,t){this.layoutVertexArray=new pa,this.indexArray=new La,this.lineIndexArray=new Ea,this.triangleSegments=new dl,this.lineSegments=new dl,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.uploaded=!1,t&&(this.elevatedLayoutVertexArray=new ga)}update(e,t,r,n,i,s,o,a){this.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o,a)}isEmpty(){return 0===this.layoutVertexArray.length}needsUpload(){return this.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,kd.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.lineIndexBuffer=e.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=e.createVertexBuffer(this.elevatedLayoutVertexArray,Ad.members))),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(e,t,r,n,i,s,o){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,t,r,n,i,s,void 0,o)}}class xh{constructor(e){this.zoom=e.zoom,this.pixelRatio=e.pixelRatio,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=e.lut,this.bufferData=new vh(e,!1),this.elevationBufferData=new vh(e,!0),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=e.sourceLayerIndex,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.hasPattern=sh("fill",this.layers,this.pixelRatio,t);const i=this.layers[0].layout.get("fill-sort-key"),s=[];for(const{feature:o,id:a,index:l,sourceLayerIndex:c}of e){const e=this.layers[0]._featureFilter.needGeometry,u=Ec(o,e);if(!this.layers[0]._featureFilter.filter(new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),u,r))continue;const d=i?i.evaluate(u,{},r,t.availableImages):void 0,h={id:a,properties:o.properties,type:o.type,sourceLayerIndex:c,index:l,geometry:e?u.geometry:Cc(o,r,n),patterns:{},sortKey:d};s.push(h)}i&&s.sort((e,t)=>e.sortKey-t.sortKey);for(const o of s){const{geometry:n,index:i,sourceLayerIndex:s}=o;if(this.hasPattern){const e=oh("fill",this.layers,o,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(o,n,i,r,{},t.availableImages,t.brightness,t.elevationFeatures);t.featureIndex.insert(e[i].feature,n,i,s,this.index)}}update(e,t,r,n,i,s,o){this.bufferData.update(e,t,r,n,i,s,o,this.worldview),this.elevationBufferData.update(e,t,r,n,i,s,o,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(e,t,r,n,i,s,o,this.worldview)}addFeatures(e,t,r,n,i,s){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,t,r,n,s,e.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(e){this.bufferData.upload(e),this.elevationBufferData.upload(e),this.elevatedStructures&&this.elevatedStructures.upload(e)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:[],o=arguments.length>6?arguments[6]:void 0,a=arguments.length>7?arguments[7]:void 0;const l=rh(t,500);"none"!==this.elevationMode?this.addElevatedRoadFeature(e,l,n,r,a):this.addGeometry(l,this.bufferData),this.bufferData.populatePaintArrays(e,r,i,s,n,o,this.worldview),this.elevationBufferData.populatePaintArrays(e,r,i,s,n,o,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(e,t,r,n,i){this.elevatedStructures&&(this.elevatedStructures.construct(e),this.elevatedStructures.populatePaintArrays(t,r,n,i,this.worldview))}addElevatedRoadFeature(e,t,r,n,i){const s=new Array,o=tu.getElevationFeature(e,i);if(!o)return void this.addGeometry(t,this.bufferData);{const e=this.clipPolygonsToTile(t,1);e.length>0&&s.push({polygons:e,elevationFeature:o,elevationTileID:r})}const a={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(e,{},r),featureIndex:n};for(const l of s)if(l.elevationFeature){if("hd-road-base"===this.elevationMode){this.elevatedStructures||(this.elevatedStructures=new uh(l.elevationTileID,this.layers,this.zoom,this.lut));const t=l.elevationFeature.isTunnel();let r=0;e.properties.hasOwnProperty(Oc)&&(r=+e.properties[Oc]);for(const e of l.polygons)this.elevatedStructures.addPortalCandidates(l.elevationFeature.id,e,t,l.elevationFeature,r)}null==l.elevationFeature.constantHeight&&(l.polygons=this.prepareElevatedPolygons(l.polygons,l.elevationFeature,l.elevationTileID));const t=new ru(r,l.elevationTileID);this.addElevatedGeometry(l.polygons,t,l.elevationFeature,"hd-road-base"===this.elevationMode?0:.05,n,a)}}addElevatedGeometry(e,t,r,n,i,s){const o={elevation:r,elevationSampler:t,bias:n,index:i,featureInfo:s},[a,l]=this.addGeometry(e,this.elevationBufferData,o);null==this.elevationBufferData.heightRange?this.elevationBufferData.heightRange={min:a,max:l}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,a),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,l))}addGeometry(e,t,r){let n=Number.POSITIVE_INFINITY,i=Number.NEGATIVE_INFINITY,s=null;r&&(s=r.elevationSampler.constantElevation(r.elevation,r.bias),null!=s&&(n=s,i=s));const o=(e,o,a)=>{if(null!=r)if(o.push(e),null!=s)t.elevatedLayoutVertexArray.emplaceBack(s),a.push(s);else{const s=r.elevationSampler.pointElevation(e,r.elevation,r.bias);t.elevatedLayoutVertexArray.emplaceBack(s),a.push(s),n=Math.min(n,s),i=Math.max(i,s)}};for(const a of e){let e=0;for(const t of a)e+=t.length;const n=t.triangleSegments.prepareSegment(e,t.layoutVertexArray,t.indexArray),i=n.vertexLength,s=[],l=[],c=[],u=[],d=[],h=t.layoutVertexArray.length;for(const m of a){if(0===m.length)continue;m!==a[0]&&l.push(s.length/2);const e=t.lineSegments.prepareSegment(m.length,t.layoutVertexArray,t.lineIndexArray),n=e.vertexLength;r&&d.push(t.layoutVertexArray.length-h),o(m[0],c,u),t.layoutVertexArray.emplaceBack(m[0].x,m[0].y),t.lineIndexArray.emplaceBack(n+m.length-1,n),s.push(m[0].x),s.push(m[0].y);for(let r=1;r<m.length;r++)o(m[r],c,u),t.layoutVertexArray.emplaceBack(m[r].x,m[r].y),t.lineIndexArray.emplaceBack(n+r-1,n+r),s.push(m[r].x),s.push(m[r].y);e.vertexLength+=m.length,e.primitiveLength+=m.length}const p=Nd(s,l);for(let r=0;r<p.length;r+=3)t.indexArray.emplaceBack(i+p[r],i+p[r+1],i+p[r+2]);if(p.length>0&&r&&"hd-road-base"===this.elevationMode){const e=r.elevation.isTunnel(),t=r.elevation.safeArea,n=this.elevatedStructures.addVertices(c,u);this.elevatedStructures.addTriangles(p,n,e);const i=d.length;if(i>0){for(let s=0;s<i-1;s++)this.elevatedStructures.addRenderableRing(r.index,d[s]+n,d[s+1]-d[s],e,t,r.featureInfo);this.elevatedStructures.addRenderableRing(r.index,d[i-1]+n,c.length-d[i-1],e,t,r.featureInfo)}}n.vertexLength+=e,n.primitiveLength+=p.length/3}return[n,i]}prepareElevatedPolygons(e,t,r){const n=1/vc(r),i=[];for(const s of e){const e=gh(s,new $c(t,n));i.push(...e)}return i}clipPolygonsToTile(e,t){const r=-t,n=-t,i=Bn+t,s=Bn+t;let o=0;const a=[],l=[];for(;o<e.length;o++){const t=e[o],c=_n(t);(c.min.x>=r&&c.max.x<=i&&c.min.y>=n&&c.max.y<=s?a:l).push(t)}if(a.length===e.length)return e;const c=[new Se(r,n),new Se(i,n),new Se(i,s),new Se(r,s),new Se(r,n)],u=a;for(const d of l)u.push(...fh(d,c));return u}}let bh,wh,jh,Sh;$s(xh,"FillBucket",{omit:["layers","patternFeatures"]}),$s(vh,"FillBufferData"),$s(uh,"ElevatedStructures");class Th{constructor(e,t,r,n){if(this.triangleCount=t.length/3,this.min=new Se(0,0),this.max=new Se(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],0===this.triangleCount||0===e.length)return;const[i,s]=[e[0].clone(),e[0].clone()];for(let u=1;u<e.length;++u){const t=e[u];i.x=Math.min(i.x,t.x),i.y=Math.min(i.y,t.y),s.x=Math.max(s.x,t.x),s.y=Math.max(s.y,t.y)}if(n){const e=Math.ceil(Math.max(s.x-i.x,s.y-i.y)/n);r=Math.max(r,e)}if(0===r)return;this.min=i,this.max=s;const o=this.max.sub(this.min);o.x=Math.max(o.x,1),o.y=Math.max(o.y,1);const a=Math.max(o.x,o.y)/r;this.cellsX=Math.max(1,Math.ceil(o.x/a)),this.cellsY=Math.max(1,Math.ceil(o.y/a)),this.xScale=1/a,this.yScale=1/a;const l=[];for(let u=0;u<this.triangleCount;u++){const r=e[t[3*u+0]].sub(this.min),n=e[t[3*u+1]].sub(this.min),i=e[t[3*u+2]].sub(this.min),s=kh(Math.floor(Math.min(r.x,n.x,i.x)),this.xScale,this.cellsX),o=kh(Math.floor(Math.max(r.x,n.x,i.x)),this.xScale,this.cellsX),c=kh(Math.floor(Math.min(r.y,n.y,i.y)),this.yScale,this.cellsY),d=kh(Math.floor(Math.max(r.y,n.y,i.y)),this.yScale,this.cellsY),h=new Se(0,0),p=new Se(0,0),m=new Se(0,0),f=new Se(0,0);for(let e=c;e<=d;++e){h.y=p.y=e*a,m.y=f.y=(e+1)*a;for(let t=s;t<=o;++t)h.x=m.x=t*a,p.x=f.x=(t+1)*a,(vu(r,n,i,h,p,f)||vu(r,n,i,h,f,m))&&l.push({cellIdx:e*this.cellsX+t,triIdx:u})}}if(0===l.length)return;l.sort((e,t)=>e.cellIdx-t.cellIdx||e.triIdx-t.triIdx);let c=0;for(;c<l.length;){const e=l[c].cellIdx,t={start:this.payload.length,len:0};for(;c<l.length&&l[c].cellIdx===e;)++t.len,this.payload.push(l[c++].triIdx);this.cells[e]=t}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(e,t){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>e.x||e.y>this.max.y||this.min.y>e.y)return;const r=kh(e.x-this.min.x,this.xScale,this.cellsX),n=kh(e.y-this.min.y,this.yScale,this.cellsY),i=this.cells[n*this.cellsX+r];if(i){this._lazyInitLookup();for(let e=0;e<i.len;e++){const r=this.payload[i.start+e],n=Math.floor(r/8),s=1<<r%8;if(!(this.lookup[n]&s)&&(this.lookup[n]|=s,t.push(r),t.length===this.triangleCount))return}}}query(e,t,r){if(0===this.triangleCount||0===this.cells.length)return;if(e.x>this.max.x||this.min.x>t.x)return;if(e.y>this.max.y||this.min.y>t.y)return;this._lazyInitLookup();const n=kh(e.x-this.min.x,this.xScale,this.cellsX),i=kh(t.x-this.min.x,this.xScale,this.cellsX),s=kh(e.y-this.min.y,this.yScale,this.cellsY),o=kh(t.y-this.min.y,this.yScale,this.cellsY);for(let a=s;a<=o;a++)for(let e=n;e<=i;e++){const t=this.cells[a*this.cellsX+e];if(t)for(let e=0;e<t.len;e++){const n=this.payload[t.start+e],i=Math.floor(n/8),s=1<<n%8;if(!(this.lookup[i]&s)&&(this.lookup[i]|=s,r.push(n),r.length===this.triangleCount))return}}}}function kh(e,t,r){return Math.max(0,Math.min(r-1,Math.floor(e*t)))}$s(Th,"TriangleGridIndex");class Ah{constructor(e){this.zoom=e.zoom,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.footprints=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){for(const r of this.footprints)t.push({footprint:r,id:e})}updateAppearances(e,t,r,n){}populate(e,t,r,n){const i=[];for(const{feature:s,id:o,index:a,sourceLayerIndex:l}of e){const e=this.layers[0]._featureFilter.needGeometry,c=Ec(s,e);if(!this.layers[0]._featureFilter.filter(new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),c,r))continue;const u={id:o,properties:s.properties,type:s.type,sourceLayerIndex:l,index:a,geometry:e?c.geometry:Cc(s,r,n),patterns:{}};i.push(u)}for(const s of i){const{geometry:n,index:i,sourceLayerIndex:o}=s;this.addFeature(s,n,i,r,{},t.availableImages,t.brightness),t.featureIndex.insert(e[i].feature,n,i,o,this.index)}}isEmpty(){return 0===this.footprints.length}uploadPending(){return!1}upload(e){}update(e,t,r,n,i,s,o){}destroy(){}addFeature(e,t,r,n,i){for(const s of rh(t,2)){const e=[],t=[],r=[],n=new Se(1/0,1/0),i=new Se(-1/0,-1/0);for(const l of s)if(0!==l.length){l!==s[0]&&r.push(t.length/2);for(let r=0;r<l.length;r++)t.push(l[r].x),t.push(l[r].y),e.push(l[r]),n.x=Math.min(n.x,l[r].x),n.y=Math.min(n.y,l[r].y),i.x=Math.max(i.x,l[r].x),i.y=Math.max(i.y,l[r].y)}const o=Nd(t,r),a=new Th(e,o,8,256);this.footprints.push({vertices:e,indices:o,grid:a,min:n,max:i})}}}$s(Ah,"ClipBucket",{omit:["layers"]});const Ch=da([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),Eh=da([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),Nh=da([{name:"a_flood_light_ground_radius",components:1,type:"Float32"}]),Ih=da([{name:"a_centroid_pos",components:2,type:"Uint16"}]),Ph=da([{name:"a_join_normal_inside",components:3,type:"Int16"}]),Mh=da([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Lh=da([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:Rh}=Ch,Dh=Number.MAX_SAFE_INTEGER,Fh=Dh-1;function Oh(e,t,r,n){return e.order<t||e.order===Dh||!(e.clipMask&r)||function(e,t){return 0!==t.length&&void 0===t.find(t=>t===e)}(n,e.clipScope)}function zh(e,t){return e.x-t.x||e.y-t.y}function Bh(e,t){return 0===zh(e.min,t.min)&&0===zh(e.max,t.max)}function Uh(e,t){return!(e.min.x>t.max.x||e.max.x<t.min.x||e.min.y>t.max.y||e.max.y<t.min.y)}function Vh(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;r++)if(e[r].sourceId!==t[r].sourceId||!Bh(e[r],t[r])||e[r].order!==t[r].order||e[r].clipMask!==t[r].clipMask||!Te(e[r].clipScope,t[r].clipScope))return!1;return!0}function qh(e,t,r){const n=1/Bn,i=1/(1<<r.canonical.z),s=(t.x*n+r.canonical.x)*i+r.wrap,o=(t.y*n+r.canonical.y)*i;return{min:new Se((e.x*n+r.canonical.x)*i+r.wrap,(e.y*n+r.canonical.y)*i),max:new Se(s,o)}}function Wh(e,t,r){const n=1<<r.canonical.z,i=((t.x-r.wrap)*n-r.canonical.x)*Bn,s=(t.y*n-r.canonical.y)*Bn;return{min:new Se(((e.x-r.wrap)*n-r.canonical.x)*Bn,(e.y*n-r.canonical.y)*Bn),max:new Se(i,s)}}function Hh(e,t,r,n,i,s,o){const a=e.indices,l=e.vertices,c=[];for(let u=n;u<n+i;u+=3){const n=t[r[u+0]+s],i=t[r[u+1]+s],d=t[r[u+2]+s],h=Math.min(n.x,i.x,d.x),p=Math.max(n.x,i.x,d.x),m=Math.min(n.y,i.y,d.y),f=Math.max(n.y,i.y,d.y);c.length=0,e.grid.query(new Se(h,m),new Se(p,f),c);for(let e=0;e<c.length;e++){const t=c[e];if(vu(l[a[3*t+0]],l[a[3*t+1]],l[a[3*t+2]],n,i,d,o))return!0}}return!1}function Gh(e,t,r,n){if(!e||!r)return!1;let i=e.vertices;if(!t.canonical.equals(n.canonical)||t.wrap!==n.wrap){if(r.vertices.length<e.vertices.length)return Gh(r,n,e,t);const s=t.canonical,o=n.canonical,a=Math.pow(2,o.z-s.z);i=e.vertices.map(e=>new Se((e.x+s.x*Bn)*a-o.x*Bn,(e.y+s.y*Bn)*a-o.y*Bn))}return Hh(r,i,e.indices,0,e.indices.length,0,0)}function Zh(e,t,r,n){const i=Math.pow(2,n.z-r.z);return new Se((e+r.x*Bn)*i-n.x*Bn,(t+r.y*Bn)*i-n.y*Bn)}function Kh(e,t){const r=[];t.grid.queryPoint(e,r);const n=t.indices,i=t.vertices;for(let s=0;s<r.length;s++){const t=r[s];if(fu([i[n[3*t+0]],i[n[3*t+1]],i[n[3*t+2]]],e))return!0}return!1}const Yh=[new Se(0,0),new Se(Bn,0),new Se(Bn,Bn),new Se(0,Bn)];function Xh(e,t){const r=[];let n=[];if(!t||e.length<2)return[e];if(2===e.length)return yu(e[0],e[1],Yh)?[e]:[];for(let i=0;i<e.length+2;i++){const t=e[i%e.length],s=e[(i+1)%e.length],o=yu(0===i?e[e.length-1]:e[(i-1)%e.length],t,Yh),a=yu(t,s,Yh),l=o||a;l&&n.push(t),l&&a||n.length>0&&(n.length>1&&r.push(n),n=[])}return n.length>1&&r.push(n),r}const Jh=Nc.types,Qh=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],$h=["fill-extrusion-flood-light-ground-radius"],ep=Math.pow(2,13),tp=Math.pow(2,15)-1,rp=new Se(0,1),np=2147483648,ip=7,sp=450;function op(e,t,r,n,i,s,o,a){e.emplaceBack((t<<1)+o,(r<<1)+s,(Math.floor(n*ep)<<1)+i,Math.round(a))}function ap(e,t,r){e.emplaceBack(t.x*Bn,t.y*Bn,r?1:0)}function lp(e,t,r,n,i,s){e.emplaceBack(t.x,t.y,(r.x<<1)+n,(r.y<<1)+i,s)}function cp(e,t,r){const n=16384;e.emplaceBack(t.x,t.y,t.z,r[0]*n,r[1]*n,r[2]*n)}class up{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class dp{constructor(){this.centroidXY=new Se(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Se(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Se(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Se(this.max.x-this.min.x,this.max.y-this.min.y)}}class hp{constructor(){this.acc=new Se(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(e,t){e.min.x===Number.MAX_VALUE&&(e.min.x=e.max.x=t.x,e.min.y=e.max.y=t.y)}appendEdge(e,t,r){this.accCount++,this.acc._add(t);let n=!!this.borders;t.x<e.min.x?(e.min.x=t.x,n=!0):t.x>e.max.x&&(e.max.x=t.x,n=!0),t.y<e.min.y?(e.min.y=t.y,n=!0):t.y>e.max.y&&(e.max.y=t.y,n=!0),((0===t.x||t.x===Bn)&&t.x===r.x)!=((0===t.y||t.y===Bn)&&t.y===r.y)&&this.processBorderOverlap(t,r),n&&this.checkBorderIntersection(t,r)}checkBorderIntersection(e,t){t.x<0!=e.x<0&&this.addBorderIntersection(0,hr(t.y,e.y,(0-t.x)/(e.x-t.x))),t.x>Bn!=e.x>Bn&&this.addBorderIntersection(1,hr(t.y,e.y,(Bn-t.x)/(e.x-t.x))),t.y<0!=e.y<0&&this.addBorderIntersection(2,hr(t.x,e.x,(0-t.y)/(e.y-t.y))),t.y>Bn!=e.y>Bn&&this.addBorderIntersection(3,hr(t.x,e.x,(Bn-t.y)/(e.y-t.y)))}addBorderIntersection(e,t){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const r=this.borders[e];t<r[0]&&(r[0]=t),t>r[1]&&(r[1]=t)}processBorderOverlap(e,t){if(e.x===t.x){if(e.y===t.y)return;const r=0===e.x?0:1;this.addBorderIntersection(r,t.y),this.addBorderIntersection(r,e.y)}else{const r=0===e.y?2:3;this.addBorderIntersection(r,t.x),this.addBorderIntersection(r,e.x)}}centroid(){return 0===this.accCount?new Se(0,0):new Se(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((e,t)=>e+ +(t[0]!==Number.MAX_VALUE),0):0}}function pp(e,t){const r=e.add(t)._unit(),n=Le(e.x*r.x+e.y*r.y,-1,1);var i,s,o;return i=Math.acos(n),Math.min(4,Math.max(-4,Math.tan(i)))/4*tp*((s=e).x*(o=t).y-s.y*o.x<0?-1:1)}const mp=[e=>e.x<0,e=>e.x>Bn,e=>e.y<0,e=>e.y>Bn];function fp(e,t,r,n){const i=[4];if(0===n)return i;r._mult(n);const s=e.sub(r),o=t.sub(r),a=[e,t,s,o];for(let l=0;l<4;l++)for(const e of a)if(mp[l](e)){i.push(l);break}return i}class gp{constructor(e){this.groundRadiusArray=null,this.groundRadiusBuffer=null,this.vertexArray=new va,this.indexArray=new La,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut},e=>$h.includes(e)),this._segments=new dl,this.hiddenByLandmarkVertexArray=new Ka,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new dl}getDefaultSegment(){return this.regionSegments[4]}hasData(){return 0!==this.vertexArray.length}addData(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];const i=e.length;if(i>2){let s=Math.max(0,this._segments.get().length-1);const o=this._segments._prepareSegment(4*i,this.vertexArray.length,2*this._segmentToGroundQuads[s].length);let a;s!==this._segments.get().length-1&&(s++,this._segmentToGroundQuads[s]=[],this._segmentToRegionTriCounts[s]=[0,0,0,0,0]);{const t=e[0],r=e[1];a=pp(t.sub(e[i-1])._perp()._unit(),r.sub(t)._perp()._unit())}for(let l=0;l<i;l++){const c=l===i-1?0:l+1,u=e[l],d=e[c],h=e[c===i-1?0:c+1],p=d.sub(u)._perp()._unit(),m=pp(p,h.sub(d)._perp()._unit()),f=a,g=m;if(bp(u,d,t)||n&&wp(u,t)&&wp(d,t)){a=m;continue}const y=o.vertexLength;lp(this.vertexArray,u,d,1,1,f),lp(this.vertexArray,u,d,1,0,f),lp(this.vertexArray,u,d,0,1,g),lp(this.vertexArray,u,d,0,0,g),o.vertexLength+=4;const _=fp(u,d,p,r);for(const e of _)this._segmentToGroundQuads[s].push({id:y,region:e}),this._segmentToRegionTriCounts[s][e]+=2,o.primitiveLength+=2;a=m}}}prepareBorderSegments(){if(!this.hasData())return;const e=this._segments.get(),t=e.length;for(let r=0;r<t;r++)this._segmentToGroundQuads[r].sort((e,t)=>e.region-t.region);for(let r=0;r<t;r++){const t=this._segmentToGroundQuads[r],n=e[r],i=this._segmentToRegionTriCounts[r];i.reduce((e,t)=>e+t,0);let s=0;for(let e=0;e<=4;e++){const t=i[e];if(0!==t){let r=this.regionSegments[e];r||(r=this.regionSegments[e]=new dl);const i={vertexOffset:n.vertexOffset,primitiveOffset:n.primitiveOffset+s,vertexLength:n.vertexLength,primitiveLength:t};r.get().push(i)}s+=t}for(let e=0;e<t.length;e++){const r=t[e].id;this.indexArray.emplaceBack(r,r+1,r+3),this.indexArray.emplaceBack(r,r+3,r+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(e,t,r,n,i,s,o){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,e,t,r,n,i,s,void 0,o)}upload(e){this.hasData()&&(this.vertexBuffer=e.createVertexBuffer(this.vertexArray,Eh.members),this.indexBuffer=e.createIndexBuffer(this.indexArray),null!=this.groundRadiusArray&&(this.groundRadiusBuffer=e.createVertexBuffer(this.groundRadiusArray,Nh.members)))}uploadPaintProperties(e){this.hasData()&&this.programConfigurations.upload(e)}update(e,t,r,n,i,s,o,a){this.hasData()&&this.programConfigurations.updatePaintArrays(e,t,r,n,i,s,o,a)}updateHiddenByLandmark(e){this.updateHiddenByLandmarkRange(e.groundVertexArrayOffset,e.groundVertexCount,!!(e.flags&np))}updateHiddenByLandmarkRange(e,t,r){if(!this.hasData())return;const n=t+e;if(0!==t){for(let t=e;t<n;++t)this.hiddenByLandmarkVertexArray.emplace(t,r?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(e){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=e.createVertexBuffer(this.hiddenByLandmarkVertexArray,Mh.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this.groundRadiusBuffer&&this.groundRadiusBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let e=0;e<=4;e++){const t=this.regionSegments[e];t&&t.destroy()}}}}class yp{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaling=e.overscaling,this.layers=e.layers,this.pixelRatio=e.pixelRatio,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=e.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new La,this.footprintVertices=new pa,this.footprintSegments=[],this.layoutVertexArray=new fa,this.centroidVertexArray=new sl,this.wallVertexArray=new al,this.indexArray=new La,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut},e=>Qh.includes(e)),this.segments=new dl,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.groundEffect=new gp(e),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.features=[],this.hasPattern=sh("fill-extrusion",this.layers,this.pixelRatio,t),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=vc(r),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=0!==this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1);for(const{feature:i,id:s,index:o,sourceLayerIndex:a}of e){const e=this.layers[0]._featureFilter.needGeometry,l=Ec(i,e);if(!this.layers[0]._featureFilter.filter(new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),l,r))continue;const c={id:s,sourceLayerIndex:a,index:o,geometry:e?l.geometry:Cc(i,r,n),properties:i.properties,type:i.type,patterns:{}},u=this.layoutVertexArray.length,d="Polygon"===Jh[c.type];if(this.hasPattern)this.features.push({featureId:i.id,feature:oh("fill-extrusion",this.layers,c,this.zoom,this.pixelRatio,t)});else if(this.wallMode)for(const s of c.geometry)for(const e of Xh(s,d))this.addFeature(i.id,c,[e],o,r,{},t.availableImages,n,t.brightness);else this.addFeature(i.id,c,c.geometry,o,r,{},t.availableImages,n,t.brightness);t.featureIndex.insert(i,c.geometry,o,a,this.index,u)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(e,t,r,n,i,s){for(const{featureId:o,feature:a}of this.features){const e="Polygon"===Jh[a.type],{geometry:l}=a;if(this.wallMode)for(const c of l)for(const l of Xh(c,e))this.addFeature(o,a,[l],a.index,t,r,n,i,s);else this.addFeature(o,a,l,a.index,t,r,n,i,s)}this.sortBorders(),"mercator"===this.projection.name&&this.splitToSubtiles()}update(e,t,r,n,i,s,o){this.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o,this.worldview),this.groundEffect.update(e,t,i,r,n,s,o,this.worldview)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){this.uploaded||(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Rh),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.wallVertexBuffer=e.createVertexBuffer(this.wallVertexArray,Ph.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=e.createVertexBuffer(this.layoutVertexExtArray,Lh.members,!0)),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}uploadCentroid(e){this.groundEffect.uploadHiddenByLandmark(e),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=e.createVertexBuffer(this.centroidVertexArray,Ih.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(e,t,r,n,i,s,o,a,l){const c=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(t,{})/this.tileToMeter,u=[new Se(0,0),new Se(Bn,Bn)],d=a.projection,h="globe"===d.name,p=this.wallMode||"Polygon"===Jh[t.type],m=new hp;m.centroidDataIndex=this.centroidData.length;const f=new dp;f.buildingId=e,t.properties&&t.properties.hasOwnProperty("building_id")&&(f.buildingId=t.properties.building_id);const g=this.layers[0].paint.get("fill-extrusion-base").evaluate(t,{},i)<=0,y=this.layers[0].paint.get("fill-extrusion-height").evaluate(t,{},i);let _;if(f.height=y,f.vertexArrayOffset=this.layoutVertexArray.length,f.groundVertexArrayOffset=this.groundEffect.vertexArray.length,h&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Sa),this.wallMode){if(h)return void Ze("Non zero fill-extrusion-line-width is not yet supported on globe.");if(1!==r.length)return;_=function(e){const t=e[0].x===e[e.length-1].x&&e[0].y===e[e.length-1].y,r=function(e){let t=0;const r=e.length;for(let n=0;n<r;n++)t+=(e[(n+1)%r].x-e[n].x)*(e[(n+1)%r].y+e[n].y);return t>=0}(e);r||(e=e.reverse());const n={geometry:[],joinNormals:[],indices:[]},i=[],s=[],o=[];let a=e.length;for(;a>=2&&e[a-1].equals(e[a-2]);)a--;if(a<(t?3:2))return n;let l,c,u,d,h,p=0;for(;p<a-1&&e[p].equals(e[p+1]);)p++;t&&(l=e[a-2],h=e[p].sub(l)._unit()._perp());for(let f=p;f<a;f++){if(u=f===a-1?t?e[p+1]:void 0:e[f+1],u&&e[f].equals(u))continue;h&&(d=h),l&&(c=l),l=e[f],h=u?u.sub(l)._unit()._perp():d,d=d||h;let r=d.add(h);0===r.x&&0===r.y||r._unit();const n=r.x*h.x+r.y*h.y,m=0!==n?1/n:1/0,g=d.x*h.y-d.y*h.x>0;let y="miter";const _=2;"miter"===y&&m>_&&(y="bevel"),"bevel"===y&&(m>100&&(y="flipbevel"),m<_&&(y="miter"));const v=(e,t,r,n)=>{const a=new Se(e.x,e.y),l=new Se(e.x,e.y);a.x+=t.x*n,a.y+=t.y*n,l.x-=t.x*Math.max(r,1),l.y-=t.y*Math.max(r,1),o.push(t),i.push(a),s.push(l)};if("miter"===y)r._mult(m),v(l,r,0,0);else if("flipbevel"===y)r=h.mult(-1),v(l,r,0,0),v(l,r.mult(-1),0,0);else{const e=-Math.sqrt(m*m-1),t=g?e:0,r=g?0:e;c&&v(l,d,t,r),u&&v(l,h,t,r)}}n.geometry=[...i,...s.reverse(),i[0]],n.joinNormals=[...o,...o.reverse(),o[o.length-1]];const m=n.geometry.length-1;for(let f=0;f<m/2;f++)if(f+1<m/2){let e=f,t=f+1,r=m-1-f,i=m-2-f;e=0===e?m-1:e-1,t=0===t?m-1:t-1,r=0===r?m-1:r-1,i=0===i?m-1:i-1,n.indices.push(r),n.indices.push(t),n.indices.push(e),n.indices.push(r),n.indices.push(i),n.indices.push(t)}return n}(r[0]),r=[_.geometry]}const v=(e,t)=>e<(t.length-1)/2||e===t.length-1,x=this.wallMode?[r]:rh(r,500);for(let k=x.length-1;k>=0;k--){const e=x[k];(0===e.length||(b=e[0]).every(e=>e.x<=0)||b.every(e=>e.x>=Bn)||b.every(e=>e.y<=0)||b.every(e=>e.y>=Bn))&&x.splice(k,1)}var b;let w;if(h)w=kp(x,u,i);else{w=[];for(const e of x)w.push({polygon:e,bounds:u})}const j=p?this.edgeRadius:0,S=j>0&&this.zoom<17,T=(e,t)=>{if(0===e.length)return!1;const r=e[e.length-1];return t.x===r.x&&t.y===r.y};for(const{polygon:k,bounds:A}of w){let e=0,t=0;for(const i of k)p&&!i[0].equals(i[i.length-1])&&i.push(i[0]),t+=p?i.length-1:i.length;const r=this.segments.prepareSegment((p?5:4)*t,this.layoutVertexArray,this.indexArray);f.footprintSegIdx<0&&(f.footprintSegIdx=this.footprintSegments.length),f.polygonSegIdx<0&&(f.polygonSegIdx=this.polygonSegments.length);const n={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},s=new up;if(s.vertexOffset=this.footprintVertices.length,s.indexOffset=3*this.footprintIndices.length,s.ringIndices=[],p){const t=[],n=[];e=r.vertexLength;for(let e=0;e<k.length;e++){const o=k[e];o.length&&0!==e&&n.push(t.length/2);const a=[];let l,u;l=o[1].sub(o[0])._perp()._unit(),s.ringIndices.push(o.length-1);for(let e=1;e<o.length;e++){const n=o[e],s=o[e===o.length-1?1:e+1],c=n.clone();if(j){u=s.sub(n)._perp()._unit();const e=l.add(u)._unit(),t=j*Math.min(4,1/(l.x*e.x+l.y*e.y));c.x+=t*e.x,c.y+=t*e.y,c.x=Math.round(c.x),c.y=Math.round(c.y),l=u}if(!g||0!==j&&!S||T(a,c)||a.push(c),op(this.layoutVertexArray,c.x,c.y,0,0,1,1,0),this.wallMode){const t=v(e,o);ap(this.wallVertexArray,_.joinNormals[e],!t)}r.vertexLength++,this.footprintVertices.emplaceBack(n.x,n.y),t.push(n.x,n.y),h&&cp(this.layoutVertexExtArray,d.projectTilePoint(c.x,c.y,i),d.upVector(i,c.x,c.y))}g&&(0===j||S)&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,A,c))}const o=this.wallMode?_.indices:Nd(t,n);for(let i=0;i<o.length;i+=3)this.footprintIndices.emplaceBack(s.vertexOffset+o[i+0],s.vertexOffset+o[i+1],s.vertexOffset+o[i+2]),this.indexArray.emplaceBack(e+o[i],e+o[i+2],e+o[i+1]),r.primitiveLength++;s.indexCount+=o.length,s.vertexCount+=this.footprintVertices.length-s.vertexOffset}for(let o=0;o<k.length;o++){const t=k[o];m.startRing(f,t[0]);let n=t.length>4&&jp(t[t.length-2],t[0],t[1]),s=j?vp(t[t.length-2],t[0],t[1],j):0;const a=[];let l,u,y;u=t[1].sub(t[0])._perp()._unit();let x=!0;for(let o=1,c=0;o<t.length;o++){let p=t[o-1],b=t[o];const w=t[o===t.length-1?1:o+1];if(m.appendEdge(f,b,p),bp(b,p,A)){j&&(u=w.sub(b)._perp()._unit(),x=!x);continue}const S=b.sub(p)._perp(),k=S.x/(Math.abs(S.x)+Math.abs(S.y)),C=S.y>0?1:0,E=p.dist(b);if(c+E>32768&&(c=0),j){y=w.sub(b)._perp()._unit();let e=xp(p,b,w,_p(u,y),j);isNaN(e)&&(e=0);const t=b.sub(p)._unit();p=p.add(t.mult(s))._round(),b=b.add(t.mult(-e))._round(),s=e,u=y,g&&this.zoom>=17&&(T(a,p)||a.push(p),T(a,b)||a.push(b))}const N=r.vertexLength,I=t.length>4&&jp(p,b,w);let P=Sp(c,n,x);if(op(this.layoutVertexArray,p.x,p.y,k,C,0,0,P),op(this.layoutVertexArray,p.x,p.y,k,C,0,1,P),this.wallMode){const e=v(o-1,t),r=_.joinNormals[o-1];ap(this.wallVertexArray,r,e),ap(this.wallVertexArray,r,e)}if(c+=E,P=Sp(c,I,!x),n=I,op(this.layoutVertexArray,b.x,b.y,k,C,0,0,P),op(this.layoutVertexArray,b.x,b.y,k,C,0,1,P),this.wallMode){const e=v(o,t),r=_.joinNormals[o];ap(this.wallVertexArray,r,e),ap(this.wallVertexArray,r,e)}if(r.vertexLength+=4,this.indexArray.emplaceBack(N+0,N+1,N+2),this.indexArray.emplaceBack(N+1,N+3,N+2),r.primitiveLength+=2,j){const n=e+(1===o?t.length-2:o-2),i=1===o?e:n+1;if(this.indexArray.emplaceBack(N+1,n,N+3),this.indexArray.emplaceBack(n,i,N+3),r.primitiveLength+=2,void 0===l&&(l=N),!bp(w,t[o],A)){const e=o===t.length-1?l:r.vertexLength;this.indexArray.emplaceBack(N+2,N+3,e),this.indexArray.emplaceBack(N+3,e+1,e),this.indexArray.emplaceBack(N+3,i,e+1),r.primitiveLength+=3}x=!x}if(h){const e=this.layoutVertexExtArray,t=d.projectTilePoint(p.x,p.y,i),r=d.projectTilePoint(b.x,b.y,i),n=d.upVector(i,p.x,p.y),s=d.upVector(i,b.x,b.y);cp(e,t,n),cp(e,t,n),cp(e,r,s),cp(e,r,s)}}p&&(e+=t.length-1),g&&j&&this.zoom>=17&&(0!==a.length&&T(a,a[0])&&a.pop(),this.groundEffect.addData(a,A,c,j>0))}this.footprintSegments.push(s),n.triangleCount=this.indexArray.length-n.triangleArrayOffset,this.polygonSegments.push(n),++f.footprintSegLen,++f.polygonSegLen}if(f.vertexCount=this.layoutVertexArray.length-f.vertexArrayOffset,f.groundVertexCount=this.groundEffect.vertexArray.length-f.groundVertexArrayOffset,0!==f.vertexCount){if(f.centroidXY=m.borders?rp:this.encodeCentroid(m,f),this.centroidData.push(f),m.borders){this.featuresOnBorder.push(m);const e=this.featuresOnBorder.length-1;for(let t=0;t<m.borders.length;t++)m.borders[t][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[t].push(e)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,n,s,o,i,l,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(t,n,s,o,i,l,this.worldview),this.maxHeight=Math.max(this.maxHeight,y)}}sortBorders(){for(let e=0;e<this.borderFeatureIndices.length;e++)this.borderFeatureIndices[e].sort((t,r)=>this.featuresOnBorder[t].borders[e][0]-this.featuresOnBorder[r].borders[e][0])}splitToSubtiles(){const e=[];for(let o=0;o<this.centroidData.length;o++){const t=this.centroidData[o],r=+(t.min.y+t.max.y>Bn),n=2*r+(+(t.min.x+t.max.x>Bn)^r);for(let i=0;i<t.polygonSegLen;i++){const r=t.polygonSegIdx+i;e.push({centroidIdx:o,subtile:n,polygonSegmentIdx:r,triangleSegmentIdx:this.polygonSegments[r].triangleSegIdx})}}const t=new La;e.sort((e,t)=>e.triangleSegmentIdx===t.triangleSegmentIdx?e.subtile-t.subtile:e.triangleSegmentIdx-t.triangleSegmentIdx);let r=0,n=0,i=0;for(const o of e){if(o.triangleSegmentIdx!==r)break;i++}const s=e.length;for(;n!==e.length;){r=e[n].triangleSegmentIdx;let o=0,a=n,l=n;for(let t=a;t<i&&e[t].subtile===o;t++)l++;for(;a!==i;){const n=e[a];o=n.subtile;const s=this.centroidData[n.centroidIdx].min.clone(),c=this.centroidData[n.centroidIdx].max.clone(),u={vertexOffset:this.segments.segments[r].vertexOffset,primitiveOffset:t.length,vertexLength:this.segments.segments[r].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let r=a;r<l;r++){const n=e[r],i=this.polygonSegments[n.polygonSegmentIdx],o=this.centroidData[n.centroidIdx].min,a=this.centroidData[n.centroidIdx].max,l=this.indexArray.uint16;for(let e=i.triangleArrayOffset;e<i.triangleArrayOffset+i.triangleCount;e++)t.emplaceBack(l[3*e],l[3*e+1],l[3*e+2]);u.primitiveLength+=i.triangleCount,s.x=Math.min(s.x,o.x),s.y=Math.min(s.y,o.y),c.x=Math.max(c.x,a.x),c.y=Math.max(c.y,a.y)}u.primitiveLength>0&&this.triangleSubSegments.push({segment:u,min:s,max:c}),a=l;for(let t=a;t<i&&e[t].subtile===e[a].subtile;t++)l++}n=i;for(let t=n;t<s&&e[t].triangleSegmentIdx===e[n].triangleSegmentIdx;t++)i++}t._trim(),this.indexArray=t}getVisibleSegments(e,t,r){const n=new dl;if(this.wallMode){for(const e of this.triangleSubSegments)n.segments.push(e.segment);return n}let i=0,s=0;const o=1<<e.canonical.z;if(t){const r=t.getMinMaxForTile(e);r&&(i=r.min,s=r.max)}s+=this.maxHeight;const a=e.toUnwrapped();let l;const c=[a.canonical.x/o+a.wrap,a.canonical.y/o],u=[(a.canonical.x+1)/o+a.wrap,(a.canonical.y+1)/o],d=(e,t,r)=>[e[0]*(1-r[0])+t[0]*r[0],e[1]*(1-r[1])+t[1]*r[1]],h=[],p=[];for(const m of this.triangleSubSegments){h[0]=m.min.x/Bn,h[1]=m.min.y/Bn,p[0]=m.max.x/Bn,p[1]=m.max.y/Bn;const e=d(c,u,h),t=d(c,u,p);if(0===new Qc([e[0],e[1],i],[t[0],t[1],s]).intersectsPrecise(r)){l&&(n.segments.push(l),l=void 0);continue}const o=m.segment;l&&l.vertexOffset!==o.vertexOffset&&(n.segments.push(l),l=void 0),l?(l.vertexLength+=o.vertexLength,l.primitiveLength+=o.primitiveLength):l={vertexOffset:o.vertexOffset,primitiveLength:o.primitiveLength,vertexLength:o.vertexLength,primitiveOffset:o.primitiveOffset,sortKey:void 0,vaos:{}}}return l&&n.segments.push(l),n}encodeCentroid(e,t){const r=e.centroid(),n=t.span(),i=Math.min(7,Math.round(n.x*this.tileToMeter/10)),s=Math.min(7,Math.round(n.y*this.tileToMeter/10));return new Se(Le(r.x,1,Bn-1)<<3|i,Le(r.y,1,Bn-1)<<3|s)}encodeBorderCentroid(e){if(!e.borders)return new Se(0,0);const t=e.borders,r=Number.MAX_VALUE;if(t[0][0]!==r||t[1][0]!==r){const e=t[0][0]!==r?0:1;return new Se(6|(t[0][0]!==r?0:65528),(t[e][0]+t[e][1])/2<<3|6)}{const e=t[2][0]!==r?2:3;return new Se((t[e][0]+t[e][1])/2<<3|6,6|(t[2][0]!==r?0:65528))}}showCentroid(e){const t=this.centroidData[e.centroidDataIndex];t.flags&=2147483647,t.centroidXY.x=0,t.centroidXY.y=0,this.writeCentroidToBuffer(t)}writeCentroidToBuffer(e){this.groundEffect.updateHiddenByLandmark(e);const t=e.vertexArrayOffset,r=e.vertexCount+e.vertexArrayOffset,n=e.flags&np?rp:e.centroidXY,i=this.centroidVertexArray.geta_centroid_pos0(t);if(this.centroidVertexArray.geta_centroid_pos1(t)!==n.y||i!==n.x){for(let e=t;e<r;++e)this.centroidVertexArray.emplace(e,n.x,n.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const e of this.centroidData)this.writeCentroidToBuffer(e)}updateReplacement(e,t,r){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(Vh(this.activeReplacements,n))return;if(this.activeReplacements=n,0===this.centroidVertexArray.length)this.createCentroidsBuffer();else for(const s of this.centroidData)s.flags&=2147483647;const i=[];for(const s of this.activeReplacements){if(s.order<r)continue;const t=Math.max(1,Math.pow(2,s.footprintTileId.canonical.z-e.canonical.z));if(s.footprint.buildingIds)for(const e of this.centroidData)e.flags&np||s.min.x>e.max.x||e.min.x>s.max.x||s.min.y>e.max.y||e.min.y>s.max.y||s.footprint.buildingIds.has(e.buildingId)&&(e.flags|=np);else for(const r of this.centroidData)if(!(r.flags&np||s.min.x>r.max.x||r.min.x>s.max.x||s.min.y>r.max.y||r.min.y>s.max.y))for(let n=0;n<r.footprintSegLen;n++){const o=this.footprintSegments[r.footprintSegIdx+n];if(i.length=0,Ap(this.footprintVertices,o.vertexOffset,o.vertexCount,s.footprintTileId.canonical,e.canonical,i),Hh(s.footprint,i,this.footprintIndices.uint16,o.indexOffset,o.indexCount,-o.vertexOffset,-t)){r.flags|=np;break}}}for(const s of this.centroidData)this.writeCentroidToBuffer(s);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(e,t,r){let n=!1;for(let i=0;i<r.footprintSegLen;i++){const s=this.footprintSegments[r.footprintSegIdx+i];let o=0;for(const r of s.ringIndices){for(let i=o,a=r+o-1;i<r+o;a=i++){const r=this.footprintVertices.int16[2*(i+s.vertexOffset)+0],o=this.footprintVertices.int16[2*(i+s.vertexOffset)+1],l=this.footprintVertices.int16[2*(a+s.vertexOffset)+1];o>t!=l>t&&e<(this.footprintVertices.int16[2*(a+s.vertexOffset)+0]-r)*(t-o)/(l-o)+r&&(n=!n)}o=r}}return n}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(e+Bn)*Bn+(t+Bn);if(this.partLookup.hasOwnProperty(i)){const e=this.partLookup[i];return e?{height:e.height,hidden:!!(e.flags&np)}:void 0}for(const s of this.centroidData)e>s.max.x||s.min.x>e||t>s.max.y||s.min.y>t||s.height<=r||this.footprintContainsPoint(e,t,s)&&(r=s.height,this.partLookup[i]=s,n=!!(s.flags&np));if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.partLookup[i]=void 0}}function _p(e,t){const r=e.add(t)._unit();return e.x*r.x+e.y*r.y}function vp(e,t,r,n){const i=t.sub(e)._perp()._unit(),s=r.sub(t)._perp()._unit();return xp(e,t,r,_p(i,s),n)}function xp(e,t,r,n,i){const s=Math.sqrt(1-n*n);return Math.min(e.dist(t)/3,t.dist(r)/3,i*s/n)}function bp(e,t,r){return e.x<r[0].x&&t.x<r[0].x||e.x>r[1].x&&t.x>r[1].x||e.y<r[0].y&&t.y<r[0].y||e.y>r[1].y&&t.y>r[1].y}function wp(e,t){return e.x<t[0].x||e.x>t[1].x||e.y<t[0].y||e.y>t[1].y}function jp(e,t,r){if(e.x<0||e.x>=Bn||t.x<0||t.x>=Bn||r.x<0||r.x>=Bn)return!1;const n=r.sub(t),i=n.perp(),s=e.sub(t);return(n.x*s.x+n.y*s.y)/Math.sqrt((n.x*n.x+n.y*n.y)*(s.x*s.x+s.y*s.y))>-.866&&i.x*s.x+i.y*s.y<0}function Sp(e,t,r){const n=t?2|e:-3&e;return r?1|n:-2&n}function Tp(){const e=Math.PI/32,t=Math.tan(e),r=rc;return r*Math.sqrt(1+2*t*t)-r}function kp(e,t,r){const n=1<<r.z,i=hc(r.x/n),s=hc((r.x+1)/n),o=pc(r.y/n),a=pc((r.y+1)/n);return function(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,s=arguments.length>5?arguments[5]:void 0;const o=[];if(!e.length||!r||!n)return o;const a=(e,t)=>{for(const r of e)o.push({polygon:r,bounds:t})},l=Math.ceil(Math.log2(r)),c=Math.ceil(Math.log2(n)),u=l-c,d=[];for(let m=0;m<Math.abs(u);m++)d.push(u>0?0:1);for(let m=0;m<Math.min(l,c);m++)d.push(0),d.push(1);let h=e;if(h=mh(h,t[0].y-i,t[1].y+i,1),h=mh(h,t[0].x-i,t[1].x+i,0),!h.length)return o;const p=[];for(d.length?p.push({polygons:h,bounds:t,depth:0}):a(h,t);p.length;){const e=p.pop(),t=e.depth,r=d[t],n=e.bounds[0],o=e.bounds[1],l=0===r?n.x:n.y,c=0===r?o.x:o.y,u=s?s(r,l,c):.5*(l+c),h=mh(e.polygons,l-i,u+i,r),m=mh(e.polygons,u-i,c+i,r);if(h.length){const e=[n,new Se(0===r?u:o.x,1===r?u:o.y)];d.length>t+1?p.push({polygons:h,bounds:e,depth:t+1}):a(h,e)}if(m.length){const e=[new Se(0===r?u:n.x,1===r?u:n.y),o];d.length>t+1?p.push({polygons:m,bounds:e,depth:t+1}):a(m,e)}}return o}(e,t,Math.ceil((s-i)/11.25),Math.ceil((o-a)/11.25),1,(e,t,i)=>{if(0===e)return.5*(t+i);{const e=pc((r.y+t/Bn)/n);return(uc(.5*(pc((r.y+i/Bn)/n)+e))*n-r.y)*Bn}})}function Ap(e,t,r,n,i,s){const o=Math.pow(2,n.z-i.z);for(let a=0;a<r;a++){let r=e.int16[2*(a+t)+0],l=e.int16[2*(a+t)+1];r=(r+i.x*Bn)*o-n.x*Bn,l=(l+i.y*Bn)*o-n.y*Bn,s.push(new Se(r,l))}}let Cp,Ep;$s(yp,"FillExtrusionBucket",{omit:["layers","features"]}),$s(dp,"PartData"),$s(up,"FootprintSegment"),$s(hp,"BorderCentroidData"),$s(gp,"GroundEffect");class Np extends Se{constructor(e,t,r){super(e,t),this.z=r}}class Ip extends Np{constructor(e,t,r,n){super(e,t,r),this.w=n}}function Pp(e,t,r,n){const i="x"===r?"y":"x",s=(n-e[r])/(t[r]-e[r]);e[i]=Math.round(e[i]+(t[i]-e[i])*s),e[r]=n,e.hasOwnProperty("z")&&(e.z=hr(e.z,t.z,s)),e.hasOwnProperty("w")&&(e.w=hr(e.w,t.w,s))}function Mp(e,t,r,n){const i=r,s=n;for(const o of["x","y"]){let r=e,n=t;r[o]>=n[o]&&(r=t,n=e),r[o]<i&&n[o]>i&&Pp(r,n,o,i),r[o]<s&&n[o]>s&&Pp(n,r,o,s)}}function Lp(e,t,r,n,i,s){const o=[];for(let a=0;a<e.length;a++){const l=e[a];let c;const u=o.length;let d=0;for(let e=0;e<l.length-1;e++){let u=l[e],h=l[e+1],p=0;const m=d;let f,g;s&&(p=Math.hypot(h.x-u.x,h.y-u.y),d+=p,f=u,g=h),u.x<t&&h.x<t||(u.x<t?u=new Se(t,u.y+(t-u.x)/(h.x-u.x)*(h.y-u.y))._round():h.x<t&&(h=new Se(t,u.y+(t-u.x)/(h.x-u.x)*(h.y-u.y))._round()),u.y<r&&h.y<r||(u.y<r?u=new Se(u.x+(r-u.y)/(h.y-u.y)*(h.x-u.x),r)._round():h.y<r&&(h=new Se(u.x+(r-u.y)/(h.y-u.y)*(h.x-u.x),r)._round()),u.x>=n&&h.x>=n||(u.x>=n?u=new Se(n,u.y+(n-u.x)/(h.x-u.x)*(h.y-u.y))._round():h.x>=n&&(h=new Se(n,u.y+(n-u.x)/(h.x-u.x)*(h.y-u.y))._round()),u.y>=i&&h.y>=i||(u.y>=i?u=new Se(u.x+(i-u.y)/(h.y-u.y)*(h.x-u.x),i)._round():h.y>=i&&(h=new Se(u.x+(i-u.y)/(h.y-u.y)*(h.x-u.x),i)._round()),c&&u.equals(c[c.length-1])||(c=[u],o.push(c),s&&s.push({progress:{min:m+Dp(f,g,u)*p,max:1},parentIndex:a,prevPoint:f,nextPoint:g})),c.push(h),s&&(s[s.length-1].progress.max=m+Dp(f,g,h)*p,s[s.length-1].nextPoint=g)))))}if(s&&d>0)for(let e=u;e<o.length;e++)s[e].progress.min/=d,s[e].progress.max/=d}return o}function Rp(e,t,r,n,i){if(e.length<2)return void n.push(e);const s=[];for(;t.valid();){const[r,n]=t.get();for(let t=0;t<e.length-1;t++){const i=e[t],o=e[t+1],a=du(i,o,r,n);if(a){const[e]=a,r=new Se(hr(i.x,o.x,e),hr(i.y,o.y,e));s.push({t:t+e,distance:0,point:r})}}t.next()}if(0===s.length)return void n.push(e);s.sort((e,t)=>e.t-t.t);let o=0,a=0,l=[];for(n.push(l);o!==e.length;){if(a===s.length){for(;o!==e.length;)0!==l.length&&l[l.length-1].equals(e[o])||l.push(e[o]),o++;break}s[a].t<=o?(0!==l.length&&l[l.length-1].equals(s[a].point)||l.push(s[a].point),Math.trunc(s[a].t),a++):(0!==l.length&&l[l.length-1].equals(e[o])||l.push(e[o]),o++)}}function Dp(e,t,r){return e.x!==t.x?(r.x-e.x)/(t.x-e.x):e.y!==t.y?(r.y-e.y)/(t.y-e.y):0}function Fp(e,t){return e.x*t.x+e.y*t.y}function Op(e,t){if(1===e.length){let r=0;const n=t[r++];let i;for(;!i||n.equals(i);)if(i=t[r++],!i)return 1/0;for(;r<t.length;r++){const s=t[r],o=e[0],a=i.sub(n),l=s.sub(n),c=o.sub(n),u=Fp(a,a),d=Fp(a,l),h=Fp(l,l),p=Fp(c,a),m=Fp(c,l),f=u*h-d*d,g=(h*p-d*m)/f,y=(u*m-d*p)/f,_=n.z*(1-g-y)+i.z*g+s.z*y;if(isFinite(_))return _}return 1/0}{let e=1/0;for(const r of t)e=Math.min(e,r.z);return e}}function zp(e,t,r){let n=1/0;ou(r,t)&&(n=Op(r,t[0]));for(let i=0;i<t.length;i++){const s=t[i],o=e[i];for(let e=0;e<s.length-1;e++){const t=s[e],i=[t,s[e+1],o[e+1],o[e],t];iu(r,i)&&(n=Math.min(n,Op(r,i)))}}return n!==1/0&&n}function Bp(e,t,r,n,i,s,o,a,l,c,u){return"globe"===e.projection.name?function(e,t,r,n,i,s,o,a,l,c,u){const d=[],h=[],p=e.projection.upVectorScale(u,e.center.lat,e.worldSize).metersToTile,m=[0,0,0,1],f=[0,0,0,1],g=(e,t,r,n)=>{e[0]=t,e[1]=r,e[2]=n,e[3]=1},y=Tp();r>0&&(r+=y),n+=y;for(const _ of t){const t=[],y=[];for(const d of _){const h=d.x+i.x,_=d.y+i.y,v=e.projection.projectTilePoint(h,_,u),x=e.projection.upVector(u,d.x,d.y);let b=r,w=n;if(o){const e=Up(h,_,r,n,o,a,l,c);b+=e.base,w+=e.top}0!==r?g(m,v.x+x[0]*p*b,v.y+x[1]*p*b,v.z+x[2]*p*b):g(m,v.x,v.y,v.z),g(f,v.x+x[0]*p*w,v.y+x[1]*p*w,v.z+x[2]*p*w),V(m,m,s),V(f,f,s),t.push(new Np(m[0],m[1],m[2])),y.push(new Np(f[0],f[1],f[2]))}d.push(t),h.push(y)}return[d,h]}(e,t,r,n,i,s,o,a,l,c,u):o?function(e,t,r,n,i,s,o,a,l){const c=[],u=[],d=[0,0,0,1];for(const h of e){const e=[],p=[];for(const c of h){const u=c.x+n.x,h=c.y+n.y,m=Up(u,h,t,r,s,o,a,l);d[0]=u,d[1]=h,d[2]=m.base,d[3]=1,$(d,d,i),d[3]=Math.max(d[3],1e-5);const f=new Np(d[0]/d[3],d[1]/d[3],d[2]/d[3]);d[0]=u,d[1]=h,d[2]=m.top,d[3]=1,$(d,d,i),d[3]=Math.max(d[3],1e-5);const g=new Np(d[0]/d[3],d[1]/d[3],d[2]/d[3]);e.push(f),p.push(g)}c.push(e),u.push(p)}return[c,u]}(t,r,n,i,s,o,a,l,c):function(e,t,r,n,i){const s=[],o=[],a=i[8]*t,l=i[9]*t,c=i[10]*t,u=i[11]*t,d=i[8]*r,h=i[9]*r,p=i[10]*r,m=i[11]*r;for(const f of e){const e=[],t=[];for(const r of f){const s=r.x+n.x,o=r.y+n.y,f=i[0]*s+i[4]*o+i[12],g=i[1]*s+i[5]*o+i[13],y=i[2]*s+i[6]*o+i[14],_=i[3]*s+i[7]*o+i[15],v=f+a,x=g+l,b=y+c,w=Math.max(_+u,1e-5),j=f+d,S=g+h,T=y+p,k=Math.max(_+m,1e-5);e.push(new Np(v/w,x/w,b/w)),t.push(new Np(j/k,S/k,T/k))}s.push(e),o.push(t)}return[s,o]}(t,r,n,i,s)}function Up(e,t,r,n,i,s,o,a){const l=o*i.getElevationAt(e,t,!0,!0),c=0!==s[0],u=c?0===s[1]?o*(s[0]/ip-sp):o*function(e,t,r){const n=Math.floor(t[0]/8),i=Math.floor(t[1]/8),s=10*(t[0]-8*n),o=10*(t[1]-8*i),a=e.getElevationAt(n,i,!0,!0),l=e.getMeterToDEM(r),c=Math.floor(.5*(s*l-1)),u=Math.floor(.5*(o*l-1)),d=e.tileCoordToPixel(n,i),h=2*c+1,p=2*u+1,m=function(e,t,r,n,i){return[e.getElevationAtPixel(t,r,!0),e.getElevationAtPixel(t+i,r,!0),e.getElevationAtPixel(t,r+i,!0),e.getElevationAtPixel(t+n,r+i,!0)]}(e,d.x-c,d.y-u,h,p),f=Math.abs(m[0]-m[1]),g=Math.abs(m[2]-m[3]),y=Math.abs(m[0]-m[2])+Math.abs(m[1]-m[3]),_=Math.min(.25,.5*l*(f+g)/h),v=Math.min(.25,.5*l*y/p);return a+Math.max(_*s,v*o)}(i,s,a):l;return{base:l+(0===r?-1:r),top:c?Math.max(u+n,l+r+2):l+n}}class Vp{constructor(e){this._callback=e,this._triggered=!1,"undefined"!=typeof MessageChannel&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class qp{constructor(){this.tasks={},this.taskQueue=[],Ue(["process"],this),this.invoker=new Vp(this.process),this.nextId=0}add(e,t){const r=this.nextId++,n=function(e){let{type:t,isSymbolTile:r,zoom:n}=e;return n=n||0,"message"===t?0:"maybePrepare"!==t||r?"parseTile"!==t||r?"parseTile"===t&&r?300-n:"maybePrepare"===t&&r?400-n:500:200-n:100-n}(t);if(0===n){try{e()}finally{}return null}return this.tasks[r]={fn:e,metadata:t,priority:n,id:r},this.taskQueue.push(r),this.invoker.trigger(),{cancel:()=>{delete this.tasks[r]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(e=>!!this.tasks[e]),!this.taskQueue.length)return;const e=this.pick();if(null===e)return;const t=this.tasks[e];if(delete this.tasks[e],this.taskQueue.length&&this.invoker.trigger(),!t)return;t.fn()}finally{}}pick(){let e=null,t=1/0;for(let n=0;n<this.taskQueue.length;n++){const r=this.tasks[this.taskQueue[n]];r.priority<t&&(t=r.priority,e=n)}if(null===e)return null;const r=this.taskQueue[e];return this.taskQueue.splice(e,1),r}remove(){this.invoker.remove()}}class Wp{constructor(e,t,r){this.target=e,this.parent=t,this.mapId=r,this.callbacks={},this.cancelCallbacks={},Ue(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new qp}send(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4],s=arguments.length>5?arguments[5]:void 0;const o=Math.round(1e18*Math.random()).toString(36).substring(0,10);r&&(r.metadata=s,this.callbacks[o]=r);const a=new Set;return this.target.postMessage({id:o,type:e,hasCallback:!!r,targetMapId:n,mustQueue:i,sourceMapId:this.mapId,data:to(t,a)},a),{cancel:()=>{r&&delete this.callbacks[o],this.target.postMessage({id:o,type:"<cancel>",targetMapId:n,sourceMapId:this.mapId})}}}receive(e){const t=e.data;if(!t)return;const r=t.id;if(r&&(!t.targetMapId||this.mapId===t.targetMapId))if("<cancel>"===t.type){const e=this.cancelCallbacks[r];delete this.cancelCallbacks[r],e&&e.cancel()}else if(t.mustQueue||Je(self)){const e=this.callbacks[r],n=this.scheduler.add(()=>this.processTask(r,t),e&&e.metadata||{type:"message"});n&&(this.cancelCallbacks[r]=n)}else this.processTask(r,t)}processTask(e,t){if(delete this.cancelCallbacks[e],"<response>"===t.type){const r=this.callbacks[e];delete this.callbacks[e],r&&(t.error?r(ro(t.error)):r(null,ro(t.data)))}else{const r=new Set,n=t.hasCallback?(t,n)=>{this.target.postMessage({id:e,type:"<response>",sourceMapId:this.mapId,error:t?to(t):null,data:to(n,r)},r)}:()=>{},i=ro(t.data);if(this.parent[t.type])this.parent[t.type](t.sourceMapId,i,n);else if(this.parent.getWorkerSource){const e=t.type.split("."),{source:r,scope:s}=i;this.parent.getWorkerSource(t.sourceMapId,e[0],r,s)[e[1]](i,n)}else n(new Error("Could not find function ".concat(t.type)))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var Hp={workerUrl:"",workerClass:null,workerParams:void 0};const Gp="mapboxgl_preloaded_worker_pool";class Zp{constructor(e){this.active={},this.name=e}acquire(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Zp.workerCount;if(!this.workers)for(this.workers=[];this.workers.length<t;){const t=(r="".concat(this.name||"","WorkerPool: ").concat(e,"-").concat(this.workers.length),null!=Hp.workerClass?new Hp.workerClass:new self.Worker(Hp.workerUrl,Object.assign({name:r},Hp.workerParams)));this.workers.push(t)}var r;return this.active[e]=!0,this.workers.slice()}release(e){delete this.active[e],this.workers&&0===this.numActive()&&(this.workers.forEach(e=>{e.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[Gp]}numActive(){return Object.keys(this.active).length}}Zp.workerCount=2;class Kp{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"Worker",n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Zp.workerCount;this.workerPool=e,this.actors=[],this.currentActor=0,this.id=ze();const i=this.workerPool.acquire(this.id,n);for(let s=0;s<i.length;s++){const e=new Kp.Actor(i[s],t,this.id);e.name="".concat(r," ").concat(s),this.actors.push(e)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(e,t,r){Fe(this.actors,(r,n)=>{r.send(e,t,n)},r=r||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(e=>{e.remove()}),this.actors=[],this.workerPool.release(this.id)}}let Yp,Xp;function Jp(){return Yp||(Yp=new Zp),Yp}Kp.Actor=Wp;const Qp=4096;class $p{constructor(e){this.module=e,this.memoryStack=this.module.malloc(Qp),this.memoryStackNextFree=this.memoryStack}createIntArray(e){const t=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Int32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>Qp?-1:(new Int32Array(this.module.heap32.buffer,t,e.length).set(e),t)}createFloatArray(e){const t=this.memoryStackNextFree;return this.memoryStackNextFree+=e.length*Float32Array.BYTES_PER_ELEMENT,this.memoryStackNextFree-this.memoryStack>Qp?-1:(new Float32Array(this.module.heapF32.buffer,t,e.length).set(e),t)}readStringBuffer(e){let t="";for(;0!==this.module.heapU8[e];)t+=String.fromCharCode(this.module.heapU8[e]),++e;return t}setStyle(e){const t=e.normalScale;this.module.setStyle(t[0],t[1],t[2],e.tileToMeters)}setAOOptions(e,t){this.module.setAOOptions(e?1:0,t)}setMetricOptions(e,t){this.module.setMetricOptions(e?1:0,t)}setStructuralOptions(e){this.module.setStructuralOptions(e?1:0)}setFacadeOptions(e,t){this.module.setFacadeOptions(e,t?1:0)}setFauxFacadeOptions(e,t,r){this.module.setFauxFacadeOptions(e?1:0,t?1:0,r)}setFacadeClassifierOptions(e){this.module.setFacadeClassifierOptions(e)}generateMesh(e,t){this.memoryStackNextFree=this.memoryStack;for(const o of e){const e=this.createIntArray(o.ringIndices),t=this.createFloatArray(o.coordinates);if(-1===e||-1===t)return"building_gen: Out of stack memory: ".concat(this.memoryStackNextFree-this.memoryStack,"/4096");this.module.addFeature(o.id,o.sourceId,o.minHeight,o.height,o.roofType,t,e,o.ringIndices.length-1)}for(const o of t){let e;e=o.entrances?JSON.parse(o.entrances):[];const t=this.createFloatArray(e),r=this.createFloatArray(o.coordinates);if(-1===t||-1===r)return"building_gen: Out of stack memory: ".concat(this.memoryStackNextFree-this.memoryStack,"/4096");this.module.addFacade(o.sourceId,o.crossPerc,o.distanceToRoad,t,e.length,r,o.coordinates.length)}if(!this.module.generateMesh()){const e=this.module.getLastError();return this.readStringBuffer(e)}const r=this.module.getMeshCount(),n=new Array(r);for(let o=0;o<r;o++){const e=this.module.getPositionsPtr(o),t=this.module.getPositionsLength(o),r=new Float32Array(this.module.heapF32.buffer,e,t),i=this.module.getNormalsPtr(o),s=this.module.getNormalsLength(o),a=new Float32Array(this.module.heapF32.buffer,i,s),l=this.module.getAOPtr(o),c=this.module.getAOLength(o),u=new Float32Array(this.module.heapF32.buffer,l,c),d=this.module.getUVPtr(o),h=this.module.getUVLength(o),p=new Float32Array(this.module.heapF32.buffer,d,h),m=this.module.getFauxFacadePtr(o),f=this.module.getFauxFacadeLength(o),g=new Uint8Array(this.module.heapU8.buffer,m,f),y=this.module.getIndicesPtr(o),_=this.module.getIndicesLength(o),v=new Int16Array(this.module.heap16.buffer,y,_),x=this.module.getBuildingPart(o);n[o]={positions:r,normals:a,ao:u,uv:p,isFauxFacade:g,indices:v,buildingPart:x}}const i=this.module.getRingCount(),s=[];for(let o=0;o<i;o++){const e=this.module.getRingPtr(o),t=this.module.getRingLength(o),r=new Float32Array(this.module.heapF32.buffer,e,t);s.push(r)}return{meshes:n,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:s}}}let em,tm,rm,nm,im,sm=null,om=null,am=null,lm=null;function cm(){return Je(self)&&self.worker.dracoUrl?self.worker.dracoUrl:tm||ot.DRACO_URL}function um(){if(Je(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(nm)return nm;const e=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if("object"!=typeof WebAssembly)throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return nm=WebAssembly.validate(e)?ot.MESHOPT_SIMD_URL:ot.MESHOPT_URL,nm}function dm(){return lm}const hm={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},pm={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},mm={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function fm(e,t,r){const n=r.json.bufferViews.length,i=r.buffers.length;t.bufferView=n,r.json.bufferViews[n]={buffer:i,byteLength:e.byteLength},r.buffers[i]=e}const gm="KHR_draco_mesh_compression";function ym(e,t){const r=e.extensions&&e.extensions[gm];if(!r)return;const n=new rm.Decoder,i=Sm(t,r.bufferView),s=new rm.Mesh;if(!n.DecodeArrayToMesh(i,i.byteLength,s))throw new Error("Failed to decode Draco mesh");const o=t.json.accessors[e.indices],a=hm[o.componentType],l=o.count*a.BYTES_PER_ELEMENT,c=rm._malloc(l);a===Uint16Array?n.GetTrianglesUInt16Array(s,l,c):n.GetTrianglesUInt32Array(s,l,c),fm(rm.memory.buffer.slice(c,c+l),o,t),rm._free(c);for(const u of Object.keys(r.attributes)){const i=n.GetAttributeByUniqueId(s,r.attributes[u]),o=t.json.accessors[e.attributes[u]],a=pm[o.componentType],l=o.count*mm[o.type]*hm[o.componentType].BYTES_PER_ELEMENT,c=rm._malloc(l);n.GetAttributeDataArrayForAllPoints(s,i,rm[a],l,c),fm(rm.memory.buffer.slice(c,c+l),o,t),rm._free(c)}n.destroy(),s.destroy(),delete e.extensions[gm]}const _m="EXT_meshopt_compression";function vm(e,t){if(!e.extensions||!e.extensions[_m])return;const r=e.extensions[_m],n=new Uint8Array(t.buffers[r.buffer],r.byteOffset||0,r.byteLength||0),i=new Uint8Array(r.count*r.byteStride);im.decodeGltfBuffer(i,r.count,r.byteStride,n,r.mode,r.filter),e.buffer=t.buffers.length,e.byteOffset=0,t.buffers[e.buffer]=i.buffer,delete e.extensions[_m]}const xm=1179937895,bm=new TextDecoder("utf8");function wm(e,t){return new URL(e,t).href}function jm(e,t,r,n){return fetch(wm(e.uri,n)).then(e=>e.arrayBuffer()).then(e=>{t.buffers[r]=e})}function Sm(e,t){const r=e.json.bufferViews[t];return new Uint8Array(e.buffers[r.buffer],r.byteOffset||0,r.byteLength)}function Tm(e,t,r,n){if(e.uri){const i=wm(e.uri,n);return fetch(i).then(e=>e.blob()).then(e=>createImageBitmap(e)).then(e=>{t.images[r]=e})}if(void 0!==e.bufferView){const n=Sm(t,e.bufferView),i=new Blob([n],{type:e.mimeType});return createImageBitmap(i).then(e=>{t.images[r]=e})}}function km(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2?arguments[2]:void 0;const n={json:null,images:[],buffers:[]};if(new Uint32Array(e,t,1)[0]===xm){const r=new Uint32Array(e,t);let i=2;const s=(r[i++]>>2)-3,o=r[i++]>>2;if(i++,n.json=JSON.parse(bm.decode(r.subarray(i,i+o))),i+=o,i<s){const s=r[i++];i++;const o=t+(i<<2);n.buffers[0]=e.slice(o,o+s)}}else n.json=JSON.parse(bm.decode(new Uint8Array(e,t)));const{buffers:i,images:s,meshes:o,extensionsUsed:a,bufferViews:l}=n.json;let c=Promise.resolve();if(i){const e=[];for(let t=0;t<i.length;t++){const s=i[t];s.uri?e.push(jm(s,n,t,r)):n.buffers[t]||(n.buffers[t]=null)}c=Promise.all(e)}return c.then(()=>{const e=[],t=a&&a.includes(gm),i=a&&a.includes(_m);if(t&&e.push(function(){if(!rm)return null!=em?em:(em=function(e){let t,r=null;function n(){t=new Uint8Array(r.buffer)}function i(){throw new Error("Unexpected Draco error.")}const s={a:{a:i,d:function(e,r,n){return t.copyWithin(e,r,r+n)},c:function(e){const i=t.length,s=Math.max(e>>>0,Math.ceil(1.2*i)),o=Math.ceil((s-i)/65536);try{return r.grow(o),n(),!0}catch(e){return!1}},b:i}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,s):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,s))).then(e=>{const{Rb:i,Qb:s,P:o,T:a,X:l,Ja:c,La:u,Qa:d,Va:h,Wa:p,eb:m,jb:f,f:g,e:y,yb:_,zb:v,Ab:x,Bb:b,Db:w,Gb:j}=e.instance.exports;r=y;const S=(()=>{let e=0,r=0,n=0,o=0;return a=>{n&&(i(o),i(e),r+=n,n=e=0),e||(r+=128,e=s(r));const l=a.length+7&-8;let c=e;l>=r&&(n=l,c=o=s(l));for(let e=0;e<a.length;e++)t[c+e]=a[e];return c}})();return n(),g(),{memory:y,_free:i,_malloc:s,Mesh:class{constructor(){this.ptr=o()}destroy(){a(this.ptr)}},Decoder:class{constructor(){this.ptr=c()}destroy(){f(this.ptr)}DecodeArrayToMesh(e,t,r){const n=S(e),i=u(this.ptr,n,t,r.ptr);return!!l(i)}GetAttributeByUniqueId(e,t){return{ptr:d(this.ptr,e.ptr,t)}}GetTrianglesUInt16Array(e,t,r){h(this.ptr,e.ptr,t,r)}GetTrianglesUInt32Array(e,t,r){p(this.ptr,e.ptr,t,r)}GetAttributeDataArrayForAllPoints(e,t,r,n,i){m(this.ptr,e.ptr,t.ptr,r,n,i)}},DT_INT8:_(),DT_UINT8:v(),DT_INT16:x(),DT_UINT16:b(),DT_UINT32:w(),DT_FLOAT32:j()}})}(fetch(cm())),em.then(e=>{rm=e,em=void 0}))}()),i&&e.push(function(){if(im)return;const e=function(e){let t;const r=WebAssembly.instantiateStreaming(e,{}).then(e=>{t=e.instance,t.exports.__wasm_call_ctors()}),n={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},i={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:r,supported:!0,decodeGltfBuffer(e,r,s,o,a,l){!function(e,t,r,n,i,s,o){const a=e.exports.sbrk,l=n+3&-4,c=a(l*i),u=a(s.length),d=new Uint8Array(e.exports.memory.buffer);d.set(s,u);const h=t(c,n,i,u,s.length);if(0===h&&o&&o(c,l,i),r.set(d.subarray(c,c+n*i)),a(c-a(0)),0!==h)throw new Error("Malformed buffer data: ".concat(h))}(t,t.exports[i[a]],e,r,s,o,t.exports[n[l]])}}}(fetch(um()));return e.ready.then(()=>{im=e})}()),s)for(let o=0;o<s.length;o++)e.push(Tm(s[o],n,o,r));return(e.length?Promise.all(e):Promise.resolve()).then(()=>{if(t&&o)for(const{primitives:e}of o)for(const t of e)ym(t,n);if(i&&o&&l)for(const e of l)vm(e,n);return n})})}function Am(e){return fetch(e).then(e=>e.arrayBuffer()).then(t=>km(t,0,e))}function Cm(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Em(e){switch(e){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Nm{constructor(e,t,r,n){this.context=e,this.format=r,this.useMipmap=n&&n.useMipmap,this.texture=e.gl.createTexture(),this.update(t,{premultiply:n&&n.premultiply})}update(e,t){const r=e&&e instanceof HTMLVideoElement&&0===e.width?e.videoWidth:e.width,n=e&&e instanceof HTMLVideoElement&&0===e.height?e.videoHeight:e.height,{context:i}=this,{gl:s}=i,{x:o,y:a}=t&&t.position?t.position:{x:0,y:0},l=o+r,c=a+n;!this.size||this.size[0]===l&&this.size[1]===c||(s.bindTexture(s.TEXTURE_2D,null),s.deleteTexture(this.texture),this.texture=s.createTexture(),this.size=null),s.bindTexture(s.TEXTURE_2D,this.texture),i.pixelStoreUnpackFlipY.set(!1),i.pixelStoreUnpack.set(1),i.pixelStoreUnpackPremultiplyAlpha.set(this.format===s.RGBA8&&(!t||!1!==t.premultiply));const u=e instanceof HTMLImageElement||e instanceof HTMLCanvasElement||e instanceof HTMLVideoElement||e instanceof ImageData||ImageBitmap&&e instanceof ImageBitmap;if(!this.size&&l>0&&c>0){const e=this.useMipmap?Math.floor(Math.log2(Math.max(l,c)))+1:1;s.texStorage2D(s.TEXTURE_2D,e,this.format,l,c),this.size=[l,c]}this.size&&(u?s.texSubImage2D(s.TEXTURE_2D,0,o,a,Cm(this.format),Em(this.format),e):"data"in e&&e.data&&s.texSubImage2D(s.TEXTURE_2D,0,o,a,r,n,Cm(this.format),Em(this.format),e.data)),this.useMipmap&&s.generateMipmap(s.TEXTURE_2D)}bind(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const{context:n}=this,{gl:i}=n;i.bindTexture(i.TEXTURE_2D,this.texture),e!==this.minFilter&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,e),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,this.useMipmap&&!r?e===i.NEAREST?i.NEAREST_MIPMAP_NEAREST:i.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),t!==this.wrapS&&(i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,t),this.wrapS=t)}bindExtraParam(e,t,r,n,i){const{context:s}=this,{gl:o}=s;o.bindTexture(o.TEXTURE_2D,this.texture),t!==this.magFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MAG_FILTER,t),this.magFilter=t),e!==this.minFilter&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_MIN_FILTER,this.useMipmap?e===o.NEAREST?o.NEAREST_MIPMAP_NEAREST:o.LINEAR_MIPMAP_LINEAR:e),this.minFilter=e),r!==this.wrapS&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_S,r),this.wrapS=r),n!==this.wrapT&&(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_WRAP_T,n),this.wrapT=n),i!==this.compareMode&&(i?(o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.COMPARE_REF_TO_TEXTURE),o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_FUNC,i)):o.texParameteri(o.TEXTURE_2D,o.TEXTURE_COMPARE_MODE,o.NONE),this.compareMode=i)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}}class Im{constructor(e,t){this.context=e,this.texture=t}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_2D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_2D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}}const Pm=da([{name:"a_pos_3f",components:3,type:"Float32"}]),Mm=da([{name:"a_color_3f",components:3,type:"Float32"}]),Lm=da([{name:"a_color_4f",components:4,type:"Float32"}]),Rm=da([{name:"a_uv_2f",components:2,type:"Float32"}]),Dm=da([{name:"a_normal_3f",components:3,type:"Float32"}]),Fm=da([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),Om=da([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function zm(e,t){const r=Um(e.projection,e.zoom,e.width,e.height),n=function(e,t,r,n,i){const s=new ic(r.lng-180*Vm,r.lat),o=new ic(r.lng+180*Vm,r.lat),a=e.project(s.lng,s.lat),l=e.project(o.lng,o.lat),u=-Math.atan2(l.y-a.y,l.x-a.x),h=xc.fromLngLat(r);h.y=Le(h.y,-1+Vm,1-Vm);const m=h.toLngLat(),f=e.project(m.lng,m.lat),y=xc.fromLngLat(m);y.x+=Vm;const _=y.toLngLat(),v=e.project(_.lng,_.lat),x=Wm(v.x-f.x,v.y-f.y,u),b=xc.fromLngLat(m);b.y+=Vm;const w=b.toLngLat(),j=e.project(w.lng,w.lat),S=Wm(j.x-f.x,j.y-f.y,u),T=Math.abs(x.x)/Math.abs(S.y),k=c([]);g(k,k,-u*(1-(i?0:n)));const A=c([]);return p(A,A,[1,1-(1-T)*n,1]),A[4]=-S.x/S.y*n,g(A,A,u),d(A,k,A),A}(e.projection,0,e.center,r,t),i=Bm(e);return p(n,n,[i,i,1]),n}function Bm(e){const t=e.projection,r=Um(e.projection,e.zoom,e.width,e.height),n=qm(t,e.center),i=qm(t,ic.convert(t.center));return Math.pow(2,n*r+(1-r)*i)}function Um(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1/0;const s=e.range;if(!s)return 0;const o=Math.min(i,Math.max(r,n)),a=Math.log2(o/1024);return Re(s[0]+a,s[1]+a,t)}const Vm=1/4e4;function qm(e,t){const r=Le(t.lat,-fc,fc),n=new ic(t.lng-180*Vm,r),i=new ic(t.lng+180*Vm,r),s=e.project(n.lng,r),o=e.project(i.lng,r),a=xc.fromLngLat(n),l=xc.fromLngLat(i),c=o.x-s.x,u=o.y-s.y,d=l.x-a.x,h=l.y-a.y,p=Math.sqrt((d*d+h*h)/(c*c+u*u));return Math.log2(p)}function Wm(e,t,r){const n=Math.cos(r),i=Math.sin(r);return{x:e*n-t*i,y:e*i+t*n}}function Hm(e,t,r){c(e),g(e,e,Ce(t[2])),m(e,e,Ce(t[0])),f(e,e,Ce(t[1])),p(e,e,r),d(e,e,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function Gm(e,t,r,n,i,s,o,a){const l=[r[0]-t[0],r[1]-t[1],0],c=[n[0]-t[0],n[1]-t[1],0];if(S(l)<1e-12||S(c)<1e-12)return te(e);const u=B([],l,c);O(u,u),C(c,n,t),l[2]=(s-i)*a,c[2]=(o-i)*a;const d=l;return B(d,l,c),O(d,d),le(e,u,d)}function Zm(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const n=td(t.zoom),i=function(e,t,r){const n=t.worldSize,i=[e[12],e[13],e[14]],s=pc(i[1]/n),o=hc(i[0]/n),a=c([]),l=dc(1,s)*n,u=dc(1,0)*n*yc(s,t.zoom),m=1/Qu(n);let f=u*m;if(r){const e=Um(t.projection,t.zoom,t.width,t.height,1024);f=m*t.projection.pixelSpaceConversion(t.center.lat,n,e)}const g=tc(s,o);A(g,g,P([],O([],g),l*f*i[2]));const y=function(e){const t=[e[0],e[1],e[2]];let r=[0,1,0];const n=B([],r,t);return B(r,t,n),0===D(r)&&(r=[0,1,0],B(n,t,r)),O(n,n),O(r,r),O(t,t),[n[0],n[1],n[2],0,r[0],r[1],r[2],0,t[0],t[1],t[2],0,e[0],e[1],e[2],1]}(g);p(a,a,[f,f,f*l]),h(a,a,[-i[0],-i[1],-i[2]]);const _=d([],t.globeMatrix,y);return d(_,_,a),d(_,_,e),_}(e,t,r);if(n>0){const r=function(e,t){const r=t.worldSize,n=dc(1,0)*r*yc(t.center.lat,t.zoom)/Qu(r),i=dc(1,t.center.lat)*r,s=c([]);f(s,s,Ce(t.center.lng)),m(s,s,Ce(t.center.lat)),h(s,s,[0,0,Gl]),p(s,s,[n,n,n*i]);const o=t.point;return h(s,s,[-o.x,-o.y,0]),d(s,s,e),d(s,t.globeMatrix,s)}(e,t);return function(e,t,r){const n=(e,t,r)=>{const n=S(e),i=S(t),s=Vu(e,t,r);return P(s,s,1/S(s)*hr(n,i,r))},i=n([e[0],e[1],e[2]],[t[0],t[1],t[2]],r),s=n([e[4],e[5],e[6]],[t[4],t[5],t[6]],r),o=n([e[8],e[9],e[10]],[t[8],t[9],t[10]],r),a=Vu([e[12],e[13],e[14]],[t[12],t[13],t[14]],r);return[i[0],i[1],i[2],0,s[0],s[1],s[2],0,o[0],o[1],o[2],0,a[0],a[1],a[2],1]}(i,r,n)}return i}function Km(e,t,r,n){const i=Qc.projectAabbCorners(n,r);let s=Number.MAX_VALUE;for(let a=0;a<i.length;++a){const e=i[a];e[0]=(.5*e[0]+.5)*t.width,e[1]=(.5-.5*e[1])*t.height,e[2]<s&&(s=e[2])}const o=function(e){const t=[];let r=0;for(let o=1;o<e.length;o++)(e[o][0]<e[r][0]||e[o][0]===e[r][0]&&e[o][1]<e[r][1])&&(r=o);let n,i=r;const s=new Uint8Array(e.length);do{if(s[i])break;t.push(new Se(e[i][0],e[i][1])),s[i]=1,n=(i+1)%e.length;for(let t=0;t<e.length;t++){if(e[t][0]===e[n][0]&&e[t][1]===e[n][1]||e[t][0]===e[i][0]&&e[t][1]===e[i][1])continue;const r=[e[t][0]-e[i][0],e[t][1]-e[i][1]],s=[e[n][0]-e[i][0],e[n][1]-e[i][1]],o=r[0]*s[1]-r[1]*s[0];(o>0||0===o&&r[0]*s[0]+r[1]*s[1]>=0&&r[0]*r[0]+r[1]*r[1]>s[0]*s[0]+s[1]*s[1])&&(n=t)}i=n}while(i!==r);return t.length>0&&t.push(t[0]),t}(i);if(iu(e,o))return s}const Ym=64,Xm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Jm(e,t,r,n,i,s,o,a,l){let u=arguments.length>9&&void 0!==arguments[9]&&arguments[9];const m=r.zoom,f=r.project(n),g=yc(n.lat,m),y=1/g;c(e),h(e,e,[f.x+o[0]*y,f.y+o[1]*y,o[2]]);let _=1,v=1;const b=r.worldSize;if(u){if("mercator"===r.projection.name){let e=0;r.elevation&&(e=r.elevation.getAtPointOrZero(new xc(f.x/b,f.y/b),0));const t=$([],[f.x,f.y,e,1],r.projMatrix)[3]/r.cameraToCenterDistance;_=t,v=t*yc(r.center.lat,m)}else if("globe"===r.projection.name){const t=Zm(e,r),i=[0,0,0,1];$(i,i,d([],r.projMatrix,t));const s=i[3]/r.cameraToCenterDistance,o=td(m),a=r.projection.pixelsPerMeter(n.lat,b)*yc(n.lat,m),l=r.projection.pixelsPerMeter(r.center.lat,b)*yc(r.center.lat,m);_=s/hr(a,gc(r.center.lat),o),v=s*g/a,_*=l,v*=l}}else _=y;p(e,e,[_,_,v]);const w=[...e],j=t.orientation,S=[];if(Hm(S,[j[0]+(i?i[0]:0),j[1]+(i?i[1]:0),j[2]+(i?i[2]:0)],s),d(e,w,S),a&&r.elevation){let i=0;const s=[];if(l&&r.elevation){i=function(e,t,r,n,i){const s=t.elevation;if(!s)return 0;const o=Qc.projectAabbCorners(r,n),a=dc(1,i.lat)*t.worldSize,l=function(e,t){const r=[0,0,1],n=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const i of n){const n=e[i.corners[0]],s=e[i.corners[1]],o=e[i.corners[2]],a=[s[0]-n[0],s[1]-n[1],t*(s[2]-n[2])],l=B(a,a,[o[0]-n[0],o[1]-n[1],t*(o[2]-n[2])]);O(l,l),i.dotProductWithUp=z(l,r)}return n.sort((e,t)=>e.dotProductWithUp-t.dotProductWithUp),n[0].corners}(o,a),c=o[l[0]],u=o[l[1]],d=o[l[2]],h=o[l[3]],p=s.getAtPointOrZero(new xc(c[0]/t.worldSize,c[1]/t.worldSize),0),m=s.getAtPointOrZero(new xc(u[0]/t.worldSize,u[1]/t.worldSize),0),f=s.getAtPointOrZero(new xc(d[0]/t.worldSize,d[1]/t.worldSize),0),g=s.getAtPointOrZero(new xc(h[0]/t.worldSize,h[1]/t.worldSize),0),y=(p+g)/2,_=(m+f)/2;return y>_?m<f?Gm(e,u,h,c,m,g,p,a):Gm(e,d,c,h,f,p,g,a):p<g?Gm(e,c,u,d,p,m,f,a):Gm(e,h,d,u,g,f,m,a),Math.max(y,_)}(s,r,t.aabb,e,n);const o=d([],x([],s),S);d(e,w,o)}else i=r.elevation.getAtPointOrZero(new xc(f.x/b,f.y/b),0);0!==i&&(e[14]+=i)}}class Qm{constructor(e,t,r,n,i){this.materialOverrides=new Map,this.nodeOverrides=new Map,this.materialOverrideNames=[],this.nodeOverrideNames=[],this.featureProperties={},this.id=e,this.uri=t,this.position=null!=r?new ic(r[0],r[1]):new ic(0,0),this.orientation=null!=n?n:[0,0,0],this.nodes=i,this.uploaded=!1,this.aabb=new Qc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(e,t){d(e.globalMatrix,t,e.localMatrix);const r=this.nodeOverrides.get(e.name);if(void 0!==r){const t=[];i=r.orientation,c(n=t),f(n,n,Ce(i[1])),g(n,n,Ce(i[2])),m(n,n,Ce(i[0])),d(e.globalMatrix,e.globalMatrix,t)}var n,i;if(e.meshes)for(const s of e.meshes){const t=Qc.applyTransformFast(s.aabb,e.globalMatrix);this.aabb.encapsulate(t)}if(e.children)for(const s of e.children)this._applyTransformations(s,e.globalMatrix)}computeBoundsAndApplyParent(){const e=c([]);this.aabb=new Qc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const t of this.nodes)this._applyTransformations(t,e)}computeModelMatrix(e,t,r,n,i,s){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];Jm(this.matrix,this,e.transform,this.position,t,r,n,i,s,o)}upload(e){if(!this.uploaded){for(const t of this.nodes)tf(t,e);for(const e of this.nodes)rf(e);this.uploaded=!0}}destroy(){for(const e of this.nodes)nf(e)}}function $m(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];e.uploaded||(e.gfxTexture=new Nm(t,e.image,r?t.gl.R8:t.gl.RGBA8,{useMipmap:e.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),e.uploaded=!0,e.image=null)}function ef(e,t,r){e.indexBuffer=t.createIndexBuffer(e.indexArray,!1,!0),e.vertexBuffer=t.createVertexBuffer(e.vertexArray,Pm.members,!1,!0),e.normalArray&&(e.normalBuffer=t.createVertexBuffer(e.normalArray,Dm.members,!1,!0)),e.texcoordArray&&(e.texcoordBuffer=t.createVertexBuffer(e.texcoordArray,Rm.members,!1,!0)),e.colorArray&&(e.colorBuffer=t.createVertexBuffer(e.colorArray,(12===e.colorArray.bytesPerElement?Mm:Lm).members,!1,!0)),e.featureArray&&(e.pbrBuffer=t.createVertexBuffer(e.featureArray,Om.members,!0)),e.segments=dl.simpleSegment(0,0,e.vertexArray.length,e.indexArray.length);const n=e.material;n.pbrMetallicRoughness.baseColorTexture&&$m(n.pbrMetallicRoughness.baseColorTexture,t),n.pbrMetallicRoughness.metallicRoughnessTexture&&$m(n.pbrMetallicRoughness.metallicRoughnessTexture,t),n.normalTexture&&$m(n.normalTexture,t),n.occlusionTexture&&$m(n.occlusionTexture,t,r),n.emissionTexture&&$m(n.emissionTexture,t)}function tf(e,t,r){if(e.meshes)for(const n of e.meshes)ef(n,t,r);if(e.children)for(const n of e.children)tf(n,t,r)}function rf(e){if(e.meshes)for(const t of e.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(e.children)for(const t of e.children)rf(t)}function nf(e){if(e.meshes)for(const r of e.meshes)r.vertexBuffer&&(r.vertexBuffer.destroy(),r.indexBuffer.destroy(),r.normalBuffer&&r.normalBuffer.destroy(),r.texcoordBuffer&&r.texcoordBuffer.destroy(),r.colorBuffer&&r.colorBuffer.destroy(),r.pbrBuffer&&r.pbrBuffer.destroy(),r.segments.destroy(),r.material&&((t=r.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(e.children)for(const r of e.children)nf(r)}function sf(e,t){const r=e.json.bufferViews[t.bufferView],n=hm[t.componentType];return new n(e.buffers[r.buffer],(t.byteOffset||0)+(r.byteOffset||0),t.count*(r.byteStride&&r.byteStride!==mm[t.type]*n.BYTES_PER_ELEMENT?r.byteStride/n.BYTES_PER_ELEMENT:mm[t.type]))}function of(e,t,r,n){const i=hm[t.componentType],s=function(e){switch(e){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(i),o=e.json.bufferViews[t.bufferView],a=o.byteStride?o.byteStride/i.BYTES_PER_ELEMENT:mm[t.type],l=r.float32,c=l.length/r.capacity;for(let u=0,d=0;u<t.count*a;u+=a,d+=c)for(let e=0;e<c;e++)l[d+e]=n[u+e]*s;r._trim()}function af(e,t,r){const n=e.indices,i=e.attributes,s={};s.indexArray=new La;const o=t.json.accessors[n],a=o.count/3;s.indexArray.reserve(a);const l=sf(t,o);for(let h=0;h<a;h++)s.indexArray.emplaceBack(l[3*h],l[3*h+1],l[3*h+2]);s.indexArray._trim(),s.vertexArray=new ba;const c=t.json.accessors[i.POSITION];s.vertexArray.reserve(c.count);const u=sf(t,c);for(let h=0;h<c.count;h++)s.vertexArray.emplaceBack(u[3*h],u[3*h+1],u[3*h+2]);if(s.vertexArray._trim(),s.aabb=new Qc(c.min,c.max),s.centroid=function(e,t){const r=[0,0,0],n=e.length;if(n>0){for(let i=0;i<n;i++){const n=3*e[i];r[0]+=t[n],r[1]+=t[n+1],r[2]+=t[n+2]}r[0]/=n,r[1]/=n,r[2]/=n}return r}(l,u),void 0!==i.COLOR_0){const e=t.json.accessors[i.COLOR_0],r=mm[e.type],n=sf(t,e);s.colorArray=3===r?new ba:new Aa,s.colorArray.resize(e.count),of(t,e,s.colorArray,n)}if(void 0!==i.NORMAL){s.normalArray=new ba;const e=t.json.accessors[i.NORMAL];s.normalArray.resize(e.count);const r=sf(t,e);of(t,e,s.normalArray,r)}if(void 0!==i.TEXCOORD_0&&r.length>0){s.texcoordArray=new Va;const e=t.json.accessors[i.TEXCOORD_0];s.texcoordArray.resize(e.count);const r=sf(t,e);of(t,e,s.texcoordArray,r)}if(void 0!==i._FEATURE_ID_RGBA4444){const e=t.json.accessors[i._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(s.featureData=sf(t,e))}void 0!==i._FEATURE_RGBA4444&&(s.featureData=new Uint32Array(sf(t,t.json.accessors[i._FEATURE_RGBA4444]).buffer));const d=e.material;return s.material=function(e,t){const{emissiveFactor:r=[0,0,0],alphaMode:n="OPAQUE",alphaCutoff:i=.5,normalTexture:s,occlusionTexture:o,emissiveTexture:a,doubleSided:l,name:c}=e,{baseColorFactor:u=[1,1,1,1],metallicFactor:d=1,roughnessFactor:h=1,baseColorTexture:p,metallicRoughnessTexture:m}=e.pbrMetallicRoughness||{},f=o?t[o.index]:void 0;if(o&&o.extensions&&o.extensions.KHR_texture_transform&&f){const e=o.extensions.KHR_texture_transform;f.offsetScale=[e.offset[0],e.offset[1],e.scale[0],e.scale[1]]}return{name:c,pbrMetallicRoughness:{baseColorFactor:new lr(...u),metallicFactor:d,roughnessFactor:h,baseColorTexture:p?t[p.index]:void 0,metallicRoughnessTexture:m?t[m.index]:void 0},doubleSided:l,emissiveFactor:new lr(...r),alphaMode:n,alphaCutoff:i,normalTexture:s?t[s.index]:void 0,occlusionTexture:f,emissionTexture:a?t[a.index]:void 0,defined:void 0===e.defined}}(void 0!==d?t.json.materials[d]:{defined:!1},r),s}function lf(e,t,r){const{matrix:n,rotation:i,translation:s,scale:o,mesh:a,extras:c,children:u,name:d}=e,h={};if(h.name=d,h.localMatrix=n||function(e,t,r,n){var i=t[0],s=t[1],o=t[2],a=t[3],l=i+i,c=s+s,u=o+o,d=i*l,h=i*c,p=i*u,m=s*c,f=s*u,g=o*u,y=a*l,_=a*c,v=a*u,x=n[0],b=n[1],w=n[2];return e[0]=(1-(m+g))*x,e[1]=(h+v)*x,e[2]=(p-_)*x,e[3]=0,e[4]=(h-v)*b,e[5]=(1-(d+g))*b,e[6]=(f+y)*b,e[7]=0,e[8]=(p+_)*w,e[9]=(f-y)*w,e[10]=(1-(d+m))*w,e[11]=0,e[12]=r[0],e[13]=r[1],e[14]=r[2],e[15]=1,e}([],i||[0,0,0,1],s||[0,0,0],o||[1,1,1]),h.globalMatrix=l(h.localMatrix),void 0!==a){h.meshes=r[a];const e=h.anchor=[0,0];for(const t of h.meshes){const{min:r,max:n}=t.aabb;e[0]+=r[0]+n[0],e[1]+=r[1]+n[1]}e[0]=Math.floor(e[0]/h.meshes.length/2),e[1]=Math.floor(e[1]/h.meshes.length/2)}if(c&&(c.id&&(h.id=c.id),c.lights&&(h.lights=function(e){if(!e.length)return[];const t=function(e){const t=atob(e),r=new Uint8Array(t.length);for(let n=0;n<t.length;n++)r[n]=t.codePointAt(n);return r}(e),r=[],n=t.length/24,i=new Uint16Array(t.buffer),s=new Float32Array(t.buffer);for(let o=0;o<n;o++){const e=i[2*o*6]/30,t=i[2*o*6+1]/30,n=i[2*o*6+10]/100,a=s[6*o+1],l=s[6*o+2],c=s[6*o+3],u=s[6*o+4],d=c-a,h=u-l,p=Math.hypot(d,h);r.push({pos:[a+.5*d,l+.5*h,t],normal:[h/p,-d/p,0],width:p,height:e,depth:n,points:[a,l,c,u]})}return r}(c.lights)),c.MAPBOX_geometry_bloom&&(h.isGeometryBloom=c.MAPBOX_geometry_bloom)),u){const e=[];for(const n of u)e.push(lf(t.json.nodes[n],t,r));h.children=e}return h}function cf(e){if(0===e.vertices.length||0===e.indices.length)return null;const t=new Th(e.vertices,e.indices,8,256),[r,n]=[t.min.clone(),t.max.clone()];return{vertices:e.vertices,indices:e.indices,grid:t,min:r,max:n}}function uf(e){if(!e.extras||!e.extras.ground)return null;const t=e.extras.ground;if(!t||!Array.isArray(t)||0===t.length)return null;const r=t[0];if(!r||!Array.isArray(r)||0===r.length)return null;const n=[];for(const o of r){if(!Array.isArray(o)||2!==o.length)continue;const e=o[0],t=o[1];"number"==typeof e&&"number"==typeof t&&n.push(new Se(e,t))}if(n.length<3)return null;n.length>1&&n[n.length-1].equals(n[0])&&n.pop();let i=0;for(let o=0;o<n.length;o++){const e=n[o],t=n[(o+1)%n.length],r=n[(o+2)%n.length];i+=(e.x-t.x)*(r.y-t.y)-(r.x-t.x)*(e.y-t.y)}i>0&&n.reverse();const s=Nd(n.flatMap(e=>[e.x,e.y]),[]);return 0===s.length?null:{vertices:n,indices:s}}function df(e,t){const r=[],n=[];let i=0;const s=[];for(const o of e){i=r.length;const e=o.vertexArray.float32,a=o.indexArray.uint16;for(let n=0;n<o.vertexArray.length;n++)s[0]=e[3*n+0],s[1]=e[3*n+1],s[2]=e[3*n+2],V(s,s,t),r.push(new Se(s[0],s[1]));for(let t=0;t<3*o.indexArray.length;t++)n.push(a[t]+i)}if(n.length%3!=0)return null;for(let o=0;o<n.length;o+=3){const e=r[n[o+0]],t=r[n[o+1]],i=r[n[o+2]];(e.x-t.x)*(i.y-t.y)-(i.x-t.x)*(e.y-t.y)>0&&([n[o+1],n[o+2]]=[n[o+2],n[o+1]])}return{vertices:r,indices:n}}function hf(e){const t=function(e,t){const r=[],n=WebGL2RenderingContext;if(e.json.textures)for(const i of e.json.textures){const s={magFilter:n.LINEAR,minFilter:n.NEAREST,wrapS:n.REPEAT,wrapT:n.REPEAT};void 0!==i.sampler&&Object.assign(s,e.json.samplers[i.sampler]),r.push({image:t[i.source],sampler:s,uploaded:!1})}return r}(e,e.images),r=function(e,t){const r=[];for(const n of e.json.meshes){const i=[];for(const r of n.primitives)i.push(af(r,e,t));r.push(i)}return r}(e,t),{scenes:n,scene:i,nodes:s}=e.json,o=n?n[i||0].nodes:[...s.keys()],a=[];for(const l of o)a.push(lf(s[l],e,r));return function(e,t,r){const n={},i=new Set;for(let s=0;s<e.length;s++){const e=r[t[s]];if(!e.extras)continue;const o=e.extras["mapbox:footprint:version"],a=e.extras["mapbox:footprint:id"];(o||a)&&i.add(s),"1.0.0"===o&&a&&(n[a]=s)}for(let s=0;s<e.length;s++){if(i.has(s))continue;const o=e[s],a=r[t[s]];if(!a.extras)continue;let l=null;o.id in n&&(l=df(e[n[o.id]].meshes,o.localMatrix)),l||(l=uf(a)),l&&(o.footprint=cf(l))}if(i.size>0){const t=Array.from(i.values()).sort((e,t)=>e-t);for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)}}(a,o,e.json.nodes),a}function pf(e){e.heightmap=new Float32Array(4096),e.heightmap.fill(-1);const t=e.vertexArray.float32,r=e.aabb.min[0]-1,n=e.aabb.min[1]-1,i=Ym/(e.aabb.max[0]-r+2),s=Ym/(e.aabb.max[1]-n+2);for(let o=0;o<t.length;o+=3){const a=t[o+2],l=(t[o+0]-r)*i|0,c=(t[o+1]-n)*s|0;a>e.heightmap[c*Ym+l]&&(e.heightmap[c*Ym+l]=a)}}function mf(e,t,r,n,i){r.reserve(r.length+4*e.length),n.reserve(n.length+10*e.length),i.reserve(i.length+10*e.length);let s=n.length;for(const o of e){const e=Math.min(10,Math.max(4,1.3*o.height))*t,a=[-o.normal[1],o.normal[0],0],l=Math.min(.29,.1*o.width/o.depth),c=o.width-2*o.depth*t*(l+.01),u=M([],o.pos,a,c/2),d=M([],o.pos,a,-c/2),h=[u[0],u[1],u[2]+o.height],p=[d[0],d[1],d[2]+o.height],m=M([],o.normal,a,l);P(m,m,e);const f=M([],o.normal,a,-l);P(f,f,e),A(m,u,m),A(f,d,f),u[2]+=.1,d[2]+=.1,n.emplaceBack(m[0],m[1],m[2]),n.emplaceBack(f[0],f[1],f[2]),n.emplaceBack(u[0],u[1],u[2]),n.emplaceBack(d[0],d[1],d[2]),n.emplaceBack(h[0],h[1],h[2]),n.emplaceBack(p[0],p[1],p[2]),n.emplaceBack(u[0],u[1],u[2]),n.emplaceBack(d[0],d[1],d[2]),n.emplaceBack(m[0],m[1],m[2]),n.emplaceBack(f[0],f[1],f[2]);const g=c/e/2;i.emplaceBack(-g-l,-1,g,.8),i.emplaceBack(g+l,-1,g,.8),i.emplaceBack(-g,0,g,1.3),i.emplaceBack(g,0,g,1.3),i.emplaceBack(g+l,-.8,g,.7),i.emplaceBack(g+l,-.8,g,.7),i.emplaceBack(0,0,g,1.3),i.emplaceBack(0,0,g,1.3),i.emplaceBack(g+l,-1.2,g,.8),i.emplaceBack(g+l,-1.2,g,.8),r.emplaceBack(6+s,4+s,8+s),r.emplaceBack(7+s,9+s,5+s),r.emplaceBack(0+s,1+s,2+s),r.emplaceBack(1+s,3+s,2+s),s+=10}}function ff(e,t){const r={};r.indexArray=new La,r.vertexArray=new ba,r.colorArray=new Aa,mf(e,t,r.indexArray,r.vertexArray,r.colorArray);const n={defined:!0};n.emissiveFactor=lr.black;const i={};return i.baseColorFactor=lr.white,n.pbrMetallicRoughness=i,r.material=n,r.aabb=new Qc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),r}const gf=da([{name:"a_pos_3f",components:3,type:"Float32"}]),yf=da([{name:"a_normal_3",components:3,type:"Int16"}]),_f=da([{name:"a_centroid_3",components:3,type:"Int16"}]),vf=da([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),xf=da([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),bf=da([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),wf=da([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),jf=da([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),Sf=da([{name:"a_flood_light_wall_radius_1i16",components:1,type:"Uint16"}]),Tf=Nc.types,kf=32767;function Af(e,t){const r=Bn+t;for(const n of e)for(const e of n)if(e.x<-t||e.x>r||e.y<-t||e.y>r)return!1;return!0}function Cf(e){switch(e){case"flat":return 3;case"hipped":return 1;case"gabled":return 2;case"parapet":return 0;case"mansard":return 4;case"skillion":return 5;case"pyramidal":return 6;default:throw new Error("Unknown roof shape: ".concat(e))}}class Ef{constructor(){this.layoutVertexArray=new ba,this.layoutAttenuationArray=new Aa,this.layoutColorArray=new Ea,this.indexArray=new La,this.indexArrayForConflation=new La,this.segmentsBucket=new dl}}class Nf{constructor(e){this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.segmentsBucket=new dl,this.entranceBloom=new Ef;const t=66560;this.layoutVertexArray=new ba,this.layoutVertexArray.reserve(t),this.layoutNormalArray=new ma,this.layoutNormalArray.reserve(t),this.layoutCentroidArray=new ma,this.layoutCentroidArray.reserve(t),this.layoutColorArray=new Ea,this.layoutColorArray.reserve(t),this.layoutFloodLightDataArray=new Wa,this.layoutFloodLightDataArray.reserve(t),this.layoutAOArray=new Ka,this.layoutAOArray.reserve(t),this.indexArray=new La,this.indexArray.reserve(66560),this.indexArrayForConflation=new La,this.segmentsBucket=new dl,this.entranceBloom=new Ef,e&&(this.layoutFacadePaintArray=new Ea,this.layoutFacadeDataArray=new ja,this.layoutFacadeVerticalRangeArray=new Ea)}reserve(e,t,r){this.layoutVertexArray.reserveForAdditional(e),this.layoutCentroidArray.reserveForAdditional(e),this.layoutFloodLightDataArray.reserveForAdditional(e),this.layoutNormalArray.reserveForAdditional(e),this.layoutAOArray.reserveForAdditional(e),this.layoutColorArray.reserveForAdditional(e),this.indexArray.reserveForAdditional(t),r&&(this.layoutFacadePaintArray.reserveForAdditional(e),this.layoutFacadeDataArray.reserveForAdditional(e),this.layoutFacadeVerticalRangeArray.reserveForAdditional(e))}}class If{constructor(e){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.footprintsVertices=new Va,this.footprintsIndices=new Wa,this.footprintsMin=new Se(1/0,1/0),this.footprintsMax=new Se(-1/0,-1/0),this.featuresOnBorder=[],this.buildingWithoutFacade=new Nf(!1),this.buildingWithFacade=new Nf(!0),this.indexArrayForConflationUploaded=!1,this.featureFootprintLookup=new Map,this.buildingIds=new Set,this.footprintLookup={},this.zoom=e.zoom,this.canonical=e.canonical,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.hasPattern=!1,this.worldview=e.worldview,this.lut=e.lut,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.projection=e.projection,this.groundEffect=new gp(e),this.groundEffect.groundRadiusArray=new ga,this.hasAppearances=null}updateFootprints(e,t){const r=new Th([],[],1),n={vertices:[],indices:new Uint32Array(0),grid:r,min:this.footprintsMin,max:this.footprintsMax,buildingIds:this.buildingIds};t.push({footprint:n,id:e})}updateAppearances(e,t,r,n){}prepare(){return function(){if(null!=lm||null!=am)return null;if(null!=om)return om;const e=fetch(ot.BUILDING_GEN_URL);return om=function(e){let t,r,n,i,s;function o(){t=new Uint8Array(s.buffer),r=new Int16Array(s.buffer),n=new Int32Array(s.buffer),i=new Float32Array(s.buffer)}function a(){throw new Error("Unexpected BuildingGen error.")}const l=()=>{},c={a:{a:a,f:function(e){const r=t.length,n=Math.max(e>>>0,Math.ceil(1.2*r)),i=Math.ceil((n-r)/65536);try{return s.grow(i),o(),!0}catch(e){return!1}},g:a,b:l,c:l,d:l,e:l}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(e,c):e.then(e=>e.arrayBuffer()).then(e=>WebAssembly.instantiate(e,c))).then(e=>{const a=e.instance.exports;return(0,a.g)(),s=a.f,o(),new $p({setStyle:a.h,setAOOptions:a.i,setMetricOptions:a.j,setStructuralOptions:a.k,setFacadeOptions:a.l,setFauxFacadeOptions:a.m,setFacadeClassifierOptions:a.n,addFeature:a.o,addFacade:a.p,generateMesh:a.q,getLastError:a.r,getOuterRingLength:a.s,getMeshCount:a.t,getPositionsPtr:a.u,getPositionsLength:a.v,getNormalsPtr:a.w,getNormalsLength:a.x,getAOPtr:a.y,getAOLength:a.z,getUVPtr:a.A,getUVLength:a.B,getFauxFacadePtr:a.C,getFauxFacadeLength:a.D,getIndicesPtr:a.E,getIndicesLength:a.F,getBuildingPart:a.G,getRingCount:a.H,getRingPtr:a.I,getRingLength:a.J,malloc:a.K,free:a.L,heapU8:t,heap16:r,heap32:n,heapF32:i})})}(e).then(e=>(om=null,lm=e,lm)).catch(e=>{Ze("Could not load building-gen"),om=null,am=e}),om}()}populate(e,t,r,n){const i=dm();if(!i)return;const s=vc(r);this.tileToMeter=s,this.brightness=t.brightness,i.setStyle({normalScale:[1,-1,s],tileToMeters:s}),i.setAOOptions(!1,.3),i.setMetricOptions(!1,16),i.setStructuralOptions(!0),i.setFacadeClassifierOptions(3);const o=new Map,a=new Map;let l=0;for(const{feature:g}of e){if("LineString"!==Tf[g.type]){o.set(g.id,g.properties.source_id);continue}const e=this.layers[0]._featureFilter.needGeometry;if(e&&!this.layers[0]._featureFilter.filter(new So(this.zoom),g,r))continue;const t=Ec(g,e);if(!e&&!this.layers[0]._featureFilter.filter(new So(this.zoom),t,r))continue;const i=e?t.geometry:Cc(g,r,n),s=[];for(const r of i)for(const e of r)s.push(e.x),s.push(e.y);const c={coordinates:s,crossPerc:g.properties.cross_perc,distanceToRoad:g.properties.distance_to_road,entrances:g.properties.entrances,sourceId:0},u=g.properties.source_id;let d=a.get(u);d||(d=[],a.set(u,d)),d.push(c),++l}this.maxHeight=0;const c=new Array,u=new Set,d=e=>{null!=e&&u.add(e)},h=(e,t)=>{null!=e&&c.push({buildingId:e,footprintIndex:t})},p=64*(e.length-l),m=p/2;this.buildingWithFacade.reserve(p,m,!0),this.buildingWithoutFacade.reserve(2*p,2*m,!1),this.footprintsIndices.reserve(16*(e.length-l)),this.footprintsVertices.reserve(8*(e.length-l));for(const{feature:g,id:y,index:_,sourceLayerIndex:v}of e){if("LineString"===Tf[g.type])continue;const e=this.layers[0]._featureFilter.needGeometry;if(e&&!this.layers[0]._featureFilter.filter(new So(this.zoom),g,r))continue;let l=null;if(g.properties&&g.properties.hasOwnProperty("building_id")&&(l=g.properties.building_id,u.has(l)))continue;const c=Ec(g,e);if(!e&&!this.layers[0]._featureFilter.filter(new So(this.zoom),c,r))continue;const p=e?c.geometry:Cc(g,r,n),m=rh(p,500);let f=!1;for(const t of m)if(1!==t.length){f=!0;break}if(f){d(l);continue}if(!Af(p,163)){d(l);continue}const x=this.layers[0],b=Cf(x.layout.get("building-roof-shape").evaluate(g,{},r)),w=x.layout.get("building-base").evaluate(g,{},r),j=x.layout.get("building-height").evaluate(g,{},r),S=x.layout.get("building-flood-light-ground-radius").evaluate(g,{},r),T=x.paint.get("building-ambient-occlusion-intensity"),k=S/this.tileToMeter;g.properties["building-part"]="roof";const A=x.paint.get("building-color").evaluate(g,{},this.canonical).toPremultipliedRenderColor(this.lut),C=x.paint.get("building-emissive-strength").evaluate(g,{},this.canonical);g.properties["building-part"]="wall";const E=x.paint.get("building-color").evaluate(g,{},this.canonical).toPremultipliedRenderColor(this.lut),N=x.paint.get("building-emissive-strength").evaluate(g,{},this.canonical);g.properties["building-part"]="window";const I=x.paint.get("building-color").evaluate(g,{},this.canonical).toPremultipliedRenderColor(this.lut),P=x.paint.get("building-emissive-strength").evaluate(g,{},this.canonical);g.properties["building-part"]="door";const M=x.paint.get("building-color").evaluate(g,{},this.canonical).toPremultipliedRenderColor(this.lut),L=x.paint.get("building-emissive-strength").evaluate(g,{},this.canonical);let R=x.layout.get("building-flood-light-wall-radius").evaluate(g,{},r);R=Le(R,0,2048);const D=R/2048*kf,F=o.get(y),O=a.get(F)||[],z=0!==O.length&&x.layout.get("building-facade").evaluate(g,{},r);i.setFacadeOptions(4,!0),i.setFauxFacadeOptions(z,!1,1);let B=0,U=0,V=0,q=0,W=0,H=0,G=0,Z=0,K=0,Y=0,X=0;if(z){let e=Math.round(x.layout.get("building-facade-floors").evaluate(g,{},r));if(0===w){e=Math.max(1,e-(O.length>0?1:0));let t=4;if(j>100){const e=[10,13,15];t=e[g.id?g.id%e.length:0]}else j<=10&&(t=3);i.setFacadeOptions(t,!0),W=(j<15?1.3:1.61803)*t/s}else W=w/s;H=j/s,W=Math.min(W,H),V=x.layout.get("building-facade-unit-width").evaluate(g,{},r)/s,q=(H-W)/e,i.setFauxFacadeOptions(!0,!0,V);const t=x.layout.get("building-facade-window").evaluate(g,{},r);B=t[0],U=t[1],G=Math.floor(65535*Math.min(1,W/Bn)),Z=Math.floor(65535*Math.min(1,H/Bn)),K=Math.floor(255*B)<<8|Math.floor(255*U),Y=Math.floor(65535*Math.min(1,V/Bn)),X=Math.floor(65535*Math.min(1,q/Bn))}const J=Array(m.length),Q={x:1/0,y:1/0},$={x:-1/0,y:-1/0},ee={x:0,y:0};let te=0;for(let t=0;t<m.length;t++){const e=m[t];if(e.length>0){const r=[],n=Array(e.length+1);n[0]=0;for(let t=0;t<e.length;t++){const i=e[t];for(let e=0;e<i.length;e++){const t=i[i.length-e-1];Q.x=Math.min(Q.x,t.x),Q.y=Math.min(Q.y,t.y),$.x=Math.max($.x,t.x),$.y=Math.max($.y,t.y),ee.x+=t.x,ee.y+=t.y,te++,r.push(t.x),r.push(t.y)}n[t+1]=r.length}J[t]={id:g.id?g.id:0,height:j,minHeight:w,sourceId:0,roofType:b,coordinates:r,ringIndices:n}}}ee.x/=te||1,ee.y/=te||1;const re=i.generateMesh(J,O);if("string"==typeof re){Ze("Unable to generate building ".concat(g.id,": ").concat(re)),d(l);continue}if(0===re.meshes.length||0===re.modifiedPolygonRings.length){d(l);continue}const ne=z?this.buildingWithFacade:this.buildingWithoutFacade;let ie=0;for(const t of re.meshes)ie+=t.positions.length/3;const se=ne.segmentsBucket.prepareSegment(ie,ne.layoutVertexArray,ne.indexArray),oe=[];let ae=null,le=0,ce=-1;const ue=ne.layoutVertexArray.length,de=ue+ie;ne.layoutVertexArray.resize(de),ne.layoutCentroidArray.resize(de),ne.layoutNormalArray.resize(de),ne.layoutAOArray.resize(de),ne.layoutColorArray.resize(de),ne.layoutFloodLightDataArray.resize(de),z&&(ne.layoutFacadePaintArray.resize(de),ne.layoutFacadeDataArray.resize(de),ne.layoutFacadeVerticalRangeArray.resize(de));const he=ne.indexArray.length;let pe=0,me=ue;for(const t of re.meshes){let e,r;if(1===t.buildingPart)e=A,r=C;else if(0===t.buildingPart)e=E,r=N;else if(2===t.buildingPart)e=I,r=P;else{if(3!==t.buildingPart)continue;e=M,r=L}if(r=Le(r,0,1),3===t.buildingPart){const e=new Array;for(let s=0;s<t.positions.length;s+=12){const r=t.positions[s+0],n=t.positions[s+1],i=t.positions[s+3],o=t.positions[s+4],a=t.positions[s+2],l=t.positions[s+8]-a,c=1,u=i-r,d=o-n,h=Math.hypot(u,d);e.push({pos:[r+.5*u,n+.5*d,a],normal:[d/h,-u/h,0],width:h,height:l,depth:c,points:[r,n,i,o]})}const r=ne.entranceBloom.segmentsBucket.prepareSegment(10*e.length,ne.entranceBloom.layoutVertexArray,ne.entranceBloom.indexArray),n=ne.entranceBloom.layoutVertexArray.length;le=ne.entranceBloom.indexArray.length,mf(e,.5/this.tileToMeter,ne.entranceBloom.indexArray,ne.entranceBloom.layoutVertexArray,ne.entranceBloom.layoutAttenuationArray);const i=ne.entranceBloom.layoutVertexArray.length-n;ce=ne.entranceBloom.indexArray.length-le;for(let t=0;t<i;t++)ne.entranceBloom.layoutColorArray.emplaceBack(255*M.r<<8|255*M.g,255*M.b<<8|51*L);r.vertexLength+=i,r.primitiveLength+=ce,ae={part:t.buildingPart,vertexOffset:n,vertexLength:i}}ne.layoutVertexArray.float32.set(t.positions,3*me);const n=t.positions.length/3;for(let u=0;u<n;++u){const n=3*u;pe=Math.max(pe,t.positions[n+2]);const i=t.normals[n+1]*kf,s=t.normals[n+2]*kf,o=3*(me+u);ne.layoutNormalArray.int16[o]=t.normals[n]*kf,ne.layoutNormalArray.int16[o+1]=i,ne.layoutNormalArray.int16[o+2]=s;const a=t.ao[u];ne.layoutAOArray.uint8[me+u]=255*a;const l=1+(a-1)*T,c=255*e.b*l<<8|255*r;ne.layoutColorArray.uint16[2*(me+u)]=255*e.r*l<<8|255*e.g*l,ne.layoutColorArray.uint16[2*(me+u)+1]=c}const i=Math.floor(ee.x),s=Math.floor(ee.y),o=Math.floor(j);for(let t=0;t<n;++t){const e=3*(me+t);ne.layoutCentroidArray.int16[e]=i,ne.layoutCentroidArray.int16[e+1]=s,ne.layoutCentroidArray.int16[e+2]=o}if(ne.layoutFloodLightDataArray.uint16.fill(0===t.buildingPart?D:0,me,me+n),z){const e=255*I.r<<8|255*I.g,r=255*I.b<<8|255*P;for(let t=0;t<n;++t){const n=2*(me+t);ne.layoutFacadePaintArray.uint16[n]=e,ne.layoutFacadePaintArray.uint16[n+1]=r}for(let i=0;i<n;++i)if(t.isFauxFacade[i]){const e=Math.min(65535,Math.floor(t.uv[2*i]*re.outerRingLength));ne.layoutFacadeDataArray.emplace(me+i,1|e,K,Y,X),ne.layoutFacadeVerticalRangeArray.emplace(me+i,G,Z)}else ne.layoutFacadeDataArray.emplace(me+i,0,0,0,0),ne.layoutFacadeVerticalRangeArray.emplace(me+i,0,0)}const a=se.vertexLength,l=t.indices.length/3,c=ne.indexArray.length;ne.indexArray.resize(c+l);for(let u=0;u<l;++u){const e=3*u,r=3*c+e;ne.indexArray.uint16[r]=a+t.indices[e],ne.indexArray.uint16[r+1]=a+t.indices[e+1],ne.indexArray.uint16[r+2]=a+t.indices[e+2]}1!==t.buildingPart&&0!==t.buildingPart&&2!==t.buildingPart&&3!==t.buildingPart||oe.push({part:t.buildingPart,vertexOffset:me,vertexLength:t.positions.length/3}),me+=n,se.vertexLength+=n,se.primitiveLength+=t.indices.length/3}this.maxHeight=Math.max(this.maxHeight,pe);const fe=ne.indexArray.length-he,ge=this.footprintsIndices.length,ye=this.footprintsVertices.length,_e=[],ve=new Se(1/0,1/0),xe=new Se(-1/0,-1/0),be=this.groundEffect.vertexArray.length;for(const t of re.modifiedPolygonRings){const e=[],r=new Se(1/0,1/0),n=new Se(-1/0,-1/0);for(let i=0;i<t.length;i+=2){const s=t.length-i-2;r.x=Math.min(r.x,t[s]),r.y=Math.min(r.y,t[s+1]),n.x=Math.max(n.x,t[s]),n.y=Math.max(n.y,t[s+1]);const o=new Se(t[s],t[s+1]);e.push(o),_e.push(o.x,o.y),this.footprintsVertices.emplaceBack(o.x,o.y)}ve.x=Math.min(ve.x,r.x),ve.y=Math.min(ve.y,r.y),xe.x=Math.max(xe.x,n.x),xe.y=Math.max(xe.y,n.y),this.groundEffect.addData(e,[r,n],k)}const we=this.groundEffect.vertexArray.length-be;this.groundEffect.groundRadiusArray.reserveForAdditional(we);for(let t=0;t<we;t++)this.groundEffect.groundRadiusArray.emplaceBack(S);(Q.x<0||$.x>Bn||Q.y<0||$.y>Bn)&&this.featuresOnBorder.push({featureId:g.id,footprintIndex:this.footprints.length});{const e=Nd(_e,null,2);this.footprintsIndices.resize(this.footprintsIndices.length+e.length),this.footprintsIndices.uint16.set(e,ge),this.buildingIds.add(null!=l?l:g.id),this.footprintsMin.x=Math.min(this.footprintsMin.x,ve.x),this.footprintsMin.y=Math.min(this.footprintsMin.y,ve.y),this.footprintsMax.x=Math.max(this.footprintsMax.x,xe.x),this.footprintsMax.y=Math.max(this.footprintsMax.y,xe.y);const t={footprintVertexOffset:ye,footprintVertexLength:this.footprintsVertices.length-ye,footprintIndexOffset:ge,footprintIndexLength:this.footprintsIndices.length-ge,min:ve,max:xe,hiddenFlags:0,indicesOffset:he,indicesLength:fe,bloomIndicesOffset:le,bloomIndicesLength:ce,groundEffectVertexOffset:be,groundEffectVertexLength:we,hasFauxFacade:z,height:pe,promoteId:y,feature:c,parts:oe,buildingBloom:ae},r=this.footprints.length;void 0!==g.id&&this.featureFootprintLookup.set(g.id,r),h(l,r),this.footprints.push(t)}this.programConfigurations.populatePaintArrays(ne.layoutVertexArray.length,g,_,{},t.availableImages,r,t.brightness),this.groundEffect.addPaintPropertiesData(g,_,{},t.availableImages,r,t.brightness),t.featureIndex.insert(g,p,_,v,this.index,ue)}c.forEach(e=>{let{buildingId:t,footprintIndex:r}=e;u.has(t)&&(this.footprints[r].hiddenFlags|=4)});const f=new Set;this.buildingIds.forEach((e,t,r)=>{u.has(e)||f.add(e)}),this.buildingIds=f,this.groundEffect.prepareBorderSegments()}update(e,t,r,n,i,s,o){this.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o),this.groundEffect.update(e,t,i,r,n,s,o),this.evaluate(this.layers[0],e),this.colorBufferUploaded=!1}isEmpty(){return 0===this.buildingWithoutFacade.layoutVertexArray.length&&0===this.buildingWithFacade.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(e){const t=t=>{t.layoutVertexBuffer=e.createVertexBuffer(t.layoutVertexArray,gf.members),t.layoutNormalBuffer=e.createVertexBuffer(t.layoutNormalArray,yf.members),t.layoutCentroidBuffer=e.createVertexBuffer(t.layoutCentroidArray,_f.members),t.layoutFloodLightDataBuffer=e.createVertexBuffer(t.layoutFloodLightDataArray,Sf.members),t.layoutFacadeDataArray&&t.layoutFacadeDataArray.length&&(t.layoutFacadeDataBuffer=e.createVertexBuffer(t.layoutFacadeDataArray,bf.members)),t.layoutFacadeVerticalRangeArray&&t.layoutFacadeVerticalRangeArray.length&&(t.layoutFacadeVerticalRangeBuffer=e.createVertexBuffer(t.layoutFacadeVerticalRangeArray,wf.members)),t.entranceBloom.layoutVertexArray.length&&(t.entranceBloom.layoutVertexBuffer=e.createVertexBuffer(t.entranceBloom.layoutVertexArray,gf.members),t.entranceBloom.layoutAttenuationBuffer=e.createVertexBuffer(t.entranceBloom.layoutAttenuationArray,jf.members)),this.uploadUpdatedColorBuffer(e),this.uploadUpdatedIndexBuffer(e)};this.uploaded||(t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.upload(e)),this.groundEffect.uploadPaintProperties(e),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){const e=e=>{e.layoutVertexBuffer&&(e.layoutVertexBuffer.destroy(),e.layoutNormalBuffer.destroy(),e.layoutColorBuffer.destroy(),e.segmentsBucket.destroy(),e.indexBuffer&&e.indexBuffer.destroy(),e.entranceBloom.layoutVertexBuffer&&(e.entranceBloom.layoutVertexBuffer.destroy(),e.entranceBloom.layoutColorBuffer.destroy(),e.entranceBloom.layoutAttenuationBuffer.destroy(),e.entranceBloom.indexBuffer.destroy(),e.entranceBloom.segmentsBucket.destroy()))};e(this.buildingWithoutFacade),e(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2],n=!1;const i=r?t:0,s=0|(r?-1:~t);0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const o of e){const e=this.footprints[o],t=e.hiddenFlags&s|i;e.hiddenFlags!==t&&(e.hiddenFlags=t,n=!0,this.groundEffect.updateHiddenByLandmarkRange(e.groundEffectVertexOffset,e.groundEffectVertexLength,0!==e.hiddenFlags))}return n&&(this.indexArrayForConflationUploaded=!1),n}uploadUpdatedIndexBuffer(e){if(this.groundEffect.uploadHiddenByLandmark(e),this.indexArrayForConflationUploaded)return;const t=e=>{0!==e.indexArray.length&&(e.indexArrayForConflation.resize(e.indexArray.length),e.indexArrayForConflation.uint16.set(e.indexArray.uint16),e.entranceBloom.indexArrayForConflation.resize(e.entranceBloom.indexArray.length),e.entranceBloom.indexArrayForConflation.uint16.set(e.entranceBloom.indexArray.uint16))};t(this.buildingWithoutFacade),t(this.buildingWithFacade);for(const n of this.footprints){const e=n.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,t=n.indicesOffset+n.indicesLength;if(0!==n.hiddenFlags){for(let i=n.indicesOffset;i<t;i++)e.indexArrayForConflation.uint16[3*i+0]=0,e.indexArrayForConflation.uint16[3*i+1]=0,e.indexArrayForConflation.uint16[3*i+2]=0;const r=n.bloomIndicesOffset+n.bloomIndicesLength;for(let t=n.bloomIndicesOffset;t<r;t++)e.entranceBloom.indexArrayForConflation.uint16[3*t+0]=0,e.entranceBloom.indexArrayForConflation.uint16[3*t+1]=0,e.entranceBloom.indexArrayForConflation.uint16[3*t+2]=0}}const r=t=>{0!==t.indexArray.length&&(t.indexBuffer?t.indexBuffer.updateData(t.indexArrayForConflation):t.indexBuffer=e.createIndexBuffer(t.indexArrayForConflation,!0),t.entranceBloom.indexBuffer?t.entranceBloom.indexBuffer.updateData(t.entranceBloom.indexArrayForConflation):t.entranceBloom.indexBuffer=e.createIndexBuffer(t.entranceBloom.indexArrayForConflation,!0))};r(this.buildingWithoutFacade),r(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(e){const t=t=>{t.layoutColorBuffer?t.layoutColorBuffer.updateData(t.layoutColorArray):t.layoutColorBuffer=e.createVertexBuffer(t.layoutColorArray,vf.members,!0),t.layoutFacadePaintArray&&(t.layoutFacadePaintBuffer?t.layoutFacadePaintBuffer.updateData(t.layoutFacadePaintArray):t.layoutFacadePaintBuffer=e.createVertexBuffer(t.layoutFacadePaintArray,xf.members,!0)),t.entranceBloom.layoutColorBuffer?t.entranceBloom.layoutColorBuffer.updateData(t.entranceBloom.layoutColorArray):t.entranceBloom.layoutColorBuffer=e.createVertexBuffer(t.entranceBloom.layoutColorArray,vf.members,!0)};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(e,t){const r=e.paint.get("building-ambient-occlusion-intensity");for(const n of this.footprints){if(4&n.hiddenFlags)continue;const i=t[n.promoteId],s=n.feature;s.properties["building-part"]="roof";const o=e.paint.get("building-color").evaluate(s,i,this.canonical).toPremultipliedRenderColor(this.lut),a=e.paint.get("building-emissive-strength").evaluate(s,i,this.canonical);s.properties["building-part"]="wall";const l=e.paint.get("building-color").evaluate(s,i,this.canonical).toPremultipliedRenderColor(this.lut),c=e.paint.get("building-emissive-strength").evaluate(s,i,this.canonical);s.properties["building-part"]="window";const u=e.paint.get("building-color").evaluate(s,i,this.canonical).toPremultipliedRenderColor(this.lut),d=e.paint.get("building-emissive-strength").evaluate(s,i,this.canonical);s.properties["building-part"]="door";const h=e.paint.get("building-color").evaluate(s,i,this.canonical).toPremultipliedRenderColor(this.lut),p=e.paint.get("building-emissive-strength").evaluate(s,i,this.canonical),m=n.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const e of n.parts){let t,i=o;1===e.part?(i=o,t=a):0===e.part?(i=l,t=c):2===e.part?(i=u,t=d):3===e.part&&(i=h,t=p),t=Le(t,0,1);for(let s=0;s<e.vertexLength;s++){const o=e.vertexOffset+s,a=1+(m.layoutAOArray.uint8[o]/255-1)*r;m.layoutColorArray.emplace(o,i.r*a*255<<8|i.g*a*255,i.b*a*255<<8|255*t),n.hasFauxFacade&&m.layoutFacadePaintArray.emplace(o,255*u.r<<8|255*u.g,255*u.b<<8|255*d)}}const f=n.buildingBloom;if(f)for(let e=0;e<f.vertexLength;e++)m.entranceBloom.layoutColorArray.emplace(f.vertexOffset+e,255*h.r<<8|255*h.g,255*h.b<<8|51*p)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(e,t,r){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const n=t.getReplacementRegionsForTile(e.toUnwrapped());if(Vh(this.activeReplacements,n))return;this.activeReplacements=n;for(const s of this.footprints)s.hiddenFlags&=-2;const i=[];for(const s of this.activeReplacements){if(s.order<=Fh)continue;const t=Math.max(1,Math.pow(2,s.footprintTileId.canonical.z-e.canonical.z));for(const r of this.footprints)r.min.x>s.max.x||r.max.x<s.min.x||r.min.y>s.max.y||r.max.y<s.min.y||(i.length=0,Mf(this.footprintsVertices,r.footprintVertexOffset,r.footprintVertexLength,s.footprintTileId.canonical,e.canonical,i),Hh(s.footprint,i,this.footprintsIndices.uint16,r.footprintIndexOffset,r.footprintIndexLength,0,-t)&&(r.hiddenFlags|=1))}0===this.groundEffect.hiddenByLandmarkVertexArray.length&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const s of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(s.groundEffectVertexOffset,s.groundEffectVertexLength,0!==s.hiddenFlags);this.indexArrayForConflationUploaded=!1}getFootprint(e){if(void 0!==e.id){const t=this.featureFootprintLookup.get(e.id);return this.footprints[t]}return null}getHeightAtTileCoord(e,t){let r=Number.NEGATIVE_INFINITY,n=!0;const i=4*(e+Bn)*Bn+(t+Bn);if(this.footprintLookup.hasOwnProperty(i)){const e=this.footprintLookup[i];return e?{height:e.height,hidden:0!==e.hiddenFlags}:void 0}const s=new Se(e,t);for(const o of this.footprints)e>o.max.x||o.min.x>e||t>o.max.y||o.min.y>t||o.height<=r||Pf(s,this.footprintsVertices.float32.subarray(2*o.footprintVertexOffset,2*(o.footprintVertexOffset+o.footprintVertexLength)),this.footprintsIndices.uint16.subarray(o.footprintIndexOffset,o.footprintIndexOffset+o.footprintIndexLength))&&(r=o.height,this.footprintLookup[i]=o,n=0!==o.hiddenFlags);if(r!==Number.NEGATIVE_INFINITY)return{height:r,hidden:n};this.footprintLookup[i]=void 0}}function Pf(e,t,r){for(let n=0;n<r.length;n+=3){const i=r[n],s=r[n+1],o=r[n+2],a=t[2*i+0],l=t[2*i+1],c=t[2*s+0],u=t[2*s+1],d=t[2*o+0],h=t[2*o+1],p=(a-d)*(e.y-h)-(l-h)*(e.x-d),m=(c-a)*(e.y-l)-(u-l)*(e.x-a);if(p<0!=m<0&&0!==p&&0!==m)continue;const f=(d-c)*(e.y-u)-(h-u)*(e.x-c);if(0===f||f<0==p+m<=0)return!0}return!1}function Mf(e,t,r,n,i,s){const o=Math.pow(2,n.z-i.z);for(let a=0;a<r;a++){let r=e.float32[2*(a+t)+0],l=e.float32[2*(a+t)+1];r=(r+i.x*Bn)*o-n.x*Bn,l=(l+i.y*Bn)*o-n.y*Bn,s.push(new Se(r,l))}}let Lf,Rf;$s(If,"BuildingBucket",{omit:["layers"]}),$s(Nf,"BuildingGeometry"),$s(Ef,"BuildingBloomGeometry");const Df=da([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),Ff=da([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:Of}=Df,zf=da([{name:"a_packed",components:3,type:"Float32"}]),{members:Bf}=zf,Uf=da([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:Vf}=Uf;class qf{constructor(e,t){this.width=e,this.height=t,this.nextRow=0,this.image=new wd({width:e,height:t}),this.positions={},this.uploaded=!1}getDash(e,t){const r=this.getKey(e,t);return this.positions[r]}trim(){const e=this.width,t=this.height=Be(this.nextRow);this.image.resize({width:e,height:t})}getKey(e,t){return e.join(",")+t}getDashRanges(e,t,r){const n=[];let i=e.length%2==1?-e[e.length-1]*r:0,s=e[0]*r,o=!0;n.push({left:i,right:s,isDash:o,zeroLength:0===e[0]});let a=e[0];for(let l=1;l<e.length;l++){o=!o;const t=e[l];i=a*r,a+=t,s=a*r,n.push({left:i,right:s,isDash:o,zeroLength:0===t})}return n}addRoundDash(e,t,r){const n=t/2;for(let i=-r;i<=r;i++){const t=this.width*(this.nextRow+r+i);let s=0,o=e[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++s]);const l=Math.abs(a-o.left),c=Math.abs(a-o.right),u=Math.min(l,c);let d;const h=i/r*(n+1);if(o.isDash){const e=n-Math.abs(h);d=Math.sqrt(u*u+e*e)}else d=n-Math.sqrt(u*u+h*h);this.image.data[t+a]=Math.max(0,Math.min(255,d+128))}}}addRegularDash(e,t){for(let a=e.length-1;a>=0;--a){const t=e[a],r=e[a+1];t.zeroLength?e.splice(a,1):r&&r.isDash===t.isDash&&(r.left=t.left,e.splice(a,1))}const r=e[0],n=e[e.length-1];r.isDash===n.isDash&&(r.left=n.left-this.width,n.right=r.right+this.width);const i=this.width*this.nextRow;let s=0,o=e[s];for(let a=0;a<this.width;a++){a/o.right>1&&(o=e[++s]);const r=Math.abs(a-o.left),n=Math.abs(a-o.right),l=Math.min(r,n);this.image.data[i+a]=Math.max(0,Math.min(255,(o.isDash?l:-l)+t+128))}}addDash(e,t){const r=this.getKey(e,t);if(this.positions[r])return this.positions[r];const n="round"===t,i=n?7:0,s=2*i+1;if(this.nextRow+s>this.height)return Ze("LineAtlas out of space"),null;0===e.length&&e.push(1);let o=0;for(let c=0;c<e.length;c++)e[c]<0&&(Ze("Negative value is found in line dasharray, replacing values with 0"),e[c]=0),o+=e[c];if(0!==o){const r=this.width/o,s=this.getDashRanges(e,this.width,r);n?this.addRoundDash(s,r,i):this.addRegularDash(s,"square"===t?.5*r:0)}const a=this.nextRow+i;this.nextRow+=s;const l={tl:[a,i],br:[o,0]};return this.positions[r]=l,l}}$s(qf,"LineAtlas");const Wf=Nc.types,Hf=Math.cos(Math.PI/180*37.5),Gf=Math.cos(Math.PI/180*5);class Zf{constructor(e){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=e.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=e.overscaling,this.pixelRatio=e.pixelRatio,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.projection=e.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(e=>{this.gradients[e.id]={}}),this.layoutVertexArray=new xa,this.layoutVertexArray2=new ba,this.patternVertexArray=new ba,this.indexArray=new La,this.programConfigurations=new Bl(e.layers,{zoom:e.zoom,lut:e.lut}),this.segments=new dl,this.maxLineLength=0,this.zOffsetVertexArray=new ba,this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.tessellationStep=e.tessellationStep?e.tessellationStep:Bn/64,this.worldview=e.worldview,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.hasPattern=sh("line",this.layers,this.pixelRatio,t);const i=this.layers[0].layout.get("line-sort-key");this.tileToMeter=vc(r);const s=this.layers[0].layout.get("line-elevation-reference");if("hd-road-markup"===s)this.elevationType="road";else{const e=this.layers[0].layout.get("line-z-offset"),t=e.isConstant()&&!e.constantOr(0);this.elevationType="sea"!==s&&"ground"!==s&&t?"none":"offset","offset"===this.elevationType&&"none"===s&&Ze("line-elevation-reference: ground is used for the layer ".concat(this.layerIds[0]," because non-zero line-z-offset value was found."))}const o=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope="offset"===this.elevationType&&void 0!==o;const a=[];for(const{feature:d,id:h,index:p,sourceLayerIndex:m}of e){const e=this.layers[0]._featureFilter.needGeometry,s=Ec(d,e);if(!this.layers[0]._featureFilter.filter(new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),s,r))continue;const o=i?i.evaluate(s,{},r):void 0,l={id:h,properties:d.properties,type:d.type,sourceLayerIndex:m,index:p,geometry:e?s.geometry:Cc(d,r,n),patterns:{},sortKey:o};a.push(l)}i&&a.sort((e,t)=>e.sortKey-t.sortKey);const{lineAtlas:l,featureIndex:c}=t,u=this.addConstantDashes(l);for(const d of a){const{geometry:n,index:i,sourceLayerIndex:s}=d;if(u&&this.addFeatureDashes(d,l),this.hasPattern){const e=oh("line",this.layers,d,this.zoom,this.pixelRatio,t);this.patternFeatures.push(e)}else this.addFeature(d,n,i,r,l.positions,t.availableImages,t.brightness,t.elevationFeatures);c.insert(e[i].feature,n,i,s,this.index)}}addConstantDashes(e){let t=!1;for(const r of this.layers){const n=r.paint.get("line-dasharray").value,i=r.layout.get("line-cap").value;if("constant"!==n.kind||"constant"!==i.kind)t=!0;else{const t=i.value,r=n.value;if(!r)continue;e.addDash(r,t)}}return t}addFeatureDashes(e,t){const r=this.zoom;for(const n of this.layers){const i=n.paint.get("line-dasharray").value,s=n.layout.get("line-cap").value;if("constant"===i.kind&&"constant"===s.kind)continue;let o,a;if("constant"===i.kind){if(o=i.value,!o)continue}else o=i.evaluate({zoom:r},e);a="constant"===s.kind?s.value:s.evaluate({zoom:r},e),t.addDash(o,a),e.patterns[n.id]=[t.getKey(o,a)]}}update(e,t,r,n,i,s,o,a){this.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o,a)}addFeatures(e,t,r,n,i,s){for(const o of this.patternFeatures)this.addFeature(o,o.geometry,o.index,t,r,n,s,e.elevationFeatures)}isEmpty(){return 0===this.layoutVertexArray.length}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(e){this.uploaded||(0!==this.layoutVertexArray2.length&&(this.layoutVertexBuffer2=e.createVertexBuffer(this.layoutVertexArray2,Bf)),0!==this.patternVertexArray.length&&(this.patternVertexBuffer=e.createVertexBuffer(this.patternVertexArray,Vf)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,Ff.members,!0)),this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,Of),this.indexBuffer=e.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(e),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(e,t){let r,n;if(t&&t>0?(r="mapbox_clip_start_".concat(t),n="mapbox_clip_end_".concat(t)):(r="mapbox_clip_start",n="mapbox_clip_end"),e.properties&&e.properties.hasOwnProperty(r)&&e.properties.hasOwnProperty(n))return{start:+e.properties[r],end:+e.properties[n]}}addFeature(e,t,r,n,i,s,o,a){const l=this.layers[0].layout,c=l.get("line-join").evaluate(e,{}),u=l.get("line-cap").evaluate(e,{}),d=l.get("line-miter-limit"),h=l.get("line-round-limit");this.lineClips=this.lineFeatureClips(e),this.lineFeature=e;const p=!(!e.properties||!e.properties.hasOwnProperty("mapbox_line_metrics"))&&e.properties.mapbox_line_metrics;this.zOffsetValue=l.get("line-z-offset").value;const m=this.layers[0].paint.get("line-width").value;if("constant"!==m.kind&&!1===m.isLineProgressConstant&&(this.variableWidthValue=m),"road"===this.elevationType){const r=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(e,t,n,a,c,u,d,h)){const[i,s]=this.clipRuntimeLinesToTile(t,1);for(let t=0;t<i.length;t++){const r=i[t],o=s[t],a={progress:{min:o.progress.min,max:o.progress.max},nextDir:this.computeSegNextDir(o,r),prevDir:this.computeSegPrevDir(o,r)};this.addLine(r,e,n,c,u,d,h,a,p&&o.parentIndex>0?o.parentIndex:null)}this.fillNonElevatedRoadSegment(r)}}else for(let f=0;f<t.length;f++)this.addLine(t[f],e,n,c,u,d,h,void 0,p&&f>0?f:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,e,r,i,s,n,o,void 0,this.worldview)}computeSegNextDir(e,t){return e.nextPoint.sub(t.at(-2)).unit()}computeSegPrevDir(e,t){return t[1].sub(e.prevPoint).unit()}clipLinesToTile(e,t){return Lp(e,-t,-t,Bn+t,Bn+t)}clipRuntimeLinesToTile(e,t){const r=[];return[Lp(e,-t,-t,Bn+t,Bn+t,r),r]}addElevatedRoadFeature(e,t,r,n,i,s,o,a){const l=[],c=tu.getElevationFeature(e,n);if(c){const e=this.clipLinesToTile(t,1),n=this.prepareElevatedLines(e,c,r);for(const t of n)l.push({geometry:t,elevation:c,elevationTileID:r,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(0===l.length)return!1;for(const u of l){const t=this.layoutVertexArray.length;this.addLine(u.geometry,e,r,i,s,o,a);const n=new ru(r,u.elevationTileID);if(u.elevation)for(let e=t;e<this.layoutVertexArray.length;e++){const t=new Se(this.layoutVertexArray.int16[6*e]>>1,this.layoutVertexArray.int16[6*e+1]>>1),r=n.pointElevation(t,u.elevation,.05);this.updateHeightRange(r),this.zOffsetVertexArray.emplaceBack(r,0,0)}else this.fillNonElevatedRoadSegment(t)}return!0}prepareElevatedLines(e,t,r){if(null!=t.constantHeight)return e;const n=[],i=1/vc(r);for(const s of e)Rp(s,new $c(t,i),0,n);return n}fillNonElevatedRoadSegment(e){for(let t=e;t<this.layoutVertexArray.length;t++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(e){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,e),this.heightRange.max=Math.max(this.heightRange.max,e)):this.heightRange={min:e,max:e}}addLine(e,t,r,n,i,s,o,a,l){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=l?this.lineFeatureClips(t,l):this.lineClips;const c="none"===n;this.patternJoinNone=this.hasPattern&&c,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const u=a&&a.progress.min>0,d=a&&a.progress.max<1;if(this.lineClips){let r={min:this.lineClips.start,max:this.lineClips.end},n=1;if(a){const e=this.lineClips.end-this.lineClips.start;r=function(e,t,r){return{min:st(e.min,t,r),max:st(e.max,t,r)}}(a.progress,{min:0,max:1},r),e>0&&(n=(r.max-r.min)/e)}const i=+t.properties.mapbox_clip_feature_len,s=+t.properties.mapbox_clip_seg_len;if(Number.isNaN(i)||Number.isNaN(s)){for(let r=0;r<e.length-1;r++)this.totalDistance+=e[r].dist(e[r+1]);const t=this.totalDistance/(r.max-r.min);this.totalFeatureLength=Number.isFinite(t)?t:0,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=i,this.distance=s*n,this.lineClips.start=r.min,this.lineClips.end=r.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const h="Polygon"===Wf[t.type];let p=e.length;for(;p>=2&&e[p-1].equals(e[p-2]);)p--;let m=0;for(;m<p-1&&e[m].equals(e[m+1]);)m++;if(p<(h?3:2))return;"bevel"===n&&(s=1.05);const f=this.segments.prepareSegment(10*p,this.layoutVertexArray,this.indexArray);let g,y,_,v,x,b,w,j;a&&a.prevDir&&(b=a.prevDir.perp()),a&&a.nextDir&&(w=a.nextDir.perp()),this.e1=this.e2=-1,h&&(g=e[p-2],x=e[m].sub(g)._unit()._perp());for(let S=m;S<p;S++){if(_=S===p-1?h?e[m+1]:void 0:e[S+1],_&&e[S].equals(_))continue;x&&(v=x),g&&(y=g),g=e[S],j=this.evaluateLineProgressFeatures(y?y.dist(g):0),x=_?_.sub(g)._unit()._perp():v,v=v||x;const t=y&&_;let r=t?n:h||c?"butt":i;const a=v.x*x.x+v.y*x.y;if(c){const e=function(e){if(e.patternJoinNone){const t=e.segmentPoints.length/2,r=e.lineSoFar-e.segmentStart;for(let n=0;n<t;++n){const t=e.segmentPoints[2*n+1],i=Math.round(e.segmentPoints[2*n])+.5+.25*t;e.patternVertexArray.emplaceBack(i,r,e.segmentStart),e.patternVertexArray.emplaceBack(i,r,e.segmentStart)}e.segmentPoints.length=0}e.e1=e.e2=-1};if(t&&a<Gf){this.updateDistance(y,g),this.addCurrentVertex(g,v,1,1,f,j),e(this),this.addCurrentVertex(g,x,-1,-1,f,j);continue}if(y){if(!_){this.updateDistance(y,g),this.addCurrentVertex(g,v,1,1,f,j),e(this);continue}r="miter"}}let l=v.add(x);0===l.x&&0===l.y||l._unit();const T=l.x*x.x+l.y*x.y,k=0!==T?1/T:1/0,A=2*Math.sqrt(2-2*T),C=T<Hf&&y&&_,E=v.x*x.y-v.y*x.x>0,N=this.overscaling<=16?15*Bn/(512*this.overscaling):0;if(t&&"round"===r)if(k<o)r="miter";else if(k<=2){const e=Kf(g,-10,Bn+10);r="offset"===this.elevationType&&(e||this.hasCrossSlope)?"miter":"fakeround"}if("miter"===r&&k>s&&(r="bevel"),"bevel"===r&&(k>2&&(r="flipbevel"),k<s&&(r="miter")),y&&!("miter"===r&&C)&&this.updateDistance(y,g),"miter"===r)if(C){const e=g.dist(y);if(e>2*N){const t=g.sub(g.sub(y)._mult(N/e)._round());this.updateDistance(y,t),this.addCurrentVertex(t,v,0,0,f,j),y=t}this.updateDistance(y,g),l._mult(k),this.addCurrentVertex(g,l,0,0,f,j);const t=g.dist(_);if(t>2*N){const e=g.add(_.sub(g)._mult(N/t)._round());this.updateDistance(g,e),this.addCurrentVertex(e,x,0,0,f,j),g=e}}else l._mult(k),this.addCurrentVertex(g,l,0,0,f,j);else if("flipbevel"===r){if(k>100)l=x.mult(-1);else{const e=k*v.add(x).mag()/v.sub(x).mag();l._perp()._mult(e*(E?-1:1))}this.addCurrentVertex(g,l,0,0,f,j),this.addCurrentVertex(g,l.mult(-1),0,0,f,j)}else if("bevel"===r||"fakeround"===r){null!=j&&y&&this.addCurrentVertex(g,w||v,-1,-1,f,j);const e=g.dist(y)<=2*N&&"bevel"!==r,t=l.mult(E?1:-1);t._mult(k);const n=x.mult(E?-1:1),i=v.mult(E?-1:1),s=this.evaluateLineProgressFeatures(this.distance);if(null==j&&(this.addHalfVertex(g,t.x,t.y,!1,!E,0,f,s),e||this.addHalfVertex(g,t.x+2*i.x,t.y+2*i.y,!1,E,0,f,s)),"fakeround"===r){const e=Math.round(180*A/Math.PI/20);this.addHalfVertex(g,i.x,i.y,!1,E,0,f,s);for(let t=0;t<e;t++){let r=t/e;if(.5!==r){const e=r-.5;r+=r*e*(r-1)*((1.0904+a*(a*(3.55645-1.43519*a)-3.2452))*e*e+(.848013+a*(.215638*a-1.06021)))}const o=n.sub(i)._mult(r)._add(i)._unit();this.addHalfVertex(g,o.x,o.y,!1,E,0,f,s)}this.addHalfVertex(g,n.x,n.y,!1,E,0,f,s)}e||null!=j||this.addHalfVertex(g,t.x+2*n.x,t.y+2*n.y,!1,E,0,f,s),null!=j&&_&&this.addCurrentVertex(g,b||x,1,1,f,j)}else if("butt"===r)this.addCurrentVertex(g,l,0,0,f,j);else if("square"===r){if(!y){const e=u?0:-1;this.addCurrentVertex(g,l,e,e,f,j)}if(this.addCurrentVertex(g,l,0,0,f,j),y){const e=d?0:1;this.addCurrentVertex(g,l,e,e,f,j)}}else if("round"===r){if(y){const e=!t&&w?w:v;this.addCurrentVertex(g,e,0,0,f,j),!t&&d||this.addCurrentVertex(g,e,1,1,f,j,!0)}if(_){const e=!t&&b?b:x;!t&&u||this.addCurrentVertex(g,e,-1,-1,f,j,!0),this.addCurrentVertex(g,e,0,0,f,j)}}}}addVerticesTo(e,t,r,n,i,s,o,a,l,c){const u=(t.w-e.w)/this.tessellationStep|0;let d=0;const h=this.scaledDistance;if(u>1){this.lineSoFar=e.w;const h=(t.x-e.x)/u,p=(t.y-e.y)/u,m=(t.z-e.z)/u,f=(t.w-e.w)/u;for(let t=1;t<u;++t){e.x+=h,e.y+=p,e.z+=m,this.lineSoFar+=f,d+=f;const t=this.evaluateLineProgressFeatures(this.prevDistance+d);this.scaledDistance=(this.prevDistance+d)/this.totalDistance,this.addHalfVertex(e,r,n,c,!1,o,l,t),this.addHalfVertex(e,i,s,c,!0,-a,l,t)}}this.lineSoFar=t.w,this.scaledDistance=h;const p=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(t,r,n,c,!1,o,l,p),this.addHalfVertex(t,i,s,c,!0,-a,l,p)}evaluateLineProgressFeatures(e){if(!this.variableWidthValue&&"offset"!==this.elevationType)return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+e)/this.totalFeatureLength):Ze("line-progress evaluation for ".concat(this.layerIds[0]," requires enabling 'lineMetrics' for the source."));let t=0;return this.variableWidthValue&&"constant"!==this.variableWidthValue.kind&&(t=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),"offset"!==this.elevationType?{zOffset:0,variableWidth:t}:"constant"===this.zOffsetValue.kind?{zOffset:this.zOffsetValue.value,variableWidth:t}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:t}}addCurrentVertex(e,t,r,n,i,s){let o=arguments.length>6&&void 0!==arguments[6]&&arguments[6];const a=t.x+t.y*r,l=t.y-t.x*r,c=t.y*n-t.x,u=-t.y-t.x*n;if(null!=s){const t="offset"===this.elevationType,d=-10,h=Bn+10,p=s.zOffset,m=new Ip(e.x,e.y,p,this.lineSoFar),f=!!t&&Kf(e,d,h),g=this.lineSoFar,y=this.distance;if(this.currentVertex)if(f){const t=this.currentVertexIsOutside,s=this.currentVertex,f=new Ip(e.x,e.y,p,this.lineSoFar);if(Mp(s,f,d,h),!Kf(f,d,h)){if(t){this.e1=this.e2=-1,this.distance-=s.dist(m),this.lineSoFar=s.w;const e=this.evaluateLineProgressFeatures(s.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(s,a,l,o,!1,r,i,e),this.addHalfVertex(s,c,u,o,!0,-n,i,e),this.prevDistance=this.distance}this.distance=this.prevDistance+s.dist(f),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(s,f,a,l,c,u,r,n,i,o),this.distance=y,this.scaledDistance=this.distance/this.totalDistance}}else{const e=this.currentVertex;if(this.currentVertexIsOutside){Mp(e,m,d,h),this.e1=this.e2=-1,this.distance-=e.dist(m),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=e.w;const t=this.evaluateLineProgressFeatures(e.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(e,a,l,o,!1,r,i,t),this.addHalfVertex(e,c,u,o,!0,-n,i,t),this.prevDistance=this.distance,this.distance=y,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(e,m,a,l,c,u,r,n,i,o)}else f||(this.addHalfVertex(e,a,l,o,!1,r,i,s),this.addHalfVertex(e,c,u,o,!0,-n,i,s));this.currentVertex=m,this.currentVertexIsOutside=f,this.lineSoFar=g}else this.addHalfVertex(e,a,l,o,!1,r,i,s),this.addHalfVertex(e,c,u,o,!0,-n,i,s)}addHalfVertex(e,t,r,n,i,s,o,a){let{x:l,y:c}=e;if(this.patternJoinNone&&(0===this.segmentPoints.length&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),i||this.segmentPoints.push(this.lineSoFar-this.segmentStart,s)),this.layoutVertexArray.emplaceBack((l<<1)+(n?1:0),(c<<1)+(i?1:0),Math.round(63*t)+128,Math.round(63*r)+128,1+(0===s?0:s<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const e=hr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,e)}const u=o.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,u),o.primitiveLength++),i?this.e2=u:this.e1=u,null!=a&&this.zOffsetVertexArray.emplaceBack(a.zOffset,a.variableWidth,a.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(e,t){this.prevDistance=this.distance,this.distance+=e.dist(t),this.updateScaledDistance()}}function Kf(e,t,r){return e.x<t||e.x>r||e.y<t||e.y>r}let Yf,Xf;function Jf(e,t,r){return t*(Bn/(e.tileSize*Math.pow(2,r-e.tileID.overscaledZ)))}$s(Zf,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const Qf=(e,t,r)=>(1-r)*e+r*t;function $f(e,t){return 1/Jf(e,1,t.tileZoom)}function eg(e,t,r,n){return e.translatePosMatrix(n||t.tileID.projMatrix,t,r.paint.get("line-translate"),r.paint.get("line-translate-anchor"))}const tg=e=>{const t=[];rg(e)&&t.push("RENDER_LINE_DASH"),e.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const r=e.paint.get("line-trim-offset");0===r[0]&&0===r[1]||t.push("RENDER_LINE_TRIM_OFFSET"),0!==e.paint.get("line-border-width").constantOr(1)&&t.push("RENDER_LINE_BORDER");const n="none"===e.layout.get("line-join").constantOr("miter"),i=!!e.paint.get("line-pattern").constantOr(1);return n&&i&&t.push("LINE_JOIN_NONE"),t};function rg(e){const t=e.paint.get("line-dasharray").value;return"constant"!==t.kind||t.value}let ng;const ig=()=>ng||(ng={layout:Yf||(Yf=new Do({"line-cap":new Lo(Fo.layout_line["line-cap"]),"line-join":new Lo(Fo.layout_line["line-join"]),"line-miter-limit":new Mo(Fo.layout_line["line-miter-limit"]),"line-round-limit":new Mo(Fo.layout_line["line-round-limit"]),"line-sort-key":new Lo(Fo.layout_line["line-sort-key"]),"line-z-offset":new Lo(Fo.layout_line["line-z-offset"]),"line-elevation-reference":new Mo(Fo.layout_line["line-elevation-reference"]),"line-cross-slope":new Mo(Fo.layout_line["line-cross-slope"]),visibility:new Mo(Fo.layout_line.visibility),"line-width-unit":new Mo(Fo.layout_line["line-width-unit"])})),paint:Xf||(Xf=new Do({"line-opacity":new Lo(Fo.paint_line["line-opacity"]),"line-color":new Lo(Fo.paint_line["line-color"]),"line-translate":new Mo(Fo.paint_line["line-translate"]),"line-translate-anchor":new Mo(Fo.paint_line["line-translate-anchor"]),"line-width":new Lo(Fo.paint_line["line-width"]),"line-gap-width":new Lo(Fo.paint_line["line-gap-width"]),"line-offset":new Lo(Fo.paint_line["line-offset"]),"line-blur":new Lo(Fo.paint_line["line-blur"]),"line-dasharray":new Lo(Fo.paint_line["line-dasharray"]),"line-pattern":new Lo(Fo.paint_line["line-pattern"]),"line-pattern-cross-fade":new Mo(Fo.paint_line["line-pattern-cross-fade"]),"line-gradient":new Ro(Fo.paint_line["line-gradient"]),"line-trim-offset":new Mo(Fo.paint_line["line-trim-offset"]),"line-trim-fade-range":new Mo(Fo.paint_line["line-trim-fade-range"]),"line-trim-color":new Mo(Fo.paint_line["line-trim-color"]),"line-emissive-strength":new Lo(Fo.paint_line["line-emissive-strength"]),"line-border-width":new Lo(Fo.paint_line["line-border-width"]),"line-border-color":new Lo(Fo.paint_line["line-border-color"]),"line-occlusion-opacity":new Mo(Fo.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},ng);class sg extends Lo{possiblyEvaluate(e,t){return t=new So(Math.floor(t.zoom),{now:t.now,fadeDuration:t.fadeDuration,transition:t.transition,worldview:t.worldview}),super.possiblyEvaluate(e,t)}evaluate(e,t,r,n){return t=Object.assign({},t,{zoom:Math.floor(t.zoom)}),super.evaluate(e,t,r,n)}}let og;function ag(e,t){return t>0?t+2*e:e}const lg=da([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),cg=da([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),ug=da([{name:"a_projected_pos",components:4,type:"Float32"}],4);da([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const dg=da([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),hg=da([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),pg=da([{name:"a_texb",components:2,type:"Uint16"}]),mg=da([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),fg=da([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);da([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const gg=da([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),yg=da([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);da([{name:"triangle",components:3,type:"Uint16"}]),da([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),da([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),da([{type:"Float32",name:"offsetX"}]),da([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var _g=24;function vg(e,t,r){return e.sections.forEach(e=>{e.text=function(e,t,r){const n=t.layout.get("text-transform").evaluate(r,{});return"uppercase"===n?e=e.toLocaleUpperCase():"lowercase"===n&&(e=e.toLocaleLowerCase()),jo.applyArabicShaping&&(e=jo.applyArabicShaping(e)),e}(e.text,t,r)}),e}const xg={"!":"\ufe15","#":"\uff03",$:"\uff04","%":"\uff05","&":"\uff06","(":"\ufe35",")":"\ufe36","*":"\uff0a","+":"\uff0b",",":"\ufe10","-":"\ufe32",".":"\u30fb","/":"\uff0f",":":"\ufe13",";":"\ufe14","<":"\ufe3f","=":"\uff1d",">":"\ufe40","?":"\ufe16","@":"\uff20","[":"\ufe47","\\":"\uff3c","]":"\ufe48","^":"\uff3e",_:"\ufe33","`":"\uff40","{":"\ufe37","|":"\u2015","}":"\ufe38","~":"\uff5e","\xa2":"\uffe0","\xa3":"\uffe1","\xa5":"\uffe5","\xa6":"\uffe4","\xac":"\uffe2","\xaf":"\uffe3","\u2013":"\ufe32","\u2014":"\ufe31","\u2018":"\ufe43","\u2019":"\ufe44","\u201c":"\ufe41","\u201d":"\ufe42","\u2026":"\ufe19","\u2027":"\u30fb","\u20a9":"\uffe6","\u3001":"\ufe11","\u3002":"\ufe12","\u3008":"\ufe3f","\u3009":"\ufe40","\u300a":"\ufe3d","\u300b":"\ufe3e","\u300c":"\ufe41","\u300d":"\ufe42","\u300e":"\ufe43","\u300f":"\ufe44","\u3010":"\ufe3b","\u3011":"\ufe3c","\u3014":"\ufe39","\u3015":"\ufe3a","\u3016":"\ufe17","\u3017":"\ufe18","\uff01":"\ufe15","\uff08":"\ufe35","\uff09":"\ufe36","\uff0c":"\ufe10","\uff0d":"\ufe32","\uff0e":"\u30fb","\uff1a":"\ufe13","\uff1b":"\ufe14","\uff1c":"\ufe3f","\uff1e":"\ufe40","\uff1f":"\ufe16","\uff3b":"\ufe47","\uff3d":"\ufe48","\uff3f":"\ufe33","\uff5b":"\ufe37","\uff5c":"\u2015","\uff5d":"\ufe38","\uff5f":"\ufe35","\uff60":"\ufe36","\uff61":"\ufe12","\uff62":"\ufe41","\uff63":"\ufe42","\u2190":"\u2191","\u2192":"\u2193"};function bg(e){return"\ufe36"===e||"\ufe48"===e||"\ufe38"===e||"\ufe44"===e||"\ufe42"===e||"\ufe3e"===e||"\ufe3c"===e||"\ufe3a"===e||"\ufe18"===e||"\ufe40"===e||"\ufe10"===e||"\ufe13"===e||"\ufe14"===e||"\uff40"===e||"\uffe3"===e||"\ufe11"===e||"\ufe12"===e}function wg(e){return"\ufe35"===e||"\ufe47"===e||"\ufe37"===e||"\ufe43"===e||"\ufe41"===e||"\ufe3d"===e||"\ufe3b"===e||"\ufe39"===e||"\ufe17"===e||"\ufe3f"===e}const jg=4294967296,Sg=1/jg,Tg="undefined"==typeof TextDecoder?null:new TextDecoder("utf-8");let kg=class{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new Uint8Array(16);this.buf=ArrayBuffer.isView(e)?e:new Uint8Array(e),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.length;for(;this.pos<r;){const r=this.readVarint(),n=r>>3,i=this.pos;this.type=7&r,e(n,t,this),this.pos===i&&this.skip(r)}return t}readMessage(e,t){return this.readFields(e,t,this.readVarint()+this.pos)}readFixed32(){const e=this.dataView.getUint32(this.pos,!0);return this.pos+=4,e}readSFixed32(){const e=this.dataView.getInt32(this.pos,!0);return this.pos+=4,e}readFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*jg;return this.pos+=8,e}readSFixed64(){const e=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*jg;return this.pos+=8,e}readFloat(){const e=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,e}readDouble(){const e=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,e}readVarint(e){const t=this.buf;let r,n;return n=t[this.pos++],r=127&n,n<128?r:(n=t[this.pos++],r|=(127&n)<<7,n<128?r:(n=t[this.pos++],r|=(127&n)<<14,n<128?r:(n=t[this.pos++],r|=(127&n)<<21,n<128?r:(n=t[this.pos],r|=(15&n)<<28,function(e,t,r){const n=r.buf;let i,s;if(s=n[r.pos++],i=(112&s)>>4,s<128)return Ag(e,i,t);if(s=n[r.pos++],i|=(127&s)<<3,s<128)return Ag(e,i,t);if(s=n[r.pos++],i|=(127&s)<<10,s<128)return Ag(e,i,t);if(s=n[r.pos++],i|=(127&s)<<17,s<128)return Ag(e,i,t);if(s=n[r.pos++],i|=(127&s)<<24,s<128)return Ag(e,i,t);if(s=n[r.pos++],i|=(1&s)<<31,s<128)return Ag(e,i,t);throw new Error("Expected varint not more than 10 bytes")}(r,e,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const e=this.readVarint();return e%2==1?(e+1)/-2:e/2}readBoolean(){return Boolean(this.readVarint())}readString(){const e=this.readVarint()+this.pos,t=this.pos;return this.pos=e,e-t>=12&&Tg?Tg.decode(this.buf.subarray(t,e)):function(e,t,r){let n="",i=t;for(;i<r;){const t=e[i];let s,o,a,l=null,c=t>239?4:t>223?3:t>191?2:1;if(i+c>r)break;1===c?t<128&&(l=t):2===c?(s=e[i+1],128==(192&s)&&(l=(31&t)<<6|63&s,l<=127&&(l=null))):3===c?(s=e[i+1],o=e[i+2],128==(192&s)&&128==(192&o)&&(l=(15&t)<<12|(63&s)<<6|63&o,(l<=2047||l>=55296&&l<=57343)&&(l=null))):4===c&&(s=e[i+1],o=e[i+2],a=e[i+3],128==(192&s)&&128==(192&o)&&128==(192&a)&&(l=(15&t)<<18|(63&s)<<12|(63&o)<<6|63&a,(l<=65535||l>=1114112)&&(l=null))),null===l?(l=65533,c=1):l>65535&&(l-=65536,n+=String.fromCharCode(l>>>10&1023|55296),l=56320|1023&l),n+=String.fromCharCode(l),i+=c}return n}(this.buf,t,e)}readBytes(){const e=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,e);return this.pos=e,t}readPackedVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const r=this.readPackedEnd();for(;this.pos<r;)e.push(this.readVarint(t));return e}readPackedSVarint(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSVarint());return e}readPackedBoolean(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readBoolean());return e}readPackedFloat(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFloat());return e}readPackedDouble(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readDouble());return e}readPackedFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed32());return e}readPackedSFixed32(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed32());return e}readPackedFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readFixed64());return e}readPackedSFixed64(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];const t=this.readPackedEnd();for(;this.pos<t;)e.push(this.readSFixed64());return e}readPackedEnd(){return 2===this.type?this.readVarint()+this.pos:this.pos+1}skip(e){const t=7&e;if(0===t)for(;this.buf[this.pos++]>127;);else if(2===t)this.pos=this.readVarint()+this.pos;else if(5===t)this.pos+=4;else{if(1!==t)throw new Error("Unimplemented type: ".concat(t));this.pos+=8}}writeTag(e,t){this.writeVarint(e<<3|t)}realloc(e){let t=this.length||16;for(;t<this.pos+e;)t*=2;if(t!==this.length){const e=new Uint8Array(t);e.set(this.buf),this.buf=e,this.dataView=new DataView(e.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeSFixed32(e){this.realloc(4),this.dataView.setInt32(this.pos,e,!0),this.pos+=4}writeFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Sg),!0),this.pos+=8}writeSFixed64(e){this.realloc(8),this.dataView.setInt32(this.pos,-1&e,!0),this.dataView.setInt32(this.pos+4,Math.floor(e*Sg),!0),this.pos+=8}writeVarint(e){(e=+e||0)>268435455||e<0?function(e,t){let r,n;if(e>=0?(r=e%4294967296|0,n=e/4294967296|0):(r=~(-e%4294967296),n=~(-e/4294967296),4294967295^r?r=r+1|0:(r=0,n=n+1|0)),e>=0x10000000000000000||e<-0x10000000000000000)throw new Error("Given varint doesn't fit into 10 bytes");t.realloc(10),function(e,t,r){r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,e>>>=7,r.buf[r.pos++]=127&e|128,r.buf[r.pos]=127&(e>>>=7)}(r,0,t),function(e,t){const r=(7&e)<<4;t.buf[t.pos++]|=r|((e>>>=3)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e|((e>>>=7)?128:0),e&&(t.buf[t.pos++]=127&e)))))}(n,t)}(e,this):(this.realloc(4),this.buf[this.pos++]=127&e|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=127&(e>>>=7)|(e>127?128:0),e<=127||(this.buf[this.pos++]=e>>>7&127))))}writeSVarint(e){this.writeVarint(e<0?2*-e-1:2*e)}writeBoolean(e){this.writeVarint(+e)}writeString(e){e=String(e),this.realloc(4*e.length),this.pos++;const t=this.pos;this.pos=function(e,t,r){for(let n,i,s=0;s<t.length;s++){if(n=t.charCodeAt(s),n>55295&&n<57344){if(!i){n>56319||s+1===t.length?(e[r++]=239,e[r++]=191,e[r++]=189):i=n;continue}if(n<56320){e[r++]=239,e[r++]=191,e[r++]=189,i=n;continue}n=i-55296<<10|n-56320|65536,i=null}else i&&(e[r++]=239,e[r++]=191,e[r++]=189,i=null);n<128?e[r++]=n:(n<2048?e[r++]=n>>6|192:(n<65536?e[r++]=n>>12|224:(e[r++]=n>>18|240,e[r++]=n>>12&63|128),e[r++]=n>>6&63|128),e[r++]=63&n|128)}return r}(this.buf,e,this.pos);const r=this.pos-t;r>=128&&Cg(t,r,this),this.pos=t-1,this.writeVarint(r),this.pos+=r}writeFloat(e){this.realloc(4),this.dataView.setFloat32(this.pos,e,!0),this.pos+=4}writeDouble(e){this.realloc(8),this.dataView.setFloat64(this.pos,e,!0),this.pos+=8}writeBytes(e){const t=e.length;this.writeVarint(t),this.realloc(t);for(let r=0;r<t;r++)this.buf[this.pos++]=e[r]}writeRawMessage(e,t){this.pos++;const r=this.pos;e(t,this);const n=this.pos-r;n>=128&&Cg(r,n,this),this.pos=r-1,this.writeVarint(n),this.pos+=n}writeMessage(e,t,r){this.writeTag(e,2),this.writeRawMessage(t,r)}writePackedVarint(e,t){t.length&&this.writeMessage(e,Eg,t)}writePackedSVarint(e,t){t.length&&this.writeMessage(e,Ng,t)}writePackedBoolean(e,t){t.length&&this.writeMessage(e,Mg,t)}writePackedFloat(e,t){t.length&&this.writeMessage(e,Ig,t)}writePackedDouble(e,t){t.length&&this.writeMessage(e,Pg,t)}writePackedFixed32(e,t){t.length&&this.writeMessage(e,Lg,t)}writePackedSFixed32(e,t){t.length&&this.writeMessage(e,Rg,t)}writePackedFixed64(e,t){t.length&&this.writeMessage(e,Dg,t)}writePackedSFixed64(e,t){t.length&&this.writeMessage(e,Fg,t)}writeBytesField(e,t){this.writeTag(e,2),this.writeBytes(t)}writeFixed32Field(e,t){this.writeTag(e,5),this.writeFixed32(t)}writeSFixed32Field(e,t){this.writeTag(e,5),this.writeSFixed32(t)}writeFixed64Field(e,t){this.writeTag(e,1),this.writeFixed64(t)}writeSFixed64Field(e,t){this.writeTag(e,1),this.writeSFixed64(t)}writeVarintField(e,t){this.writeTag(e,0),this.writeVarint(t)}writeSVarintField(e,t){this.writeTag(e,0),this.writeSVarint(t)}writeStringField(e,t){this.writeTag(e,2),this.writeString(t)}writeFloatField(e,t){this.writeTag(e,5),this.writeFloat(t)}writeDoubleField(e,t){this.writeTag(e,1),this.writeDouble(t)}writeBooleanField(e,t){this.writeVarintField(e,+t)}};function Ag(e,t,r){return r?4294967296*t+(e>>>0):4294967296*(t>>>0)+(e>>>0)}function Cg(e,t,r){const n=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));r.realloc(n);for(let i=r.pos-1;i>=e;i--)r.buf[i+n]=r.buf[i]}function Eg(e,t){for(let r=0;r<e.length;r++)t.writeVarint(e[r])}function Ng(e,t){for(let r=0;r<e.length;r++)t.writeSVarint(e[r])}function Ig(e,t){for(let r=0;r<e.length;r++)t.writeFloat(e[r])}function Pg(e,t){for(let r=0;r<e.length;r++)t.writeDouble(e[r])}function Mg(e,t){for(let r=0;r<e.length;r++)t.writeBoolean(e[r])}function Lg(e,t){for(let r=0;r<e.length;r++)t.writeFixed32(e[r])}function Rg(e,t){for(let r=0;r<e.length;r++)t.writeSFixed32(e[r])}function Dg(e,t){for(let r=0;r<e.length;r++)t.writeFixed64(e[r])}function Fg(e,t){for(let r=0;r<e.length;r++)t.writeSFixed64(e[r])}const Og=3;function zg(e,t,r){t.glyphs=[],1===e&&r.readMessage(Bg,t)}function Bg(e,t,r){if(3===e){const{id:e,bitmap:n,width:i,height:s,left:o,top:a,advance:l}=r.readMessage(Ug,{});t.glyphs.push({id:e,bitmap:new wd({width:i+2*Og,height:s+2*Og},n),metrics:{width:i,height:s,left:o,top:a,advance:l}})}else 4===e?t.ascender=r.readSVarint():5===e&&(t.descender=r.readSVarint())}function Ug(e,t,r){1===e?t.id=r.readVarint():2===e?t.bitmap=r.readBytes():3===e?t.width=r.readVarint():4===e?t.height=r.readVarint():5===e?t.left=r.readSVarint():6===e?t.top=r.readSVarint():7===e&&(t.advance=r.readVarint())}const Vg=Og,qg={horizontal:1,vertical:2,horizontalOnly:3};class Wg{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(e,t){const r=new Wg;return r.scale=e||1,r.fontStack=t,r}static forImage(e){const t=new Wg;return t.image=e,t}}class Hg{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(e,t,r){const n=new Hg;for(let i=0;i<e.sections.length;i++){const s=e.sections[i];s.image?n.addImageSection(s,r):n.addTextSection(s,t)}return n}length(){return this.text.length}getSection(e){return this.sections[this.sectionIndex[e]]}getSections(){return this.sections}getSectionIndex(e){return this.sectionIndex[e]}getCodePoint(e){return this.text.codePointAt(e)}verticalizePunctuation(e){this.text=function(e,t){let r="";for(let n=0;n<e.length;n++){const i=e.charCodeAt(n+1)||null,s=e.charCodeAt(n-1)||null;r+=!t&&(i&&lo(i)&&!xg[e[n+1]]||s&&lo(s)&&!xg[e[n-1]])||!xg[e[n]]?e[n]:xg[e[n]]}return r}(this.text,e)}trim(){let e=0;for(let r=0;r<this.text.length&&Zg[this.text.charCodeAt(r)];r++)e++;let t=this.text.length;for(let r=this.text.length-1;r>=0&&r>=e&&Zg[this.text.charCodeAt(r)];r--)t--;this.text=this.text.substring(e,t),this.sectionIndex=this.sectionIndex.slice(e,t)}substring(e,t){const r=new Hg;return r.text=this.text.substring(e,t),r.sectionIndex=this.sectionIndex.slice(e,t),r.sections=this.sections,r}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((e,t)=>Math.max(e,this.sections[t].scale),0)}addTextSection(e,t){this.text+=e.text,this.sections.push(Wg.forText(e.scale,e.fontStack||t));const r=this.sections.length-1;for(let n=0;n<e.text.length;++n)this.sectionIndex.push(r)}addImageSection(e,t){const r=e.image?e.image.getPrimary():null;if(!r)return void Ze("Can't add FormattedSection with an empty image.");r.scaleSelf(t);const n=this.getNextImageSectionCharCode();n?(this.text+=String.fromCodePoint(n),this.sections.push(Wg.forImage(r)),this.sectionIndex.push(this.sections.length-1)):Ze("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Gg(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m){let f=arguments.length>15&&void 0!==arguments[15]?arguments[15]:1;const g=Hg.fromFeature(e,i,f);d===qg.vertical&&g.verticalizePunctuation(h);let y=[];const _=function(e,t,r,n,i,s){if(!e)return[];const o=[],a=function(e,t,r,n,i,s){let o=0;for(let a=0;a<e.length();a++){const r=e.getSection(a);o+=Yg(e.getCodePoint(a),r,n,i,t,s)}return o/Math.max(1,Math.ceil(o/r))}(e,t,r,n,i,s),l=e.text.indexOf("\u200b")>=0;let c=0;for(let d=0;d<e.length();d++){const r=e.getSection(d),h=e.getCodePoint(d);if(Zg[h]||(c+=Yg(h,r,n,i,t,s)),d<e.length()-1){const t=!((u=h)<11904||!(no["Bopomofo Extended"](u)||no.Bopomofo(u)||no["CJK Compatibility Forms"](u)||no["CJK Compatibility Ideographs"](u)||no["CJK Compatibility"](u)||no["CJK Radicals Supplement"](u)||no["CJK Strokes"](u)||no["CJK Symbols and Punctuation"](u)||no["CJK Unified Ideographs Extension A"](u)||no["CJK Unified Ideographs"](u)||no["Enclosed CJK Letters and Months"](u)||no["Halfwidth and Fullwidth Forms"](u)||no.Hiragana(u)||no["Ideographic Description Characters"](u)||no["Kangxi Radicals"](u)||no["Katakana Phonetic Extensions"](u)||no.Katakana(u)||no["Vertical Forms"](u)||no["Yi Radicals"](u)||no["Yi Syllables"](u)));(Kg[h]||t||r.image)&&o.push(Qg(d+1,c,a,o,Jg(h,e.getCodePoint(d+1),t&&l),!1))}}var u;return $g(Qg(e.length(),c,a,o,0,!0))}(g,c,s,t,n,p),{processBidirectionalText:v,processStyledBidirectionalText:x}=jo;if(v&&1===g.sections.length){const e=v(g.toString(),_);for(const t of e){const e=new Hg;e.text=t,e.sections=g.sections;for(let r=0;r<t.length;r++)e.sectionIndex.push(0);y.push(e)}}else if(x){const e=x(g.text,g.sectionIndex,_);for(const t of e){const e=new Hg;e.text=t[0],e.sectionIndex=t[1],e.sections=g.sections,y.push(e)}}else y=function(e,t){const r=[],n=e.text;let i=0;for(const s of t)r.push(e.substring(i,s)),i=s;return i<n.length&&r.push(e.substring(i,n.length)),r}(g,_);const b=[],w={positionedLines:b,text:g.toString(),top:u[1],bottom:u[1],left:u[0],right:u[0],writingMode:d,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(e,t,r,n,i,s,o,a,l,c,u,d){let h=0,p=0,m=0;const f="right"===a?1:"left"===a?0:.5;let g=!1;for(const w of i){const e=w.getSections();for(const r of e){if(r.image)continue;const e=t[r.fontStack];if(e&&(g=void 0!==e.ascender&&void 0!==e.descender,!g))break}if(!g)break}let y=0;for(const w of i){w.trim();const i=w.getMaxScale(),o=(i-1)*_g,a={positionedGlyphs:[],lineOffset:0};e.positionedLines[y]=a;const v=a.positionedGlyphs;let x=0;if(!w.length()){p+=s,++y;continue}let b=0,j=0;for(let s=0;s<w.length();s++){const o=w.getSection(s),a=w.getSectionIndex(s),m=w.getCodePoint(s);let f=o.scale,y=null,S=null,T=null,k=_g,A=0,C=l;C===qg.vertical&&(12312===(_=m)||12313===_||12316===_||12540===_||12448===_)&&(C=qg.horizontal);const E=!(C===qg.horizontal||!u&&!ao(m)||u&&(Zg[m]||co(m)));if(o.image){const t=n.get(o.image.toString());if(!t)continue;T=o.image,e.iconsInText=e.iconsInText||!0,S=t.paddedRect;const r=t.displaySize;f=f*_g/d,y={width:r[0],height:r[1],left:0,top:-Vg,advance:E?r[1]:r[0],localGlyph:!1},A=g?-y.height*f:i*_g-17-r[1]*f,k=y.advance;const s=(E?r[0]:r[1])*f-_g*i;s>0&&s>x&&(x=s)}else{const e=r[o.fontStack];if(!e)continue;e[m]&&(S=e[m]);const n=t[o.fontStack];if(!n)continue;const s=n.glyphs[m];if(!s)continue;if(y=s.metrics,k=8203!==m?_g:0,g){const e=void 0!==n.ascender?Math.abs(n.ascender):0,t=void 0!==n.descender?Math.abs(n.descender):0,r=(e+t)*f;b<r&&(b=r,j=(e-t)/2*f),A=-e*f}else A=(i-f)*_g-17}E?(e.verticalizable=!0,v.push({glyph:m,image:T,x:h,y:p+A,vertical:E,scale:f,localGlyph:y.localGlyph,fontStack:o.fontStack,sectionIndex:a,metrics:y,rect:S}),h+=k*f+c):(v.push({glyph:m,image:T,x:h,y:p+A,vertical:E,scale:f,localGlyph:y.localGlyph,fontStack:o.fontStack,sectionIndex:a,metrics:y,rect:S}),h+=y.advance*f+c)}0!==v.length&&(m=Math.max(h-c,m),g?ty(v,f,x,j,s*i/2):ty(v,f,x,0,s/2)),h=0;const S=s*i+x;a.lineOffset=Math.max(x,o),p+=S,++y}var _;const v=p,{horizontalAlign:x,verticalAlign:b}=ey(o);(function(e,t,r,n,i,s){const o=(t-r)*i,a=-s*n;for(const l of e)for(const e of l.positionedGlyphs)e.x+=o,e.y+=a})(e.positionedLines,f,x,b,m,v),e.top+=-b*v,e.bottom=e.top+v,e.left+=-x*m,e.right=e.left+m,e.hasBaseline=g}(w,t,r,n,y,o,a,l,d,c,h,m),!function(e){for(const t of e)if(0!==t.positionedGlyphs.length)return!1;return!0}(b))return w}const Zg={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},Kg={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function Yg(e,t,r,n,i,s){if(t.image){const e=n.get(t.image.toString());return e?e.displaySize[0]*t.scale*_g/s+i:0}{const n=r[t.fontStack],s=n&&n.glyphs[e];return s?s.metrics.advance*t.scale+i:0}}function Xg(e,t,r,n){const i=Math.pow(e-t,2);return n?e<t?i/2:2*i:i+Math.abs(r)*r}function Jg(e,t,r){let n=0;return 10===e&&(n-=1e4),r&&(n+=150),40!==e&&65288!==e||(n+=50),41!==t&&65289!==t||(n+=50),n}function Qg(e,t,r,n,i,s){let o=null,a=Xg(t,r,i,s);for(const l of n){const e=Xg(t-l.x,r,i,s)+l.badness;e<=a&&(o=l,a=e)}return{index:e,x:t,priorBreak:o,badness:a}}function $g(e){return e?$g(e.priorBreak).concat(e.index):[]}function ey(e){let t=.5,r=.5;switch(e){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(e){case"bottom":case"bottom-right":case"bottom-left":r=1;break;case"top":case"top-right":case"top-left":r=0}return{horizontalAlign:t,verticalAlign:r}}function ty(e,t,r,n,i){if(!(t||r||n||i))return;const s=e.length-1,o=e[s],a=(o.x+o.metrics.advance*o.scale)*t;for(let l=0;l<=s;l++)e[l].x-=a,e[l].y+=r+n+i}function ry(e){return void 0!==e.imagePrimary&&void 0!==e.top&&void 0!==e.bottom&&void 0!==e.left&&void 0!==e.right}function ny(e,t,r,n){const{horizontalAlign:i,verticalAlign:s}=ey(n),o=r[0]-e.displaySize[0]*i,a=r[1]-e.displaySize[1]*s;return{imagePrimary:e,imageSecondary:t,top:a,bottom:a+e.displaySize[1],left:o,right:o+e.displaySize[0]}}function iy(e,t,r,n,i,s){const o=e.imagePrimary;let a;if(o.content){const e=o.content,t=o.pixelRatio||1;a=[e[0]/t,e[1]/t,o.displaySize[0]-e[2]/t,o.displaySize[1]-e[3]/t]}const l=t.left*s,c=t.right*s;let u,d,h,p;"width"===r||"both"===r?(p=i[0]+l-n[3],d=i[0]+c+n[1]):(p=i[0]+(l+c-o.displaySize[0])/2,d=p+o.displaySize[0]);const m=t.top*s,f=t.bottom*s;return"height"===r||"both"===r?(u=i[1]+m-n[0],h=i[1]+f+n[2]):(u=i[1]+(m+f-o.displaySize[1])/2,h=u+o.displaySize[1]),{imagePrimary:o,imageSecondary:void 0,top:u,right:d,bottom:h,left:p,collisionPadding:a}}function sy(e){return!e.imagePrimary.stretchX}function oy(e){return!e.imagePrimary.stretchY}function ay(e){return{width:e.right-e.left,height:e.bottom-e.top}}const ly=128;function cy(e,t,r){const{expression:n}=t;if("constant"===n.kind)return{kind:"constant",layoutSize:n.evaluate(new So(e+1,{worldview:r}))};if("source"===n.kind)return{kind:"source"};{const{zoomStops:t,interpolationType:i}=n;let s=0;for(;s<t.length&&t[s]<=e;)s++;s=Math.max(0,s-1);let o=s;for(;o<t.length&&t[o]<e+1;)o++;o=Math.min(t.length-1,o);const a=t[s],l=t[o];return"composite"===n.kind?{kind:"composite",minZoom:a,maxZoom:l,interpolationType:i}:{kind:"camera",minZoom:a,maxZoom:l,minSize:n.evaluate(new So(a,{worldview:r})),maxSize:n.evaluate(new So(l,{worldview:r})),interpolationType:i}}}function uy(e,t,r){let{uSize:n,uSizeT:i}=t,{lowerSize:s,upperSize:o}=r;return"source"===e.kind?s/ly:"composite"===e.kind?hr(s/ly,o/ly,i):n}function dy(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1,n=0,i=0;if("constant"===e.kind)i=e.layoutSize*r;else if("source"!==e.kind){const{interpolationType:s,minZoom:o,maxZoom:a}=e,l=s?Le(Zi.interpolationFactor(s,t,o,a),0,1):0;"camera"===e.kind?i=hr(e.minSize,e.maxSize,l)*r:n=l*r}return{uSizeT:n,uSize:i}}class hy extends Se{constructor(e,t,r,n,i){super(e,t),this.angle=n,this.z=r,void 0!==i&&(this.segment=i)}clone(){return new hy(this.x,this.y,this.z,this.angle,this.segment)}}function py(e,t,r,n,i){if(void 0===t.segment)return!0;let s=t,o=t.segment+1,a=0;for(;a>-r/2;){if(o--,o<0)return!1;a-=e[o].dist(s),s=e[o]}a+=e[o].dist(e[o+1]),o++;const l=[];let c=0;for(;a<r/2;){const t=e[o],r=e[o+1];if(!r)return!1;let s=e[o-1].angleTo(t)-t.angleTo(r);for(s=Math.abs((s+3*Math.PI)%(2*Math.PI)-Math.PI),l.push({distance:a,angleDelta:s}),c+=s;a-l[0].distance>n;)c-=l.shift().angleDelta;if(c>i)return!1;o++,a+=t.dist(r)}return!0}function my(e){let t=0;for(let r=0;r<e.length-1;r++)t+=e[r].dist(e[r+1]);return t}function fy(e,t,r){return e?.6*t*r:0}function gy(e,t){return Math.max(e?e.right-e.left:0,t?t.right-t.left:0)}function yy(e,t,r,n,i,s){const o=fy(r,i,s),a=gy(r,n)*s;let l=0;const c=my(e)/2;for(let u=0;u<e.length-1;u++){const r=e[u],n=e[u+1],i=r.dist(n);if(l+i>c){const s=(c-l)/i,d=hr(r.x,n.x,s),h=hr(r.y,n.y,s),p=new hy(d,h,0,n.angleTo(r),u);return!o||py(e,p,a,o,t)?p:void 0}l+=i}}function _y(e,t,r,n,i,s,o,a,l){const c=fy(n,s,o),u=gy(n,i),d=u*o,h=0===e[0].x||e[0].x===l||0===e[0].y||e[0].y===l;return t-d<t/4&&(t=d+t/4),vy(e,h?t/2*a%t:(u/2+2*s)*o*a%t,t,c,r,d,h,!1,l)}function vy(e,t,r,n,i,s,o,a,l){const c=s/2,u=my(e);let d=0,h=t-r,p=[];for(let m=0;m<e.length-1;m++){const t=e[m],o=e[m+1],a=t.dist(o),f=o.angleTo(t);for(;h+r<d+a;){h+=r;const g=(h-d)/a,y=hr(t.x,o.x,g),_=hr(t.y,o.y,g);if(y>=0&&y<l&&_>=0&&_<l&&h-c>=0&&h+c<=u){const t=new hy(y,_,0,f,m);n&&!py(e,t,s,n,i)||p.push(t)}}d+=a}return a||p.length||o||(p=vy(e,d/2,r,n,i,s,o,!0,l)),p}function xy(e){let t=0,r=0;for(const o of e)t+=o.w*o.h,r=Math.max(r,o.w);e.sort((e,t)=>t.h-e.h);const n=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),r),h:1/0}];let i=0,s=0;for(const o of e)for(let e=n.length-1;e>=0;e--){const t=n[e];if(!(o.w>t.w||o.h>t.h)){if(o.x=t.x,o.y=t.y,s=Math.max(s,o.y+o.h),i=Math.max(i,o.x+o.w),o.w===t.w&&o.h===t.h){const t=n.pop();t&&e<n.length&&(n[e]=t)}else o.h===t.h?(t.x+=o.w,t.w-=o.w):o.w===t.w?(t.y+=o.h,t.h-=o.h):(n.push({x:t.x+o.w,y:t.y,w:t.w-o.w,h:o.h}),t.y+=o.h,t.h-=o.h);break}}return{w:i,h:s,fill:t/(i*s)||0}}$s(hy,"Anchor");const by=1;class wy{static getImagePositionScale(e,t,r){if(t&&e){const{sx:t,sy:r}=e;return{x:t,y:r}}return{x:r,y:r}}constructor(e,t,r,n){this.paddedRect=e;const{pixelRatio:i,version:s,stretchX:o,stretchY:a,content:l,sdf:c,usvg:u}=t;this.pixelRatio=i,this.stretchX=o,this.stretchY=a,this.content=l,this.version=s,this.padding=r,this.sdf=c,this.usvg=u,this.scale=wy.getImagePositionScale(n,u,i)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function jy(e,t,r){const n=Fr.parse(e),i=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[1,1];return{x:0,y:0,w:(e.data?e.data.width:e.width*r[0])+2*t,h:(e.data?e.data.height:e.height*r[1])+2*t}}(t,r,[n.sx,n.sy]);return{bin:i,imagePosition:new wy(i,t,r,n),imageVariant:n}}class Sy{constructor(e,t,r){const n=new Map,i=new Map;this.haveRenderCallbacks=[];const s=[];this.addImages(e,n,by,s),this.addImages(t,i,2,s);const{w:o,h:a}=xy(s),l=new jd({width:o||1,height:a||1});for(const[c,u]of e.entries()){const e=n.get(c).paddedRect;jd.copy(u.data,l,{x:0,y:0},{x:e.x+by,y:e.y+by},u.data,null,u.sdf)}for(const[c,u]of t.entries()){const e=i.get(c),t=e.paddedRect;let n=e.padding;const s=t.x+n,o=t.y+n,a=u.data.width,d=u.data.height;n=n>1?n-1:n,jd.copy(u.data,l,{x:0,y:0},{x:s,y:o},u.data,r),jd.copy(u.data,l,{x:0,y:d-n},{x:s,y:o-n},{width:a,height:n},r),jd.copy(u.data,l,{x:0,y:0},{x:s,y:o+d},{width:a,height:n},r),jd.copy(u.data,l,{x:a-n,y:0},{x:s-n,y:o},{width:n,height:d},r),jd.copy(u.data,l,{x:0,y:0},{x:s+a,y:o},{width:n,height:d},r),jd.copy(u.data,l,{x:a-n,y:d-n},{x:s-n,y:o-n},{width:n,height:n},r),jd.copy(u.data,l,{x:0,y:d-n},{x:s+a,y:o-n},{width:n,height:n},r),jd.copy(u.data,l,{x:0,y:0},{x:s+a,y:o+d},{width:n,height:n},r),jd.copy(u.data,l,{x:a-n,y:0},{x:s-n,y:o+d},{width:n,height:n},r)}this.lut=r,this.image=l,this.iconPositions=n,this.patternPositions=i}addImages(e,t,r,n){for(const[i,s]of e.entries()){const{bin:e,imagePosition:o,imageVariant:a}=jy(i,s,r);t.set(i,o),n.push(e),s.hasRenderCallback&&this.haveRenderCallbacks.push(a.id)}}patchUpdatedImages(e,t,r){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(t=>e.hasImage(t,r)),e.dispatchRenderCallbacks(this.haveRenderCallbacks,r);for(const n of e.getUpdatedImages(r)){for(const i of this.iconPositions.keys()){const s=Fr.parse(i);if(ir.isEqual(s.id,n)){const s=e.getImage(n,r);this.patchUpdatedImage(this.iconPositions.get(i),s,t,null)}}for(const i of this.patternPositions.keys()){const s=Fr.parse(i);if(ir.isEqual(s.id,n)){const s=e.getImage(n,r);this.patchUpdatedImage(this.patternPositions.get(i),s,t,this.lut)}}}}patchUpdatedImage(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;if(!e||!t)return;if(e.version===t.version)return;e.version=t.version;const[i,s]=e.tl,o=e.sdf;if(this.lut||o){const e={width:t.data.width,height:t.data.height},a=new jd(e);jd.copy(t.data,a,{x:0,y:0},{x:0,y:0},e,n,o),r.update(a,{position:{x:i,y:s}})}else r.update(t.data,{position:{x:i,y:s}})}}$s(wy,"ImagePosition"),$s(Sy,"ImageAtlas");const Ty=1e20;function ky(e,t,r,n,i,s,o,a,l){for(let c=t;c<t+n;c++)Ay(e,r*s+c,s,i,o,a,l);for(let c=r;c<r+i;c++)Ay(e,c*s+t,1,n,o,a,l)}function Ay(e,t,r,n,i,s,o){s[0]=0,o[0]=-Ty,o[1]=Ty,i[0]=e[t];for(let a=1,l=0,c=0;a<n;a++){i[a]=e[t+a*r];const n=a*a;do{const e=s[l];c=(i[a]-i[e]+n-e*e)/(a-e)/2}while(c<=o[l]&&--l>-1);l++,s[l]=a,o[l]=c,o[l+1]=Ty}for(let a=0,l=0;a<n;a++){for(;o[l+1]<a;)l++;const n=s[l],c=a-n;e[t+a*r]=i[n]+c*c}}const Cy=2,Ey={none:0,ideographs:1,all:2};class Ny{constructor(e,t,r){this.requestManager=e,this.localGlyphMode=t,this.localFontFamily=r,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(e){this.url=e}getGlyphs(e,t){const r=[],n=this.url||ot.GLYPHS_URL;for(const i in e)for(const t of e[i])r.push({stack:i,id:t});Fe(r,(e,t)=>{let{stack:r,id:i}=e,s=this.entries[r];s||(s=this.entries[r]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let o=s.glyphs[i];if(void 0!==o)return void t(null,{stack:r,id:i,glyph:o});if(o=this._tinySDF(s,r,i),o)return s.glyphs[i]=o,void t(null,{stack:r,id:i,glyph:o});const a=Math.floor(i/256);if(256*a>65535)return Ze("glyphs > 65535 not supported"),void t(null,{stack:r,id:i,glyph:o});if(s.ranges[a])return void t(null,{stack:r,id:i,glyph:o});let l=s.requests[a];l||(l=s.requests[a]=[],Ny.loadGlyphRange(r,a,n,this.requestManager,(e,t)=>{if(t){s.ascender=t.ascender,s.descender=t.descender;for(const e in t.glyphs)this._doesCharSupportLocalGlyph(+e)||(s.glyphs[+e]=t.glyphs[+e]);s.ranges[a]=!0}for(const r of l)r(e,t);delete s.requests[a]})),l.push((e,n)=>{e?t(e):n&&t(null,{stack:r,id:i,glyph:n.glyphs[i]||null})})},(e,r)=>{if(e)t(e);else if(r){const e={};for(const{stack:t,id:n,glyph:i}of r)void 0===e[t]&&(e[t]={}),void 0===e[t].glyphs&&(e[t].glyphs={}),e[t].glyphs[n]=i&&{id:i.id,bitmap:i.bitmap.clone(),metrics:i.metrics},e[t].ascender=this.entries[t].ascender,e[t].descender=this.entries[t].descender;t(null,e)}})}_doesCharSupportLocalGlyph(e){return this.localGlyphMode!==Ey.none&&(this.localGlyphMode===Ey.all?!!this.localFontFamily:!!this.localFontFamily&&(no["CJK Unified Ideographs"](e)||no["Hangul Syllables"](e)||no.Hiragana(e)||no.Katakana(e)||no["CJK Symbols and Punctuation"](e)||no["CJK Unified Ideographs Extension A"](e)||no["CJK Unified Ideographs Extension B"](e)||no.Osage(e)))}_tinySDF(e,t,r){const n=this.localFontFamily;if(!n||!this._doesCharSupportLocalGlyph(r))return;let i=e.tinySDF;if(!i){let r="400";/bold/i.test(t)?r="900":/medium/i.test(t)?r="500":/light/i.test(t)&&(r="200"),i=e.tinySDF=new Ny.TinySDF({fontFamily:n,fontWeight:r,fontSize:24*Cy,buffer:3*Cy,radius:8*Cy}),i.fontWeight=r}if(this.localGlyphs[i.fontWeight][r])return this.localGlyphs[i.fontWeight][r];const s=String.fromCodePoint(r),{data:o,width:a,height:l,glyphWidth:c,glyphHeight:u,glyphLeft:d,glyphTop:h,glyphAdvance:p}=i.draw(s);return this.localGlyphs[i.fontWeight][r]={id:r,bitmap:new wd({width:a,height:l},o),metrics:{width:c/Cy,height:u/Cy,left:d/Cy,top:h/Cy-27,advance:p/Cy,localGlyph:!0}}}}Ny.loadGlyphRange=function(e,t,r,n,i){const s=256*t,o=s+255,a=n.transformRequest(n.normalizeGlyphsURL(r).replace("{fontstack}",e).replace("{range}","".concat(s,"-").concat(o)),Rt.Glyphs);zt(a,(e,t)=>{if(e)i(e);else if(t){const e={},r=function(e){return new kg(e).readFields(zg,{})}(t);for(const t of r.glyphs)e[t.id]=t;i(null,{glyphs:e,ascender:r.ascender,descender:r.descender})}})},Ny.TinySDF=class{constructor(){let{fontSize:e=24,buffer:t=3,radius:r=8,cutoff:n=.25,fontFamily:i="sans-serif",fontWeight:s="normal",fontStyle:o="normal",lang:a=null}=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.buffer=t,this.cutoff=n,this.radius=r,this.lang=a;const l=this.size=e+4*t,c=this._createCanvas(l),u=this.ctx=c.getContext("2d",{willReadFrequently:!0});u.font="".concat(o," ").concat(s," ").concat(e,"px ").concat(i),u.textBaseline="alphabetic",u.textAlign="left",u.fillStyle="black",this.gridOuter=new Float64Array(l*l),this.gridInner=new Float64Array(l*l),this.f=new Float64Array(l),this.z=new Float64Array(l+1),this.v=new Uint16Array(l)}_createCanvas(e){const t=document.createElement("canvas");return t.width=t.height=e,t}draw(e){const{width:t,actualBoundingBoxAscent:r,actualBoundingBoxDescent:n,actualBoundingBoxLeft:i,actualBoundingBoxRight:s}=this.ctx.measureText(e),o=Math.ceil(r),a=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(s-i))),l=Math.min(this.size-this.buffer,o+Math.ceil(n)),c=a+2*this.buffer,u=l+2*this.buffer,d=Math.max(c*u,0),h=new Uint8ClampedArray(d),p={data:h,width:c,height:u,glyphWidth:a,glyphHeight:l,glyphTop:o,glyphLeft:0,glyphAdvance:t};if(0===a||0===l)return p;const{ctx:m,buffer:f,gridInner:g,gridOuter:y}=this;this.lang&&(m.lang=this.lang),m.clearRect(f,f,a,l),m.fillText(e,f,f+o);const _=m.getImageData(f,f,a,l);y.fill(Ty,0,d),g.fill(0,0,d);for(let v=0;v<l;v++)for(let e=0;e<a;e++){const t=_.data[4*(v*a+e)+3]/255;if(0===t)continue;const r=(v+f)*c+e+f;if(1===t)y[r]=0,g[r]=Ty;else{const e=.5-t;y[r]=e>0?e*e:0,g[r]=e<0?e*e:0}}ky(y,0,0,c,u,c,this.f,this.v,this.z),ky(g,f,f,a,l,c,this.f,this.v,this.z);for(let v=0;v<d;v++){const e=Math.sqrt(y[v])-Math.sqrt(g[v]);h[v]=Math.round(255-255*(e/this.radius+this.cutoff))}return p}};const Iy=by;function Py(e,t){return e+t[1]-t[0]}function My(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const s=[],o=e.imagePrimary,a=o.pixelRatio,l=o.paddedRect.w-2*Iy,c=o.paddedRect.h-2*Iy,u=(e.right-e.left)*i,d=(e.bottom-e.top)*i,h=o.stretchX||[[0,l]],p=o.stretchY||[[0,c]],m=h.reduce(Py,0),f=p.reduce(Py,0),g=l-m,y=c-f;let _=0,v=m,x=0,b=f,w=0,j=g,S=0,T=y;if(o.content&&n){const e=o.content;_=Ry(h,0,e[0]),x=Ry(p,0,e[1]),v=Ry(h,e[0],e[2]),b=Ry(p,e[1],e[3]),w=e[0]-_,S=e[1]-x,j=e[2]-e[0]-v,T=e[3]-e[1]-b}const k=(n,s,l,c)=>{const h=Oy(n.stretch-_,v,u,e.left*i),p=zy(n.fixed-w,j,n.stretch,m),g=Oy(s.stretch-x,b,d,e.top*i),y=zy(s.fixed-S,T,s.stretch,f),k=Oy(l.stretch-_,v,u,e.left*i),A=zy(l.fixed-w,j,l.stretch,m),C=Oy(c.stretch-x,b,d,e.top*i),E=zy(c.fixed-S,T,c.stretch,f),N=new Se(h,g),I=new Se(k,g),P=new Se(k,C),M=new Se(h,C),L=new Se(p/a,y/a),R=new Se(A/a,E/a),D=t*Math.PI/180;if(D){const e=Math.sin(D),t=Math.cos(D),r=[t,-e,e,t];N._matMult(r),I._matMult(r),M._matMult(r),P._matMult(r)}const F=n.stretch+n.fixed,O=l.stretch+l.fixed,z=s.stretch+s.fixed,B=c.stretch+c.fixed,U=e.imageSecondary;return{tl:N,tr:I,bl:M,br:P,texPrimary:{x:o.paddedRect.x+Iy+F,y:o.paddedRect.y+Iy+z,w:O-F,h:B-z},texSecondary:U?{x:U.paddedRect.x+Iy+F,y:U.paddedRect.y+Iy+z,w:O-F,h:B-z}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:L,pixelOffsetBR:R,minFontScaleX:j/a/u,minFontScaleY:T/a/d,isSDF:r}};if(n&&(o.stretchX||o.stretchY)){const e=Dy(h,g,m),t=Dy(p,y,f);for(let r=0;r<e.length-1;r++){const n=e[r],i=e[r+1];for(let e=0;e<t.length-1;e++)s.push(k(n,t[e],i,t[e+1]))}}else s.push(k({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:l+1},{fixed:0,stretch:c+1}));return s}function Ly(e,t){const r=e.stretchY||[[0,e.paddedRect.h-2*Iy]];return t&&(e.stretchX||e.stretchY)?Fy(e.stretchX||[[0,e.paddedRect.w-2*Iy]])*Fy(r):1}function Ry(e,t,r){let n=0;for(const i of e)n+=Math.max(t,Math.min(r,i[1]))-Math.max(t,Math.min(r,i[0]));return n}function Dy(e,t,r){const n=[{fixed:-Iy,stretch:0}];for(const[i,s]of e){const e=n[n.length-1];n.push({fixed:i-e.stretch,stretch:e.stretch}),n.push({fixed:i-e.stretch,stretch:e.stretch+(s-i)})}return n.push({fixed:t+Iy,stretch:r}),n}function Fy(e){return 2*e.length+1}function Oy(e,t,r,n){return e/t*r+n}function zy(e,t,r,n){return e-t*r/n}function By(e,t,r,n){const i=t+e.positionedLines[n].lineOffset;return 0===n?r+i/2:r+(i+(t+e.positionedLines[n-1].lineOffset))/2}function Uy(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=1/0,i=1/0,s=-1/0,o=-1/0;const a=e[0];for(let p=0;p<a.length;p++){const e=a[p];(!p||e.x<n)&&(n=e.x),(!p||e.y<i)&&(i=e.y),(!p||e.x>s)&&(s=e.x),(!p||e.y>o)&&(o=e.y)}const l=Math.min(s-n,o-i);let c=l/2;const u=new zn([],Vy);if(0===l)return new Se(n,i);for(let p=n;p<s;p+=l)for(let t=i;t<o;t+=l)u.push(new qy(p+c,t+c,c,e));let d=function(e){let t=0,r=0,n=0;const i=e[0];for(let s=0,o=i.length,a=o-1;s<o;a=s++){const e=i[s],o=i[a],l=e.x*o.y-o.x*e.y;r+=(e.x+o.x)*l,n+=(e.y+o.y)*l,t+=3*l}return new qy(r/t,n/t,0,e)}(e),h=u.length;for(;u.length;){const n=u.pop();(n.d>d.d||!d.d)&&(d=n,r&&console.log("found best %d after %d probes",Math.round(1e4*n.d)/1e4,h)),n.max-d.d<=t||(c=n.h/2,u.push(new qy(n.p.x-c,n.p.y-c,c,e)),u.push(new qy(n.p.x+c,n.p.y-c,c,e)),u.push(new qy(n.p.x-c,n.p.y+c,c,e)),u.push(new qy(n.p.x+c,n.p.y+c,c,e)),h+=4)}return r&&(console.log("num probes: ".concat(h)),console.log("best distance: ".concat(d.d))),d.p}function Vy(e,t){return t.max-e.max}class qy{constructor(e,t,r,n){this.p=new Se(e,t),this.h=r,this.d=function(e,t){let r=!1,n=1/0;for(let i=0;i<t.length;i++){const s=t[i];for(let t=0,i=s.length,o=i-1;t<i;o=t++){const i=s[t],a=s[o];i.y>e.y!=a.y>e.y&&e.x<(a.x-i.x)*(e.y-i.y)/(a.y-i.y)+i.x&&(r=!r),n=Math.min(n,pu(e,i,a))}}return(r?1:-1)*Math.sqrt(n)}(this.p,n),this.max=this.d+this.h*Math.SQRT2}}const Wy=Object.keys,Hy=Number.POSITIVE_INFINITY,Gy=Math.sqrt(2);function Zy(e,t,r,n,i){const s=ry(e)&&e.collisionPadding?e.collisionPadding:[0,0,0,0],o={top:e.top-s[1],bottom:e.bottom+s[3],left:e.left-s[0],right:e.right+s[2],scaled:!1};return void 0!==n&&function(e,t){e.top*=t,e.bottom*=t,e.left*=t,e.right*=t,e.scaled=!0}(o,n),r&&function(e,t){if(!t)return;const r=Ce(t),n=new Se(e.left,e.top),i=new Se(e.right,e.top),s=new Se(e.left,e.bottom),o=new Se(e.right,e.bottom),a=new Se(0,0);n._rotateAround(r,a),i._rotateAround(r,a),s._rotateAround(r,a),o._rotateAround(r,a),e.left=Math.min(n.x,i.x,s.x,o.x),e.right=Math.max(n.x,i.x,s.x,o.x),e.top=Math.min(n.y,i.y,s.y,o.y),e.bottom=Math.max(n.y,i.y,s.y,o.y)}(o,r),i&&(o.left+=i[0],o.right+=i[0],o.top+=i[1],o.bottom+=i[1]),t?{top:Math.min(t.top,o.top),bottom:Math.max(t.bottom,o.bottom),left:Math.min(t.left,o.left),right:Math.max(t.right,o.right),scaled:t.scaled||o.scaled}:o}function Ky(e,t){let[r,n]=t,i=0,s=0;if(n===Hy){r<0&&(r=0);const t=r/Gy;switch(e){case"top-right":case"top-left":s=t-7;break;case"bottom-right":case"bottom-left":s=7-t;break;case"bottom":s=7-r;break;case"top":s=r-7}switch(e){case"top-right":case"bottom-right":i=-t;break;case"top-left":case"bottom-left":i=t;break;case"left":i=r;break;case"right":i=-r}}else{switch(r=Math.abs(r),n=Math.abs(n),e){case"top-right":case"top-left":case"top":s=n-7;break;case"bottom-right":case"bottom-left":case"bottom":s=7-n}switch(e){case"top-right":case"bottom-right":case"right":i=-r;break;case"top-left":case"bottom-left":case"left":i=r}}return[i,s]}function Yy(e,t,r,n,i,s,o,a,l,c,u,d,h,p){const m=e.layers[0],f=m.appearances;if(0===f.length)return{iconBBox:null,iconVerticalBBox:null,textBBox:null,textVerticalBBox:null};const g={iconBBox:null,iconVerticalBBox:null},y={textBBox:null,textVerticalBBox:null},{baseIconRotate:_,baseTextRotate:v,iconScaleFactor:x}=function(e,t,r){const n=e.get("icon-rotate").evaluate(t,{},r),i=e.get("text-rotate").evaluate(t,{},r),[s,o]=e.get("icon-size-scale-range");return{baseIconRotate:n,baseTextRotate:i,iconScaleFactor:Le(1,s,o)}}(n,i,s);t&&(g.iconBBox=Zy(t,g.iconBBox,_,o),r)&&(g.iconVerticalBBox=Zy(r,g.iconVerticalBBox,_+90,o));const b=d_(d.horizontal);b&&(y.textBBox=Zy(b,y.textBBox,v,1,p)),d.vertical&&(y.textVerticalBBox=Zy(d.vertical,y.textVerticalBBox,v+90,1,p));for(const w of f)w.hasIconProperties()&&Xy(g,e,m,w,i,s,a,_,o,l,t,c,x,u),w.hasTextProperties()&&Jy(y,m,w,i,s,p,v,h,b,d.vertical);return{iconBBox:g.iconBBox,iconVerticalBBox:g.iconVerticalBBox,textBBox:y.textBBox,textVerticalBBox:y.textVerticalBBox}}function Xy(e,t,r,n,i,s,o,a,l,c,u,d,h,p){const{appearanceIconOffset:m,appearanceIconRotate:f,appearanceIconSize:g}=function(e,t,r,n,i,s,o,a){const l=e.hasProperty("icon-offset")?t.getAppearanceValueAndResolveTokens(e,"icon-offset",r,n,[]):null,c=l&&Array.isArray(l)?l:i,u=e.hasProperty("icon-rotate")?t.getAppearanceValueAndResolveTokens(e,"icon-rotate",r,n,[]):null,d="number"==typeof u?u:s,h=e.hasProperty("icon-size")?t.getAppearanceValueAndResolveTokens(e,"icon-size",r,n,[]):null;return{appearanceIconOffset:c,appearanceIconRotate:d,appearanceIconSize:"number"==typeof h?h*a.iconScaleFactor:o}}(n,r,i,s,o,a,l,c);let y=null,_=null,v=null;n.hasProperty("icon-image")?v=function(e,t,r,n,i,s,o){let a=null;const l=t.getAppearanceValueAndResolveTokens(r,"icon-image",n,i,[]);if(l){const t=e.getResolvedImageFromTokens(l),c=r.getUnevaluatedProperty("icon-size"),u=e_(t,cy(e.zoom,c,e.worldview),c,i,e.zoom,n,e.pixelRatio,o,e.worldview);a=s.get(u.iconPrimary.toString())}return a}(t,r,n,i,s,d,h):u&&(v=u.imagePrimary),v&&(y=ny(v,null,m,p),t.allowVerticalPlacement&&(_=ny(v,null,m,p))),y&&(e.iconBBox=Zy(y,e.iconBBox,f,g)),_&&(e.iconVerticalBBox=Zy(_,e.iconVerticalBBox,f+90,g))}function Jy(e,t,r,n,i,s,o,a,l,c){const{appearanceTextOffset:u,appearanceTextRotate:d,appearanceTextSize:h}=function(e,t,r,n,i,s,o){const a=e.hasProperty("text-offset")?t.getAppearanceValueAndResolveTokens(e,"text-offset",r,n,[]):null,l=a&&Array.isArray(a)?[a[0]*_g,a[1]*_g]:i,c=e.hasProperty("text-rotate")?t.getAppearanceValueAndResolveTokens(e,"text-rotate",r,n,[]):null,u="number"==typeof c?c:s,d=e.hasProperty("text-size")?t.getAppearanceValueAndResolveTokens(e,"text-size",r,n,[]):null;return{appearanceTextOffset:l,appearanceTextRotate:u,appearanceTextSize:"number"==typeof d?d:o}}(r,t,n,i,s,o,a),p=h/a;l&&(e.textBBox=Zy(l,e.textBBox,d,p,u)),c&&(e.textVerticalBBox=Zy(c,e.textVerticalBBox,d+90,p,u))}function Qy(e,t,r,n,i,s,o,a,l){if(!t||!t.usvg)return;const c=ay(n),u=ay(i),d="both"!==s&&"width"!==s||!sy(n)?1:u.width/c.width,h="both"!==s&&"height"!==s||!oy(n)?1:u.height/c.height;r.scaleSelf(d,h);const p=r.toString();o.set(p,r),a.set(p,t);const{imagePosition:m}=jy(p,t,by);l.set(p,m)}function $y(e,t,r,n,i,s,o,a,l){if(!e)return;const c=function(e,t,r,n,i,s){if("camera"===e.kind)return e.maxSize;if("composite"===e.kind){const n=t.possiblyEvaluate(new So(e.maxZoom,{worldview:s}),r).evaluate(i,{},r),o=t.possiblyEvaluate(new So(e.minZoom,{worldview:s}),r).evaluate(i,{},r);return Math.max(n,o)}return t.possiblyEvaluate(new So(n,{worldview:s})).evaluate(i,{},r)}(t,r,n,i,s,l);return e.scaleSelf(c*a*o)}function e_(e,t,r,n,i,s,o,a,l){return{iconPrimary:$y(e.getPrimary(),t,r,n,i,s,o,a,l),iconSecondary:$y(e.getSecondary(),t,r,n,i,s,o,a,l)}}function t_(e,t,r){if(!t)return;const n=r.get(e.toString()),i=r.get(t.toString());n&&i&&(n.paddedRect.w===i.paddedRect.w&&n.paddedRect.h===i.paddedRect.h||Ze("Mismatch in icon variant sizes: ".concat(e.toString()," and ").concat(t.toString())),n.usvg!==i.usvg&&Ze("Mismatch in icon variant image types: ".concat(e.id," and ").concat(t.id)))}function r_(e,t,r,n){if(!e)return;const i=t.get(r.toString());if(e.imagePrimary=i,n){const r=t.get(n.toString());e.imageSecondary=r}}function n_(e,t){for(const r in e.horizontal)i_(e.horizontal[r],t);i_(e.vertical,t)}function i_(e,t){if(e)for(const r of e.positionedLines)for(const e of r.positionedGlyphs)if(null!==e.image){const r=e.image.toString();e.rect=t.get(r).paddedRect}}function s_(e){switch(e){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function o_(e,t,r,n,i,s,o,a,l){const c=d_(s.horizontal)||s.vertical,u=r.get("icon-text-fit-padding").evaluate(n,{},i);let d,h=t;return t&&"none"!==l&&(e.allowVerticalPlacement&&s.vertical&&(d=iy(t,s.vertical,l,u,a,o)),c&&(h=iy(t,c,l,u,a,o))),{defaultShapedIcon:h,verticallyShapedIcon:d}}function a_(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b,w,j){let S=o.textMaxSize.evaluate(t,{},h);void 0===S?S=a*o.textScaleFactor:S*=o.textScaleFactor;const T=e.layers[0].layout,k=_g,A=a*o.textScaleFactor/k,C=d_(r.horizontal)||r.vertical;if("none"!==g&&e.appearanceFeatureData&&t.index<e.appearanceFeatureData.length){const r=e.appearanceFeatureData[t.index];r&&(r.textShaping=C,r.iconTextFitPadding=T.get("icon-text-fit-padding").evaluate(t,{},h),r.fontScale=A)}const E="globe"===p.name,N=e.tilePixelRatio*S/k,I=(F=e.overscaling,e.zoom>18&&F>2&&(F>>=1),Math.max(Bn/(512*F),1)*T.get("symbol-spacing")),P=T.get("text-padding")*e.tilePixelRatio,M=T.get("icon-padding")*e.tilePixelRatio,L=Ce(T.get("text-max-angle")),R="map"===T.get("icon-rotation-alignment")&&"point"!==v,D=I/2;var F;!1===e.hasAnyIconTextFit&&"none"!==g&&(e.hasAnyIconTextFit=!0);const O=t.properties?+t.properties[Fc]:null,z=O&&e.elevationFeatureIdToIndex?e.elevationFeatureIdToIndex.get(O):65535,B=(a,l,v)=>{if(l.x<0||l.x>=Bn||l.y<0||l.y>=Bn)return;let j=null;if(E){const{x:e,y:t,z:r}=p.projectTilePoint(l.x,l.y,v);j={anchor:new hy(e,t,r,0,void 0),up:p.upVector(v,l.x,l.y)}}!function(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b,w,j,S,T,k,A,C,E,N,I){const P=e.addToLineVertexArray(t,n);let M,L,R,D,F,O,z,B=0,U=0,V=0,q=0,W=-1,H=-1;const G={};let Z=Qt("");const K=r?r.anchor:t,Y="none"!==A;let X=0,J=0;if(void 0===l._unevaluatedLayout.getValue("text-radial-offset")){const e=l.layout.get("text-offset").evaluate(x,{},S);X=e[0]*_g,J=e[1]*_g}else X=l.layout.get("text-radial-offset").evaluate(x,{},S)*_g,J=Hy;if(e.allowVerticalPlacement&&i.vertical){const e=i.vertical;if(m)O=p_(e),a&&(z=p_(a));else{const r=l.layout.get("text-rotate").evaluate(x,{},S)+90;R=h_(c,K,t,u,d,h,e,p,r,f,I),a&&(D=h_(c,K,t,u,d,h,a,y,r,null,N))}}if(s){const n=e.iconSizeData,i=l.layout.get("icon-rotate").evaluate(x,{},S),o=My(s,i,w,Y,b.iconScaleFactor),p=a?My(a,i,w,Y,b.iconScaleFactor):void 0;L=h_(c,K,t,u,d,h,s,y,i,null,E);const m=function(e,t,r,n,i,s,o,a){const l=e.layers[0],c=l.appearances;let u=t.length;if(r&&(u=Math.max(u,r.length)),0===c.length)return u;const[d,h]=n.get("icon-size-scale-range"),p=Le(1,d,h);for(const m of c){const t=m.getUnevaluatedProperties();if(void 0!==t._values["icon-image"].value){const r=l.getAppearanceValueAndResolveTokens(m,"icon-image",i,s,[]);if(r){const n=e.getResolvedImageFromTokens(r);if(n){const r=t._values["icon-size"],l=e_(n,cy(e.zoom,r,e.worldview),r,s,e.zoom,i,e.pixelRatio,p,e.worldview),c=o.get(l.iconPrimary.toString());u=Math.max(u,Ly(c,a))}}}}return u}(e,o,p,l.layout,x,S,e.iconAtlasPositions,Y);B=4*m;let f=null;"source"===n.kind?(f=[ly*l.layout.get("icon-size").evaluate(x,{},S)*b.iconScaleFactor],f[0]>c_&&Ze("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(l_,'. Reduce your "icon-size".'))):"composite"===n.kind&&(f=[ly*b.compositeIconSizes[0].evaluate(x,{},S)*b.iconScaleFactor,ly*b.compositeIconSizes[1].evaluate(x,{},S)*b.iconScaleFactor],(f[0]>c_||f[1]>c_)&&Ze("".concat(e.layerIds[0],': Value for "icon-size" is >= ').concat(l_,'. Reduce your "icon-size".'))),e.addSymbols(e.icon,o,f,v,_,x,void 0,r,t,P.lineStartIndex,P.lineLength,-1,j,S,T,k,e.symbolInstances.length,m),W=e.icon.placedSymbolArray.length-1,p&&(U=4*m,e.addSymbols(e.icon,p,f,v,_,x,qg.vertical,r,t,P.lineStartIndex,P.lineLength,-1,j,S,T,k,e.symbolInstances.length,m),H=e.icon.placedSymbolArray.length-1)}for(const te in i.horizontal){const n=te,s=i.horizontal[n];M||(Z=Qt(s.text),m?F=p_(s):M=h_(c,K,t,u,d,h,s,p,l.layout.get("text-rotate").evaluate(x,{},S),f,I));const a=1===s.positionedLines.length;if(V+=u_(e,r,t,s,o,l,m,x,f,P,i.vertical?qg.horizontal:qg.horizontalOnly,a?Wy(i.horizontal):[n],G,W,b,j,S,e.symbolInstances.length,T),a)break}i.vertical&&(q+=u_(e,r,t,i.vertical,o,l,m,x,f,P,qg.vertical,["vertical"],G,H,b,j,S,e.symbolInstances.length,T));let Q=-1;const $=(e,t)=>e?Math.max(e,t):t;Q=$(F,Q),Q=$(O,Q),Q=$(z,Q);const ee=Q>-1?1:0;e.glyphOffsetArray.length>=65535&&Ze("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),void 0!==x.sortKey&&e.addToSortKeyRanges(e.symbolInstances.length,x.sortKey),e.symbolInstances.emplaceBack(t.x,t.y,K.x,K.y,K.z,G.right>=0?G.right:-1,G.center>=0?G.center:-1,G.left>=0?G.left:-1,G.vertical>=0?G.vertical:-1,W,H,Z,void 0!==M?M:e.collisionBoxArray.length,void 0!==M?M+1:e.collisionBoxArray.length,void 0!==R?R:e.collisionBoxArray.length,void 0!==R?R+1:e.collisionBoxArray.length,void 0!==L?L:e.collisionBoxArray.length,void 0!==L?L+1:e.collisionBoxArray.length,D||e.collisionBoxArray.length,D?D+1:e.collisionBoxArray.length,u,V,q,B,U,ee,0,X,J,Q,0,Y?1:0,C)}(e,l,j,a,r,n,s,i,e.layers[0],e.collisionBoxArray,t.index,t.sourceLayerIndex,e.index,P,_,c,0,M,R,y,t,o,u,d,h,m,f,g,z,x,b,w)};if("line"===v)for(const U of Lp(t.geometry,0,0,Bn,Bn)){const t=_y(U,I,L,r.vertical||C,n,k,N,e.overscaling,Bn);for(const r of t)C&&m_(e,C.text,D,r)||B(U,r,h)}else if("line-center"===v){for(const U of t.geometry)if(U.length>1){const e=yy(U,L,r.vertical||C,n,k,N);e&&B(U,e,h)}}else if("Polygon"===t.type)for(const U of rh(t.geometry,0)){const e=Uy(U,16);B(U[0],new hy(e.x,e.y,0,0,void 0),h)}else if("LineString"===t.type)for(const U of t.geometry)B(U,new hy(U[0].x,U[0].y,0,0,void 0),h);else if("Point"===t.type)for(const U of t.geometry)for(const e of U)B([e],new hy(e.x,e.y,0,0,void 0),h)}const l_=255,c_=l_*ly;function u_(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_){const v=function(e,t,r,n,i,s,o,a){const l=[];if(0===t.positionedLines.length)return l;const c=n.layout.get("text-rotate").evaluate(s,{})*Math.PI/180,u=function(e){const t=e[0],r=e[1],n=t*r;return n>0?[t,-r]:n<0?[-t,r]:0===t?[r,t]:[r,-t]}(r);let d=Math.abs(t.top-t.bottom);for(const f of t.positionedLines)d-=f.lineOffset;const h=t.positionedLines.length,p=d/h;let m=t.top-r[1];for(let f=0;f<h;++f){const e=t.positionedLines[f];m=By(t,p,m,f);for(const n of e.positionedGlyphs){if(!n.rect)continue;const e=n.rect||{};let s=Vg+1,d=!0,h=1,p=0;if(n.image){const e=o.get(n.image.toString());if(!e)continue;if(e.sdf){Ze("SDF images are not supported in formatted text and will be ignored.");continue}d=!1,h=e.pixelRatio,s=by/h}const f=(i||a)&&n.vertical,g=n.metrics.advance*n.scale/2,y=n.metrics,_=n.rect;if(null===_)continue;a&&t.verticalizable&&(p=n.image?g-n.metrics.width*n.scale/2:0);const v=i?[n.x+g,n.y]:[0,0];let x=[0,0],b=[0,0],w=!1;i||(f?(b=[n.x+g+u[0],n.y+u[1]-p],w=!0):x=[n.x+g+r[0],n.y+r[1]-p]);const j=_.w*n.scale/(h*(n.localGlyph?Cy:1)),S=_.h*n.scale/(h*(n.localGlyph?Cy:1));let T,k,A,C;if(f){const e=n.y-m,t=new Se(-g,g-e),r=-Math.PI/2,i=new Se(...b);T=new Se(-g+x[0],x[1]),T._rotateAround(r,t)._add(i),T.x+=-e+g,T.y-=(y.left-s)*n.scale;const o=n.image?y.advance*n.scale:_g*n.scale,a=String.fromCodePoint(n.glyph);bg(a)?T.x+=(1-s)*n.scale:wg(a)?T.x+=o-y.height*n.scale+(-s-1)*n.scale:T.x+=n.image||y.width+2*s===_.w&&y.height+2*s===_.h?(o-S)/2:(o-(y.height+2*s)*n.scale)/2,k=new Se(T.x,T.y-j),A=new Se(T.x+S,T.y),C=new Se(T.x+S,T.y-j)}else{const e=(y.left-s)*n.scale-g+x[0],t=(-y.top-s)*n.scale+x[1],r=e+j,i=t+S;T=new Se(e,t),k=new Se(r,t),A=new Se(e,i),C=new Se(r,i)}if(c){let e;e=i?new Se(0,0):w?new Se(u[0],u[1]):new Se(r[0],r[1]),T._rotateAround(c,e),k._rotateAround(c,e),A._rotateAround(c,e),C._rotateAround(c,e)}const E=new Se(0,0),N=new Se(0,0);l.push({tl:T,tr:k,bl:A,br:C,texPrimary:e,texSecondary:void 0,writingMode:t.writingMode,glyphOffset:v,sectionIndex:n.sectionIndex,isSDF:d,pixelOffsetTL:E,pixelOffsetBR:N,minFontScaleX:0,minFontScaleY:0})}}return l}(0,n,l,s,o,a,i,e.allowVerticalPlacement),x=e.textSizeData;let b=null;"source"===x.kind?(b=[ly*s.layout.get("text-size").evaluate(a,{},g)*m.textScaleFactor],b[0]>c_&&Ze("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(l_,'. Reduce your "text-size".'))):"composite"===x.kind&&(b=[ly*m.compositeTextSizes[0].evaluate(a,{},g)*m.textScaleFactor,ly*m.compositeTextSizes[1].evaluate(a,{},g)*m.textScaleFactor],(b[0]>c_||b[1]>c_)&&Ze("".concat(e.layerIds[0],': Value for "text-size" is >= ').concat(l_,'. Reduce your "text-size".'))),e.addSymbols(e.text,v,b,l,o,a,u,t,r,c.lineStartIndex,c.lineLength,p,f,g,_,!1,y,v.length);for(const w of d)h[w]=e.text.placedSymbolArray.length-1;return 4*v.length}function d_(e){for(const t in e)return e[t];return null}function h_(e,t,r,n,i,s,o,a,l,c,u){let d,h,p,m;if(d=u?u.top:o.top,h=u?u.bottom:o.bottom,p=u?u.left:o.left,m=u?u.right:o.right,ry(o)&&o.collisionPadding){const e=o.collisionPadding;p-=e[0],d-=e[1],m+=e[2],h+=e[3]}if(l){const e=new Se(p,d),t=new Se(m,d),r=new Se(p,h),n=new Se(m,h),i=Ce(l);let s=new Se(0,0);c&&(s=new Se(c[0],c[1])),e._rotateAround(i,s),t._rotateAround(i,s),r._rotateAround(i,s),n._rotateAround(i,s),p=Math.min(e.x,t.x,r.x,n.x),m=Math.max(e.x,t.x,r.x,n.x),d=Math.min(e.y,t.y,r.y,n.y),h=Math.max(e.y,t.y,r.y,n.y)}return e.emplaceBack(t.x,t.y,t.z,r.x,r.y,p,d,m,h,a,n,i,s),e.length-1}function p_(e){ry(e)&&e.collisionPadding&&(e.top-=e.collisionPadding[1],e.bottom+=e.collisionPadding[3]);const t=e.bottom-e.top;return t>0?Math.max(10,t):null}function m_(e,t,r,n){const i=e.compareText;if(t in i){const e=i[t];for(let t=e.length-1;t>=0;t--)if(n.dist(e[t])<r)return!0}else i[t]=[];return i[t].push(n),!1}function f_(e,t){const r=e.fovAboveCenter,n=e.elevation?e.elevation.getMinElevationBelowMSL()*t:0,i=(e._camera.position[2]*e.worldSize-n)/Math.cos(e._pitch),s=Math.sin(r)*i/Math.sin(Math.max(Math.PI/2-e._pitch-r,.01));let o=Math.sin(e._pitch)*s+i;const a=i*(1/e._horizonShift);if(!e.elevation||0===e.elevation.exaggeration()){let t=Math.max(e.zoom-17,0);e.isOrthographic&&(t/=10),o*=1+t}return Math.min(1.01*o,a)}function g_(e,t){if(!t.isReprojectedInTileSpace)return{scale:1<<e.z,x:e.x,y:e.y,x2:e.x+1,y2:e.y+1,projection:t};const r=Math.pow(2,-e.z),n=e.x*r,i=(e.x+1)*r,s=e.y*r,o=(e.y+1)*r,a=hc(n),l=hc(i),c=pc(s),u=pc(o),d=t.project(a,c),h=t.project(l,c),p=t.project(l,u),m=t.project(a,u);let f=Math.min(d.x,h.x,p.x,m.x),g=Math.min(d.y,h.y,p.y,m.y),y=Math.max(d.x,h.x,p.x,m.x),_=Math.max(d.y,h.y,p.y,m.y);const v=r/16;function x(e,r,n,i,s,o){const a=(n+s)/2,l=(i+o)/2,c=t.project(hc(a),pc(l)),u=Math.max(0,f-c.x,g-c.y,c.x-y,c.y-_);f=Math.min(f,c.x),y=Math.max(y,c.x),g=Math.min(g,c.y),_=Math.max(_,c.y),u>v&&(x(e,c,n,i,a,l),x(c,r,a,l,s,o))}x(d,h,n,s,i,s),x(h,p,i,s,i,o),x(p,m,i,o,n,o),x(m,d,n,o,n,s),f-=v,g-=v,y+=v,_+=v;const b=1/Math.max(y-f,_-g);return{scale:b,x:f*b,y:g*b,x2:y*b,y2:_*b,projection:t}}function y_(e,t){let{x:r,y:n}=t;return new Se(((r-(arguments.length>2&&void 0!==arguments[2]?arguments[2]:0))*e.scale-e.x)*Bn,(n*e.scale-e.y)*Bn)}const __=c(new Float32Array(16));class v_{constructor(e){this.spec=e,this.name=e.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(e,t){return{x:0,y:0,z:0}}unproject(e,t){return new ic(0,0)}projectTilePoint(e,t,r){return{x:e,y:t,z:0}}locationPoint(e,t,r){let n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];return e._coordinatePoint(e.locationCoordinate(t,r),n)}pixelsPerMeter(e,t){return dc(1,e)*t}pixelSpaceConversion(e,t,r){return 1}farthestPixelDistance(e){return f_(e,e.pixelsPerMeter)}pointCoordinate(e,t,r,n){const i=e.horizonLineFromTop(!1),s=new Se(t,Math.max(i,r));return e.rayIntersectionCoordinate(e.pointRayIntersection(s,n))}pointCoordinate3D(e,t,r){const n=new Se(t,r);if(e.elevation)return e.elevation.pointCoordinate(n);{const t=this.pointCoordinate(e,n.x,n.y,0);return[t.x,t.y,t.z]}}isPointAboveHorizon(e,t){if(e.elevation&&e.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(e,t.x,t.y);const r=e.horizonLineFromTop();return t.y<r}createInversionMatrix(e,t){return __}createTileMatrix(e,t,r){let n,i,s;const o=r.canonical,a=c(new Float64Array(16));if(this.isReprojectedInTileSpace){const l=g_(o,this);n=1,i=l.x+r.wrap*l.scale,s=l.y,p(a,a,[n/l.scale,n/l.scale,e.pixelsPerMeter/t])}else n=t/e.zoomScale(o.z),i=(o.x+Math.pow(2,o.z)*r.wrap)*n,s=o.y*n;return h(a,a,[i,s,0]),p(a,a,[n/Bn,n/Bn,1]),a}upVector(e,t,r){return[0,0,1]}upVectorScale(e,t,r){return{metersToTile:1}}}class x_ extends v_{constructor(e){super(e),this.range=[4,7],this.center=e.center||[-96,37.5];const[t,r]=this.parallels=e.parallels||[29.5,45.5],n=Math.sin(Ce(t));this.n=(n+Math.sin(Ce(r)))/2,this.c=1+n*(2*this.n-n),this.r0=Math.sqrt(this.c)/this.n}project(e,t){const{n:r,c:n,r0:i}=this,s=Ce(e-this.center[0]),o=Ce(t),a=Math.sqrt(n-2*r*Math.sin(o))/r;return{x:a*Math.sin(s*r),y:a*Math.cos(s*r)-i,z:0}}unproject(e,t){const{n:r,c:n,r0:i}=this,s=i+t;let o=Math.atan2(e,Math.abs(s))*Math.sign(s);s*r<0&&(o-=Math.PI*Math.sign(e)*Math.sign(s));const a=Ce(this.center[0])*r;o=De(o,-Math.PI-a,Math.PI-a);const l=Le(Ee(o/r)+this.center[0],-180,180),c=Math.asin(Le((n-(e*e+s*s)*r*r)/(2*r),-1,1)),u=Le(Ee(c),-fc,fc);return new ic(l,u)}}const b_=1.340264,w_=-.081106,j_=893e-6,S_=.003796,T_=Math.sqrt(3)/2;class k_ extends v_{project(e,t){t=t/180*Math.PI,e=e/180*Math.PI;const r=Math.asin(T_*Math.sin(t)),n=r*r,i=n*n*n;return{x:.5*(e*Math.cos(r)/(T_*(b_+3*w_*n+i*(7*j_+9*S_*n)))/Math.PI+.5),y:1-.5*(r*(b_+w_*n+i*(j_+S_*n))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=r*r,i=n*n*n;for(let c,u,d,h=0;h<12&&(u=r*(b_+w_*n+i*(j_+S_*n))-t,d=b_+3*w_*n+i*(7*j_+9*S_*n),c=u/d,r=Le(r-c,-Math.PI/3,Math.PI/3),n=r*r,i=n*n*n,!(Math.abs(c)<1e-12));++h);const s=T_*e*(b_+3*w_*n+i*(7*j_+9*S_*n))/Math.cos(r),o=Math.asin(Math.sin(r)/T_),a=Le(180*s/Math.PI,-180,180),l=Le(180*o/Math.PI,-fc,fc);return new ic(a,l)}}class A_ extends v_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){return{x:.5+e/360,y:.5-t/360,z:0}}unproject(e,t){const r=360*(e-.5),n=Le(360*(.5-t),-fc,fc);return new ic(r,n)}}const C_=Math.PI/2;function E_(e){return Math.tan((C_+e)/2)}class N_ extends v_{constructor(e){super(e),this.center=e.center||[0,30];const[t,r]=this.parallels=e.parallels||[30,30];let n=Ce(t),i=Ce(r);this.southernCenter=n+i<0,this.southernCenter&&(n=-n,i=-i);const s=Math.cos(n),o=E_(n);this.n=n===i?Math.sin(n):Math.log(s/Math.cos(i))/Math.log(E_(i)/o),this.f=s*Math.pow(E_(n),this.n)/this.n}project(e,t){t=Ce(t),this.southernCenter&&(t=-t),e=Ce(e-this.center[0]);const r=1e-6,{n:n,f:i}=this;i>0?t<-C_+r&&(t=-C_+r):t>C_-r&&(t=C_-r);const s=i/Math.pow(E_(t),n);let o=s*Math.sin(n*e),a=i-s*Math.cos(n*e);return o=.5*(o/Math.PI+.5),a=.5*(a/Math.PI+.5),{x:o,y:this.southernCenter?a:1-a,z:0}}unproject(e,t){e=(2*e-.5)*Math.PI,this.southernCenter&&(t=1-t),t=(2*(1-t)-.5)*Math.PI;const{n:r,f:n}=this,i=n-t,s=Math.sign(i),o=Math.sign(r)*Math.sqrt(e*e+i*i);let a=Math.atan2(e,Math.abs(i))*s;i*r<0&&(a-=Math.PI*Math.sign(e)*s);const l=Le(Ee(a/r)+this.center[0],-180,180),c=Le(Ee(2*Math.atan(Math.pow(n/o,1/r))-C_),-fc,fc);return new ic(l,this.southernCenter?-c:c)}}class I_ extends v_{constructor(e){super(e),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(e,t){return{x:cc(e),y:uc(t),z:0}}unproject(e,t){const r=hc(e),n=pc(t);return new ic(r,n)}}const P_=Ce(fc);class M_ extends v_{project(e,t){const r=(t=Ce(t))*t,n=r*r;return{x:.5*((e=Ce(e))*(.8707-.131979*r+n*(n*(.003971*r-.001529*n)-.013791))/Math.PI+.5),y:1-.5*(t*(1.007226+r*(.015085+n*(.028874*r-.044475-.005916*n)))/Math.PI+1),z:0}}unproject(e,t){e=(2*e-.5)*Math.PI;let r=t=(2*(1-t)-1)*Math.PI,n=25,i=0,s=r*r;do{s=r*r;const e=s*s;i=(r*(1.007226+s*(.015085+e*(.028874*s-.044475-.005916*e)))-t)/(1.007226+s*(.045255+e*(.259866*s-.311325-.005916*11*e))),r=Le(r-i,-P_,P_)}while(Math.abs(i)>1e-6&&--n>0);s=r*r;const o=Le(Ee(e/(.8707+s*(s*(s*s*s*(.003971-.001529*s)-.013791)-.131979))),-180,180),a=Ee(r);return new ic(o,a)}}const L_=Ce(fc);class R_ extends v_{project(e,t){t=Ce(t),e=Ce(e);const r=Math.cos(t),n=2/Math.PI,i=Math.acos(r*Math.cos(e/2)),s=Math.sin(i)/i,o=.5*(e*n+2*r*Math.sin(e/2)/s)||0,a=.5*(t+Math.sin(t)/s)||0;return{x:.5*(o/Math.PI+.5),y:1-.5*(a/Math.PI+1),z:0}}unproject(e,t){let r=e=(2*e-.5)*Math.PI,n=t=(2*(1-t)-1)*Math.PI,i=25;const s=1e-6;let o=0,a=0;do{const i=Math.cos(n),s=Math.sin(n),l=2*s*i,c=s*s,u=i*i,d=Math.cos(r/2),h=Math.sin(r/2),p=2*d*h,m=h*h,f=1-u*d*d,g=f?1/f:0,y=f?Math.acos(i*d)*Math.sqrt(1/f):0,_=.5*(2*y*i*h+2*r/Math.PI)-e,v=.5*(y*s+n)-t,x=.5*g*(u*m+y*i*d*c)+1/Math.PI,b=g*(p*l/4-y*s*h),w=.125*g*(l*h-y*s*u*p),j=.5*g*(c*d+y*m*i)+.5,S=b*w-j*x;o=(v*b-_*j)/S,a=(_*w-v*x)/S,r=Le(r-o,-Math.PI,Math.PI),n=Le(n-a,-L_,L_)}while((Math.abs(o)>s||Math.abs(a)>s)&&--i>0);return new ic(Ee(r),Ee(n))}}class D_ extends v_{constructor(e){super(e),this.center=e.center||[0,0],this.parallels=e.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ce(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(e,t){const{scale:r,cosPhi:n}=this;return{x:Ce(e)*n*r+.5,y:-Math.sin(Ce(t))/n*r+.5,z:0}}unproject(e,t){const{scale:r,cosPhi:n}=this,i=-(t-.5)/r,s=Le(Ee((e-.5)/r)/n,-180,180),o=Math.asin(Le(i*n,-1,1)),a=Le(Ee(o),-fc,fc);return new ic(s,a)}}class F_ extends I_{constructor(e){super(e),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(e,t,r){const n=Zu(e,t,r);return V(n,n,Xu(Uu(r))),{x:n[0],y:n[1],z:n[2]}}locationPoint(e,t,r){const n=tc(t.lat,t.lng),i=O([],n),s=r?e._centerAltitude+r:e.elevation?e.elevation.getAtPointOrZero(e.locationCoordinate(t),e._centerAltitude):e._centerAltitude;M(n,n,i,dc(1,0)*Bn*s);const o=c(new Float64Array(16));return d(o,e.pixelMatrix,e.globeMatrix),V(n,n,o),new Se(n[0],n[1])}pixelsPerMeter(e,t){return dc(1,0)*t}pixelSpaceConversion(e,t,r){const n=dc(1,e)*t,i=hr(dc(1,45)*t,n,r);return this.pixelsPerMeter(e,t)/i}createTileMatrix(e,t,r){const n=Ju(Uu(r.canonical));return d(new Float64Array(16),e.globeMatrix,n)}createInversionMatrix(e,t){const{center:r}=e,n=Xu(Uu(t));return f(n,n,Ce(r.lng)),m(n,n,Ce(r.lat)),p(n,n,[e._pixelsPerMercatorPixel,e._pixelsPerMercatorPixel,1]),Float32Array.from(n)}pointCoordinate(e,t,r,n){return Ou(e,t,r,!0)||new xc(0,0)}pointCoordinate3D(e,t,r){const n=this.pointCoordinate(e,t,r,0);return[n.x,n.y,n.z]}isPointAboveHorizon(e,t){return!Ou(e,t.x,t.y,!1)}farthestPixelDistance(e){const t=function(e,t){const r=e.cameraToCenterDistance,n=e._centerAltitude*t,i=e._camera,s=e._camera.forward(),o=A([],P([],s,-r),[0,0,n]),a=e.worldSize/(2*Math.PI),l=[0,0,-a],c=e.width/e.height,u=Math.tan(e.fovAboveCenter),d=P([],i.up(),u),h=P([],i.right(),u*c),p=O([],A([],A([],s,d),h)),m=[];let f;if(new Hc(o,p).closestPointOnSphere(l,a,m)){const t=A([],m,l),r=Z([],t,o);f=Math.cos(e.fovAboveCenter)*S(r)}else{const e=Z([],o,l),t=Z([],l,o);O(t,t);const r=S(e)-a;f=Math.sqrt(r*(r+2*a));const n=Math.acos(f/(a+r))-Math.acos(z(s,t));f*=Math.cos(n)}return 1.01*f}(e,this.pixelsPerMeter(e.center.lat,e.worldSize)),r=td(e.zoom);if(r>0){const n=f_(e,dc(1,e.center.lat)*e.worldSize),i=e.worldSize/(2*Math.PI),s=Math.max(e.width,e.height)/e.worldSize*Math.PI;return hr(t,n+i*(1-Math.cos(s)),Math.pow(r,10))}return t}upVector(e,t,r){return Zu(t,r,e,1)}upVectorScale(e){return{metersToTile:Du(Ku(Uu(e)))}}}function O_(e){const t=e.parallels,r=!!t&&Math.abs(t[0]+t[1])<.01;switch(e.name){case"mercator":return new I_(e);case"equirectangular":return new A_(e);case"naturalEarth":return new M_(e);case"equalEarth":return new k_(e);case"winkelTripel":return new R_(e);case"albers":return r?new D_(e):new x_(e);case"lambertConformalConic":return r?new D_(e):new N_(e);case"globe":return new F_(e)}throw new Error("Invalid projection name: ".concat(e.name))}const z_=Nc.types,B_=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function U_(e,t,r,n,i,s,o,a,l,c,u,d,h){const p=a?Math.min(c_,Math.round(a[0])):0,m=a?Math.min(c_,Math.round(a[1])):0;e.emplaceBack(t,r,Math.round(32*n),Math.round(32*i),s,o,(p<<1)+(l?1:0),0+(m<<1),16*c,16*u,256*d,256*h)}function V_(e,t,r){e.emplaceBack(t,r)}function q_(e,t,r,n,i,s,o){e.emplaceBack(t,r,n,i,s,o)}const W_=(e,t,r,n)=>{for(let i=0;i<t;i++)e.emplaceBack(r[0],r[1],r[2],n[0],n[1],n[2])};function H_(e,t,r,n,i){e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i),e.emplaceBack(t,r,n,i)}function G_(e){for(const t of e.sections)if(po(t.text))return!0;return!1}class Z_{constructor(e){this.layoutVertexArray=new Ta,this.indexArray=new La,this.programConfigurations=e,this.segments=new dl,this.dynamicLayoutVertexArray=new Aa,this.opacityVertexArray=new Ca,this.placedSymbolArray=new Qa,this.iconTransitioningVertexArray=new Ea,this.globeExtVertexArray=new ka,this.zOffsetVertexArray=new ga,this.orientationVertexArray=new Fa,this.symbolInstanceIndices=[]}isEmpty(){return 0===this.layoutVertexArray.length&&0===this.indexArray.length&&0===this.dynamicLayoutVertexArray.length&&0===this.opacityVertexArray.length&&0===this.iconTransitioningVertexArray.length}getIconVertexData(e,t){const r=[],n=this.layoutVertexArray.uint16;for(let i=0;i<t;++i){const t=12*(e+i);r.push(...n.slice(t,t+12))}return r}updateIconVertexData(e,t,r,n,i,s,o,a,l,c,u,d,h){const p=this.layoutVertexArray.uint16,m=12*e;p[m]=t,p[m+1]=r,p[m+2]=n,p[m+3]=i,p[m+4]=s,p[m+5]=o,p[m+6]=a,p[m+7]=l,p[m+8]=c,p[m+9]=u,p[m+10]=d,p[m+11]=h}upload(e,t,r,n,i,s){this.isEmpty()||(r&&(this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,lg.members,!!s),this.indexBuffer=e.createIndexBuffer(this.indexArray,t),this.dynamicLayoutVertexBuffer=e.createVertexBuffer(this.dynamicLayoutVertexArray,ug.members,!0),this.opacityVertexBuffer=e.createVertexBuffer(this.opacityVertexArray,B_,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=e.createVertexBuffer(this.iconTransitioningVertexArray,pg.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=e.createVertexBuffer(this.globeExtVertexArray,cg.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||i)&&(this.zOffsetVertexBuffer=e.createVertexBuffer(this.zOffsetVertexArray,dg.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=e.createVertexBuffer(this.orientationVertexArray,hg.members,!0)),this.opacityVertexBuffer.itemSize=1),(r||n)&&this.programConfigurations.upload(e))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}$s(Z_,"SymbolBuffers");class K_{constructor(e,t,r){this.layoutVertexArray=new e,this.layoutAttributes=t,this.indexArray=new r,this.segments=new dl,this.collisionVertexArray=new Ma,this.collisionVertexArrayExt=new Aa}upload(e){this.layoutVertexBuffer=e.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=e.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=e.createVertexBuffer(this.collisionVertexArray,mg.members,!0),this.collisionVertexBufferExt=e.createVertexBuffer(this.collisionVertexArrayExt,fg.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$s(K_,"CollisionBuffers");class Y_{constructor(e){this.collisionBoxArray=e.collisionBoxArray,this.zoom=e.zoom,this.overscaling=e.overscaling,this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.index=e.index,this.pixelRatio=e.pixelRatio,this.sourceLayerIndex=e.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=c([]),this.placementViewportMatrix=c([]);const t=this.layers[0]._unevaluatedLayout._values;this.worldview=e.worldview,this.localizable=e.localizable,this.textSizeData=cy(this.zoom,t["text-size"],this.worldview),this.iconSizeData=cy(this.zoom,t["icon-size"],this.worldview);const r=this.layers[0].layout,n=r.get("symbol-sort-key"),i=r.get("symbol-z-order");this.lut=e.lut,this.canOverlap=r.get("text-allow-overlap")||r.get("icon-allow-overlap")||r.get("text-ignore-placement")||r.get("icon-ignore-placement"),this.sortFeaturesByKey="viewport-y"!==i&&void 0!==n.constantOr(1),this.sortFeaturesByY=("viewport-y"===i||"auto"===i&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=r.get("text-writing-mode").map(e=>qg[e]),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.sourceID=e.sourceID,this.projection=e.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1,this.hasAppearances=null,this.lastActiveApperance=null,this.featureToAppearanceIndex={}}hasAnyAppearanceProperty(e){const t=this.layers[0].getAppearances();return!(!t||0===t.length)&&t.some(t=>null!=t.getProperty(e))}createArrays(){this.text=new Z_(new Bl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("text")||e.startsWith("symbol"))),this.icon=new Z_(new Bl(this.layers,{zoom:this.zoom,lut:this.lut},e=>e.startsWith("icon")||e.startsWith("symbol"))),this.glyphOffsetArray=new tl,this.lineVertexArray=new rl,this.symbolInstances=new el}calculateGlyphDependencies(e,t,r,n,i){for(const s of e){const e=s.codePointAt(0);if(void 0===e)break;if(t[e]=!0,n&&i&&e<=65535){const e=xg[s];e&&(t[e.charCodeAt(0)]=!0)}}}calculateEffectiveAppearanceIconSize(e,t,r,n,i,s){let o=1;const a=e.getUnevaluatedProperties()._values["icon-size"],l=cy(this.zoom,a,this.worldview),c=dy(l,t);if("constant"!==l.kind&&"camera"!==l.kind||(o=c.uSize),"composite"===l.kind){const{minZoom:e,maxZoom:t}=l,s=a.possiblyEvaluate(new So(e,{worldview:this.worldview}),n),u=a.possiblyEvaluate(new So(t,{worldview:this.worldview}),n),d=s.evaluate(r,{},n,i);o=d+(u.evaluate(r,{},n,i)-d)*c.uSizeT}return"source"===l.kind&&(o=a.possiblyEvaluate(new So(this.zoom,{worldview:this.worldview}),n).evaluate(r,{},n,i)),o*s}updateFootprints(e,t){}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);return!Vh(this.activeReplacements,r)&&(this.activeReplacements=r,!0)}getResolvedImageFromTokens(e){return"string"==typeof e?Or.build(e):e}populate(e,t,r,n){const i=this.layers[0],s=i.layout,o="globe"===this.projection.name,a=s.get("text-font"),l=s.get("text-field"),c=s.get("icon-image"),[u,d]=s.get("icon-size-scale-range"),h=Le(t.scaleFactor||1,u,d),p=("constant"!==l.value.kind||l.value.value instanceof Dr&&!l.value.value.isEmpty()||l.value.value.toString().length>0)&&("constant"!==a.value.kind||a.value.value.length>0),m="constant"!==c.value.kind||!!c.value.value||Object.keys(c.parameters).length>0,f=this.hasAnyAppearanceProperty("icon-image"),g=s.get("symbol-sort-key");if(this.features=[],this.appearanceFeatureData=[],!p&&!m&&!f)return;const y=t.iconDependencies,_=t.glyphDependencies,v=t.availableImages,x=new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),b=e=>{const t=e.id.toString();y.has(t)?y.get(t).push(e):y.set(t,[e])};for(const w of e){const{feature:e,id:t,index:l,sourceLayerIndex:c}=w,u=i._featureFilter.needGeometry,d=Ec(e,u);if(!i._featureFilter.filter(x,d,r))continue;if(u||(d.geometry=Cc(e,r,n)),o&&1!==e.type&&r.z<=5){const e=d.geometry,t=.98078528056,n=(e,n)=>z(Zu(e.x,e.y,r,1),Zu(n.x,n.y,r,1))<t;for(let r=0;r<e.length;r++)e[r]=Sc(e[r],n)}let j,S;if(p){const e=i.getValueAndResolveTokens("text-field",d,r,v),t=Dr.factory(e);G_(t)&&(this.hasRTLText=!0),(!this.hasRTLText||"unavailable"===bo()||this.hasRTLText&&jo.isParsed())&&(j=vg(t,i,d))}if(m){const e=i.getValueAndResolveTokens("icon-image",d,r,v);S=this.getResolvedImageFromTokens(e)}const T=this.layers[0];let k=!1;if(!S&&f){const e=T.getAppearances();for(const t of e)if(t.getProperty("icon-image")){const e=T.getAppearanceValueAndResolveTokens(t,"icon-image",d,r,v);if(e){S=this.getResolvedImageFromTokens(e),k=!0;break}}}if(!j&&!S)continue;const A=this.sortFeaturesByKey?g.evaluate(d,{},r):void 0,C={id:t,text:j,icon:S,index:l,sourceLayerIndex:c,geometry:d.geometry,properties:e.properties,type:z_[e.type],sortKey:A};if(this.features.push(C),this.featureToAppearanceIndex[l]=this.appearanceFeatureData.length,this.appearanceFeatureData.push({id:t,properties:e.properties,usesAppearanceIconAsPlaceholder:k,isUsingAppearanceVertexData:!1,layoutBasedVertexData:[],activeAppearance:null}),S){const e=T._unevaluatedLayout._values,{iconPrimary:t,iconSecondary:n}=e_(S,this.iconSizeData,e["icon-size"],r,this.zoom,C,this.pixelRatio,h,this.worldview);b(t),n&&(this.hasAnySecondaryIcon=!0,b(n))}const E=T.getAppearances();if(0!==E.length&&E.forEach(e=>{if(!e.getProperty("icon-image"))return;const t=this.getCombinedIconPrimary(e,T,d,r,v,C,h);t&&b(t)}),j){const e=a.evaluate(d,{},r).join(","),t="map"===s.get("text-rotation-alignment")&&"point"!==s.get("symbol-placement");this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(qg.vertical)>=0;for(const r of j.sections)if(r.image){const e=r.image.getPrimary().scaleSelf(this.pixelRatio),t=e.id.toString(),n=y.get(t)||[];n.push(e),y.set(t,n)}else{const n=io(j.toString()),i=r.fontStack||e,s=_[i]=_[i]||{};this.calculateGlyphDependencies(r.text,s,t,this.allowVerticalPlacement,n)}}}if("line"===s.get("symbol-placement")&&(this.features=function(e){const t={},r={},n=[];let i=0;function s(t){n.push(e[t]),i++}function o(e,t,i){const s=r[e];return delete r[e],r[t]=s,n[s].geometry[0].pop(),n[s].geometry[0]=n[s].geometry[0].concat(i[0]),s}function a(e,r,i){const s=t[r];return delete t[r],t[e]=s,n[s].geometry[0].shift(),n[s].geometry[0]=i[0].concat(n[s].geometry[0]),s}function l(e,t,r){const n=r?t[0][t[0].length-1]:t[0][0];return"".concat(e,":").concat(n.x,":").concat(n.y)}for(let c=0;c<e.length;c++){const u=e[c],d=u.geometry,h=u.text?u.text.toString():null;if(!h){s(c);continue}const p=l(h,d),m=l(h,d,!0);if(p in r&&m in t&&r[p]!==t[m]){const e=a(p,m,d),i=o(p,m,n[e].geometry);delete t[p],delete r[m],r[l(h,n[i].geometry,!0)]=i,n[e].geometry=null}else p in r?o(p,m,d):m in t?a(p,m,d):(s(c),t[p]=i-1,r[m]=i-1)}return n.filter(e=>e.geometry)}(this.features)),"hd-road-markup"===s.get("symbol-elevation-reference")){if(this.elevationType="road",t.elevationFeatures){!this.elevationFeatures&&t.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const e of t.elevationFeatures)this.elevationFeatureIdToIndex.set(e.id,this.elevationFeatures.length),this.elevationFeatures.push(e)}}else s.get("symbol-z-elevate")&&(this.elevationType="offset");"none"!==this.elevationType&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((e,t)=>e.sortKey-t.sortKey)}getCombinedIconPrimary(e,t,r,n,i,s,o){let a,l;const c=e.getUnevaluatedProperties();if(void 0!==c._values["icon-image"].value){const s=t.getAppearanceValueAndResolveTokens(e,"icon-image",r,n,i);a=this.getResolvedImageFromTokens(s)}else{const e=t.getValueAndResolveTokens("icon-image",r,n,i);a=this.getResolvedImageFromTokens(e)}if(a){const e=c._values["icon-size"]||t._unevaluatedLayout._values["icon-size"];l=e_(a,cy(this.zoom,e,this.worldview),e,n,this.zoom,s,this.pixelRatio,o,this.worldview).iconPrimary}return l}updateAppearanceBasedIconTextures(e,t,r,n){if(!this.appearanceFeatureData)return!1;if(!this.icon.layoutVertexArray||0===this.icon.layoutVertexArray.length)return!1;const i=this.layers[0];let s=!1,o=0;const a=i.layout,[l,c]=a.get("icon-size-scale-range"),u=Le(1,l,c);for(let d=0;d<this.symbolInstances.length;d++){const a=this.symbolInstances.get(d),l=this.featureToAppearanceIndex[a.featureIndex],c=void 0!==l?this.appearanceFeatureData[l]:void 0;if(c&&a.placedIconSymbolIndex>=0){const l=c.id,d=t&&void 0!==l?t[String(l)]:void 0,h={type:"Point",id:c.id,properties:c.properties,geometry:[]},p=this.layers[0].appearances&&this.layers[0].appearances.find(t=>t.isActive({globals:n,feature:h,canonical:e,featureState:d}));if(c.activeAppearance===p){o+=a.numIconVertices;continue}if(p){c.activeAppearance=p;const t=this.getCombinedIconPrimary(p,i,h,e,r,{sortKey:void 0,text:void 0,icon:null,index:a.featureIndex,sourceLayerIndex:a.featureIndex,geometry:[],properties:c.properties,type:"Point",id:c.id},u);if(!t)continue;const l=t.toString(),d=this.iconAtlasPositions&&this.iconAtlasPositions.get(l);if(d){const t=i.getAppearanceValueAndResolveTokens(p,"icon-offset",h,e,r),l=t&&Array.isArray(t)?t:[0,0];let m=ny(d,void 0,l,i.layout.get("icon-anchor").evaluate(h,{},e));const f=i.getAppearanceValueAndResolveTokens(p,"icon-rotate",h,e,r),g="number"==typeof f?f:0,y=d.sdf,_=i.layout.get("icon-text-fit").constantOr("none");"none"!==_&&c.textShaping&&c.iconTextFitPadding&&c.fontScale&&(m=iy(m,c.textShaping,_,c.iconTextFitPadding,l,c.fontScale));const v=this.calculateEffectiveAppearanceIconSize(p,n.zoom,h,e,r,u),x=0,b=1+(Math.min(c_,Math.round(v*ly))<<1),w=My(m,g,y,"none"!==_,u);c.isUsingAppearanceVertexData||(c.isUsingAppearanceVertexData=!0,c.layoutBasedVertexData=this.icon.getIconVertexData(o,a.numIconVertices));for(let e=0;e<w.length;++e){const t=w[e],r=c.layoutBasedVertexData[0]||a.tileAnchorX,n=c.layoutBasedVertexData[1]||a.tileAnchorY,i=16*t.pixelOffsetTL.x,s=16*t.pixelOffsetTL.y,l=16*t.pixelOffsetBR.x,u=16*t.pixelOffsetBR.y,d=16*t.minFontScaleX,h=16*t.minFontScaleY;this.icon.updateIconVertexData(o,r,n,Math.round(32*t.tl.x),Math.round(32*t.tl.y),t.texPrimary.x,t.texPrimary.y,x,b,i,s,d,h),this.icon.updateIconVertexData(o+1,r,n,Math.round(32*t.tr.x),Math.round(32*t.tr.y),t.texPrimary.x+t.texPrimary.w,t.texPrimary.y,x,b,l,s,d,h),this.icon.updateIconVertexData(o+2,r,n,Math.round(32*t.bl.x),Math.round(32*t.bl.y),t.texPrimary.x,t.texPrimary.y+t.texPrimary.h,x,b,i,u,d,h),this.icon.updateIconVertexData(o+3,r,n,Math.round(32*t.br.x),Math.round(32*t.br.y),t.texPrimary.x+t.texPrimary.w,t.texPrimary.y+t.texPrimary.h,x,b,l,u,d,h),o+=4}const j=a.numIconVertices-4*w.length;for(let e=0;e<j;++e)this.icon.updateIconVertexData(o+e,0,0,0,0,0,0,0,0,0,0,0,0);s=!0}else o+=a.numIconVertices}else if(c.usesAppearanceIconAsPlaceholder)this.layers[0].appearances&&this.layers[0].appearances.length>0&&(this.icon.updateIconVertexData(o,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(o+1,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(o+2,0,0,0,0,0,0,0,0,0,0,0,0),this.icon.updateIconVertexData(o+3,0,0,0,0,0,0,0,0,0,0,0,0),s=!0),o+=a.numIconVertices,c.activeAppearance=null;else if(c.isUsingAppearanceVertexData){const e=12,t=c.layoutBasedVertexData.length/e;for(let r=0;r<t;++r){const t=r*e;this.icon.updateIconVertexData(o+r,c.layoutBasedVertexData[t+0],c.layoutBasedVertexData[t+1],c.layoutBasedVertexData[t+2],c.layoutBasedVertexData[t+3],c.layoutBasedVertexData[t+4],c.layoutBasedVertexData[t+5],c.layoutBasedVertexData[t+6],c.layoutBasedVertexData[t+7],c.layoutBasedVertexData[t+8],c.layoutBasedVertexData[t+9],c.layoutBasedVertexData[t+10],c.layoutBasedVertexData[t+11])}o+=t,c.isUsingAppearanceVertexData=!1,c.activeAppearance=null,s=!0}else o+=a.numIconVertices,c.activeAppearance=null}}return s}update(e,t,r,n,i,s,o){this.text.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o,this.worldview),this.icon.programConfigurations.updatePaintArrays(e,t,i,r,n,s,o,this.worldview)}updateRoadElevation(e){if("road"!==this.elevationType||!this.elevationFeatures)return;if(this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let t=!1;const r=vc(e),n=1/r;let i=!1,s=!1;for(let o=0;o<this.symbolInstances.length;o++){const e=this.symbolInstances.get(o),a=T(1,0,0),l=T(0,1,0),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,numIconVertices:d,numVerticalIconVertices:h}=e,p=c>0||u>0,m=d>0,f=this.elevationFeatures[e.elevationFeatureIndex];if(f){const o=new Se(e.tileAnchorX,e.tileAnchorY),c=.075+f.pointElevation(o);e.zOffset!==c&&(t=!0,e.zOffset=c),0!==c&&(this.hasAnyZOffset=!0);const u=f.computeSlopeNormal(o,n),d=le(ee(),T(0,0,1),u);W(a,a,d),W(l,l,d),a[2]*=r,l[2]*=r,1===a[0]&&0===a[1]&&0===a[2]&&0===l[0]&&1===l[1]&&0===l[2]||(i=i||p,s=s||m)}if(p&&(W_(this.text.orientationVertexArray,c,a,l),W_(this.text.orientationVertexArray,u,a,l)),m){const{placedIconSymbolIndex:t,verticalPlacedIconSymbolIndex:r}=e;t>=0&&W_(this.icon.orientationVertexArray,d,a,l),r>=0&&W_(this.icon.orientationVertexArray,h,a,l)}}i||(this.text.orientationVertexArray=void 0),s||(this.icon.orientationVertexArray=void 0),t&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const e=(e,t,n)=>{r+=t,r>e.length&&e.resize(r);for(let i=-t;i<0;i++)e.emplace(i+r,n)},t=(e,t,r)=>{n+=t,n>e.length&&e.resize(n);for(let i=-t;i<0;i++)e.emplace(i+n,r)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let r=0,n=0;for(let i=0;i<this.symbolInstances.length;i++){const r=this.symbolInstances.get(i),{numHorizontalGlyphVertices:n,numVerticalGlyphVertices:s,numIconVertices:o}=r,a=r.zOffset,l=o>0;if((n>0||s>0)&&(e(this.text.zOffsetVertexArray,n,a),e(this.text.zOffsetVertexArray,s,a)),l){const{placedIconSymbolIndex:e,verticalPlacedIconSymbolIndex:n}=r;e>=0&&t(this.icon.zOffsetVertexArray,o,a),n>=0&&t(this.icon.zOffsetVertexArray,r.numVerticalIconVertices,a)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return 0===this.symbolInstances.length&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(e,t,r,n,i){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(e),this.iconCollisionBox.upload(e)),this.text.upload(e,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,!1),null===this.hasAppearances&&(this.hasAppearances=this.layers.some(e=>e.appearances&&e.appearances.length>0)),this.icon.upload(e,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload,this.hasAppearances),this.uploaded=!0}updateAppearances(e,t,r,n){return!!(e&&t&&r)&&!(!this.icon.layoutVertexArray||0===this.icon.layoutVertexArray.length)&&!!this.icon.layoutVertexArray.arrayBuffer&&void(this.updateAppearanceBasedIconTextures(e,t,r,n)&&this.icon.layoutVertexBuffer&&null!==this.icon.layoutVertexArray.arrayBuffer&&this.icon.layoutVertexArray.length===this.icon.layoutVertexBuffer.length&&this.icon.layoutVertexBuffer.updateData(this.icon.layoutVertexArray))}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=O_(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(e,t){const r=this.lineVertexArray.length;if(void 0!==e.segment)for(const{x:n,y:i}of t)this.lineVertexArray.emplaceBack(n,i);return{lineStartIndex:r,lineLength:this.lineVertexArray.length-r}}addSymbols(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y){const _=e.indexArray,v=e.layoutVertexArray,x=e.globeExtVertexArray,b=e.segments.prepareSegment(4*y,v,_,this.canOverlap?s.sortKey:void 0),w=this.glyphOffsetArray.length,j=b.vertexLength,S=this.allowVerticalPlacement&&o===qg.vertical?Math.PI/2:0,T=s.text&&s.text.sections;for(let C=0;C<t.length;C++){const{tl:n,tr:i,bl:o,br:c,texPrimary:u,texSecondary:d,pixelOffsetTL:g,pixelOffsetBR:y,minFontScaleX:w,minFontScaleY:j,glyphOffset:k,isSDF:A,sectionIndex:E}=t[C],N=b.vertexLength,I=k[1];if(U_(v,l.x,l.y,n.x,I+n.y,u.x,u.y,r,A,g.x,g.y,w,j),U_(v,l.x,l.y,i.x,I+i.y,u.x+u.w,u.y,r,A,y.x,g.y,w,j),U_(v,l.x,l.y,o.x,I+o.y,u.x,u.y+u.h,r,A,g.x,y.y,w,j),U_(v,l.x,l.y,c.x,I+c.y,u.x+u.w,u.y+u.h,r,A,y.x,y.y,w,j),a){const{x:t,y:r,z:n}=a.anchor,[i,s,o]=a.up;q_(x,t,r,n,i,s,o),q_(x,t,r,n,i,s,o),q_(x,t,r,n,i,s,o),q_(x,t,r,n,i,s,o),H_(e.dynamicLayoutVertexArray,t,r,n,S)}else H_(e.dynamicLayoutVertexArray,l.x,l.y,l.z,S);if(f){const t=d||u;V_(e.iconTransitioningVertexArray,t.x,t.y),V_(e.iconTransitioningVertexArray,t.x+t.w,t.y),V_(e.iconTransitioningVertexArray,t.x,t.y+t.h),V_(e.iconTransitioningVertexArray,t.x+t.w,t.y+t.h)}_.emplaceBack(N,N+1,N+2),_.emplaceBack(N+1,N+2,N+3),b.vertexLength+=4,b.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(k[0]),C!==t.length-1&&E===t[C+1].sectionIndex||e.programConfigurations.populatePaintArrays(v.length,s,s.index,{},h,p,m,T&&T[E],this.worldview)}const k=y-t.length;0!==k&&this._addNullVertices(k,v,r,a,x,e,f,b,_);const A=a?a.anchor:l;e.placedSymbolArray.emplaceBack(A.x,A.y,A.z,l.x,l.y,w,this.glyphOffsetArray.length-w,j,c,u,l.segment,r?r[0]:0,r?r[1]:0,n[0],n[1],o,0,0,0,d,0),e.symbolInstanceIndices.push(g)}_addNullVertices(e,t,r,n,i,s,o,a,l){for(let c=0;c<e;c++){for(let a=0;a<4;a++)U_(t,0,0,0,0,0,0,r,!1,0,0,0,0),n?(q_(i,0,0,0,0,0,0),H_(s.dynamicLayoutVertexArray,0,0,0,0)):H_(s.dynamicLayoutVertexArray,0,0,0,0),o&&V_(s.iconTransitioningVertexArray,0,0);const e=a.vertexLength;l.emplaceBack(e,e+1,e+2),l.emplaceBack(e+1,e+2,e+3),a.vertexLength+=4,a.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(0)}}_commitLayoutVertex(e,t,r,n,i,s,o){e.emplaceBack(t,r,n,i,s,Math.round(o.x),Math.round(o.y))}_addCollisionDebugVertices(e,t,r,n,i,s,o){const a=r.segments.prepareSegment(4,r.layoutVertexArray,r.indexArray),l=a.vertexLength,c=o.tileAnchorX,u=o.tileAnchorY;for(let h=0;h<4;h++)r.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(r.collisionVertexArrayExt,t,e.padding,o.zOffset),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,c,u,new Se(e.x1,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,c,u,new Se(e.x2,e.y1)),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,c,u,new Se(e.x2,e.y2)),this._commitLayoutVertex(r.layoutVertexArray,n,i,s,c,u,new Se(e.x1,e.y2)),a.vertexLength+=4;const d=r.indexArray;d.emplaceBack(l,l+1),d.emplaceBack(l+1,l+2),d.emplaceBack(l+2,l+3),d.emplaceBack(l+3,l),a.primitiveLength+=4}_addTextDebugCollisionBoxes(e,t,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceTextSize(e,s,t,o);this._addCollisionDebugVertices(n,i,this.textCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}_addIconDebugCollisionBoxes(e,t,r,n,i,s){for(let o=n;o<i;o++){const n=r.get(o),i=this.getSymbolInstanceIconSize(e,t,s.placedIconSymbolIndex);this._addCollisionDebugVertices(n,i,this.iconCollisionBox,n.projectedAnchorX,n.projectedAnchorY,n.projectedAnchorZ,s)}}generateCollisionDebugBuffers(e,t,r){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new K_(Ia,gg.members,Ea),this.iconCollisionBox=new K_(Ia,gg.members,Ea);const n=dy(this.iconSizeData,e),i=dy(this.textSizeData,e,r);for(let s=0;s<this.symbolInstances.length;s++){const r=this.symbolInstances.get(s);this._addTextDebugCollisionBoxes(i,e,t,r.textBoxStartIndex,r.textBoxEndIndex,r),this._addTextDebugCollisionBoxes(i,e,t,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r),this._addIconDebugCollisionBoxes(n,e,t,r.iconBoxStartIndex,r.iconBoxEndIndex,r),this._addIconDebugCollisionBoxes(n,e,t,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex,r)}}getSymbolInstanceTextSize(e,t,r,n){const i=this.text.placedSymbolArray.get(t.rightJustifiedTextSymbolIndex>=0?t.rightJustifiedTextSymbolIndex:t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.leftJustifiedTextSymbolIndex>=0?t.leftJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex>=0?t.verticalPlacedTextSymbolIndex:n),s=uy(this.textSizeData,e,i)/_g;return this.tilePixelRatio*s}getSymbolInstanceIconSize(e,t,r){const n=this.icon.placedSymbolArray.get(r),i=uy(this.iconSizeData,e,n);return this.tilePixelRatio*i}_commitDebugCollisionVertexUpdate(e,t,r,n){e.emplaceBack(t,-r,-r,n),e.emplaceBack(t,r,-r,n),e.emplaceBack(t,r,r,n),e.emplaceBack(t,-r,r,n)}_updateTextDebugCollisionBoxes(e,t,r,n,i,s,o){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceTextSize(e,s,t,a);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,i,n.padding,s.zOffset)}}_updateIconDebugCollisionBoxes(e,t,r,n,i,s,o){for(let a=n;a<i;a++){const n=r.get(a),i=this.getSymbolInstanceIconSize(e,t,s.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,i,n.padding,s.zOffset)}}updateCollisionDebugBuffers(e,t,r,n){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const i=dy(this.iconSizeData,e,n),s=dy(this.textSizeData,e,r);for(let o=0;o<this.symbolInstances.length;o++){const a=this.symbolInstances.get(o);this._updateTextDebugCollisionBoxes(s,e,t,a.textBoxStartIndex,a.textBoxEndIndex,a,r),this._updateTextDebugCollisionBoxes(s,e,t,a.verticalTextBoxStartIndex,a.verticalTextBoxEndIndex,a,r),this._updateIconDebugCollisionBoxes(i,e,t,a.iconBoxStartIndex,a.iconBoxEndIndex,a,n),this._updateIconDebugCollisionBoxes(i,e,t,a.verticalIconBoxStartIndex,a.verticalIconBoxEndIndex,a,n)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(e,t,r,n,i,s,o,a,l){const c={};if(t<r){const{x1:r,y1:n,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:p}=e.get(t);c.textBox={x1:r,y1:n,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.textFeatureIndex=p}if(n<i){const{x1:t,y1:r,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:p}=e.get(n);c.verticalTextBox={x1:t,y1:r,x2:i,y2:s,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.verticalTextFeatureIndex=p}if(s<o){const{x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:p}=e.get(s);c.iconBox={x1:t,y1:r,x2:n,y2:i,padding:o,projectedAnchorX:a,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.iconFeatureIndex=p}if(a<l){const{x1:t,y1:r,x2:n,y2:i,padding:s,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h,featureIndex:p}=e.get(a);c.verticalIconBox={x1:t,y1:r,x2:n,y2:i,padding:s,projectedAnchorX:o,projectedAnchorY:l,projectedAnchorZ:u,tileAnchorX:d,tileAnchorY:h},c.verticalIconFeatureIndex=p}return c}deserializeCollisionBoxes(e){this.collisionArrays=[];for(let t=0;t<this.symbolInstances.length;t++){const r=this.symbolInstances.get(t);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(e,r.textBoxStartIndex,r.textBoxEndIndex,r.verticalTextBoxStartIndex,r.verticalTextBoxEndIndex,r.iconBoxStartIndex,r.iconBoxEndIndex,r.verticalIconBoxStartIndex,r.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(e,t){const r=e.placedSymbolArray.get(t),n=r.vertexStartIndex+4*r.numGlyphs;for(let i=r.vertexStartIndex;i<n;i+=4)e.indexArray.emplaceBack(i,i+1,i+2),e.indexArray.emplaceBack(i+1,i+2,i+3)}getSortedSymbolIndexes(e){if(this.sortedAngle===e&&void 0!==this.symbolInstanceIndexes)return this.symbolInstanceIndexes;const t=Math.sin(e),r=Math.cos(e),n=[],i=[],s=[];for(let o=0;o<this.symbolInstances.length;++o){s.push(o);const e=this.symbolInstances.get(o);n.push(0|Math.round(t*e.tileAnchorX+r*e.tileAnchorY)),i.push(e.featureIndex)}return s.sort((e,t)=>n[e]-n[t]||i[t]-i[e]),s}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let e=0;e<this.symbolInstances.length;++e)this.symbolInstanceIndexesSortedZOffset.push(e)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((e,t)=>this.symbolInstances.get(t).zOffset-this.symbolInstances.get(e).zOffset)}addToSortKeyRanges(e,t){const r=this.sortKeyRanges[this.sortKeyRanges.length-1];r&&r.sortKey===t?r.symbolInstanceEnd=e+1:this.sortKeyRanges.push({sortKey:t,symbolInstanceStart:e,symbolInstanceEnd:e+1})}sortFeatures(e){if(this.sortFeaturesByY&&this.sortedAngle!==e&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(e),this.sortedAngle=e,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const e of this.symbolInstanceIndexes){const t=this.symbolInstances.get(e);this.featureSortOrder.push(t.featureIndex);const{rightJustifiedTextSymbolIndex:r,centerJustifiedTextSymbolIndex:n,leftJustifiedTextSymbolIndex:i,verticalPlacedTextSymbolIndex:s,placedIconSymbolIndex:o,verticalPlacedIconSymbolIndex:a}=t;r>=0&&this.addIndicesForPlacedSymbol(this.text,r),n>=0&&n!==r&&this.addIndicesForPlacedSymbol(this.text,n),i>=0&&i!==n&&i!==r&&this.addIndicesForPlacedSymbol(this.text,i),s>=0&&this.addIndicesForPlacedSymbol(this.text,s),o>=0&&this.addIndicesForPlacedSymbol(this.icon,o),a>=0&&this.addIndicesForPlacedSymbol(this.icon,a)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}getElevationFeatureForText(e){const t=this.symbolInstances.get(this.text.symbolInstanceIndices[e]).elevationFeatureIndex;let r;return this.elevationFeatures&&t<this.elevationFeatures.length&&(r=this.elevationFeatures[t]),r}}function X_(e,t){return t.replace(/{([^{}]+)}/g,(t,r)=>r in e?String(e[r]):"")}let J_,Q_,$_;$s(Y_,"SymbolBucket",{omit:["layers","collisionBoxArray","compareText","features"]}),Y_.addDynamicAttributes=H_;class ev{constructor(e){this.type=e.property.overrides?e.property.overrides.runtimeType:yr,this.defaultValue=e}evaluate(e){if(e.formattedSection){const t=this.defaultValue.property.overrides;if(t&&t.hasOverride(e.formattedSection))return t.getOverride(e.formattedSection)}return e.feature&&e.featureState?this.defaultValue.evaluate(e.feature,e.featureState):this.defaultValue.property.specification.default}eachChild(e){this.defaultValue.isConstant()||e(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$s(ev,"FormatSectionOverride",{omit:["defaultValue"]});const tv=()=>$_||($_={layout:J_||(J_=new Do({"symbol-placement":new Mo(Fo.layout_symbol["symbol-placement"]),"symbol-spacing":new Mo(Fo.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Mo(Fo.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Lo(Fo.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Mo(Fo.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Mo(Fo.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Mo(Fo.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Mo(Fo.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Mo(Fo.layout_symbol["icon-ignore-placement"]),"icon-optional":new Mo(Fo.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Mo(Fo.layout_symbol["icon-rotation-alignment"]),"icon-size":new Lo(Fo.layout_symbol["icon-size"]),"icon-size-scale-range":new Mo(Fo.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Lo(Fo.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Lo(Fo.layout_symbol["icon-text-fit-padding"]),"icon-image":new Lo(Fo.layout_symbol["icon-image"]),"icon-image-use-theme":new Mo({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Lo(Fo.layout_symbol["icon-rotate"]),"icon-padding":new Mo(Fo.layout_symbol["icon-padding"]),"icon-keep-upright":new Mo(Fo.layout_symbol["icon-keep-upright"]),"icon-offset":new Lo(Fo.layout_symbol["icon-offset"]),"icon-anchor":new Lo(Fo.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Mo(Fo.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Mo(Fo.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Mo(Fo.layout_symbol["text-rotation-alignment"]),"text-field":new Lo(Fo.layout_symbol["text-field"]),"text-font":new Lo(Fo.layout_symbol["text-font"]),"text-size":new Lo(Fo.layout_symbol["text-size"]),"text-size-scale-range":new Mo(Fo.layout_symbol["text-size-scale-range"]),"text-max-width":new Lo(Fo.layout_symbol["text-max-width"]),"text-line-height":new Lo(Fo.layout_symbol["text-line-height"]),"text-letter-spacing":new Lo(Fo.layout_symbol["text-letter-spacing"]),"text-justify":new Lo(Fo.layout_symbol["text-justify"]),"text-radial-offset":new Lo(Fo.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Mo(Fo.layout_symbol["text-variable-anchor"]),"text-anchor":new Lo(Fo.layout_symbol["text-anchor"]),"text-max-angle":new Mo(Fo.layout_symbol["text-max-angle"]),"text-writing-mode":new Mo(Fo.layout_symbol["text-writing-mode"]),"text-rotate":new Lo(Fo.layout_symbol["text-rotate"]),"text-padding":new Mo(Fo.layout_symbol["text-padding"]),"text-keep-upright":new Mo(Fo.layout_symbol["text-keep-upright"]),"text-transform":new Lo(Fo.layout_symbol["text-transform"]),"text-offset":new Lo(Fo.layout_symbol["text-offset"]),"text-allow-overlap":new Mo(Fo.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Mo(Fo.layout_symbol["text-ignore-placement"]),"text-optional":new Mo(Fo.layout_symbol["text-optional"]),visibility:new Mo(Fo.layout_symbol.visibility)})),paint:Q_||(Q_=new Do({"icon-opacity":new Lo(Fo.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Lo(Fo.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Lo(Fo.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Lo(Fo.paint_symbol["text-emissive-strength"]),"icon-color":new Lo(Fo.paint_symbol["icon-color"]),"icon-halo-color":new Lo(Fo.paint_symbol["icon-halo-color"]),"icon-halo-width":new Lo(Fo.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Lo(Fo.paint_symbol["icon-halo-blur"]),"icon-translate":new Mo(Fo.paint_symbol["icon-translate"]),"icon-translate-anchor":new Mo(Fo.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Mo(Fo.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Lo(Fo.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Lo(Fo.paint_symbol["text-occlusion-opacity"]),"text-color":new Lo(Fo.paint_symbol["text-color"],{runtimeType:br,getOverride:e=>e.textColor,hasOverride:e=>!!e.textColor}),"text-halo-color":new Lo(Fo.paint_symbol["text-halo-color"]),"text-halo-width":new Lo(Fo.paint_symbol["text-halo-width"]),"text-halo-blur":new Lo(Fo.paint_symbol["text-halo-blur"]),"text-translate":new Mo(Fo.paint_symbol["text-translate"]),"text-translate-anchor":new Mo(Fo.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Mo(Fo.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Mo(Fo.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Mo(Fo.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Mo(Fo.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Lo(Fo.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},$_);class rv extends oa{constructor(e,t,r,n){super(e,tv(),t,r,n,e.layout?e.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=c([]),this.hasOcclusionOpacityProperties=void 0!==e.paint&&("icon-occlusion-opacity"in e.paint||"text-occlusion-opacity"in e.paint)}_handleSpecialPaintPropertyUpdate(e){"icon-occlusion-opacity"!==e&&"text-occlusion-opacity"!==e||(this.hasOcclusionOpacityProperties=!0)}recalculate(e,t){super.recalculate(e,t),this.appearances&&this.appearances.forEach(r=>{r.recalculate(e,t,this.iconImageUseTheme)}),"auto"===this.layout.get("icon-rotation-alignment")&&(this.layout._values["icon-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-rotation-alignment")&&(this.layout._values["text-rotation-alignment"]="point"!==this.layout.get("symbol-placement")?"map":"viewport"),"auto"===this.layout.get("text-pitch-alignment")&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),"auto"===this.layout.get("icon-pitch-alignment")&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const r=this.layout.get("text-writing-mode");if(r){const e=[];for(const t of r)e.indexOf(t)<0&&e.push(t);this.layout._values["text-writing-mode"]=e}else this.layout._values["text-writing-mode"]="point"===this.layout.get("symbol-placement")?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(e,t,r,n){return this._saturation===e&&this._contrast===t&&this._brightnessMin===r&&this._brightnessMax===n||(this._colorAdjustmentMatrix=function(e,t,r,n){e=it(e),t=nt(t);const i=a(),s=e/3,o=1-2*s,l=[o,s,s,0,s,o,s,0,s,s,o,0,0,0,0,1],c=.5-.5*t,u=n-r;return d(i,[u,0,0,0,0,u,0,0,0,0,u,0,r,r,r,1],[t,0,0,0,0,t,0,0,0,0,t,0,c,c,c,1]),d(i,i,l),i}(e,t,r,n),this._saturation=e,this._contrast=t,this._brightnessMin=r,this._brightnessMax=n),this._colorAdjustmentMatrix}getValueAndResolveTokens(e,t,r,n){const i=this.layout.get(e).evaluate(t,{},r,n),s=this._unevaluatedLayout._values[e];return s.isDataDriven()||Us(s.value)||!i?i:X_(t.properties,i)}getAppearanceValueAndResolveTokens(e,t,r,n,i){const s=e.getProperty(t);if(!s)return;const o=s.evaluate(r,{},n,i),a=e.getUnevaluatedProperties()._values[t];return a.isDataDriven()||Us(a.value)||!o||"string"!=typeof o?o:X_(r.properties,o)}createBucket(e){return new Y_(e)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const e of tv().paint.overridableProperties){if(!rv.hasPaintOverride(this.layout,e))continue;const t=this.paint.get(e),r=new ev(t),n=new Bs(r,t.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let i=null;i="constant"===t.value.kind||"source"===t.value.kind?new qs("source",n):new Ws("composite",n,t.value.zoomStops,t.value.interpolationType),this.paint._values[e]=new Io(t.property,i,t.parameters)}}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven())&&rv.hasPaintOverride(this.layout,e)}static hasPaintOverride(e,t){const r=e.get("text-field"),n=tv().paint.properties[t];let i=!1;const s=e=>{for(const t of e)if(n.overrides&&n.overrides.hasOverride(t))return void(i=!0)};if("constant"===r.value.kind&&r.value.value instanceof Dr)s(r.value.value.sections);else if("source"===r.value.kind){const e=t=>{i||(t instanceof qr&&Ur(t.value)===Tr?s(t.value.sections):t instanceof Zr?s(t.sections):t.eachChild(e))},t=r.value;t._styleExpression&&e(t._styleExpression.expression)}return i}getProgramIds(){return["symbol"]}getDefaultProgramParams(e,t,r){return{config:new zl(this,{zoom:t,lut:r}),overrideFog:!1}}hasElevation(){return this.layout&&"hd-road-markup"===this.layout.get("symbol-elevation-reference")}}let nv,iv,sv,ov;var av=da([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function lv(e,t,r,n,i,a,l,c){const u=[e,t,1,r,n,1,i,a,1],d=[l,c,1],h=s([],u),[p,m,f]=q(d,d,h);return o(u,u,[p,0,0,0,m,0,0,0,f])}function cv(e,t,r,n,i,a,l,c){const u=function(e,t,r,n,i,a,l,c){const u=lv(0,0,1,0,1,1,0,1),d=lv(e,t,r,n,i,a,l,c);return o(d,d,s([],u))}(e,t,r,n,i,a,l,c);return[u[2]/u[8]/Bn,u[5]/u[8]/Bn]}function uv(e){return[e[0],Math.min(Math.max(e[1],-fc),fc)]}class dv extends nr{constructor(e,t,r,n){super(),this.id=e,this.dispatcher=r,this.coordinates=t.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(n),this.options=t,this._dirty=!1}load(e,t){if(this._loaded=t||!1,this.fire(new $t("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return e&&(this.coordinates=e),this._loaded=!0,void this._finishLoading();this._imageRequest=Wt(this.map._requestManager.transformRequest(this.url,Rt.Image),(t,r)=>{this._imageRequest=null,this._loaded=!0,t?this.fire(new er(t)):r&&(this.image=r instanceof HTMLImageElement?gt.getImageData(r):r,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,e&&(this.coordinates=e),this._finishLoading())})}loaded(){return this._loaded}updateImage(e){return e.url?(this._imageRequest&&e.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=e.url,this.load(e.coordinates,this._loaded),this):this}setTexture(e){if(!(e.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new Im(this.map.painter.context,e.handle),this.width=e.dimensions[0],this.height=e.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new $t("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(e){this.map=e,this.load()}onRemove(e){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof Im||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(e){if(this.coordinates=e,this._boundsArray=void 0,this._unsupportedCoords=!1,!e.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let t=e[0][1],r=e[0][1];for(const i of e)i[1]>r&&(r=i[1]),i[1]<t&&(t=i[1]);const n=(r+t)/2;if(n>fc?this.onNorthPole=!0:n<-fc&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const t=e.map(xc.fromLngLat);this.tileID=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const c of e)t=Math.min(t,c.x),r=Math.min(r,c.y),n=Math.max(n,c.x),i=Math.max(i,c.y);const s=Math.max(n-t,i-r),o=Math.max(0,Math.floor(-Math.log2(s))),a=Math.pow(2,o);let l=Math.floor((t+n)/2*a);return l>1&&(l-=1),new Au(o,l,Math.floor((r+i)/2*a))}(t),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new $t("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof Im||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(e){for(const s in this.tiles){const e=this.tiles[s];"loaded"!==e.state&&(e.state="loaded",e.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const t=g_(new Au(0,0,0),this.map.transform.projection),r=[t.projection.project(this.coordinates[0][0],this.coordinates[0][1]),t.projection.project(this.coordinates[1][0],this.coordinates[1][1]),t.projection.project(this.coordinates[2][0],this.coordinates[2][1]),t.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(e){const t=e[1].x-e[0].x,r=e[1].y-e[0].y,n=e[2].x-e[1].x,i=e[2].y-e[1].y,s=e[3].x-e[2].x,o=e[3].y-e[2].y,a=e[0].x-e[3].x,l=e[0].y-e[3].y,c=t*i-n*r,u=n*o-s*i,d=s*l-a*o,h=a*r-t*l;return c>0&&u>0&&d>0&&h>0||c<0&&u<0&&d<0&&h<0}(r))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const n=g_(this.tileID,this.map.transform.projection),[i,a,l,c]=this.coordinates.map(e=>{const t=n.projection.project(e[0],e[1]);return y_(n,t)._round()});this.perspectiveTransform=cv(i.x,i.y,a.x,a.y,l.x,l.y,c.x,c.y);const u=this._boundsArray=new fa;u.emplaceBack(i.x,i.y,0,0),u.emplaceBack(a.x,a.y,Bn,0),u.emplaceBack(c.x,c.y,0,Bn),u.emplaceBack(l.x,l.y,Bn,Bn),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=e.createVertexBuffer(u,av.members),this.boundsSegments=dl.simpleSegment(0,0,4,2);const d=[],h=[uv((p=this.coordinates)[0]),uv(p[1]),uv(p[2]),uv(p[3])];var p;const[m,f,g,y]=function(e){let t=e[0][0],r=t,n=e[0][1],i=n;for(let s=1;s<e.length;s++)e[s][0]<t?t=e[s][0]:e[s][0]>r&&(r=e[s][0]),e[s][1]<n?n=e[s][1]:e[s][1]>i&&(i=e[s][1]);return[t,n,r-t,i-n]}(h);{const n=new fa,[i,a,l,c]=function(e){let t=e[0].x,r=t,n=e[0].y,i=n;for(let s=1;s<e.length;s++)e[s].x<t?t=e[s].x:e[s].x>r&&(r=e[s].x),e[s].y<n?n=e[s].y:e[s].y>i&&(i=e[s].y);return[t,n,r-t,i-n]}(r),u=e=>[(e.x-i)/l,(e.y-a)/c],[h,p,_,v]=r.map(u),x=function(e,t,r,n,i,a,l,c){const u=lv(0,0,1,0,1,1,0,1);return o(u,u,s([],lv(e,t,r,n,i,a,l,c)))}(h[0],h[1],p[0],p[1],_[0],_[1],v[0],v[1]);this.elevatedGlobePerspectiveTransform=cv(h[0],h[1],p[0],p[1],_[0],_[1],v[0],v[1]);const b=(e,t)=>{d.push(e.lng);const r=Math.round((e.lng-m)/g*Bn),i=Math.round((e.lat-f)/y*Bn),s=u(t),o=q([],[s[0],s[1],1],x),a=Math.round(o[0]/o[2]*Bn),l=Math.round(o[1]/o[2]*Bn);n.emplaceBack(r,i,a,l)},w=r[3].x-r[0].x,j=r[3].y-r[0].y,S=r[2].x-r[1].x,T=r[2].y-r[1].y;for(let e=0;e<65;e++){const n=e/64,i=[r[0].x+n*w,r[0].y+n*j],s=[r[1].x+n*S,r[1].y+n*T],o=s[0]-i[0],a=s[1]-i[1];for(let e=0;e<65;e++){const r=e/64,n={x:i[0]+o*r,y:i[1]+a*r};b(t.projection.unproject(n.x,n.y),n)}}this.elevatedGlobeVertexBuffer=e.createVertexBuffer(n,av.members)}{this.maxLongitudeTriangleSize=0;let t=[],r=new La;const n=(e,n,i)=>{r.emplaceBack(e,n,i);const s=d[e],o=d[n],a=d[i],l=Math.min(Math.min(s,o),a),c=Math.max(Math.max(s,o),a)-l;c>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=c),t.push(l+c/2)};for(let e=0;e<64;e++)for(let t=0;t<64;t++){const r=65*e+t,i=r+1,s=r+65,o=s+1;n(r,s,i),n(i,s,o)}[t,r]=function(e,t){const r=Array.from({length:e.length},(e,t)=>t);r.sort((t,r)=>e[t]-e[r]);const n=[],i=new La;for(let s=0;s<r.length;s++){const o=r[s];n.push(e[o]);const a=3*o,l=a+1;i.emplaceBack(t.uint16[a],t.uint16[l],t.uint16[l+1])}return[n,i]}(t,r),this.elevatedGlobeTrianglesCenterLongitudes=t,this.elevatedGlobeIndexBuffer=e.createIndexBuffer(r)}this.elevatedGlobeSegments=dl.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,g/Bn,0,y/Bn,0,0,f,m,0])}prepare(){const e=0!==Object.keys(this.tiles).length;if(this.tileID&&!e)return;const t=this.map.painter.context,r=t.gl;!this._dirty||this.texture instanceof Im||(this.texture?this.texture.update(this.image):(this.texture=new Nm(t,this.image,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE)),this._dirty=!1),e&&this._prepareData(t)}loadTile(e,t){this.tileID&&this.tileID.equals(e.tileID.canonical)?(this.tiles[String(e.tileID.wrap)]=e,e.buckets={},t(null)):(e.state="errored",t(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(e){const t=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!t)return null;const r=this.elevatedGlobeTrianglesCenterLongitudes;let n=(i=e+180)+360*Math.round((r[0]-i)/360);var i;const s=new dl,o=(e,r)=>{s.segments.push({vertexOffset:0,primitiveOffset:e,vertexLength:t.segments[0].vertexLength,primitiveLength:r,sortKey:void 0,vaos:{}})},a=.51*this.maxLongitudeTriangleSize;if(Math.abs(r[0]-n)<=a){const e=rt(r,0,r.length,n+a);return e===r.length||o(e,tt(r,e+1,r.length,n+360-a)-e),s}n<r[0]&&(n+=360);const l=tt(r,0,r.length,n-a);if(l===r.length)return o(0,r.length),s;o(0,l-0);const c=rt(r,l+1,r.length,n+a);return c!==r.length&&o(c,r.length-c),s}}const hv=(Math.pow(256,2)-1)/16907520;class pv extends oa{constructor(e,t,r,n){super(e,{layout:sv||(sv=new Do({visibility:new Mo(Fo.layout_raster.visibility)})),paint:ov||(ov=new Do({"raster-opacity":new Mo(Fo.paint_raster["raster-opacity"]),"raster-color":new Ro(Fo.paint_raster["raster-color"]),"raster-color-mix":new Mo(Fo.paint_raster["raster-color-mix"]),"raster-color-range":new Mo(Fo.paint_raster["raster-color-range"]),"raster-hue-rotate":new Mo(Fo.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Mo(Fo.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Mo(Fo.paint_raster["raster-brightness-max"]),"raster-saturation":new Mo(Fo.paint_raster["raster-saturation"]),"raster-contrast":new Mo(Fo.paint_raster["raster-contrast"]),"raster-resampling":new Mo(Fo.paint_raster["raster-resampling"]),"raster-fade-duration":new Mo(Fo.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Mo(Fo.paint_raster["raster-emissive-strength"]),"raster-array-band":new Mo(Fo.paint_raster["raster-array-band"]),"raster-elevation":new Mo(Fo.paint_raster["raster-elevation"]),"raster-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(e){return!(e&&e._source instanceof dv&&(e._source.onNorthPole||e._source.onSouthPole))&&0===this.paint.get("raster-elevation")}_handleSpecialPaintPropertyUpdate(e){"raster-color"!==e&&"raster-color-range"!==e||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(e){if(!this.hasColorMap())return;if(!this._curRampRange)return;const t=this._transitionablePaint._values["raster-color"].value.expression,[r,n]=e||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(r)&&isNaN(n)||r===this._curRampRange[0]&&n===this._curRampRange[1]||(this.colorRamp=Td({expression:t,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:r,end:n}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[r,n])}}let mv,fv,gv,yv,_v;class vv extends oa{constructor(e,t,r,n){super(e,{layout:mv||(mv=new Do({visibility:new Mo(Fo["layout_raster-particle"].visibility)})),paint:fv||(fv=new Do({"raster-particle-array-band":new Mo(Fo["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Mo(Fo["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Ro(Fo["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Mo(Fo["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Mo(Fo["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Mo(Fo["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Mo(Fo["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Mo(Fo["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._updateColorRamp(),this.lastInvalidatedAt=gt.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(e){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return"none"!==this.visibility}isDraped(e){return!1}_handleSpecialPaintPropertyUpdate(e){"raster-particle-color"!==e&&"raster-particle-max-speed"!==e||(this._updateColorRamp(),this._invalidateAnimationState()),"raster-particle-count"===e&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const e=this._transitionablePaint._values["raster-particle-color"].value.expression,t=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Td({expression:e,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:t}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=gt.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class xv extends oa{constructor(e,t){super(e,{},t,null),this.implementation=e,e.slot&&(this.slot=e.slot)}is3D(e){return"3d"===this.implementation.renderingMode}hasOffscreenPass(){return void 0!==this.implementation.prerender}isDraped(e){return void 0!==this.implementation.renderToTile}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(e){this.implementation.onAdd&&this.implementation.onAdd(e,e.painter.context.gl)}onRemove(e){this.implementation.onRemove&&this.implementation.onRemove(e,e.painter.context.gl)}}function bv(e,t,r){const n=[0,0,1],i=te([]);return ne(i,i,r?-Ce(e)+Math.PI:Ce(e)),re(i,i,-Ce(t)),W(n,n,i),O(n,n)}const wv={None:0,Model:1,Symbol:2,FillExtrusion:4};class jv{constructor(e,t,r,n){this.message=(e?"".concat(e,": "):"")+r,n&&(this.identifier=n),null!=t&&t.__line__&&(this.line=t.__line__)}}function Sv(e,t){const r=-1===e.indexOf("://");try{return new URL(e,r&&t?"http://example.com":void 0),!0}catch(e){return!1}}class Tv{constructor(e,t){this.feature=e,this.instancedDataOffset=t,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class kv{constructor(){this.maxScale=1,this.maxXYTranslationDistance=0,this.instancedDataArray=new Ha,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}colorForInstance(e){const t=16*e,r=this.instancedDataArray.float32;let n=Math.floor(r[t+2]);const i=1.05*(r[t+2]-n);return n/=100,[r[t]%1*1.05,r[t+1]%1*1.05,i,n]}tileCoordinatesForInstance(e){const t=16*e,r=this.instancedDataArray.float32;let n=r[t+0];return n=n>Bn?n-Bn:n,new Se(Math.trunc(n),Math.trunc(r[t+1]))}translationForInstance(e){const t=16*e,r=this.instancedDataArray.float32;return[r[t+4],r[t+5],r[t+6]]}rotationScaleForInstance(e){const t=16*e,r=this.instancedDataArray.float32;return[r[t+7],r[t+8],r[t+9],r[t+10],r[t+11],r[t+12],r[t+13],r[t+14],r[t+15]]}transformForInstance(e){const t=16*e,r=this.instancedDataArray.float32;return[r[t+7],r[t+8],r[t+9],r[t+4],r[t+10],r[t+11],r[t+12],r[t+5],r[t+13],r[t+14],r[t+15],r[t+6],0,0,0,1]}}class Av{constructor(e){this.zoom=e.zoom,this.canonical=e.canonical,this.overscaledZ=this.canonical.z+Math.log2(e.overscaling),this.layers=e.layers,this.layerIds=this.layers.map(e=>e.fqid),this.projection=e.projection,this.index=e.index,this.worldview=e.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=e.styleDefinedModelURLs,this.hasAppearances=null}updateFootprints(e,t){}updateAppearances(e,t,r,n){}populate(e,t,r,n){this.tileToMeter=vc(r);const i=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:s,id:o,index:a,sourceLayerIndex:l}of e){const e=null!=o?o:s.properties&&s.properties.hasOwnProperty("id")?s.properties.id:void 0,c=Ec(s,i);if(!this.layers[0]._featureFilter.filter(new So(this.zoom,{worldview:this.worldview,activeFloors:t.activeFloors}),c,r))continue;const u={id:e,sourceLayerIndex:l,index:a,geometry:i?c.geometry:Cc(s,r,n),properties:s.properties,type:s.type,patterns:{}},d=this.addFeature(u,u.geometry,c);d&&t.featureIndex.insert(s,u.geometry,a,l,this.index,this.instancesPerModel[d].instancedDataArray.length,Bn/32)}this.lookup=null}evaluateQueryRenderedFeaturePadding(){const e=this.layers[0].modelManager,t=this.layers[0].scope;let r=0;for(const n of this.modelUris){const i=e.getModel(n,t);if(!i)continue;const s=this.instancesPerModel[n];if(s){const e=.5*L(i.aabb.max,i.aabb.min)*s.maxScale+s.maxXYTranslationDistance,t=Math.min(Bn,Math.max(e/this.tileToMeter,Bn/32));r=Math.max(t,r)}}return r}update(e,t,r,n){for(const i in this.instancesPerModel){const t=this.instancesPerModel[i];for(const r in e)t.idToFeaturesIndex.hasOwnProperty(r)&&(this.evaluate(t.features[t.idToFeaturesIndex[r]],e[r],t,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let e=!1;for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];for(const t of r.features){const n=this.layers[0],i=t.feature,s=this.canonical,o=n.paint.get("model-rotation").evaluate(i,{},s),a=n.paint.get("model-scale").evaluate(i,{},s),l=n.paint.get("model-translation").evaluate(i,{},s);G(t.rotation,o)&&G(t.scale,a)&&G(t.translation,l)||(this.evaluate(t,t.featureStates,r,!0),e=!0)}}return e}updateReplacement(e,t,r,n){if(t.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=t.updateTime;const i=t.getReplacementRegionsForTile(e.toUnwrapped(),!0);if(Vh(this.activeReplacements,i))return!1;this.activeReplacements=i;let s=!1;for(const o in this.instancesPerModel){const t=this.instancesPerModel[o],i=t.instancedDataArray;for(const o of t.features){const t=o.instancedDataOffset,a=o.instancedDataCount;for(let o=0;o<a;o++){const a=16*(o+t);let l=i.float32[a+0];const c=l>Bn;l=c?l-Bn:l;const u=Math.floor(l),d=Math.floor(i.float32[a+1]);let h=!1;for(const t of this.activeReplacements)if(!Oh(t,r,wv.Model,n)&&!(t.min.x>u||u>t.max.x||t.min.y>d||d>t.max.y)&&(h=Kh(Zh(u,d,e.canonical,t.footprintTileId.canonical),t.footprint),h))break;i.float32[a]=h?l+Bn:l,s=s||h!==c}}}return s}isEmpty(){for(const e in this.instancesPerModel)if(0!==this.instancesPerModel[e].instancedDataArray.length)return!1;return!0}uploadPending(){return!this.uploaded}upload(e){if(!this.uploaded)for(const t in this.instancesPerModel){const r=this.instancesPerModel[t];r.instancedDataArray.length<0||0===r.instancedDataArray.length||(r.instancedDataBuffer?r.instancedDataBuffer.updateData(r.instancedDataArray):r.instancedDataBuffer=e.createVertexBuffer(r.instancedDataArray,Fm.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(e){for(const r in this.instancesPerModel){const e=this.instancesPerModel[r];0!==e.instancedDataArray.length&&e.instancedDataBuffer&&e.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(e&&t&&this.modelUris&&this.modelsRequested)for(const r of this.modelUris)t.removeModel(r,"",!0)}addFeature(e,t,r){const n=this.layers[0],i=n.layout.get("model-id").evaluate(r,{},this.canonical);if(!i)return Ze("modelId is not evaluated for layer ".concat(n.id," and it is not going to get rendered.")),i;(Sv(i,!1)||void 0!==this.styleDefinedModelURLs[i])&&(this.modelUris.includes(i)||this.modelUris.push(i)),this.instancesPerModel[i]||(this.instancesPerModel[i]=new kv);const s=this.instancesPerModel[i],o=s.instancedDataArray,a=new Tv(r,o.length);for(const l of t)for(const e of l){if(e.x<0||e.x>=Bn||e.y<0||e.y>=Bn)continue;if(0!==this.lookupDim){const t=(this.lookupDim-1)/Bn,r=this.lookupDim*(e.y*t|0)+e.x*t|0;if(this.lookup){if(0!==this.lookup[r])continue;this.lookup[r]=1}}this.instanceCount++;const t=o.length;o.resize(t+1),s.instancesEvaluatedElevation.push(0),o.float32[16*t]=e.x,o.float32[16*t+1]=e.y}return a.instancedDataCount=s.instancedDataArray.length-a.instancedDataOffset,a.instancedDataCount>0&&(e.id&&(s.idToFeaturesIndex[e.id]=s.features.length),s.features.push(a),this.evaluate(a,{},s,!1)),i}getModelUris(){return this.modelUris}evaluate(e,t,r,n){const i=this.layers[0],s=e.feature,o=this.canonical,a=e.rotation=i.paint.get("model-rotation").evaluate(s,t,o),l=e.scale=i.paint.get("model-scale").evaluate(s,t,o),c=e.translation=i.paint.get("model-translation").evaluate(s,t,o),u=Object.assign({},i.paint.get("model-color").evaluate(s,t,o));u.a=i.paint.get("model-color-mix-intensity").evaluate(s,t,o);const d=[];this.maxVerticalOffset<c[2]&&(this.maxVerticalOffset=c[2]);const h=c[0]*c[0]+c[1]*c[1],p=h>0?Math.sqrt(h):0;r.maxScale=Math.max(Math.max(r.maxScale,l[0]),Math.max(l[1],l[2])),r.maxXYTranslationDistance=Math.max(r.maxXYTranslationDistance,p),this.maxScale=Math.max(Math.max(this.maxScale,l[0]),Math.max(l[1],l[2])),Hm(d,a,l);const m=Math.round(100*u.a)+u.b/1.05;for(let f=0;f<e.instancedDataCount;++f){const t=e.instancedDataOffset+f,i=16*t,s=r.instancedDataArray.float32;let a=0;n&&(a=s[i+6]-r.instancesEvaluatedElevation[t]);const l=0|s[i+1];s[i]=(0|s[i])+u.r/1.05,s[i+1]=l+u.g/1.05,s[i+2]=m,s[i+3]=1/(o.z>10?this.tileToMeter:vc(o,l)),s[i+4]=c[0],s[i+5]=c[1],s[i+6]=c[2]+a,s[i+7]=d[0],s[i+8]=d[1],s[i+9]=d[2],s[i+10]=d[4],s[i+11]=d[5],s[i+12]=d[6],s[i+13]=d[8],s[i+14]=d[9],s[i+15]=d[10],r.instancesEvaluatedElevation[t]=c[2]}}}let Cv,Ev;$s(Av,"ModelBucket",{omit:["layers"]}),$s(kv,"PerModelAttributes"),$s(Tv,"ModelFeature");class Nv{constructor(e,t,r){this._demTile=e,this._dem=this._demTile.dem,this._scale=t,this._offset=r}static create(e,t,r){const n=r||e.findDEMTileFor(t);if(!n||!n.dem)return;const i=n.dem,s=n.tileID,o=1<<t.canonical.z-s.canonical.z;return new Nv(n,i.dim/Bn/o,[(t.canonical.x/o-s.canonical.x)*i.dim,(t.canonical.y/o-s.canonical.y)*i.dim])}tileCoordToPixel(e,t){const r=t*this._scale+this._offset[1];return new Se(Math.floor(e*this._scale+this._offset[0]),Math.floor(r))}getElevationAt(e,t,r,n){const i=e*this._scale+this._offset[0],s=t*this._scale+this._offset[1],o=Math.floor(i),a=Math.floor(s),l=this._dem;return n=!!n,r?hr(hr(l.get(o,a,n),l.get(o,a+1,n),s-a),hr(l.get(o+1,a,n),l.get(o+1,a+1,n),s-a),i-o):l.get(o,a,n)}getElevationAtPixel(e,t,r){return this._dem.get(e,t,!!r)}getMeterToDEM(e){return(1<<this._demTile.tileID.canonical.z)*dc(1,e)*this._dem.stride}}const Iv=new Float32Array(262144),Pv=new Uint8Array(262144);function Mv(e){let t=0;if(e.meshes)for(const r of e.meshes)t=Math.max(t,r.aabb.max[2]);if(e.children)for(const r of e.children)t=Math.max(t,Mv(r));return t}function Lv(e,t,r){if(e.meshes)for(const n of e.meshes){if(n.aabb.min[0]===1/0)continue;const i=Qc.applyTransform(n.aabb,e.globalMatrix);r.insert(t,i.min[0],i.min[1],i.max[0],i.max[1])}if(e.children)for(const n of e.children)Lv(n,t,r)}const Rv=["","wall","door","roof","window","lamp","logo"];class Dv{constructor(e){this.node=e,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:e.id,geometry:[],properties:{height:Mv(e)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new Qc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let e=0;const t=new Qc([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const r of this.node.meshes)this.node.lightMeshIndex!==e&&(r.transformedAabb=Qc.applyTransformFast(r.aabb,this.node.globalMatrix),t.encapsulate(r.transformedAabb)),e++;this.aabb=t}return this.aabb}}class Fv{constructor(e,t,r,n,i,s,o,a){this.id=r,this.layers=e,this.layerIds=this.layers.map(e=>e.fqid),this.stateDependentLayerIds=this.layers.filter(e=>e.isStateDependent()).map(e=>e.id),this.modelTraits|=Xm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,n&&(this.modelTraits|=Xm.HasMapboxMeshFeatures),i&&(this.modelTraits|=Xm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=s,this.worldview=a,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const l of t)this.nodesInfo.push(new Dv(l)),Lv(l,o.featureIndexArray.length,o.grid),o.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,o.bucketLayerIDs.length-1,0);this.states={},this.hasAppearances=null}updateFootprints(e,t){for(const r of this.getNodesInfo()){const n=r.node;n.footprint&&t.push({footprint:n.footprint,id:e})}}updateAppearances(e,t,r,n){}update(e){const t=0!==Object.keys(e).length;if(t&&!this.stateDependentLayers.length)return;const r=t?this.stateDependentLayers:this.layers;if(!Te(e,this.states))for(const n of r)this.evaluate(n,e);this.states=structuredClone(e)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(e){if(!this.needsUpload)return;const t=this.getNodesInfo();for(const r of t){const t=r.node;this.uploaded?this.updatePbrBuffer(t):tf(t,e,!0)}for(const r of t)rf(r.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(e){let t=!1;if(!e.meshes)return t;for(const r of e.meshes)r.pbrBuffer&&(r.pbrBuffer.updateData(r.featureArray),t=!0);return t}needsReEvaluation(e,t,r){const n=e.transform.projectionOptions,i=e.style.getBrightness(),s=this.brightness!==i;if(!this.uploaded||this.dirty||n.name!==this.projection.name||Ov(r.paint.get("model-color").value,s)||Ov(r.paint.get("model-color-mix-intensity").value,s)||Ov(r.paint.get("model-roughness").value,s)||Ov(r.paint.get("model-emissive-strength").value,s)||Ov(r.paint.get("model-height-based-emissive-strength-multiplier").value,s)){this.projection=n,this.brightness=i;const e=this.getNodesInfo();for(const t of e)t.state=null;return!0}return!1}evaluateTransform(e,t){if(e.transform.zoom===this.zoom)return;this.zoom=e.transform.zoom;const r=this.getNodesInfo(),n=this.id.canonical;for(const i of r){const e=i.feature;i.evaluatedTranslation=t.paint.get("model-translation").evaluate(e,{},n),i.evaluatedScale=t.paint.get("model-scale").evaluate(e,{},n)}}evaluate(e,t){const r=this.getNodesInfo();for(const n of r){if(!n.node.meshes)continue;const r=n.feature,i=t&&t[r.id];if(Te(i,n.state))continue;n.state=structuredClone(i);const s=n.node.meshes&&n.node.meshes[0].featureData,o=n.evaluatedColor[2],a=n.evaluatedRMEA[2],l=this.id.canonical;if(n.hasTranslucentParts=!1,s){for(let t=0;t<Rv.length;t++){const s=Rv[t];s.length&&(r.properties.part=s);const o=e.paint.get("model-color").evaluate(r,i,l).toPremultipliedRenderColor(null),a=e.paint.get("model-color-mix-intensity").evaluate(r,i,l);n.evaluatedColor[t]=[o.r,o.g,o.b,a],n.evaluatedRMEA[t][0]=e.paint.get("model-roughness").evaluate(r,i,l),n.evaluatedRMEA[t][2]=e.paint.get("model-emissive-strength").evaluate(r,i,l),n.evaluatedRMEA[t][3]=o.a,n.emissionHeightBasedParams[t]=e.paint.get("model-height-based-emissive-strength-multiplier").evaluate(r,i,l),!n.hasTranslucentParts&&o.a<1&&(n.hasTranslucentParts=!0)}delete r.properties.part,Bv(n,o!==n.evaluatedColor[2]||a!==n.evaluatedRMEA[2],this.modelTraits)}else n.evaluatedRMEA[0][2]=e.paint.get("model-emissive-strength").evaluate(r,i,l);n.evaluatedTranslation=e.paint.get("model-translation").evaluate(r,i,l),n.evaluatedScale=e.paint.get("model-scale").evaluate(r,i,l),this.updatePbrBuffer(n.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(e,t,r,n){const i=e.findDEMTileFor(r);if(i&&(i.tileID.canonical!==this.terrainTile||t!==this.terrainExaggeration)){if(i.dem&&i.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=i.tileID.overscaledZ;const t=Nv.create(e,r,i);if(!t)return;this.modelTraits&Xm.HasMapboxMeshFeatures&&this.updateDEM(e,t,r,n);for(const e of this.getNodesInfo()){const r=e.node;if(!r.footprint||!r.footprint.vertices||!r.footprint.vertices.length)continue;const n=r.footprint.vertices;let i=t.getElevationAt(n[0].x,n[0].y,!0,!0);for(let e=1;e<n.length;e++)i=Math.min(i,t.getElevationAt(n[e].x,n[e].y,!0,!0));r.elevation=i}}this.terrainTile=i.tileID.canonical,this.terrainExaggeration=t}}updateDEM(e,t,r,n){let i=t._dem._modifiedForSources[n];if(void 0===i&&(t._dem._modifiedForSources[n]=[],i=t._dem._modifiedForSources[n]),i.includes(r.canonical))return;const s=t._dem.dim;i.push(r.canonical);let o=!1;for(const a of this.getNodesInfo()){const e=a.node;if(!e.footprint||!e.footprint.grid)continue;const r=e.footprint.grid,n=t.tileCoordToPixel(r.min.x,r.min.y),i=t.tileCoordToPixel(r.max.x,r.max.y),l=Math.min(Math.min(s-i.y,n.x),Math.min(n.y,s-i.x));if(l<0)continue;const c=Le(l,2,5);let u=Math.max(0,n.x-c),d=Math.max(0,n.y-c),h=Math.min(i.x+c,s-1),p=Math.min(i.y+c,s-1);for(let t=d;t<=p;++t)for(let e=u;e<=h;++e)Pv[t*s+e]=255;let m=0,f=0;for(let o=0;o<r.cellsY;++o)for(let e=0;e<r.cellsX;++e){if(!r.cells[o*r.cellsX+e])continue;const n=t.tileCoordToPixel(r.min.x+e/r.xScale,r.min.y+o/r.yScale),i=t.tileCoordToPixel(r.min.x+(e+1)/r.xScale,r.min.y+(o+1)/r.yScale);for(let e=n.y;e<=Math.min(i.y+1,s-1);++e)for(let r=n.x;r<=Math.min(i.x+1,s-1);++r)255===Pv[e*s+r]&&(Pv[e*s+r]=0,m+=t.getElevationAtPixel(r,e),f++)}const g=m/f;u=Math.max(1,n.x-c),d=Math.max(1,n.y-c),h=Math.min(i.x+c,s-2),p=Math.min(i.y+c,s-2),o=!0;for(let o=d;o<=p;++o)for(let e=u;e<=h;++e)0===Pv[o*s+e]&&(Iv[o*s+e]=t._dem.set(e,o,g));for(let o=1;o<c;++o){u=Math.max(1,n.x-o),d=Math.max(1,n.y-o),h=Math.min(i.x+o,s-2),p=Math.min(i.y+o,s-2);for(let e=d;e<=p;++e)for(let r=u;r<=h;++r){const n=e*s+r;if(255===Pv[n]){let i=0,a=0,l=-1,u=-1;for(let t=-1;t<=1;++t)for(let n=-1;n<=1;++n){const c=(e+t)*s+r+n;if(Pv[c]>=o)continue;const d=Iv[c],h=Math.abs(d);h>a&&(i=d,a=h,l=n,u=t)}if(a>.1){const s=1-(o+.5*Math.abs(l*u))/c;let a=t._dem.get(r,e)+i*s;const d=t._dem.get(r+l,e+u),h=t._dem.get(r-l,e-u,!0);(a-d)*(a-h)>0&&(a=(d+h)/2),Iv[n]=t._dem.set(r,e,a),Pv[n]=o}}}}}o&&(t._demTile.needsDEMTextureUpload=!0,t._dem._timestamp=gt.now())}setFilter(e){this.filter=e?Uo(e):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(e=>this.filter.filter(new So(this.id.overscaledZ,{worldview:this.worldview}),e.feature,this.id.canonical)):this.nodesInfo}destroy(){const e=this.getNodesInfo();for(const t of e)rf(t.node),nf(t.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(e,t){if(t.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=t.updateTime;const r=t.getReplacementRegionsForTile(e.toUnwrapped());for(const n of this.getNodesInfo()){const e=n.node.footprint;n.hiddenByReplacement=!!e&&!r.find(t=>t.footprint===e)}}getHeightAtTileCoord(e,t){const r=[],n=[0,0,0],i=c([]);for(const s of this.getNodesInfo()){const o=s.node.meshes[0],a=o.transformedAabb;if(e<a.min[0]||t<a.min[1]||e>a.max[0]||t>a.max[1])continue;if(!0===s.node.hidden)return{height:1/0,maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]};u(i,s.node.globalMatrix),n[0]=e,n[1]=t,V(n,n,i);const l=(n[0]-o.aabb.min[0])/(o.aabb.max[0]-o.aabb.min[0])*Ym|0,c=Math.min(63,(n[1]-o.aabb.min[1])/(o.aabb.max[1]-o.aabb.min[1])*Ym|0)*Ym+Math.min(63,l),d=o.heightmap[c];if(!(d<0&&s.node.footprint)){if(s.hiddenByReplacement)return;return{height:d,maxHeight:s.feature.properties.height,hidden:!1,verticalScale:s.evaluatedScale[2]}}if(s.node.footprint.grid.query(new Se(e,t),new Se(e,t),r),r.length>0)return{height:void 0,maxHeight:s.feature.properties.height,hidden:s.hiddenByReplacement,verticalScale:s.evaluatedScale[2]}}}}function Ov(e,t){return e instanceof qs&&!e.isLightConstant&&t}function zv(e,t,r,n,i,s,o,a){let l=(61440&t|(61440&t)>>4)>>8,c=(3840&t|(3840&t)>>4)>>4,u=240&t|(240&t)>>4;r[3]>0&&(l=hr(l,255*r[0],r[3]),c=hr(c,255*r[1],r[3]),u=hr(u,255*r[2],r[3]));const d=l<<8|c,h=u<<8|Math.floor(255*n[3]),p=function(e){const t=Le(e,0,2);return Math.min(Math.round(.5*t*255),255)}(n[2])<<8|15*n[0]<<4|15*n[1],m=Le(i[0],0,1),f=Le(i[1],0,1),g=Le(i[2],0,1),y=Le(i[3],0,1);let _,v,x,b;if(m!==f&&o!==s&&f!==m){const e=o-s;v=1/(e*(f-m)),x=-(s+e*m)/(e*(f-m));const t=Le(i[4],-1,1);b=Math.pow(10,t),_=255*g<<8|255*y}else _=65535,v=0,x=1,b=1;if(e.emplaceBack(d,h,p,_,v,x,b),a){const e=a.length;a.clear();for(let t=0;t<e;t++)a.emplaceBack(d,h,p,_,v,x,b)}}function Bv(e,t,r){const n=e.node;let i=0;const s=r&Xm.HasMeshoptCompression;for(const o of n.meshes){if(n.lights&&n.lightMeshIndex===i)continue;if(!o.featureData)continue;o.featureArray=new Ga,o.featureArray.reserve(o.featureData.length);let r=t;for(const t of o.featureData){const i=s?65535&t:t>>16&65535,a=s?t>>16&65535:65535&t,l=(15&a)<8?15&a:0,c=e.evaluatedRMEA[l],u=e.evaluatedColor[l],d=e.emissionHeightBasedParams[l];let h;if(r&&2===l&&n.lights&&(h=new Ga,h.resize(10*n.lights.length)),zv(o.featureArray,i,u,c,d,o.aabb.min[2],o.aabb.max[2],h),h&&r){r=!1;const e=n.meshes[n.lightMeshIndex];e.featureArray=h,e.featureArray._trim()}}o.featureArray._trim(),i++}}$s(Fv,"Tiled3dModelBucket",{omit:["layers"]}),$s(Dv,"Tiled3dModelFeature");const Uv=["id","tile","layer","source","sourceLayer","state"];class Vv{constructor(e,t,r,n,i){this.type="Feature",this._vectorTileFeature=e,this._z=t,this._x=r,this._y=n,this.properties=e?e.properties:{},this.id=i}clone(){const e=new Vv(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(e.state=Object.assign({},this.state)),this.layer&&(e.layer=Object.assign({},this.layer)),this.source&&(e.source=this.source),this.sourceLayer&&(e.sourceLayer=this.sourceLayer),e}get geometry(){return void 0===this._geometry&&this._vectorTileFeature&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(e){this._geometry=e}toJSON(){const e={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const t of Uv)void 0!==this[t]&&(e[t]=this[t]);return e}}class qv extends nr{constructor(e,t,r,n){super(),this.id=e,this.type="model",this.models=[],this._loaded=!1,this._options=t,this._modelsInfo=new Map}load(){const e=[];for(const t in this._options.models){const r=this._options.models[t],n=this._modelsInfo.get(t);if(n){const e=n.model;e.position=null!=r.position?new ic(r.position[0],r.position[1]):new ic(0,0),e.orientation=null!=r.orientation?r.orientation:[0,0,0],n.modelSpec=r,qv.applyModelSpecification(e,r),e.computeBoundsAndApplyParent(),this.models.push(e)}else{const n=Am(this.map._requestManager.transformRequest(r.uri,Rt.Model).url).then(e=>{if(!e)return;const n=hf(e),i=new Qm(t,r.uri,r.position,r.orientation,n);qv.applyModelSpecification(i,r),i.computeBoundsAndApplyParent(),this.models.push(i),this._modelsInfo.set(t,{modelSpec:r,model:i})}).catch(e=>{this.fire(new er(new Error("Could not load model ".concat(t," from ").concat(r.uri,": ").concat(e.message))))});e.push(n)}}Promise.allSettled(e).then(()=>{this._loaded=!0,this.fire(new $t("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(e=>{this._loaded=!0,this.fire(new er(new Error("Could not load models: ".concat(e.message))))})}static applyModelSpecification(e,t){t.nodeOverrides&&qv.convertNodeOverrides(e,t.nodeOverrides),t.materialOverrides&&qv.convertMaterialOverrides(e,t.materialOverrides),t.nodeOverrideNames&&(e.nodeOverrideNames=[...t.nodeOverrideNames]),t.materialOverrideNames&&(e.materialOverrideNames=[...t.materialOverrideNames]),t.featureProperties&&(e.featureProperties=t.featureProperties)}static convertNodeOverrides(e,t){if(Array.isArray(t)&&t.every(e=>"string"==typeof e)){e.nodeOverrideNames=[];for(const r of t)e.nodeOverrideNames.push(r)}else Object.entries(t).forEach(t=>{let[r,n]=t;const i={orientation:[0,0,0]};if(n.hasOwnProperty("orientation")){const e=n.orientation;e&&(i.orientation=e)}e.nodeOverrides.set(r,i)})}static convertMaterialOverrides(e,t){if(Array.isArray(t)&&t.every(e=>"string"==typeof e)){e.materialOverrideNames=[];for(const r of t)e.materialOverrideNames.push(r)}else Object.entries(t).forEach(t=>{let[r,n]=t;const i={color:new lr(1,1,1),colorMix:0,emissionStrength:0,opacity:1},s=n["model-color"];void 0!==s&&(i.color.r=s[0],i.color.g=s[1],i.color.b=s[2]);const o=n["model-color-mix-intensity"];void 0!==o&&(i.colorMix=o);const a=n["model-emissive-strength"];void 0!==a&&(i.emissionStrength=a);const l=n["model-opacity"];void 0!==l&&(i.opacity=l),e.materialOverrides.set(r,i)})}onAdd(e){this.map=e,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(e,t){}serialize(){return this._options}setProperty(e,t){return!1}reload(){const e=ea(this.id,this.scope);this.map.style.clearSource(e),this.models=[],this._modelsInfo.clear(),this._loaded=!1,this.load()}setModels(e){this.models=[];const t=new Map;for(const r in e){const n=e[r];if(this._modelsInfo.has(r)){const e=this._modelsInfo.get(r);e&&e.modelSpec.uri===n.uri&&t.set(r,e)}}this._modelsInfo=t,this._options.models=e,this._loaded=!1,this.load()}}function Wv(e,t,r,n){const i=1<<e.z;t.lat=pc((n/Bn+e.y)/i),t.lng=hc((r/Bn+e.x)/i)}function Hv(e,t,r,n){const i=e.getNodesInfo()[t];if(!i||i.hiddenByReplacement||!i.node.meshes)return;let s=Number.MAX_VALUE;const o=i.node,a=r.tile,l=n.calculatePosMatrix(a.tileID.toUnwrapped(),n.worldSize),c=i.evaluatedScale;let u=0;n.elevation&&o.elevation&&(u=o.elevation*n.elevation.exaggeration()),h(l,l,[(o.anchor?o.anchor[0]:0)*(c[0]-1),(o.anchor?o.anchor[1]:0)*(c[1]-1),u]),p(l,l,c);const m=r.queryGeometry,f=m.isPointQuery()?m.screenBounds:m.screenGeometry,g=function(e){const t=d([],l,e.globalMatrix);d(t,n.expandedFarZProjMatrix,t);for(let r=0;r<e.meshes.length;++r){const i=e.meshes[r];if(r===e.lightMeshIndex)continue;const o=Km(f,n,t,i.aabb);null!=o&&(s=Math.min(o,s))}if(e.children)for(const r of e.children)g(r)};if(g(o),s===Number.MAX_VALUE)return;const y=new ic(0,0);return Wv(a.tileID.canonical,y,i.node.anchor[0],i.node.anchor[1]),{intersectionZ:s,position:y,feature:i.feature}}const Gv={circle:class extends oa{constructor(e,t,r,n){super(e,{layout:Su||(Su=new Do({"circle-sort-key":new Lo(Fo.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Mo(Fo.layout_circle["circle-elevation-reference"]),visibility:new Mo(Fo.layout_circle.visibility)})),paint:Tu||(Tu=new Do({"circle-radius":new Lo(Fo.paint_circle["circle-radius"]),"circle-color":new Lo(Fo.paint_circle["circle-color"]),"circle-blur":new Lo(Fo.paint_circle["circle-blur"]),"circle-opacity":new Lo(Fo.paint_circle["circle-opacity"]),"circle-translate":new Mo(Fo.paint_circle["circle-translate"]),"circle-translate-anchor":new Mo(Fo.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Mo(Fo.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Mo(Fo.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Lo(Fo.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Lo(Fo.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Lo(Fo.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Mo(Fo.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}createBucket(e){return new nu(e)}queryRadius(e){const t=e;return xu("circle-radius",this,t)+xu("circle-stroke-width",this,t)+bu(this.paint.get("circle-translate"))}queryIntersectsFeature(e,t,r,n,i,s,o,a){const l=ju(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),c=this.paint.get("circle-radius").evaluate(t,r)+this.paint.get("circle-stroke-width").evaluate(t,r);return cd(e,n,s,o,a,"map"===this.paint.get("circle-pitch-alignment"),"map"===this.paint.get("circle-pitch-scale"),l,c)}getProgramIds(){return["circle"]}getDefaultProgramParams(e,t,r){const n=ld(this);return{config:new zl(this,{zoom:t,lut:r}),defines:n,overrideFog:!1}}is3D(e){return!e&&!!this.layout&&"none"!==this.layout.get("circle-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("circle-elevation-reference")}},heatmap:class extends oa{createBucket(e){return new md(e)}constructor(e,t,r,n){super(e,{layout:fd||(fd=new Do({visibility:new Mo(Fo.layout_heatmap.visibility)})),paint:gd||(gd=new Do({"heatmap-radius":new Lo(Fo.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Lo(Fo.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Mo(Fo.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Ro(Fo.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Mo(Fo.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(e){"heatmap-color"===e&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Td({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(e){return xu("heatmap-radius",this,e)}queryIntersectsFeature(e,t,r,n,i,s,o,a){const l=this.paint.get("heatmap-radius").evaluate(t,r);return cd(e,n,s,o,a,!0,!0,new Se(0,0),l)}hasOffscreenPass(){return 0!==this.paint.get("heatmap-opacity")&&"none"!==this.visibility}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(e,t,r){return"heatmap"===e?{config:new zl(this,{zoom:t,lut:r}),overrideFog:!1}:{}}},hillshade:class extends oa{constructor(e,t,r,n){super(e,{layout:yd||(yd=new Do({visibility:new Mo(Fo.layout_hillshade.visibility)})),paint:_d||(_d=new Do({"hillshade-illumination-direction":new Mo(Fo.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Mo(Fo.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Mo(Fo.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Mo(Fo.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Mo(Fo.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Mo(Fo.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Mo(Fo.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}shouldRedrape(){return this.hasOffscreenPass()&&"viewport"===this.paint.get("hillshade-illumination-anchor")}hasOffscreenPass(){return 0!==this.paint.get("hillshade-exaggeration")&&"none"!==this.visibility}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(e,t,r){return{overrideFog:!1}}},fill:class extends oa{constructor(e,t,r,n){super(e,{layout:bh||(bh=new Do({"fill-sort-key":new Lo(Fo.layout_fill["fill-sort-key"]),visibility:new Mo(Fo.layout_fill.visibility),"fill-elevation-reference":new Mo(Fo.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Lo(Fo.layout_fill["fill-construct-bridge-guard-rail"])})),paint:wh||(wh=new Do({"fill-antialias":new Mo(Fo.paint_fill["fill-antialias"]),"fill-opacity":new Lo(Fo.paint_fill["fill-opacity"]),"fill-color":new Lo(Fo.paint_fill["fill-color"]),"fill-outline-color":new Lo(Fo.paint_fill["fill-outline-color"]),"fill-translate":new Mo(Fo.paint_fill["fill-translate"]),"fill-translate-anchor":new Mo(Fo.paint_fill["fill-translate-anchor"]),"fill-pattern":new Lo(Fo.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Mo(Fo.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Mo(Fo.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Lo(Fo.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Lo(Fo.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Lo(Fo.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}getProgramIds(){const e=this.paint.get("fill-pattern"),t=e&&e.constantOr(1),r=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&r.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),r}getDefaultProgramParams(e,t,r){return{config:new zl(this,{zoom:t,lut:r}),overrideFog:!1}}recalculate(e,t){super.recalculate(e,t);const r=this.paint._values["fill-outline-color"];"constant"===r.value.kind&&void 0===r.value.value&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(e){return new xh(e)}queryRadius(){return bu(this.paint.get("fill-translate"))}queryIntersectsFeature(e,t,r,n,i,s){return!e.queryGeometry.isAboveHorizon&&ou(wu(e.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),n)}isTileClipped(){return 0===this.paint.get("fill-z-offset").constantOr(1)}is3D(e){if(0!==this.paint.get("fill-z-offset").constantOr(1))return!0;const t=this.layout&&"none"!==this.layout.get("fill-elevation-reference");return null!=e?t&&!e:t}hasElevation(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}hasShadowPass(){return this.layout&&"none"!==this.layout.get("fill-elevation-reference")}},"fill-extrusion":class extends oa{constructor(e,t,r,n){super(e,{layout:Cp||(Cp=new Do({visibility:new Mo(Fo["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Mo(Fo["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:Ep||(Ep=new Do({"fill-extrusion-opacity":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Lo(Fo["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Mo(Fo["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new yp(e)}queryRadius(){return bu(this.paint.get("fill-extrusion-translate"))}is3D(e){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(e,t,r,n,i,s,o,a,l){const c=ju(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),u=this.paint.get("fill-extrusion-height").evaluate(t,r),d=this.paint.get("fill-extrusion-base").evaluate(t,r),h=[0,0],p=a&&s.elevation,m=s.elevation?s.elevation.exaggeration():1,f=e.tile.getBucket(this);if(p&&f instanceof yp){const e=f.centroidVertexArray,t=l+1;t<e.length&&(h[0]=e.geta_centroid_pos0(t),h[1]=e.geta_centroid_pos1(t))}if(0===h[0]&&1===h[1])return!1;"globe"===s.projection.name&&(n=kp([n],[new Se(0,0),new Se(Bn,Bn)],e.tileID.canonical).map(e=>e.polygon).flat());const g=p?a:null,[y,_]=Bp(s,n,d,u,c,o,g,h,m,s.center.lat,e.tileID.canonical),v=e.queryGeometry;return zp(y,_,v.isPointQuery()?v.screenBounds:v.screenGeometry)}},building:class extends oa{constructor(e,t,r,n){super(e,{layout:Lf||(Lf=new Do({visibility:new Mo(Fo.layout_building.visibility),"building-facade":new Lo(Fo.layout_building["building-facade"]),"building-facade-floors":new Lo(Fo.layout_building["building-facade-floors"]),"building-facade-unit-width":new Lo(Fo.layout_building["building-facade-unit-width"]),"building-facade-window":new Lo(Fo.layout_building["building-facade-window"]),"building-roof-shape":new Lo(Fo.layout_building["building-roof-shape"]),"building-height":new Lo(Fo.layout_building["building-height"]),"building-base":new Lo(Fo.layout_building["building-base"]),"building-flood-light-wall-radius":new Lo(Fo.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Lo(Fo.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Lo(Fo.layout_building["building-flip-roof-orientation"])})),paint:Rf||(Rf=new Do({"building-opacity":new Mo(Fo.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Mo(Fo.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Mo(Fo.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Mo(Fo.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Mo(Fo.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Mo(Fo.paint_building["building-vertical-scale"]),"building-cast-shadows":new Mo(Fo.paint_building["building-cast-shadows"]),"building-color":new Lo(Fo.paint_building["building-color"]),"building-emissive-strength":new Lo(Fo.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Mo(Fo.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Mo(Fo.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new Mo(Fo.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new Mo(Fo.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new Mo(Fo.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new If(e)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(e){return!0}queryRadius(e){return 0}queryIntersectsFeature(e,t,r,n,i,s,o,a,l){let c=this.layout.get("building-height").evaluate(t,r);const u=this.layout.get("building-base").evaluate(t,r),d=e.tile.getBucket(this).getFootprint(t);if(d){if(0!==d.hiddenFlags)return!1;c=d.height}const[h,p]=Bp(s,n,u,c,new Se(0,0),o,null,[0,0],1,s.center.lat,e.tileID.canonical),m=e.queryGeometry;return zp(h,p,m.isPointQuery()?m.screenBounds:m.screenGeometry)}},line:class extends oa{constructor(e,t,r,n){const i=ig();super(e,i,t,r,n),i.layout&&(this.layout=new Po(i.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(e){if("line-gradient"===e){const e=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=e._styleExpression&&e._styleExpression.expression instanceof Ci,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}emissiveStrengthExpression(){return this._transitionablePaint._values["line-emissive-strength"].value.expression}recalculate(e,t){super.recalculate(e,t),this.paint._values["line-floorwidth"]=(()=>{if(og)return og;const e=ig();return og=new sg(e.paint.properties["line-width"].specification),og.useIntegerZoom=!0,og})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,e)}createBucket(e){return new Zf(e)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(e,t,r){const n=tg(this);return{config:new zl(this,{zoom:t,lut:r}),defines:n,overrideFog:!1}}queryRadius(e){const t=e,r=ag(xu("line-width",this,t),xu("line-gap-width",this,t)),n=xu("line-offset",this,t);return r/2+Math.abs(n)+bu(this.paint.get("line-translate"))}queryIntersectsFeature(e,t,r,n,i,s){if(e.queryGeometry.isAboveHorizon)return!1;const o=wu(e.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),s.angle,e.pixelToTileUnitsFactor),a=e.pixelToTileUnitsFactor/2*ag(this.paint.get("line-width").evaluate(t,r),this.paint.get("line-gap-width").evaluate(t,r)),l=this.paint.get("line-offset").evaluate(t,r);return l&&(n=function(e,t){const r=[],n=new Se(0,0);for(let i=0;i<e.length;i++){const s=e[i],o=[];for(let e=0;e<s.length;e++){const r=s[e],i=s[e+1],a=0===e?n:r.sub(s[e-1])._unit()._perp(),l=e===s.length-1?n:i.sub(r)._unit()._perp(),c=a._add(l)._unit();c._mult(1/(c.x*l.x+c.y*l.y)),o.push(c._mult(t)._add(r))}r.push(o)}return r}(n,l*e.pixelToTileUnitsFactor)),function(e,t,r){for(let n=0;n<t.length;n++){const i=t[n];if(e.length>=3)for(let t=0;t<i.length;t++)if(fu(e,i[t]))return!0;if(au(e,i,r))return!0}return!1}(o,n,a)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(e){return!this.hasElevatedBuckets||this.layout&&"hd-road-markup"===this.layout.get("line-elevation-reference")}hasElevation(){return this.layout&&"none"!==this.layout.get("line-elevation-reference")}},symbol:rv,background:class extends oa{constructor(e,t,r,n){super(e,{layout:nv||(nv=new Do({visibility:new Mo(Fo.layout_background.visibility)})),paint:iv||(iv=new Do({"background-pitch-alignment":new Mo(Fo.paint_background["background-pitch-alignment"]),"background-color":new Mo(Fo.paint_background["background-color"]),"background-pattern":new Mo(Fo.paint_background["background-pattern"]),"background-opacity":new Mo(Fo.paint_background["background-opacity"]),"background-emissive-strength":new Mo(Fo.paint_background["background-emissive-strength"]),"background-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(e,t,r){return{overrideFog:!1}}is3D(e){return"viewport"===this.paint.get("background-pitch-alignment")}},raster:pv,"raster-particle":vv,sky:class extends oa{constructor(e,t,r,n){super(e,{layout:gv||(gv=new Do({visibility:new Mo(Fo.layout_sky.visibility)})),paint:yv||(yv=new Do({"sky-type":new Mo(Fo.paint_sky["sky-type"]),"sky-atmosphere-sun":new Mo(Fo.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Mo(Fo.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Mo(Fo.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Mo(Fo.paint_sky["sky-gradient-radius"]),"sky-gradient":new Ro(Fo.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Mo(Fo.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Mo(Fo.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Mo(Fo.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(e){"sky-gradient"===e?this._updateColorRamp():"sky-atmosphere-sun"!==e&&"sky-atmosphere-halo-color"!==e&&"sky-atmosphere-color"!==e&&"sky-atmosphere-sun-intensity"!==e||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Td({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(e){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=e.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(e,t){if("atmosphere"===this.paint.get("sky-type")){const r=this.paint.get("sky-atmosphere-sun"),n=!r,i=e.style.light,s=i.properties.get("position");return n&&"viewport"===i.properties.get("anchor")&&Ze("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),n?bv(s.azimuthal,90-s.polar,t):bv(r[0],90-r[1],t)}const r=this.paint.get("sky-gradient-center");return bv(r[0],90-r[1],t)}isSky(){return!0}markSkyboxValid(e){this._skyboxInvalidated=!1,this._lightPosition=e.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const e=this.paint.get("sky-type");return"atmosphere"===e?["skyboxCapture","skybox"]:"gradient"===e?["skyboxGradient"]:null}},slot:class extends oa{constructor(e,t,r,n){super(e,{paint:_v||(_v=new Do({}))},t,null)}},model:class extends oa{constructor(e,t,r,n){super(e,{layout:Cv||(Cv=new Do({visibility:new Mo(Fo.layout_model.visibility),"model-id":new Lo(Fo.layout_model["model-id"])})),paint:Ev||(Ev=new Do({"model-opacity":new Lo(Fo.paint_model["model-opacity"]),"model-rotation":new Lo(Fo.paint_model["model-rotation"]),"model-scale":new Lo(Fo.paint_model["model-scale"]),"model-translation":new Lo(Fo.paint_model["model-translation"]),"model-color":new Lo(Fo.paint_model["model-color"]),"model-color-mix-intensity":new Lo(Fo.paint_model["model-color-mix-intensity"]),"model-type":new Mo(Fo.paint_model["model-type"]),"model-cast-shadows":new Mo(Fo.paint_model["model-cast-shadows"]),"model-receive-shadows":new Mo(Fo.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Mo(Fo.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Lo(Fo.paint_model["model-emissive-strength"]),"model-roughness":new Lo(Fo.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Lo(Fo.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Mo(Fo.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Mo(Fo.paint_model["model-front-cutoff"]),"model-elevation-reference":new Mo(Fo.paint_model["model-elevation-reference"]),"model-color-use-theme":new Lo({type:"string",default:"default","property-type":"data-driven"})}))},t,r,n),this.layer=e,this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(e){return new Av(e)}getProgramIds(){return["model"]}is3D(e){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(e){return e instanceof Fv?Bn-1:0}queryRenderedFeatures(e,t,r){const n=t.getSource();if(!(n&&n instanceof qv))return{};const i=n,s={};s[this.id]=[];const o=s[this.id];let a=0;for(const l of i.models){const n=t.getFeatureState(this.sourceLayer,l.id),i={type:"Unknown",id:l.id,properties:l.featureProperties},s=this.paint.get("model-rotation").evaluate(i,n),c=this.paint.get("model-scale").evaluate(i,n),u=this.paint.get("model-translation").evaluate(i,n),h=this.paint.get("model-elevation-reference");let p=[];Jm(p,l,r,l.position,s,c,u,"ground"===h,"ground"===h,!1),"globe"===r.projection.name&&(p=Zm(p,r));const m=d([],r.projMatrix,p),f=Km(e.isPointQuery()?e.screenBounds:e.screenGeometry,r,m,l.aabb);if(null!=f){const e=new Vv(void 0,0,0,0,l.id);e.layer=this.layer,e.properties=structuredClone(l.featureProperties),e.properties.layer=this.id,e.properties.uri=l.uri,e.properties.orientation=l.orientation,e.sourceLayer=this.sourceLayer,e.geometry={type:"Point",coordinates:[l.position.lng,l.position.lat]},e.state=n,e.source=this.source,o.push({featureIndex:a,feature:e,intersectionZ:f})}++a}return s}queryIntersectsFeature(e,t,r,n,i,s){if(!this.modelManager)return!1;const o=this.modelManager,a=e.tile.getBucket(this);if(!(a&&a instanceof Av))return!1;for(const l in a.instancesPerModel){const r=a.instancesPerModel[l],n=void 0!==t.id?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(r.idToFeaturesIndex.hasOwnProperty(n)){const t=r.features[r.idToFeaturesIndex[n]],i=o.getModel(l,this.scope);if(!i)return!1;let c=[];const u=new ic(0,0),h=a.canonical;let p=Number.MAX_VALUE;for(let n=0;n<t.instancedDataCount;++n){const o=16*(t.instancedDataOffset+n),a=r.instancedDataArray.float32,l=[a[o+4],a[o+5],a[o+6]];Wv(h,u,Math.floor(a[o]),Math.floor(a[o+1])),Jm(c,i,s,u,t.rotation,t.scale,l,!1,!1,!1),"globe"===s.projection.name&&(c=Zm(c,s));const m=d([],s.projMatrix,c),f=e.queryGeometry,g=Km(f.isPointQuery()?f.screenBounds:f.screenGeometry,s,m,i.aabb);null!=g&&(p=Math.min(g,p))}return p!==Number.MAX_VALUE&&p}}return!1}_handleOverridablePaintPropertyUpdate(e,t,r){return!(!this.layout||t.isDataDriven()||r.isDataDriven()||"model-color"!==e&&"model-color-mix-intensity"!==e&&"model-rotation"!==e&&"model-scale"!==e&&"model-translation"!==e&&"model-emissive-strength"!==e)}_isPropertyZoomDependent(e){const t=this._transitionablePaint._values[e];return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof Ws}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends oa{constructor(e,t,r,n){super(e,{layout:jh||(jh=new Do({"clip-layer-types":new Mo(Fo.layout_clip["clip-layer-types"]),"clip-layer-scope":new Mo(Fo.layout_clip["clip-layer-scope"])})),paint:Sh||(Sh=new Do({}))},t,r,n)}recalculate(e,t){super.recalculate(e,t)}createBucket(e){return new Ah(e)}is3D(e){return!0}}},Zv=new lr(0,0,0),Kv={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Yv={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},Xv={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},Jv={PAINT_ORDER_FILL_AND_STROKE:1},Qv={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},$v={MASK_TYPE_LUMINANCE:1};function ex(e,t,r){1===e&&t.icons.push(function(e,t){return function(e){if(e.usvg_tree.height||(e.usvg_tree.height=e.usvg_tree.width),!e.metadata)return e;const{metadata:t}=e;if(t.content_area){const{content_area:r}=t;null==r.left&&(r.left=0),null==r.top&&(r.top=r.left),null==r.width&&(r.width=e.usvg_tree.width),null==r.height&&(r.height=r.width)}if(t.text_placeholder){const{text_placeholder:e}=t;null==e.top&&(e.top=e.left),null==e.height&&(e.height=e.width)}return t.stretch_x&&t.stretch_x.length&&tx(t,"x"),t.stretch_y&&t.stretch_y.length&&tx(t,"y"),e}(e.readFields(rx,{name:void 0},t))}(r,r.readVarint()+r.pos))}function tx(e,t){const r=[],n=e["stretch_".concat(t)];let i=null;for(let s=0;s<n.length;s++)null===i?i=0===r.length?n[0]:r[r.length-1][1]+n[s]:(r.push([i,i+n[s]]),i=null);e["stretch_".concat(t,"_areas")]=r}function rx(e,t,r){1===e?t.name=r.readString():2===e?t.metadata=function(e,t){return e.readFields(nx,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},t)}(r,r.readVarint()+r.pos):3===e&&(t.usvg_tree=function(e,t){return e.readFields(ax,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},t)}(r,r.readVarint()+r.pos),t.data="usvg_tree")}function nx(e,t,r){1===e?t.stretch_x=r.readPackedVarint():2===e?t.stretch_y=r.readPackedVarint():3===e?t.content_area=ix(r,r.readVarint()+r.pos):4===e?t.variables.push(function(e,t){return e.readFields(ox,{name:void 0},t)}(r,r.readVarint()+r.pos)):5===e&&(t.text_placeholder=ix(r,r.readVarint()+r.pos))}function ix(e,t){return e.readFields(sx,{},t)}function sx(e,t,r){1===e?t.left=r.readVarint():2===e?t.width=r.readVarint():3===e?t.top=r.readVarint():4===e&&(t.height=r.readVarint())}function ox(e,t,r){1===e?t.name=r.readString():2===e&&(t.rgb_color=fx(r.readVarint()),t.value="rgb_color")}function ax(e,t,r){1===e?t.width=t.height=r.readVarint():2===e?t.height=r.readVarint():3===e?t.children.push(lx(r,r.readVarint()+r.pos)):4===e?t.linear_gradients.push(function(e,t){return e.readFields(yx,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},t)}(r,r.readVarint()+r.pos)):5===e?t.radial_gradients.push(function(e,t){return e.readFields(xx,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},t)}(r,r.readVarint()+r.pos)):7===e?t.clip_paths.push(function(e,t){return e.readFields(bx,{children:[]},t)}(r,r.readVarint()+r.pos)):8===e&&t.masks.push(function(e,t){const r=e.readFields(wx,{left:0,width:20,mask_type:$v.MASK_TYPE_LUMINANCE,children:[]},t);return null==r.height&&(r.height=r.width),null==r.top&&(r.top=r.left),r}(r,r.readVarint()+r.pos))}function lx(e,t){return e.readFields(cx,{},t)}function cx(e,t,r){1===e?(t.group=function(e,t){return e.readFields(ux,{opacity:255,children:[]},t)}(r,r.readVarint()+r.pos),t.node="group"):2===e&&(t.path=function(e,t){return e.readFields(px,{paint_order:1,commands:[],step:1,diffs:[],rule:Kv.PATH_RULE_NON_ZERO},t)}(r,r.readVarint()+r.pos),t.node="path")}function ux(e,t,r){1===e?t.transform=dx(r,r.readVarint()+r.pos):2===e?t.opacity=r.readVarint():5===e?t.clip_path_idx=r.readVarint():6===e?t.mask_idx=r.readVarint():7===e&&t.children.push(lx(r,r.readVarint()+r.pos))}function dx(e,t){return e.readFields(hx,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function hx(e,t,r){1===e?t.sx=r.readFloat():2===e?t.ky=r.readFloat():3===e?t.kx=r.readFloat():4===e?t.sy=r.readFloat():5===e?t.tx=r.readFloat():6===e&&(t.ty=r.readFloat())}function px(e,t,r){1===e?t.fill=function(e,t){return e.readFields(mx,{rgb_color:Zv,paint:"rgb_color",opacity:255},t)}(r,r.readVarint()+r.pos):2===e?t.stroke=function(e,t){return e.readFields(gx,{rgb_color:Zv,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},t)}(r,r.readVarint()+r.pos):3===e?t.paint_order=r.readVarint():5===e?r.readPackedVarint(t.commands):6===e?t.step=r.readFloat():7===e?r.readPackedSVarint(t.diffs):8===e&&(t.rule=r.readVarint())}function mx(e,t,r){1===e?(t.rgb_color=fx(r.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):5===e&&(t.opacity=r.readVarint())}function fx(e){return new lr((e>>16&255)/255,(e>>8&255)/255,(255&e)/255,1)}function gx(e,t,r){1===e?(t.rgb_color=fx(r.readVarint()),t.paint="rgb_color"):2===e?(t.linear_gradient_idx=r.readVarint(),t.paint="linear_gradient_idx"):3===e?(t.radial_gradient_idx=r.readVarint(),t.paint="radial_gradient_idx"):5===e?r.readPackedFloat(t.dasharray):6===e?t.dashoffset=r.readFloat():7===e?t.miterlimit=r.readFloat():8===e?t.opacity=r.readVarint():9===e?t.width=r.readFloat():10===e?t.linecap=r.readVarint():11===e&&(t.linejoin=r.readVarint())}function yx(e,t,r){1===e?t.transform=dx(r,r.readVarint()+r.pos):2===e?t.spread_method=r.readVarint():3===e?t.stops.push(_x(r,r.readVarint()+r.pos)):4===e?t.x1=r.readFloat():5===e?t.y1=r.readFloat():6===e?t.x2=r.readFloat():7===e&&(t.y2=r.readFloat())}function _x(e,t){return e.readFields(vx,{offset:0,opacity:255,rgb_color:Zv},t)}function vx(e,t,r){1===e?t.offset=r.readFloat():2===e?t.opacity=r.readVarint():3===e&&(t.rgb_color=fx(r.readVarint()))}function xx(e,t,r){1===e?t.transform=dx(r,r.readVarint()+r.pos):2===e?t.spread_method=r.readVarint():3===e?t.stops.push(_x(r,r.readVarint()+r.pos)):4===e?t.cx=r.readFloat():5===e?t.cy=r.readFloat():6===e?t.r=r.readFloat():7===e?t.fx=r.readFloat():8===e?t.fy=r.readFloat():9===e&&(t.fr=r.readFloat())}function bx(e,t,r){1===e?t.transform=dx(r,r.readVarint()+r.pos):2===e?t.clip_path_idx=r.readVarint():3===e&&t.children.push(lx(r,r.readVarint()+r.pos))}function wx(e,t,r){1===e?t.left=t.top=r.readFloat():2===e?t.width=t.height=r.readFloat():3===e?t.top=r.readFloat():4===e?t.height=r.readFloat():5===e?t.mask_type=r.readVarint():6===e?t.mask_idx=r.readVarint():7===e&&t.children.push(lx(r,r.readVarint()+r.pos))}class jx{static calculate(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];const r=new Map,n=new Map;if(0===Object.keys(e).length)return r;t.forEach(e=>{n.set(e.name,e.rgb_color||new lr(0,0,0))});for(const[i,s]of Object.entries(e))n.has(i)?r.set(n.get(i).toString(),s):console.warn('Ignoring unknown image variable "'.concat(i,'"'));return r}}function Sx(e){let t=arguments.length>2?arguments[2]:void 0;const r=(arguments.length>1&&void 0!==arguments[1]?arguments[1]:255)/255,n=e.toString(),i=t.has(n)?t.get(n).clone():e.clone();return i.a*=r,i.toString()}function Tx(e,t){if(!ft()){const r=document.createElement("canvas");return r.width=e,r.height=t,r}return new OffscreenCanvas(e,t)}let kx,Ax=null;function Cx(e,t,r,n,i){for(const s of n.children)Ex(e,t,r,s,i)}function Ex(e,t,r,n,i){n.group?(e.save(),function(e,t,r,n,i){const s=null!=n.mask_idx?r.masks[n.mask_idx]:null,o=null!=n.clip_path_idx?r.clip_paths[n.clip_path_idx]:null;if(n.transform&&(t=Ox(n.transform).preMultiplySelf(t)),!function(e,t,r){return 255!==e.opacity||t||r}(n,null!=o,null!=s))return void Cx(e,t,r,n,i);const a=Tx(e.canvas.width,e.canvas.height),l=a.getContext("2d");Cx(l,t,r,n,i),o&&Dx(l,t,r,o),s&&Fx(l,t,r,s,i),e.globalAlpha=n.opacity/255,e.drawImage(a,0,0)}(e,t,r,n.group,i),e.restore()):n.path&&(e.save(),function(e,t,r,n,i){e.setTransform(t),n.paint_order===Jv.PAINT_ORDER_FILL_AND_STROKE?(Nx(e,r,n,i),Px(e,r,n,i)):(Px(e,r,n,i),Nx(e,r,n,i))}(e,t,r,n.path,i),e.restore())}function Nx(e,t,r,n){const i=r.fill;if(!i)return;const s=i.opacity/255;switch(e.save(),e.beginPath(),zx(r,e),i.paint){case"rgb_color":e.fillStyle=Sx(i.rgb_color,i.opacity,n);break;case"linear_gradient_idx":{const r=t.linear_gradients[i.linear_gradient_idx];r.transform&&e.setTransform(Ox(r.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Mx(e,r,s,n);break}case"radial_gradient_idx":{const r=t.radial_gradients[i.radial_gradient_idx];r.transform&&e.setTransform(Ox(r.transform).preMultiplySelf(e.getTransform())),e.fillStyle=Lx(e,r,s,n)}}e.fill(Ix(r)),e.restore()}function Ix(e){return e.rule===Kv.PATH_RULE_NON_ZERO?"nonzero":e.rule===Kv.PATH_RULE_EVEN_ODD?"evenodd":void 0}function Px(e,t,r,n){const i=r.stroke;if(!i)return;const s=Bx(r);e.lineWidth=i.width,e.miterLimit=i.miterlimit,e.setLineDash(i.dasharray),e.lineDashOffset=i.dashoffset;const o=i.opacity/255;switch(i.paint){case"rgb_color":e.strokeStyle=Sx(i.rgb_color,i.opacity,n);break;case"linear_gradient_idx":e.strokeStyle=Mx(e,t.linear_gradients[i.linear_gradient_idx],o,n,!0);break;case"radial_gradient_idx":e.strokeStyle=Lx(e,t.radial_gradients[i.radial_gradient_idx],o,n,!0)}switch(i.linejoin){case Xv.LINE_JOIN_MITER_CLIP:case Xv.LINE_JOIN_MITER:e.lineJoin="miter";break;case Xv.LINE_JOIN_ROUND:e.lineJoin="round";break;case Xv.LINE_JOIN_BEVEL:e.lineJoin="bevel"}switch(i.linecap){case Yv.LINE_CAP_BUTT:e.lineCap="butt";break;case Yv.LINE_CAP_ROUND:e.lineCap="round";break;case Yv.LINE_CAP_SQUARE:e.lineCap="square"}e.stroke(s)}function Mx(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Sx(e.rgb_color,e.opacity*r,n)}const{x1:s,y1:o,x2:a,y2:l}=t;let c=new DOMPoint(s,o),u=new DOMPoint(a,l);if(i){const e=Ox(t.transform);c=e.transformPoint(c),u=e.transformPoint(u)}const d=e.createLinearGradient(c.x,c.y,u.x,u.y);for(const h of t.stops)d.addColorStop(h.offset,Sx(h.rgb_color,h.opacity*r,n));return d}function Lx(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];if(1===t.stops.length){const e=t.stops[0];return Sx(e.rgb_color,e.opacity*r,n)}const s=Ox(t.transform),{fx:o,fy:a,fr:l,cx:c,cy:u,r:d}=t;let h=new DOMPoint(o,a),p=new DOMPoint(c,u),m=l,f=d;if(i){h=s.transformPoint(h),p=s.transformPoint(p);const e=(s.a+s.d)/2;m=l*e,f=t.r*e}const g=e.createRadialGradient(h.x,h.y,m,p.x,p.y,f);for(const y of t.stops)g.addColorStop(y.offset,Sx(y.rgb_color,y.opacity*r,n));return g}function Rx(e,t,r,n){const i=n.transform?Ox(n.transform).preMultiplySelf(t):t,s=Tx(e.canvas.width,e.canvas.height),o=s.getContext("2d");for(const l of n.children)if(l.group)Rx(o,i,r,l.group);else if(l.path){const e=l.path,t=new Path2D;t.addPath(Bx(e),i),o.fill(t,Ix(e))}const a=null!=n.clip_path_idx?r.clip_paths[n.clip_path_idx]:null;a&&Dx(o,i,r,a),e.globalCompositeOperation="source-over",e.drawImage(s,0,0)}function Dx(e,t,r,n){const i=Tx(e.canvas.width,e.canvas.height);Rx(i.getContext("2d"),t,r,n),e.globalCompositeOperation="destination-in",e.drawImage(i,0,0)}function Fx(e,t,r,n,i){if(0===n.children.length)return;const s=null!=n.mask_idx?r.masks[n.mask_idx]:null;s&&Fx(e,t,r,s,i);const o=e.canvas.width,a=e.canvas.height,l=Tx(o,a),c=l.getContext("2d"),u=n.width,d=n.height,h=n.left,p=n.top,m=new Path2D,f=new Path2D;f.rect(h,p,u,d),m.addPath(f,t),c.clip(m);for(const _ of n.children)Ex(c,t,r,_,i);const g=c.getImageData(0,0,o,a),y=g.data;if(n.mask_type===$v.MASK_TYPE_LUMINANCE)for(let _=0;_<y.length;_+=4)y[_+3]=y[_+3]/255*(.2126*y[_]+.7152*y[_+1]+.0722*y[_+2]);c.putImageData(g,0,0),e.globalCompositeOperation="destination-in",e.drawImage(l,0,0)}function Ox(e){return e?new DOMMatrix([e.sx,e.ky,e.kx,e.sy,e.tx,e.ty]):new DOMMatrix}function zx(e,t){const r=e.step;let n=e.diffs[0]*r,i=e.diffs[1]*r;t.moveTo(n,i);for(let s=0,o=2;s<e.commands.length;s++)switch(e.commands[s]){case Qv.PATH_COMMAND_MOVE:n+=e.diffs[o++]*r,i+=e.diffs[o++]*r,t.moveTo(n,i);break;case Qv.PATH_COMMAND_LINE:n+=e.diffs[o++]*r,i+=e.diffs[o++]*r,t.lineTo(n,i);break;case Qv.PATH_COMMAND_QUAD:{const s=n+e.diffs[o++]*r,a=i+e.diffs[o++]*r;n=s+e.diffs[o++]*r,i=a+e.diffs[o++]*r,t.quadraticCurveTo(s,a,n,i);break}case Qv.PATH_COMMAND_CUBIC:{const s=n+e.diffs[o++]*r,a=i+e.diffs[o++]*r,l=s+e.diffs[o++]*r,c=a+e.diffs[o++]*r;n=l+e.diffs[o++]*r,i=c+e.diffs[o++]*r,t.bezierCurveTo(s,a,l,c,n,i);break}case Qv.PATH_COMMAND_CLOSE:t.closePath()}return t}function Bx(e){return zx(e,new Path2D)}class Ux{constructor(e){this.capacity=e,this.cache=new Map}get(e){if(!this.cache.has(e))return;const t=this.cache.get(e);return this.cache.delete(e),this.cache.set(e,t),t}put(e,t){this.cache.has(e)?this.cache.delete(e):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(e,t)}delete(e){this.cache.delete(e)}}$s(Ux,"LRUCache");class Vx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(e){return new jd(e,e.data)}getFromCache(e,t,r){return this.cacheMap.has(r)||this.cacheMap.set(r,new Ux(150)),this.cacheMap.get(r).get(ea(e.toString(),t))}setInCache(e,t,r,n){this.cacheDependenciesMap.has(n)||this.cacheDependenciesMap.set(n,new Map),this.cacheMap.has(n)||this.cacheMap.set(n,new Ux(150));const i=this.cacheDependenciesMap.get(n),s=ea(e.id.toString(),r);i.get(s)||i.set(s,new Set);const o=this.cacheMap.get(n),a=e.toString();i.get(s).add(a),o.put(ea(e.toString(),r),t)}removeImagesFromCacheByIds(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;if(!this.cacheMap.has(r)||!this.cacheDependenciesMap.has(r))return;const n=this.cacheMap.get(r),i=this.cacheDependenciesMap.get(r);for(const s of e){const e=ea(s.toString(),t);if(i.has(e)){for(const t of i.get(e))n.delete(t);i.delete(e)}}}rasterize(e,t,r,n){const i=this.getFromCache(e,r,n);if(i)return i.clone();const s=function(e,t){const r=jx.calculate(t.params,e.metadata?e.metadata.variables:[]),n=e.usvg_tree,i=n.width,s=n.height,o=Math.max(1,Math.round(i*t.sx)),a=Math.max(1,Math.round(s*t.sy)),l=new DOMMatrix([o/i,0,0,a/s,0,0]);return null===Ax&&(Ax=Tx(10,10),kx=Ax.getContext("2d",{willReadFrequently:!0})),Ax.width=o,Ax.height=a,Cx(kx,l,n,n,r),kx.getImageData(0,0,o,a)}(t.icon,e),o=Vx._getImage(s);return this.setInCache(e,o,r,n),o.clone()}}class qx{constructor(e){this.size=e,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(e,t){const r=this.toIdx(e,t);return{min:this.minimums[r],max:this.maximums[r]}}isLeaf(e,t){return this.leaves[this.toIdx(e,t)]}toIdx(e,t){return t*this.size+e}}function Wx(e,t,r,n){let i=0,s=Number.MAX_VALUE;for(let o=0;o<3;o++)if(Math.abs(n[o])<1e-15){if(r[o]<e[o]||r[o]>t[o])return null}else{const a=1/n[o];let l=(e[o]-r[o])*a,c=(t[o]-r[o])*a;if(l>c){const e=l;l=c,c=e}if(l>i&&(i=l),c<s&&(s=c),i>s)return null}return i}function Hx(e,t,r,n,i,s,o,a,l,c,u){const d=n-e,h=i-t,p=s-r,m=o-e,f=a-t,g=l-r,y=u[1]*g-u[2]*f,_=u[2]*m-u[0]*g,v=u[0]*f-u[1]*m,x=d*y+h*_+p*v;if(Math.abs(x)<1e-15)return null;const b=1/x,w=c[0]-e,j=c[1]-t,S=c[2]-r,T=(w*y+j*_+S*v)*b;if(T<0||T>1)return null;const k=j*p-S*h,A=S*d-w*p,C=w*h-j*d,E=(u[0]*k+u[1]*A+u[2]*C)*b;return E<0||T+E>1?null:(m*k+f*A+g*C)*b}function Gx(e,t,r){return(e-t)/(r-t)}function Zx(e,t,r,n,i,s,o,a,l){const c=1<<r,u=s-n,d=o-i,h=(e+1)/c*u+n,p=(t+0)/c*d+i,m=(t+1)/c*d+i;a[0]=(e+0)/c*u+n,a[1]=p,l[0]=h,l[1]=m}class Kx{constructor(e){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=e,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const t=function(e){const t=Math.ceil(Math.log2(e.dim/8)),r=[];let n=Math.ceil(Math.pow(2,t));const i=1/n,s=(e,t,r,n,i)=>{const s=n?1:0,o=(e+1)*r-s,a=t*r,l=(t+1)*r-s;i[0]=e*r,i[1]=a,i[2]=o,i[3]=l};let o=new qx(n);const a=[];for(let l=0;l<n*n;l++){s(l%n,Math.floor(l/n),i,!1,a);const t=Xx(a[0],a[1],e),r=Xx(a[2],a[1],e),c=Xx(a[2],a[3],e),u=Xx(a[0],a[3],e);o.minimums.push(Math.min(t,r,c,u)),o.maximums.push(Math.max(t,r,c,u)),o.leaves.push(1)}for(r.push(o),n/=2;n>=1;n/=2){const e=r[r.length-1];o=new qx(n);for(let t=0;t<n*n;t++){s(t%n,Math.floor(t/n),2,!0,a);const r=e.getElevation(a[0],a[1]),i=e.getElevation(a[2],a[1]),l=e.getElevation(a[2],a[3]),c=e.getElevation(a[0],a[3]),u=e.isLeaf(a[0],a[1]),d=e.isLeaf(a[2],a[1]),h=e.isLeaf(a[2],a[3]),p=e.isLeaf(a[0],a[3]),m=Math.min(r.min,i.min,l.min,c.min),f=Math.max(r.max,i.max,l.max,c.max),g=u&&d&&h&&p;o.maximums.push(f),o.minimums.push(m),o.leaves.push(f-m<=5&&g?1:0)}r.push(o)}return r}(this.dem),r=t.length-1,n=t[r];this._addNode(n.minimums[0],n.maximums[0],n.leaves[0]),this._construct(t,0,0,r,0)}raycastRoot(e,t,r,n,i,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;return Wx([e,t,-100],[r,n,this.maximums[0]*o],i,s)}raycast(e,t,r,n,i,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:1;if(!this.nodeCount)return null;const a=this.raycastRoot(e,t,r,n,i,s,o);if(null==a)return null;const l=[],c=[],u=[],d=[],h=[{idx:0,t:a,nodex:0,nodey:0,depth:0}];for(;h.length>0;){const{idx:a,t:p,nodex:m,nodey:f,depth:g}=h.pop();if(this.leaves[a]){Zx(m,f,g,e,t,r,n,u,d);const a=1<<g,l=(m+0)/a,c=(m+1)/a,h=(f+0)/a,y=(f+1)/a,_=Xx(l,h,this.dem)*o,v=Xx(c,h,this.dem)*o,x=Xx(c,y,this.dem)*o,b=Xx(l,y,this.dem)*o,w=Hx(u[0],u[1],_,d[0],u[1],v,d[0],d[1],x,i,s),j=Hx(d[0],d[1],x,u[0],d[1],b,u[0],u[1],_,i,s),S=Math.min(null!==w?w:Number.MAX_VALUE,null!==j?j:Number.MAX_VALUE);if(S!==Number.MAX_VALUE)return S;{const e=M([],i,s,p);if(Yx(_,v,b,x,Gx(e[0],u[0],d[0]),Gx(e[1],u[1],d[1]))>=e[2])return p}continue}let y=0;for(let h=0;h<this._siblingOffset.length;h++){Zx((m<<1)+this._siblingOffset[h][0],(f<<1)+this._siblingOffset[h][1],g+1,e,t,r,n,u,d),u[2]=-100,d[2]=this.maximums[this.childOffsets[a]+h]*o;const p=Wx(u,d,i,s);if(null!=p){const e=p;l[h]=e;let t=!1;for(let r=0;r<y&&!t;r++)e>=l[c[r]]&&(c.splice(r,0,h),t=!0);t||(c[y]=h),y++}}for(let e=0;e<y;e++){const t=c[e];h.push({idx:this.childOffsets[a]+t,t:l[t],nodex:(m<<1)+this._siblingOffset[t][0],nodey:(f<<1)+this._siblingOffset[t][1],depth:g+1})}}return null}_addNode(e,t,r){return this.minimums.push(e),this.maximums.push(t),this.leaves.push(r),this.childOffsets.push(0),this.nodeCount++}_construct(e,t,r,n,i){if(1===e[n].isLeaf(t,r))return;this.childOffsets[i]||(this.childOffsets[i]=this.nodeCount);const s=n-1,o=e[s];let a=0,l=0;for(let c=0;c<this._siblingOffset.length;c++){const e=2*t+this._siblingOffset[c][0],n=2*r+this._siblingOffset[c][1],i=o.getElevation(e,n),s=o.isLeaf(e,n),u=this._addNode(i.min,i.max,s);s&&(a|=1<<c),l||(l=u)}for(let c=0;c<this._siblingOffset.length;c++)a&1<<c||this._construct(e,2*t+this._siblingOffset[c][0],2*r+this._siblingOffset[c][1],s,l+c)}}function Yx(e,t,r,n,i,s){return hr(hr(e,r,s),hr(t,n,s),i)}function Xx(e,t,r){const n=r.dim,i=Le(e*n-.5,0,n-1),s=Le(t*n-.5,0,n-1),o=Math.floor(i),a=Math.floor(s),l=Math.min(o+1,n-1),c=Math.min(a+1,n-1);return Yx(r.get(o,a),r.get(l,a),r.get(o,c),r.get(l,c),i-o,s-a)}const Jx={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function Qx(e,t,r){return(256*e*256+256*t+r)/10-1e4}function $x(e,t,r){return 256*e+t+r/256-32768}class eb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.uid=e,t.height!==t.width)throw new RangeError("DEM tiles must be square");if(r&&"mapbox"!==r&&"terrarium"!==r)return void Ze('"'.concat(r,'" is not a valid encoding type. Valid types include "mapbox" and "terrarium".'));this.stride=t.height;const i=this.dim=t.height-2,s=new Uint32Array(t.data.buffer);if(this.pixels=new Uint8Array(t.data.buffer),this.floatView=new Float32Array(t.data.buffer),this.borderReady=n,this._modifiedForSources={},!n){for(let e=0;e<i;e++)s[this._idx(-1,e)]=s[this._idx(0,e)],s[this._idx(i,e)]=s[this._idx(i-1,e)],s[this._idx(e,-1)]=s[this._idx(e,0)],s[this._idx(e,i)]=s[this._idx(e,i-1)];s[this._idx(-1,-1)]=s[this._idx(0,0)],s[this._idx(i,-1)]=s[this._idx(i-1,0)],s[this._idx(-1,i)]=s[this._idx(0,i-1)],s[this._idx(i,i)]=s[this._idx(i-1,i-1)]}const o="terrarium"===r?$x:Qx;for(let a=0;a<s.length;++a){const e=4*a;this.floatView[a]=o(this.pixels[e],this.pixels[e+1],this.pixels[e+2])}this._timestamp=gt.now()}_buildQuadTree(){this._tree=new Kx(this)}get(e,t){arguments.length>2&&void 0!==arguments[2]&&arguments[2]&&(e=Le(e,-1,this.dim),t=Le(t,-1,this.dim));const r=this._idx(e,t);return this.floatView[r]}set(e,t,r){const n=this._idx(e,t),i=this.floatView[n];return this.floatView[n]=r,r-i}static getUnpackVector(e){return Jx[e]}_idx(e,t){if(e<-1||e>=this.dim+1||t<-1||t>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(t+1)*this.stride+(e+1)}static pack(e,t){const r=[0,0,0,0],n=eb.getUnpackVector(t);let i=Math.floor((e+n[3])/n[2]);return r[2]=i%256,i=Math.floor(i/256),r[1]=i%256,i=Math.floor(i/256),r[0]=i,r}getPixels(){return new Sd({width:this.stride,height:this.stride},this.pixels)}backfillBorder(e,t,r){if(this.dim!==e.dim)throw new Error("dem dimension mismatch");let n=t*this.dim,i=t*this.dim+this.dim,s=r*this.dim,o=r*this.dim+this.dim;switch(t){case-1:n=i-1;break;case 1:i=n+1}switch(r){case-1:s=o-1;break;case 1:o=s+1}const a=-t*this.dim,l=-r*this.dim;for(let c=s;c<o;c++)for(let t=n;t<i;t++){const r=4*this._idx(t,c),n=4*this._idx(t+a,c+l);this.pixels[r+0]=e.pixels[n+0],this.pixels[r+1]=e.pixels[n+1],this.pixels[r+2]=e.pixels[n+2],this.pixels[r+3]=e.pixels[n+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function tb(e,t,r){1===e?t.headerLength=r.readFixed32():2===e?t.x=r.readVarint():3===e?t.y=r.readVarint():4===e?t.z=r.readVarint():5===e&&t.layers.push(function(e,t){return e.readFields(ob,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},t)}(r,r.readVarint()+r.pos))}function rb(e,t,r){1===e?(t.delta_filter=function(e,t){return e.readFields(nb,{blockSize:0},t)}(r,r.readVarint()+r.pos),t.filter="delta_filter"):2===e?(r.readVarint(),t.filter="zigzag_filter"):3===e?(r.readVarint(),t.filter="bitshuffle_filter"):4===e&&(r.readVarint(),t.filter="byteshuffle_filter")}function nb(e,t,r){1===e&&(t.blockSize=r.readVarint())}function ib(e,t,r){1===e?(r.readVarint(),t.codec="gzip_data"):2===e?(r.readVarint(),t.codec="jpeg_image"):3===e?(r.readVarint(),t.codec="webp_image"):4===e&&(r.readVarint(),t.codec="png_image")}function sb(e,t,r){let n=0,i=0;1===e?t.firstByte=r.readFixed64():2===e?t.lastByte=r.readFixed64():3===e?t.filters.push(function(e,t){return e.readFields(rb,{},t)}(r,r.readVarint()+r.pos)):4===e?t.codec=function(e,t){return e.readFields(ib,{},t)}(r,r.readVarint()+r.pos):5===e?i=r.readFloat():6===e?n=r.readFloat():7===e?t.bands.push(r.readString()):8===e?t.offset=r.readDouble():9===e&&(t.scale=r.readDouble()),0===t.offset&&(t.offset=i),0===t.scale&&(t.scale=n)}function ob(e,t,r){1===e?t.version=r.readVarint():2===e?t.name=r.readString():3===e?t.units=r.readString():4===e?t.tileSize=r.readVarint():5===e?t.buffer=r.readVarint():6===e?t.pixelFormat=r.readVarint():7===e&&t.dataIndex.push(function(e,t){return e.readFields(sb,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},t)}(r,r.readVarint()+r.pos))}function ab(e,t,r){if(2===e)!function(e,t,r){e.readFields(lb,r,t)}(r,r.readVarint()+r.pos,t);else if(3===e)throw new Error("Not implemented")}function lb(e,t,r){if(1===e){let e=0;const n=r.readVarint()+r.pos;for(;r.pos<n;)t[e++]=r.readVarint()}}function cb(e,t){if(4!==t.length)throw new Error("Expected data of dimension 4 but got ".concat(t.length,"."));let r=t[3];for(let n=2;n>=1;n--){const i=1===n?1:0,s=2===n?1:0;for(let n=0;n<t[0];n++){const o=t[1]*n;for(let n=i;n<t[1];n++){const i=t[2]*(n+o);for(let n=s;n<t[2];n++){const s=t[3]*(n+i);for(let n=0;n<t[3];n++){const t=s+n;e[t]+=e[t-r]}}}}r*=t[n]}return e}function ub(e){for(let t=0,r=e.length;t<r;t++)e[t]=e[t]>>>1^-(1&e[t]);return e}function db(e,t){switch(t){case"uint32":return e;case"uint16":for(let t=0;t<e.length;t+=2){const r=e[t],n=e[t+1];e[t]=(240&r)>>4|(61440&r)>>8|(240&n)<<4|61440&n,e[t+1]=15&r|(3840&r)>>4|(15&n)<<8|(3840&n)<<4}return e;case"uint8":for(let t=0;t<e.length;t+=4){const r=e[t],n=e[t+1],i=e[t+2],s=e[t+3];e[t+0]=(192&r)>>6|(192&n)>>4|(192&i)>>2|192&s,e[t+1]=(48&r)>>4|(48&n)>>2|48&i|(48&s)<<2,e[t+2]=(12&r)>>2|12&n|(12&i)<<2|(12&s)<<4,e[t+3]=3&r|(3&n)<<2|(3&i)<<4|(3&s)<<6}return e;default:throw new Error('Invalid pixel format, "'.concat(t,'"'))}}$s(eb,"DEMData"),$s(Kx,"DemMinMaxQuadTree",{omit:["dem"]});var hb=Uint8Array,pb=Uint16Array,mb=Int32Array,fb=new hb([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),gb=new hb([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),yb=new hb([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),_b=function(e,t){for(var r=new pb(31),n=0;n<31;++n)r[n]=t+=1<<e[n-1];var i=new mb(r[30]);for(n=1;n<30;++n)for(var s=r[n];s<r[n+1];++s)i[s]=s-r[n]<<5|n;return{b:r,r:i}},vb=_b(fb,2),xb=vb.b,bb=vb.r;xb[28]=258,bb[258]=28;for(var wb=_b(gb,0).b,jb=new pb(32768),Sb=0;Sb<32768;++Sb){var Tb=(43690&Sb)>>1|(21845&Sb)<<1;jb[Sb]=((65280&(Tb=(61680&(Tb=(52428&Tb)>>2|(13107&Tb)<<2))>>4|(3855&Tb)<<4))>>8|(255&Tb)<<8)>>1}var kb=function(e,t,r){for(var n=e.length,i=0,s=new pb(t);i<n;++i)e[i]&&++s[e[i]-1];var o,a=new pb(t);for(i=1;i<t;++i)a[i]=a[i-1]+s[i-1]<<1;o=new pb(1<<t);var l=15-t;for(i=0;i<n;++i)if(e[i])for(var c=i<<4|e[i],u=t-e[i],d=a[e[i]-1]++<<u,h=d|(1<<u)-1;d<=h;++d)o[jb[d]>>l]=c;return o},Ab=new hb(288);for(Sb=0;Sb<144;++Sb)Ab[Sb]=8;for(Sb=144;Sb<256;++Sb)Ab[Sb]=9;for(Sb=256;Sb<280;++Sb)Ab[Sb]=7;for(Sb=280;Sb<288;++Sb)Ab[Sb]=8;var Cb=new hb(32);for(Sb=0;Sb<32;++Sb)Cb[Sb]=5;var Eb=kb(Ab,9),Nb=kb(Cb,5),Ib=function(e){for(var t=e[0],r=1;r<e.length;++r)e[r]>t&&(t=e[r]);return t},Pb=function(e,t,r){var n=t/8|0;return(e[n]|e[n+1]<<8)>>(7&t)&r},Mb=function(e,t){var r=t/8|0;return(e[r]|e[r+1]<<8|e[r+2]<<16)>>(7&t)},Lb=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Rb=function(e,t,r){var n=new Error(t||Lb[e]);if(n.code=e,Error.captureStackTrace&&Error.captureStackTrace(n,Rb),!r)throw n;return n},Db=new hb(0),Fb="undefined"!=typeof TextDecoder&&new TextDecoder;try{Fb.decode(Db,{stream:!0})}catch(e){}const Ob={gzip_data:"gzip"};class zb extends Error{constructor(e){super(e),this.name="MRTError"}}const Bb={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Ub={uint32:1,uint16:2,uint8:4},Vb={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let qb;class Wb{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:5;this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=e}getLayer(e){const t=this.layers[e];if(!t)throw new zb("Layer '".concat(e,"' not found"));return t}getHeaderLength(e){const t=new Uint8Array(e),r=new DataView(e);if(13!==t[0])throw new zb("File is not a valid MRT.");return r.getUint32(1,!0)}parseHeader(e){const t=new Uint8Array(e),r=this.getHeaderLength(e);if(t.length<r)throw new zb("Expected header with length >= ".concat(r," but got buffer of length ").concat(t.length));const n=new qb(t.subarray(0,r)).readFields(tb,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==n.x||this.y!==n.y||this.z!==n.z))throw new zb("Invalid attempt to parse header ".concat(n.z,"/").concat(n.x,"/").concat(n.y," for tile ").concat(this.z,"/").concat(this.x,"/").concat(this.y));this.x=n.x,this.y=n.y,this.z=n.z;for(const i of n.layers)this.layers[i.name]=new Hb(i,{cacheSize:this._cacheSize});return this}createDecodingTask(e){const t=[],r=this.getLayer(e.layerName);for(let n of e.blockIndices){const i=r.dataIndex[n],s=i.firstByte-e.firstByte,o=i.lastByte-e.firstByte;if(r._blocksInProgress.has(n))continue;const a={layerName:r.name,firstByte:s,lastByte:o,pixelFormat:r.pixelFormat,blockIndex:n,blockShape:[i.bands.length].concat(r.bandShape),buffer:r.buffer,codec:i.codec.codec,filters:i.filters.map(e=>e.filter)};r._blocksInProgress.add(n),t.push(a)}return new Gb(t,()=>{t.forEach(e=>r._blocksInProgress.delete(e.blockIndex))},(e,n)=>{if(t.forEach(e=>r._blocksInProgress.delete(e.blockIndex)),e)throw e;n.forEach(e=>{this.getLayer(e.layerName).processDecodedData(e)})})}}class Hb{constructor(e,t){let{version:r,name:n,units:i,tileSize:s,pixelFormat:o,buffer:a,dataIndex:l}=e;if(this.version=r,1!==this.version)throw new zb("Cannot parse raster layer encoded with MRT version ".concat(r));this.name=n,this.units=i,this.tileSize=s,this.buffer=a,this.pixelFormat=Bb[o],this.dataIndex=l,this.bandShape=[s+2*a,s+2*a,Ub[this.pixelFormat]],this._decodedBlocks=new Ux(t?t.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Ub[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(e=>{let{bands:t}=e;return t}).flat()}processDecodedData(e){const t=e.blockIndex.toString();this._decodedBlocks.get(t)||this._decodedBlocks.put(t,e.data)}getBlockForBand(e){let t=0;switch(typeof e){case"string":for(const[r,n]of this.dataIndex.entries()){for(const[i,s]of n.bands.entries())if(s===e)return{bandIndex:t+i,blockIndex:r,blockBandIndex:i};t+=n.bands.length}break;case"number":for(const[r,n]of this.dataIndex.entries()){if(e>=t&&e<t+n.bands.length)return{bandIndex:e,blockIndex:r,blockBandIndex:e-t};t+=n.bands.length}break;default:throw new zb("Invalid band `".concat(JSON.stringify(e),"`. Expected string or integer."))}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(e){let t=1/0,r=-1/0;const n=[],i=new Set;for(const s of e){const{blockIndex:e}=this.getBlockForBand(s);if(e<0)throw new zb("Invalid band: ".concat(JSON.stringify(s)));const o=this.dataIndex[e];n.includes(e)||n.push(e),i.add(e),t=Math.min(t,o.firstByte),r=Math.max(r,o.lastByte)}if(i.size>this.cacheSize)throw new zb("Number of blocks to decode (".concat(i.size,") exceeds cache size (").concat(this.cacheSize,")."));return{layerName:this.name,firstByte:t,lastByte:r,blockIndices:n}}hasBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0}hasDataForBand(e){const{blockIndex:t}=this.getBlockForBand(e);return t>=0&&!!this._decodedBlocks.get(t.toString())}getBandView(e){const{blockIndex:t,blockBandIndex:r}=this.getBlockForBand(e);if(t<0)throw new zb("Band not found: ".concat(JSON.stringify(e)));const n=this._decodedBlocks.get(t.toString());if(!n)throw new zb("Data for band ".concat(JSON.stringify(e),' of layer "').concat(this.name,'" not decoded.'));const i=this.dataIndex[t],s=this.bandShape.reduce((e,t)=>e*t,1),o=r*s,a=n.subarray(o,o+s);return{data:a,bytes:new Uint8Array(a.buffer).subarray(a.byteOffset,a.byteOffset+a.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:i.offset,scale:i.scale}}}Wb.setPbf=function(e){qb=e};class Gb{constructor(e,t,r){this.tasks=e,this._onCancel=t,this._onComplete=r,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(e,t){this._finalized||(this._onComplete(e,t),this._finalized=!0)}}Wb.performDecoding=function(e,t){const r=new Uint8Array(e);return Promise.all(t.tasks.map(e=>{const{layerName:t,firstByte:n,lastByte:i,pixelFormat:s,blockShape:o,blockIndex:a,filters:l,codec:c}=e,u=r.subarray(n,i+1),d=new Uint32Array(o[0]*o[1]*o[2]);let h;if("gzip_data"!==c)throw new zb("Unhandled codec: ".concat(c));return h=function(e,t){if(!globalThis.DecompressionStream&&"gzip_data"===t)return Promise.resolve(((s=function(e){31==e[0]&&139==e[1]&&8==e[2]||Rb(6,"invalid gzip data");var t=e[3],r=10;4&t&&(r+=2+(e[10]|e[11]<<8));for(var n=(t>>3&1)+(t>>4&1);n>0;n-=!e[r++]);return r+(2&t)}(i=e))+8>i.length&&Rb(6,"invalid gzip data"),function(e,t,r){var n=e.length;if(!n||t.f&&!t.l)return r||new hb(0);var i=!r,s=i||2!=t.i,o=t.i;i&&(r=new hb(3*n));var a,l,c=function(e){var t=r.length;if(e>t){var n=new hb(Math.max(2*t,e));n.set(r),r=n}},u=t.f||0,d=t.p||0,h=t.b||0,p=t.l,m=t.d,f=t.m,g=t.n,y=8*n;do{if(!p){u=Pb(e,d,1);var _=Pb(e,d+1,3);if(d+=3,!_){var v=e[(N=4+((d+7)/8|0))-4]|e[N-3]<<8,x=N+v;if(x>n){o&&Rb(0);break}s&&c(h+v),r.set(e.subarray(N,x),h),t.b=h+=v,t.p=d=8*x,t.f=u;continue}if(1==_)p=Eb,m=Nb,f=9,g=5;else if(2==_){var b=Pb(e,d,31)+257,w=Pb(e,d+10,15)+4,j=b+Pb(e,d+5,31)+1;d+=14;for(var S=new hb(j),T=new hb(19),k=0;k<w;++k)T[yb[k]]=Pb(e,d+3*k,7);d+=3*w;var A=Ib(T),C=(1<<A)-1,E=kb(T,A);for(k=0;k<j;){var N,I=E[Pb(e,d,C)];if(d+=15&I,(N=I>>4)<16)S[k++]=N;else{var P=0,M=0;for(16==N?(M=3+Pb(e,d,3),d+=2,P=S[k-1]):17==N?(M=3+Pb(e,d,7),d+=3):18==N&&(M=11+Pb(e,d,127),d+=7);M--;)S[k++]=P}}var L=S.subarray(0,b),R=S.subarray(b);f=Ib(L),g=Ib(R),p=kb(L,f),m=kb(R,g)}else Rb(1);if(d>y){o&&Rb(0);break}}s&&c(h+131072);for(var D=(1<<f)-1,F=(1<<g)-1,O=d;;O=d){var z=(P=p[Mb(e,d)&D])>>4;if((d+=15&P)>y){o&&Rb(0);break}if(P||Rb(2),z<256)r[h++]=z;else{if(256==z){O=d,p=null;break}var B=z-254;z>264&&(B=Pb(e,d,(1<<(q=fb[k=z-257]))-1)+xb[k],d+=q);var U=m[Mb(e,d)&F],V=U>>4;if(U||Rb(3),d+=15&U,R=wb[V],V>3){var q=gb[V];R+=Mb(e,d)&(1<<q)-1,d+=q}if(d>y){o&&Rb(0);break}s&&c(h+131072);var W=h+B;if(h<R){var H=0-R,G=Math.min(R,W);for(H+h<0&&Rb(3);h<G;++h)r[h]=(void 0)[H+h]}for(;h<W;++h)r[h]=r[h-R]}}t.l=p,t.p=O,t.b=h,t.f=u,p&&(u=1,t.m=f,t.d=m,t.n=g)}while(!u);return h!=r.length&&i?(a=r,(null==(l=h)||l>a.length)&&(l=a.length),new hb(a.subarray(0,l))):r.subarray(0,h)}(i.subarray(s,-8),{i:2},new hb(((r=i)[(n=r.length)-4]|r[n-3]<<8|r[n-2]<<16|r[n-1]<<24)>>>0))));var r,n,i,s;const o=Ob[t];if(!o)throw new Error("Unhandled codec: ".concat(t));const a=new globalThis.DecompressionStream(o);return new Response(new Blob([e]).stream().pipeThrough(a)).arrayBuffer().then(e=>new Uint8Array(e))}(u,c).then(e=>(function(e,t){e.readFields(ab,t)}(new qb(e),d),new(0,Vb[s])(d.buffer))),h.then(e=>{for(let t=l.length-1;t>=0;t--)switch(l[t]){case"delta_filter":cb(e,o);break;case"zigzag_filter":ub(e);break;case"bitshuffle_filter":db(e,s);break;default:throw new zb('Unhandled filter "'.concat(l[t],'"'))}return{layerName:t,blockIndex:a,data:e}}).catch(e=>{throw e})}))},$s(Gb,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),$s(Wb,"MapboxRasterTile"),$s(Hb,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Zb{constructor(e){this._stringToNumber={},this._numberToString=[];for(let t=0;t<e.length;t++){const r=e[t];this._stringToNumber[r]=t,this._numberToString[t]=r}}encode(e){return this._stringToNumber[e]}decode(e){return this._numberToString[e]}}class Kb{constructor(e,t){this.tileID=e,this.x=e.canonical.x,this.y=e.canonical.y,this.z=e.canonical.z,this.grid=new Js(Bn,16,0),this.featureIndexArray=new il,this.promoteId=t,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;const a=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(r,n,i,s);const l=this.grid;for(let c=0;c<t.length;c++){const e=t[c],r=[1/0,1/0,-1/0,-1/0];for(let t=0;t<e.length;t++){const n=e[t];r[0]=Math.min(r[0],n.x),r[1]=Math.min(r[1],n.y),r[2]=Math.max(r[2],n.x),r[3]=Math.max(r[3],n.y)}0!==o&&(r[0]-=o,r[1]-=o,r[2]+=o,r[3]+=o),r[0]<Bn&&r[1]<Bn&&r[2]>=0&&r[3]>=0&&l.insert(a,r[0],r[1],r[2],r[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new Rc(new kg(this.rawTileData)).layers,this.sourceLayerCoder=new Zb(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const e in this.vtLayers)this.vtFeatures[e]=[]}return this.vtLayers}query(e,t){var r=this;const{tilespaceGeometry:n,transform:i,tileTransform:s,pixelPosMatrix:o,availableImages:a,worldview:l}=t;this.loadVTLayers(),this.serializedLayersCache.clear();const c=t.queryRadius?t.queryRadius:0,u=n.bufferedTilespaceBounds,d=this.grid.query(u.min.x,u.min.y,u.max.x,u.max.y,(e,t,r,i)=>gu(n.bufferedTilespaceGeometry,e-c,t-c,r+c,i+c));d.sort(Xb);let h=null;i.elevation&&d.length>0&&(h=Nv.create(i.elevation,this.tileID));const p={};let m;for(let f=0;f<d.length;f++){const t=d[f];if(t===m)continue;m=t;const c=this.featureIndexArray.get(t);let u=null;this.is3DTile?this.loadMatchingModelFeature(p,c,e,n,i,l):this.loadMatchingFeature(p,c,e,a,l,function(e,t,a){let l=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;return u||(u=Cc(e,r.tileID.canonical,s)),t.queryIntersectsFeature(n,e,a,u,r.z,i,o,h,l)})}return p}loadMatchingFeature(e,t,r,n,i,s){const{featureIndex:o,bucketIndex:a,sourceLayerIndex:l,layoutVertexArrayOffset:c}=t,u=this.bucketLayerIDs[a],d=r.layers,h=Object.keys(d);if(h.length&&!He(h,u))return;const p=r.sourceCache,m=this.sourceLayerCoder.decode(l),f=this.vtLayers[m].feature(o),g=this.getId(f,m);for(let y=0;y<u.length;y++){const t=u[y];if(!d[t])continue;const{styleLayer:r,targets:a}=d[t];let l={};void 0!==g&&(l=p.getFeatureState(r.sourceLayer,g));const h=!s||s(f,r,l,c);if(!h)continue;const m=new Vv(f,this.z,this.x,this.y,g);m.tile=this.tileID.canonical,m.state=l;let _=this.serializedLayersCache.get(t);_||(_=r.serialize(),_.id=t,this.serializedLayersCache.set(t,_)),m.source=_.source,m.sourceLayer=_["source-layer"],m.layer=Object.assign({},_),m.layer.paint=Yb(_.paint,r.paint,f,l,n),m.layer.layout=Yb(_.layout,r.layout,f,l,n);let v=!1;for(const e of a){this.updateFeatureProperties(m,e);const{filter:t}=e;if(t)if(f.properties=m.properties,t.needGeometry){const e=Ec(f,!0);if(!t.filter(new So(this.tileID.overscaledZ,{worldview:i}),e,this.tileID.canonical))continue}else if(!t.filter(new So(this.tileID.overscaledZ,{worldview:i}),f))continue;v=!0,e.targetId&&this.addFeatureVariant(m,e)}v&&this.appendToResult(e,t,o,m,h)}}loadMatchingModelFeature(e,t,r,n,i,s){const{featureIndex:o,bucketIndex:a}=t,l=this.bucketLayerIDs[a],c=r.layers,u=Object.keys(c);if(!u.length||He(u,l))for(let d=0;d<l.length;d++){const t=l[d],{styleLayer:a,targets:u}=c[t];if("model"!==a.type)continue;const h=n.tile,p=h.getBucket(a);if(!(p&&p instanceof Fv))continue;const m=Hv(p,o,n,i);if(!m)continue;const{z:f,x:g,y:y}=h.tileID.canonical,{feature:_,intersectionZ:v,position:x}=m;let b={};void 0!==_.id&&(b=r.sourceCache.getFeatureState(a.sourceLayer,_.id));const w=new Vv({},f,g,y,_.id);w.tile=this.tileID.canonical,w.state=b,w.properties=_.properties,w.geometry={type:"Point",coordinates:[x.lng,x.lat]};let j=this.serializedLayersCache.get(t);j||(j=a.serialize(),j.id=t,this.serializedLayersCache.set(t,j)),w.source=j.source,w.sourceLayer=j["source-layer"],w.layer=Object.assign({},j);let S=!1;for(const e of u){this.updateFeatureProperties(w,e);const{filter:t}=e;if(t)if(_.properties=w.properties,t.needGeometry){if(!t.filter(new So(this.tileID.overscaledZ,{worldview:s}),_,this.tileID.canonical))continue}else if(!t.filter(new So(this.tileID.overscaledZ,{worldview:s}),_))continue;S=!0,e.targetId&&this.addFeatureVariant(w,e)}S&&this.appendToResult(e,t,o,w,v)}}updateFeatureProperties(e,t,r){if(t.properties){const n={};for(const i in t.properties){const s=t.properties[i].evaluate({zoom:this.z},e._vectorTileFeature,e.state,e.tile,r);null!=s&&(n[i]=s)}e.properties=n}}addFeatureVariant(e,t,r){const n={target:t.target,namespace:t.namespace,uniqueFeatureID:t.uniqueFeatureID};t.properties&&(n.properties=e.properties),e.variants=e.variants||{},e.variants[t.targetId]=e.variants[t.targetId]||[],e.variants[t.targetId].push(n)}appendToResult(e,t,r,n,i){let s=e[t];void 0===s&&(s=e[t]=[]),s.push({featureIndex:r,feature:n,intersectionZ:i})}lookupSymbolFeatures(e,t,r,n,i,s){const o={};this.loadVTLayers();for(const a of e)this.loadMatchingFeature(o,{bucketIndex:t,sourceLayerIndex:r,featureIndex:a,layoutVertexArrayOffset:0},n,i,s);return o}loadFeature(e){const{featureIndex:t,sourceLayerIndex:r}=e;this.loadVTLayers();const n=this.sourceLayerCoder.decode(r),i=this.vtFeatures[n];if(i[t])return i[t];const s=this.vtLayers[n].feature(t);return i[t]=s,s}hasLayer(e){for(const t of this.bucketLayerIDs)for(const r of t)if(e===r)return!0;return!1}getId(e,t){let r=e.id;if(this.promoteId){const n=Array.isArray(this.promoteId)||"object"!=typeof this.promoteId?this.promoteId:this.promoteId[t];if(null!=n)if(Array.isArray(n)){if(!this.promoteIdExpression){const e=Vs(n);if("success"!==e.result){const t=e.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", ");return void Ze("Failed to create expression for promoteId: ".concat(t))}this.promoteIdExpression=e.value}r=this.promoteIdExpression.evaluate({zoom:0},e)}else r=e.properties[n];"boolean"==typeof r&&(r=Number(r))}return r}}function Yb(e,t,r,n,i){return Ve(e,(e,s)=>{const o=t instanceof Po?t.get(s):null;return o&&o.evaluate?o.evaluate(r,n,void 0,i):o})}function Xb(e,t){return t-e}$s(Kb,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Jb=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Qb{static from(e){if(!(e instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[t,r]=new Uint8Array(e,0,2);if(219!==t)throw new Error("Data does not appear to be in a KDBush format.");const n=r>>4;if(1!==n)throw new Error("Got v".concat(n," data when expected v1."));const i=Jb[15&r];if(!i)throw new Error("Unrecognized array type.");const[s]=new Uint16Array(e,2,1),[o]=new Uint32Array(e,4,1);return new Qb(o,s,i,e)}constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:64,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:Float64Array,n=arguments.length>3?arguments[3]:void 0;if(isNaN(e)||e<0)throw new Error("Unpexpected numItems value: ".concat(e,"."));this.numItems=+e,this.nodeSize=Math.min(Math.max(+t,2),65535),this.ArrayType=r,this.IndexArrayType=e<65536?Uint16Array:Uint32Array;const i=Jb.indexOf(this.ArrayType),s=2*e*this.ArrayType.BYTES_PER_ELEMENT,o=e*this.IndexArrayType.BYTES_PER_ELEMENT,a=(8-o%8)%8;if(i<0)throw new Error("Unexpected typed array class: ".concat(r,"."));n&&n instanceof ArrayBuffer?(this.data=n,this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=2*e,this._finished=!0):(this.data=new ArrayBuffer(8+s+o+a),this.ids=new this.IndexArrayType(this.data,8,e),this.coords=new this.ArrayType(this.data,8+o+a,2*e),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+i]),new Uint16Array(this.data,2,1)[0]=t,new Uint32Array(this.data,4,1)[0]=e)}add(e,t){const r=this._pos>>1;return this.ids[r]=r,this.coords[this._pos++]=e,this.coords[this._pos++]=t,r}finish(){const e=this._pos>>1;if(e!==this.numItems)throw new Error("Added ".concat(e," items when expected ").concat(this.numItems,"."));return $b(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(e,t,r,n){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:i,coords:s,nodeSize:o}=this,a=[0,i.length-1,0],l=[];for(;a.length;){const c=a.pop()||0,u=a.pop()||0,d=a.pop()||0;if(u-d<=o){for(let o=d;o<=u;o++){const a=s[2*o],c=s[2*o+1];a>=e&&a<=r&&c>=t&&c<=n&&l.push(i[o])}continue}const h=d+u>>1,p=s[2*h],m=s[2*h+1];p>=e&&p<=r&&m>=t&&m<=n&&l.push(i[h]),(0===c?e<=p:t<=m)&&(a.push(d),a.push(h-1),a.push(1-c)),(0===c?r>=p:n>=m)&&(a.push(h+1),a.push(u),a.push(1-c))}return l}within(e,t,r){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:n,coords:i,nodeSize:s}=this,o=[0,n.length-1,0],a=[],l=r*r;for(;o.length;){const c=o.pop()||0,u=o.pop()||0,d=o.pop()||0;if(u-d<=s){for(let r=d;r<=u;r++)nw(i[2*r],i[2*r+1],e,t)<=l&&a.push(n[r]);continue}const h=d+u>>1,p=i[2*h],m=i[2*h+1];nw(p,m,e,t)<=l&&a.push(n[h]),(0===c?e-r<=p:t-r<=m)&&(o.push(d),o.push(h-1),o.push(1-c)),(0===c?e+r>=p:t+r>=m)&&(o.push(h+1),o.push(u),o.push(1-c))}return a}}function $b(e,t,r,n,i,s){if(i-n<=r)return;const o=n+i>>1;ew(e,t,o,n,i,s),$b(e,t,r,n,o-1,1-s),$b(e,t,r,o+1,i,1-s)}function ew(e,t,r,n,i,s){for(;i>n;){if(i-n>600){const o=i-n+1,a=r-n+1,l=Math.log(o),c=.5*Math.exp(2*l/3),u=.5*Math.sqrt(l*c*(o-c)/o)*(a-o/2<0?-1:1);ew(e,t,r,Math.max(n,Math.floor(r-a*c/o+u)),Math.min(i,Math.floor(r+(o-a)*c/o+u)),s)}const o=t[2*r+s];let a=n,l=i;for(tw(e,t,n,r),t[2*i+s]>o&&tw(e,t,n,i);a<l;){for(tw(e,t,a,l),a++,l--;t[2*a+s]<o;)a++;for(;t[2*l+s]>o;)l--}t[2*n+s]===o?tw(e,t,n,l):(l++,tw(e,t,l,i)),l<=r&&(n=l+1),r<=l&&(i=l-1)}}function tw(e,t,r,n){rw(e,r,n),rw(t,2*r,2*n),rw(t,2*r+1,2*n+1)}function rw(e,t,r){const n=e[t];e[t]=e[r],e[r]=n}function nw(e,t,r,n){const i=e-r,s=t-n;return i*i+s*s}e.$=$r,e.A=Fr,e.B=ea,e.C=2,e.D=Kp,e.E=nr,e.F=wy,e.G=xy,e.H=Xr,e.I=ir,e.J=Oo,e.K=Yr,e.L=Qr,e.M=Is,e.N=Cs,e.O=Ns,e.P=Se,e.Q=Us,e.R=Rt,e.S=zo,e.T=Nm,e.U=Vs,e.V=jv,e.W=Hs,e.X=vi,e.Y=yi,e.Z=_i,e._=sn,e.a=function(e){return ot.API_CDN_URL_REGEX.test(e)},e.a$=pc,e.a0=Jr,e.a1=ar,e.a2=Bo,e.a3=class extends jv{},e.a4=Ps,e.a5=Es,e.a6=Fo,e.a7=function(e){const t=e.value;return t?Jr(t)?Sv(t,!0)?[]:[new jv(e.key,t,'invalid url "'.concat(t,'"'))]:[new jv(e.key,t,'string expected, "'.concat(Yr(t),'" found'))]:[]},e.a8=Ao,e.a9=Do,e.aA=Le,e.aB=d,e.aC=$,e.aD=Gl,e.aE=fu,e.aF=cc,e.aG=wc,e.aH=function(e,t){const r={};for(let n=0;n<t.length;n++){const i=t[n];i in e&&(r[i]=e[i])}return r},e.aI=sc,e.aJ=uc,e.aK=class{constructor(e){this.entries={},this.scheduler=e}request(e,t,r,n){const i=this.entries[e]=this.entries[e]||{callbacks:[]};if(i.result){const[e,r]=i.result;return this.scheduler?this.scheduler.add(()=>{n(e,r)},t):n(e,r),()=>{}}return i.callbacks.push(n),i.cancel||(i.cancel=r((r,n)=>{i.result=[r,n];for(const e of i.callbacks)this.scheduler?this.scheduler.add(()=>{e(r,n)},t):e(r,n);setTimeout(()=>delete this.entries[e],3e3)})),()=>{i.result||(i.callbacks=i.callbacks.filter(e=>e!==n),i.callbacks.length||(i.cancel(),delete this.entries[e]))}}},e.aL=function(e,t,r){const n=JSON.stringify(e.request);return e.data&&(this.deduped.entries[n]={result:[null,e.data]}),this.deduped.request(n,{type:"parseTile",isSymbolTile:e.isSymbolTile,zoom:e.tileZoom},t=>{const n=zt(e.request,(e,n,i)=>{e?t(e):n&&t(null,{rawData:n,vectorTile:r?void 0:new Rc(new kg(n)),responseHeaders:new Map(i.entries())})});return()=>{n.cancel(),t()}},t)},e.aM=function(e){return e?{cacheControl:e.get("Cache-Control"),expires:e.get("Expires")}:{cacheControl:void 0,expires:void 0}},e.aN=Dt,e.aO=function(e){At++,At>bt&&(e.getActor().send("enforceCacheSizeLimit",xt),At=0)},e.aP=function(e){return e<=1?1:Math.pow(2,Math.floor(Math.log2(e)))},e.aQ=Eu,e.aR=pv,e.aS=vv,e.aT=ic,e.aU=dv,e.aV=function(e,t){const r=document.createElement("video");r.muted=!0,r.onloadstart=function(){t(null,r)};for(let n=0;n<e.length;n++){const t=document.createElement("source");Bt(e[n])||(r.crossOrigin="Anonymous"),t.src=e[n],r.appendChild(t)}return{cancel:()=>{}}},e.aW=Im,e.aX=qv,e.aY=Ue,e.aZ=g_,e.a_=hc,e.aa=Mo,e.ab=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return Xe(e.expression.evaluate(t))}interpolate(e,t,r){return{x:hr(e.x,t.x,r),y:hr(e.y,t.y,r),z:hr(e.z,t.z,r),azimuthal:hr(e.azimuthal,t.azimuthal,r),polar:hr(e.polar,t.polar,r)}}},e.ac=So,e.ad=Ws,e.ae=xc,e.af=V,e.ag=S,e.ah=Re,e.ai=Po,e.aj=td,e.ak=hr,e.al=Bn,e.am=pr,e.an=Ce,e.ao=lr,e.ap=class{constructor(e){this.specification=e}possiblyEvaluate(e,t){return function(e){let[t,r]=e;const n=Xe([1,t,r]);return{x:n.x,y:n.y,z:n.z}}(e.expression.evaluate(t))}interpolate(e,t,r){return{x:hr(e.x,t.x,r),y:hr(e.y,t.y,r),z:hr(e.z,t.z,r)}}},e.aq=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=!(arguments.length>3&&void 0!==arguments[3])||arguments[3];const i=new Se(r,r),s=e.sub(i),o=t.add(i),a=[s,new Se(o.x,s.y),o,new Se(s.x,o.y)];return n&&a.push(s.clone()),a},e.ar=function(e,t){const r=[];for(let n=0;n<e.length;n++){const i=De(n-1,-1,e.length-1),s=De(n+1,-1,e.length-1),o=e[n],a=e[s],l=e[i].sub(o).unit(),c=a.sub(o).unit(),u=c.angleWithSep(l.x,l.y),d=l.add(c).unit().mult(-1*t/Math.sin(u/2));r.push(o.add(d))}return r},e.as=y_,e.at=gu,e.au=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return T(((t.x-r)*e.scale-e.x)*Bn,(t.y*e.scale-e.y)*Bn,mc(t.z,t.y))},e.av=Z,e.aw=O,e.ax=Hc,e.ay=Jf,e.az=function(e){let t=1/0,r=1/0,n=-1/0,i=-1/0;for(const s of e)t=Math.min(t,s.x),r=Math.min(r,s.y),n=Math.max(n,s.x),i=Math.max(i,s.y);return{min:new Se(t,r),max:new Se(n,i)}},e.b=function(e){return ot.API_FONTS_REGEX.test(e)},e.b$=Zh,e.b0=La,e.b1=fa,e.b2=ze,e.b3=Xa,e.b4=Y_,e.b5=function(){jo.isLoading()||jo.isLoaded()||"deferred"!==bo()||wo()},e.b6=Uo,e.b7=Ec,e.b8=Vv,e.b9=Qe,e.bA=c,e.bB=g,e.bC=a,e.bD=function(e,t){const{x:r,y:n}=e.point,i=ed(r,n,e.worldSize/e._pixelsPerMercatorPixel,0,0);return d(i,i,Ju(Uu(t)))},e.bE=n,e.bF=H,e.bG=L,e.bH=M,e.bI=B,e.bJ=z,e.bK=dy,e.bL=qg,e.bM=uy,e.bN=function(e,t,r,n,i){const s=5*t+2;e.float32[s+0]=r,e.float32[s+1]=n,e.float32[s+2]=i},e.bO=H_,e.bP=ue,e.bQ=me,e.bR=he,e.bS=xe,e.bT=De,e.bU=function(e,t,n,i){var s=new r(4);return s[0]=e,s[1]=t,s[2]=n,s[3]=i,s},e.bV=class{isDataAvailableAtPoint(e){const t=this._source();if(this.isUsingMockSource()||!t||e.y<0||e.y>1)return!1;const r=t.getSource().maxzoom,n=1<<r,i=Math.floor(e.x),s=Math.floor((e.x-i)*n),o=Math.floor(e.y*n),a=this.findDEMTileFor(new Eu(r,i,r,s,o));return!(!a||!a.dem)}getAtPointOrZero(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0;return this.getAtPoint(e,t)||0}getAtPoint(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];if(this.isUsingMockSource())return null;null==t&&(t=null);const n=this._source();if(!n)return t;if(e.y<0||e.y>1)return t;const i=n.getSource().maxzoom,s=1<<i,o=Math.floor(e.x),a=e.x-o,l=new Eu(i,o,i,Math.floor(a*s),Math.floor(e.y*s)),c=this.findDEMTileFor(l);if(!c||!c.dem)return t;const u=c.dem,d=1<<c.tileID.canonical.z,h=(a*d-c.tileID.canonical.x)*u.dim,p=(e.y*d-c.tileID.canonical.y)*u.dim,m=Math.floor(h),f=Math.floor(p);return(r?this.exaggeration():1)*hr(hr(u.get(m,f),u.get(m,f+1),p-f),hr(u.get(m+1,f),u.get(m+1,f+1),p-f),h-m)}static getAtTileOffset(e,t,r,n){const i=1<<e.canonical.z;return n?n.pointElevation(t):r?r.getAtPointOrZero(new xc(e.wrap+(e.canonical.x+t.x/Bn)/i,(e.canonical.y+t.y/Bn)/i)):0}static getAtTileOffsetFunc(e,t,r,n){return(i,s,o)=>{const a=this.getAtTileOffset(e,i,s,o),l=n.upVector(e.canonical,i.x,i.y);return P(l,l,a*n.upVectorScale(e.canonical,t,r).metersToTile),l}}getForTilePoints(e,t,r,n){if(this.isUsingMockSource())return!1;const i=Nv.create(this,e,n);return!!i&&(t.forEach(e=>{e[2]=this.exaggeration()*i.getElevationAt(e[0],e[1],r)}),!0)}getMinMaxForTile(e){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(e);if(!t||!t.dem)return null;const r=t.dem.tree,n=t.tileID,i=1<<e.canonical.z-n.canonical.z;let s=e.canonical.x/i-n.canonical.x,o=e.canonical.y/i-n.canonical.y,a=0;for(let l=0;l<e.canonical.z-n.canonical.z&&!r.leaves[a];l++){s*=2,o*=2;const e=2*Math.floor(o)+Math.floor(s);a=r.childOffsets[a]+e,s%=1,o%=1}return{min:this.exaggeration()*r.minimums[a],max:this.exaggeration()*r.maximums[a]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(e,t,r){throw new Error("Pure virtual method called.")}pointCoordinate(e){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(e){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const e=this.visibleDemTiles;if(0===e.length)return null;let t=!1,r=Number.MAX_VALUE,n=Number.MIN_VALUE;for(const i of e){const e=this.getMinMaxForTile(i.tileID);e&&(r=Math.min(r,e.min),n=Math.max(n,e.max),t=!0)}return t?{min:r,max:n}:null}},e.bW=Lp,e.bX=iu,e.bY=_g,e.bZ=Oh,e.b_=wv,e.ba=Zf,e.bb=xh,e.bc=Cc,e.bd=pa,e.be=Wa,e.bf=Ru,e.bg=dl,e.bh=Nd,e.bi=av,e.bj=function(e,t){const r=td(t.zoom);if(0===r)return Uu(e);const n=Hu(e),i=Gu(n),s=cc(n.getWest())*t.worldSize,o=cc(n.getEast())*t.worldSize,a=uc(n.getNorth())*t.worldSize,l=uc(n.getSouth())*t.worldSize,c=[s,a,0],d=[o,a,0],h=[s,l,0],p=[o,l,0],m=u([],t.globeMatrix);return V(c,c,m),V(d,d,m),V(h,h,m),V(p,p,m),i[0]=Vu(i[0],h,r),i[1]=Vu(i[1],p,r),i[2]=Vu(i[2],d,r),i[3]=Vu(i[3],c,r),Qc.fromPoints(i)},e.bk=Xu,e.bl=u,e.bm=Zu,e.bn=Vu,e.bo=ma,e.bp=Lu,e.bq=y,e.br=h,e.bs=Wb,e.bt=kg,e.bu=zt,e.bv=function(e,t){const r=[];for(const n in e)n in t||r.push(n);return r},e.bw=Fe,e.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],e.by=Te,e.bz=l,e.c=lt,e.c$=function(e,t,r){let n=0;for(let i=0;i<2;++i){const r=0;e[i]>r&&(n+=(e[i]-r)*(e[i]-r)),t[i]<r&&(n+=(r-t[i])*(r-t[i]))}return n},e.c0=Kh,e.c1=ey,e.c2=Ky,e.c3=s_,e.c4=Qb,e.c5=P,e.c6=Y,e.c7=te,e.c8=function(e,t,r){r*=.5;var n=t[0],i=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=n*l+i*a,e[1]=i*l-n*a,e[2]=s*l+o*a,e[3]=o*l-s*a,e},e.c9=re,e.cA=w,e.cB=Jc,e.cC=Bm,e.cD=Au,e.cE=Wu,e.cF=function(e,t,r,n,i,s,o,a,l){if("globe"===l.name)return Wu(e,t,new Au(r,n,i),!1);const c=g_({z:r,x:n,y:i},l);return new Qc([(s+c.x/c.scale)*t,t*(c.y/c.scale),o],[(s+c.x2/c.scale)*t,t*(c.y2/c.scale),a])},e.cG=function(e,t,r){return e[0]=Math.min(t[0],r[0]),e[1]=Math.min(t[1],r[1]),e[2]=Math.min(t[2],r[2]),e[3]=Math.min(t[3],r[3]),e},e.cH=function(e,t,r){return e[0]=Math.max(t[0],r[0]),e[1]=Math.max(t[1],r[1]),e[2]=Math.max(t[2],r[2]),e[3]=Math.max(t[3],r[3]),e},e.cI=function(e){const t=Math.round((e+45+360)%360/90)%4;return Ne[t]},e.cJ=fc,e.cK=J,e.cL=Kl,e.cM=function(e){const t=c(new Float64Array(16));d(t,e.pixelMatrix,e.globeMatrix);const r=[0,Ql,0],n=[0,$l,0];return V(r,r,t),V(n,n,t),[r[0]>0&&r[0]<=e.width&&r[1]>0&&r[1]<=e.height&&!nd(e,new ic(e.center.lat,90)),n[0]>0&&n[0]<=e.width&&n[1]>0&&n[1]<=e.height&&!nd(e,new ic(e.center.lat,-90))]},e.cN=function(e,t){const{scale:r}=e.tileTransform,n=r*Bn/(e.tileSize*Math.pow(2,t.zoom-e.tileID.overscaledZ+e.tileID.canonical.z));return function(e,t,r){var n=t[1],i=t[2],s=t[3],o=r[0],a=r[1];return e[0]=t[0]*o,e[1]=n*o,e[2]=i*a,e[3]=s*a,e}(new Float32Array(4),t.inverseAdjustmentMatrix,[n,n])},e.cO=Um,e.cP=b,e.cQ=zm,e.cR=function(e){const t=zm(e,!0);return n([],[t[0],t[1],t[4],t[5]])},e.cS=p,e.cT=Gc,e.cU=m,e.cV=function(e){const{x:t,y:r}=e.point,{lng:n,lat:i}=e._center;return ed(t,r,e.worldSize,n,i)},e.cW=E,e.cX=Ee,e.cY=Nu,e.cZ=yu,e.c_=Zl,e.ca=et,e.cb=function(e,t){return e[0]=-t[0],e[1]=-t[1],e[2]=-t[2],e[3]=t[3],e},e.cc=x,e.cd=function(e,t,r,n,i){var s=1/Math.tan(t/2);if(e[0]=s/r,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=s,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[11]=-1,e[12]=0,e[13]=0,e[15]=0,null!=i&&i!==1/0){var o=1/(n-i);e[10]=(i+n)*o,e[14]=2*i*n*o}else e[10]=-1,e[14]=-2*n;return e},e.ce=function(e,t,r,n,i,s,o){var a=1/(t-r),l=1/(n-i),c=1/(s-o);return e[0]=-2*a,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e[5]=-2*l,e[6]=0,e[7]=0,e[8]=0,e[9]=0,e[10]=2*c,e[11]=0,e[12]=(t+r)*a,e[13]=(i+n)*l,e[14]=(o+s)*c,e[15]=1,e},e.cf=dc,e.cg=function(e,t,r){e[4*t+0]=r[0],e[4*t+1]=r[1],e[4*t+2]=r[2],e[4*t+3]=r[3]},e.ch=bl,e.ci=Sl,e.cj=wl,e.ck=jl,e.cl=Cl,e.cm=O_,e.cn=function(){var e=new r(4);return r!=Float32Array&&(e[1]=0,e[2]=0),e[0]=1,e[3]=1,e},e.co=function(e,t,r){var n=t[0],i=t[1],s=t[2],o=t[3],a=Math.sin(r),l=Math.cos(r);return e[0]=n*l+s*a,e[1]=i*l+o*a,e[2]=n*-a+s*l,e[3]=i*-a+o*l,e},e.cp=function(e,t){return e[0]===t[0]&&e[1]===t[1]&&e[2]===t[2]&&e[3]===t[3]},e.cq=G,e.cr=function(e){var t=e[0],r=e[1],n=e[2],i=e[3];return Math.sqrt(t*t+r*r+n*n+i*i)},e.cs=ae,e.ct=W,e.cu=Cu,e.cv=3,e.cw=2,e.cx=7,e.cy=6,e.cz=U,e.d=function(e){return ot.API_TILEJSON_REGEX.test(e)},e.d$=class{constructor(e,t,r,n){this.context=e,this.format=n,this.size=r,this.texture=e.gl.createTexture();const[i,s,o]=this.size,{gl:a}=e;a.bindTexture(a.TEXTURE_3D,this.texture),e.pixelStoreUnpackFlipY.set(!1),e.pixelStoreUnpack.set(1),e.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&a.texImage3D(a.TEXTURE_3D,0,this.format,i,s,o,0,Cm(this.format),Em(this.format),t.data)}bind(e,t){const{context:r}=this,{gl:n}=r;n.bindTexture(n.TEXTURE_3D,this.texture),e!==this.minFilter&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MAG_FILTER,e),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_MIN_FILTER,e),this.minFilter=e),t!==this.wrapS&&(n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_S,t),n.texParameteri(n.TEXTURE_3D,n.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:e}=this.context;e.deleteTexture(this.texture),this.texture=null}},e.d0=function(e){return e*e*e*e*e},e.d1=lc,e.d2=45,e.d3=Tl,e.d4=function(e,t,r){const n=Math.sqrt(e*e+t*t+r*r),i=n>0?Math.acos(r/n)*Ae:0;let s=0!==e||0!==t?Math.atan2(-t,-e)*Ae+90:0;return s<0&&(s+=360),[n,s,i]},e.d5=T,e.d6=Xe,e.d7=vc,e.d8=A,e.d9=Qc,e.dA=function(e){return e({pluginStatus:go,pluginURL:yo}),xo.on("pluginStateChange",e),e},e.dB=kl,e.dC=class extends xl{constructor(e){super(e),this.current=El}set(e,t,r){if(this.fetchUniformLocation(e,t))for(let n=0;n<9;n++)if(r[n]!==this.current[n]){this.current=r,this.gl.uniformMatrix3fv(this.location,!1,r);break}}},e.dD=Ie,e.dE=function(e,t,r){const n=td(r.zoom),i=e.style.map._antialias,s=e.terrain&&e.terrain.exaggeration()>0;return 0===n&&!i&&!s},e.dF=function(e){const t=e.pixelsPerMeter,r=t/dc(1,e.center.lat),n=c(new Float64Array(16));return h(n,n,[e.point.x,e.point.y,0]),p(n,n,[r,r,t]),Float32Array.from(n)},e.dG=Hu,e.dH=function(e){const t=fc-5;e=Le(e,-t,t)/t*90;const r=Math.pow(Math.abs(Math.sin(Ce(e))),3);return Math.round(r*(Jl.length-1))},e.dI=function(e,t,r,n){const i=t.getNorth(),s=t.getSouth(),a=t.getWest(),l=t.getEast(),c=1<<e.z,u=l-a,d=i-s,h=u/Xl,p=-d/Jl[r],m=[0,h,0,p,0,0,i,a,0];if(e.z>0){const e=180/n;o(m,m,[e/u+1,0,0,0,e/d+1,0,-.5*e/h,.5*e/p,1])}return m[2]=c,m[5]=e.x,m[8]=e.y,m},e.dJ=Uu,e.dK=function(e,t,r){const n=c(new Float64Array(16)),i=(t/(1<<e)-.5)*Math.PI*2;return f(n,r.globeMatrix,i),Float32Array.from(n)},e.dL=Sd,e.dM=Du,e.dN=function(e,t){return[Math.pow(e[0],2.2)*t,Math.pow(e[1],2.2)*t,Math.pow(e[2],2.2)*t]},e.dO=i,e.dP=function(e,t){var r=Math.sin(t),n=Math.cos(t);return e[0]=n,e[1]=r,e[2]=0,e[3]=-r,e[4]=n,e[5]=0,e[6]=0,e[7]=0,e[8]=1,e},e.dQ=q,e.dR=$u,e.dS=nt,e.dT=it,e.dU=256,e.dV=function(e,t){const r=[0,0,0];return V(r,r,Xu(Uu(t.canonical))),V(r,r,e),r},e.dW=e=>({u_matrix:new Cl(e),u_texsize:new jl(e),u_pixels_to_tile_units:new Il(e),u_device_pixel_ratio:new wl(e),u_width_scale:new wl(e),u_floor_width_scale:new wl(e),u_image:new bl(e),u_units_to_pixels:new jl(e),u_tile_units_to_pixels:new wl(e),u_alpha_discard_threshold:new wl(e),u_trim_offset:new jl(e),u_trim_fade_range:new jl(e),u_trim_color:new Tl(e),u_zbias_factor:new wl(e),u_tile_to_meter:new wl(e),u_ground_shadow_factor:new Sl(e),u_pattern_transition:new wl(e)}),e.dX=e=>({u_matrix:new Cl(e),u_pixels_to_tile_units:new Il(e),u_device_pixel_ratio:new wl(e),u_width_scale:new wl(e),u_floor_width_scale:new wl(e),u_units_to_pixels:new jl(e),u_dash_image:new bl(e),u_gradient_image:new bl(e),u_image_height:new wl(e),u_texsize:new jl(e),u_tile_units_to_pixels:new wl(e),u_alpha_discard_threshold:new wl(e),u_trim_offset:new jl(e),u_trim_fade_range:new jl(e),u_trim_color:new Tl(e),u_zbias_factor:new wl(e),u_tile_to_meter:new wl(e),u_ground_shadow_factor:new Sl(e)}),e.dY=e=>({u_camera_to_center_distance:new wl(e),u_extrude_scale:new Il(e),u_device_pixel_ratio:new wl(e),u_matrix:new Cl(e),u_inv_rot_matrix:new Cl(e),u_merc_center:new jl(e),u_tile_id:new Sl(e),u_zoom_transition:new wl(e),u_up_dir:new Sl(e),u_emissive_strength:new wl(e)}),e.dZ=Pa,e.d_=yg,e.da=C,e.db=function(e){return[Math.pow(e[0],1/2.2),Math.pow(e[1],1/2.2),Math.pow(e[2],1/2.2)]},e.dc=Am,e.dd=hf,e.de=Qm,e.df=Sv,e.dg=function(e,t){return e.readFields(ex,{icons:[]},t)},e.dh=Jp,e.di=Ny,e.dj=Ey,e.dk=Ft,e.dl=_o,e.dm=_t,e.dn=Qt,e.dp=We,e.dq=function(e){const t=e.indexOf($o);return t>=0?e.slice(0,t):e},e.dr=function(e){return e.indexOf($o)>=0},e.ds=function(e){const t=e.lastIndexOf($o);return t>=0?e.slice(t+1):""},e.dt=function(e){const t=[],r=e.id;return void 0===r&&t.push({message:"layers.".concat(r,': missing required property "id"')}),void 0===e.render&&t.push({message:"layers.".concat(r,': missing required method "render"')}),e.renderingMode&&"2d"!==e.renderingMode&&"3d"!==e.renderingMode&&t.push({message:"layers.".concat(r,': property "renderingMode" must be either "2d" or "3d"')}),t},e.du=function(e,t,r,n){return"custom"===e.type?new xv(e,t):new Gv[e.type](e,t,r,n)},e.dv=qe,e.dw=function(e){const t=e.indexOf($o);return t>=0?e.slice(t+1):""},e.dx=class extends Vv{constructor(e,t){super(e._vectorTileFeature,e._z,e._x,e._y,e.id),e.state&&(this.state=Object.assign({},e.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=e.source,this.sourceLayer=e.sourceLayer,this.layer=e.layer)}toJSON(){const e=super.toJSON();return e.target=this.target,e.namespace=this.namespace,e}},e.dy=xo,e.dz=Ot,e.e=ot,e.e$=k,e.e0=ld,e.e1=(e,t,r,n,i,s)=>{const o=e.transform,a="globe"===o.projection.name;let l;if("map"===s.paint.get("circle-pitch-alignment"))if(a){const e=$u(o.zoom,t.canonical)*o._pixelsPerMercatorPixel;l=Float32Array.from([e,0,0,e])}else l=o.calculatePixelsToTileUnitsMatrix(r);else l=new Float32Array([o.pixelsToGLUnits[0],0,0,o.pixelsToGLUnits[1]]);const c={u_camera_to_center_distance:e.transform.getCameraToCenterDistance(o.projection),u_matrix:e.translatePosMatrix(t.projMatrix,r,s.paint.get("circle-translate"),s.paint.get("circle-translate-anchor")),u_device_pixel_ratio:gt.devicePixelRatio,u_extrude_scale:l,u_inv_rot_matrix:ad,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:s.paint.get("circle-emissive-strength")};if(a){c.u_inv_rot_matrix=n,c.u_merc_center=i,c.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],c.u_zoom_transition=td(o.zoom);const e=i[0]*Bn,r=i[1]*Bn;c.u_up_dir=o.projection.upVector(new Au(0,0,0),e,r)}return c},e.e2=tg,e.e3=Or,e.e4=(e,t,r,n,i,s,o,a,l,c)=>{const u=e.transform,d=u.pitch<15?Qf(.07,.7,Le((14-u.zoom)/5,0,1)):.07,h="none"===r.paint.get("line-trim-color-use-theme").constantOr("default");return{u_matrix:eg(e,t,r,n),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:u.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:i,u_width_scale:s,u_floor_width_scale:o,u_image:0,u_tile_units_to_pixels:$f(t,u),u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:a,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(h?null:r.lut).toArray01(),u_zbias_factor:d,u_tile_to_meter:vc(t.tileID.canonical,0),u_ground_shadow_factor:l,u_pattern_transition:c}},e.e5=(e,t,r,n,i,s,o,a,l,c)=>{const u=e.transform,d=u.calculatePixelsToTileUnitsMatrix(t),h="none"===r.paint.get("line-trim-color-use-theme").constantOr("default"),p=u.pitch<15?Qf(.07,.7,Le((14-u.zoom)/5,0,1)):.07;return{u_matrix:eg(e,t,r,n),u_pixels_to_tile_units:d,u_device_pixel_ratio:s,u_width_scale:o,u_floor_width_scale:a,u_units_to_pixels:[1/u.pixelsToGLUnits[0],1/u.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:i,u_texsize:rg(r)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:$f(t,e.transform),u_alpha_discard_threshold:0,u_trim_offset:l,u_trim_fade_range:r.paint.get("line-trim-fade-range"),u_trim_color:r.paint.get("line-trim-color").toPremultipliedRenderColor(h?null:r.lut).toArray01(),u_zbias_factor:p,u_tile_to_meter:vc(t.tileID.canonical,0),u_ground_shadow_factor:c}},e.e6=Be,e.e7=Td,e.e8=mc,e.e9=Iu,e.eA=function(e,r){var n=2*Math.acos(r[3]),i=Math.sin(n/2);return i>t?(e[0]=r[0]/i,e[1]=r[1]/i,e[2]=r[2]/i):(e[0]=1,e[1]=0,e[2]=0),n},e.eB=Wv,e.eC=Jm,e.eD=Zm,e.eE=[1,1,1],e.eF=Nv,e.eG=X,e.eH=function(e,t,r,n){var i=t[0],s=t[1],o=t[2],a=t[3];return e[0]=i+n*(r[0]-i),e[1]=s+n*(r[1]-s),e[2]=o+n*(r[2]-o),e[3]=a+n*(r[3]-a),e},e.eI=Xm,e.eJ=Ea,e.eK=Va,e.eL=function(e,t,n,i,s,o,a,l,c,u,d,h,p,m,f,g){var y=new r(16);return y[0]=e,y[1]=t,y[2]=n,y[3]=i,y[4]=s,y[5]=o,y[6]=a,y[7]=l,y[8]=c,y[9]=u,y[10]=d,y[11]=h,y[12]=p,y[13]=m,y[14]=f,y[15]=g,y},e.eM=rc,e.eN=Ua,e.eO=Ba,e.eP=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Se(1/0,1/0),max:new Se(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=qh(new Se(0,0),new Se(Bn,Bn),e),n=[];if(t&&!Uh(r,this._globalClipBounds))return n;for(const i of this._activeRegions){if(i.hiddenByOverlap)continue;if(!Uh(r,i))continue;const t=Wh(i.min,i.max,e);n.push({min:t.min,max:t.max,sourceId:this._sourceIds[i.priority],footprint:i.footprint,footprintTileId:i.tileId,order:i.order,clipMask:i.clipMask,clipScope:i.clipScope})}return n}setSources(e){this._setSources(e.map(e=>({getSourceId:()=>e.cache.id,getFootprints:()=>{const t=[];for(const r of e.cache.getVisibleCoordinates()){const n=e.cache.getTile(r).buckets[e.layer];n&&n.updateFootprints(r.toUnwrapped(),t)}return t},getOrder:()=>e.order,getClipMask:()=>e.clipMask,getClipScope:()=>e.clipScope})))}_addSource(e){const t=e.getFootprints();if(0===t.length)return;const r=e.getOrder(),n=e.getClipMask(),i=e.getClipScope();for(const s of t){if(!s.footprint)continue;const e=qh(s.footprint.min,s.footprint.max,s.id);this._activeRegions.push({min:e.min,max:e.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:s.id,footprint:s.footprint,order:r,clipMask:n,clipScope:i})}this._sourceIds.push(e.getSourceId())}_computeReplacement(){this._activeRegions.sort((e,t)=>e.priority-t.priority||zh(e.min,t.min)||zh(e.max,t.max)||e.order-t.order||e.clipMask-t.clipMask||function(e,t){const r=(e,t)=>e+t;return e.length-t.length||e.reduce(r,"").localeCompare(t.reduce(r,""))}(e.clipScope,t.clipScope));let e=this._activeRegions.length!==this._prevRegions.length;if(!e){let t=0;for(;!e&&t!==this._activeRegions.length;){const r=this._activeRegions[t],n=this._prevRegions[t];e=r.priority!==n.priority||!Bh(r,n)||r.order!==n.order||r.clipMask!==n.clipMask||!Te(r.clipScope,n.clipScope),this._activeRegions[t].hiddenByOverlap=n.hiddenByOverlap,++t}}if(e){++this._updateTime;for(const t of this._activeRegions)t.order!==Dh&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,t.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,t.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,t.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,t.max.y));const e=e=>{const t=this._activeRegions;if(e>=t.length)return e;const r=t[e].priority;for(;e<t.length&&t[e].priority===r;)++e;return e};if(this._sourceIds.length>1){let t=0,r=e(t);for(;t!==r;){let n=t;const i=t;for(;n!==r;){const e=this._activeRegions[n];e.hiddenByOverlap=!1;for(let t=0;t<i;t++){const r=this._activeRegions[t];if(!r.hiddenByOverlap&&e.order===Dh&&Uh(e,r)&&(e.hiddenByOverlap=Gh(e.footprint,e.tileId,r.footprint,r.tileId),e.hiddenByOverlap))break}++n}t=r,r=e(t)}}}}_setSources(e){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=e.length-1;t>=0;t--)this._addSource(e[t]);this._computeReplacement()}},e.eQ=Dh,e.eR=class{constructor(e){this._createGrid(e),this._createPoles(e)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const e of this._poleSegments)e.destroy();for(const e of this._gridSegments)e.withSkirts.destroy(),e.withoutSkirts.destroy()}_fillGridMeshWithLods(e,t){const r=new pa,n=new La,i=[],s=e+1+2,o=t[0]+1,a=t[0]+1+(1+t.length),l=(e,t,r)=>{let n=e===s-1?e-2:0===e?e:e-1;return n+=r?24575:0,[n,t]};for(let c=0;c<s;++c)r.emplaceBack(...l(c,0,!0));for(let c=0;c<o;++c)for(let e=0;e<s;++e)r.emplaceBack(...l(e,c,(0===e||e===s-1)&&!0));for(let c=0;c<t.length;++c){const e=t[c];for(let t=0;t<s;++t)r.emplaceBack(...l(t,e,!0))}for(let c=0;c<t.length;++c){const e=n.length,o=t[c]+1+2,l=new La;for(let r=0;r<o-1;r++){const e=r===o-2,i=e?s*(a-t.length+c-r):s;for(let t=0;t<s-1;t++){const o=r*s+t;0===r||e||0===t||t===s-2?(l.emplaceBack(o+1,o,o+i),l.emplaceBack(o+i,o+i+1,o+1)):(n.emplaceBack(o+1,o,o+i),n.emplaceBack(o+i,o+i+1,o+1))}}const u=dl.simpleSegment(0,e,r.length,n.length-e);for(let t=0;t<l.uint16.length;t+=3)n.emplaceBack(l.uint16[t],l.uint16[t+1],l.uint16[t+2]);const d=dl.simpleSegment(0,e,r.length,n.length-e);i.push({withoutSkirts:u,withSkirts:d})}return{vertices:r,indices:n,segments:i}}_createGrid(e){const t=this._fillGridMeshWithLods(Xl,Jl);this._gridSegments=t.segments,this._gridBuffer=e.createVertexBuffer(t.vertices,Ru.members),this._gridIndexBuffer=e.createIndexBuffer(t.indices,!0)}_createPoles(e){const t=new La;for(let o=0;o<=Xl;o++)t.emplaceBack(0,o+1,o+2);this._poleIndexBuffer=e.createIndexBuffer(t,!0);const r=new Oa,n=new Oa,i=new Oa,s=new Oa;this._poleSegments=[];for(let o=0,a=0;o<Zl;o++){const e=360/(1<<o);r.emplaceBack(0,-Gl,0,.5,0),n.emplaceBack(0,-Gl,0,.5,1),i.emplaceBack(0,-Gl,0,.5,.5),s.emplaceBack(0,-Gl,0,.5,.5);for(let t=0;t<=Xl;t++){let o=t/Xl,a=0;const l=hr(0,e,o),[c,u,d]=ec(sd,od,l,Gl);r.emplaceBack(c,u,d,o,a),n.emplaceBack(c,u,d,o,1-a);const h=Ce(l);o=.5+.5*Math.sin(h),a=.5+.5*Math.cos(h),i.emplaceBack(c,u,d,o,a),s.emplaceBack(c,u,d,o,1-a)}this._poleSegments.push(dl.simpleSegment(a,0,66,64)),a+=66}this._poleNorthVertexBuffer=e.createVertexBuffer(r,Mu,!1),this._poleSouthVertexBuffer=e.createVertexBuffer(n,Mu,!1),this._texturedPoleNorthVertexBuffer=e.createVertexBuffer(i,Mu,!1),this._texturedPoleSouthVertexBuffer=e.createVertexBuffer(s,Mu,!1)}getGridBuffers(e,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[e].withSkirts:this._gridSegments[e].withoutSkirts]}getPoleBuffers(e,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[e]]}},e.eS=Fh,e.eT=Pe,e.eU=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},e.eV=Me,e.eW=_c,e.eX=function(e,t,r){return e[0]=t[0]/r[0],e[1]=t[1]/r[1],e[2]=t[2]/r[2],e},e.eY=K,e.eZ=tc,e.e_=D,e.ea=yp,e.eb=Tp,e.ec=np,e.ed=sp,e.ee=ip,e.ef=yc,e.eg=function(e,t){if(e===t){var r=t[1],n=t[2],i=t[3],s=t[6],o=t[7],a=t[11];e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=r,e[6]=t[9],e[7]=t[13],e[8]=n,e[9]=s,e[11]=t[14],e[12]=i,e[13]=o,e[14]=a}else e[0]=t[0],e[1]=t[4],e[2]=t[8],e[3]=t[12],e[4]=t[1],e[5]=t[5],e[6]=t[9],e[7]=t[13],e[8]=t[2],e[9]=t[6],e[10]=t[10],e[11]=t[14],e[12]=t[3],e[13]=t[7],e[14]=t[11],e[15]=t[15];return e},e.eh=hv,e.ei=da,e.ej=Za,e.ek=256,e.el=Ju,e.em=ba,e.en=f,e.eo=function(e,t){return e[0]=t[0],e[1]=t[1],e[2]=t[2],e[3]=t[4],e[4]=t[5],e[5]=t[6],e[6]=t[8],e[7]=t[9],e[8]=t[10],e},e.ep=Oa,e.eq=gs,e.er=za,e.es=function(e,t,r,n,i){return Le((e-t)/(r-t)*(i-n)+n,n,i)},e.et=ne,e.eu=function(e,t){var r=t[0],n=t[1],i=t[2],s=t[3],o=t[4],a=t[5],l=t[6],c=t[7],u=t[8],d=u*o-a*c,h=-u*s+a*l,p=c*s-o*l,m=r*d+n*h+i*p;return m?(e[0]=d*(m=1/m),e[1]=(-u*n+i*c)*m,e[2]=(a*n-i*o)*m,e[3]=h*m,e[4]=(u*r-i*l)*m,e[5]=(-a*r+i*s)*m,e[6]=p*m,e[7]=(-c*r+n*l)*m,e[8]=(o*r-n*s)*m,e):null},e.ev=2,e.ew=F,e.ex=ee,e.ey=v,e.ez=function(e,t){var n=new r(3);v(n,t);var i=1/n[0],s=1/n[1],o=1/n[2],a=t[0]*i,l=t[1]*s,c=t[2]*o,u=t[4]*i,d=t[5]*s,h=t[6]*o,p=t[8]*i,m=t[9]*s,f=t[10]*o,g=a+d+f,y=0;return g>0?(y=2*Math.sqrt(g+1),e[3]=.25*y,e[0]=(h-m)/y,e[1]=(p-c)/y,e[2]=(l-u)/y):a>d&&a>f?(y=2*Math.sqrt(1+a-d-f),e[3]=(h-m)/y,e[0]=.25*y,e[1]=(l+u)/y,e[2]=(p+c)/y):d>f?(y=2*Math.sqrt(1+d-a-f),e[3]=(p-c)/y,e[0]=(l+u)/y,e[1]=.25*y,e[2]=(h+m)/y):(y=2*Math.sqrt(1+f-a-d),e[3]=(l-u)/y,e[0]=(p+c)/y,e[1]=(h+m)/y,e[2]=.25*y),e},e.f=function(e){return btoa(encodeURIComponent(e).replace(/%([0-9A-F]{2})/g,(e,t)=>String.fromCharCode(Number("0x"+t))))},e.f0=function(e){let[t,r,n]=e;const i=Math.hypot(t,r,n),s=Math.atan2(t,n),o=.5*Math.PI-Math.acos(-r/i);return new ic(Ee(s),Ee(o))},e.f1=Q,e.f2=qm,e.f3=function(e){const t=e.navigator?e.navigator.userAgent:null;return!!function(e){if(null==$e){const t=e.navigator?e.navigator.userAgent:null;$e=!!e.safari||!(!t||!(/\b(iPad|iPhone|iPod)\b/.test(t)||t.match("Safari")&&!t.match("Chrome")))}return $e}(e)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},e.f4=function(e,t){xt=e,bt=t},e.f5=nd,e.f6=rd,e.f7=function(e){const t=[0,0,0],r=c(new Float64Array(16));return d(r,e.pixelMatrix,e.globeMatrix),V(t,t,r),new Se(t[0],t[1])},e.f8=function(){const e=Yp;e&&(e.isPreloaded()&&1===e.numActive()?(e.release(Gp),Yp=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},e.f9=function(){Jp().acquire(Gp)},e.fA=eb,e.fB=Nc,e.fC=function(e){let t=0;if(new Uint32Array(e,0,1)[0]!==xm){const r=new Uint32Array(e,0,7),[,,n,i,s,o]=r;t=r.byteLength+i+s+o+s,(n!==e.byteLength||t>=e.byteLength)&&Ze("Invalid b3dm header information.")}return km(e,t)},e.fD=function(e,t){const r=hf(e);for(const n of r){for(const e of n.meshes)pf(e);n.lights&&(n.lightMeshIndex=n.meshes.length,n.meshes.push(ff(n.lights,t)))}return r},e.fE=Fv,e.fF=Je,e.fG=Wp,e.fH=jo,e.fI=mo,e.fJ=function(e){kt(),null!=jt&&jt.then(t=>{t.keys().then(r=>{for(let n=0;n<r.length-e;n++)t.delete(r[n]).catch(e=>Ze(e.message))}).catch(e=>Ze(e.message))}).catch(e=>Ze(e.message))},e.fa=bo,e.fb=function(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(go===mo.deferred||go===mo.loading||go===mo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");yo=gt.resolveURL(e),go=mo.deferred,fo=t,vo(),r||wo()},e.fc=function(e){nm=gt.resolveURL(e),sm||(sm=new Kp(Jp(),new nr)),sm.broadcast("setMeshoptUrl",nm)},e.fd=um,e.fe=function(e){tm=gt.resolveURL(e),sm||(sm=new Kp(Jp(),new nr)),sm.broadcast("setDracoUrl",tm)},e.ff=cm,e.fg=Hp,e.fh=function(e){const t=Tt();if(!t)return;const r=t.delete(vt);e&&r.then(()=>e()).catch(e)},e.fi=Zp,e.fj=$s,e.fk=wd,e.fl=Cy,e.fm=Zb,e.fn=Kb,e.fo=qf,e.fp=Fc,e.fq="hd_road_elevation",e.fr=tu,e.fs=Ve,e.ft=lh,e.fu=jy,e.fv=by,e.fw=function(e,t,r,n,i,s,o){let a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:1,l=arguments.length>8?arguments[8]:void 0,c=arguments.length>9?arguments[9]:void 0,u=arguments.length>10?arguments[10]:void 0;e.createArrays(),e.tilePixelRatio=Bn/(512*e.overscaling),e.compareText={},e.iconsNeedLinear=!1;const d=e.layers[0].layout,h=e.layers[0]._unevaluatedLayout._values,p={};p.scaleFactor=a,p.textSizeScaleRange=d.get("text-size-scale-range"),p.iconSizeScaleRange=d.get("icon-size-scale-range");const[m,f]=p.textSizeScaleRange,[g,y]=p.iconSizeScaleRange;p.textScaleFactor=Le(p.scaleFactor,m,f),p.iconScaleFactor=Le(p.scaleFactor,g,y);const _=h["text-size"],v=h["icon-size"];if("composite"===e.textSizeData.kind){const{minZoom:t,maxZoom:r}=e.textSizeData;p.compositeTextSizes=[_.possiblyEvaluate(new So(t,{worldview:u}),s),_.possiblyEvaluate(new So(r,{worldview:u}),s)]}if("composite"===e.iconSizeData.kind){const{minZoom:t,maxZoom:r}=e.iconSizeData;p.compositeIconSizes=[v.possiblyEvaluate(new So(t,{worldview:u}),s),v.possiblyEvaluate(new So(r,{worldview:u}),s)]}p.layoutTextSize=_.possiblyEvaluate(new So(o+1,{worldview:u}),s),p.layoutIconSize=v.possiblyEvaluate(new So(o+1,{worldview:u}),s),p.textMaxSize=_.possiblyEvaluate(new So(18,{worldview:u}),s);const x=d.get("symbol-placement"),b="map"===d.get("text-rotation-alignment")&&"point"!==x,w=d.get("text-size");let j=!1;const S=[];for(const T of e.features){const o=d.get("text-font").evaluate(T,{},s).join(","),a=w.evaluate(T,{},s)*p.textScaleFactor,m=p.layoutTextSize.evaluate(T,{},s)*p.textScaleFactor,f=p.layoutIconSize.evaluate(T,{},s)*p.iconScaleFactor,g={horizontal:{},vertical:void 0},y=T.text;let _,v=[0,0];if(y){const n=y.toString(),c=d.get("text-letter-spacing").evaluate(T,{},s)*_g,u=d.get("text-line-height").evaluate(T,{},s)*_g,h=so(n)?c:0,p=d.get("text-anchor").evaluate(T,{},s),f=d.get("text-variable-anchor");if(!f){const e=d.get("text-radial-offset").evaluate(T,{},s);if(e)v=Ky(p,[e*_g,Hy]);else{const e=d.get("text-offset").evaluate(T,{},s);v=[e[0]*_g,e[1]*_g]}}let _=b?"center":d.get("text-justify").evaluate(T,{},s);const w="point"===x,j=w?d.get("text-max-width").evaluate(T,{},s)*_g:1/0,S=s=>{e.allowVerticalPlacement&&io(n)&&(g.vertical=Gg(y,t,r,i,o,j,u,p,s,h,v,qg.vertical,!0,m,a,l))};if(!b&&f){const e="auto"===_?f.map(e=>s_(e)):[_];let n=!1;for(let s=0;s<e.length;s++){const c=e[s];if(!g.horizontal[c])if(n)g.horizontal[c]=g.horizontal[0];else{const e=Gg(y,t,r,i,o,j,u,"center",c,h,v,qg.horizontal,!1,m,a,l);e&&(g.horizontal[c]=e,n=1===e.positionedLines.length)}}S("left")}else{if("auto"===_&&(_=s_(p)),w||d.get("text-writing-mode").indexOf("horizontal")>=0||!io(n)){const e=Gg(y,t,r,i,o,j,u,p,_,h,v,qg.horizontal,!1,m,a,l);e&&(g.horizontal[_]=e)}S(w?"left":_)}}let k,A,C,E,N,I,P=!1;const M=d.get("icon-text-fit").evaluate(T,{},s);if(T.icon&&T.icon.hasPrimary()){const t=e_(T.icon,e.iconSizeData,h["icon-size"],s,e.zoom,T,l,p.iconScaleFactor,u);k=t.iconPrimary,C=t.iconSecondary;const r=k.toString();if(A=n.get(r),A&&(N=d.get("icon-offset").evaluate(T,{},s),I=d.get("icon-anchor").evaluate(T,{},s),_=ny(i.get(r),C?i.get(C.toString()):void 0,N,I),P=A.sdf,void 0===e.sdfIcons?e.sdfIcons=A.sdf:e.sdfIcons!==A.sdf&&Ze("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(A.pixelRatio!==e.pixelRatio||0!==d.get("icon-rotate").constantOr(1))&&(e.iconsNeedLinear=!0)),C){const e=C.toString();E=n.get(e)}}j=j||!(!T.icon||!T.icon.hasSecondary());const L=d_(g.horizontal)||g.vertical;e.iconsInText||(e.iconsInText=!!L&&L.iconsInText);const R=m*p.textScaleFactor/_g,{defaultShapedIcon:D,verticallyShapedIcon:F}=o_(e,_,d,T,s,g,R,N,M);"none"!==M&&_&&(sy(_)||oy(_))&&(Qy(0,A,k,_,D,M,c,n,i),Qy(0,E,C,_,D,M,c,n,i),F&&(Qy(0,A,k,_,F,M,c,n,i),Qy(0,E,C,_,F,M,c,n,i))),_=D;const{iconBBox:O,iconVerticalBBox:z,textBBox:B,textVerticalBBox:U}=Yy(e,_,F,d,T,s,f,N,p,i,I,g,m,v);S.push({feature:T,shapedTextOrientations:g,shapedText:L,shapedIcon:_,iconPrimary:k,iconSecondary:C,iconOffset:N,iconAnchor:I,verticallyShapedIcon:F,layoutTextSize:m,layoutIconSize:f,textOffset:v,isSDFIcon:P,iconTextFit:M,iconCollisionBounds:O,iconVerticalCollisionBounds:z,textCollisionBounds:B,textVerticalCollisionBounds:U})}return{featureData:S,sizes:p,hasAnySecondaryIcon:j,textAlongLine:b,symbolPlacement:x}},e.fx=Sy,e.fy=function(e,t,r,n,i,s,o,a,l,c){e.iconAtlasPositions=c.iconPositions;const{featureData:u,hasAnySecondaryIcon:d,sizes:h,textAlongLine:p,symbolPlacement:m}=t;for(const f of u){const{shapedIcon:t,verticallyShapedIcon:r,feature:s,shapedTextOrientations:u,shapedText:g,layoutTextSize:y,textOffset:_,isSDFIcon:v,iconPrimary:x,iconSecondary:b,iconTextFit:w,iconOffset:j,iconCollisionBounds:S,iconVerticalCollisionBounds:T,textCollisionBounds:k}=f;r_(t,c.iconPositions,x,b),r_(r,c.iconPositions,x,b),n_(u,c.iconPositions),t_(x,b,c.iconPositions),(g||t)&&a_(e,s,u,t,r,l,h,y,0,_,v,n,i,o,a,d,w,j,p,m,S,T,k)}r&&e.generateCollisionDebugBuffers(s,e.collisionBoxArray,h.textScaleFactor)},e.fz=Rc,e.g=function(e,t){return Ot(Object.assign(e,{method:"GET"}),t)},e.h=function(e){return 0===e.indexOf("mapbox:")},e.i=function(e){return ot.API_STYLE_REGEX.test(e)&&!lt(e)},e.j=at,e.k=Ct,e.l=function(e){return decodeURIComponent(atob(e).split("").map(e=>"%"+("00"+e.charCodeAt(0).toString(16)).slice(-2)).join(""))},e.m=function(e,t){return Ot(Object.assign(e,{type:"json"}),t)},e.n=Wt,e.o=gt,e.p=function(e,t){return Ot(Object.assign(e,{method:"POST"}),t)},e.q=jd,e.r=ft,e.s=function(e){try{const t=self[e];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch(e){return!1}},e.t=function(){return Xp||(Xp=new Zp("ImageRasterizer")),Xp},e.u=function(){return function e(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,e)}()},e.v=function(e){return!!e&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(e)},e.w=Ze,e.x=Vx,e.y=er,e.z=$t}),o(["./shared"],function(e){function t(e){const t=e?e.url.toString():void 0;return t?performance.getEntriesByName(t):[]}function r(e){if("number"==typeof e||"boolean"==typeof e||"string"==typeof e||null==e)return JSON.stringify(e);if(Array.isArray(e)){let t="[";for(const n of e)t+="".concat(r(n),",");return"".concat(t,"]")}let t="{";for(const n of Object.keys(e).sort())t+="".concat(n,":").concat(r(e[n]),",");return"".concat(t,"}")}function n(t){let n="";for(const i of e.bx)n+="/".concat(r(t[i]));return n}class i{constructor(e){this.keyCache={},this._layers={},this._layerConfigs={},e&&this.replace(e)}replace(e,t){this._layerConfigs={},this._layers={},this.update(e,[],t)}update(t,i,s){this._options=s;for(const r of t)this._layerConfigs[r.id]=r,(this._layers[r.id]=e.du(r,this.scope,null,this._options)).compileFilter(s),this.keyCache[r.id]&&delete this.keyCache[r.id];for(const e of i)delete this.keyCache[e],delete this._layerConfigs[e],delete this._layers[e];this.familiesBySource={};const o=function(e,t){const i={};for(let o=0;o<e.length;o++){const s=e[o];let a=t&&t[s.id];a||("symbol"===s.type?a=s.id:(a=n(s),"line"===s.type&&s.paint&&function e(t){return"string"==typeof t&&"line-progress"===t||(Array.isArray(t)?t.some(e):!(!t||"object"!=typeof t)&&Object.values(t).some(e))}(s.paint["line-width"])&&(a+="/".concat(r(s.paint["line-width"]))))),t&&(t[s.id]=a);let l=i[a];l||(l=i[a]=[]),l.push(s)}const s=[];for(const r in i)s.push(i[r]);return s}(Object.values(this._layerConfigs),this.keyCache);for(const e of o){const t=e.map(e=>this._layers[e.id]),r=t[0];if("none"===r.visibility)continue;const n=r.source||"";let i=this.familiesBySource[n];i||(i=this.familiesBySource[n]={});const s=r.sourceLayer||"_geojsonTileLayer";let o=i[s];o||(o=i[s]=[]),o.push(t)}}}const s=1*e.fl;class o{constructor(t){const r={},n=[];for(const e in t){const i=t[e],o=r[e]={};for(const e in i.glyphs){const t=i.glyphs[+e];if(!t||0===t.bitmap.width||0===t.bitmap.height)continue;const r=t.metrics.localGlyph?s:1,a={x:0,y:0,w:t.bitmap.width+2*r,h:t.bitmap.height+2*r};n.push(a),o[e]=a}}const{w:i,h:o}=e.G(n),a=new e.fk({width:i||1,height:o||1});for(const l in t){const n=t[l];for(const t in n.glyphs){const i=n.glyphs[+t];if(!i||0===i.bitmap.width||0===i.bitmap.height)continue;const o=r[l][t],c=i.metrics.localGlyph?s:1;e.fk.copy(i.bitmap,a,{x:0,y:0},{x:o.x+c,y:o.y+c},i.bitmap)}}this.image=a,this.positions=r}}function a(e,t,r){e[t]?r&&(e[t].center=r):e[t]={floorIds:new Set,center:r||[0,0],floors:{}}}function l(e,t,r,n){for(const i of t)a(e,i),e[i].floors[r]=n,e[i].floorIds.add(r)}function c(e){return{id:e.properties.id.toString(),center:e.properties.center.toString().split(";").map(Number)}}function u(e){return{id:e.properties.id.toString(),isDefault:!!e.properties.is_default&&e.properties.is_default,connections:e.properties.connected_floor_ids?new Set(e.properties.connected_floor_ids.toString().split(";")):new Set,conflicts:e.properties.conflicted_floor_ids?new Set(e.properties.conflicted_floor_ids.toString().split(";")):new Set,buildings:e.properties.building_ids?new Set(e.properties.building_ids.toString().split(";")):new Set,name:e.properties.name.toString(),zIndex:e.properties.z_index}}function d(e,t){return t.every(t=>e.properties&&null!=e.properties[t])}function h(e){return d(e,["type","id","name"])&&"building"===e.properties.type}function p(e){return d(e,["type","id","name","z_index"])&&"floor"===e.properties.type}e.fj(o,"GlyphAtlas");class m{constructor(t){this.tileID=new e.aQ(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.lut=t.lut,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.scope=t.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=t.showCollisionBoxes,this.collectResourceTiming=!!t.request&&t.request.collectResourceTiming,this.promoteId=t.promoteId,this.isSymbolTile=t.isSymbolTile,this.tileTransform=e.aZ(t.tileID.canonical,t.projection),this.projection=t.projection,this.worldview=t.worldview,this.localizableLayerIds=t.localizableLayerIds,this.brightness=t.brightness,this.extraShadowCaster=!!t.extraShadowCaster,this.tessellationStep=t.tessellationStep,this.scaleFactor=t.scaleFactor,this.worldview=t.worldview,this.indoor=t.indoor}parse(t,r,n,i,s,d){this.status="parsing",this.data=t,this.collisionBoxArray=new e.b3;const m=new e.fm(Object.keys(t.layers).sort()),g=new e.fn(this.tileID,this.promoteId);g.bucketLayerIDs=[];const y={},_=new e.fo(256,256),v={featureIndex:g,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:_,availableImages:n,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0,activeFloors:void 0};if(this.indoor){const r=this.indoor.indoorState.activeFloorsVisible,n=function(t,r,n){const i=function(t,r){if(!t)return e.w("No source layers defined in indoor specification"),r;if(0===t.size)return r;const n=t.difference(r);for(const i of n)e.w("Missing source layer required in indoor specification: ".concat(i));return r.intersection(r)}(r.sourceLayers,new Set(Object.keys(t.layers))),s=r.indoorState,o=function(t,r,n,i){const s=new Set,o=new Set,d=new Set,m=new Map,f={},g=e=>{const t=m.get(e)||new Set;for(const r of s)if((m.get(r)||new Set).has(e)||t.has(r))return!0;return!1};for(const y of r){const r=t.layers[y];if(r)for(let e=0;e<r.length;e++){const t=r.feature(e);if(h(t)){const{id:e,center:r}=c(t);a(f,e,r),s.add(e)}else if(p(t)){const{id:e,isDefault:r,connections:n,conflicts:a,buildings:c,name:h,zIndex:p}=u(t);l(f,c,e,{name:h,zIndex:p}),m.set(e,a),(e===i||n.has(i))&&s.add(e),o.add(e),r&&d.add(e)}}else e.w("indoor source layer not found: ".concat(y))}if(n)for(const e of n)o.has(e)&&(g(e)||s.add(e));for(const e of d)s.has(e)||g(e)||s.add(e);return{buildings:f,activeFloors:s}}(t,i,s.lastActiveFloors,s.selectedFloorId);return n.send("setIndoorData",o),o}(t,this.indoor,s);v.activeFloors=r?n.activeFloors:void 0}const x=[],b=r.familiesBySource[this.source];for(const o in b){const r=t.layers[o];if(!r)continue;let s=!1,a=!1,l=!1;for(const e of b[o])"symbol"===e[0].type?s=!0:a=!0,e[0].is3D()&&"model"!==e[0].type&&(l=!0);if(this.extraShadowCaster&&!l)continue;if(!0===this.isSymbolTile&&!s)continue;if(!1===this.isSymbolTile&&!a)continue;1===r.version&&e.w('Vector tile source "'.concat(this.source,'" layer "').concat(o,'" does not use vector tile spec v2 and therefore may have some rendering errors.'));const c=m.encode(o),u=[],d=this.localizableLayerIds&&this.localizableLayerIds.has(o);let h=!1;for(let t=0,n=0;t<r.length;t++){const i=r.feature(t),s=g.getId(i,o),a=i.properties?i.properties.worldview:null;if(d&&this.worldview&&"string"==typeof a)if("all"===a)i.properties.$localized=!0;else{if(!a.split(",").includes(this.worldview))continue;i.properties.$localized=!0,i.properties.worldview=this.worldview}!h&&i.properties&&i.properties.hasOwnProperty(e.fp)&&(h=!0),u.push({feature:i,id:s,index:n,sourceLayerIndex:c}),n++}h&&!v.elevationFeatures&&t.layers.hasOwnProperty(e.fq)&&(v.elevationFeatures=e.fr.parseFrom(t.layers[e.fq],this.canonical));for(const t of b[o]){const r=t[0];if(this.extraShadowCaster&&(!r.is3D()||"model"===r.type))continue;if(void 0!==this.isSymbolTile&&"symbol"===r.type!==this.isSymbolTile)continue;if(r.minzoom&&this.zoom<Math.floor(r.minzoom))continue;if(r.maxzoom&&this.zoom>=r.maxzoom)continue;if("none"===r.visibility)continue;f(t,this.zoom,v.brightness,n,this.worldview);const s=y[r.id]=r.createBucket({index:g.bucketLayerIDs.length,layers:t,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:c,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:i,worldview:this.worldview,localizable:d});g.bucketLayerIDs.push(t.map(t=>e.B(t.id,t.scope)));let o=s.prepare?s.prepare():null;null!=o?(o=o.then(()=>s.populate(u,v,this.tileID.canonical,this.tileTransform)),x.push(o)):s.populate(u,v,this.tileID.canonical,this.tileTransform)}}const w=()=>{let r,i,a,l,c,u;_.trim();const h={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},p=()=>{if(r)return this.status="done",d(r);if(this.extraShadowCaster)this.status="done",d(null,{buckets:Object.values(y).filter(e=>!e.isEmpty()),featureIndex:g,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:v.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(i&&a&&l){const t=new o(i),r=new Map;for(const[n,i]of a.entries()){const{imagePosition:t}=e.fu(n,i,e.fv);r.set(n,t)}const d={};for(const s in y){const o=y[s];o instanceof e.b4&&(f(o.layers,this.zoom,v.brightness,n,this.worldview),d[s]=e.fw(o,i,t.positions,a,r,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,c,this.worldview))}const h={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(s,a,c,()=>{h.iconsPending=!1,x(d,t,h)}),this.rasterizeIfNeeded(s,l,u,()=>{h.patternsPending=!1,x(d,t,h)})}},x=(t,r,i,s)=>{if(i.iconsPending||i.patternsPending)return;const o=new e.fx(a,l,this.lut);for(const l in y){const r=y[l];if(l in t)e.fy(r,t[l],this.showCollisionBoxes,n,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,a,o);else if(r.hasPattern&&(r instanceof e.ba||r instanceof e.bb||r instanceof e.ea)){f(r.layers,this.zoom,v.brightness,n,this.worldview);const e=Object.fromEntries(o.patternPositions);r.addFeatures(v,this.tileID.canonical,e,n,this.tileTransform,this.brightness)}}this.status="done",d(null,{buckets:Object.values(y).filter(e=>!e.isEmpty()),featureIndex:g,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:r.image,lineAtlas:_,imageAtlas:o,brightness:v.brightness})};if(!this.extraShadowCaster){const t=e.fs(v.glyphDependencies,e=>Object.keys(e).map(Number));Object.keys(t).length?s.send("getGlyphs",{uid:this.uid,stacks:t},(e,t)=>{r||(r=e,i=t,p())},void 0,!1,h):i={};const n=Array.from(v.iconDependencies.keys()).map(t=>e.I.parse(t));n.length?s.send("getImages",{images:n,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(e,t)=>{r||(r=e,a=new Map,c=this.updateImageMapAndGetImageTaskQueue(a,t,v.iconDependencies),p())},void 0,!1,h):(a=new Map,c=new Map);const o=Array.from(v.patternDependencies.keys()).map(t=>e.I.parse(t));o.length?s.send("getImages",{images:o,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(e,t)=>{r||(r=e,l=new Map,u=this.updateImageMapAndGetImageTaskQueue(l,t,v.patternDependencies),p())},void 0,!1,h):(l=new Map,u=new Map)}if(v.elevationFeatures&&v.elevationFeatures.length>0){const r=[];for(const t of Object.values(y))if(t instanceof e.bb){const e=t.getUnevaluatedPortalGraph();e&&r.push(e)}const n=e.ft.evaluate(r);for(const i of Object.values(y))if(i instanceof e.bb){const e=t.layers[m.decode(i.sourceLayerIndex)];i.setEvaluatedPortalGraph(n,e,this.tileID.canonical,v.availableImages,v.brightness)}}p()};x.length>0?Promise.allSettled(x).then(w).catch(d):w()}updateParameters(t){this.scaleFactor=t.scaleFactor,this.showCollisionBoxes=t.showCollisionBoxes,this.projection=t.projection,this.brightness=t.brightness,this.tileTransform=e.aZ(t.tileID.canonical,t.projection),this.extraShadowCaster=t.extraShadowCaster,this.lut=t.lut,this.worldview=t.worldview,this.indoor=t.indoor}rasterizeIfNeeded(e,t,r,n){Array.from(t.values()).some(e=>e.usvg)?this.rasterize(e,t,r,n):n()}updateImageMapAndGetImageTaskQueue(e,t,r){const n=new Map;for(const i of t.keys()){const s=r.get(i)||[];for(const r of s){const i=r.toString(),s=t.get(r.id.toString());s.usvg?n.has(i)||(n.set(i,r),e.set(i,Object.assign({},s))):e.set(i,s)}}return n}rasterize(e,t,r,n){this.rasterizeTask=e.send("rasterizeImages",{scope:this.scope,tasks:r},(e,r)=>{if(!e)for(const[n,i]of r.entries()){const e=Object.assign(t.get(n),{data:i});t.set(n,e)}n()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function f(t,r,n,i,s){const o=new e.ac(r,{brightness:n,worldview:s});for(const e of t)e.recalculate(o,i)}class g extends e.E{constructor(t,r,n,i,s,o,a){super(),this.actor=t,this.layerIndex=r,this.availableImages=n,this.availableModels=i,this.loadVectorData=o||e.aL,this.loading={},this.loaded={},this.deduped=new e.aK(t.scheduler),this.isSpriteLoaded=s,this.scheduler=t.scheduler,this.brightness=a}loadTile(r,n){const i=r.uid,s=r&&r.request,o=s&&s.collectResourceTiming,a=this.loading[i]=new m(r);a.abort=this.loadVectorData(r,(l,c)=>{const u=!this.loading[i];if(delete this.loading[i],a.cancelRasterize(),u||l||!c)return a.status="done",u||(this.loaded[i]=a),n(l);const d=c.rawData,h={},p=e.aM(c.responseHeaders);p&&p.expires&&(h.expires=p.expires),p&&p.cacheControl&&(h.cacheControl=p.cacheControl),a.vectorTile=c.vectorTile||new e.fz(new e.bt(d));const m=()=>{a.parse(a.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(e,r)=>{if(e||!r)return n(e);const i={};if(o){const e=t(s);e.length>0&&(i.resourceTiming=JSON.parse(JSON.stringify(e)))}n(null,Object.assign({rawTileData:d.slice(0),responseHeaders:c.responseHeaders},r,h,i))})};this.isSpriteLoaded?m():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(m,{type:"parseTile",isSymbolTile:r.isSymbolTile,zoom:r.tileZoom}):m()}),this.loaded=this.loaded||{},this.loaded[i]=a})}reloadTile(e,t){const r=this.loaded,n=e.uid;if(r&&r[n]){const i=r[n];i.updateParameters(e);const s=(e,r)=>{const n=i.reloadCallback;n&&(delete i.reloadCallback,i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,n)),t(e,r)};"parsing"===i.status?i.reloadCallback=s:"done"===i.status&&(i.vectorTile?i.parse(i.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,s):s())}else t(null,void 0)}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}class y{loadTile(t,r){const{uid:n,encoding:i,rawImageData:s,padding:o}=t,a=ImageBitmap&&s instanceof ImageBitmap?this.getImageData(s,o):s;r(null,new e.fA(n,a,i,o<1))}reloadTile(e,t){t(null,null)}abortTile(e,t){t()}removeTile(e,t){t()}getImageData(e,t){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(e.width,e.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=e.width,this.offscreenCanvas.height=e.height,this.offscreenCanvasContext.drawImage(e,0,0,e.width,e.height);const r=this.offscreenCanvasContext.getImageData(-t,-t,e.width+2*t,e.height+2*t);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),r}}e.bs.setPbf(e.bt);class _{constructor(t){this._mrt=new e.bs(t.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=t.uid,this.tileID=t.tileID,this.source=t.source}parse(t,r){const n=this._mrt;this.status="parsing",this._entireBuffer=t;try{n.parseHeader(t),this._isHeaderLoaded=!0;const i=[];for(const r in n.layers){const s=n.getLayer(r),o=s.getDataRange(s.getBandList()),a=n.createDecodingTask(o),l=t.slice(o.firstByte,o.lastByte+1),c=e.bs.performDecoding(l,a).then(e=>a.complete(null,e)).catch(e=>a.complete(e,null));i.push(c)}Promise.allSettled(i).then(()=>r(null,n)).catch(e=>r(e))}catch(e){r(e)}}}class v{constructor(e){this.actor=e,this.loading={},this.loaded={}}loadTile(t,r){const n=t.uid,i=t.request,s=this.loading[n]=new _(t),{cancel:o}=e.bu(i,(e,t,i)=>{const o=!this.loading[n];if(delete this.loading[n],o||e||!t)return s.status="done",o||(this.loaded[n]=s),r(e);s.parse(t,(e,t)=>{if(e||!t)return r(e);r(null,t,i)}),this.loaded[n]=s});s.abort=o}reloadTile(e,t){t(null,void 0)}abortTile(e,t){const r=e.uid,n=this.loading[r];n&&(n.abort&&n.abort(),delete this.loading[r]),t()}removeTile(e,t){const r=e.uid;this.loaded[r]&&delete this.loaded[r],t()}decodeRasterArray(t,r){e.bs.performDecoding(t.buffer,t.task).then(e=>r(null,e)).catch(e=>r(e))}}const x=e.fB.prototype.toGeoJSON;class b{constructor(t){this._feature=t,this.extent=e.al,this.type=t.type,this.properties=t.tags,"id"in t&&!isNaN(t.id)&&(this.id=parseInt(t.id,10))}loadGeometry(){if(1===this._feature.type){const t=[];for(const r of this._feature.geometry)t.push([new e.P(r[0],r[1])]);return t}{const t=[];for(const r of this._feature.geometry){const n=[];for(const t of r)n.push(new e.P(t[0],t[1]));t.push(n)}return t}}toGeoJSON(e,t,r){return x.call(this,e,t,r)}}class w{constructor(t,r){this.name=t,this.extent=e.al,this.length=r.length,this._jsonFeatures=r}feature(e){return new b(this._jsonFeatures[e])}}class j{constructor(t){this.layers={},this.extent=e.al;for(const e of Object.keys(t))this.layers[e]=new w(e,t[e])}}const S=64/4096,T=128;class k{constructor(){this.features=new Map}clear(){this.features.clear()}load(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;for(const r of e){const e=r.id;if(null==e)continue;let n=this.features.get(e);n&&this.updateCache(n,t),r.geometry?(n=C(r),this.updateCache(n,t),this.features.set(e,n)):this.features.delete(e),this.updateCache(n,t)}}updateCache(e,t){for(const{canonical:r,uid:n}of Object.values(t)){const{z:i,x:s,y:o}=r;A(e,Math.pow(2,i),s,o)&&delete t[n]}}getTile(e,t,r){const n=Math.pow(2,e),i=[];for(const s of this.features.values())A(s,n,t,r)&&i.push(P(s,n,t,r));return{features:i}}getFeatures(){return[...this.features.values()]}}function A(e,t,r,n){let{minX:i,minY:s,maxX:o,maxY:a}=e;return i<(r+1+S)/t&&s<(n+1+S)/t&&o>(r-S)/t&&a>(n-S)/t}function C(e){const{id:t,geometry:r,properties:n}=e;if(!r)return;if("GeometryCollection"===r.type)throw new Error("GeometryCollection not supported in dynamic mode.");const{type:i,coordinates:s}=r,o={id:t,type:1,geometry:[],tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},a=o.geometry;if("Point"===i)E(s,a,o);else if("MultiPoint"===i)for(const l of s)E(l,a,o);else if("LineString"===i)o.type=2,N(s,a,o);else if("MultiLineString"===i)o.type=2,I(s,a,o);else if("Polygon"===i)o.type=3,I(s,a,o,!0);else{if("MultiPolygon"!==i)throw new Error("Input data is not a valid GeoJSON object.");o.type=3;for(const e of s)I(e,a,o,!0)}return o}function E(t,r,n){let[i,s]=t;const o=e.aF(i);let a=e.aJ(s);a=a<0?0:a>1?1:a,r.push(o,a),n.minX=Math.min(n.minX,o),n.minY=Math.min(n.minY,a),n.maxX=Math.max(n.maxX,o),n.maxY=Math.max(n.maxY,a)}function N(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3],i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=[];for(const o of e)E(o,s,r);t.push(s),n&&function(e,t){let r=0;for(let n=0,i=e.length,s=i-2;n<i;s=n,n+=2)r+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(r>0===t)for(let n=0,i=e.length;n<i/2;n+=2){const t=e[n],r=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=t,e[i-1-n]=r}}(s,i)}function I(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];for(let i=0;i<e.length;i++)N(e[i],t,r,n,0===i)}function P(t,r,n,i){const{id:s,type:o,geometry:a,tags:l}=t,c=[];if(1===o)!function(t,r,n,i,s){for(let o=0;o<t.length;o+=2){const a=Math.round(e.al*(t[o+0]*r-n)),l=Math.round(e.al*(t[o+1]*r-i));s.push([a,l])}}(a,r,n,i,c);else if(2===o)for(const e of a)M(e,r,n,i,c);else if(3===o)for(const e of a)L(e,r,n,i,c);return{id:s,type:o,geometry:c,tags:l}}function M(t,r,n,i,s){const o=-T,a=e.al+T;let l;for(let c=0;c<t.length-2;c+=2){let u=Math.round(e.al*(t[c+0]*r-n)),d=Math.round(e.al*(t[c+1]*r-i)),h=Math.round(e.al*(t[c+2]*r-n)),p=Math.round(e.al*(t[c+3]*r-i));const m=h-u,f=p-d;u<o&&h<o||(u<o?(d+=Math.round(f*((o-u)/m)),u=o):h<o&&(p=d+Math.round(f*((o-u)/m)),h=o),d<o&&p<o||(d<o?(u+=Math.round(m*((o-d)/f)),d=o):p<o&&(h=u+Math.round(m*((o-d)/f)),p=o),u>=a&&h>=a||(u>=a?(d+=Math.round(f*((a-u)/m)),u=a):h>=a&&(p=d+Math.round(f*((a-u)/m)),h=a),d>=a&&p>=a||(d>=a?(u+=Math.round(m*((a-d)/f)),d=a):p>=a&&(h=u+Math.round(m*((a-d)/f)),p=a),l&&u===l[l.length-1][0]&&d===l[l.length-1][1]||(l=[[u,d]],s.push(l)),l.push([h,p])))))}}function L(t,r,n,i,s){const o=(n-S)/r,a=(i-S)/r,l=(n+1+S)/r,c=(i+1+S)/r;function u(e,t){let r=0;return e<o?r|=1:e>l&&(r|=2),t<a?r|=4:t>c&&(r|=8),r}let d=[];for(let e=1;e<=8;e*=2){let r=t[t.length-2],n=t[t.length-1],i=!(u(r,n)&e);for(let s=0;s<t.length;s+=2){const h=t[s],p=t[s+1],m=!(u(h,p)&e);m!==i&&(8&e?d.push(r+(h-r)*(c-n)/(p-n),c):4&e?d.push(r+(h-r)*(a-n)/(p-n),a):2&e?d.push(l,n+(p-n)*(l-r)/(h-r)):1&e&&d.push(o,n+(p-n)*(o-r)/(h-r))),m&&d.push(h,p),r=h,n=p,i=m}if(!(t=d).length||8===e)break;d=[]}const h=[];for(let p=0;p<d.length;p+=2)h.push([Math.round(e.al*(d[p]*r-n)),Math.round(e.al*(d[p+1]*r-i))]);s.push(h)}function R(t,r){let{name:n,features:i}=t;r.writeStringField(1,n),r.writeVarintField(5,e.al);const s=new Map,o=new Map,a={keys:s,values:o,feature:null};for(const e of i)a.feature=e,r.writeMessage(2,D,a);for(const e of s.keys())r.writeStringField(3,e);for(const e of o.keys())r.writeMessage(4,U,e)}function D(e,t){const r=e.feature;void 0!==r.id&&Number.isSafeInteger(+r.id)&&t.writeVarintField(1,+r.id),r.tags&&t.writeMessage(2,F,e),t.writeVarintField(3,r.type),t.writeMessage(4,B,r)}function F(e,t){let{keys:r,values:n,feature:i}=e;for(const s of Object.keys(i.tags)){let e=i.tags[s];if(null===e)continue;let o=r.get(s);void 0===o&&(o=r.size,r.set(s,o)),t.writeVarint(o);const a=typeof e;"string"!==a&&"boolean"!==a&&"number"!==a&&(e=JSON.stringify(e));let l=n.get(e);void 0===l&&(l=n.size,n.set(e,l)),t.writeVarint(l)}}function O(e,t){return(t<<3)+(7&e)}function z(e){return e<<1^e>>31}function B(e,t){const{geometry:r,type:n}=e;let i=0,s=0;if(1===n){t.writeVarint(O(1,r.length));for(const e of r){const r=e[0]-i,n=e[1]-s;t.writeVarint(z(r)),t.writeVarint(z(n)),i+=r,s+=n}}else for(const o of r){t.writeVarint(O(1,1));const e=o.length-(3===n?1:0);for(let r=0;r<e;r++){1===r&&t.writeVarint(O(2,e-1));const n=o[r][0]-i,a=o[r][1]-s;t.writeVarint(z(n)),t.writeVarint(z(a)),i+=n,s+=a}3===n&&t.writeVarint(O(7,1))}}function U(e,t){const r=typeof e;"string"===r?t.writeStringField(1,e):"boolean"===r?t.writeBooleanField(7,e):"number"===r&&(e%1!=0?t.writeDoubleField(3,e):e<0?t.writeSVarintField(6,e):t.writeVarintField(5,e))}const V={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:e=>e},q=Math.fround||(W=new Float32Array(1),e=>(W[0]=+e,W[0]));var W;const H=3,G=5,Z=6;class K{constructor(e){this.options=Object.assign(Object.create(V),e),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(e){const{log:t,minZoom:r,maxZoom:n}=this.options;t&&console.time("total time");const i="prepare ".concat(e.length," points");t&&console.time(i),this.points=e;const s=[];for(let a=0;a<e.length;a++){const t=e[a];if(!t.geometry)continue;const[r,n]=t.geometry.coordinates,i=q(J(r)),o=q(Q(n));s.push(i,o,1/0,a,-1,1),this.options.reduce&&s.push(0)}let o=this.trees[n+1]=this._createTree(s);t&&console.timeEnd(i);for(let a=n;a>=r;a--){const e=+Date.now();o=this.trees[a]=this._createTree(this._cluster(o,a)),t&&console.log("z%d: %d clusters in %dms",a,o.numItems,+Date.now()-e)}return t&&console.timeEnd("total time"),this}getClusters(e,t){let r=((e[0]+180)%360+360)%360-180;const n=Math.max(-90,Math.min(90,e[1]));let i=180===e[2]?180:((e[2]+180)%360+360)%360-180;const s=Math.max(-90,Math.min(90,e[3]));if(e[2]-e[0]>=360)r=-180,i=180;else if(r>i){const e=this.getClusters([r,n,180,s],t),o=this.getClusters([-180,n,i,s],t);return e.concat(o)}const o=this.trees[this._limitZoom(t)],a=o.range(J(r),Q(s),J(i),Q(n)),l=o.data,c=[];for(const u of a){const e=this.stride*u;c.push(l[e+G]>1?Y(l,e,this.clusterProps):this.points[l[e+H]])}return c}getChildren(e){const t=this._getOriginId(e),r=this._getOriginZoom(e),n="No cluster with the specified id.",i=this.trees[r];if(!i)throw new Error(n);const s=i.data;if(t*this.stride>=s.length)throw new Error(n);const o=this.options.radius/(this.options.extent*Math.pow(2,r-1)),a=i.within(s[t*this.stride],s[t*this.stride+1],o),l=[];for(const c of a){const t=c*this.stride;s[t+4]===e&&l.push(s[t+G]>1?Y(s,t,this.clusterProps):this.points[s[t+H]])}if(0===l.length)throw new Error(n);return l}getLeaves(e,t,r){const n=[];return this._appendLeaves(n,e,t=t||10,r=r||0,0),n}getTile(e,t,r){const n=this.trees[this._limitZoom(e)],i=Math.pow(2,e),{extent:s,radius:o}=this.options,a=o/s,l=(r-a)/i,c=(r+1+a)/i,u={features:[]};return this._addTileFeatures(n.range((t-a)/i,l,(t+1+a)/i,c),n.data,t,r,i,u),0===t&&this._addTileFeatures(n.range(1-a/i,l,1,c),n.data,i,r,i,u),t===i-1&&this._addTileFeatures(n.range(0,l,a/i,c),n.data,-1,r,i,u),u.features.length?u:null}getClusterExpansionZoom(e){let t=this._getOriginZoom(e)-1;for(;t<=this.options.maxZoom;){const r=this.getChildren(e);if(t++,1!==r.length)break;e=r[0].properties.cluster_id}return t}_appendLeaves(e,t,r,n,i){const s=this.getChildren(t);for(const o of s){const t=o.properties;if(t&&t.cluster?i+t.point_count<=n?i+=t.point_count:i=this._appendLeaves(e,t.cluster_id,r,n,i):i<n?i++:e.push(o),e.length===r)break}return i}_createTree(t){const r=new e.c4(t.length/this.stride|0,this.options.nodeSize,Float32Array);for(let e=0;e<t.length;e+=this.stride)r.add(t[e],t[e+1]);return r.finish(),r.data=t,r}_addTileFeatures(e,t,r,n,i,s){for(const o of e){const e=o*this.stride,a=t[e+G]>1;let l,c,u;if(a)l=X(t,e,this.clusterProps),c=t[e],u=t[e+1];else{const r=this.points[t[e+H]];l=r.properties;const[n,i]=r.geometry.coordinates;c=J(n),u=Q(i)}const d={type:1,geometry:[[Math.round(this.options.extent*(c*i-r)),Math.round(this.options.extent*(u*i-n))]],tags:l};let h;h=a||this.options.generateId?t[e+H]:this.points[t[e+H]].id,void 0!==h&&(d.id=h),s.features.push(d)}}_limitZoom(e){return Math.max(this.options.minZoom,Math.min(Math.floor(+e),this.options.maxZoom+1))}_cluster(e,t){const{radius:r,extent:n,reduce:i,minPoints:s}=this.options,o=r/(n*Math.pow(2,t)),a=e.data,l=[],c=this.stride;for(let u=0;u<a.length;u+=c){if(a[u+2]<=t)continue;a[u+2]=t;const r=a[u],n=a[u+1],d=e.within(a[u],a[u+1],o),h=a[u+G];let p=h;for(const e of d){const r=e*c;a[r+2]>t&&(p+=a[r+G])}if(p>h&&p>=s){let e,s=r*h,o=n*h,m=-1;const f=(u/c<<5)+(t+1)+this.points.length;for(const r of d){const n=r*c;if(a[n+2]<=t)continue;a[n+2]=t;const l=a[n+G];s+=a[n]*l,o+=a[n+1]*l,a[n+4]=f,i&&(e||(e=this._map(a,u,!0),m=this.clusterProps.length,this.clusterProps.push(e)),i(e,this._map(a,n)))}a[u+4]=f,l.push(s/p,o/p,1/0,f,-1,p),i&&l.push(m)}else{for(let e=0;e<c;e++)l.push(a[u+e]);if(p>1)for(const e of d){const r=e*c;if(!(a[r+2]<=t)){a[r+2]=t;for(let e=0;e<c;e++)l.push(a[r+e])}}}}return l}_getOriginId(e){return e-this.points.length>>5}_getOriginZoom(e){return(e-this.points.length)%32}_map(e,t,r){if(e[t+G]>1){const n=this.clusterProps[e[t+Z]];return r?Object.assign({},n):n}const n=this.points[e[t+H]].properties,i=this.options.map(n);return r&&i===n?Object.assign({},i):i}}function Y(e,t,r){return{type:"Feature",id:e[t+H],properties:X(e,t,r),geometry:{type:"Point",coordinates:[(n=e[t],360*(n-.5)),$(e[t+1])]}};var n}function X(e,t,r){const n=e[t+G],i=n>=1e4?"".concat(Math.round(n/1e3),"k"):n>=1e3?Math.round(n/100)/10+"k":n,s=e[t+Z],o=-1===s?{}:Object.assign({},r[s]);return Object.assign(o,{cluster:!0,cluster_id:e[t+H],point_count:n,point_count_abbreviated:i})}function J(e){return e/360+.5}function Q(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function $(e){const t=(180-360*e)*Math.PI/180;return 360*Math.atan(Math.exp(t))/Math.PI-90}function ee(e,t,r,n){let i=n;const s=t+(r-t>>1);let o,a=r-t;const l=e[t],c=e[t+1],u=e[r],d=e[r+1];for(let h=t+3;h<r;h+=3){const t=te(e[h],e[h+1],l,c,u,d);if(t>i)o=h,i=t;else if(t===i){const e=Math.abs(h-s);e<a&&(o=h,a=e)}}i>n&&(o-t>3&&ee(e,t,o,n),e[o+2]=i,r-o>3&&ee(e,o,r,n))}function te(e,t,r,n,i,s){let o=i-r,a=s-n;if(0!==o||0!==a){const l=((e-r)*o+(t-n)*a)/(o*o+a*a);l>1?(r=i,n=s):l>0&&(r+=o*l,n+=a*l)}return o=e-r,a=t-n,o*o+a*a}function re(e,t,r,n){const i={id:null!==e&&void 0!==e?e:null,type:t,geometry:r,tags:n,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if("Point"===t||"MultiPoint"===t||"LineString"===t)ne(i,r);else if("Polygon"===t)ne(i,r[0]);else if("MultiLineString"===t)for(const s of r)ne(i,s);else if("MultiPolygon"===t)for(const s of r)ne(i,s[0]);return i}function ne(e,t){for(let r=0;r<t.length;r+=3)e.minX=Math.min(e.minX,t[r]),e.minY=Math.min(e.minY,t[r+1]),e.maxX=Math.max(e.maxX,t[r]),e.maxY=Math.max(e.maxY,t[r+1])}function ie(e,t,r,n){if(!t.geometry)return;const i=t.geometry.coordinates;if(i&&0===i.length)return;const s=t.geometry.type,o=Math.pow(r.tolerance/((1<<r.maxZoom)*r.extent),2);let a=[],l=t.id;if(r.promoteId?l=t.properties[r.promoteId]:r.generateId&&(l=n||0),"Point"===s)se(i,a);else if("MultiPoint"===s)for(const c of i)se(c,a);else if("LineString"===s)oe(i,a,o,!1);else if("MultiLineString"===s){if(r.lineMetrics){for(const r of i)a=[],oe(r,a,o,!1),e.push(re(l,"LineString",a,t.properties));return}ae(i,a,o,!1)}else if("Polygon"===s)ae(i,a,o,!0);else{if("MultiPolygon"!==s){if("GeometryCollection"===s){for(const i of t.geometry.geometries)ie(e,{id:l,geometry:i,properties:t.properties},r,n);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const e of i){const t=[];ae(e,t,o,!0),a.push(t)}}e.push(re(l,s,a,t.properties))}function se(e,t){t.push(le(e[0]),ce(e[1]),0)}function oe(e,t,r,n){let i,s,o=0;for(let l=0;l<e.length;l++){const r=le(e[l][0]),a=ce(e[l][1]);t.push(r,a,0),l>0&&(o+=n?(i*a-r*s)/2:Math.sqrt(Math.pow(r-i,2)+Math.pow(a-s,2))),i=r,s=a}const a=t.length-3;t[2]=1,ee(t,0,a,r),t[a+2]=1,t.size=Math.abs(o),t.start=0,t.end=t.size}function ae(e,t,r,n){for(let i=0;i<e.length;i++){const s=[];oe(e[i],s,r,n),t.push(s)}}function le(e){return e/360+.5}function ce(e){const t=Math.sin(e*Math.PI/180),r=.5-.25*Math.log((1+t)/(1-t))/Math.PI;return r<0?0:r>1?1:r}function ue(e,t,r,n,i,s,o,a){if(n/=t,s>=(r/=t)&&o<n)return e;if(o<r||s>=n)return null;const l=[];for(const c of e){const e=c.geometry;let t=c.type;const s=0===i?c.minX:c.minY,o=0===i?c.maxX:c.maxY;if(s>=r&&o<n){l.push(c);continue}if(o<r||s>=n)continue;let u=[];if("Point"===t||"MultiPoint"===t)de(e,u,r,n,i);else if("LineString"===t)he(e,u,r,n,i,!1,a.lineMetrics);else if("MultiLineString"===t)me(e,u,r,n,i,!1);else if("Polygon"===t)me(e,u,r,n,i,!0);else if("MultiPolygon"===t)for(const a of e){const e=[];me(a,e,r,n,i,!0),e.length&&u.push(e)}if(u.length){if(a.lineMetrics&&"LineString"===t){for(const e of u)l.push(re(c.id,t,e,c.tags));continue}"LineString"!==t&&"MultiLineString"!==t||(1===u.length?(t="LineString",u=u[0]):t="MultiLineString"),"Point"!==t&&"MultiPoint"!==t||(t=3===u.length?"Point":"MultiPoint"),l.push(re(c.id,t,u,c.tags))}}return l.length?l:null}function de(e,t,r,n,i){for(let s=0;s<e.length;s+=3){const o=e[s+i];o>=r&&o<=n&&fe(t,e[s],e[s+1],e[s+2])}}function he(e,t,r,n,i,s,o){let a=pe(e);const l=0===i?ge:ye;let c,u,d=e.start;for(let g=0;g<e.length-3;g+=3){const h=e[g],p=e[g+1],m=e[g+2],f=e[g+3],y=e[g+4],_=0===i?h:p,v=0===i?f:y;let x=!1;o&&(c=Math.sqrt(Math.pow(h-f,2)+Math.pow(p-y,2))),_<r?v>r&&(u=l(a,h,p,f,y,r),o&&(a.start=d+c*u)):_>n?v<n&&(u=l(a,h,p,f,y,n),o&&(a.start=d+c*u)):fe(a,h,p,m),v<r&&_>=r&&(u=l(a,h,p,f,y,r),x=!0),v>n&&_<=n&&(u=l(a,h,p,f,y,n),x=!0),!s&&x&&(o&&(a.end=d+c*u),t.push(a),a=pe(e)),o&&(d+=c)}let h=e.length-3;const p=e[h],m=e[h+1],f=0===i?p:m;f>=r&&f<=n&&fe(a,p,m,e[h+2]),h=a.length-3,s&&h>=3&&(a[h]!==a[0]||a[h+1]!==a[1])&&fe(a,a[0],a[1],a[2]),a.length&&t.push(a)}function pe(e){const t=[];return t.size=e.size,t.start=e.start,t.end=e.end,t}function me(e,t,r,n,i,s){for(const o of e)he(o,t,r,n,i,s,!1)}function fe(e,t,r,n){e.push(t,r,n)}function ge(e,t,r,n,i,s){const o=(s-t)/(n-t);return fe(e,s,r+(i-r)*o,1),o}function ye(e,t,r,n,i,s){const o=(s-r)/(i-r);return fe(e,t+(n-t)*o,s,1),o}function _e(e,t){const r=[];for(let n=0;n<e.length;n++){const i=e[n],s=i.type;let o;if("Point"===s||"MultiPoint"===s||"LineString"===s)o=ve(i.geometry,t);else if("MultiLineString"===s||"Polygon"===s){o=[];for(const e of i.geometry)o.push(ve(e,t))}else if("MultiPolygon"===s){o=[];for(const e of i.geometry){const r=[];for(const n of e)r.push(ve(n,t));o.push(r)}}r.push(re(i.id,s,o,i.tags))}return r}function ve(e,t){const r=[];r.size=e.size,void 0!==e.start&&(r.start=e.start,r.end=e.end);for(let n=0;n<e.length;n+=3)r.push(e[n]+t,e[n+1],e[n+2]);return r}function xe(e,t){if(e.transformed)return e;const r=1<<e.z,n=e.x,i=e.y;for(const s of e.features){const e=s.geometry,o=s.type;if(s.geometry=[],1===o)for(let a=0;a<e.length;a+=2)s.geometry.push(be(e[a],e[a+1],t,r,n,i));else for(let a=0;a<e.length;a++){const o=[];for(let s=0;s<e[a].length;s+=2)o.push(be(e[a][s],e[a][s+1],t,r,n,i));s.geometry.push(o)}}return e.transformed=!0,e}function be(e,t,r,n,i,s){return[Math.round(r*(e*n-i)),Math.round(r*(t*n-s))]}function we(e,t,r,n,i){const s=t===i.maxZoom?0:i.tolerance/((1<<t)*i.extent),o={features:[],numPoints:0,numSimplified:0,numFeatures:e.length,source:null,x:r,y:n,z:t,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const a of e)je(o,a,s,i);return o}function je(e,t,r,n){const i=t.geometry,s=t.type,o=[];if(e.minX=Math.min(e.minX,t.minX),e.minY=Math.min(e.minY,t.minY),e.maxX=Math.max(e.maxX,t.maxX),e.maxY=Math.max(e.maxY,t.maxY),"Point"===s||"MultiPoint"===s)for(let a=0;a<i.length;a+=3)o.push(i[a],i[a+1]),e.numPoints++,e.numSimplified++;else if("LineString"===s)Se(o,i,e,r,!1,!1);else if("MultiLineString"===s||"Polygon"===s)for(let a=0;a<i.length;a++)Se(o,i[a],e,r,"Polygon"===s,0===a);else if("MultiPolygon"===s)for(let a=0;a<i.length;a++){const t=i[a];for(let n=0;n<t.length;n++)Se(o,t[n],e,r,!0,0===n)}if(o.length){let r=t.tags||null;if("LineString"===s&&n.lineMetrics){r={};for(const e in t.tags)r[e]=t.tags[e];r.mapbox_clip_start=i.start/i.size,r.mapbox_clip_end=i.end/i.size}const a={geometry:o,type:"Polygon"===s||"MultiPolygon"===s?3:"LineString"===s||"MultiLineString"===s?2:1,tags:r};null!==t.id&&(a.id=t.id),e.features.push(a)}}function Se(e,t,r,n,i,s){const o=n*n;if(n>0&&t.size<(i?o:n))return void(r.numPoints+=t.length/3);const a=[];for(let l=0;l<t.length;l+=3)(0===n||t[l+2]>o)&&(r.numSimplified++,a.push(t[l],t[l+1])),r.numPoints++;i&&function(e,t){let r=0;for(let n=0,i=e.length,s=i-2;n<i;s=n,n+=2)r+=(e[n]-e[s])*(e[n+1]+e[s+1]);if(r>0===t)for(let n=0,i=e.length;n<i/2;n+=2){const t=e[n],r=e[n+1];e[n]=e[i-2-n],e[n+1]=e[i-1-n],e[i-2-n]=t,e[i-1-n]=r}}(a,s),e.push(a)}const Te={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class ke{constructor(e,t){const r=(t=this.options=function(e,t){for(const r in t)e[r]=t[r];return e}(Object.create(Te),t)).debug;if(r&&console.time("preprocess data"),t.maxZoom<0||t.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(t.promoteId&&t.generateId)throw new Error("promoteId and generateId cannot be used together.");let n=function(e,t){const r=[];if("FeatureCollection"===e.type)for(let n=0;n<e.features.length;n++)ie(r,e.features[n],t,n);else ie(r,"Feature"===e.type?e:{geometry:e},t);return r}(e,t);this.tiles={},this.tileCoords=[],r&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",t.indexMaxZoom,t.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),n=function(e,t){const r=t.buffer/t.extent;let n=e;const i=ue(e,1,-1-r,r,0,-1,2,t),s=ue(e,1,1-r,2+r,0,-1,2,t);return(i||s)&&(n=ue(e,1,-r,1+r,0,-1,2,t)||[],i&&(n=_e(i,1).concat(n)),s&&(n=n.concat(_e(s,-1)))),n}(n,t),n.length&&this.splitTile(n,0,0,0),r&&(n.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(e,t,r,n,i,s,o){const a=[e,t,r,n],l=this.options,c=l.debug;for(;a.length;){n=a.pop(),r=a.pop(),t=a.pop(),e=a.pop();const u=1<<t,d=Ae(t,r,n);let h=this.tiles[d];if(!h&&(c>1&&console.time("creation"),h=this.tiles[d]=we(e,t,r,n,l),this.tileCoords.push({z:t,x:r,y:n}),c)){c>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",t,r,n,h.numFeatures,h.numPoints,h.numSimplified),console.timeEnd("creation"));const e="z".concat(t);this.stats[e]=(this.stats[e]||0)+1,this.total++}if(h.source=e,null==i){if(t===l.indexMaxZoom||h.numPoints<=l.indexMaxPoints)continue}else{if(t===l.maxZoom||t===i)continue;if(null!=i){const e=i-t;if(r!==s>>e||n!==o>>e)continue}}if(h.source=null,0===e.length)continue;c>1&&console.time("clipping");const p=.5*l.buffer/l.extent,m=.5-p,f=.5+p,g=1+p;let y=null,_=null,v=null,x=null,b=ue(e,u,r-p,r+f,0,h.minX,h.maxX,l),w=ue(e,u,r+m,r+g,0,h.minX,h.maxX,l);e=null,b&&(y=ue(b,u,n-p,n+f,1,h.minY,h.maxY,l),_=ue(b,u,n+m,n+g,1,h.minY,h.maxY,l),b=null),w&&(v=ue(w,u,n-p,n+f,1,h.minY,h.maxY,l),x=ue(w,u,n+m,n+g,1,h.minY,h.maxY,l),w=null),c>1&&console.timeEnd("clipping"),a.push(y||[],t+1,2*r,2*n),a.push(_||[],t+1,2*r,2*n+1),a.push(v||[],t+1,2*r+1,2*n),a.push(x||[],t+1,2*r+1,2*n+1)}}getTile(e,t,r){e=+e,t=+t,r=+r;const n=this.options,{extent:i,debug:s}=n;if(e<0||e>24)return null;const o=1<<e,a=Ae(e,t=t+o&o-1,r);if(this.tiles[a])return xe(this.tiles[a],i);s>1&&console.log("drilling down to z%d-%d-%d",e,t,r);let l,c=e,u=t,d=r;for(;!l&&c>0;)c--,u>>=1,d>>=1,l=this.tiles[Ae(c,u,d)];return l&&l.source?(s>1&&(console.log("found parent tile z%d-%d-%d",c,u,d),console.time("drilling down")),this.splitTile(l.source,c,u,d,e,t,r),s>1&&console.timeEnd("drilling down"),this.tiles[a]?xe(this.tiles[a],i):null):null}}function Ae(e,t,r){return 32*((1<<e)*r+t)+e}function Ce(t,r){const n=t.tileID.canonical;if(!this._geoJSONIndex)return void r(null,null);const i=this._geoJSONIndex.getTile(n.z,n.x,n.y);if(!i)return void r(null,null);const s=e=>e.tags&&"3d_elevation_id"in e.tags&&"source"in e.tags&&"elevation"===e.tags.source,o=i.features.filter(e=>s(e));let a={_geojsonTileLayer:i.features};o.length>0&&(a={_geojsonTileLayer:i.features.filter(e=>!s(e)),hd_road_elevation:o});const l=new j(a),c=function(t){const r=new e.bt;for(const e of Object.keys(t))r.writeMessage(3,R,{name:e,features:t[e]});return r.finish()}(a).buffer;r(null,{vectorTile:l,rawData:c})}class Ee extends g{constructor(e,t,r,n,i,s,o){super(e,t,r,n,i,Ce,o),s&&(this.loadGeoJSON=s),this._dynamicIndex=new k}loadData(r,n){const i=r&&r.request,s=i&&i.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(r,(o,a)=>{if(o||!a)return n(o);if("object"!=typeof a)return n(new Error("Input data given to '".concat(r.source,"' is not a valid GeoJSON object.")));{try{if(r.filter){const t=e.U(r.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if("error"===t.result)throw new Error(t.value.map(e=>"".concat(e.key,": ").concat(e.message)).join(", "));a.features=a.features.filter(e=>t.value.evaluate({zoom:0},e))}r.dynamic?("Feature"===a.type&&(a={type:"FeatureCollection",features:[a]}),r.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(a.features,this.loaded),r.cluster&&(a.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=r.cluster?new K(function(t){let{superclusterOptions:r,clusterProperties:n}=t;if(!n||!r)return r;const i={},s={},o={accumulated:null,zoom:0},a={properties:null},l=Object.keys(n);for(const c of l){const[t,r]=n[c],o=e.U(r),a=e.U("string"==typeof t?[t,["accumulated"],["get",c]]:t);i[c]=o.value,s[c]=a.value}return r.map=e=>{a.properties=e;const t={};for(const r of l)t[r]=i[r].evaluate(o,a);return t},r.reduce=(e,t)=>{a.properties=t;for(const r of l)o.accumulated=e[r],e[r]=s[r].evaluate(o,a)},r}(r)).load(a.features):r.dynamic?this._dynamicIndex:function(e,t){return new ke(e,t)}(a,r.geojsonVtOptions)}catch(e){return n(e)}const o={};if(s){const e=t(i);e&&(o.resourceTiming={},o.resourceTiming[r.source]=JSON.parse(JSON.stringify(e)))}n(null,o)}})}reloadTile(e,t){const r=this.loaded;return r&&r[e.uid]?e.partial?t(null,void 0):super.reloadTile(e,t):this.loadTile(e,t)}loadGeoJSON(t,r){if(t.request)e.m(t.request,r);else{if("string"!=typeof t.data)return r(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")));setTimeout(()=>{try{return r(null,JSON.parse(t.data))}catch(e){return r(new Error("Input data given to '".concat(t.source,"' is not a valid GeoJSON object.")))}},0)}}getClusterExpansionZoom(e,t){try{t(null,this._geoJSONIndex.getClusterExpansionZoom(e.clusterId))}catch(e){t(e)}}getClusterChildren(e,t){try{t(null,this._geoJSONIndex.getChildren(e.clusterId))}catch(e){t(e)}}getClusterLeaves(e,t){try{t(null,this._geoJSONIndex.getLeaves(e.clusterId,e.limit,e.offset))}catch(e){t(e)}}}class Ne{constructor(t,r,n){this.tileID=new e.aQ(t.tileID.overscaledZ,t.tileID.wrap,t.tileID.canonical.z,t.tileID.canonical.x,t.tileID.canonical.y),this.tileZoom=t.tileZoom,this.uid=t.uid,this.zoom=t.zoom,this.canonical=t.tileID.canonical,this.pixelRatio=t.pixelRatio,this.tileSize=t.tileSize,this.source=t.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=t.projection,this.brightness=r,this.worldview=n}parse(t,r,n,i){this.status="parsing";const s=new e.aQ(n.tileID.overscaledZ,n.tileID.wrap,n.tileID.canonical.z,n.tileID.canonical.x,n.tileID.canonical.y),o=[],a=r.familiesBySource[n.source],l=new e.fn(s,n.promoteId);l.bucketLayerIDs=[],l.is3DTile=!0,e.fC(t).then(t=>{if(!t)return i(new Error("Could not parse tile"));const r=t.json.extensionsUsed&&t.json.extensionsUsed.includes("MAPBOX_mesh_features")||t.json.asset.extras&&t.json.asset.extras.MAPBOX_mesh_features,c=t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression"),u=new e.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const i in a)for(const d of a[i]){const i=d[0];l.bucketLayerIDs.push(d.map(t=>e.B(t.id,t.scope))),i.recalculate(u,[]);const a=e.fD(t,1/e.d7(n.tileID.canonical)),h=new e.fE(d,a,s,r,c,this.brightness,l,this.worldview);r||(h.needsUpload=!0),o.push(h),h.evaluate(i)}this.status="done",i(null,{buckets:o,featureIndex:l,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(e=>i(new Error(e.message)))}}class Ie{constructor(e,t,r,n,i,s,o,a){this.actor=e,this.layerIndex=t,this.availableImages=r,this.availableModels=n,this.brightness=o,this.loading={},this.loaded={},this.worldview=a}loadTile(t,r){const n=t.uid,i=this.loading[n]=new Ne(t,this.brightness,this.worldview);e.bu(t.request,(e,s)=>{const o=!this.loading[n];return delete this.loading[n],o||e?(i.status="done",o||(this.loaded[n]=i),r(e)):s&&0!==s.byteLength?void i.parse(s,this.layerIndex,t,(e,t)=>{i.status="done",this.loaded=this.loaded||{},this.loaded[n]=i,e||!t?r(e):r(null,t)}):(i.status="done",this.loaded[n]=i,r())})}reloadTile(e,t){const r=this.loaded,n=e.uid;if(r&&r[n]){const i=r[n];i.projection=e.projection,i.brightness=e.brightness;const s=(r,n)=>{i.reloadCallback&&(delete i.reloadCallback,this.loadTile(e,t)),t(r,n)};"parsing"===i.status?i.reloadCallback=s:"done"===i.status&&this.loadTile(e,t)}}abortTile(e,t){const r=e.uid;this.loading[r]&&delete this.loading[r],t()}removeTile(e,t){const r=this.loaded,n=e.uid;r&&r[n]&&delete r[n],t()}}class Pe{constructor(t){this.self=t,this.actor=new e.fG(t,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new e.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=e.cm({name:"mercator"}),this.workerSourceTypes={vector:g,geojson:Ee,"raster-dem":y,"raster-array":v,"batched-model":Ie},this.workerSources={},this.self.registerWorkerSource=(e,t)=>{if(this.workerSourceTypes[e])throw new Error('Worker source with name "'.concat(e,'" already registered.'));this.workerSourceTypes[e]=t},this.self.registerRTLTextPlugin=t=>{if(e.fH.isParsed())throw new Error("RTL text plugin already registered.");e.fH.setState({pluginStatus:e.fI.parsed,pluginURL:e.fH.getPluginURL()}),e.fH.applyArabicShaping=t.applyArabicShaping,e.fH.processBidirectionalText=t.processBidirectionalText,e.fH.processStyledBidirectionalText=t.processStyledBidirectionalText;for(const e of this.rtlPluginParsingListeners)e(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(e,t,r){delete this.layerIndexes[e],delete this.availableImages[e],delete this.availableModels[e],delete this.workerSources[e],r()}checkIfReady(e,t,r){r()}setReferrer(e,t){this.referrer=t}spriteLoaded(t,r){this.isSpriteLoaded[t]||(this.isSpriteLoaded[t]={});const{scope:n,isLoaded:i}=r;if(this.isSpriteLoaded[t][n]=i,this.workerSources[t]&&this.workerSources[t][n])for(const s in this.workerSources[t][n]){const r=this.workerSources[t][n][s];for(const t in r){const n=r[t];n instanceof g&&(n.isSpriteLoaded=i,n.fire(new e.z("isSpriteLoaded")))}}}setImages(e,t,r){this.availableImages[e]||(this.availableImages[e]={});const{scope:n,images:i}=t;if(this.availableImages[e][n]=i,this.workerSources[e]&&this.workerSources[e][n]){for(const t in this.workerSources[e][n]){const r=this.workerSources[e][n][t];for(const e in r)r[e].availableImages=i}r()}else r()}setModels(e,t,r){let{scope:n,models:i}=t;if(this.availableModels[e]||(this.availableModels[e]={}),this.availableModels[e][n]=i,this.workerSources[e]&&this.workerSources[e][n]){for(const t in this.workerSources[e][n]){const r=this.workerSources[e][n][t];for(const e in r)r[e].availableModels=i}r()}else r()}setProjection(t,r){this.projections[t]=e.cm(r)}setBrightness(e,t,r){this.brightness=t,r()}setWorldview(e,t,r){this.worldview=t,r()}setLayers(e,t,r){this.getLayerIndex(e,t.scope).replace(t.layers,t.options),r()}updateLayers(e,t,r){this.getLayerIndex(e,t.scope).update(t.layers,t.removedIds,t.options),r()}loadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).loadTile(t,r)}decodeRasterArray(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).decodeRasterArray(t,r)}reloadTile(e,t,r){t.projection=this.projections[e]||this.defaultProjection,this.getWorkerSource(e,t.type,t.source,t.scope).reloadTile(t,r)}abortTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).abortTile(t,r)}removeTile(e,t,r){this.getWorkerSource(e,t.type,t.source,t.scope).removeTile(t,r)}removeSource(e,t,r){if(!(this.workerSources[e]&&this.workerSources[e][t.scope]&&this.workerSources[e][t.scope][t.type]&&this.workerSources[e][t.scope][t.type][t.source]))return;const n=this.workerSources[e][t.scope][t.type][t.source];delete this.workerSources[e][t.scope][t.type][t.source],void 0!==n.removeSource?n.removeSource(t,r):r()}loadWorkerSource(e,t,r){try{this.self.importScripts(t.url),r()}catch(e){r(e)}}syncRTLPluginState(t,r,n){if(e.fH.isParsed())n(null,!0);else if(e.fH.isParsing())this.rtlPluginParsingListeners.push(n);else try{e.fH.setState(r);const t=e.fH.getPluginURL();!e.fH.isLoaded()||e.fH.isParsed()||e.fH.isParsing()||null==t||(e.fH.setState({pluginStatus:e.fI.parsing,pluginURL:e.fH.getPluginURL()}),this.self.importScripts(t),e.fH.isParsed()?n(null,!0):this.rtlPluginParsingListeners.push(n))}catch(e){n(e)}}setDracoUrl(e,t){this.dracoUrl=t}getAvailableImages(e,t){this.availableImages[e]||(this.availableImages[e]={});let r=this.availableImages[e][t];return r||(r=[]),r}getAvailableModels(e,t){this.availableModels[e]||(this.availableModels[e]={});let r=this.availableModels[e][t];return r||(r={}),r}getLayerIndex(e,t){this.layerIndexes[e]||(this.layerIndexes[e]={});let r=this.layerIndexes[e][t];return r||(r=this.layerIndexes[e][t]=new i,r.scope=t),r}getWorkerSource(e,t,r,n){const i=this.workerSources;return i[e]||(i[e]={}),i[e][n]||(i[e][n]={}),i[e][n][t]||(i[e][n][t]={}),this.isSpriteLoaded[e]||(this.isSpriteLoaded[e]={}),i[e][n][t][r]||(i[e][n][t][r]=new this.workerSourceTypes[t]({send:(t,r,n,i,s,o)=>this.actor.send(t,r,n,e,s,o),scheduler:this.actor.scheduler},this.getLayerIndex(e,n),this.getAvailableImages(e,n),this.getAvailableModels(e,n),this.isSpriteLoaded[e][n],void 0,this.brightness,this.worldview)),i[e][n][t][r]}rasterizeImagesWorker(e,t,r){const n=new Map;for(const[i,{image:s,imageVariant:o}]of t.tasks.entries()){const r=this.imageRasterizer.rasterize(o,s,t.scope,e);n.set(i,r)}r(void 0,n)}removeRasterizedImages(e,t,r){this.imageRasterizer.removeImagesFromCacheByIds(t.imageIds,t.scope,e),r()}enforceCacheSizeLimit(t,r){e.fJ(r)}getWorkerPerformanceMetrics(e,t,r){r(void 0,void 0)}}return e.fF(self)&&(self.worker=new Pe(self)),Pe}),o(["./shared"],function(e){var t="3.17.0";const r={create:"create",load:"load",fullLoad:"fullLoad"},o={mark(e){performance.mark(e)},measure(e,t,r){performance.measure(e,t,r)}};function a(t){const r=t.name.split("?")[0];return e.a(r)&&r.includes("mapbox-gl.js")?"javascript":e.a(r)&&r.includes("mapbox-gl.css")?"css":e.b(r)?"fontRange":e.c(r)?"sprite":e.i(r)?"style":e.d(r)?"tilejson":"other"}var l,c={},u=function(){if(l)return c;function e(e){return!t(e)}function t(t){return"undefined"==typeof window||"undefined"==typeof document?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var e,t,r=new Blob([""],{type:"text/javascript"}),n=URL.createObjectURL(r);try{t=new Worker(n),e=!0}catch(t){e=!1}return t&&t.terminate(),URL.revokeObjectURL(n),e}()?function(){var e=document.createElement("canvas");e.width=e.height=1;var t=e.getContext("2d");if(!t)return!1;var r=t.getImageData(0,0,1,1);return r&&r.width===e.width}()?(void 0===r[n=t&&t.failIfMajorPerformanceCaveat]&&(r[n]=function(t){var r,n=function(t){var r=document.createElement("canvas"),n=Object.create(e.webGLContextAttributes);return n.failIfMajorPerformanceCaveat=t,r.getContext("webgl2",n)}(t);if(!n)return!1;try{r=n.createShader(n.VERTEX_SHADER)}catch(e){return!1}return!(!r||n.isContextLost())&&(n.shaderSource(r,"void main() {}"),n.compileShader(r),!0===n.getShaderParameter(r,n.COMPILE_STATUS))}(n)),r[n]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var n}l=1,c.supported=e,c.notSupportedReason=t;var r={};return e.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},c}();function d(e,t,r){const n=document.createElement(e);return null!=t&&(n.className=t),r&&r.appendChild(n),n}function h(e,t,r){const n=document.createElementNS("http://www.w3.org/2000/svg",e);for(const i of Object.keys(t))n.setAttributeNS(null,i,String(t[i]));return r&&r.appendChild(n),n}const p="undefined"!=typeof document?document.documentElement&&document.documentElement.style:null,m=p&&void 0!==p.userSelect?"userSelect":"WebkitUserSelect";let f;function g(){p&&m&&(f=p[m],p[m]="none")}function y(){p&&m&&(p[m]=f)}function _(e){e.preventDefault(),e.stopPropagation(),window.removeEventListener("click",_,!0)}function v(){window.addEventListener("click",_,!0),window.setTimeout(()=>{window.removeEventListener("click",_,!0)},0)}function x(e,t){const r=e.getBoundingClientRect();return j(e,r,t)}function b(e,t){const r=e.getBoundingClientRect(),n=[];for(let i=0;i<t.length;i++)n.push(j(e,r,t[i]));return n}function w(e){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&2===e.button&&e.ctrlKey?0:e.button}function j(t,r,n){const i=t.offsetWidth===r.width?1:t.offsetWidth/r.width;return new e.P((n.clientX-r.left)*i,(n.clientY-r.top)*i)}const S="01",T="NO_ACCESS_TOKEN";class k{constructor(e,t,r){this._transformRequestFn=e,this._customAccessToken=t,this._silenceAuthErrors=!!r,this._createSkuToken()}_createSkuToken(){const e=function(){let e="";for(let t=0;t<10;t++)e+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",S,e].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=e.token,this._skuTokenExpiresAt=e.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(e,t){return this._transformRequestFn&&this._transformRequestFn(e,t)||{url:e}}normalizeStyleURL(r,n){if(!e.h(r))return r;const i=C(r);return i.params.push("sdk=js-".concat(t)),i.path="/styles/v1".concat(i.path),this._makeAPIURL(i,this._customAccessToken||n)}normalizeGlyphsURL(t,r){if(!e.h(t))return t;const n=C(t);return n.path="/fonts/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||r)}normalizeModelURL(t,r){if(!e.h(t))return t;const n=C(t);return n.path="/models/v1".concat(n.path),this._makeAPIURL(n,this._customAccessToken||r)}normalizeSourceURL(t,r,n,i){if(!e.h(t))return t;const s=C(t);return s.path="/v4/".concat(s.authority,".json"),s.params.push("secure"),n&&s.params.push("language=".concat(n)),i&&s.params.push("worldview=".concat(i)),this._makeAPIURL(s,this._customAccessToken||r)}normalizeIconsetURL(t,r){const n=C(t);return e.h(t)?(n.path="/styles/v1".concat(n.path,"/iconset.pbf"),this._makeAPIURL(n,this._customAccessToken||r)):E(n)}normalizeSpriteURL(t,r,n,i){const s=C(t);return e.h(t)?(s.path="/styles/v1".concat(s.path,"/sprite").concat(r).concat(n),this._makeAPIURL(s,this._customAccessToken||i)):(s.path+="".concat(r).concat(n),E(s))}normalizeTileURL(t,r,n){if(this._isSkuTokenExpired()&&this._createSkuToken(),t&&!e.h(t))return t;const i=C(t);i.path=i.path.replace(/(\.(png|jpg)\d*)(?=$)/,"".concat(r||n&&"raster"!==i.authority&&512===n?"@2x":"").concat(e.k.supported?".webp":"$1")),"raster"===i.authority?i.path="/".concat(e.e.RASTER_URL_PREFIX).concat(i.path):"rasterarrays"===i.authority?i.path="/".concat(e.e.RASTERARRAYS_URL_PREFIX).concat(i.path):"3dtiles"===i.authority?i.path="/".concat(e.e.TILES3D_URL_PREFIX).concat(i.path):(i.path=i.path.replace(/^.+\/v4\//,"/"),i.path="/".concat(e.e.TILE_URL_VERSION).concat(i.path));const s=this._customAccessToken||function(e){for(const t of e){const e=t.match(/^access_token=(.*)$/);if(e)return e[1]}return null}(i.params)||e.e.ACCESS_TOKEN;return e.e.REQUIRE_ACCESS_TOKEN&&s&&this._skuToken&&i.params.push("sku=".concat(this._skuToken)),this._makeAPIURL(i,s)}canonicalizeTileURL(t,r){const n=C(t);if(!n.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!n.path.match(/\.[\w]+$/))return t;let i="mapbox://";n.path.match(/^\/raster\/v1\//)?i+="raster/".concat(n.path.replace("/".concat(e.e.RASTER_URL_PREFIX,"/"),"")):n.path.match(/^\/rasterarrays\/v1\//)?i+="rasterarrays/".concat(n.path.replace("/".concat(e.e.RASTERARRAYS_URL_PREFIX,"/"),"")):i+="tiles/".concat(n.path.replace("/".concat(e.e.TILE_URL_VERSION,"/"),""));let s=n.params;return r&&(s=s.filter(e=>!e.match(/^access_token=/))),s.length&&(i+="?".concat(s.join("&"))),i}canonicalizeTileset(t,r){const n=!!r&&e.h(r),i=[];for(const s of t.tiles||[])e.j(s)?i.push(this.canonicalizeTileURL(s,n)):i.push(s);return i}_makeAPIURL(t,r){const n="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",i=C(e.e.API_URL);if(t.protocol=i.protocol,t.authority=i.authority,"http"===t.protocol){const e=t.params.indexOf("secure");e>=0&&t.params.splice(e,1)}if("/"!==i.path&&(t.path="".concat(i.path).concat(t.path)),!e.e.REQUIRE_ACCESS_TOKEN)return E(t);if(r=r||e.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!r)throw new Error("An API access token is required to use Mapbox GL. ".concat(n));if("s"===r[0])throw new Error("Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ".concat(n))}return t.params=t.params.filter(e=>-1===e.indexOf("access_token")),t.params.push("access_token=".concat(r||"")),E(t)}}const A=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function C(e){const t=e.match(A);if(!t)throw new Error("Unable to parse URL object");return{protocol:t[1],authority:t[2],path:t[3]||"/",params:t[4]?t[4].split("&"):[]}}function E(e){const t=e.params.length?"?".concat(e.params.join("&")):"";return"".concat(e.protocol,"://").concat(e.authority).concat(e.path).concat(t)}const N="mapbox.eventData";function I(t){if(!t)return null;const r=t.split(".");if(!r||3!==r.length)return null;try{return JSON.parse(e.l(r[1]))}catch(e){return null}}class P{constructor(e){this.type=e,this.anonId=null,this.anonIdTimestamp=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(t){const r=I(e.e.ACCESS_TOKEN);let n="";return n=r&&r.u?e.f(r.u):e.e.ACCESS_TOKEN||"",t?"".concat(N,".").concat(t,":").concat(n):"".concat(N,":").concat(n)}fetchEventData(){const t=e.s("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),i=this.getStorageKey("uuidTimestamp");if(t)try{const e=localStorage.getItem(r);e&&(this.eventData=JSON.parse(e));const t=localStorage.getItem(n);t&&(this.anonId=t);const s=localStorage.getItem(i);s&&(this.anonIdTimestamp=Number(s));const o=Date.now()-864e5;(!this.anonIdTimestamp||this.anonIdTimestamp<o)&&this.refreshUUID()}catch(t){e.w("Unable to read from LocalStorage")}}refreshUUID(){this.anonId=e.u(),this.anonIdTimestamp=Date.now()}saveEventData(){const t=e.s("localStorage"),r=this.getStorageKey(),n=this.getStorageKey("uuid"),i=this.getStorageKey("uuidTimestamp"),s=this.anonId,o=this.anonIdTimestamp;if(t&&s)try{localStorage.setItem(n,s),Object.keys(this.eventData).length>=1&&localStorage.setItem(r,JSON.stringify(this.eventData)),o&&localStorage.setItem(i,o.toString())}catch(t){e.w("Unable to write to LocalStorage")}}processRequests(e){}postEvent(t,r,n,i){if(!e.e.EVENTS_URL)return;const s=C(e.e.EVENTS_URL);s.params.push("access_token=".concat(i||e.e.ACCESS_TOKEN||""));const o={event:this.type,created:new Date(t).toISOString()},a=r?Object.assign(o,r):o,l={url:E(s),headers:{"Content-Type":"text/plain"},body:JSON.stringify([a])};this.pendingRequest=e.p(l,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)})}queueRequest(e,t){this.queue.push(e),this.processRequests(t)}}class M extends P{constructor(e){super("metrics"),e&&(this.data=e)}postMetricsEvent(t){if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;this.anonId||this.fetchEventData(),e.v(this.anonId)||this.refreshUUID();const r=Object.assign({},this.data,{sessionId:this.anonId});this.queueRequest({timestamp:Date.now(),payload:r},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},e)}}const L=new class extends P{constructor(e){super("appUserTurnstile"),this._customAccessToken=e}postTurnstileEvent(t,r){e.e.EVENTS_URL&&e.e.ACCESS_TOKEN&&Array.isArray(t)&&t.some(t=>e.h(t)||e.j(t))&&this.queueRequest(Date.now(),r)}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;this.anonId&&this.anonIdTimestamp&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const n=I(e.e.ACCESS_TOKEN),i=n?n.u:e.e.ACCESS_TOKEN;let s=i!==this.eventData.tokenU;e.v(this.anonId)||(this.refreshUUID(),s=!0);const o=this.queue.shift();if(this.eventData.lastSuccess){const e=new Date(this.eventData.lastSuccess),t=new Date(o),r=(o-this.eventData.lastSuccess)/864e5;s=s||r>=1||r<-1||e.getDate()!==t.getDate()}else s=!0;s?this.postEvent(o,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:S,"enabled.telemetry":!1,userId:this.anonId},e=>{e||(this.eventData.lastSuccess=o,this.eventData.tokenU=i)},r):this.processRequests()}},R=L.postTurnstileEvent.bind(L),D=new class extends P{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(t,r,n,i){this.skuToken=r,this.errorCb=i,e.e.EVENTS_URL&&(n||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(T)))}processRequests(r){if(this.pendingRequest||0===this.queue.length)return;const{id:n,timestamp:i}=this.queue.shift();n&&this.success[n]||(this.anonId&&this.anonIdTimestamp||this.fetchEventData(),e.v(this.anonId)||this.refreshUUID(),this.postEvent(i,{sdkIdentifier:"mapbox-gl-js",sdkVersion:t,skuId:S,skuToken:this.skuToken,userId:this.anonId},e=>{e?this.errorCb(e):n&&(this.success[n]=!0)},r))}remove(){this.errorCb=null}},F=D.postMapLoadEvent.bind(D),O=new class extends P{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(t){let r=this.mapInstanceIdMap.get(t);return r||(r=e.u(),this.mapInstanceIdMap.set(t,r)),r}getEventId(e){const t=this.eventIdPerMapInstanceMap.get(e)||0;return this.eventIdPerMapInstanceMap.set(e,t+1),t}postStyleLoadEvent(t,r){const{map:n,style:i,importedStyles:s}=r;if(!e.e.EVENTS_URL||!t&&!e.e.ACCESS_TOKEN)return;const o=this.getMapInstanceId(n),a={mapInstanceId:o,eventId:this.getEventId(o),style:i};s.length&&(a.importedStyles=s),this.queueRequest({timestamp:Date.now(),payload:a},t)}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:t,payload:r}=this.queue.shift();this.postEvent(t,r,()=>{},e)}},z=O.postStyleLoadEvent.bind(O),B=new M({attributes:[{name:"maps/js/layer-animations/style-with-appearances"}]}),U=B.postMetricsEvent.bind(B),V=new M({attributes:[{name:"maps/js/layer-animations/runtime-appearances"}]}),q=V.postMetricsEvent.bind(V),W=new class extends P{constructor(){super("gljs.performance")}postPerformanceEvent(t,r){e.e.EVENTS_URL&&(t||e.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},t)}processRequests(n){if(this.pendingRequest||0===this.queue.length)return;const{timestamp:i,performanceData:s}=this.queue.shift(),o=function(n){const i=performance.getEntriesByType("resource"),s=performance.getEntriesByType("mark"),o=function(e){const t={};if(e)for(const r in e)if("other"!==r)for(const n of e[r]){const e="".concat(r,"ResolveRangeMin"),i="".concat(r,"ResolveRangeMax"),s="".concat(r,"RequestCount"),o="".concat(r,"RequestCachedCount");t[e]=Math.min(t[e]||1/0,n.startTime),t[i]=Math.max(t[i]||-1/0,n.responseEnd);const a=e=>{void 0===t[e]&&(t[e]=0),++t[e]};void 0!==n.transferSize&&0===n.transferSize&&a(o),a(s)}return t}(function(e,t){const r={};if(e)for(const n of e){const e=t(n);void 0===r[e]&&(r[e]=[]),r[e].push(n)}return r}(i,a)),l=window.devicePixelRatio,c=navigator.connection||navigator.mozConnection||navigator.webkitConnection,u=c?c.effectiveType:void 0,d={counters:[],metadata:[],attributes:[]},h=(e,t,r)=>{null!=r&&e.push({name:t,value:r.toString()})};for(const e in o)h(d.counters,e,o[e]);if(n.interactionRange[0]!==1/0&&n.interactionRange[1]!==-1/0&&(h(d.counters,"interactionRangeMin",n.interactionRange[0]),h(d.counters,"interactionRangeMax",n.interactionRange[1])),s)for(const e of Object.values(r)){const t=s.find(t=>t.name===e);t&&h(d.counters,e,t.startTime)}return h(d.counters,"visibilityHidden",n.visibilityHidden),h(d.attributes,"style",function(t){if(t)for(const r of t){const t=r.name.split("?")[0];if(e.i(t)){const e=t.split("/").slice(-2);if(2===e.length)return"mapbox://styles/".concat(e[0],"/").concat(e[1])}}}(i)),h(d.attributes,"terrainEnabled",n.terrainEnabled?"true":"false"),h(d.attributes,"fogEnabled",n.fogEnabled?"true":"false"),h(d.attributes,"projection",n.projection),h(d.attributes,"zoom",n.zoom),h(d.metadata,"devicePixelRatio",l),h(d.metadata,"connectionEffectiveType",u),h(d.metadata,"navigatorUserAgent",navigator.userAgent),h(d.metadata,"screenWidth",window.screen.width),h(d.metadata,"screenHeight",window.screen.height),h(d.metadata,"windowWidth",window.innerWidth),h(d.metadata,"windowHeight",window.innerHeight),h(d.metadata,"mapWidth",n.width/l),h(d.metadata,"mapHeight",n.height/l),h(d.metadata,"webglRenderer",n.renderer),h(d.metadata,"webglVendor",n.vendor),h(d.metadata,"sdkVersion",t),h(d.metadata,"sdkIdentifier","mapbox-gl-js"),d}(s);for(const e of o.metadata);for(const e of o.counters);for(const e of o.attributes);this.postEvent(i,o,()=>{},n)}},H=W.postPerformanceEvent.bind(W),G=new class extends P{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(t,r,n,i){if(!e.e.API_URL||!e.e.SESSION_PATH)return;const s=C(e.e.API_URL+e.e.SESSION_PATH);s.params.push("sku=".concat(r||"")),s.params.push("access_token=".concat(i||e.e.ACCESS_TOKEN||""));const o={url:E(s),headers:{"Content-Type":"text/plain"}};this.pendingRequest=e.g(o,e=>{this.pendingRequest=null,n(e),this.saveEventData(),this.processRequests(i)})}getSessionAPI(t,r,n,i){this.skuToken=r,this.errorCb=i,e.e.SESSION_PATH&&e.e.API_URL&&(n||e.e.ACCESS_TOKEN?this.queueRequest({id:t,timestamp:Date.now()},n):this.errorCb(new Error(T)))}processRequests(e){if(this.pendingRequest||0===this.queue.length)return;const{id:t,timestamp:r}=this.queue.shift();t&&this.success[t]||this.getSession(r,this.skuToken,e=>{e?this.errorCb(e):t&&(this.success[t]=!0)},e)}remove(){this.errorCb=null}},Z=G.getSessionAPI.bind(G),K=new Set;function Y(e,t){t?K.add(e):K.delete(e)}class X{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(e,t){this._updatedSourceCaches[e]=t,this.setDirty()}discardSourceCacheUpdate(e){delete this._updatedSourceCaches[e]}updateLayer(e){const t=e.scope;this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._updatedLayers[t].add(e.id),this.setDirty()}removeLayer(e){const t=e.scope;this._removedLayers[t]=this._removedLayers[t]||{},this._updatedLayers[t]=this._updatedLayers[t]||new Set,this._removedLayers[t][e.id]=e,this._updatedLayers[t].delete(e.id),this._updatedPaintProps.delete(e.fqid),this.setDirty()}getRemovedLayer(e){return this._removedLayers[e.scope]?this._removedLayers[e.scope][e.id]:null}discardLayerRemoval(e){this._removedLayers[e.scope]&&delete this._removedLayers[e.scope][e.id]}getLayerUpdatesByScope(){const e={};for(const t in this._updatedLayers)e[t]=e[t]||{},e[t].updatedIds=Array.from(this._updatedLayers[t].values());for(const t in this._removedLayers)e[t]=e[t]||{},e[t].removedIds=Object.keys(this._removedLayers[t]);return e}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(e){this._updatedPaintProps.add(e.fqid),this.setDirty()}getUpdatedImages(e){return this._updatedImages[e]?Array.from(this._updatedImages[e].values()):[]}updateImage(t,r){this._updatedImages[r]=this._updatedImages[r]||new Set,this._updatedImages[r].add(e.I.toString(t)),this.setDirty()}resetUpdatedImages(e){this._updatedImages[e]&&this._updatedImages[e].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function J(e){const{userImage:t}=e;return!!(t&&t.render&&t.render())&&(e.data.replace(new Uint8Array(t.data.buffer)),!0)}class Q extends e.E{constructor(t){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=t,"raster"!==t&&e.r()&&(this.imageRasterizerDispatcher=new e.D(e.t(),this,"Image Rasterizer Worker",1))}addScope(t){this.loaded.set(t,!1),this.imageProviders.set(t,new Map),this.images.set(t,new Map),this.updatedImages.set(t,new Set),this.callbackDispatchedThisFrame.set(t,new Set),this.patterns.set(t,new Map),this.atlasImage.set(t,new e.q({width:1,height:1}))}removeScope(e){this.loaded.delete(e),this.imageProviders.delete(e),this.images.delete(e),this.updatedImages.delete(e),this.callbackDispatchedThisFrame.delete(e),this.patterns.delete(e),this.atlasImage.delete(e);const t=this.atlasTexture.get(e);t&&(t.destroy(),this.atlasTexture.delete(e))}addImageProvider(e,t){this.imageProviders.has(t)||this.imageProviders.set(t,new Map),this.imageProviders.get(t).set(e.id,e)}removeImageProvider(e,t){this.imageProviders.has(t)&&this.imageProviders.get(t).delete(e)}getPendingImageProviders(){const e=[];for(const t of this.imageProviders.values())for(const r of t.values())r.hasPendingRequests()&&e.push(r);return e}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new e.x),this._imageRasterizer}isLoaded(){for(const e of this.loaded.keys())if(!this.loaded.get(e))return!1;return!0}setLoaded(e,t){if(this.loaded.get(t)!==e&&(this.loaded.set(t,e),e)){for(const{ids:e,callback:r}of this.requestors)this._notify(e,t,r);this.requestors=[]}}hasImage(e,t){return!!this.getImage(e,t)}getImage(e,t){return this.images.get(t).get(e.toString())}addImage(e,t,r){this._validate(e,r)&&this.images.get(t).set(e.toString(),r)}_validate(t,r){let n=!0;return this._validateStretch(r.stretchX,r.data&&r.data.width)||(this.fire(new e.y(new Error('Image "'.concat(t.name,'" has invalid "stretchX" value')))),n=!1),this._validateStretch(r.stretchY,r.data&&r.data.height)||(this.fire(new e.y(new Error('Image "'.concat(t.name,'" has invalid "stretchY" value')))),n=!1),this._validateContent(r.content,r)||(this.fire(new e.y(new Error('Image "'.concat(t.name,'" has invalid "content" value')))),n=!1),n}_validateStretch(e,t){if(!e)return!0;let r=0;for(const n of e){if(n[0]<r||n[1]<n[0]||t<n[1])return!1;r=n[1]}return!0}_validateContent(e,t){if(!e)return!0;if(4!==e.length)return!1;if(!t.usvg){if(e[0]<0||t.data.width<e[0])return!1;if(e[1]<0||t.data.height<e[1])return!1;if(e[2]<0||t.data.width<e[2])return!1;if(e[3]<0||t.data.height<e[3])return!1}return!(e[2]<e[0]||e[3]<e[1])}updateImage(e,t,r){const n=this.images.get(t).get(e.toString());r.version=n.version+1,this.images.get(t).set(e.toString(),r),this.updatedImages.get(t).add(e),this.removeFromImageRasterizerCache(e,t)}clearUpdatedImages(e){this.updatedImages.get(e).clear()}removeFromImageRasterizerCache(t,r){"raster"!==this.spriteFormat&&(e.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[t],scope:r}):this.imageRasterizer.removeImagesFromCacheByIds([t],r))}removeImage(e,t){const r=this.images.get(t),n=r.get(e.toString());r.delete(e.toString()),this.patterns.get(t).delete(e.toString()),this.removeFromImageRasterizerCache(e,t),n.userImage&&n.userImage.onRemove&&n.userImage.onRemove()}listImages(t){return Array.from(this.images.get(t).keys()).map(t=>e.I.from(t))}getImages(e,t,r){const n=[],i=[],s=this.imageProviders.get(t);for(const c of e){if(!c.iconsetId){n.push(c);continue}const e=s.get(c.iconsetId);e&&(this.getImage(c,t)?i.push(c):e.addPendingRequest(c))}if(0===n.length)return void this._notify(i,t,r);let o=!0;const a=!!this.loaded.get(t),l=this.images.get(t);if(!a)for(const c of n)l.has(c.toString())||(o=!1);a||o?this._notify(n,t,r):this.requestors.push({ids:n,scope:t,callback:r})}rasterizeImages(e,t){const r=new Map,{tasks:n,scope:i}=e;for(const[s,o]of n.entries()){const e=this.getImage(o.id,i);e&&r.set(s,{image:e,imageVariant:o})}this._rasterizeImages(i,r,t)}_rasterizeImages(t,r,n){if(e.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:r,scope:t},n);else{const e=new Map;for(const[n,{image:i,imageVariant:s}]of r.entries())e.set(n,this.imageRasterizer.rasterize(s,i,t,0));n(void 0,e)}}getUpdatedImages(e){return this.updatedImages.get(e)||new Set}_notify(t,r,n){const i=this.images.get(r),s=new Map;for(const o of t){if(!i.get(o.toString())){if(o.iconsetId)continue;this.fire(new e.z("styleimagemissing",{id:o.name}))}const t=i.get(o.toString());if(!t){e.w('Image "'.concat(o.name,'" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.'));continue}const r={data:t.usvg?null:t.data.clone(),pixelRatio:t.pixelRatio,sdf:t.sdf,usvg:t.usvg,version:t.version,stretchX:t.stretchX,stretchY:t.stretchY,content:t.content,hasRenderCallback:Boolean(t.userImage&&t.userImage.render)};t.usvg&&Object.assign(r,{width:t.icon.usvg_tree.width,height:t.icon.usvg_tree.height}),s.set(e.I.toString(o),r)}n(null,s)}getPixelSize(e){const{width:t,height:r}=this.atlasImage.get(e);return{width:t,height:r}}getPattern(t,r,n){const i=t.toString(),s=this.patterns.get(r),o=s.get(i),a=this.getImage(t,r);if(!a)return null;if(o){if(o.position.version===a.version)return o.position;o.position.version=a.version}else{if(a.usvg&&!a.data){const s=this.getPatternInFlightId(i,r);if(this.patternsInFlight.has(s))return null;this.patternsInFlight.add(s);const o=new e.A(t).scaleSelf(e.o.devicePixelRatio),l=new Map([[o.toString(),{image:a,imageVariant:o}]]);return this._rasterizeImages(r,l,(e,t)=>this.storePatternImage(o,r,a,n,t)),null}this.storePattern(t,r,a)}return this._updatePatternAtlas(r,n),s.get(i).position}getPatternInFlightId(t,r){return e.B(t,r)}hasPatternsInFlight(){return 0!==this.patternsInFlight.size}storePatternImage(e,t,r,n,i){const s=e.toString(),o=i?i.get(s):void 0;o&&(r.data=o,this.storePattern(e.id,t,r),this._updatePatternAtlas(t,n),this.patternsInFlight.delete(this.getPatternInFlightId(e.id.toString(),t)))}storePattern(t,r,n){const i={w:n.data.width+2*e.C,h:n.data.height+2*e.C,x:0,y:0},s=new e.F(i,n,e.C);this.patterns.get(r).set(t.toString(),{bin:i,position:s})}destroyAtlasTextures(){for(const e of this.atlasTexture.values())e&&e.destroy();this.atlasTexture.clear()}bind(t,r){const n=t.gl;let i=this.atlasTexture.get(r);i?this.dirty&&(i.update(this.atlasImage.get(r)),this.dirty=!1):(i=new e.T(t,this.atlasImage.get(r),n.RGBA8),this.atlasTexture.set(r,i)),i.bind(n.LINEAR,n.CLAMP_TO_EDGE)}_updatePatternAtlas(t,r){const n=this.patterns.get(t),i=Array.from(n.values()).map(e=>{let{bin:t}=e;return t}),{w:s,h:o}=e.G(i),a=this.atlasImage.get(t);a.resize({width:s||1,height:o||1});const l=this.images.get(t);for(const[c,{bin:u,position:d}]of n.entries()){let t=d.padding;const n=u.x+t,i=u.y+t,s=l.get(c).data,o=s.width,h=s.height;t=t>1?t-1:t,e.q.copy(s,a,{x:0,y:0},{x:n,y:i},{width:o,height:h},r),e.q.copy(s,a,{x:0,y:h-t},{x:n,y:i-t},{width:o,height:t},r),e.q.copy(s,a,{x:0,y:0},{x:n,y:i+h},{width:o,height:t},r),e.q.copy(s,a,{x:o-t,y:0},{x:n-t,y:i},{width:t,height:h},r),e.q.copy(s,a,{x:0,y:0},{x:n+o,y:i},{width:t,height:h},r),e.q.copy(s,a,{x:o-t,y:h-t},{x:n-t,y:i-t},{width:t,height:t},r),e.q.copy(s,a,{x:0,y:h-t},{x:n+o,y:i-t},{width:t,height:t},r),e.q.copy(s,a,{x:0,y:0},{x:n+o,y:i+h},{width:t,height:t},r),e.q.copy(s,a,{x:o-t,y:0},{x:n-t,y:i+h},{width:t,height:t},r)}this.dirty=!0}beginFrame(){for(const e of this.images.keys())this.callbackDispatchedThisFrame.set(e,new Set)}dispatchRenderCallbacks(e,t){const r=this.images.get(t);for(const n of e){if(this.callbackDispatchedThisFrame.get(t).has(n.toString()))continue;this.callbackDispatchedThisFrame.get(t).add(n.toString());const e=r.get(n.toString());J(e)&&this.updateImage(n,t,e)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function $(t){const r=t.value,n=t.valueSpec,i=t.style,s=t.styleSpec,o=t.key,a=t.arrayElementValidator||be;if(!Array.isArray(r))return[new e.V(o,r,"array expected, ".concat(e.K(r)," found"))];if(n.length&&r.length!==n.length)return[new e.V(o,r,"array length ".concat(n.length," expected, length ").concat(r.length," found"))];if(n["min-length"]&&r.length<n["min-length"])return[new e.V(o,r,"array length at least ".concat(n["min-length"]," expected, length ").concat(r.length," found"))];let l={type:n.value,values:n.values,minimum:n.minimum,maximum:n.maximum,function:void 0};s.$version<7&&(l.function=n.function),e.H(n.value)&&(l=n.value);let c=[];for(let e=0;e<r.length;e++)c=c.concat(a({array:r,arrayIndex:e,value:r[e],valueSpec:l,style:i,styleSpec:s,key:"".concat(o,"[").concat(e,"]")},!0));return c}function ee(t){const r=t.key,n=t.value,i=t.valueSpec;if(!e.L(n))return[new e.V(r,n,"number expected, ".concat(e.K(n)," found"))];if(n!=n)return[new e.V(r,n,"number expected, NaN found")];if("minimum"in i){let s=i.minimum;if(Array.isArray(i.minimum)&&(s=i.minimum[t.arrayIndex]),n<s)return[new e.V(r,n,"".concat(n," is less than the minimum value ").concat(s))]}if("maximum"in i){let s=i.maximum;if(Array.isArray(i.maximum)&&(s=i.maximum[t.arrayIndex]),n>s)return[new e.V(r,n,"".concat(n," is greater than the maximum value ").concat(s))]}return[]}function te(t){const r=t.key,n=t.value;if(!e.H(n))return[new e.V(r,n,"object expected, ".concat(e.K(n)," found"))];const i=t.valueSpec,s=e.J(n.type);let o,a,l,c={};const u="categorical"!==s&&void 0===n.property,d=!u,h=function(t){const r=t.stops;return Array.isArray(r)&&Array.isArray(r[0])&&e.H(r[0][0])}(n),p=we({key:t.key,value:t.value,valueSpec:t.styleSpec.function,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{stops:function(t){if("identity"===s)return[new e.V(t.key,t.value,'identity function may not have a "stops" property')];let r=[];const n=t.value;return r=r.concat($({key:t.key,value:n,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:m})),Array.isArray(n)&&0===n.length&&r.push(new e.V(t.key,n,"array must have at least one stop")),r},default:function(e){return be({key:e.key,value:e.value,valueSpec:i,style:e.style,styleSpec:e.styleSpec})}}});return"identity"===s&&u&&p.push(new e.V(t.key,t.value,'missing required property "property"')),"identity"===s||n.stops||p.push(new e.V(t.key,t.value,'missing required property "stops"')),"exponential"===s&&i.expression&&!e.M(i)&&p.push(new e.V(t.key,t.value,"exponential functions not supported")),t.styleSpec.$version>=8&&(d&&!e.N(i)?p.push(new e.V(t.key,t.value,"property functions not supported")):u&&!e.O(i)&&p.push(new e.V(t.key,t.value,"zoom functions not supported"))),"categorical"!==s&&!h||void 0!==n.property||p.push(new e.V(t.key,t.value,'"property" property is required')),p;function m(t){let r=[];const n=t.value,s=t.key;if(!Array.isArray(n))return[new e.V(s,n,"array expected, ".concat(e.K(n)," found"))];if(2!==n.length)return[new e.V(s,n,"array length 2 expected, length ".concat(n.length," found"))];if(h){if(!e.H(n[0]))return[new e.V(s,n,"object expected, ".concat(e.K(n[0])," found"))];const i=n[0];if(void 0===i.zoom)return[new e.V(s,n,"object stop key must have zoom")];if(void 0===i.value)return[new e.V(s,n,"object stop key must have value")];const o=e.J(i.zoom);if("number"!=typeof o)return[new e.V(s,i.zoom,"stop zoom values must be numbers")];if(l&&l>o)return[new e.V(s,i.zoom,"stop zoom values must appear in ascending order")];o!==l&&(l=o,a=void 0,c={}),r=r.concat(we({key:"".concat(s,"[0]"),value:n[0],valueSpec:{zoom:{}},style:t.style,styleSpec:t.styleSpec,objectElementValidators:{zoom:ee,value:f}}))}else r=r.concat(f({key:"".concat(s,"[0]"),value:n[0],style:t.style,styleSpec:t.styleSpec},n));return e.Q(e.S(n[1]))?r.concat([new e.V("".concat(s,"[1]"),n[1],"expressions are not allowed in function stops.")]):r.concat(be({key:"".concat(s,"[1]"),value:n[1],valueSpec:i,style:t.style,styleSpec:t.styleSpec}))}function f(t,r){const n=e.K(t.value),l=e.J(t.value),u=null!==t.value?t.value:r;if(o){if(n!==o)return[new e.V(t.key,u,"".concat(n," stop domain type must match previous stop domain type ").concat(o))]}else o=n;if("number"!==n&&"string"!==n&&"boolean"!==n&&"number"!=typeof l&&"string"!=typeof l&&"boolean"!=typeof l)return[new e.V(t.key,u,"stop domain value must be a number, string, or boolean")];if("number"!==n&&"categorical"!==s){let r="number expected, ".concat(n," found");return e.N(i)&&void 0===s&&(r+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new e.V(t.key,u,r)]}return"categorical"!==s||"number"!==n||"number"==typeof l&&isFinite(l)&&Math.floor(l)===l?"categorical"!==s&&"number"===n&&"number"==typeof l&&"number"==typeof a&&void 0!==a&&l<a?[new e.V(t.key,u,"stop domain values must appear in ascending order")]:(a=l,"categorical"===s&&l in c?[new e.V(t.key,u,"stop domain values must be unique")]:(c[l]=!0,[])):[new e.V(t.key,u,"integer expected, found ".concat(String(l)))]}}function re(t){const r=("property"===t.expressionContext?e.W:e.U)(e.S(t.value),t.valueSpec);if("error"===r.result)return r.value.map(r=>new e.V("".concat(t.key).concat(r.key),t.value,r.message));const n=r.value.expression||r.value._styleExpression.expression;if("property"===t.expressionContext&&"text-font"===t.propertyKey&&!n.outputDefined())return[new e.V(t.key,t.value,'Invalid data expression for "'.concat(t.propertyKey,'". Output values must be contained as literals within the expression.'))];if("property"===t.expressionContext&&"layout"===t.propertyType&&!e.Z(n))return[new e.V(t.key,t.value,'"feature-state" data expressions are not supported with layout properties.')];if("filter"===t.expressionContext)return ne(n,t);if("appearance"===t.expressionContext)return ie(n,t);if(t.expressionContext&&0===t.expressionContext.indexOf("cluster")){if(!e.X(n,["zoom","feature-state"]))return[new e.V(t.key,t.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if("cluster-initial"===t.expressionContext&&!e.Y(n))return[new e.V(t.key,t.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function ne(t,r){const n=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)n.delete(e);if(0===n.size)return[];const i=[];return t instanceof e._&&n.has(t.name)?[new e.V(r.key,r.value,'["'.concat(t.name,'"] expression is not supported in a filter for a ').concat(r.object.type," layer with id: ").concat(r.object.id))]:(t.eachChild(e=>{i.push(...ne(e,r))}),i)}function ie(t,r){const n=new Set;if(r.valueSpec&&r.valueSpec.expression)for(const e of r.valueSpec.expression.parameters)n.add(e);if(0===n.size)return[];const i=[];return t instanceof e._&&!n.has(t.name)?[new e.V(r.key,r.value,'["'.concat(t.name,'"] is not an allowed parameter'))]:(t.eachChild(e=>{i.push(...ie(e,r))}),i)}function se(t){const r=t.key,n=t.value,i=t.valueSpec,s=[];return Array.isArray(i.values)?-1===i.values.indexOf(e.J(n))&&s.push(new e.V(r,n,"expected one of [".concat(i.values.join(", "),"], ").concat(JSON.stringify(n)," found"))):-1===Object.keys(i.values).indexOf(e.J(n))&&s.push(new e.V(r,n,"expected one of [".concat(Object.keys(i.values).join(", "),"], ").concat(JSON.stringify(n)," found"))),s}function oe(t){return e.a2(e.S(t.value))?re(Object.assign({},t,{expressionContext:"filter",valueSpec:t.styleSpec["filter_".concat(t.layerType||"fill")]})):ae(t)}function ae(t){const r=t.value,n=t.key;if(!Array.isArray(r))return[new e.V(n,r,"array expected, ".concat(e.K(r)," found"))];if(r.length<1)return[new e.V(n,r,"filter array must have at least 1 element")];const i=t.styleSpec;let s=se({key:"".concat(n,"[0]"),value:r[0],valueSpec:i.filter_operator});const o=()=>{r.length>=2&&(e.a0(r[1])||s.push(new e.V("".concat(n,"[1]"),r[1],"string expected, ".concat(e.K(r[1])," found"))));for(let t=2;t<r.length;t++)"$type"===e.J(r[1])?s=s.concat(se({key:"".concat(n,"[").concat(t,"]"),value:r[t],valueSpec:i.geometry_type})):e.a0(r[t])||e.L(r[t])||e.$(r[t])||s.push(new e.V("".concat(n,"[").concat(t,"]"),r[t],"string, number, or boolean expected, ".concat(e.K(r[t])," found.")))};switch(e.J(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&"$type"===e.J(r[1])&&s.push(new e.V(n,r,'"$type" cannot be use with operator "'.concat(r[0],'"'))),3!==r.length&&s.push(new e.V(n,r,'filter array for operator "'.concat(r[0],'" must have 3 elements'))),o();break;case"==":case"!=":3!==r.length&&s.push(new e.V(n,r,'filter array for operator "'.concat(r[0],'" must have 3 elements'))),o();break;case"in":case"!in":o();break;case"any":case"all":case"none":for(let e=1;e<r.length;e++)s=s.concat(ae({key:"".concat(n,"[").concat(e,"]"),value:r[e],style:t.style,styleSpec:t.styleSpec}));break;case"has":case"!has":2!==r.length?s.push(new e.V(n,r,'filter array for "'.concat(r[0],'" operator must have 2 elements'))):e.a0(r[1])||s.push(new e.V("".concat(n,"[1]"),r[1],"string expected, ".concat(e.K(r[1])," found")))}return s}function le(t,r){const n=t.key,i=t.style,s=t.layer,o=t.styleSpec,a=t.value,l=t.objectKey,c=o["".concat(r,"_").concat(t.layerType)];if(!c)return[];const u=l.match(/^(.*)-use-theme$/);if(u&&c[u[1]])return e.Q(e.S(a))?[].concat(be({key:n,value:a,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:i,styleSpec:o,expressionContext:"property",propertyType:r,propertyKey:l})):be({key:n,value:a,valueSpec:{type:"string"},style:i,styleSpec:o});const d=l.match(/^(.*)-transition$/);if("paint"===r&&d&&c[d[1]]&&c[d[1]].transition)return be({key:n,value:a,valueSpec:o.transition,style:i,styleSpec:o});const h=t.valueSpec||c[l];if(!h)return[new e.a3(n,a,'unknown property "'.concat(l,'"'))];let p;if(e.a0(a)&&e.N(h)&&!h.tokens&&(p=/^{([^}]+)}$/.exec(a))){const t='`{ "type": "identity", "property": '.concat(p?JSON.stringify(p[1]):'"_"'," }`");return[new e.V(n,a,'"'.concat(l,'" does not support interpolation syntax\nUse an identity property function instead: ').concat(t,"."))]}const m=[];if("symbol"===t.layerType)"text-field"!==l||!i||i.glyphs||i.imports||m.push(new e.V(n,a,'use of "text-field" requires a style "glyphs" property')),"text-font"===l&&e.a4(e.S(a))&&"identity"===e.J(a.type)&&m.push(new e.V(n,a,'"text-font" does not support identity functions'));else if("model"===t.layerType&&"paint"===r&&s&&s.layout&&s.layout.hasOwnProperty("model-id")&&e.N(h)&&(e.a5(h)||e.O(h))){const t=e.W(e.S(a),h).value,r="expression"in t&&t.expression||"_styleExpression"in t&&t._styleExpression&&t._styleExpression.expression;r&&!e.X(r,["measure-light"])&&("model-emissive-strength"===l&&e.Y(r)&&e.Z(r)||m.push(new e.V(n,a,"".concat(l," does not support measure-light expressions when the model layer source is vector tile or GeoJSON."))))}return m.concat(be({key:t.key,value:a,valueSpec:h,style:i,styleSpec:o,expressionContext:"property",propertyType:r,propertyKey:l}))}function ce(e){return le(e,"paint")}function ue(e){return le(e,"layout")}function de(t){let r=[];const n=t.value,i=t.key,s=t.style,o=t.styleSpec;if(!e.H(n))return[new e.V(i,n,"object expected")];n.type||n.ref||r.push(new e.V(i,n,'either "type" or "ref" is required'));let a=e.J(n.type);const l=e.J(n.ref);if(n.id){const o=e.J(n.id);for(let a=0;a<t.arrayIndex;a++){const t=s.layers[a];e.J(t.id)===o&&r.push(new e.V(i,n.id,'duplicate layer id "'.concat(o,'", previously used at line ').concat(t.id.__line__)))}}if("ref"in n){let t;["type","source","source-layer","filter","layout"].forEach(t=>{t in n&&r.push(new e.V(i,n[t],'"'.concat(t,'" is prohibited for ref layers')))}),s.layers.forEach(r=>{e.J(r.id)===l&&(t=r)}),t?t.ref?r.push(new e.V(i,n.ref,"ref cannot reference another ref layer")):a=e.J(t.type):"string"==typeof l&&r.push(new e.V(i,n.ref,'ref layer "'.concat(l,'" not found')))}else if("background"!==a&&"sky"!==a&&"slot"!==a)if(n.source)if(e.a0(n.source)){const t=s.sources&&s.sources[n.source],o=t&&e.J(t.type);t?"vector"===o&&"raster"===a?r.push(new e.V(i,n.source,'layer "'.concat(n.id,'" requires a raster source'))):"raster"===o&&"raster"!==a?r.push(new e.V(i,n.source,'layer "'.concat(n.id,'" requires a vector source'))):"vector"!==o||n["source-layer"]?"raster-dem"===o&&"hillshade"!==a?r.push(new e.V(i,n.source,"raster-dem source can only be used with layer type 'hillshade'.")):"raster-array"!==o||["raster","raster-particle"].includes(a)?"line"===a&&n.paint&&(n.paint["line-gradient"]||n.paint["line-trim-offset"])&&"geojson"===o&&!t.lineMetrics?r.push(new e.V(i,n,'layer "'.concat(n.id,'" specifies a line-gradient, which requires the GeoJSON source to have `lineMetrics` enabled.'))):"raster-particle"===a&&"raster-array"!==o&&r.push(new e.V(i,n.source,'layer "'.concat(n.id,"\" requires a 'raster-array' source."))):r.push(new e.V(i,n.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new e.V(i,n,'layer "'.concat(n.id,'" must specify a "source-layer"'))):r.push(new e.V(i,n.source,'source "'.concat(n.source,'" not found')))}else r.push(new e.V("".concat(i,".source"),n.source,'"source" must be a string'));else r.push(new e.V(i,n,'missing required property "source"'));return r=r.concat(we({key:i,value:n,valueSpec:o.layer,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{"*":()=>[],type:()=>be({key:"".concat(i,".type"),value:n.type,valueSpec:o.layer.type,style:t.style,styleSpec:t.styleSpec,object:n,objectKey:"type"}),filter:e=>oe(Object.assign({layerType:a},e)),layout:e=>we({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ue(Object.assign({layerType:a},e))}}),paint:e=>we({layer:n,key:e.key,value:e.value,valueSpec:{},style:e.style,styleSpec:e.styleSpec,objectElementValidators:{"*":e=>ce(Object.assign({layerType:a,layer:n},e))}}),appearances(t){const r=$({key:t.key,value:t.value,valueSpec:t.valueSpec,style:t.style,styleSpec:t.styleSpec,arrayElementValidator:t=>function(t){const{key:r,layer:n,layerType:i}=t,s=e.J(t.value),o=e.J(s.name),a=e.J(s.condition),l=we({key:r,value:s,valueSpec:t.styleSpec.appearance,style:t.style,styleSpec:t.styleSpec,objectElementValidators:{condition:t=>function(t){const r=[];return r.push(...re({key:t.key,value:t.object.condition,valueSpec:e.a6.appearance.condition,expressionContext:"appearance"})),r}(Object.assign({layer:n,layerType:i},t)),properties:t=>function(t){const r=[],{styleSpec:n,layer:i,layerType:s}=t,o=n["paint_".concat(s)],a=n["layout_".concat(s)],l=t.object[t.objectKey];for(const c in l){const n=c in o?"paint":c in a?"layout":void 0;if(!n){r.push(new e.V(t.key,c,'unknown property "'.concat(c,'" for layer type "').concat(s,'"')));continue}const u=Object.assign({},t,{key:"".concat(t.key,".").concat(c),object:l,objectKey:c,layer:i,layerType:s,value:l[c],valueSpec:"paint"===n?o[c]:a[c]});r.push(...le(u,n))}return r}(Object.assign({layer:n,layerType:i},t))}});return"hidden"!==o&&void 0===a&&l.push(new e.V(t.key,"name",'Appearance with name different than "hidden" must have a condition')),l}(Object.assign({layerType:a,layer:n},t))}),i=Array.isArray(t.value)?t.value:[],s=new Set;return i.forEach((i,o)=>{const a=e.J(i.name);if(a)if(s.has(a)){const i=e.J(n.id);r.push(new e.V(t.key,a,'Duplicated appearance name "'.concat(a,'" for layer "').concat(i,'"')))}else s.add(a)}),r}}})),r}function he(t){let{key:r,value:n}=t;return e.a0(n)?[]:[new e.V(r,n,"string expected, ".concat(e.K(n)," found"))]}const pe={promoteId:function t(r){let{key:n,value:i}=r;if(e.a0(i))return he({key:n,value:i});if(Array.isArray(i)){const t=[],r=e.S(i),s=e.U(r);return"error"===s.result&&s.value.forEach(r=>{t.push(new e.V("".concat(n).concat(r.key),null,"".concat(r.message)))}),e.X(s.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||t.push(new e.V("".concat(n),null,"promoteId expression should be only feature dependent")),t}if(!e.H(i))return[new e.V(n,i,'string, expression or object expected, "'.concat(e.K(i),'" found'))];const s=[];for(const e in i)s.push(...t({key:"".concat(n,".").concat(e),value:i[e]}));return s}};function me(t){const r=t.value,n=t.key,i=t.styleSpec,s=t.style;if(!e.H(r))return[new e.V(n,r,"object expected, ".concat(e.K(r)," found"))];if(!("type"in r))return[new e.V(n,r,'"type" is required')];const o=e.J(r.type);let a=[];switch(["vector","raster","raster-dem","raster-array"].includes(o)&&("url"in r||"tiles"in r||a.push(new e.a3(n,r,'Either "url" or "tiles" is required.'))),o){case"vector":case"raster":case"raster-dem":case"raster-array":return a=a.concat(we({key:n,value:r,valueSpec:i["source_".concat(o.replace("-","_"))],style:t.style,styleSpec:i,objectElementValidators:pe})),a;case"geojson":if(a=we({key:n,value:r,valueSpec:i.source_geojson,style:s,styleSpec:i,objectElementValidators:pe}),"cluster"in r&&"clusterProperties"in r){if(!e.H(r.clusterProperties))return[new e.V("".concat(n,".clusterProperties"),r,"object expected, ".concat(e.K(r)," found"))];for(const t in r.clusterProperties){const i=r.clusterProperties[t];if(!Array.isArray(i))return[new e.V("".concat(n,".clusterProperties.").concat(t),i,"array expected")];const[s,o]=i,l="string"==typeof s?[s,["accumulated"],["get",t]]:s;a.push(...re({key:"".concat(n,".").concat(t,".map"),value:o,expressionContext:"cluster-map"})),a.push(...re({key:"".concat(n,".").concat(t,".reduce"),value:l,expressionContext:"cluster-reduce"}))}}return a;case"video":return we({key:n,value:r,valueSpec:i.source_video,style:s,styleSpec:i});case"image":return we({key:n,value:r,valueSpec:i.source_image,style:s,styleSpec:i});case"canvas":return[new e.V(n,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return se({key:"".concat(n,".type"),value:r.type,valueSpec:{values:fe(i)}})}}function fe(e){return e.source.reduce((t,r)=>{const n=e[r];return"enum"===n.type.type&&(t=t.concat(Object.keys(n.type.values||{}))),t},[])}function ge(t){const r=t.value,n=t.styleSpec,i=n.light,s=t.style;if(void 0===r)return[];if(!e.H(r))return[new e.V("light",r,"object expected, ".concat(e.K(r)," found"))];let o=[];for(const a in r){const t=a.match(/^(.*)-transition$/),l=a.match(/^(.*)-use-theme$/);o=o.concat(l&&i[l[1]]?be({key:a,value:r[a],valueSpec:{type:"string"},style:s,styleSpec:n}):t&&i[t[1]]&&i[t[1]].transition?be({key:a,value:r[a],valueSpec:n.transition,style:s,styleSpec:n}):i[a]?be({key:a,value:r[a],valueSpec:i[a],style:s,styleSpec:n}):[new e.V(a,r[a],'unknown property "'.concat(a,'"'))])}return o}function ye(t){const r=t.value;if(!r)return[];const n=t.key;if(!e.H(r))return[new e.V(n,r,"object expected, ".concat(e.K(r)," found"))];let i=[];const s=t.styleSpec,o=s["light-3d"],a=t.style,l=t.style.lights;for(const d of["type","id"])if(!(d in r))return i=i.concat([new e.V(n,r,'missing property "'.concat(d,'"'))]),i;if(!e.a0(r.type))return i=i.concat([new e.V("".concat(n,".type"),r.type,"string expected")]),i;if(l)for(let d=0;d<t.arrayIndex;d++){const t=e.J(r.type),s=l[d];e.J(s.type)===t&&i.push(new e.V(n,r.id,'duplicate light type "'.concat(r.type,'", previously defined at line ').concat(s.id.__line__)))}const c="properties_light_".concat(r.type);if(!(c in s))return i=i.concat([new e.V("".concat(n,".type"),r,"Invalid light type ".concat(r.type))]),i;const u=s[c];for(const d in r)if("properties"===d){const n=r[d];if(!e.H(n))return i=i.concat([new e.V("properties",n,"object expected, ".concat(e.K(n)," found"))]),i;for(const o in n){const l=o.match(/^(.*)-transition$/),c=o.match(/^(.*)-use-theme$/);i=i.concat(c&&u[c[1]]?be({key:d,value:n[o],valueSpec:{type:"string"},style:a,styleSpec:s}):l&&u[l[1]]&&u[l[1]].transition?be({key:d,value:r[d],valueSpec:s.transition,style:a,styleSpec:s}):u[o]?be({key:o,value:n[o],valueSpec:u[o],style:a,styleSpec:s}):[new e.a3(t.key,n[o],'unknown property "'.concat(o,'"'))])}}else i=i.concat(o[d]?be({key:d,value:r[d],valueSpec:o[d],style:a,styleSpec:s}):[new e.a3(d,r[d],'unknown property "'.concat(d,'"'))]);return i}function _e(t){const r=t.value,n=t.key,i=t.style,s=t.styleSpec,o=s.terrain;if(null==r)return[];if(!e.H(r))return[new e.V("terrain",r,"object expected, ".concat(e.K(r)," found"))];let a=[];for(const l in r){const t=l.match(/^(.*)-transition$/),n=l.match(/^(.*)-use-theme$/);a=a.concat(n&&o[n[1]]?be({key:l,value:r[l],valueSpec:{type:"string"},style:i,styleSpec:s}):t&&o[t[1]]&&o[t[1]].transition?be({key:l,value:r[l],valueSpec:s.transition,style:i,styleSpec:s}):o[l]?be({key:l,value:r[l],valueSpec:o[l],style:i,styleSpec:s}):[new e.a3(l,r[l],'unknown property "'.concat(l,'"'))])}if(r.source)if(e.a0(r.source)){const t=i.sources&&i.sources[r.source],s=t&&e.J(t.type);t?"raster-dem"!==s&&a.push(new e.V("".concat(n,".source"),r.source,"terrain cannot be used with a source of type ".concat(s,', it only be used with a "raster-dem" source type'))):a.push(new e.V("".concat(n,".source"),r.source,'source "'.concat(r.source,'" not found')))}else a.push(new e.V("".concat(n,".source"),r.source,"source must be a string"));else a.push(new e.V(n,r,'terrain is missing required property "source"'));return a}function ve(t){const r=t.value,n=t.style,i=t.styleSpec,s=i.fog;if(void 0===r)return[];if(!e.H(r))return[new e.V("fog",r,"object expected, ".concat(e.K(r)," found"))];let o=[];for(const a in r){const t=a.match(/^(.*)-transition$/),l=a.match(/^(.*)-use-theme$/);o=o.concat(l&&s[l[1]]?be({key:a,value:r[a],valueSpec:{type:"string"},style:n,styleSpec:i}):t&&s[t[1]]&&s[t[1]].transition?be({key:a,value:r[a],valueSpec:i.transition,style:n,styleSpec:i}):s[a]?be({key:a,value:r[a],valueSpec:s[a],style:n,styleSpec:i}):[new e.a3(a,r[a],'unknown property "'.concat(a,'"'))])}return o}const xe={"*":()=>[],array:$,boolean:function(t){const r=t.value,n=t.key;return e.$(r)?[]:[new e.V(n,r,"boolean expected, ".concat(e.K(r)," found"))]},number:ee,color:function(t){let{key:r,value:n}=t;return e.a0(n)?null===e.a1.parseCSSColor(n)?[new e.V(r,n,'color expected, "'.concat(n,'" found'))]:[]:[new e.V(r,n,"color expected, ".concat(e.K(n)," found"))]},enum:se,filter:oe,function:te,layer:de,object:we,source:me,model:e.a7,light:ge,"light-3d":ye,terrain:_e,fog:ve,string:he,formatted:function(e){return 0===he(e).length?[]:re(e)},resolvedImage:function(e){return 0===he(e).length?[]:re(e)},projection:function(t){const r=t.value,n=t.styleSpec,i=n.projection,s=t.style;if(e.H(r)){let e=[];for(const t in r)e=e.concat(be({key:t,value:r[t],valueSpec:i[t],style:s,styleSpec:n}));return e}return e.a0(r)?[]:[new e.V("projection",r,"object or string expected, ".concat(e.K(r)," found"))]},import:function(t){const r=t.key,{value:s,styleSpec:o}=t;if(!e.H(s))return[new e.V(r,s,"import must be an object")];const{data:a}=s,l=n(s,i);Object.defineProperty(l,"__line__",{value:s.__line__,enumerable:!1});let c=we(Object.assign({},t,{value:l,valueSpec:o.import}));return""===e.J(l.id)&&c.push(new e.V("".concat(t.key,".id"),l,"import id can't be an empty string")),a&&(c=c.concat(Se(a,o,{key:"".concat(t.key,".data")}))),c},iconset:function(t){const r=t.value,n=t.key,i=t.styleSpec,s=t.style;if(!e.H(r))return[new e.V(n,r,"object expected")];if(!r.type)return[new e.V(n,r,'"type" is required')];const o=e.J(r.type);let a=[];if(a=a.concat(we({key:n,value:r,valueSpec:i["iconset_".concat(o)],style:s,styleSpec:i})),function(e,t){return!("source"!==e||!t.source)}(o,r)){const t=s.sources&&s.sources[r.source],i=t&&e.J(t.type);t?"raster-array"!==i&&a.push(new e.V(n,r.source,"iconset cannot be used with a source of type ".concat(String(i),', it only be used with a "raster-array" source type'))):a.push(new e.V(n,r.source,'source "'.concat(r.source,'" not found')))}return a}};function be(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=t.value,i=t.valueSpec,s=t.styleSpec;if(i.expression){if(e.a4(e.J(n)))return te(t);if(e.Q(e.S(n)))return re(t)}if(i.type&&xe[i.type]){const e=xe[i.type](t);return!0===r&&e.length>0&&Array.isArray(t.value)?re(t):e}return we(Object.assign({},t,{valueSpec:i.type?s[i.type]:i}))}function we(t){const r=t.key,n=t.value,i=t.valueSpec||{},s=t.objectElementValidators||{},o=t.style,a=t.styleSpec;if(!e.H(n))return[new e.V(r,n,"object expected, ".concat(e.K(n)," found"))];let l=[];for(const c in n){const t=c.split(".")[0];let u;s[t]?u=s[t]:i[t]?u=be:s["*"]?u=s["*"]:i["*"]&&(u=be),u?l=l.concat(u({key:(r?"".concat(r,"."):r)+c,value:n[c],valueSpec:i[t]||i["*"],style:o,styleSpec:a,object:n,objectKey:c},n)):l.push(new e.a3(r,n[c],'unknown property "'.concat(c,'"')))}for(const c in i){if(s[c])continue;const t=i[c];t.required&&void 0===t.default&&void 0===n[c]&&l.push(new e.V(r,n,'missing required property "'.concat(c,'"')))}return l}function je(t){let{key:r,value:n}=t;const i=he({key:r,value:n});if(i.length)return i;const s=n;return-1===s.indexOf("{fontstack}")&&i.push(new e.V(r,n,'"glyphs" url must include a "{fontstack}" token')),-1===s.indexOf("{range}")&&i.push(new e.V(r,n,'"glyphs" url must include a "{range}" token')),i}function Se(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a6;return we({key:(arguments.length>2&&void 0!==arguments[2]?arguments[2]:{}).key||"",value:t,valueSpec:Object.assign(r.$root,{"*":{type:"*"}}),styleSpec:r,style:t,objectElementValidators:{glyphs:je}})}function Te(t){return Oe(Se(t,arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.a6))}const ke=e=>Oe(me(e)),Ae=e=>Oe(ge(e)),Ce=e=>Oe(ye(e)),Ee=e=>Oe(_e(e)),Ne=e=>Oe(ve(e)),Ie=t=>Oe(function(t){const r=t.value,n=t.style,i=t.styleSpec,s=i.snow;if(void 0===r)return[];if(!e.H(r))return[new e.V("snow",r,"object expected, ".concat(e.K(r)," found"))];let o=[];for(const a in r){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&s[t[1]]&&s[t[1]].transition?be({key:a,value:r[a],valueSpec:i.transition,style:n,styleSpec:i}):s[a]?be({key:a,value:r[a],valueSpec:s[a],style:n,styleSpec:i}):[new e.a3(a,r[a],'unknown property "'.concat(a,'"'))])}return o}(t)),Pe=t=>Oe(function(t){const r=t.value,n=t.style,i=t.styleSpec,s=i.rain;if(void 0===r)return[];if(!e.H(r))return[new e.V("rain",r,"object expected, ".concat(e.K(r)," found"))];let o=[];for(const a in r){const t=a.match(/^(.*)-transition$/);o=o.concat(t&&s[t[1]]&&s[t[1]].transition?be({key:a,value:r[a],valueSpec:i.transition,style:n,styleSpec:i}):s[a]?be({key:a,value:r[a],valueSpec:s[a],style:n,styleSpec:i}):[new e.a3(a,r[a],'unknown property "'.concat(a,'"'))])}return o}(t)),Me=e=>Oe(de(e)),Le=e=>Oe(oe(e)),Re=e=>Oe(ce(e)),De=e=>Oe(ue(e)),Fe=t=>Oe(e.a7(t));function Oe(e){return e.slice().sort((e,t)=>e.line&&t.line?e.line-t.line:0)}function ze(t,r){let n=!1;if(r&&r.length)for(const i of r)i instanceof e.a3?e.w(i.message):(t.fire(new e.y(new Error(i.message))),n=!0);return n}const Be=e.a6.light;let Ue;class Ve extends e.E{constructor(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"flat";super(),this._transitionable=new e.a8(Ue||(Ue=new e.a9({anchor:new e.aa(Be.anchor),position:new e.ab(Be.position),color:new e.aa(Be.color),intensity:new e.aa(Be.intensity)}))),this.setLight(t,r),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._validate(Ae,e,r)||(this._transitionable.setTransitionOrValue(e),this.id=t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Te,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}}const qe=e.a6.terrain;let We=class extends e.E{constructor(t,r,n,i,s){super(),this.scope=n,this._transitionable=new e.a8(new e.a9({source:new e.aa(qe.source),exaggeration:new e.aa(qe.exaggeration)}),n,i),this._transitionable.setTransitionOrValue(t,i),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=s}get(){return this._transitionable.serialize()}set(e,t){this._transitionable.setTransitionOrValue(e,t)}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}getExaggeration(t){return this._transitioning.possiblyEvaluate(new e.ac(t,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const t=this._transitionable._values.exaggeration;if(!t)return null;const r=t.value.expression;if(!r)return null;let n=-1,i=-1,s=1;for(const o of r.zoomStops)s=r.evaluate(new e.ac(o,{worldview:this.worldview})),s>.01?(n=o,i=-1):i=o;return s<.01&&n>0&&i>n?[n,i]:null}isZoomDependent(){const t=this._transitionable._values.exaggeration;return null!=t&&null!=t.value&&null!=t.value.expression&&t.value.expression instanceof e.ad}};const He=45,Ge=65,Ze=.05;function Ke(t,r,n,i){const s=e.ah(He,Ge,n),[o,a]=Ye(t,i);let l=1-Math.min(1,Math.exp((r-o)/(a-o)*-6));return l*=l*l,l=Math.min(1,1.00747*l),l*s*t.alpha}function Ye(e,t){const r=.5/Math.tan(.5*t);return[e.range[0]+r,e.range[1]+r]}function Xe(t,r,n,i,s){const o=e.af([],[r,n,i],s.mercatorFogMatrix);return Ke(t,e.ag(o),s.pitch,s._fov)}function Je(t,r,n,i,s,o,a){const l=[[n,i,0],[s,i,0],[s,o,0],[n,o,0]];let c=Number.MAX_VALUE,u=-Number.MAX_VALUE;for(const d of l){const t=e.af([],d,r),n=e.ag(t);c=Math.min(c,n),u=Math.max(u,n)}return[Ke(t,c,a.pitch,a._fov),Ke(t,u,a.pitch,a._fov)]}const Qe=e.a6.fog;class $e extends e.E{constructor(t,r,n,i){super();const s=new e.a9({range:new e.aa(Qe.range),color:new e.aa(Qe.color),"color-use-theme":new e.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new e.aa(Qe["high-color"]),"high-color-use-theme":new e.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new e.aa(Qe["space-color"]),"space-color-use-theme":new e.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new e.aa(Qe["horizon-blend"]),"star-intensity":new e.aa(Qe["star-intensity"]),"vertical-range":new e.aa(Qe["vertical-range"])});this._transitionable=new e.a8(s,n,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this._transform=r,this.properties=new e.ai(s),this.scope=n}get state(){const t=this._transform,r="globe"===t.projection.name,n=e.aj(t.zoom),i=this.properties.get("range"),s=[.5,3];return{range:r?[e.ak(s[0],i[0],n),e.ak(s[1],i[1],n)]:i,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Ne,e,r))return;const n=Object.assign({},e);for(const i of Object.keys(Qe))void 0===n[i]&&(n[i]=Qe[i].default);this._options=n,this._transitionable.setTransitionOrValue(this._options,t)}getOpacity(t){if(!this._transform.projection.supportsFog)return 0;const r=this.properties&&this.properties.get("color")||1;return("globe"===this._transform.projection.name?1:e.ah(He,Ge,t))*r.a}getOpacityAtLatLng(t,r){return this._transform.projection.supportsFog?function(t,r,n){const i=e.ae.fromLngLat(r),s=n.elevation?n.elevation.getAtPointOrZero(i):0;return Xe(t,i.x,i.y,s,n)}(this.state,t,r):0}getOpacityForTile(t){if(!this._transform.projection.supportsFog)return[1,1];const r=this._transform.calculateFogTileMatrix(t.toUnwrapped());return Je(this.state,r,0,0,e.al,e.al,this._transform)}getOpacityForBounds(e,t,r,n,i){return this._transform.projection.supportsFog?Je(this.state,e,t,r,n,i,this._transform):[1,1]}getFovAdjustedRange(e){return this._transform.projection.supportsFog?Ye(this.state,e):[0,1]}isVisibleOnFrustum(t){if(!this._transform.projection.supportsFog)return!1;const r=[4,5,6,7];for(const n of r){const r=t.points[n];let i;if(r[2]>=0)i=r;else{const s=t.points[n-4];i=e.am(s,r,s[2]/(s[2]-r[2]))}if(Xe(this.state,i[0],i[1],0,this._transform)>=Ze)return!0}return!1}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Te,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}}let et,tt,rt,nt,it=class extends e.E{constructor(t,r,n,i){super();const s=et||(et=new e.a9({density:new e.aa(e.a6.snow.density),intensity:new e.aa(e.a6.snow.intensity),color:new e.aa(e.a6.snow.color),opacity:new e.aa(e.a6.snow.opacity),vignette:new e.aa(e.a6.snow.vignette),"vignette-color":new e.aa(e.a6.snow["vignette-color"]),"center-thinning":new e.aa(e.a6.snow["center-thinning"]),direction:new e.aa(e.a6.snow.direction),"flake-size":new e.aa(e.a6.snow["flake-size"])}));this._transitionable=new e.a8(s,n,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ai(s),this.scope=n}get state(){const t=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),i=e.an(n[0]),s=-Math.max(e.an(n[1]),.01),o=[Math.cos(i)*Math.cos(s),Math.sin(i)*Math.cos(s),Math.sin(s)],a=this.properties.get("vignette"),l=this.properties.get("vignette-color");return l.a=a,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.ao(r.r,r.g,r.b,r.a*t),direction:o,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:l}}get(){return this._transitionable.serialize()}set(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Ie,t,n))return;const i=Object.assign({},t),s=e.a6.snow;for(const e of Object.keys(s))void 0===i[e]&&(i[e]=s[e].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Te,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}},st=class extends e.E{constructor(t,r,n,i){super();const s=tt||(tt=new e.a9({density:new e.aa(e.a6.rain.density),intensity:new e.aa(e.a6.rain.intensity),color:new e.aa(e.a6.rain.color),opacity:new e.aa(e.a6.rain.opacity),vignette:new e.aa(e.a6.rain.vignette),"vignette-color":new e.aa(e.a6.rain["vignette-color"]),"center-thinning":new e.aa(e.a6.rain["center-thinning"]),direction:new e.aa(e.a6.rain.direction),"droplet-size":new e.aa(e.a6.rain["droplet-size"]),"distortion-strength":new e.aa(e.a6.rain["distortion-strength"])}));this._transitionable=new e.a8(s,n,new Map(i)),this.set(t,i),this._transitioning=this._transitionable.untransitioned(),this.properties=new e.ai(s),this.scope=n}get state(){const t=this.properties.get("opacity"),r=this.properties.get("color"),n=this.properties.get("direction"),i=e.an(n[0]),s=-Math.max(e.an(n[1]),.01),o=[Math.cos(i)*Math.cos(s),Math.sin(i)*Math.cos(s),Math.sin(s)],a=this.properties.get("vignette-color");return a.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new e.ao(r.r,r.g,r.b,r.a*t),direction:o,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:a}}get(){return this._transitionable.serialize()}set(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._validate(Pe,t,n))return;const i=Object.assign({},t),s=e.a6.rain;for(const e of Object.keys(s))void 0===i[e]&&(i[e]=s[e].default);this._options=i,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(e){this._transitionable.setTransitionOrValue(this._options,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}_validate(t,r,n){return(!n||!1!==n.validate)&&ze(this,t.call(Te,Object.assign({value:r,style:{glyphs:!0,sprite:!0},styleSpec:e.a6})))}};class ot extends e.E{constructor(t,r,n,i){super(),this.scope=n,this._options=t,this.properties=new e.ai(r),this._transitionable=new e.a8(r,n,new Map(i)),this._transitionable.setTransitionOrValue(t.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(e){this._transitionable.setTransitionOrValue(this._options.properties,new Map(e))}updateTransitions(e){this._transitioning=this._transitionable.transitioned(e,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(e){this.properties=this._transitioning.possiblyEvaluate(e)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(e,t){this._options=e,this._transitionable.setTransitionOrValue(e.properties,t)}shadowsEnabled(){return!!this.properties&&!0===this.properties.get("cast-shadows")}}class at{constructor(e,t,r){this.screenBounds=e,this.cameraPoint=r.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=t,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,r)}static createFromScreenPoints(t,r){let n,i;if(t instanceof e.P||"number"==typeof t[0]){const s=e.P.convert(t);n=[s],i=r.isPointAboveHorizon(s)}else{const s=e.P.convert(t[0]),o=e.P.convert(t[1]),a=s.add(o)._div(2);n=[s,o],i=e.aq(s,o).every(e=>r.isPointAboveHorizon(e))&&r.isPointAboveHorizon(a)}return new at(n,i,r)}isPointQuery(){return 1===this.screenBounds.length}bufferedScreenGeometry(t){return e.aq(this.screenBounds[0],1===this.screenBounds.length?this.screenBounds[0]:this.screenBounds[1],t)}bufferedCameraGeometry(t){const r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],i=e.aq(r,n,0,!1);return this.cameraPoint.y>n.y&&(this.cameraPoint.x>r.x&&this.cameraPoint.x<n.x?i.splice(3,0,this.cameraPoint):this.cameraPoint.x>=n.x?i[2]=this.cameraPoint:this.cameraPoint.x<=r.x&&(i[3]=this.cameraPoint)),e.ar(i,t)}bufferedCameraGeometryGlobe(t){const r=this.screenBounds[0],n=1===this.screenBounds.length?this.screenBounds[0].add(new e.P(1,1)):this.screenBounds[1],i=e.aq(r,n,t),s=this.cameraPoint.clone();switch(3*((s.y>r.y)+(s.y>n.y))+((s.x>r.x)+(s.x>n.x))){case 0:i[0]=s,i[4]=s.clone();break;case 1:i.splice(1,0,s);break;case 2:i[1]=s;break;case 3:i.splice(4,0,s);break;case 5:i.splice(2,0,s);break;case 6:i[3]=s;break;case 7:i.splice(3,0,s);break;case 8:i[2]=s}return i}containsTile(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;const s=Math.max(t.queryPadding,t.evaluateQueryRenderedFeaturePadding())/r._pixelsPerMercatorPixel+1,o=n?this._bufferedCameraMercator(s,r):this._bufferedScreenMercator(s,r);let a=t.tileID.wrap+(o.unwrapped?i:0);const l=o.polygon.map(r=>e.as(t.tileTransform,r,a));if(!e.at(l,0,0,e.al,e.al))return;a=t.tileID.wrap+(this.screenGeometryMercator.unwrapped?i:0);const c=this.screenGeometryMercator.polygon.map(r=>e.au(t.tileTransform,r,a)),u=c.map(t=>new e.P(t[0],t[1])),d=r.getFreeCameraOptions().position||new e.ae(0,0,0),h=e.au(t.tileTransform,d,a),p=c.map(t=>{const r=e.av(t,t,h);return e.aw(r,r),new e.ax(h,r)}),m=e.ay(t,1,r.zoom)*r._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:u,tilespaceRays:p,bufferedTilespaceGeometry:l,bufferedTilespaceBounds:(f=e.az(l),f.min.x=e.aA(f.min.x,0,e.al),f.min.y=e.aA(f.min.y,0,e.al),f.max.x=e.aA(f.max.x,0,e.al),f.max.y=e.aA(f.max.y,0,e.al),f),tile:t,tileID:t.tileID,pixelToTileUnitsFactor:m};var f}_bufferedScreenMercator(e,t){const r=ut(e);if(this._screenRaycastCache[r])return this._screenRaycastCache[r];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedScreenGeometry(e),t):{polygon:this.bufferedScreenGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._screenRaycastCache[r]=n,n}}_bufferedCameraMercator(e,t){const r=ut(e);if(this._cameraRaycastCache[r])return this._cameraRaycastCache[r];{let n;return n="globe"===t.projection.name?this._projectAndResample(this.bufferedCameraGeometryGlobe(e),t):{polygon:this.bufferedCameraGeometry(e).map(e=>t.pointCoordinate3D(e)),unwrapped:!0},this._cameraRaycastCache[r]=n,n}}_projectAndResample(t,r){const n=function(t,r){const n=e.aB([],r.pixelMatrix,r.globeMatrix),i=[0,-e.aD,0,1],s=[0,e.aD,0,1],o=[0,0,0,1];e.aC(i,i,n),e.aC(s,s,n),e.aC(o,o,n);const a=new e.P(i[0]/i[3],i[1]/i[3]),l=new e.P(s[0]/s[3],s[1]/s[3]),c=e.aE(t,a)&&i[3]<o[3],u=e.aE(t,l)&&s[3]<o[3];if(!c&&!u)return null;const d=function(e,t,r){for(let n=1;n<e.length;n++){const i=ct(t.pointCoordinate3D(e[n-1]).x),s=ct(t.pointCoordinate3D(e[n]).x);if(r<0){if(i<s)return{idx:n,t:-i/(s-1-i)}}else if(s<i)return{idx:n,t:(1-i)/(s+1-i)}}return null}(t,r,c?-1:1);if(!d)return null;const{idx:h,t:p}=d;let m=h>1?lt(t.slice(0,h),r):[],f=h<t.length?lt(t.slice(h),r):[];m=m.map(t=>new e.P(ct(t.x),t.y)),f=f.map(t=>new e.P(ct(t.x),t.y));const g=[...m];0===g.length&&g.push(f[f.length-1]);const y=e.ak(g[g.length-1].y,(0===f.length?m[0]:f[0]).y,p);let _;return _=c?[new e.P(0,y),new e.P(0,0),new e.P(1,0),new e.P(1,y)]:[new e.P(1,y),new e.P(1,1),new e.P(0,1),new e.P(0,y)],g.push(..._),0===f.length?g.push(m[0]):g.push(...f),{polygon:g.map(t=>new e.ae(t.x,t.y)),unwrapped:!1}}(t,r);if(n)return n;const i=function(t,r){let n=!1,i=-1/0,s=0;for(let e=0;e<t.length-1;e++)t[e].x>i&&(i=t[e].x,s=e);for(let e=0;e<t.length-1;e++){const r=(s+e)%(t.length-1),i=t[r],o=t[r+1];Math.abs(i.x-o.x)>.5&&(i.x<o.x?(i.x+=1,0===r&&(t[t.length-1].x+=1)):(o.x+=1,r+1===t.length-1&&(t[0].x+=1)),n=!0)}const o=e.aF(r.center.lng);return n&&o<Math.abs(o-1)&&t.forEach(e=>{e.x-=1}),{polygon:t,unwrapped:n}}(lt(t,r).map(t=>new e.P(ct(t.x),t.y)),r);return{polygon:i.polygon.map(t=>new e.ae(t.x,t.y)),unwrapped:i.unwrapped}}}function lt(t,r){return e.aG(t,e=>{const t=r.pointCoordinate3D(e);e.x=t.x,e.y=t.y},1/256)}function ct(e){return e<0?1+e%1:e%1}function ut(e){return 100*e|0}function dt(t,r,i,o,a){const l=function(n,i){if(n)return a(n);if(i){if(t.url&&i.tiles&&t.tiles&&delete t.tiles,i.variants){if(!Array.isArray(i.variants))return a(new Error("variants must be an array"));for(const e of i.variants){if(null==e||"object"!=typeof e||e.constructor!==Object)return a(new Error("variant must be an object"));if(!Array.isArray(e.capabilities))return a(new Error("capabilities must be an array"));if(1===e.capabilities.length&&"meshopt"===e.capabilities[0]){i=Object.assign(i,e);break}}}const n=e.aH(Object.assign({},i,t),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);n.tiles=r.canonicalizeTileset(n,t.url),a(null,n)}},c=function(e,t,r){if(!e)return null;if(!t&&!r)return e;r=r||e.worldview_default;const n=Object.values(e.language||{});if(0===n.length)return null;const i=Object.values(e.worldview||{});if(0===i.length)return null;const s=n.every(e=>e===t),o=i.every(e=>e===r);return s&&o?e:t in(e.language_options||{})||r in(e.worldview_options||{})?null:e.language_options&&e.worldview_options?e:null}(t.data,i,o);return c?e.o.frame(()=>l(null,c)):t.url?e.m(r.transformRequest(r.normalizeSourceURL(t.url,null,i,o),e.R.Source),l):e.o.frame(()=>{const{data:e}=t,r=n(t,s);l(null,r)})}function ht(t,r){const n=Math.pow(2,r.z),i=Math.floor(e.aF(t.getWest())*n),s=Math.floor(e.aJ(t.getNorth())*n),o=Math.ceil(e.aF(t.getEast())*n),a=Math.ceil(e.aJ(t.getSouth())*n);return r.x>=i&&r.x<o&&r.y>=s&&r.y<a}class pt{constructor(t,r,n){this.bounds=t?e.aI.convert(this.validateBounds(t)):null,this.minzoom=r||0,this.maxzoom=n||24}validateBounds(e){return Array.isArray(e)&&4===e.length?[Math.max(-180,e[0]),Math.max(-90,e[1]),Math.min(180,e[2]),Math.min(90,e[3])]:[-180,-90,180,90]}addExtraBounds(t){if(t){this.extraBounds||(this.extraBounds=[]);for(const r of t)this.extraBounds.push(e.aI.convert(this.validateBounds(r)))}}contains(e){if(e.z>this.maxzoom||e.z<this.minzoom)return!1;if(this.bounds&&!ht(this.bounds,e))return!1;if(!this.extraBounds)return!0;for(const t of this.extraBounds)if(ht(t,e))return!0;return!1}static fromTileJSON(e){if(!e.bounds&&!e.extra_bounds)return null;const t=new pt(e.bounds,e.minzoom,e.maxzoom);return t.addExtraBounds(e.extra_bounds),t}}class mt extends e.E{constructor(t,r,n,i){if(super(),this.id=t,this.dispatcher=n,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,e.aH(r,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},r),this._collectResourceTiming=!!r.collectResourceTiming,512!==this.tileSize)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(i),this._tileWorkers={},this._deduped=new e.aK}load(t){this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=dt(this._options,this.map._requestManager,r,n,(i,s)=>{if(this._tileJSONRequest=null,this._loaded=!0,i)r&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(r)),n&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new e.y(i));else if(s){if(Object.assign(this,s),this.hasWorldviews=!!s.worldview_options,s.worldview_default&&(this.worldviewDefault=s.worldview_default),s.vector_layers){this.vectorLayers=s.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const e of s.vector_layers)this.vectorLayerIds.push(e.id),s.worldview&&s.worldview[e.source]&&this.localizableLayerIds.add(e.id)}this.tileBounds=pt.fromTileJSON(s),R(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))}t&&t(i)})}loaded(){return this._loaded}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(t,r){const n=t.tileID.canonical.url(this.tiles,this.scheme),i=this.map._requestManager.normalizeTileURL(n),s=this.map._requestManager.transformRequest(i,e.R.Tile),o=this.map.style?this.map.style.getLut(this.scope):null,a=o?{image:o.image.clone()}:null,l={request:s,data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,lut:a,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:e.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault,indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};if(this.hasWorldviews&&e.h(n)&&(l.localizableLayerIds=this.localizableLayerIds),l.request.collectResourceTiming=this._collectResourceTiming,t.actor&&"expired"!==t.state)"loading"===t.state?t.reloadCallback=r:t.request=t.actor.send("reloadTile",l,c.bind(this));else if(t.actor=this._tileWorkers[i]=this._tileWorkers[i]||this.dispatcher.getActor(),this.dispatcher.ready)t.request=t.actor.send("loadTile",l,c.bind(this),void 0,!0);else{const r=e.aL.call({deduped:this._deduped},l,(r,n)=>{if(r||!n)c.call(this,r);else{const r=e.aM(n.responseHeaders);l.data={rawData:n.rawData.slice(0),expires:r.expires,cacheControl:r.cacheControl},t.actor&&t.actor.send("loadTile",l,c.bind(this),void 0,!0)}},!0);t.request={cancel:r}}function c(n,i){return delete t.request,t.aborted?r(null):n&&n instanceof e.aN&&404!==n.status?r(n):(i&&i.resourceTiming&&(t.resourceTiming=i.resourceTiming),this.map._refreshExpiredTiles&&i&&t.setExpiryData(i),t.loadVectorData(i,this.map.painter),e.aO(this.dispatcher),r(null,i),void(t.reloadCallback&&(this.loadTile(t,t.reloadCallback),t.reloadCallback=null)))}}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){e.actor&&e.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class ft extends e.E{constructor(t,r,n,i){super(),this.id=t,this.dispatcher=n,this.setEventedParent(i),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},r),Object.assign(this,e.aH(r,["url","scheme","tileSize"]))}load(t){this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"}));const r=this.map.getWorldview();this._tileJSONRequest=dt(this._options,this.map._requestManager,null,r,(r,n)=>{this._tileJSONRequest=null,this._loaded=!0,r?this.fire(new e.y(r)):n&&(Object.assign(this,n),n.raster_layers&&(this.rasterLayers=n.raster_layers,this.rasterLayerIds=this.rasterLayers.map(e=>e.id)),this.tileBounds=pt.fromTileJSON(n),R(n.tiles),this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(r)})}loaded(){return this._loaded}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}setTiles(e){return this._options.tiles=e,this.reload(),this}setUrl(e){return this.url=e,this._options.url=e,this.reload(),this}onRemove(e){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(t,r){const n=e.o.devicePixelRatio>=2,i=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),n,this.tileSize);t.request=e.n(this.map._requestManager.transformRequest(i,e.R.Tile),(n,i,s)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(n)return t.state="errored",r(n);if(!i)return r(null);const o=e.aM(s);this.map._refreshExpiredTiles&&t.setExpiryData(o),t.setTexture(i,this.map.painter),t.state="loaded",e.aO(this.dispatcher),r(null)})}abortTile(e,t){e.request&&(e.request.cancel(),delete e.request),t&&t()}unloadTile(t,r){t.texture&&t.texture instanceof e.T?(t.destroy(!1),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),r&&r()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function gt(t,r,n){let[i,s]=t,{scaled:o=!0}=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const{tileSize:a,buffer:l}=n,{x:c,y:u,z:d}=r;if(!isFinite(c)||!isFinite(u)||!isFinite(d))throw new Error("Invalid MRT header");const h=2**d,p=h*e.aF(i),m=h*e.aJ(s);return function(e,t){let[r,n]=e,{scaled:i=!0}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(!t)throw new Error("bandView is undefined");const{data:s,tileSize:o,buffer:a,offset:l,scale:c,dimension:u}=t;if(r<-a||r>o+a||n<-a||n>o+a)throw new Error("Point (".concat(r,", ").concat(n,") out of bounds for tileSize=").concat(o,", buffer=").concat(a));const d=(n+a)*(o+2*a)+(r+a);if(4294967295===new Uint32Array(s.buffer)[d])return null;let h=[];h=i?[]:new(0,t.data.constructor)(u);for(let p=0;p<u;p++)h[p]=Math.round(1e12*(s[u*d+p]*c+l))/1e12;return h}([Math.min(Math.max(-l,Math.floor((p-c)*a)),a-1+l),Math.min(Math.max(-l,Math.floor((m-u)*a)),a-1+l)],n,{scaled:o})}class yt extends ft{constructor(e,t,r,n){super(e,t,r,n),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},t)}triggerRepaint(e){const t=this.map.painter._terrain,r=this.map.style.getSourceCache(this.id);t&&t.enabled&&r&&t._clearRenderCacheForTile(r.id,e.tileID),this.map.triggerRepaint()}loadTile(t,r){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),i=this.map._requestManager.transformRequest(n,e.R.Tile),s={request:i,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};t.source=this.id,t.scope=this.scope,t.requestParams=i,t.actor||(t.actor=this.dispatcher.getActor());const o=(n,i,s)=>{if(delete t.request,t.aborted)return t.state="unloaded",r(null);if(n){if("AbortError"===n.name)return;return t.state="errored",r(n)}if(this.map._refreshExpiredTiles&&i){const r=e.aM(s);t.setExpiryData(r)}if(this.partial&&"expired"!==t.state)t.state="empty";else if(!this.partial){if(!i)return r(null);t.state="loaded",t._isHeaderLoaded=!0,t._mrt=i}r(null)};t.request=this.partial?t.fetchHeader(void 0,o.bind(this)):t.actor.send("loadTile",s,o.bind(this),void 0,!0)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.actor&&e.actor.send("abortTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(e,t){const r=e.texturePerLayer;if(e.flushAllQueues(),r.size){e.destroy(!1);for(const e of r.values())this.map.painter.saveTileTexture(e)}else e.destroy()}prepareTile(t,r,n,i){t._isHeaderLoaded&&("empty"!==t.state&&(t.state="reloading"),t.fetchBandForRender(r,n,i,(r,i)=>{if(r)return t.state="errored",this.fire(new e.y(r)),void this.triggerRepaint(t);i&&(t._isHeaderLoaded=!0,t.setTexturePerLayer(n,i,this.map.painter),t.state="loaded",this.triggerRepaint(t))}))}getInitialBand(e){if(!this.rasterLayers)return 0;const t=this.rasterLayers.find(t=>{let{id:r}=t;return r===e}),r=t&&t.fields,n=r&&r.bands&&r.bands;return n?n[0]:0}getTextureDescriptor(t,r,n){if(!t)return;const i=r.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!i)return;let s=null;r instanceof e.aR?s=r.paint.get("raster-array-band"):r instanceof e.aS&&(s=r.paint.get("raster-particle-array-band"));const o=s||this.getInitialBand(i);if(null==o)return;if(!t.textureDescriptorPerLayer.get(r.id))return void this.prepareTile(t,i,r.id,o);if(t.updateNeeded(r.id,o)&&!n)return;const a=t.textureDescriptorPerLayer.get(r.id);return Object.assign({},a,{texture:t.texturePerLayer.get(r.id)})}getImages(t,r){const n=new Map;for(const i of t)for(const t of r){const[r,s]=t.split("/"),o=i.getLayer(r);if(!o)continue;if(!o.hasBand(s)||!o.hasDataForBand(s))continue;const{bytes:a,tileSize:l,buffer:c}=o.getBandView(s),u=l+2*c,d={data:new e.q({width:u,height:u},a),pixelRatio:2,sdf:!1,usvg:!1,version:0};n.set(t,d)}return n}queryRasterArrayValueByBandId(t,r,n){const i=r._mrt;return new Promise(s=>{const o={},a=new Set;for(const[l,c]of Object.entries(i.layers)){if(n.layerName&&l!==n.layerName)continue;const u={};o[l]=u;for(const{bands:d}of c.dataIndex)for(const h of d)n.bands&&!n.bands.includes(h)||(a.add(e.B(l,h)),r.fetchBand(l,null,h,r=>{e.o.frame(()=>{u[h]=r?null:gt([t.lng,t.lat],i,c.getBandView(h)),a.delete(e.B(l,h)),0===a.size&&s(o)})},!1))}0===a.size&&s(o)})}_loadTileForQuery(t,r){if(this._loadTileLoaded[t.uid])return void r(null,t._mrt);if(this._loadTilePending[t.uid])return void this._loadTilePending[t.uid].push(r);this._loadTilePending[t.uid]=[r];const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),i=this.map._requestManager.transformRequest(n,e.R.Tile);t.actor.send("loadTile",{request:i,uid:t.uid,tileID:t.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},(r,n,i)=>{if(r)return this._loadTilePending[t.uid].forEach(e=>e(r,null)),void delete this._loadTilePending[t.uid];if(!n)return this._loadTilePending[t.uid].forEach(e=>e(null,null)),void delete this._loadTilePending[t.uid];if(this.map._refreshExpiredTiles&&n){const r=e.aM(i);t.setExpiryData(r)}t._mrt=n,t._isHeaderLoaded=!0,t.state="loaded",this._loadTilePending[t.uid].forEach(e=>e(null,n)),this._loadTileLoaded[t.uid]=!0,delete this._loadTilePending[t.uid]},void 0,!0)}queryRasterArrayValueByAllBands(e,t,r){return new Promise((n,i)=>{this._loadTileForQuery(t,(s,o)=>{s?i(s):n(o?this.queryRasterArrayValueByBandId(e,t,r):null)})})}queryRasterArrayValue(t,r){const n=e.aT.convert(t),i=this.findLoadedParent(n);return i&&i._mrt?r.bands||!this.partial?this.queryRasterArrayValueByBandId(n,i,r):this.queryRasterArrayValueByAllBands(n,i,r):Promise.resolve(null)}findLoadedParent(t){const r=e.ae.fromLngLat(t,this.map.transform.tileSize),n=this.maxzoom+1,i=1<<n,s=Math.floor(r.x),o=Math.floor((r.x-s)*i),a=Math.floor(r.y*i),l=this.map.style.getSourceCache(this.id),c=new e.aQ(n,s,n,o,a);return l.findLoadedParent(c,this.minzoom)}}const _t={vector:mt,raster:ft,"raster-dem":class extends ft{constructor(e,t,r,n){super(e,t,r,n),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},t),this.encoding=t.encoding||"mapbox"}loadTile(t,r){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function i(e,n){e&&(t.state="errored",r(e)),n&&(t.dem=n,t.dem.onDeserialize(),t.needsHillshadePrepare=!0,t.needsDEMTextureUpload=!0,t.state="loaded",r(null))}t.request=e.n(this.map._requestManager.transformRequest(n,e.R.Tile),function(n,s,o){if(delete t.request,t.aborted)t.state="unloaded",r(null);else if(n)t.state="errored",r(n);else if(s){const r=e.aM(o);this.map._refreshExpiredTiles&&t.setExpiryData(r);const n=ImageBitmap&&s instanceof ImageBitmap&&e.r(),a=1-(s.width-e.aP(s.width))/2;a<1||t.neighboringTiles||(t.neighboringTiles=this._getNeighboringTiles(t.tileID));const l=n?s:e.o.getImageData(s,a),c={uid:t.uid,tileID:t.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:l,encoding:this.encoding,padding:a};t.actor&&"expired"!==t.state||(t.actor=this.dispatcher.getActor(),t.actor.send("loadTile",c,i.bind(this),void 0,!0))}}.bind(this))}_getNeighboringTiles(t){const r=t.canonical,n=Math.pow(2,r.z),i=(r.x-1+n)%n,s=0===r.x?t.wrap-1:t.wrap,o=(r.x+1+n)%n,a=r.x+1===n?t.wrap+1:t.wrap,l={};return l[new e.aQ(t.overscaledZ,s,r.z,i,r.y).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,a,r.z,o,r.y).key]={backfilled:!1},r.y>0&&(l[new e.aQ(t.overscaledZ,s,r.z,i,r.y-1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,t.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,a,r.z,o,r.y-1).key]={backfilled:!1}),r.y+1<n&&(l[new e.aQ(t.overscaledZ,s,r.z,i,r.y+1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,t.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},l[new e.aQ(t.overscaledZ,a,r.z,o,r.y+1).key]={backfilled:!1}),l}},"raster-array":yt,geojson:class extends e.E{constructor(t,r,n,i){super(),this.id=t,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=n.getActor(),this.setEventedParent(i),this._data=r.data,this._options=Object.assign({},r),this._collectResourceTiming=r.collectResourceTiming,void 0!==r.maxzoom&&(this.maxzoom=r.maxzoom),void 0!==r.minzoom&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const s=e.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(void 0!==r.buffer?r.buffer:128)*s,tolerance:(void 0!==r.tolerance?r.tolerance:.375)*s,extent:e.al,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:void 0!==r.clusterMaxZoom?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:e.al,radius:(void 0!==r.clusterRadius?r.clusterRadius:50)*s,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(e){this.map=e,this.setData(this._data)}setData(e){return this._data=e,this._updateWorkerData(),this}updateData(t){if(!this._options.dynamic)return this.fire(new e.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if("string"!=typeof t&&("Feature"===t.type&&(t={type:"FeatureCollection",features:[t]}),"FeatureCollection"!==t.type))return this.fire(new e.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&"string"!=typeof t&&"string"!=typeof this._data&&"FeatureCollection"===this._data.type){const e=new Map;for(const t of this._data.features)e.set(t.id,t);for(const r of t.features)e.set(r.id,r);this._data.features=[...e.values()]}else this._data=t;return this._updateWorkerData(!0),this}getClusterExpansionZoom(e,t){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterChildren(e,t){return this.actor.send("geojson.getClusterChildren",{clusterId:e,source:this.id,scope:this.scope},t),this}getClusterLeaves(e,t,r,n){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:e,limit:t,offset:r},n),this}_updateWorkerData(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new e.z("dataloading",{dataType:"source"})),this._loaded=!1;const r=Object.assign({append:t},this.workerOptions);r.scope=this.scope;const n=this._data;"string"==typeof n?(r.request=this.map._requestManager.transformRequest(e.o.resolveURL(n),e.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(n),this._pendingLoad=this.actor.send("".concat(this.type,".loadData"),r,(r,n)=>{if(this._loaded=!0,this._pendingLoad=null,r)this.fire(new e.y(r));else{const r={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&n&&n.resourceTiming&&n.resourceTiming[this.id]&&(r.resourceTiming=n.resourceTiming[this.id]),t&&(this._partialReload=!0),this.fire(new e.z("data",r)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(t),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const t=e.B(this.id,this.scope);this.map.style.clearSource(t),this._updateWorkerData()}loadTile(t,r){const n=t.actor?"reloadTile":"loadTile";t.actor=this.actor;const i=this.map.style?this.map.style.getLut(this.scope):null,s=i?{image:i.image.clone()}:null,o=this._partialReload,a={type:this.type,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:s,scope:this.scope,pixelRatio:e.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:t.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:o,worldview:this.map.getWorldview(),indoor:this.map.indoor?this.map.indoor.getIndoorTileOptions(this.id,this.scope):null};t.request=this.actor.send(n,a,(e,i)=>o&&!i?(t.state="loaded",r(null)):(delete t.request,t.destroy(!1),t.aborted?r(null):e?r(e):(t.loadVectorData(i,this.map.painter,"reloadTile"===n),r(null))),void 0,"loadTile"===n)}abortTile(e){e.request&&(e.request.cancel(),delete e.request),e.aborted=!0}unloadTile(e,t){this.actor.send("removeTile",{uid:e.uid,type:this.type,source:this.id,scope:this.scope}),e.destroy()}onRemove(e){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends e.aU{constructor(e,t,r,n){super(e,t,r,n),this.roundZoom=!0,this.type="video",this.options=t}load(){this._loaded=!1;const t=this.options;this.urls=[];for(const r of t.urls)this.urls.push(this.map._requestManager.transformRequest(r,e.R.Source).url);e.aV(this.urls,(t,r)=>{this._loaded=!0,t?this.fire(new e.y(t)):r&&(this.video=r,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(t){if(this.video){const r=this.video.seekable;t<r.start(0)||t>r.end(0)?this.fire(new e.y(new e.V("sources.".concat(this.id),null,"Playback for this video can be set only between the ".concat(r.start(0)," and ").concat(r.end(0),"-second mark.")))):this.video.currentTime=t}}getVideo(){return this.video}onAdd(e){this.map||(this.map=e,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(0===Object.keys(this.tiles).length||this.video.readyState<2)return;const t=this.map.painter.context,r=t.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new e.T(t,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(t)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:e.aU,model:e.aX,"batched-model":class extends e.E{constructor(e,t,r,n){super(),this.type="batched-model",this.id=e,this.tileSize=512,this._options=t,this.tiles=this._options.tiles,this.maxzoom=t.maxzoom||19,this.minzoom=t.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=r,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(n)}onAdd(e){this.map=e,this.load()}reload(){this.cancelTileJSONRequest();const t=e.B(this.id,this.scope);this.load(()=>this.map.style.clearSource(t))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(t){this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,n=this.map.getWorldview();this._tileJSONRequest=dt(this._options,this.map._requestManager,r,n,(i,s)=>{this._tileJSONRequest=null,this._loaded=!0,i?(r&&console.warn("Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ".concat(r)),n&&2!==n.length&&console.warn("Requested worldview strings must be a valid ISO alpha-2 code. Found: ".concat(n)),this.fire(new e.y(i))):s&&(Object.assign(this,s),s.bounds&&(this.tileBounds=new pt(s.bounds,this.minzoom,this.maxzoom)),R(s.tiles,this.map._requestManager._customAccessToken),this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))),t&&t(i)})}hasTransition(){return!1}hasTile(e){return!this.tileBounds||this.tileBounds.contains(e.canonical)}loaded(){return this._loaded}loadTile(t,r){const n=this.map._requestManager.normalizeTileURL(t.tileID.canonical.url(this.tiles,this.scheme)),i={request:this.map._requestManager.transformRequest(n,e.R.Tile),data:void 0,uid:t.uid,tileID:t.tileID,tileZoom:t.tileZoom,zoom:t.tileID.overscaledZ,tileSize:this.tileSize*t.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:t.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:e.o.devicePixelRatio,promoteId:this.promoteId};if(t.actor&&"expired"!==t.state)if("loading"===t.state)t.reloadCallback=r;else{if(t.buckets){const e=Object.values(t.buckets);for(const t of e)t.dirty=!0;return void(t.state="loaded")}t.request=t.actor.send("reloadTile",i,s.bind(this))}else t.actor=this.dispatcher.getActor(),t.request=t.actor.send("loadTile",i,s.bind(this),void 0,!0);function s(e,n){return t.aborted?r(null):e&&404!==e.status?r(e):(this.map._refreshExpiredTiles&&n&&t.setExpiryData(n),t.loadModelData(n,this.map.painter),t.state="loaded",void r(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends e.aU{constructor(t,r,n,i){super(t,r,n,i),r.coordinates?Array.isArray(r.coordinates)&&4===r.coordinates.length&&!r.coordinates.some(e=>!Array.isArray(e)||2!==e.length||e.some(e=>"number"!=typeof e))||this.fire(new e.y(new e.V("sources.".concat(t),null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new e.y(new e.V("sources.".concat(t),null,'missing required property "coordinates"'))),r.animate&&"boolean"!=typeof r.animate&&this.fire(new e.y(new e.V("sources.".concat(t),null,'optional "animate" property must be a boolean value'))),r.canvas?"string"==typeof r.canvas||r.canvas instanceof HTMLCanvasElement||this.fire(new e.y(new e.V("sources.".concat(t),null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new e.y(new e.V("sources.".concat(t),null,'missing required property "canvas"'))),this.options=r,this.animate=void 0===r.animate||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new e.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(e){this.map=e,this.load(),this.canvas&&this.animate&&this.play()}onRemove(e){this.pause()}prepare(){let t=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,t=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,t=!0),this._hasInvalidDimensions())return;if(0===Object.keys(this.tiles).length)return;const r=this.map.painter.context;this.texture?!t&&!this._playing||this.texture instanceof e.aW||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new e.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const e of[this.canvas.width,this.canvas.height])if(isNaN(e)||e<=0)return!0;return!1}},custom:class extends e.E{constructor(t,r,n,i){super(),this.id=t,this.type="custom",this._dataType="raster",this._dispatcher=n,this._implementation=r,this.setEventedParent(i),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new e.y(new Error("Missing implementation for ".concat(this.id," custom source")))),this._implementation.loadTile||this.fire(new e.y(new Error("Missing loadTile implementation for ".concat(this.id," custom source")))),this._implementation.bounds&&(this.tileBounds=new pt(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,e.aH(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return e.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new e.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(t){this.map=t,this._loaded=!1,this.fire(new e.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(t),this.load()}onRemove(e){this._implementation.onRemove&&this._implementation.onRemove(e)}hasTile(e){if(this._implementation.hasTile){const{x:t,y:r,z:n}=e.canonical;return this._implementation.hasTile({x:t,y:r,z:n})}return!this.tileBounds||this.tileBounds.contains(e.canonical)}loadTile(e,t){const{x:r,y:n,z:i}=e.tileID.canonical,s=new AbortController;e.request=Promise.resolve(this._implementation.loadTile({x:r,y:n,z:i},{signal:s.signal})).then(function(r){return delete e.request,e.aborted?(e.state="unloaded",t(null)):void 0===r?(e.state="errored",t(null)):null===r?(this.loadTileData(e,{width:this.tileSize,height:this.tileSize,data:null}),e.state="loaded",t(null)):function(e){return e instanceof ImageData||e instanceof HTMLCanvasElement||e instanceof ImageBitmap||e instanceof HTMLImageElement}(r)?(this.loadTileData(e,r),e.state="loaded",void t(null)):(e.state="errored",t(new Error("Can't infer data type for ".concat(this.id,", only raster data supported at the moment"))))}.bind(this)).catch(r=>{"AbortError"!==r.name&&(e.state="errored",t(r))}),e.request.cancel=()=>s.abort()}loadTileData(e,t){e.setTexture(t,this.map.painter)}unloadTile(t,r){if(t.texture&&t.texture instanceof e.T?(t.destroy(!1),t.texture&&t.texture instanceof e.T&&this.map.painter.saveTileTexture(t.texture)):t.destroy(),this._implementation.unloadTile){const{x:e,y:r,z:n}=t.tileID.canonical;this._implementation.unloadTile({x:e,y:r,z:n})}r&&r()}abortTile(e,t){e.request&&e.request.cancel&&(e.request.cancel(),delete e.request),t&&t()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(e=>({x:e.canonical.x,y:e.canonical.y,z:e.canonical.z}))}_clearTiles(){const t=e.B(this.id,this.scope);this.map.style.clearSource(t)}_update(){this.fire(new e.z("data",{dataType:"source",sourceDataType:"content"}))}}},vt=function(t,r,n,i){const s=new _t[r.type](t,r,n,i);if(s.id!==t)throw new Error("Expected Source id to be ".concat(t," instead of ").concat(s.id));return e.aY(["load","abort","unload","serialize","prepare"],s),s};function xt(e,t){return"".concat(arguments.length>2&&void 0!==arguments[2]?arguments[2]:"",":").concat(t.id||"",":").concat(t.layer.id,":").concat(function(e){if("layerId"in e)return"layer:".concat(e.layerId);{const{featuresetId:t,importId:r}=e;return"featureset:".concat(t).concat(r?":import:".concat(r):"")}}(e.target))}function bt(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"";if(e.uniqueFeatureID){const i=xt(e,t,n);if(r.has(i))return!0;r.add(i)}return!1}function wt(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]&&arguments[4];const s=t.sourceCache.transform,o=t.sourceCache.tilesIn(e,t.has3DLayers,i);o.sort(Tt);const a=[];for(const l of o){const e=l.tile.queryRenderedFeatures(t,l,r,n,s,i);Object.keys(e).length&&a.push({wrappedTileID:l.tile.tileID.wrapped().key,queryResults:e})}for(const l in t.layers){const r=t.layers[l];if(r.styleLayer){const i=r.styleLayer.queryRenderedFeatures(e,t.sourceCache,n);Object.keys(i).length&&a.push({wrappedTileID:0,queryResults:i})}}return 0===a.length?{}:function(e){const t={},r={};for(const n of e){const e=n.queryResults,i=n.wrappedTileID,s=r[i]=r[i]||{};for(const r in e){const n=e[r],i=s[r]=s[r]||{},o=t[r]=t[r]||[];for(const e of n)i[e.featureIndex]||(i[e.featureIndex]=!0,o.push(e))}}return t}(a)}function jt(e,t,r,n,i,s){const o={},a=n.queryRenderedSymbols(e),l=[];for(const c of Object.keys(a).map(Number))l.push(i[c]);l.sort(Tt);for(const c of l){const e=c.featureIndex.lookupSymbolFeatures(a[c.bucketInstanceId],c.bucketIndex,c.sourceLayerIndex,t,r,s);for(const t in e){const r=o[t]=o[t]||[],n=e[t];n.sort((e,t)=>{const r=c.featureSortOrder;if(r){const n=r.indexOf(e.featureIndex);return r.indexOf(t.featureIndex)-n}return t.featureIndex-e.featureIndex});for(const e of n)r.push(e)}}return o}function St(e,t){const r=e.getRenderableIds().map(t=>e.getTileByID(t)),n=[],i={};for(let s=0;s<r.length;s++){const e=r[s],o=e.tileID.canonical.key;i[o]||(i[o]=!0,e.querySourceFeatures(n,t))}return n}function Tt(e,t){const r=e.tileID,n=t.tileID;return r.overscaledZ-n.overscaledZ||r.canonical.y-n.canonical.y||r.wrap-n.wrap||r.canonical.x-n.canonical.x}function kt(e,t){const r={};if(!t)return r;for(const n of e){const e=n.layerIds.map(e=>t.getLayer(e)).filter(Boolean);if(0!==e.length){n.layers=e,n.stateDependentLayerIds&&(n.stateDependentLayers=n.stateDependentLayerIds.map(t=>e.filter(e=>e.id===t)[0]));for(const t of e)r[t.fqid]=n}}return r}const At=32,Ct=33,Et=new Uint16Array(8184);for(let n=0;n<2046;n++){let e=n+2,t=0,r=0,i=0,s=0,o=0,a=0;for(1&e?i=s=o=At:t=r=a=At;(e>>=1)>1;){const n=t+i>>1,l=r+s>>1;1&e?(i=t,s=r,t=o,r=a):(t=i,r=s,i=o,s=a),o=n,a=l}const l=4*n;Et[l+0]=t,Et[l+1]=r,Et[l+2]=i,Et[l+3]=s}const Nt=new Uint16Array(2178),It=new Uint8Array(1089),Pt=new Uint16Array(1089);function Mt(e){return 0===e?-.03125:32===e?.03125:0}const Lt={type:2,extent:e.al,loadGeometry:()=>[[new e.P(0,0),new e.P(e.al+1,0),new e.P(e.al+1,e.al+1),new e.P(0,e.al+1),new e.P(0,0)]]};class Rt{constructor(t,r,n,i,s,o){this.tileID=t,this.uid=e.b2(),this.uses=0,this.tileSize=r,this.tileZoom=n,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=s,i&&i.style&&(this._lastUpdatedBrightness=i.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",i&&i.transform&&(this.projection=i.transform.projection),this.worldview=o,this._hasAppearances=null}registerFadeDuration(t){const r=t+this.timeAdded;r<e.o.now()||this.fadeEndTime&&r<this.fadeEndTime||(this.fadeEndTime=r)}wasRequested(){return"errored"===this.state||"loaded"===this.state||"reloading"===this.state}get tileTransform(){return this._tileTransform||(this._tileTransform=e.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(t,r,n){if(this.unloadVectorData(),this.state="loaded",t){t.featureIndex&&(this.latestFeatureIndex=t.featureIndex,t.rawTileData?(this.latestRawTileData=t.rawTileData,this.latestFeatureIndex.rawTileData=t.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=t.collisionBoxArray,this.buckets=kt(t.buckets,r.style),this.hasSymbolBuckets=!1;for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.b4){if(this.hasSymbolBuckets=!0,!n)break;r.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const t in this.buckets){const r=this.buckets[t];if(r instanceof e.b4&&r.hasRTLText){this.hasRTLText=!0,e.b5();break}}this.queryPadding=0;for(const e in this.buckets){const t=this.buckets[e],n=r.style.getOwnLayer(e);if(!n)continue;const i=n.queryRadius(t);this.queryPadding=Math.max(this.queryPadding,i)}t.imageAtlas&&(this.imageAtlas=t.imageAtlas),t.glyphAtlasImage&&(this.glyphAtlasImage=t.glyphAtlasImage),t.lineAtlas&&(this.lineAtlas=t.lineAtlas),this._lastUpdatedBrightness=t.brightness}else this.collisionBoxArray=new e.b3}unloadVectorData(){if(this.hasData()){for(const e in this.buckets)this.buckets[e].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(e,t,r){e&&(e.resourceTiming&&(this.resourceTiming=e.resourceTiming),this.buckets=Object.assign({},this.buckets,kt(e.buckets,t.style)),e.featureIndex&&(this.latestFeatureIndex=e.featureIndex))}getBucket(e){return this.buckets[e.fqid]}upload(t,r){for(const e in this.buckets){const n=this.buckets[e];if(n.uploadPending()){let e={},i=[],s={zoom:0,pitch:0,brightness:0,worldview:""};if(r){if(r.style){i=r.style.listImages();const t=n.layers[0],s=t.sourceLayer||"_geojsonTileLayer",o=r.style.getLayerSourceCache(t);o&&(e=o._state.getState(s,void 0))}s={zoom:r.transform.zoom||0,pitch:r.transform.pitch||0,brightness:r.style.getBrightness()||0,worldview:r.worldview||""}}n.upload(t,this.tileID.canonical,e,i,s)}}const n=t.gl,i=this.imageAtlas;i&&!i.uploaded&&(this.imageAtlasTexture=new e.T(t,i.image,n.RGBA8,{useMipmap:!!i.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new e.T(t,this.glyphAtlasImage,n.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new e.T(t,this.lineAtlas.image,n.R8),this.lineAtlas.uploaded=!0)}prepare(e,t,r){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(e,this.imageAtlasTexture,r),!t||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const n=t.style.getBrightness();null===this._hasAppearances&&(this._hasAppearances=this.hasAppearances(t)),(this._lastUpdatedBrightness||n||this._hasAppearances)&&(!this._hasAppearances&&this._lastUpdatedBrightness&&n&&Math.abs(this._lastUpdatedBrightness-n)<.001||(this.updateBuckets(t,this._lastUpdatedBrightness!==n),this._lastUpdatedBrightness=n))}evaluateQueryRenderedFeaturePadding(){let e=0;for(const t in this.buckets){const r=this.buckets[t];r.evaluateQueryRenderedFeaturePadding&&(e=Math.max(e,r.evaluateQueryRenderedFeaturePadding()))}return e}queryRenderedFeatures(t,r,n,i,s,o){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const a=this.evaluateQueryRenderedFeaturePadding(),l=function(t,r){const n=e.bq([],[.5*t.width,.5*-t.height,1]);return e.br(n,n,[1,-1,0]),e.aB(n,n,t.calculateProjMatrix(r.toUnwrapped())),Float32Array.from(n)}(s,this.tileID);return this.latestFeatureIndex.query(t,{tilespaceGeometry:r,pixelPosMatrix:l,transform:i,availableImages:n,tileTransform:this.tileTransform,worldview:this.worldview,queryRadius:a})}querySourceFeatures(t,r){const n=this.latestFeatureIndex;if(!n||!n.rawTileData)return;const i=n.loadVTLayers(),s=r?r.sourceLayer:"",o=i._geojsonTileLayer||i[s];if(!o)return;const a=e.b6(r&&r.filter),{z:l,x:c,y:u}=this.tileID.canonical,d={z:l,x:c,y:u};for(let h=0;h<o.length;h++){const r=o.feature(h);if(a.needGeometry){const t=e.b7(r,!0);if(!a.filter(new e.ac(this.tileID.overscaledZ,{worldview:this.worldview}),t,this.tileID.canonical))continue}else if(!a.filter(new e.ac(this.tileID.overscaledZ,{worldview:this.worldview}),r))continue;const i=n.getId(r,s),p=new e.b8(r,l,c,u,i);p.tile=d,t.push(p)}}loaded(){return"loaded"===this.state||"errored"===this.state}hasData(){return"loaded"===this.state||"reloading"===this.state||"expired"===this.state}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(t){const r=this.expirationTime;if(t.cacheControl){const r=e.b9(t.cacheControl);r["max-age"]&&(this.expirationTime=Date.now()+1e3*r["max-age"])}else t.expires&&(this.expirationTime=new Date(t.expires).getTime());if(this.expirationTime){const e=Date.now();let t=!1;if(this.expirationTime>e)t=!1;else if(r)if(this.expirationTime<r)t=!0;else{const n=this.expirationTime-r;n?this.expirationTime=e+Math.max(n,3e4):t=!0}else t=!0;t?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-(new Date).getTime(),Math.pow(2,31)-1)}refreshFeatureState(e){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&e&&this.updateBuckets(e)}hasAppearances(e){for(const t in this.buckets)if(e.style.hasLayer(t)&&this.buckets[t].layers.some(e=>e.appearances&&e.appearances.length>0))return!0;return!1}updateBuckets(t,r){if(!this.latestFeatureIndex)return;if(!t.style)return;const n=t.style.listImages(),i=t.style.getBrightness();for(const s in this.buckets){if(!t.style.hasLayer(s))continue;const o=this.buckets[s],a=o.layers[0],l=a.sourceLayer||"_geojsonTileLayer",c=t.style.getLayerSourceCache(a);let u={};c&&(u=c._state.getState(l,void 0));const d=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},h=Object.keys(u).length>0&&!r;o.hasAppearances=o.layers.some(e=>e.appearances&&e.appearances.length>0);const p=h?o.stateDependentLayers:o.layers;if(h&&0!==o.stateDependentLayers.length||r){const e=this.latestFeatureIndex.loadVTLayers();o.update(u,e[l],n,d,p,r,i)}if(h&&0!==o.stateDependentLayers.length||r||o.hasAppearances){const e={zoom:t.transform.zoom,pitch:t.transform.pitch,brightness:t.style.getBrightness()||0,worldview:t.worldview};o.updateAppearances(this.tileID.canonical,u,n,e)}(o instanceof e.ba||o instanceof e.bb)&&t._terrain&&t._terrain.enabled&&c&&o.uploadPending()&&t._terrain._clearRenderCacheForTile(c.id,this.tileID);const m=t&&t.style&&t.style.getOwnLayer(s);m&&(this.queryPadding=Math.max(this.queryPadding,m.queryRadius(o)))}}holdingForFade(){return void 0!==this.symbolFadeHoldUntil}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<e.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(t){this.symbolFadeHoldUntil=e.o.now()+t}setTexture(t,r){const n=r.context,i=n.gl;this.texture=this.texture||r.getTileTexture(t.width),this.texture&&this.texture instanceof e.T?this.texture.update(t):(this.texture=new e.T(n,t,i.RGBA8,{useMipmap:!0}),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE))}setDependencies(e,t){const r={};for(const n of t)r[n]=!0;this.dependencies[e]=r}hasDependency(e,t){for(const r of e){const e=this.dependencies[r];if(e)for(const r of t)if(e[r])return!0}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(t,r){if(!r||"mercator"===r.name||this._tileDebugBuffer)return;const n=e.bc(Lt,this.tileID.canonical,this.tileTransform)[0],i=new e.bd,s=new e.be;for(let e=0;e<n.length;e++){const{x:t,y:r}=n[e];i.emplaceBack(t,r),s.emplaceBack(e)}s.emplaceBack(0),this._tileDebugIndexBuffer=t.createIndexBuffer(s),this._tileDebugBuffer=t.createVertexBuffer(i,e.bf.members),this._tileDebugSegments=e.bg.simpleSegment(0,0,i.length,s.length)}_makeTileBoundsBuffers(t,r){if(this._tileBoundsBuffer||!r||"mercator"===r.name)return;const n=e.bc(Lt,this.tileID.canonical,this.tileTransform)[0];let i,s;if(this.isRaster){const t=function(t,r){const n=e.aZ(t,r),i=Math.pow(2,t.z);for(let u=0;u<Ct;u++)for(let s=0;s<Ct;s++){const o=e.a_((t.x+(s+Mt(s))/At)/i),a=e.a$((t.y+(u+Mt(u))/At)/i),l=r.project(o,a),c=u*Ct+s;Nt[2*c+0]=Math.round((l.x*n.scale-n.x)*e.al),Nt[2*c+1]=Math.round((l.y*n.scale-n.y)*e.al)}It.fill(0),Pt.fill(0);for(let e=2045;e>=0;e--){const t=4*e,r=Et[t+0],n=Et[t+1],i=Et[t+2],s=Et[t+3],o=r+i>>1,a=n+s>>1,l=o+a-n,c=a+r-o,u=n*Ct+r,d=s*Ct+i,h=a*Ct+o,p=Math.hypot((Nt[2*u+0]+Nt[2*d+0])/2-Nt[2*h+0],(Nt[2*u+1]+Nt[2*d+1])/2-Nt[2*h+1])>=16;It[h]=It[h]||(p?1:0),e<1022&&(It[h]=It[h]||It[(n+c>>1)*Ct+(r+l>>1)]||It[(s+c>>1)*Ct+(i+l>>1)])}const s=new e.b1,o=new e.b0;let a=0;function l(t,r){const n=r*Ct+t;return 0===Pt[n]&&(s.emplaceBack(Nt[2*n+0],Nt[2*n+1],t*e.al/At,r*e.al/At),Pt[n]=++a),Pt[n]-1}function c(e,t,r,n,i,s){const a=e+r>>1,u=t+n>>1;if(Math.abs(e-i)+Math.abs(t-s)>1&&It[u*Ct+a])c(i,s,e,t,a,u),c(r,n,i,s,a,u);else{const a=l(e,t),c=l(r,n),u=l(i,s);o.emplaceBack(a,c,u)}}return c(0,0,At,At,At,0),c(At,At,0,0,0,At),{vertices:s,indices:o}}(this.tileID.canonical,r);i=t.vertices,s=t.indices}else{i=new e.b1,s=new e.b0;for(const{x:e,y:r}of n)i.emplaceBack(e,r,0,0);const t=e.bh(i.int16.subarray(0,4*i.length),void 0,4);for(let e=0;e<t.length;e+=3)s.emplaceBack(t[e],t[e+1],t[e+2])}this._tileBoundsBuffer=t.createVertexBuffer(i,e.bi.members),this._tileBoundsIndexBuffer=t.createIndexBuffer(s),this._tileBoundsSegments=e.bg.simpleSegment(0,0,i.length,s.length)}_makeGlobeTileDebugBuffers(t,r){const n=r.projection;if(!n||"globe"!==n.name||r.freezeTileCoverage)return;const i=this.tileID.canonical,s=e.bj(i,r),o=e.bk(s),a=e.aj(r.zoom);let l;a>0&&(l=e.bl(new Float64Array(16),r.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(t,i,r,o,l,a),this._makeGlobeTileDebugTextBuffer(t,i,r,o,l,a)}_globePoint(t,r,n,i,s,o,a){let l=e.bm(t,r,n);if(o){const s=1<<n.z,c=e.aF(i.center.lng),u=e.aJ(i.center.lat),d=(n.x+.5)/s-c;let h=0;d>.5?h=-1:d<-.5&&(h=1);let p=(t/e.al+n.x)/s+h,m=(r/e.al+n.y)/s;p=(p-c)*i._pixelsPerMercatorPixel+c,m=(m-u)*i._pixelsPerMercatorPixel+u;const f=[p*i.worldSize,m*i.worldSize,0];e.af(f,f,o),l=e.bn(l,f,a)}return e.af(l,l,s)}_makeGlobeTileDebugBorderBuffer(t,r,n,i,s,o){const a=new e.bd,l=new e.be,c=new e.bo,u=(e,t,u,d,h)=>{const p=(u-e)/(h-1),m=(d-t)/(h-1),f=a.length;for(let g=0;g<h;g++){const u=e+g*p,d=t+g*m;a.emplaceBack(u,d);const h=this._globePoint(u,d,r,n,i,s,o);c.emplaceBack(h[0],h[1],h[2]),l.emplaceBack(f+g)}},d=e.al;u(0,0,d,0,16),u(d,0,d,d,16),u(d,d,0,d,16),u(0,d,0,0,16),this._tileDebugIndexBuffer=t.createIndexBuffer(l),this._tileDebugBuffer=t.createVertexBuffer(a,e.bf.members),this._globeTileDebugBorderBuffer=t.createVertexBuffer(c,e.bp.members),this._tileDebugSegments=e.bg.simpleSegment(0,0,a.length,l.length)}_makeGlobeTileDebugTextBuffer(t,r,n,i,s,o){const a=e.al/4,l=new e.bd,c=new e.b0,u=new e.bo,d=25;c.reserve(32),l.reserve(d),u.reserve(d);const h=(e,t)=>d*e+t;for(let e=0;e<d;e++){const t=e*a;for(let e=0;e<d;e++){const c=e*a;l.emplaceBack(c,t);const d=this._globePoint(c,t,r,n,i,s,o);u.emplaceBack(d[0],d[1],d[2])}}for(let e=0;e<4;e++)for(let t=0;t<4;t++){const r=h(e,t),n=h(e,t+1),i=h(e+1,t),s=h(e+1,t+1);c.emplaceBack(r,n,i),c.emplaceBack(i,n,s)}this._tileDebugTextIndexBuffer=t.createIndexBuffer(c),this._tileDebugTextBuffer=t.createVertexBuffer(l,e.bf.members),this._globeTileDebugTextBuffer=t.createVertexBuffer(u,e.bp.members),this._tileDebugTextSegments=e.bg.simpleSegment(0,0,d,32)}destroy(){let t=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];for(const e in this.buckets)this.buckets[e].destroy(t);this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),t&&this.texture&&this.texture instanceof e.T&&(this.texture.destroy(),delete this.texture),this.emissiveTexture&&this.emissiveTexture instanceof e.T&&(this.emissiveTexture.destroy(),delete this.emissiveTexture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}e.bs.setPbf(e.bt);class Dt extends Rt{constructor(e,t,r,n,i){super(e,t,r,n,i),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(e){return this._mrt&&this._mrt.getLayer(e)}setTexturePerLayer(t,r,n){const i=n.context,s=i.gl;let o=this.texturePerLayer.get(t)||n.getTileTexture(r.width);o&&o instanceof e.T?o.update(r,{premultiply:!1}):o=new e.T(i,r,s.RGBA8,{premultiply:!1}),this.texturePerLayer.has(t)||this.texturePerLayer.set(t,o)}flushQueues(e){const t=this._workQueuePerLayer.get(e)||[],r=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()();for(;r.length;)r.pop()()}flushAllQueues(){for(const e of this._workQueuePerLayer.keys()){const t=this._workQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}for(const e of this._fetchQueuePerLayer.keys()){const t=this._fetchQueuePerLayer.get(e)||[];for(;t.length;)t.pop()()}}fetchHeader(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:16384,r=arguments.length>1?arguments[1]:void 0;const n=this._mrt=new e.bs(30),i=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(t-1)}});return this.entireBuffer=null,this.request=e.bu(i,(e,i,s)=>{if(e)r(e);else try{const e=n.getHeaderLength(i);if(e>t)return void(this.request=this.fetchHeader(e,r));n.parseHeader(i),this._isHeaderLoaded=!0;let o=0;for(const t of Object.values(n.layers))o=Math.max(o,t.dataIndex[t.dataIndex.length-1].lastByte);i.byteLength>=o&&(this.entireBuffer=i),r(null,this.entireBuffer||i,s)}catch(e){r(e)}}),this.request}fetchBandForRender(e,t,r,n){this.fetchBand(e,t,r,i=>{if(i)return void n(i);this.updateTextureDescriptor(e,t,r);const s=this.textureDescriptorPerLayer.get(t);n(null,s?s.img:null)})}fetchBand(t,r,n,i){const s=this._mrt;if(!this._isHeaderLoaded||!s)return void i(new Error("Tile header is not ready"));const o=this.actor;if(!o)return void i(new Error("Can't fetch tile band without an actor"));let a;const l=e.B(String(n),e.B(this.tileID.key,t));let c=this._taskQueue.get(l);c?c.add(i):(c=new Set,c.add(i),this._taskQueue.set(l,c));const u=(e,t)=>{a.complete(e,t),e?i(e):(c.forEach(e=>e(null,t)),this._taskQueue.delete(l))},d=(e,t)=>{if(e)return i(e);const n=o.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:t,task:a},u,void 0,!0);if(null!==r){const e=this._workQueuePerLayer.get(r)||[];e.push(()=>{n&&n.cancel(),a.cancel()}),this._workQueuePerLayer.has(r)||this._workQueuePerLayer.set(r,e)}};let h;try{h=s.getLayer(t)}catch(e){if("reloading"===this.state)return;throw e}if(!h)return void i(new Error('Unknown sourceLayer "'.concat(t,'"')));if(h.hasDataForBand(n))return c.forEach(e=>e(null,null)),void this._taskQueue.delete(l);const p=h.getDataRange([n]);if(a=s.createDecodingTask(p),!a||a.tasks.length)if(null!==r&&this.flushQueues(r),this.entireBuffer)d(null,this.entireBuffer.slice(p.firstByte,p.lastByte+1));else{const t=Object.assign({},this.requestParams,{headers:{Range:"bytes=".concat(p.firstByte,"-").concat(p.lastByte)}}),n=e.bu(t,d);if(null!==r){const e=this._fetchQueuePerLayer.get(r)||[];e.push(()=>{n.cancel(),a.cancel()}),this._fetchQueuePerLayer.has(r)||this._fetchQueuePerLayer.set(r,e)}}}updateNeeded(e,t){return(!this.textureDescriptorPerLayer.get(e)||this.textureDescriptorPerLayer.get(e).band!==t||this.refreshedUponExpiration)&&"errored"!==this.state}updateTextureDescriptor(t,r,n){if(!this._mrt)return;const i=this._mrt.getLayer(t);if(!i||!i.hasBand(n)||!i.hasDataForBand(n))return;const{bytes:s,tileSize:o,buffer:a,offset:l,scale:c}=i.getBandView(n),u=o+2*a,d=new e.q({width:u,height:u},s),h=this.texturePerLayer.get(r);h&&h instanceof e.T&&h.update(d,{premultiply:!1}),this.textureDescriptorPerLayer.set(r,{layer:t,band:n,img:d,buffer:a,offset:l,tileSize:o,format:i.pixelFormat,mix:[c,256*c,65536*c,16777216*c]})}destroy(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(super.destroy(t),delete this._mrt,!t)for(const r of this.texturePerLayer.values())r&&r instanceof e.T&&r.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Ft{constructor(e,t){this.max=e,this.onRemove=t,this.reset()}reset(){for(const e in this.data)for(const t of this.data[e])t.timeout&&clearTimeout(t.timeout),this.onRemove(t.value);return this.data={},this.order=[],this}add(e,t,r){const n=e.wrapped().key;void 0===this.data[n]&&(this.data[n]=[]);const i={value:t,timeout:void 0};if(void 0!==r&&(i.timeout=setTimeout(()=>{this.remove(e,i)},r)),this.data[n].push(i),this.order.push(n),this.order.length>this.max){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}has(e){return e.wrapped().key in this.data}getAndRemove(e){return this.has(e)?this._getAndRemoveByKey(e.wrapped().key):null}_getAndRemoveByKey(e){const t=this.data[e].shift();return t.timeout&&clearTimeout(t.timeout),0===this.data[e].length&&delete this.data[e],this.order.splice(this.order.indexOf(e),1),t.value}getByKey(e){const t=this.data[e];return t?t[0].value:null}get(e){return this.has(e)?this.data[e.wrapped().key][0].value:null}remove(e,t){if(!this.has(e))return this;const r=e.wrapped().key,n=void 0===t?0:this.data[r].indexOf(t),i=this.data[r][n];return this.data[r].splice(n,1),i.timeout&&clearTimeout(i.timeout),0===this.data[r].length&&delete this.data[r],this.onRemove(i.value),this.order.splice(this.order.indexOf(r),1),this}setMaxSize(e){for(this.max=e;this.order.length>this.max;){const e=this._getAndRemoveByKey(this.order[0]);e&&this.onRemove(e)}return this}filter(e){const t=[];for(const r in this.data)for(const n of this.data[r])e(n.value)||t.push(n);for(const r of t)this.remove(r.value.tileID,r)}}class Ot{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(e,t,r){const n=String(t);if(this.stateChanges[e]=this.stateChanges[e]||{},this.stateChanges[e][n]=this.stateChanges[e][n]||{},Object.assign(this.stateChanges[e][n],r),null===this.deletedStates[e]){this.deletedStates[e]={};for(const t in this.state[e])t!==n&&(this.deletedStates[e][t]=null)}else if(this.deletedStates[e]&&null===this.deletedStates[e][n]){this.deletedStates[e][n]={};for(const t in this.state[e][n])r[t]||(this.deletedStates[e][n][t]=null)}else for(const i in r)this.deletedStates[e]&&this.deletedStates[e][n]&&null===this.deletedStates[e][n][i]&&delete this.deletedStates[e][n][i]}removeFeatureState(e,t,r){if(null===this.deletedStates[e])return;const n=String(t);if(this.deletedStates[e]=this.deletedStates[e]||{},r&&void 0!==t)null!==this.deletedStates[e][n]&&(this.deletedStates[e][n]=this.deletedStates[e][n]||{},this.deletedStates[e][n][r]=null);else if(void 0!==t)if(this.stateChanges[e]&&this.stateChanges[e][n])for(r in this.deletedStates[e][n]={},this.stateChanges[e][n])this.deletedStates[e][n][r]=null;else this.deletedStates[e][n]=null;else this.deletedStates[e]=null}getState(e,t){const r=this.state[e]||{},n=this.stateChanges[e]||{},i=this.deletedStates[e];if(null===i)return{};if(void 0!==t){const e=String(t),s=Object.assign({},r[e],n[e]);if(i){const e=i[t];if(null===e)return{};for(const t in e)delete s[t]}return s}const s=Object.assign({},r,n);if(i)for(const o in i)delete s[o];return s}initializeTileState(e,t){e.refreshFeatureState(t)}coalesceChanges(e,t){const r={};for(const n in this.stateChanges){this.state[n]=this.state[n]||{};const e={};for(const t in this.stateChanges[n])this.state[n][t]||(this.state[n][t]={}),Object.assign(this.state[n][t],this.stateChanges[n][t]),e[t]=this.state[n][t];r[n]=e}for(const n in this.deletedStates){this.state[n]=this.state[n]||{};const e={};if(null===this.deletedStates[n])for(const t in this.state[n])e[t]={},this.state[n][t]={};else for(const t in this.deletedStates[n]){if(null===this.deletedStates[n][t])this.state[n][t]={};else if(this.state[n][t])for(const e of Object.keys(this.deletedStates[n][t]))delete this.state[n][t][e];e[t]=this.state[n][t]}r[n]=r[n]||{},Object.assign(r[n],e)}if(this.stateChanges={},this.deletedStates={},0!==Object.keys(r).length)for(const n in e)e[n].refreshFeatureState(t)}}class zt extends e.E{constructor(e,t,r){super(),this.id=e,this._onlySymbols=r,t.on("data",e=>{"source"===e.dataType&&"metadata"===e.sourceDataType&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&"source"===e.dataType&&"content"===e.sourceDataType&&(this.reload(),this.transform&&this.update(this.transform))}),t.on("error",()=>{this._sourceErrored=!0}),this._source=t,this._tiles={},this._cache=new Ft(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Ot,this._isRaster="raster"===this._source.type||"raster-dem"===this._source.type||"raster-array"===this._source.type||"custom"===this._source.type&&"raster"===this._source._dataType}onAdd(e){this.map=e,this._minTileCacheSize=void 0===this._minTileCacheSize&&e?e._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=void 0===this._maxTileCacheSize&&e?e._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded)return!1;if(!this._source.loaded())return!1;for(const e in this._tiles)if(!this._tiles[e].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const e=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,e&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(e,t){return e.isSymbolTile=this._onlySymbols,e.isExtraShadowCaster=this._shadowCasterTiles[e.tileID.key],this._source.loadTile(e,t)}_unloadTile(e){if(this._source.unloadTile)return this._source.unloadTile(e)}_abortTile(e){if(this._source.abortTile)return this._source.abortTile(e)}serialize(){return this._source.serialize()}prepare(e){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const t in this._tiles){const r=this._tiles[t];r.upload(e,this.map?this.map.painter:void 0),r.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(e=>e.tileID).sort(Bt).map(e=>e.key)}getRenderableIds(t,r){const n=[];for(const e in this._tiles)this._isIdRenderable(+e,t,r)&&n.push(this._tiles[e]);return t?n.sort((t,r)=>{const n=t.tileID,i=r.tileID,s=new e.P(n.canonical.x,n.canonical.y)._rotate(this.transform.angle),o=new e.P(i.canonical.x,i.canonical.y)._rotate(this.transform.angle);return n.overscaledZ-i.overscaledZ||o.y-s.y||o.x-s.x}).map(e=>e.tileID.key):n.map(e=>e.tileID).sort(Bt).map(e=>e.key)}hasRenderableParent(e){const t=this.findLoadedParent(e,0);return!!t&&this._isIdRenderable(t.tileID.key)}_isIdRenderable(e,t,r){return this._tiles[e]&&this._tiles[e].hasData()&&!this._coveredTiles[e]&&(t||!this._tiles[e].holdingForFade())&&(r||!this._shadowCasterTiles[e])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const e in this._tiles)"errored"!==this._tiles[e].state&&this._reloadTile(+e,"reloading")}}_reloadTile(e,t){const r=this._tiles[e];r&&("loading"!==r.state&&(r.state=t),this._loadTile(r,this._tileLoaded.bind(this,r,e,t)))}_tileLoaded(t,r,n,i,s){if(i){if(t.state="errored",404!==i.status)this._source.fire(new e.y(i,{tile:t}));else{if(this._source.fire(new e.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:t})),!(t.tileID.key in this._loadedParentTiles))return;if("raster-dem"===this._source.type&&this.usedForTerrain&&this.map.painter.terrain){const e=this.map.painter.terrain;this.update(this.transform,e.getScaledDemTileSize(),!0),e.resetTileLookupCache(this.id)}else this.update(this.transform)}return}t.timeAdded=e.o.now(),"expired"===n&&(t.refreshedUponExpiration=!0),this._setTileReloadTimer(r,t),"raster-dem"===this._source.type&&t.dem&&this._backfillDEM(t),this._state.initializeTileState(t,this.map?this.map.painter:null);let o=new Map;s&&s.responseHeaders&&(o=s.responseHeaders),this._source.fire(new e.z("data",{dataType:"source",tile:t,coord:t.tileID,sourceCacheId:this.id,responseHeaders:o}))}_backfillDEM(e){const t=this.getRenderableIds();for(let n=0;n<t.length;n++){const i=t[n];if(e.neighboringTiles&&e.neighboringTiles[i]){const t=this.getTileByID(i);r(e,t),r(t,e)}}function r(e,t){if(!e.dem||e.dem.borderReady)return;e.needsHillshadePrepare=!0,e.needsDEMTextureUpload=!0;let r=t.tileID.canonical.x-e.tileID.canonical.x;const n=t.tileID.canonical.y-e.tileID.canonical.y,i=Math.pow(2,e.tileID.canonical.z),s=t.tileID.key;0===r&&0===n||Math.abs(n)>1||(Math.abs(r)>1&&(1===Math.abs(r+i)?r+=i:1===Math.abs(r-i)&&(r-=i)),t.dem&&e.dem&&(e.dem.backfillBorder(t.dem,r,n),e.neighboringTiles&&e.neighboringTiles[s]&&(e.neighboringTiles[s].backfilled=!0)))}}getTile(e){return this.getTileByID(e.key)}getTileByID(e){return this._tiles[e]}_retainLoadedChildren(e,t,r,n){for(const i in this._tiles){let s=this._tiles[i];if(n[i]||!s.hasData()||s.tileID.overscaledZ<=t||s.tileID.overscaledZ>r)continue;let o=s.tileID;for(;s&&s.tileID.overscaledZ>t+1;){const e=s.tileID.scaledTo(s.tileID.overscaledZ-1);s=this._tiles[e.key],s&&s.hasData()&&(o=e)}let a=o;for(;a.overscaledZ>t;)if(a=a.scaledTo(a.overscaledZ-1),e[a.key]){n[o.key]=o;break}}}findLoadedParent(e,t){if(e.key in this._loadedParentTiles){const r=this._loadedParentTiles[e.key];return r&&r.tileID.overscaledZ>=t?r:null}for(let r=e.overscaledZ-1;r>=t;r--){const t=e.scaledTo(r),n=this._getLoadedTile(t);if(n)return n}}_getLoadedTile(e){const t=this._tiles[e.key];return t&&t.hasData()?t:this._cache.getByKey(this._source.reparseOverscaled?e.wrapped().key:e.canonical.key)}updateCacheSize(e,t){t=t||this._source.tileSize;const r=Math.ceil(e.width/t)+1,n=Math.ceil(e.height/t)+1,i=Math.floor(r*n*5),s="number"==typeof this._minTileCacheSize?Math.max(this._minTileCacheSize,i):i,o="number"==typeof this._maxTileCacheSize?Math.min(this._maxTileCacheSize,s):s;this._cache.setMaxSize(o)}handleWrapJump(e){const t=Math.round((e-(void 0===this._prevLng?e:this._prevLng))/360);if(this._prevLng=e,t){const e={};for(const r in this._tiles){const n=this._tiles[r];n.tileID=n.tileID.unwrapTo(n.tileID.wrap+t),e[n.tileID.key]=n}this._tiles=e;for(const t in this._timers)clearTimeout(this._timers[t]),delete this._timers[t];for(const t in this._tiles)this._setTileReloadTimer(+t,this._tiles[t])}}update(t,r,n,i,s){if(this.transform=t,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage)return;if(this.usedForTerrain&&!n)return;this.updateCacheSize(t,r),"globe"!==this.transform.projection.name&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const o="batched-model"===this._source.type;let a,l=this._source.maxzoom;const c=this.map&&this.map.painter?this.map.painter._terrain:null;if(c&&c.sourceCache===this&&c.attenuationRange()){const e=c.attenuationRange()[0],t=Math.floor(e)-Math.log2(c.getDemUpscale());l>t&&(l=t)}if(this.used||this.usedForTerrain){if(this._source.tileID)a=t.getVisibleUnwrappedCoordinates(this._source.tileID).map(t=>new e.aQ(t.canonical.z,t.wrap,t.canonical.z,t.canonical.x,t.canonical.y));else if(0!==this.tileCoverLift){const i=t.clone();i.tileCoverLift=this.tileCoverLift,a=i.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:o}),this._source.minzoom<=1&&"globe"===t.projection.name&&(a.push(new e.aQ(1,0,1,0,0)),a.push(new e.aQ(1,0,1,1,0)),a.push(new e.aQ(1,0,1,0,1)),a.push(new e.aQ(1,0,1,1,1)))}else if(a=t.coveringTiles({tileSize:r||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:l,roundZoom:this._source.roundZoom&&!n,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:o}),this._source.hasTile){const e=this._source.hasTile.bind(this._source);a=a.filter(t=>e(t))}}else a=[];if(a.length>0&&"globe"!==this.transform.projection.name&&!this.usedForTerrain&&!Ut(this._source.type)){const e=t.coveringZoomLevel({tileSize:r||this._source.tileSize,roundZoom:this._source.roundZoom&&!n}),l=Math.min(e,this._source.maxzoom);if(o){const e=t.extendTileCover(a,l);for(const t of e)a.push(t)}else if(s){const e=t.extendTileCoverToNearPlane(a,this.transform.getFrustum(l),l);for(const t of e)a.push(t)}else if(this.castsShadows&&i){const e=t.extendTileCover(a,l,i,16);for(const t of e)this._shadowCasterTiles[t.key]=!0,a.push(t)}}const u=this._updateRetainedTiles(a);if(Ut(this._source.type)&&0!==a.length){const t={},r={},n=Object.keys(u);for(const s of n){const n=u[s],i=this._tiles[s];if(!i||i.fadeEndTime&&i.fadeEndTime<=e.o.now())continue;const o=this.findLoadedParent(n,Math.max(n.overscaledZ-zt.maxOverzooming,this._source.minzoom));o&&(this._addTile(o.tileID),t[o.tileID.key]=o.tileID),r[s]=n}const i=a[a.length-1].overscaledZ;for(const e in this._tiles){const t=this._tiles[e];if(u[e]||!t.hasData())continue;let n=t.tileID;for(;n.overscaledZ>i;){n=n.scaledTo(n.overscaledZ-1);const i=this._tiles[n.key];if(i&&i.hasData()&&r[n.key]){u[e]=t.tileID;break}}}for(const e in t)u[e]||(this._coveredTiles[e]=!0,u[e]=t[e])}for(const e in u)this._tiles[e].clearFadeHold();const d=e.bv(this._tiles,u);for(const e of d){const t=this._tiles[e];t.hasSymbolBuckets&&!t.holdingForFade()?t.setHoldDuration(this.map._fadeDuration):t.hasSymbolBuckets&&!t.symbolFadeFinished()||this._removeTile(+e)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const e in this._tiles)this._tiles[e].holdingForFade()&&this._removeTile(+e)}_updateRetainedTiles(e){const t={};if(0===e.length)return t;const r={},n=e.reduce((e,t)=>Math.min(e,t.overscaledZ),1/0),i=e[0].overscaledZ,s=Math.max(i-zt.maxOverzooming,this._source.minzoom),o=Math.max(i+zt.maxUnderzooming,this._source.minzoom),a={};for(const l of e){const e=this._addTile(l);t[l.key]=l,e.hasData()||n<this._source.maxzoom&&(a[l.key]=l)}this._retainLoadedChildren(a,n,o,t);for(const l of e){let e=this._tiles[l.key];if(e.hasData())continue;if(l.canonical.z>=this._source.maxzoom){const e=l.children(this._source.maxzoom)[0],r=this.getTile(e);if(r&&r.hasData()){t[e.key]=e;continue}}else{const e=l.children(this._source.maxzoom);if(t[e[0].key]&&t[e[1].key]&&t[e[2].key]&&t[e[3].key])continue}let n=e.wasRequested();for(let i=l.overscaledZ-1;i>=s;--i){const s=l.scaledTo(i);if(r[s.key])break;if(r[s.key]=!0,e=this.getTile(s),!e&&n&&(e=this._addTile(s)),e&&(t[s.key]=s,n=e.wasRequested(),e.hasData()))break}}return t}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const e in this._tiles){const t=[];let r,n=this._tiles[e].tileID;for(;n.overscaledZ>0;){if(n.key in this._loadedParentTiles){r=this._loadedParentTiles[n.key];break}t.push(n.key);const e=n.scaledTo(n.overscaledZ-1);if(r=this._getLoadedTile(e),r)break;n=e}for(const e of t)this._loadedParentTiles[e]=r}}_addTile(t){let r=this._tiles[t.key];if(r)return!0!==r.isExtraShadowCaster||!!this._shadowCasterTiles[t.key]||this._reloadTile(t.key,"reloading"),r;r=this._cache.getAndRemove(t),r&&(this._setTileReloadTimer(t.key,r),r.tileID=t,this._state.initializeTileState(r,this.map?this.map.painter:null),this._cacheTimers[t.key]&&(clearTimeout(this._cacheTimers[t.key]),delete this._cacheTimers[t.key],this._setTileReloadTimer(t.key,r)));const n=Boolean(r);if(!n){const e=this.map?this.map.painter:null,n=this._source.tileSize*t.overscaleFactor();r="raster-array"===this._source.type?new Dt(t,n,this.transform.tileZoom,e,this._isRaster):new Rt(t,n,this.transform.tileZoom,e,this._isRaster,this._source.worldview),this._loadTile(r,this._tileLoaded.bind(this,r,t.key,r.state))}return r.uses++,this._tiles[t.key]=r,n||this._source.fire(new e.z("dataloading",{tile:r,coord:r.tileID,dataType:"source"})),r}_setTileReloadTimer(e,t){e in this._timers&&(clearTimeout(this._timers[e]),delete this._timers[e]);const r=t.getExpiryTimeout();r&&(this._timers[e]=setTimeout(()=>{this._reloadTile(e,"expired"),delete this._timers[e]},r))}_removeTile(e){const t=this._tiles[e];t&&(t.uses--,delete this._tiles[e],this._timers[e]&&(clearTimeout(this._timers[e]),delete this._timers[e]),t.uses>0||(t.hasData()&&"reloading"!==t.state||"empty"===t.state?this._cache.add(t.tileID,t,t.getExpiryTimeout()):(t.aborted=!0,this._abortTile(t),this._unloadTile(t))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const e in this._tiles)this._removeTile(+e);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(t,r,n){const i=[],s=this.transform;if(!s)return i;const o="globe"===s.projection.name,a=e.aF(s.center.lng);for(const l in this._tiles){const c=this._tiles[l];if(n&&c.clearQueryDebugViz(),c.holdingForFade())continue;let u;if(o){const t=c.tileID.canonical;if(0===t.z){const r=[Math.abs(e.aA(a,...Vt(t,-1))-a),Math.abs(e.aA(a,...Vt(t,1))-a)];u=[0,2*r.indexOf(Math.min(...r))-1]}else{const r=[Math.abs(e.aA(a,...Vt(t,-1))-a),Math.abs(e.aA(a,...Vt(t,0))-a),Math.abs(e.aA(a,...Vt(t,1))-a)];u=[r.indexOf(Math.min(...r))-1]}}else u=[0];for(const e of u){const n=t.containsTile(c,s,r,e);n&&i.push(n)}}return i}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(e){return this._getRenderableCoordinates(e)}_getRenderableCoordinates(e,t){const r=this.getRenderableIds(e,t).map(e=>this._tiles[e].tileID),n="globe"===this.transform.projection.name;for(const i of r)i.projMatrix=this.transform.calculateProjMatrix(i.toUnwrapped()),i.expandedProjMatrix=n?this.transform.calculateProjMatrix(i.toUnwrapped(),!1,!0):i.projMatrix;return r}sortCoordinatesByDistance(e){const t=e.slice(),r=this.transform._camera.position,n=this.transform._camera.forward(),i={};for(const s of t){const e=1/(1<<s.canonical.z);i[s.key]=((s.canonical.x+.5)*e+s.wrap-r[0])*n[0]+((s.canonical.y+.5)*e-r[1])*n[1]-r[2]*n[2]}return t.sort((e,t)=>i[e.key]-i[t.key]),t}hasTransition(){if(this._source.hasTransition())return!0;if(Ut(this._source.type))for(const t in this._tiles){const r=this._tiles[t];if(void 0!==r.fadeEndTime&&r.fadeEndTime>=e.o.now())return!0}return!1}setFeatureState(e,t,r){this._state.updateState(e=e||"_geojsonTileLayer",t,r)}removeFeatureState(e,t,r){this._state.removeFeatureState(e=e||"_geojsonTileLayer",t,r)}getFeatureState(e,t){return this._state.getState(e=e||"_geojsonTileLayer",t)}setDependencies(e,t,r){const n=this._tiles[e];n&&n.setDependencies(t,r)}reloadTilesForDependencies(e,t){for(const r in this._tiles)this._tiles[r].hasDependency(e,t)&&this._reloadTile(+r,"reloading");this._cache.filter(r=>!r.hasDependency(e,t))}_preloadTiles(t,r){if(!this._sourceLoaded){const e=()=>{this._sourceLoaded&&(this._source.off("data",e),this._preloadTiles(t,r))};return void this._source.on("data",e)}const n=new Map,i=Array.isArray(t)?t:[t],s=this.map.painter.terrain,o=this.usedForTerrain&&s?s.getScaledDemTileSize():this._source.tileSize;for(const e of i){const t=e.coveringTiles({tileSize:o,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const e of t)n.set(e.key,e);this.usedForTerrain&&e.updateElevation(!1)}const a=Array.from(n.values());e.bw(a,(e,t)=>{const r=new Rt(e,this._source.tileSize*e.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(r,e=>{"raster-dem"===this._source.type&&r.dem&&this._backfillDEM(r),t(e,r)})},r)}}function Bt(e,t){const r=Math.abs(2*e.wrap)-+(e.wrap<0),n=Math.abs(2*t.wrap)-+(t.wrap<0);return e.overscaledZ-t.overscaledZ||n-r||t.canonical.y-e.canonical.y||t.canonical.x-e.canonical.x}function Ut(e){return"raster"===e||"image"===e||"video"===e||"custom"===e}function Vt(e,t){const r=1<<e.z;return[e.x/r+t,(e.x+1)/r+t]}zt.maxOverzooming=10,zt.maxUnderzooming=3;class qt{constructor(e){this.style=e,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const e=!1,t=!1;for(const r in this.style._mergedLayers){const n=this.style._mergedLayers[r];if("fill-extrusion"===n.type||"building"===n.type)this.layers.push({layer:n,visible:e,visibilityChanged:t});else if("model"===n.type){const r=this.style.getLayerSource(n);r&&"batched-model"===r.type&&this.layers.push({layer:n,visible:e,visibilityChanged:t})}}}onNewFrame(e){this.layersGotHidden=!1;for(const t of this.layers){const r=t.layer;let n=!1;"fill-extrusion"===r.type?n=!r.isHidden(e)&&r.paint.get("fill-extrusion-opacity")>0:"building"===r.type?n=!r.isHidden(e)&&r.paint.get("building-opacity")>0:"model"===r.type&&(n=!r.isHidden(e)&&r.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!n&&t.visible,t.visible=n}}updateZOffset(e,t){this.currentBuildingBuckets=[];for(const n of this.layers){const e=n.layer,r=this.style.getLayerSourceCache(e);let i=1;"fill-extrusion"===e.type?i=n.visible?e.paint.get("fill-extrusion-vertical-scale"):0:"building"===e.type&&(i=n.visible?e.paint.get("building-vertical-scale"):0);let s=r?r.getTile(t):null;if(!s&&r)for(const n in r._tiles){const e=r._tiles[n];if(t.canonical.isChildOf(e.tileID.canonical)){s=e;break}}this.currentBuildingBuckets.push({bucket:s?s.getBucket(e):null,tileID:s?s.tileID:t,verticalScale:i})}e.hasAnyZOffset=!1;let r=!1;for(let n=0;n<e.symbolInstances.length;n++){const i=e.symbolInstances.get(n),s=i.zOffset,o=this._getHeightAtTileOffset(t,i.tileAnchorX,i.tileAnchorY);i.zOffset=o!==Number.NEGATIVE_INFINITY?o:s,r||s===i.zOffset||(r=!0),e.hasAnyZOffset||0===i.zOffset||(e.hasAnyZOffset=!0)}r&&(e.zOffsetBuffersNeedUpload=!0,e.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(t,r,n,i){let s=r,o=n;if(t.canonical.z!==i.canonical.z){const a=i.canonical,l=1/(1<<t.canonical.z-a.z);s=(r+t.canonical.x*e.al)*l-a.x*e.al|0,o=(n+t.canonical.y*e.al)*l-a.y*e.al|0}return{tileX:s,tileY:o}}_getHeightAtTileOffset(e,t,r){let n,i;for(let s=0;s<this.layers.length;++s){const o=this.layers[s].layer;if("fill-extrusion"!==o.type&&"building"!==o.type)continue;const{bucket:a,tileID:l,verticalScale:c}=this.currentBuildingBuckets[s];if(!a)continue;const{tileX:u,tileY:d}=this._mapCoordToOverlappingTile(e,t,r,l),h=a.getHeightAtTileCoord(u,d);h&&void 0!==h.height&&(h.hidden?n=h.height:i=Math.max(h.height*c,i||0))}if(void 0!==i)return i;for(let s=0;s<this.layers.length;++s){const i=this.layers[s];if("model"!==i.layer.type||!i.visible)continue;const{bucket:o,tileID:a}=this.currentBuildingBuckets[s];if(!o)continue;const{tileX:l,tileY:c}=this._mapCoordToOverlappingTile(e,t,r,a),u=o.getHeightAtTileCoord(l,c);if(u&&!u.hidden)return void 0===u.height&&void 0!==n?Math.min(u.maxHeight,n)*u.verticalScale:u.height?u.height*u.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Wt(t,r){const n={};for(const e in t)"ref"!==e&&(n[e]=t[e]);return e.bx.forEach(e=>{e in r&&(n[e]=r[e])}),n}function Ht(e){e=e.slice();const t=Object.create(null);for(let r=0;r<e.length;r++)t[e[r].id]=e[r];for(let r=0;r<e.length;r++)"ref"in e[r]&&(e[r]=Wt(e[r],t[e[r].ref]));return e}const Gt={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Zt(e,t,r){r.push({command:Gt.addSource,args:[e,t[e]]})}function Kt(e,t,r){t.push({command:Gt.removeSource,args:[e]}),r[e]=!0}function Yt(e,t,r,n){Kt(e,r,n),Zt(e,t,r)}function Xt(t,r,n){let i;for(i in t[n])if(t[n].hasOwnProperty(i)&&"data"!==i&&!e.by(t[n][i],r[n][i]))return!1;for(i in r[n])if(r[n].hasOwnProperty(i)&&"data"!==i&&!e.by(t[n][i],r[n][i]))return!1;return!0}function Jt(t,r,n,i,s,o){let a;for(a in r=r||{},t=t||{})t.hasOwnProperty(a)&&(e.by(t[a],r[a])||n.push({command:o,args:[i,a,r[a],s]}));for(a in r)r.hasOwnProperty(a)&&!t.hasOwnProperty(a)&&(e.by(t[a],r[a])||n.push({command:o,args:[i,a,r[a],s]}))}function Qt(e){return e.id}function $t(e,t){return e[t.id]=t,e}function er(t,r,n){const i=r.createTileMatrix(t,t.worldSize,n.toUnwrapped());return e.aB(new Float32Array(16),t.projMatrix,i)}function tr(e,t,r){if(t.projection.name===r.projection.name)return e.projMatrix;const n=r.clone();return n.setProjection(t.projection),er(n,t.getProjection(),e)}function rr(e,t,r){return t.name===r.projection.name?e.projMatrix:er(r,t,e)}class nr{constructor(e,t){this.reset(e,t)}reset(e,t){this.points=e||[],this._distances=[0];for(let r=1;r<this.points.length;r++)this._distances[r]=this._distances[r-1]+this.points[r].dist(this.points[r-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(t||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(t){if(1===this.points.length)return this.points[0];t=e.aA(t,0,1);let r=1,n=this._distances[r];const i=t*this.paddedLength+this.padding;for(;n<i&&r<this._distances.length;)n=this._distances[++r];const s=r-1,o=this._distances[s],a=n-o,l=a>0?(i-o)/a:0;return this.points[s].mult(1-l).add(this.points[r].mult(l))}}class ir{constructor(e,t,r){const n=this.boxCells=[],i=this.circleCells=[];this.xCellCount=Math.ceil(e/r),this.yCellCount=Math.ceil(t/r);for(let s=0;s<this.xCellCount*this.yCellCount;s++)n.push([]),i.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=e,this.height=t,this.xScale=this.xCellCount/e,this.yScale=this.yCellCount/t,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(e,t,r,n,i){this._forEachCell(t,r,n,i,this._insertBoxCell,this.boxUid++),this.boxKeys.push(e),this.bboxes.push(t),this.bboxes.push(r),this.bboxes.push(n),this.bboxes.push(i)}insertCircle(e,t,r,n){this._forEachCell(t-n,r-n,t+n,r+n,this._insertCircleCell,this.circleUid++),this.circleKeys.push(e),this.circles.push(t),this.circles.push(r),this.circles.push(n)}_insertBoxCell(e,t,r,n,i,s){this.boxCells[i].push(s)}_insertCircleCell(e,t,r,n,i,s){this.circleCells[i].push(s)}_query(e,t,r,n,i,s){if(r<0||e>this.width||n<0||t>this.height)return!i&&[];const o=[];if(e<=0&&t<=0&&this.width<=r&&this.height<=n){if(i)return!0;for(let e=0;e<this.boxKeys.length;e++)o.push({key:this.boxKeys[e],x1:this.bboxes[4*e],y1:this.bboxes[4*e+1],x2:this.bboxes[4*e+2],y2:this.bboxes[4*e+3]});for(let e=0;e<this.circleKeys.length;e++){const t=this.circles[3*e],r=this.circles[3*e+1],n=this.circles[3*e+2];o.push({key:this.circleKeys[e],x1:t-n,y1:r-n,x2:t+n,y2:r+n})}return s?o.filter(s):o}return this._forEachCell(e,t,r,n,this._queryCell,o,{hitTest:i,seenUids:{box:{},circle:{}}},s),i?o.length>0:o}_queryCircle(e,t,r,n,i){const s=e-r,o=e+r,a=t-r,l=t+r;if(o<0||s>this.width||l<0||a>this.height)return!n&&[];const c=[];return this._forEachCell(s,a,o,l,this._queryCellCircle,c,{hitTest:n,circle:{x:e,y:t,radius:r},seenUids:{box:{},circle:{}}},i),n?c.length>0:c}query(e,t,r,n,i){return this._query(e,t,r,n,!1,i)}hitTest(e,t,r,n,i){return this._query(e,t,r,n,!0,i)}hitTestCircle(e,t,r,n){return this._queryCircle(e,t,r,!0,n)}_queryCell(e,t,r,n,i,s,o,a){const l=o.seenUids,c=this.boxCells[i];if(null!==c){const i=this.bboxes;for(const u of c)if(!l.box[u]){l.box[u]=!0;const c=4*u;if(e<=i[c+2]&&t<=i[c+3]&&r>=i[c+0]&&n>=i[c+1]&&(!a||a(this.boxKeys[u]))){if(o.hitTest)return s.push(!0),!0;s.push({key:this.boxKeys[u],x1:i[c],y1:i[c+1],x2:i[c+2],y2:i[c+3]})}}}const u=this.circleCells[i];if(null!==u){const i=this.circles;for(const c of u)if(!l.circle[c]){l.circle[c]=!0;const u=3*c;if(this._circleAndRectCollide(i[u],i[u+1],i[u+2],e,t,r,n)&&(!a||a(this.circleKeys[c]))){if(o.hitTest)return s.push(!0),!0;{const e=i[u],t=i[u+1],r=i[u+2];s.push({key:this.circleKeys[c],x1:e-r,y1:t-r,x2:e+r,y2:t+r})}}}}}_queryCellCircle(e,t,r,n,i,s,o,a){const l=o.circle,c=o.seenUids,u=this.boxCells[i];if(null!==u){const e=this.bboxes;for(const t of u)if(!c.box[t]){c.box[t]=!0;const r=4*t;if(this._circleAndRectCollide(l.x,l.y,l.radius,e[r+0],e[r+1],e[r+2],e[r+3])&&(!a||a(this.boxKeys[t])))return s.push(!0),!0}}const d=this.circleCells[i];if(null!==d){const e=this.circles;for(const t of d)if(!c.circle[t]){c.circle[t]=!0;const r=3*t;if(this._circlesCollide(e[r],e[r+1],e[r+2],l.x,l.y,l.radius)&&(!a||a(this.circleKeys[t])))return s.push(!0),!0}}}_forEachCell(e,t,r,n,i,s,o,a){const l=this._convertToXCellCoord(e),c=this._convertToYCellCoord(t),u=this._convertToXCellCoord(r),d=this._convertToYCellCoord(n);for(let h=l;h<=u;h++)for(let l=c;l<=d;l++)if(i.call(this,e,t,r,n,this.xCellCount*l+h,s,o,a))return}_convertToXCellCoord(e){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(e*this.xScale)))}_convertToYCellCoord(e){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(e*this.yScale)))}_circlesCollide(e,t,r,n,i,s){const o=n-e,a=i-t,l=r+s;return l*l>o*o+a*a}_circleAndRectCollide(e,t,r,n,i,s,o){const a=(s-n)/2,l=Math.abs(e-(n+a));if(l>a+r)return!1;const c=(o-i)/2,u=Math.abs(t-(i+c));if(u>c+r)return!1;if(l<=a||u<=c)return!0;const d=l-a,h=u-c;return d*d+h*h<=r*r}}const sr={unknown:0,flipRequired:1,flipNotRequired:2},or=Math.tan(85*Math.PI/180);function ar(t,r,n,i,s,o,a){const l=e.bC();if(n)if("globe"===o.name){const t=e.bD(s,r);e.aB(l,l,t)}else{const t=e.bE([],a);l[0]=t[0],l[1]=t[1],l[4]=t[2],l[5]=t[3],i||e.bB(l,l,s.angle)}else e.aB(l,s.labelPlaneMatrix,t);return l}function lr(e,t,r,n,i,s,o){const a=ar(e,t,r,n,i,s,o);return"globe"===s.name&&r||(a[2]=a[6]=a[10]=a[14]=0),a}function cr(t,r,n,i,s,o,a){if(n){if("globe"===o.name){const l=ar(t,r,n,i,s,o,a);return e.bl(l,l),e.aB(l,t,l),l}{const r=e.bz(t),n=e.bA([]);return n[0]=a[0],n[1]=a[1],n[4]=a[2],n[5]=a[3],e.aB(r,r,n),i||e.bB(r,r,-s.angle),r}}return s.glCoordMatrix}function ur(t,r,n,i){const s=[t,r,n,1];n?e.aC(s,s,i):br(s,s,i);const o=s[3];return s[0]/=o,s[1]/=o,s[2]/=o,s}function dr(e,t){return Math.min(.5+e/t*.5,1.5)}function hr(e,t){const r=e[0]/e[3],n=e[1]/e[3];return r>=-t[0]&&r<=t[0]&&n>=-t[1]&&n<=t[1]}function pr(t,r,n,i,s,o,a,l,c,u){let d=arguments.length>10&&void 0!==arguments[10]?arguments[10]:1;const h=n.transform,p=i?t.textSizeData:t.iconSizeData,m=e.bK(p,n.transform.zoom,d),f="globe"===h.projection.name,g=[256/n.width*2+1,256/n.height*2+1],y=i?t.text.dynamicLayoutVertexArray:t.icon.dynamicLayoutVertexArray;y.clear();let _=null;f&&(_=i?t.text.globeExtVertexArray:t.icon.globeExtVertexArray);const v=t.lineVertexArray,x=i?t.text.placedSymbolArray:t.icon.placedSymbolArray,b=n.transform.width/n.transform.height;let w,j=!1;for(let S=0;S<x.length;S++){const i=x.get(S),{numGlyphs:d,writingMode:f}=i;if(f!==e.bL.vertical||j||w===e.bL.horizontal||(j=!0),w=f,(i.hidden||f===e.bL.vertical)&&!j){xr(d,y);continue}j=!1;const T=new e.P(i.tileAnchorX,i.tileAnchorY),k="road"===t.elevationType,A=!!h.elevation||k;let{x:C,y:E,z:N}=h.projection.projectTilePoint(T.x,T.y,u.canonical),I=null;if(A){const e=k?t.getElevationFeatureForText(S):null;I={getElevation:c,elevation:h.elevation,elevationFeature:e};const[r,n,i]=c(T,h.elevation,e);C+=r,E+=n,N+=i}const P=[C,E,N,1];if(e.aC(P,P,r),!hr(P,g)){xr(d,y);continue}const M=P[3],L=dr(n.transform.getCameraToCenterDistance(h.projection),M),R=e.bM(p,m,i),D=a?R/L:R*L,F=ur(C,E,N,s);if(F[3]<=0){xr(d,y);continue}let O={};const z=e.an(t.layers[0].layout.get("text-max-angle")),B=Math.cos(z),U=a?null:I,V=gr(i,D,!1,l,r,s,o,t.glyphOffsetArray,v,y,_,F,T,O,b,U,h.projection,u,a,B);j=V.useVertical,U&&V.needsFlipping&&(O={}),(V.notEnoughRoom||j||V.needsFlipping&&gr(i,D,!0,l,r,s,o,t.glyphOffsetArray,v,y,_,F,T,O,b,U,h.projection,u,a,B).notEnoughRoom)&&xr(d,y)}i?(t.text.dynamicLayoutVertexBuffer.updateData(y),_&&t.text.globeExtVertexBuffer&&t.text.globeExtVertexBuffer.updateData(_)):(t.icon.dynamicLayoutVertexBuffer.updateData(y),_&&t.icon.globeExtVertexBuffer&&t.icon.globeExtVertexBuffer.updateData(_))}function mr(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g){const{lineStartIndex:y,glyphStartIndex:_,segment:v}=a,x=_+a.numGlyphs,b=y+a.lineLength,w=t.getoffsetX(_),j=t.getoffsetX(x-1),S=vr(e*w,r,n,i,s,o,v,y,b,l,c,u,d,h,!0,p,m,f,g);if(!S)return null;const T=vr(e*j,r,n,i,s,o,v,y,b,l,c,u,d,h,!0,p,m,f,g);return T?{first:S,last:T}:null}function fr(t,r,n,i){return t===e.bL.horizontal&&Math.abs(i)>Math.abs(n)?{useVertical:!0}:t===e.bL.vertical?i>0?{needsFlipping:!0}:null:r!==sr.unknown&&function(e,t){return 0===e||Math.abs(t/e)>or}(n,i)?r===sr.flipRequired?{needsFlipping:!0}:null:n<0?{needsFlipping:!0}:null}function gr(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x){const b=r/24,w=t.lineOffsetX*b,j=t.lineOffsetY*b,{lineStartIndex:S,glyphStartIndex:T,numGlyphs:k,segment:A,writingMode:C,flipState:E}=t,N=S+t.lineLength,I=t=>{if(d){const[r,n,i]=t.up,s=u.length;e.bN(d,s+0,r,n,i),e.bN(d,s+1,r,n,i),e.bN(d,s+2,r,n,i),e.bN(d,s+3,r,n,i)}const[r,n,i]=t.point;e.bO(u,r,n,i,t.angle)};if(k>1){const e=mr(b,l,w,j,n,h,p,t,c,o,m,g,!1,y,_,v,x);if(!e)return{notEnoughRoom:!0};if(i&&!n){let[r,n,i]=e.first.point,[s,o,l]=e.last.point;[r,n]=ur(r,n,i,a),[s,o]=ur(s,o,l,a);const c=fr(C,E,(s-r)*f,o-n);if(t.flipState=c&&c.needsFlipping?sr.flipRequired:sr.flipNotRequired,c)return c}I(e.first);for(let t=T+1;t<T+k-1;t++){const e=vr(b*l.getoffsetX(t),w,j,n,h,p,A,S,N,c,o,m,g,!1,!1,y,_,v,x);if(!e)return u.length-=4*(t-T),{notEnoughRoom:!0};I(e)}I(e.last)}else{if(i&&!n){const r=ur(p.x,p.y,0,s),n=S+A+1,i=new e.P(c.getx(n),c.gety(n)),o=ur(i.x,i.y,0,s),a=o[3]>0?o:_r(p,i,r,1,s,void 0,y,_.canonical),l=fr(C,E,(a[0]-r[0])*f,a[1]-r[1]);if(t.flipState=l&&l.needsFlipping?sr.flipRequired:sr.flipNotRequired,l)return l}const r=vr(b*l.getoffsetX(T),w,j,n,h,p,A,S,N,c,o,m,g,!1,!1,y,_,v,x);if(!r)return{notEnoughRoom:!0};I(r)}return{}}function yr(e,t,r,n,i){const{x:s,y:o,z:a}=n.projectTilePoint(e.x,e.y,t);if(!i)return ur(s,o,a,r);const[l,c,u]=i.getElevation(e,i.elevation,i.elevationFeature);return ur(s+l,o+c,a+u,r)}function _r(t,r,n,i,s,o,a,l){const c=yr(t.sub(r)._unit()._add(t),l,s,a,o);return e.av(c,n,c),e.aw(c,c),e.bH(c,n,c,i)}function vr(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v){const x=i?t-r:t+r;let b=x>0?1:-1,w=0;i&&(b*=-1,w=Math.PI),b<0&&(w+=Math.PI);let j=l+a+(b>0?0:1)|0,S=s,T=s,k=0,A=0;const C=Math.abs(x),E=[],N=[];let I=o,P=I,M=e.bF([]);const L=()=>_r(P,I,T,C-k+1,d,p,g,y.canonical);for(;k+A<=C;){if(j+=b,j<l||j>=c)return null;if(T=S,P=I,E.push(T),m&&N.push(P),I=new e.P(u.getx(j),u.gety(j)),S=h[j],!S){const e=yr(I,y.canonical,d,g,p);S=e[3]>0?h[j]=e:L()}k+=A;const t=e.av([],S,T),r=e.bG(T,S);if(n&&r>0&&A>0&&e.bJ(M,t)/(A*r)<v)return null;A=r,M=t}f&&p&&(h[j]&&(S=L(),A=e.bG(T,S),M=e.av([],S,T)),h[j]=S);const R=(C-k)/A,D=I.sub(P)._mult(R)._add(P),F=e.bH([],T,M,R);let O=[0,0,1],z=M[0],B=M[1];if(_&&(O=g.upVector(y.canonical,D.x,D.y),0!==O[0]||0!==O[1]||1!==O[2])){const t=[O[2],0,-O[0]],r=e.bI([],O,t);e.aw(t,t),e.aw(r,r),z=e.bJ(M,t),B=e.bJ(M,r)}if(n){const t=e.bI([],O,M);e.aw(t,t),e.bH(F,F,t,n*b)}const U=w+Math.atan2(B,z);return E.push(F),m&&N.push(D),{point:F,angle:U,path:E,tilePath:N,up:O}}function xr(e,t){const r=t.length,n=r+4*e;t.resize(n),t.float32.fill(-1/0,4*r,4*n)}function br(e,t,r){const n=t[0],i=t[1];return e[0]=r[0]*n+r[4]*i+r[12],e[1]=r[1]*n+r[5]*i+r[13],e[3]=r[3]*n+r[7]*i+r[15],e}const wr=100;class jr{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:new ir(e.width+200,e.height+200,25),n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:new ir(e.width+200,e.height+200,25);this.transform=e,this.grid=r,this.ignoredGrid=n,this.pitchfactor=Math.cos(e._pitch)*e.cameraToCenterDistance,this.screenRightBoundary=e.width+wr,this.screenBottomBoundary=e.height+wr,this.gridRightBoundary=e.width+200,this.gridBottomBoundary=e.height+200,this.fogState=t}placeCollisionBox(t,r,n,i,s,o,a,l,c,u,d){let h=n.projectedAnchorX,p=n.projectedAnchorY,m=n.projectedAnchorZ;const f=n.tileAnchorX,g=n.tileAnchorY,y=n.elevation,_=n.tileID,v=t.getProjection();if(y&&_){const[e,t,r]=v.upVector(_.canonical,n.tileAnchorX,n.tileAnchorY),i=v.upVectorScale(_.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;h+=e*y*i,p+=t*y*i,m+=r*y*i}const x="globe"===t.projection.name,b="globe"===t.projection.name?e.aj(this.transform.zoom):0;if(_&&x&&b<1&&!o){const t=1<<_.canonical.z,r=e.bP(f,g);e.bQ(r,r,1/e.al),e.bR(r,r,e.bP(_.canonical.x,_.canonical.y)),e.bQ(r,r,1/t),e.bS(r,r,e.bP(i[0],i[1])),r[0]=e.bT(r[0],-.5,.5),e.bQ(r,r,e.al);const n=e.bU(r[0],r[1],e.al/(2*Math.PI),1);e.aC(n,n,s),h=e.ak(h,n[0],b),p=e.ak(p,n[1],b),m=e.ak(m,n[2],b)}const w=this.projectAndGetPerspectiveRatio(u,h,p,m,n.tileID,"globe"===v.name||!!y||this.transform.pitch>0,v),j=c*w.perspectiveRatio,S=(n.x1*r+a.x-n.padding)*j+w.point.x,T=(n.y1*r+a.y-n.padding)*j+w.point.y,k=(n.x2*r+a.x+n.padding)*j+w.point.x,A=(n.y2*r+a.y+n.padding)*j+w.point.y,C=w.perspectiveRatio<=.55||w.occluded;return!this.isInsideGrid(S,T,k,A)||!l&&this.grid.hitTest(S,T,k,A,d)||C?{box:[],offscreen:!1,occluded:w.occluded}:{box:[S,T,k,A],offscreen:this.isOffscreen(S,T,k,A),occluded:!1}}placeCollisionCircles(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g){const y=[],_=this.transform.elevation,v=t.getProjection(),x="road"===t.elevationType,b=!!_||x,w=e.bV.getAtTileOffsetFunc(g,this.transform.center.lat,this.transform.worldSize,v),j=new e.P(n.tileAnchorX,n.tileAnchorY),S=new e.P(n.tileAnchorX,n.tileAnchorY);let{x:T,y:k,z:A}=v.projectTilePoint(S.x,S.y,g.canonical),C=null;if(b){const e=x?t.getElevationFeatureForText(i):null;C={getElevation:w,elevation:_,elevationFeature:e};const[r,n,s]=w(j,_,e);T+=r,k+=n,A+=s}const E="globe"===v.name,N=this.projectAndGetPerspectiveRatio(l,T,k,A,g,E||!!_||this.transform.pitch>0,v),{perspectiveRatio:I}=N,P=(h?a/I:a*I)/e.bY,M=ur(T,k,A,c),L=n.lineOffsetX*P,R=n.lineOffsetY*P,D=e.an(t.layers[0].layout.get("text-max-angle")),F=Math.cos(D),O=N.signedDistanceFromCamera>0?mr(P,o,L,R,x&&1===n.flipState,M,S,n,s,c,{},b&&!h?C:null,h&&b,v,g,h,F):null;let z=!1,B=!1,U=!0;if(O&&!N.occluded){const t=.5*m*I+f,n=new e.P(-100,-100),i=new e.P(this.screenRightBoundary,this.screenBottomBoundary),s=new nr,{first:o,last:a}=O,l=o.path.length;let c=[];for(let e=l-1;e>=1;e--)c.push(o.path[e]);for(let e=1;e<a.path.length;e++)c.push(a.path[e]);const h=2.5*t;u&&(c=c.map((e,t)=>{let[r,n,i]=e;return b&&!E&&(i=w(t<l-1?o.tilePath[l-1-t]:a.tilePath[t-l+2],_,C.elevationFeature)[2]),ur(r,n,i,u)}),c.some(e=>e[3]<=0)&&(c=[]));let g=[];if(c.length>0){let t=1/0,r=-1/0,s=1/0,o=-1/0;for(const e of c)t=Math.min(t,e[0]),s=Math.min(s,e[1]),r=Math.max(r,e[0]),o=Math.max(o,e[1]);r>=n.x&&t<=i.x&&o>=n.y&&s<=i.y&&(g=[c.map(t=>new e.P(t[0],t[1]))],(t<n.x||r>i.x||s<n.y||o>i.y)&&(g=e.bW(g,n.x,n.y,i.x,i.y)))}for(const e of g){s.reset(e,.25*t);let n=0;n=s.length<=.5*t?1:Math.ceil(s.paddedLength/h)+1;for(let e=0;e<n;e++){const i=e/Math.max(n-1,1),o=s.lerp(i),a=o.x+wr,l=o.y+wr;y.push(a,l,t,0);const c=a-t,u=l-t,h=a+t,m=l+t;if(U=U&&this.isOffscreen(c,u,h,m),B=B||this.isInsideGrid(c,u,h,m),!r&&this.grid.hitTestCircle(a,l,t,p)&&(z=!0,!d))return{circles:[],offscreen:!1,collisionDetected:z,occluded:!1}}}}return{circles:!d&&z||!B?[]:y,offscreen:U,collisionDetected:z,occluded:N.occluded}}queryRenderedSymbols(t){if(0===t.length||0===this.grid.keysLength()&&0===this.ignoredGrid.keysLength())return{};const r=[];let n=1/0,i=1/0,s=-1/0,o=-1/0;for(const u of t){const t=new e.P(u.x+wr,u.y+wr);n=Math.min(n,t.x),i=Math.min(i,t.y),s=Math.max(s,t.x),o=Math.max(o,t.y),r.push(t)}const a=this.grid.query(n,i,s,o).concat(this.ignoredGrid.query(n,i,s,o)),l={},c={};for(const u of a){const t=u.key;if(void 0===l[t.bucketInstanceId]&&(l[t.bucketInstanceId]={}),l[t.bucketInstanceId][t.featureIndex])continue;const n=[new e.P(u.x1,u.y1),new e.P(u.x2,u.y1),new e.P(u.x2,u.y2),new e.P(u.x1,u.y2)];e.bX(r,n)&&(l[t.bucketInstanceId][t.featureIndex]=!0,void 0===c[t.bucketInstanceId]&&(c[t.bucketInstanceId]=[]),c[t.bucketInstanceId].push(t.featureIndex))}return c}insertCollisionBox(e,t,r,n,i){(t?this.ignoredGrid:this.grid).insert({bucketInstanceId:r,featureIndex:n,collisionGroupID:i},e[0],e[1],e[2],e[3])}insertCollisionCircles(e,t,r,n,i){const s=t?this.ignoredGrid:this.grid,o={bucketInstanceId:r,featureIndex:n,collisionGroupID:i};for(let a=0;a<e.length;a+=4)s.insertCircle(o,e[a],e[a+1],e[a+2])}projectAndGetPerspectiveRatio(t,r,n,i,s,o,a){const l=[r,n,i,1];let c=!1;if(i||this.transform.pitch>0){if(e.aC(l,l,t),this.fogState&&s&&"globe"!==a.name){const t=function(t,r,n,i,s,o){const a=o.calculateFogTileMatrix(s),l=[r,n,i];return e.af(l,l,a),Ke(t,e.ag(l),o.pitch,o._fov)}(this.fogState,r,n,i,s.toUnwrapped(),this.transform);c=t>.9}}else br(l,l,t);const u=l[3];return{point:new e.P((l[0]/u+1)/2*this.transform.width+wr,(-l[1]/u+1)/2*this.transform.height+wr),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(a)/u*.5,1.5),signedDistanceFromCamera:u,occluded:o&&l[2]>u||c}}isOffscreen(e,t,r,n){return r<wr||e>=this.screenRightBoundary||n<wr||t>this.screenBottomBoundary}isInsideGrid(e,t,r,n){return r>=0&&e<this.gridRightBoundary&&n>=0&&t<this.gridBottomBoundary}getViewportMatrix(){const t=e.bA([]);return e.br(t,t,[-100,-100,0]),t}}class Sr{constructor(e,t,r,n){this.opacity=e?Math.max(0,Math.min(1,e.opacity+(e.placed?t:-t))):n&&r?1:0,this.placed=r}isHidden(){return 0===this.opacity&&!this.placed}}class Tr{constructor(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.text=new Sr(e?e.text:null,t,r,i),this.icon=new Sr(e?e.icon:null,t,n,i),this.clipped=s}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class kr{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];this.text=e,this.icon=t,this.skipFade=r,this.clipped=n}}class Ar{constructor(){this.invProjMatrix=e.bC(),this.viewportMatrix=e.bC(),this.circles=[]}}class Cr{constructor(e,t,r,n,i){this.bucketInstanceId=e,this.featureIndex=t,this.sourceLayerIndex=r,this.bucketIndex=n,this.tileID=i}}class Er{constructor(e){this.crossSourceCollisions=e,this.maxGroupID=0,this.collisionGroups={}}get(e){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[e]){const t=++this.maxGroupID;this.collisionGroups[e]={ID:t,predicate:e=>e.collisionGroupID===t}}return this.collisionGroups[e]}}function Nr(t,r,n,i,s){const{horizontalAlign:o,verticalAlign:a}=e.c1(t),l=-(o-.5)*r,c=-(a-.5)*n,u=e.c2(t,i);return new e.P(l+u[0]*s,c+u[1]*s)}function Ir(t,r,n,i,s){const o=new e.P(t,r);return n&&o._rotate(i?s:-s),o}class Pr{constructor(e,t,r,n,i,s){this.transform=e.clone(),this.projection=e.projection.name,this.collisionIndex=new jr(this.transform,i),this.buildingIndex=s,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=t,this.retainedQueryData={},this.collisionGroups=new Er(r),this.collisionCircleArrays={},this.prevPlacement=n,n&&(n.prevPlacement=void 0),this.placedOrientations={},this.lastReplacementSourceUpdateTime=0}getBucketParts(t,r,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const o=n.getBucket(r),a=n.latestFeatureIndex;if(!o||!a||r.fqid!==o.layerIds[0])return;const l=o.layers[0].layout,c=o.layers[0].paint,u=n.collisionBoxArray,d=Math.pow(2,this.transform.zoom-n.tileID.overscaledZ),h=n.tileSize/e.al,p=n.tileID.toUnwrapped();this.transform.setProjection(o.projection);const m=(f=n.tileID,g=o.getProjection(),y=this.transform,g.name===this.projection?y.calculateProjMatrix(f.toUnwrapped()):er(y,g,f));var f,g,y;const _="map"===l.get("text-pitch-alignment"),v="map"===l.get("text-rotation-alignment");r.compileFilter(r.options);const x=r.dynamicFilter(),b=r.dynamicFilterNeedsFeature(),w=this.transform.calculatePixelsToTileUnitsMatrix(n),j=lr(m,n.tileID.canonical,_,v,this.transform,o.getProjection(),w);let S=null;const T=o.getProjection().createInversionMatrix(this.transform,n.tileID.canonical);if(_){const t=cr(m,n.tileID.canonical,_,v,this.transform,o.getProjection(),w);S=e.aB([],this.transform.labelPlaneMatrix,t)}let k=null;x&&n.latestFeatureIndex&&(k={unwrappedTileID:p,dynamicFilter:x,dynamicFilterNeedsFeature:b}),this.retainedQueryData[o.bucketInstanceId]=new Cr(o.bucketInstanceId,a,o.sourceLayerIndex,o.index,n.tileID);const[A,C]=o.layers[0].layout.get("text-size-scale-range"),E=e.aA(s,A,C),[N,I]=l.get("icon-size-scale-range"),P=e.aA(s,N,I),M={bucket:o,layout:l,paint:c,posMatrix:m,invMatrix:T,mercatorCenter:[e.aF(this.transform.center.lng),e.aJ(this.transform.center.lat)],textLabelPlaneMatrix:j,labelToScreenMatrix:S,clippingData:k,scale:d,textPixelRatio:h,holdingForFade:n.holdingForFade(),collisionBoxArray:u,partiallyEvaluatedTextSize:e.bK(o.textSizeData,this.transform.zoom,E),partiallyEvaluatedIconSize:e.bK(o.iconSizeData,this.transform.zoom,P),collisionGroup:this.collisionGroups.get(o.sourceID),latestFeatureIndex:n.latestFeatureIndex};if(i)for(const e of o.sortKeyRanges){const{sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i}=e;t.push({sortKey:r,symbolInstanceStart:n,symbolInstanceEnd:i,parameters:M})}else t.push({symbolInstanceStart:0,symbolInstanceEnd:o.symbolInstances.length,parameters:M})}attemptAnchorPlacement(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x){const{textOffset0:b,textOffset1:w,crossTileID:j}=m,S=[b,w],T=Nr(e,s,o,S,a),k=this.collisionIndex.placeCollisionBox(g,a,t,r,n,i,Ir(T.x,T.y,l,c,this.transform.angle),p,u,d,h.predicate);if(_){const e=g.getSymbolInstanceIconSize(x,this.transform.zoom,m.placedIconSymbolIndex);if(0===this.collisionIndex.placeCollisionBox(g,e,_,r,n,i,Ir(T.x,T.y,l,c,this.transform.angle),p,u,d,h.predicate).box.length)return}if(k.box.length>0){let t;return this.prevPlacement&&this.prevPlacement.variableOffsets[j]&&this.prevPlacement.placements[j]&&this.prevPlacement.placements[j].text&&(t=this.prevPlacement.variableOffsets[j].anchor),this.variableOffsets[j]={textOffset:S,width:s,height:o,anchor:e,textScale:a,prevAnchor:t},this.markUsedJustification(g,e,m,y),g.allowVerticalPlacement&&(this.markUsedOrientation(g,y,m),this.placedOrientations[j]=y),{shift:T,placedGlyphBoxes:k}}}placeLayerBucketPart(t,r,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:1;const{bucket:o,layout:a,paint:l,posMatrix:c,textLabelPlaneMatrix:u,labelToScreenMatrix:d,clippingData:h,textPixelRatio:p,mercatorCenter:m,invMatrix:f,holdingForFade:g,collisionBoxArray:y,partiallyEvaluatedTextSize:_,partiallyEvaluatedIconSize:v,collisionGroup:x,latestFeatureIndex:b}=t.parameters,w=a.get("text-optional"),j=a.get("icon-optional"),S=a.get("text-allow-overlap"),T=a.get("icon-allow-overlap"),k="map"===a.get("text-rotation-alignment"),A="map"===a.get("icon-rotation-alignment"),C="map"===a.get("text-pitch-alignment"),E=l.get("symbol-z-offset"),N="sea"===a.get("symbol-elevation-reference"),I=a.get("symbol-placement"),[P,M]=a.get("text-size-scale-range"),[L,R]=a.get("icon-size-scale-range"),D=e.aA(s,P,M),F=e.aA(s,L,R),O=a.get("text-variable-anchor"),z=k&&"point"!==I,B=A&&"point"!==I,U=O&&o.hasTextData(),V=o.hasIconTextFit()&&U&&o.hasIconData();this.transform.setProjection(o.projection);const q=U||z,W=B||V;let H=S&&(T||!o.hasIconData()||j),G=T&&(S||!o.hasTextData()||w);const Z=!E.isConstant();!o.collisionArrays&&y&&o.deserializeCollisionBoxes(y),n&&i&&o.updateCollisionDebugBuffers(this.transform.zoom,y,D,F);const K=(t,i,s)=>{const{crossTileID:l,numVerticalGlyphVertices:y}=t;let A=null;if(h&&h.dynamicFilterNeedsFeature||Z){const e=this.retainedQueryData[o.bucketInstanceId];A=b.loadFeature({featureIndex:t.featureIndex,bucketIndex:e.bucketIndex,sourceLayerIndex:e.sourceLayerIndex,layoutVertexArrayOffset:0});const r=A.properties?A.properties.worldview:null;if(o.localizable&&o.worldview&&"string"==typeof r)if("all"===r)A.properties.$localized=!0;else{if(!r.split(",").includes(o.worldview))return;A.properties.$localized=!0,A.properties.worldview=o.worldview}}if(h&&!(0,h.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch,worldview:o.worldview},A,this.retainedQueryData[o.bucketInstanceId].tileID.canonical,new e.P(t.tileAnchorX,t.tileAnchorY),this.transform.calculateDistanceTileData(h.unwrappedTileID)))return this.placements[l]=new kr(!1,!1,!1,!0),void r.add(l);const I=E.evaluate(A,{});if(r.has(l))return;if(g)return void(this.placements[l]=new kr(!1,!1,!1));let P=!1,M=!1,L=!0,R=!1,D=!1,F=null,z={box:null,offscreen:null,occluded:null},B={box:null},U=null,V=null,K=null,Y=0,X=0,J=0;s.textFeatureIndex?Y=s.textFeatureIndex:t.useRuntimeCollisionCircles&&(Y=t.featureIndex),s.verticalTextFeatureIndex&&(X=s.verticalTextFeatureIndex);const Q=o.elevationFeatures?o.elevationFeatures[t.elevationFeatureIndex]:void 0,$=r=>{r.tileID=this.retainedQueryData[o.bucketInstanceId].tileID;const n=this.transform.elevation;r.elevation=N?I:I+e.bV.getAtTileOffset(r.tileID,new e.P(r.tileAnchorX,r.tileAnchorY),n,Q),r.elevation+=t.zOffset},ee=s.textBox;if(ee){$(ee);const r=r=>{let n=e.bL.horizontal;if(o.allowVerticalPlacement&&!r&&this.prevPlacement){const e=this.prevPlacement.placedOrientations[l];e&&(this.placedOrientations[l]=e,n=e,this.markUsedOrientation(o,n,t))}return n},n=(t,r)=>{if(o.allowVerticalPlacement&&y>0&&s.verticalTextBox){for(const n of o.writingModes)if(n===e.bL.vertical?(z=r(),B=z):z=t(),z&&z.box&&z.box.length)break}else z=t()};if(O){let a=O;if(this.prevPlacement&&this.prevPlacement.variableOffsets[l]){const e=this.prevPlacement.variableOffsets[l];a.indexOf(e.anchor)>0&&(a=a.filter(t=>t!==e.anchor),a.unshift(e.anchor))}const u=(e,r,n)=>{const s=o.getSymbolInstanceTextSize(_,t,this.transform.zoom,i),l=(e.x2-e.x1)*s+2*e.padding,u=(e.y2-e.y1)*s+2*e.padding,d=t.hasIconTextFit&&!T?r:null;d&&$(d);let h={box:[],offscreen:!1,occluded:!1};const g=S?2*a.length:a.length;for(let y=0;y<g;++y){const r=this.attemptAnchorPlacement(a[y%a.length],e,m,f,q,l,u,s,k,C,p,c,x,y>=a.length,t,i,o,n,d,_,v);if(r&&(h=r.placedGlyphBoxes,h&&h.box&&h.box.length)){P=!0,F=r.shift;break}}return h};n(()=>u(ee,s.iconBox,e.bL.horizontal),()=>{const t=s.verticalTextBox;return t&&$(t),o.allowVerticalPlacement&&!(z&&z.box&&z.box.length)&&y>0&&t?u(t,s.verticalIconBox,e.bL.vertical):{box:null,offscreen:null,occluded:null}}),z&&(P=z.box,L=z.offscreen,R=z.occluded);const d=r(!(!z||!z.box));if(!P&&this.prevPlacement){const e=this.prevPlacement.variableOffsets[l];e&&(this.variableOffsets[l]=e,this.markUsedJustification(o,e.anchor,t,d))}}else{const a=(r,n)=>{const s=o.getSymbolInstanceTextSize(_,t,this.transform.zoom,i),a=this.collisionIndex.placeCollisionBox(o,s,r,m,f,q,new e.P(0,0),S,p,c,x.predicate);return a&&a.box&&a.box.length&&(this.markUsedOrientation(o,n,t),this.placedOrientations[l]=n),a};n(()=>a(ee,e.bL.horizontal),()=>{const t=s.verticalTextBox;return o.allowVerticalPlacement&&y>0&&t?($(t),a(t,e.bL.vertical)):{box:null,offscreen:null,occluded:null}}),r(!!(z&&z.box&&z.box.length))}}if(U=z,P=U&&U.box&&U.box.length>0,L=U&&U.offscreen,R=U&&U.occluded,t.useRuntimeCollisionCircles){const r=t.centerJustifiedTextSymbolIndex>=0?t.centerJustifiedTextSymbolIndex:t.verticalPlacedTextSymbolIndex,i=o.text.placedSymbolArray.get(r),s=e.bM(o.textSizeData,_,i),l=a.get("text-padding");V=this.collisionIndex.placeCollisionCircles(o,S,i,r,o.lineVertexArray,o.glyphOffsetArray,s,c,u,d,n,C,x.predicate,t.collisionCircleDiameter*s/e.bY,l,this.retainedQueryData[o.bucketInstanceId].tileID),P=S||V.circles.length>0&&!V.collisionDetected,L=L&&V.offscreen,R=V.occluded}if(s.iconFeatureIndex&&(J=s.iconFeatureIndex),s.iconBox){const r=r=>{$(r);const n=t.hasIconTextFit&&F?Ir(F.x,F.y,k,C,this.transform.angle):new e.P(0,0),i=o.getSymbolInstanceIconSize(v,this.transform.zoom,t.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(o,i,r,m,f,W,n,T,p,c,x.predicate)};B&&B.box&&B.box.length&&s.verticalIconBox?(K=r(s.verticalIconBox),M=K.box.length>0):(K=r(s.iconBox),M=K.box.length>0),L=L&&K.offscreen,D=K.occluded}const te=w||0===t.numHorizontalGlyphVertices&&0===y,re=j||0===t.numIconVertices;if(te||re?re?te||(M=M&&P):P=M&&P:M=P=M&&P,P&&U&&U.box&&this.collisionIndex.insertCollisionBox(U.box,a.get("text-ignore-placement"),o.bucketInstanceId,B&&B.box&&X?X:Y,x.ID),M&&K&&this.collisionIndex.insertCollisionBox(K.box,a.get("icon-ignore-placement"),o.bucketInstanceId,J,x.ID),V&&(P&&this.collisionIndex.insertCollisionCircles(V.circles,a.get("text-ignore-placement"),o.bucketInstanceId,Y,x.ID),n)){const e=o.bucketInstanceId;let t=this.collisionCircleArrays[e];void 0===t&&(t=this.collisionCircleArrays[e]=new Ar);for(let r=0;r<V.circles.length;r+=4)t.circles.push(V.circles[r+0]),t.circles.push(V.circles[r+1]),t.circles.push(V.circles[r+2]),t.circles.push(V.collisionDetected?1:0)}const ne="globe"!==o.projection.name;H=H&&(ne||!R),G=G&&(ne||!D),this.placements[l]=new kr(P||H,M||G,L||o.justReloaded),r.add(l)},Y=this.retainedQueryData[o.bucketInstanceId].tileID;if("offset"===o.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(o,Y),"road"===o.elevationType&&o.updateRoadElevation(Y.canonical),o.updateZOffset(),o.sortFeaturesByY){const t=o.getSortedSymbolIndexes(this.transform.angle);for(let e=t.length-1;e>=0;--e){const r=t[e];K(o.symbolInstances.get(r),r,o.collisionArrays[r])}o.hasAnyZOffset&&e.w("".concat(o.layerIds[0]," layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y"))}else if(o.hasAnyZOffset){const e=o.getSortedIndexesByZOffset();for(let t=0;t<e.length;++t){const r=e[t];K(o.symbolInstances.get(r),r,o.collisionArrays[r])}}else for(let e=t.symbolInstanceStart;e<t.symbolInstanceEnd;e++)K(o.symbolInstances.get(e),e,o.collisionArrays[e]);if(n&&o.bucketInstanceId in this.collisionCircleArrays){const t=this.collisionCircleArrays[o.bucketInstanceId];e.bl(t.invProjMatrix,c),t.viewportMatrix=this.collisionIndex.getViewportMatrix()}o.justReloaded=!1}markUsedJustification(t,r,n,i){const{leftJustifiedTextSymbolIndex:s,centerJustifiedTextSymbolIndex:o,rightJustifiedTextSymbolIndex:a,verticalPlacedTextSymbolIndex:l,crossTileID:c}=n,u=e.c3(r),d=i===e.bL.vertical?l:"left"===u?s:"center"===u?o:"right"===u?a:-1;s>=0&&(t.text.placedSymbolArray.get(s).crossTileID=d>=0&&s!==d?0:c),o>=0&&(t.text.placedSymbolArray.get(o).crossTileID=d>=0&&o!==d?0:c),a>=0&&(t.text.placedSymbolArray.get(a).crossTileID=d>=0&&a!==d?0:c),l>=0&&(t.text.placedSymbolArray.get(l).crossTileID=d>=0&&l!==d?0:c)}markUsedOrientation(t,r,n){const i=r===e.bL.horizontal||r===e.bL.horizontalOnly?r:0,s=r===e.bL.vertical?r:0,{leftJustifiedTextSymbolIndex:o,centerJustifiedTextSymbolIndex:a,rightJustifiedTextSymbolIndex:l,verticalPlacedTextSymbolIndex:c}=n,u=t.text.placedSymbolArray;o>=0&&(u.get(o).placedOrientation=i),a>=0&&(u.get(a).placedOrientation=i),l>=0&&(u.get(l).placedOrientation=i),c>=0&&(u.get(c).placedOrientation=s)}commit(e){this.commitTime=e,this.zoomAtLastRecencyCheck=this.transform.zoom;const t=this.prevPlacement;let r=!1;this.prevZoomAdjustment=t?t.zoomAdjustment(this.transform.zoom):0;const n=t?t.symbolFadeChange(e):1,i=t?t.opacities:{},s=t?t.variableOffsets:{},o=t?t.placedOrientations:{};for(const a in this.placements){const e=this.placements[a],t=i[a];t?(this.opacities[a]=new Tr(t,n,e.text,e.icon,null,e.clipped),r=r||e.text!==t.text.placed||e.icon!==t.icon.placed):(this.opacities[a]=new Tr(null,n,e.text,e.icon,e.skipFade,e.clipped),r=r||e.text||e.icon)}for(const a in i){const e=i[a];if(!this.opacities[a]){const t=new Tr(e,n,!1,!1);t.isHidden()||(this.opacities[a]=t,r=r||e.text.placed||e.icon.placed)}}for(const a in s)this.variableOffsets[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.variableOffsets[a]=s[a]);for(const a in o)this.placedOrientations[a]||!this.opacities[a]||this.opacities[a].isHidden()||(this.placedOrientations[a]=o[a]);r?this.lastPlacementChangeTime=e:"number"!=typeof this.lastPlacementChangeTime&&(this.lastPlacementChangeTime=t?t.lastPlacementChangeTime:e)}updateLayerOpacities(e,t,r,n){n&&(this.lastReplacementSourceUpdateTime=n.updateTime);const i=new Set;for(const s of t){const t=s.getBucket(e);t&&s.latestFeatureIndex&&e.fqid===t.layerIds[0]&&(this.updateBucketOpacities(t,i,s,s.collisionBoxArray,r,n,s.tileID,e.scope),"offset"===t.elevationType&&this.buildingIndex&&this.buildingIndex.updateZOffset(t,s.tileID),"road"===t.elevationType&&t.updateRoadElevation(s.tileID.canonical),t.updateZOffset())}}updateBucketOpacities(t,r,n,i,s,o,a,l){t.hasTextData()&&t.text.opacityVertexArray.clear(),t.hasIconData()&&t.icon.opacityVertexArray.clear(),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexArray.clear(),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexArray.clear();const c=t.layers[0].layout,u=t.layers[0].paint,d=!!t.layers[0].dynamicFilter(),h=new Tr(null,0,!1,!1,!0),p=c.get("text-allow-overlap"),m=c.get("icon-allow-overlap"),f=c.get("text-variable-anchor"),g="map"===c.get("text-rotation-alignment"),y="map"===c.get("text-pitch-alignment"),_=u.get("symbol-z-offset"),v="sea"===c.get("symbol-elevation-reference"),x=!_.isConstant(),b=new Tr(null,0,p&&(m||!t.hasIconData()||c.get("icon-optional")),m&&(p||!t.hasTextData()||c.get("text-optional")),!0);!t.collisionArrays&&i&&(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData())&&t.deserializeCollisionBoxes(i);const w=(e,t,r)=>{for(let n=0;n<t/4;n++)e.opacityVertexArray.emplaceBack(r)};let j=0;o&&t.updateReplacement(a,o);for(let S=0;S<t.symbolInstances.length;S++){const i=t.symbolInstances.get(S),{numHorizontalGlyphVertices:c,numVerticalGlyphVertices:u,crossTileID:p,numIconVertices:m,tileAnchorX:T,tileAnchorY:k}=i;let A=null;const C=this.retainedQueryData[t.bucketInstanceId];x&&i&&C&&(A=n.latestFeatureIndex.loadFeature({featureIndex:i.featureIndex,bucketIndex:C.bucketIndex,sourceLayerIndex:C.sourceLayerIndex,layoutVertexArrayOffset:0}));const E=_.evaluate(A,{}),N=r.has(p);let I=this.opacities[p];N?I=h:I||(I=b,this.opacities[p]=I),r.add(p);const P=c>0||u>0,M=m>0,L=this.placedOrientations[p],R=L===e.bL.vertical,D=L===e.bL.horizontal||L===e.bL.horizontalOnly;!P&&!M||I.isHidden()||j++;let F=!1;if((P||M)&&o)for(const r of t.activeReplacements){if(e.bZ(r,s,e.b_.Symbol,l))continue;if(r.min.x>T||T>r.max.x||r.min.y>k||k>r.max.y)continue;const t=e.b$(T,k,a.canonical,r.footprintTileId.canonical);if(F=e.c0(t,r.footprint),F)break}if(P){const e=F?Vr:Ur(I.text);w(t.text,c,R?Vr:e),w(t.text,u,D?Vr:e);const r=I.text.isHidden(),{leftJustifiedTextSymbolIndex:n,centerJustifiedTextSymbolIndex:s,rightJustifiedTextSymbolIndex:o,verticalPlacedTextSymbolIndex:a}=i,l=t.text.placedSymbolArray,d=r||R?1:0;n>=0&&(l.get(n).hidden=d),s>=0&&(l.get(s).hidden=d),o>=0&&(l.get(o).hidden=d),a>=0&&(l.get(a).hidden=r||D?1:0);const h=this.variableOffsets[p];h&&this.markUsedJustification(t,h.anchor,i,L);const m=this.placedOrientations[p];m&&(this.markUsedJustification(t,"left",i,m),this.markUsedOrientation(t,m,i))}if(M){const e=F?Vr:Ur(I.icon),{placedIconSymbolIndex:r,verticalPlacedIconSymbolIndex:n}=i,s=t.icon.placedSymbolArray,o=I.icon.isHidden()?1:0;r>=0&&(w(t.icon,m,R?Vr:e),s.get(r).hidden=o),n>=0&&(w(t.icon,i.numVerticalIconVertices,D?Vr:e),s.get(n).hidden=o)}if(t.hasIconCollisionBoxData()||t.hasTextCollisionBoxData()){const r=t.collisionArrays[S];if(r){let n=new e.P(0,0),s=!0;if(r.textBox||r.verticalTextBox){if(f){const e=this.variableOffsets[p];e?(n=Nr(e.anchor,e.width,e.height,e.textOffset,e.textScale),g&&n._rotate(y?this.transform.angle:-this.transform.angle)):s=!1}d&&(s=!I.clipped),r.textBox&&Mr(t.textCollisionBox.collisionVertexArray,I.text.placed,!s||R,E,v,n.x,n.y),r.verticalTextBox&&Mr(t.textCollisionBox.collisionVertexArray,I.text.placed,!s||D,E,v,n.x,n.y)}const o=s&&Boolean(!D&&r.verticalIconBox);r.iconBox&&Mr(t.iconCollisionBox.collisionVertexArray,I.icon.placed,o,E,v,i.hasIconTextFit?n.x:0,i.hasIconTextFit?n.y:0),r.verticalIconBox&&Mr(t.iconCollisionBox.collisionVertexArray,I.icon.placed,!o,E,v,i.hasIconTextFit?n.x:0,i.hasIconTextFit?n.y:0)}}}if(t.fullyClipped=0===j,t.sortFeatures(this.transform.angle),this.retainedQueryData[t.bucketInstanceId]&&(this.retainedQueryData[t.bucketInstanceId].featureSortOrder=t.featureSortOrder),t.hasTextData()&&t.text.opacityVertexBuffer&&t.text.opacityVertexBuffer.updateData(t.text.opacityVertexArray),t.hasIconData()&&t.icon.opacityVertexBuffer&&t.icon.opacityVertexBuffer.updateData(t.icon.opacityVertexArray),t.hasIconCollisionBoxData()&&t.iconCollisionBox.collisionVertexBuffer&&t.iconCollisionBox.collisionVertexBuffer.updateData(t.iconCollisionBox.collisionVertexArray),t.hasTextCollisionBoxData()&&t.textCollisionBox.collisionVertexBuffer&&t.textCollisionBox.collisionVertexBuffer.updateData(t.textCollisionBox.collisionVertexArray),t.bucketInstanceId in this.collisionCircleArrays){const e=this.collisionCircleArrays[t.bucketInstanceId];t.placementInvProjMatrix=e.invProjMatrix,t.placementViewportMatrix=e.viewportMatrix,t.collisionCircleArray=e.circles,delete this.collisionCircleArrays[t.bucketInstanceId]}}symbolFadeChange(e){return 0===this.fadeDuration?1:(e-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(e){return Math.max(0,(this.transform.zoom-e)/1.5)}hasTransitions(e){return this.stale||e-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(e,t){const r=this.zoomAtLastRecencyCheck===t?1-this.zoomAdjustment(t):1;return this.zoomAtLastRecencyCheck=t,this.commitTime+this.fadeDuration*r>e}isStale(){return this.stale}setStale(){this.stale=!0}}function Mr(e,t,r,n,i,s,o){e.emplaceBack(t?1:0,r?1:0,s||0,o||0,n,i?1:0),e.emplaceBack(t?1:0,r?1:0,s||0,o||0,n,i?1:0),e.emplaceBack(t?1:0,r?1:0,s||0,o||0,n,i?1:0),e.emplaceBack(t?1:0,r?1:0,s||0,o||0,n,i?1:0)}const Lr=Math.pow(2,25),Rr=Math.pow(2,24),Dr=Math.pow(2,17),Fr=Math.pow(2,16),Or=Math.pow(2,9),zr=Math.pow(2,8),Br=Math.pow(2,1);function Ur(e){if(0===e.opacity&&!e.placed)return 0;if(1===e.opacity&&e.placed)return 4294967295;const t=e.placed?1:0,r=Math.floor(127*e.opacity);return r*Lr+t*Rr+r*Dr+t*Fr+r*Or+t*zr+r*Br+t}const Vr=0;class qr{constructor(e){this._sortAcrossTiles="viewport-y"!==e.layout.get("symbol-z-order")&&void 0!==e.layout.get("symbol-sort-key").constantOr(1),this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(e,t,r,n,i,s){const o=this._bucketParts;for(;this._currentTileIndex<e.length;)if(t.getBucketParts(o,n,e[this._currentTileIndex],this._sortAcrossTiles,s),this._currentTileIndex++,i())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,o.sort((e,t)=>e.sortKey-t.sortKey));this._currentPartIndex<o.length;){const e=o[this._currentPartIndex];if(t.placeLayerBucketPart(e,this._seenCrossTileIDs,r,0===e.symbolInstanceStart,s),this._currentPartIndex++,i())return!0}return!1}}class Wr{constructor(e,t,r,n,i,s,o,a,l){this.placement=new Pr(e,i,s,o,a,l),this._currentPlacementIndex=t.length-1,this._forceFullPlacement=r,this._showCollisionBoxes=n,this._done=!1}isDone(){return this._done}continuePlacement(t,r,n,i,s){const o=e.o.now(),a=()=>{const t=e.o.now()-o;return!this._forceFullPlacement&&t>2};for(;this._currentPlacementIndex>=0;){const o=r[t[this._currentPlacementIndex]],l=this.placement.collisionIndex.transform.zoom;if("symbol"===o.type&&"none"!==o.visibility&&(!o.minzoom||o.minzoom<=l)&&(!o.maxzoom||o.maxzoom>l)){const t=o,r=t.layout.get("symbol-z-elevate"),l=void 0!==t.layout.get("symbol-sort-key").constantOr(1),c=t.layout.get("symbol-z-order"),u="viewport-y"===c||"auto"===c&&!("viewport-y"!==c&&l),d=t.layout.get("text-allow-overlap")||t.layout.get("icon-allow-overlap")||t.layout.get("text-ignore-placement")||t.layout.get("icon-ignore-placement"),h=u&&d,p=this._inProgressLayer=this._inProgressLayer||new qr(t),m=e.B(o.source,o.scope);if(p.continuePlacement(r||h?i[m]:n[m],this.placement,this._showCollisionBoxes,o,a,s))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(e){return this.placement.commit(e),this.placement}}const Hr=512/e.al/2;class Gr{constructor(t,r,n){this.tileID=t,this.bucketInstanceId=n,this.index=new e.c4(r.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const i=t.canonical.x*e.al,s=t.canonical.y*e.al;for(let e=0;e<r.length;e++){const{key:t,crossTileID:n,tileAnchorX:o,tileAnchorY:a}=r.get(e),l=Math.floor((i+o)*Hr),c=Math.floor((s+a)*Hr);this.index.add(l,c),this.keys.push(t),this.crossTileIDs.push(n)}this.index.finish()}findMatches(t,r,n){const i=this.tileID.canonical.z<r.canonical.z?1:Math.pow(2,this.tileID.canonical.z-r.canonical.z),s=Hr/Math.pow(2,r.canonical.z-this.tileID.canonical.z),o=r.canonical.x*e.al,a=r.canonical.y*e.al;for(let e=0;e<t.length;e++){const r=t.get(e);if(r.crossTileID)continue;const{key:l,tileAnchorX:c,tileAnchorY:u}=r,d=Math.floor((o+c)*s),h=Math.floor((a+u)*s),p=this.index.range(d-i,h-i,d+i,h+i).sort((e,t)=>e-t);for(const e of p){const t=this.crossTileIDs[e];if(this.keys[e]===l&&!n.has(t)){n.add(t),r.crossTileID=t;break}}}}}class Zr{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Kr{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(e){const t=Math.round((e-this.lng)/360);if(0!==t)for(const r in this.indexes){const e=this.indexes[r],n={};for(const r in e){const i=e[r];i.tileID=i.tileID.unwrapTo(i.tileID.wrap+t),n[i.tileID.key]=i}this.indexes[r]=n}this.lng=e}addBucket(e,t,r){if(this.indexes[e.overscaledZ]&&this.indexes[e.overscaledZ][e.key]){if(this.indexes[e.overscaledZ][e.key].bucketInstanceId===t.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(e.overscaledZ,this.indexes[e.overscaledZ][e.key])}for(let i=0;i<t.symbolInstances.length;i++)t.symbolInstances.get(i).crossTileID=0;this.usedCrossTileIDs[e.overscaledZ]||(this.usedCrossTileIDs[e.overscaledZ]=new Set);const n=this.usedCrossTileIDs[e.overscaledZ];for(const i in this.indexes){const r=this.indexes[i];if(Number(i)>e.overscaledZ)for(const i in r){const s=r[i];s.tileID.isChildOf(e)&&s.findMatches(t.symbolInstances,e,n)}else{const s=r[e.scaledTo(Number(i)).key];s&&s.findMatches(t.symbolInstances,e,n)}}for(let i=0;i<t.symbolInstances.length;i++){const e=t.symbolInstances.get(i);e.crossTileID||(e.crossTileID=r.generate(),n.add(e.crossTileID))}return void 0===this.indexes[e.overscaledZ]&&(this.indexes[e.overscaledZ]={}),this.indexes[e.overscaledZ][e.key]=new Gr(e,t.symbolInstances,t.bucketInstanceId),!0}removeBucketCrossTileIDs(e,t){for(const r of t.crossTileIDs)this.usedCrossTileIDs[e].delete(r)}removeStaleBuckets(e){let t=!1;for(const r in this.indexes){const n=this.indexes[r];for(const i in n)e[n[i].bucketInstanceId]||(this.removeBucketCrossTileIDs(r,n[i]),delete n[i],t=!0)}return t}}class Yr{constructor(){this.layerIndexes={},this.crossTileIDs=new Zr,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(e,t,r,n){let i=this.layerIndexes[e.fqid];void 0===i&&(i=this.layerIndexes[e.fqid]=new Kr);let s=!1;const o={};"globe"!==n.name&&i.handleWrapJump(r);for(const a of t){const t=a.getBucket(e);t&&e.fqid===t.layerIds[0]&&(t.bucketInstanceId||(t.bucketInstanceId=++this.maxBucketInstanceId),i.addBucket(a.tileID,t,this.crossTileIDs)&&(s=!0),o[t.bucketInstanceId]=!0)}return i.removeStaleBuckets(o)&&(s=!0),s}pruneUnusedLayers(e){const t={};e.forEach(e=>{t[e]=!0});for(const r in this.layerIndexes)t[r]||delete this.layerIndexes[r]}}const Xr=771;class Jr{constructor(e,t,r,n){this.blendFunction=e,this.blendColor=t.toNonPremultipliedRenderColor(null),this.mask=r,this.blendEquation=n}}Jr.Replace=[1,0,1,0],Jr.disabled=new Jr(Jr.Replace,e.ao.transparent,[!1,!1,!1,!1]),Jr.unblended=new Jr(Jr.Replace,e.ao.transparent,[!0,!0,!0,!0]),Jr.alphaBlended=new Jr([1,Xr,1,Xr],e.ao.transparent,[!0,!0,!0,!0]),Jr.alphaBlendedNonPremultiplied=new Jr([770,Xr,770,Xr],e.ao.transparent,[!0,!0,!0,!0]),Jr.multiply=new Jr([774,0,774,0],e.ao.transparent,[!0,!0,!0,!0]),Jr.additive=new Jr([1,1,1,1],e.ao.transparent,[!0,!0,!0,!0]);class Qr{constructor(e,t,r){this.func=e,this.mask=t,this.range=r}}Qr.ReadOnly=!1,Qr.ReadWrite=!0,Qr.disabled=new Qr(519,Qr.ReadOnly,[0,1]);const $r=7680;class en{constructor(e,t,r,n,i,s){this.test=e,this.ref=t,this.mask=r,this.fail=n,this.depthFail=i,this.pass=s}}en.disabled=new en({func:519,mask:0},0,0,$r,$r,$r);const tn=1029,rn=2305;class nn{constructor(e,t,r){this.enable=e,this.mode=t,this.frontFace=r}}function sn(t,r){const n=e.ca(t,3);e.cc(t,r),e.cg(t,3,n)}function on(t,r){const n=e.c7([]);return e.c8(n,n,-r),e.c9(n,n,-t),n}function an(t,r){const n=[t[0],t[1],0],i=[r[0],r[1],0];if(e.ag(n)>=1e-15){const t=e.aw([],n);e.c5(i,t,e.bJ(i,t)),r[0]=i[0],r[1]=i[1]}const s=e.bI([],r,t);if(e.c6(s)<1e-15)return null;const o=Math.atan2(-s[1],s[0]);return on(Math.atan2(Math.sqrt(t[0]*t[0]+t[1]*t[1]),-t[2]),o)}nn.disabled=new nn(!1,tn,rn),nn.backCCW=new nn(!0,tn,rn),nn.backCW=new nn(!0,tn,2304),nn.frontCW=new nn(!0,1028,2304),nn.frontCCW=new nn(!0,1028,rn);class ln{constructor(e,t){this.position=e,this.orientation=t}get position(){return this._position}set position(t){if(t){const r=t instanceof e.ae?t:new e.ae(t[0],t[1],t[2]);this._renderWorldCopies&&(r.x=e.bT(r.x,0,1)),this._position=r}else this._position=null}lookAtPoint(t,r,n){if(this.orientation=null,!this.position)return;const i=this.position,s=n||(this._elevation?this._elevation.getAtPointOrZero(e.ae.fromLngLat(t)):0),o=e.ae.fromLngLat(t,s),a=[o.x-i.x,o.y-i.y,o.z-i.z];r||(r=[0,0,1]),r[2]=Math.abs(r[2]),this.orientation=an(a,r)}setPitchBearing(t,r){this.orientation=on(e.an(t),e.an(-r))}}class cn{constructor(t,r){this._transform=e.bA([]),this.orientation=r,this.position=t}get mercatorPosition(){const t=this.position;return new e.ae(t[0],t[1],t[2])}get position(){const t=e.ca(this._transform,3);return[t[0],t[1],t[2]]}set position(t){var r;t&&e.cg(this._transform,3,[(r=t)[0],r[1],r[2],1])}get orientation(){return this._orientation}set orientation(t){this._orientation=t||e.c7([]),t&&sn(this._transform,this._orientation)}getPitchBearing(){const e=this.forward(),t=this.right();return{bearing:Math.atan2(-t[1],t[0]),pitch:Math.atan2(Math.sqrt(e[0]*e[0]+e[1]*e[1]),-e[2])}}setPitchBearing(e,t){this._orientation=on(e,t),sn(this._transform,this._orientation)}forward(){const t=e.ca(this._transform,2);return[-t[0],-t[1],-t[2]]}up(){const t=e.ca(this._transform,1);return[-t[0],-t[1],-t[2]]}right(){const t=e.ca(this._transform,0);return[t[0],t[1],t[2]]}getCameraToWorld(t,r){const n=new Float64Array(16);return e.bl(n,this.getWorldToCamera(t,r)),n}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(t,r,n){const i=this.position;e.c5(i,i,-t);const s=new Float64Array(16);return e.bq(s,[n,n,n]),e.br(s,s,i),s[10]*=r,s}getWorldToCamera(t,r){const n=new Float64Array(16),i=new Float64Array(4),s=this.position;return e.cb(i,this._orientation),e.c5(s,s,-t),e.cc(n,i),e.br(n,n,s),n[1]*=-1,n[5]*=-1,n[9]*=-1,n[13]*=-1,n[8]*=r,n[9]*=r,n[10]*=r,n[11]*=r,n}getCameraToClipPerspective(t,r,n,i){const s=new Float64Array(16);return e.cd(s,t,r,n,i),s}getCameraToClipOrthographic(t,r,n,i,s,o){const a=new Float64Array(16);return e.ce(a,t,r,n,i,s,o),a}getDistanceToElevation(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const n=0===t?0:e.cf(t,r?e.a$(this.position[1]):this.position[1]),i=this.forward();return(n-this.position[2])/i[2]}clone(){return new cn([...this.position],[...this.orientation])}}const un={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class dn{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0;if(isNaN(e)||e<0||isNaN(t)||t<0||isNaN(r)||r<0||isNaN(n)||n<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=e,this.bottom=t,this.left=r,this.right=n}interpolate(t,r,n){return null!=r.top&&null!=t.top&&(this.top=e.ak(t.top,r.top,n)),null!=r.bottom&&null!=t.bottom&&(this.bottom=e.ak(t.bottom,r.bottom,n)),null!=r.left&&null!=t.left&&(this.left=e.ak(t.left,r.left,n)),null!=r.right&&null!=t.right&&(this.right=e.ak(t.right,r.right,n)),this}getCenter(t,r){const n=e.aA((this.left+t-this.right)/2,0,t),i=e.aA((this.top+r-this.bottom)/2,0,r);return new e.P(n,i)}equals(e){return this.top===e.top&&this.bottom===e.bottom&&this.left===e.left&&this.right===e.right}clone(){return new dn(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const hn=15;class pn{constructor(t,r,n,i,s,o,a){this.tileSize=512,this._renderWorldCopies=void 0===s||s,this._minZoom=t||0,this._maxZoom=r||22,this._minPitch=null!==n&&void 0!==n?n:0,this._maxPitch=null!==i&&void 0!==i?i:60,this.setProjection(o),this.setMaxBounds(a),this.width=0,this.height=0,this._center=new e.aT(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new dn,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new cn,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const e=new pn(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return e._elevation=this._elevation,e._centerAltitude=this._centerAltitude,e._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,e.tileSize=this.tileSize,e.mercatorFromTransition=this.mercatorFromTransition,e.width=this.width,e.height=this.height,e.cameraElevationReference=this.cameraElevationReference,e._center=this._center,e._setZoom(this.zoom),e._seaLevelZoom=this._seaLevelZoom,e.angle=this.angle,e._fov=this._fov,e._pitch=this._pitch,e._nearZ=this._nearZ,e._farZ=this._farZ,e._averageElevation=this._averageElevation,e._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,e._unmodified=this._unmodified,e._edgeInsets=this._edgeInsets.clone(),e._camera=this._camera.clone(),e._calcMatrices(),e.freezeTileCoverage=this.freezeTileCoverage,e.frustumCorners=this.frustumCorners,e._allowWorldUnderZoom=this._allowWorldUnderZoom,e}get isOrthographic(){return"globe"!==this.projection.name&&this._orthographicProjectionAtLowPitch&&this.pitch<hn}get elevation(){return this._elevation}set elevation(e){this._elevation!==e&&(this._elevation=e,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return"globe"!==this.projection.name&&!this.isOrthographic}updateElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(null==this._seaLevelZoom||r)&&this._updateCameraOnTerrain(),(e||r)&&this._constrainCamera(t),this._calcMatrices()}getProjection(){return e.aH(this.projection,["name","center","parallels"])}setProjection(t){this.projectionOptions=t||{name:"mercator"};const r=this.projection?this.getProjection():void 0;this.projection=e.cm(this.projectionOptions);const n=this.getProjection(),i=!e.by(r,n);return i&&this._calcMatrices(),this.mercatorFromTransition=!1,i}setOrthographicProjectionAtLowPitch(e){return this._orthographicProjectionAtLowPitch!==e&&(this._orthographicProjectionAtLowPitch=e,this._calcMatrices(),!0)}setMercatorFromTransition(){const t=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=e.cm({name:"mercator"});const r=t!==this.projection.name;return r&&this._calcMatrices(),r}get minZoom(){return this._minZoom}set minZoom(e){this._minZoom!==e&&(this._minZoom=e,this.zoom=Math.max(this.zoom,e))}get maxZoom(){return this._maxZoom}set maxZoom(e){this._maxZoom!==e&&(this._maxZoom=e,this.zoom=Math.min(this.zoom,e))}get minPitch(){return this._minPitch}set minPitch(e){this._minPitch!==e&&(this._minPitch=e,this.pitch=Math.max(this.pitch,e))}get maxPitch(){return this._maxPitch}set maxPitch(e){this._maxPitch!==e&&(this._maxPitch=e,this.pitch=Math.min(this.pitch,e))}get renderWorldCopies(){return this._renderWorldCopies&&!0===this.projection.supportsWorldCopies}set renderWorldCopies(e){void 0===e?e=!0:null===e&&(e=!1),this._renderWorldCopies=e}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get cameraWorldSize(){const e=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(e))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return e.cf(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new e.P(this.width,this.height)}get bearing(){return e.bT(this.rotation,-180,180)}set bearing(e){this.rotation=e}get rotation(){return-this.angle/Math.PI*180}set rotation(t){const r=-t*Math.PI/180;this.angle!==r&&(this._unmodified=!1,this.angle=r,this._calcMatrices(),this.rotationMatrix=e.cn(),e.co(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(t){const r=e.aA(t,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==r&&(this._unmodified=!1,this._pitch=r,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(t){t=Math.max(.01,Math.min(60,t)),this._fov!==t&&(this._unmodified=!1,this._fov=e.an(t),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const e=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/e)}get averageElevation(){return this._averageElevation}set averageElevation(e){this._averageElevation=e,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(e){const t=Math.min(Math.max(e,this.minZoom),this.maxZoom);this._zoom!==t&&(this._unmodified=!1,this._setZoom(t),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(e){this._zoom=e,this.scale=this.zoomScale(e),this.tileZoom=Math.floor(e),this.zoomFraction=e-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(e){this._tileCoverLift!==e&&(this._tileCoverLift=e)}_updateCameraOnTerrain(){const e=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,t=this.elevation&&e===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||e===Number.NEGATIVE_INFINITY&&(!t||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const r=this._elevation;t||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&r.exaggeration()&&this._centerAltitudeValidForExaggeration!==r.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*r.exaggeration(),this._centerAltitudeValidForExaggeration=r.exaggeration()):(this._centerAltitude=e||0,this._centerAltitudeValidForExaggeration=r.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(void 0===this._centerAltitudeValidForExaggeration)return;const e=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(e)}sampleAverageElevation(){if(!this._elevation)return 0;const t=this._elevation,r=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],n=this.horizonLineFromTop();let i=0,s=0;for(let o=0;o<r.length;o++){const a=new e.P(r[o][0]*this.width,n+r[o][1]*(this.height-n)),l=t.pointCoordinate(a);if(!l)continue;const c=1/Math.hypot(l[0]-this._camera.position[0],l[1]-this._camera.position[1]);i+=l[3]*c,s+=c}return 0===s?NaN:i/s}get center(){return this._center}set center(e){e.lat===this._center.lat&&e.lng===this._center.lng||(this._unmodified=!1,this._center=e,this._terrainEnabled()&&("ground"===this.cameraElevationReference?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(null==this._seaLevelZoom||!this._elevation)return;const e=this._seaLevelZoom,t=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),r=this.pixelsPerMeter/this.worldSize*t,n=this._mercatorZfromZoom(e),i=this._mercatorZfromZoom(this._maxZoom),s=Math.max(n-r,i);this._setZoom(this._zoomFromMercatorZ(s))}get padding(){return this._edgeInsets.toJSON()}set padding(e){this._edgeInsets.equals(e)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,e,1),this._calcMatrices())}equals(e){const t=this.elevation,r=e.elevation,n=null!=t!=(null!=r)||t&&r&&t.exaggeration()!==r.exaggeration();return this.width===e.width&&this.height===e.height&&this.center.lng===e.center.lng&&this.center.lat===e.center.lat&&this.zoom===e.zoom&&this.bearing===e.bearing&&this.pitch===e.pitch&&this.fov===e.fov&&this.projection.name===e.projection.name&&this._edgeInsets.equals(e.padding)&&!n}computeZoomRelativeTo(t){const r=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,t.toAltitude()));let n;n=t.z<this._camera.position[2]?[r.x,r.y,r.z]:[t.x,t.y,t.z];const i=e.ag(e.av([],this._camera.position,n));return e.aA(this._zoomFromMercatorZ(i),this._minZoom,this._maxZoom)}setFreeCameraOptions(t){if(!this.height)return;if(!t.position&&!t.orientation)return;this._updateCameraState();let r=!1;if(t.orientation&&!e.cp(t.orientation,this._camera.orientation)&&(r=this._setCameraOrientation(t.orientation)),t.position){const n=[t.position.x,t.position.y,t.position.z];e.cq(n,this._camera.position)||(this._setCameraPosition(n),r=!0)}r&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const t=this._camera.position,r=new ln;return r.position=new e.ae(t[0],t[1],t[2]),r.orientation=this._camera.orientation,r._elevation=this.elevation,r._renderWorldCopies=this.renderWorldCopies,r}_setCameraOrientation(t){if(!e.cr(t))return!1;e.cs(t,t);const r=e.ct([],[0,0,-1],t),n=e.ct([],[0,-1,0],t);if(n[2]<0)return!1;const i=an(r,n);return!!i&&(this._camera.orientation=i,!0)}_setCameraPosition(t){const r=this.zoomScale(this.minZoom)*this.tileSize,n=this.zoomScale(this.maxZoom)*this.tileSize,i=this.cameraToCenterDistance;t[2]=e.aA(t[2],i/n,i/r),this._camera.position=t}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(e){return this._edgeInsets.equals(e)}interpolatePadding(e,t,r){this._unmodified=!1,this._edgeInsets.interpolate(e,t,r),this._constrain(),this._calcMatrices()}coveringZoomLevel(e){const t=(e.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/e.tileSize));return Math.max(0,t)}getVisibleUnwrappedCoordinates(t){const r=[new e.cu(0,t)];if(this.renderWorldCopies){const n=this.pointCoordinate(new e.P(0,0)),i=this.pointCoordinate(new e.P(this.width,0)),s=this.pointCoordinate(new e.P(this.width,this.height)),o=this.pointCoordinate(new e.P(0,this.height)),a=Math.floor(Math.min(n.x,i.x,s.x,o.x)),l=Math.floor(Math.max(n.x,i.x,s.x,o.x)),c=1;for(let u=a-c;u<=l+c;u++)0!==u&&r.push(new e.cu(u,t))}return r}isLODDisabled(e){return(!e||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(t,r,n,i){let s=[];const o=null!=n,a=!o;if(a&&this.zoom<r)return s;if(o&&0===n[0]&&0===n[1])return s;const l=new Set,c=(t,r,n,i,o)=>{const a=e.cY(r,t,n,i,o);l.has(a)||(s.push(new e.aQ(t,r,n,i,o)),l.add(a))};for(let e=0;e<t.length;e++){const s=t[e];if(a&&s.canonical.z!==r)continue;if(o&&void 0!==i&&i>s.canonical.z)continue;const l=s.canonical,u=s.overscaledZ,d=s.wrap,h=1<<l.z,p=l.x+1<h,m=l.x>0,f=l.y+1<h,g=l.y>0,y=s.wrap-(m?0:1),_=s.wrap+(p?0:1),v=m?l.x-1:h-1,x=p?l.x+1:0;if(o)n[0]<0?(c(u,_,l.z,x,l.y),n[1]<0&&f&&(c(u,d,l.z,l.x,l.y+1),c(u,_,l.z,x,l.y+1)),n[1]>0&&g&&(c(u,d,l.z,l.x,l.y-1),c(u,_,l.z,x,l.y-1))):n[0]>0?(c(u,y,l.z,v,l.y),n[1]<0&&f&&(c(u,d,l.z,l.x,l.y+1),c(u,y,l.z,v,l.y+1)),n[1]>0&&g&&(c(u,d,l.z,l.x,l.y-1),c(u,y,l.z,v,l.y-1))):n[1]<0&&f?c(u,d,l.z,l.x,l.y+1):g&&c(u,d,l.z,l.x,l.y-1);else{const e=s.visibleQuadrants;1&e&&(c(u,y,l.z,v,l.y),g&&(c(u,d,l.z,l.x,l.y-1),c(u,y,l.z,v,l.y-1))),2&e&&(c(u,_,l.z,x,l.y),g&&(c(u,d,l.z,l.x,l.y-1),c(u,_,l.z,x,l.y-1))),4&e&&(c(u,y,l.z,v,l.y),f&&(c(u,d,l.z,l.x,l.y+1),c(u,y,l.z,v,l.y+1))),8&e&&(c(u,_,l.z,x,l.y),f&&(c(u,d,l.z,l.x,l.y+1),c(u,_,l.z,x,l.y+1)))}}const u=[];for(const e of s)s.some(t=>e.isChildOf(t))||u.push(e);if(s=u.filter(e=>!t.some(t=>!!(e.overscaledZ<r&&t.isChildOf(e))||e.equals(t)||e.isChildOf(t))),a){const e=1<<r,t="globe"===this.projection.name?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),n=[e*t.x,e*t.y],i=4,o=i*i;s=s.filter(e=>{const t=e.canonical.x+.5-n[0],r=e.canonical.y+.5-n[1];return t*t+r*r<o})}return s}extendTileCoverToNearPlane(t,r,n){const i=[],s=new Set;for(const e of t)s.add(e.key);const o=(t,r,n,o,a)=>{const l=e.cY(r,t,n,o,a);s.has(l)||(i.push(new e.aQ(t,r,n,o,a)),s.add(l))},a=t.reduce((e,t)=>Math.max(e,t.overscaledZ),n),l=1<<n,c=[new e.P(0,0),new e.P(e.al,0),new e.P(e.al,e.al),new e.P(0,e.al)],u=new e.P(0,0),d=new e.P(0,0),h=(t,r)=>{const i=Math.floor(t[0]),s=Math.floor(t[1]),h=(t[0]-i)*e.al,p=(t[1]-s)*e.al,m=Math.floor(r[0]),f=Math.floor(r[1]),g=(r[0]-m)*e.al,y=(r[1]-f)*e.al;for(let _=-1;_<=1;_++){const t=i+_;if(!(t<0||t>=l)){u.x=h-_*e.al,d.x=g-(t-m)*e.al;for(let r=-1;r<=1;r++){const i=s+r;u.y=p-r*e.al,d.y=y-(i-f)*e.al,e.cZ(u,d,c)&&o(a,0,n,t,i)}}}},p=r.points,m=p[e.cv],f=p[e.cw],g=this._projectToGround(m,p[e.cx]),y=this._projectToGround(f,p[e.cy]);return h(m,g),h(f,y),i}_projectToGround(t,r){return e.cz(e.cA(),t,r,t[2]/(t[2]-r[2]))}coveringTiles(t){let r=this.coveringZoomLevel(t);const n=r,i=this.elevation&&this.elevation.exaggeration(),s=i&&!t.isTerrainDEM,o="mercator"===this.projection.name;if(void 0!==t.minzoom&&r<t.minzoom)return[];void 0!==t.maxzoom&&r>t.maxzoom&&(r=t.maxzoom);const a=this.locationCoordinate(this.center),l=this.center.lat,c=1<<r,u=[c*a.x,c*a.y,0],d="globe"===this.projection.name,h=!d,p=e.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,h),m=d?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),f=c*e.cf(1,this.center.lat),g=this._camera.position[2]/e.cf(1,this.center.lat),y=[c*m.x,c*m.y,g*(h?1:f)],_=d||i,v=this.cameraToCenterDistance/t.tileSize*(t.roundZoom?1:.502),x=this.isLODDisabled(!0)?r:0;let b;if(this._elevation&&t.isTerrainDEM)b=1e4*this._elevation.exaggeration();else if(this._elevation){const e=this._elevation.getMinMaxForVisibleTiles();b=e?e.max:this._centerAltitude}else b=this._centerAltitude;const w=t.isTerrainDEM?-b:this._elevation?this._elevation.getMinElevationBelowMSL():0,j=this.projection.isReprojectedInTileSpace?e.cC(this):1,S=t=>{const r=1/4e4,n=new e.ae(t.x+r,t.y,t.z),i=new e.ae(t.x,t.y+r,t.z),s=t.toLngLat(),o=n.toLngLat(),a=i.toLngLat(),l=this.locationCoordinate(s),c=this.locationCoordinate(o),u=this.locationCoordinate(a),d=Math.hypot(c.x-l.x,c.y-l.y),h=Math.hypot(u.x-l.x,u.y-l.y);return Math.sqrt(d*h)*j/r},T=t=>{const r=b,n=w;return{aabb:e.cF(this,c,0,0,0,t,n,r,this.projection),zoom:0,x:0,y:0,minZ:n,maxZ:r,wrap:t,fullyVisible:!1}},k=[];let A=[];const C=r,E=t.reparseOverscaled?n:r,N=(g-this._centerAltitude)*f,I=e=>{if(!this._elevation||!e.tileID||!o)return;const t=this._elevation.getMinMaxForTile(e.tileID),r=e.aabb;t?(r.min[2]=t.min,r.max[2]=t.max,r.center[2]=(r.min[2]+r.max[2])/2):(e.shouldSplit=M(e),e.shouldSplit||(r.min[2]=r.max[2]=r.center[2]=this._centerAltitude))},P=(e,t)=>{if(.707*t<e)return 1;const r=t/e;return r/(1.4144271570014144+(Math.pow(1.1,r-1.4144271570014144+1)-1)/(1.1-1)-1)},M=t=>{if(t.zoom<x)return!0;if(t.zoom===C)return!1;if(null!=t.shouldSplit)return t.shouldSplit;const r=t.aabb.distanceX(y),i=t.aabb.distanceY(y);let a=N,c=1;if(d){a=t.aabb.distanceZ(y);const r=Math.pow(2,t.zoom),n=e.a$((t.y+1)/r),i=e.a$(t.y/r),s=Math.min(Math.max(l,n),i),o=e.d1(s)/e.d1(l);if(c=s===l?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,o/this._mercatorScaleRatio),this.zoom<=e.c_&&t.zoom===C-1&&o>=.9)return!0}else if(s&&(a=t.aabb.distanceZ(y)*f),this.projection.isReprojectedInTileSpace&&n<=5){const r=Math.pow(2,t.zoom),n=S(new e.ae((t.x+.5)/r,(t.y+.5)/r));c=n>.85?1:n}if(!o&&!d){const e=Math.sqrt(r*r+i*i+a*a);let n=(1<<C-t.zoom)*v*c;return n*=P(Math.max(a,N),e),e<n}let h=Number.MAX_VALUE,p=0;const m=t.aabb.getCorners(),g=[];for(const n of m){e.av(g,n,y),d||(s?g[2]*=f:g[2]=N);const t=e.bJ(g,this._camera.forward());t<h&&(h=t,p=Math.abs(g[2]))}let _=(1<<C-t.zoom)*v*c;if(_*=P(Math.max(p,N),h),h<_)return!0;const b=t.aabb.closestPoint(u);return b[0]===u[0]&&b[1]===u[1]};if(this.renderWorldCopies)for(let e=1;e<=3;e++)k.push(T(-e)),k.push(T(e));for(k.push(T(0));k.length>0;){const n=k.pop(),i=n.x,a=n.y;let l=n.fullyVisible;const h=()=>"globe"===this.projection.name&&(0===n.y||n.y===(1<<n.zoom)-1);if(!l){let t=_?n.aabb.intersects(p):n.aabb.intersectsFlat(p);if(0===t&&h()){const r=new e.cD(n.zoom,i,a);t=e.cE(this,c,r,!0).intersects(p)}if(0===t)continue;l=2===t}if(n.zoom!==C&&M(n))for(let t=0;t<4;t++){const r=(i<<1)+t%2,u=(a<<1)+(t>>1),h={aabb:o?n.aabb.quadrant(t):e.cF(this,c,n.zoom+1,r,u,n.wrap,n.minZ,n.maxZ,this.projection),zoom:n.zoom+1,x:r,y:u,wrap:n.wrap,fullyVisible:l,tileID:void 0,shouldSplit:void 0,minZ:n.minZ,maxZ:n.maxZ};s&&!d&&(h.tileID=new e.aQ(n.zoom+1===C?E:n.zoom+1,n.wrap,n.zoom+1,r,u),I(h)),k.push(h)}else{const s=n.zoom===C?E:n.zoom;if(t.minzoom&&t.minzoom>s)continue;let o=0;if(!l){let r=_?n.aabb.intersectsPrecise(p):n.aabb.intersectsPreciseFlat(p);if(0===r&&h()){const t=new e.cD(n.zoom,i,a);r=e.cE(this,c,t,!0).intersectsPrecise(p)}if(0===r)continue;if(t.calculateQuadrantVisibility)if(p.containsPoint(n.aabb.center))o=15;else for(let e=0;e<4;e++)0!==n.aabb.quadrant(e).intersects(p)&&(o|=1<<e)}const d=u[0]-(.5+i+(n.wrap<<n.zoom))*(1<<r-n.zoom),m=u[1]-.5-a,f=n.tileID?n.tileID:new e.aQ(s,n.wrap,n.zoom,i,a);t.calculateQuadrantVisibility&&(f.visibleQuadrants=o),A.push({tileID:f,distanceSq:d*d+m*m})}}if(this.fogCullDistSq){const r=this.fogCullDistSq,n=this.horizonLineFromTop();A=A.filter(i=>{const s=[0,0,0,1],o=[e.al,e.al,0,1],a=this.calculateFogTileMatrix(i.tileID.toUnwrapped());e.aC(s,s,a),e.aC(o,o,a);const l=e.cG([],s,o),c=e.cH([],s,o),u=e.c$(l,c);if(0===u)return!0;let d=!1;const h=this._elevation;if(h&&u>r&&0!==n){const r=this.calculateProjMatrix(i.tileID.toUnwrapped());let s;t.isTerrainDEM||(s=h.getMinMaxForTile(i.tileID)),s||(s={min:w,max:b});const o=e.cI(this.rotation),a=[o[0]*e.al,o[1]*e.al,s.max];e.af(a,a,r),d=(1-a[1])*this.height*.5<n}return u<r||d})}return A.sort((e,t)=>e.distanceSq-t.distanceSq).map(e=>e.tileID)}resize(e,t){this.width=e,this.height=t,this.pixelsToGLUnits=[2/e,-2/t],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(e){return Math.pow(2,e)}scaleZoom(e){return Math.log2(e)}project(t){const r=e.aA(t.lat,-e.cJ,e.cJ),n=this.projection.project(t.lng,r);return new e.P(n.x*this.worldSize,n.y*this.worldSize)}unproject(e){return this.projection.unproject(e.x/this.worldSize,e.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/e.cf(1,this.center.lat)/this.worldSize}setLocationAtPoint(t,r){let n,i;const s=this.centerPoint;if("globe"===this.projection.name){const e=this.worldSize;n=(r.x-s.x)/e,i=(r.y-s.y)/e}else{const e=this.pointCoordinate(r),t=this.pointCoordinate(s);n=e.x-t.x,i=e.y-t.y}const o=this.locationCoordinate(t);this.setLocation(new e.ae(o.x-n,o.y-i))}setLocation(e){this.center=this.coordinateLocation(e),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(e,t){return this.projection.locationPoint(this,e,t)}locationPoint3D(e,t){return this.projection.locationPoint(this,e,t,!0)}pointLocation(e){return this.coordinateLocation(this.pointCoordinate(e))}pointLocation3D(e,t){return this.coordinateLocation(this.pointCoordinate3D(e,t))}locationCoordinate(t,r){const n=r?e.cf(r,t.lat):void 0,i=this.projection.project(t.lng,t.lat);return new e.ae(i.x,i.y,n)}coordinateLocation(e){return this.projection.unproject(e.x,e.y)}pointRayIntersection(t,r){const n=null!=r?r:this._centerAltitude,i=[t.x,t.y,0,1],s=[t.x,t.y,1,1];e.aC(i,i,this.pixelMatrixInverse),e.aC(s,s,this.pixelMatrixInverse);const o=s[3];e.cK(i,i,1/i[3]),e.cK(s,s,1/o);const a=i[2],l=s[2];return{p0:i,p1:s,t:a===l?0:(n-a)/(l-a)}}screenPointToMercatorRay(t){const r=[t.x,t.y,0,1],n=[t.x,t.y,1,1];return e.aC(r,r,this.pixelMatrixInverse),e.aC(n,n,this.pixelMatrixInverse),e.cK(r,r,1/r[3]),e.cK(n,n,1/n[3]),r[2]=e.cf(r[2],this._center.lat)*this.worldSize,n[2]=e.cf(n[2],this._center.lat)*this.worldSize,e.cK(r,r,1/this.worldSize),e.cK(n,n,1/this.worldSize),new e.ax([r[0],r[1],r[2]],e.aw([],e.av([],n,r)))}rayIntersectionCoordinate(t){const{p0:r,p1:n,t:i}=t,s=e.cf(r[2],this._center.lat),o=e.cf(n[2],this._center.lat);return new e.ae(e.ak(r[0],n[0],i)/this.worldSize,e.ak(r[1],n[1],i)/this.worldSize,e.ak(s,o,i))}pointCoordinate(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this._centerAltitude;return this.projection.pointCoordinate(this,e.x,e.y,t)}pointCoordinate3D(t,r){if(!this.elevation)return this.pointCoordinate(t,r);let n=this.projection.pointCoordinate3D(this,t.x,t.y);if(n)return new e.ae(n[0],n[1],n[2]);let i=0,s=this.horizonLineFromTop();if(t.y>s)return this.pointCoordinate(t,r);const o=.02*s,a=t.clone();for(let l=0;l<10&&s-i>o;l++){a.y=e.ak(i,s,.66);const t=this.projection.pointCoordinate3D(this,a.x,a.y);t?(s=a.y,n=t):i=a.y}return n?new e.ae(n[0],n[1],n[2]):this.pointCoordinate(t)}isPointAboveHorizon(e){return this.projection.isPointAboveHorizon(this,e)}isPointOnSurface(t){if(t.y<0||t.y>this.height||t.x<0||t.x>this.width)return!1;if(this.elevation||this.zoom>=e.cL)return!this.isPointAboveHorizon(t);const r=this.pointCoordinate(t);return r.y>=0&&r.y<=1}_coordinatePoint(t,r){const n=r&&this.elevation?this.elevation.getAtPointOrZero(t,this._centerAltitude):this._centerAltitude,i=[t.x*this.worldSize,t.y*this.worldSize,n+t.toAltitude(),1];return e.aC(i,i,this.pixelMatrix),i[3]>0?new e.P(i[0]/i[3],i[1]/i[3]):new e.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:t,left:r}=this._edgeInsets,n=this.height-this._edgeInsets.bottom,i=this.width-this._edgeInsets.right,s=this.pointLocation3D(new e.P(r,t)),o=this.pointLocation3D(new e.P(i,t)),a=this.pointLocation3D(new e.P(i,n)),l=this.pointLocation3D(new e.P(r,n));let c=Math.min(s.lng,o.lng,a.lng,l.lng),u=Math.max(s.lng,o.lng,a.lng,l.lng),d=Math.min(s.lat,o.lat,a.lat,l.lat),h=Math.max(s.lat,o.lat,a.lat,l.lat);const p=Math.pow(2,-this.zoom)/16*270,m="globe"===this.projection.name?1:4,f=(t,r,n,i,s)=>{const o=(t+n)/2,a=(r+i)/2,l=new e.P(o,a),{lng:g,lat:y}=this.pointLocation3D(l),_=Math.max(0,c-g,d-y,g-u,y-h);c=Math.min(c,g),u=Math.max(u,g),d=Math.min(d,y),h=Math.max(h,y),(s<m||_>p)&&(f(t,r,o,a,s+1),f(o,a,n,i,s+1))};if(f(r,t,i,t,1),f(i,t,i,n,1),f(i,n,r,n,1),f(r,n,r,t,1),"globe"===this.projection.name){const[t,r]=e.cM(this);t?(h=90,u=180,c=-180):r&&(d=-90,u=180,c=-180)}return new e.aI(new e.aT(c,d),new e.aT(u,h))}_getBoundsRectangular(t,r){const{top:n,left:i}=this._edgeInsets,s=this.height-this._edgeInsets.bottom,o=this.width-this._edgeInsets.right,a=new e.P(i,n),l=new e.P(o,n),c=new e.P(o,s),u=new e.P(i,s);let d=this.pointCoordinate(a,t),h=this.pointCoordinate(l,t);const p=this.pointCoordinate(c,r),m=this.pointCoordinate(u,r),f=(e,t)=>(t.y-e.y)/(t.x-e.x);return d.y>1&&h.y>=0?d=new e.ae((1-m.y)/f(m,d)+m.x,1):d.y<0&&h.y<=1&&(d=new e.ae(-m.y/f(m,d)+m.x,0)),h.y>1&&d.y>=0?h=new e.ae((1-p.y)/f(p,h)+p.x,1):h.y<0&&d.y<=1&&(h=new e.ae(-p.y/f(p,h)+p.x,0)),(new e.aI).extend(this.coordinateLocation(d)).extend(this.coordinateLocation(h)).extend(this.coordinateLocation(m)).extend(this.coordinateLocation(p))}_getBoundsRectangularTerrain(){const e=this.elevation;if(!e.visibleDemTiles.length||e.isUsingMockSource())return this._getBoundsRectangular(0,0);const t=e.visibleDemTiles.reduce((e,t)=>{if(t.dem){const r=t.dem.tree;e.min=Math.min(e.min,r.minimums[0]),e.max=Math.max(e.max,r.maximums[0])}return e},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(t.min*e.exaggeration(),t.max*e.exaggeration())}getBounds(){return"mercator"===this.projection.name||"equirectangular"===this.projection.name?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];const t=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,r=this.height/2-t*(1-this._horizonShift);return e?Math.max(0,r):r}getMaxBounds(){return this.maxBounds}setMaxBounds(t){this.maxBounds=t,this.minLat=-e.cJ,this.maxLat=e.cJ,this.minLng=-180,this.maxLng=180,t&&(this.minLat=t.getSouth(),this.maxLat=t.getNorth(),this.minLng=t.getWest(),this.maxLng=t.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=e.aF(this.minLng)*this.tileSize,this.worldMaxX=e.aF(this.maxLng)*this.tileSize,this.worldMinY=e.aJ(this.maxLat)*this.tileSize,this.worldMaxY=e.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(e,t){return this.projection.createTileMatrix(this,t,e)}calculateDistanceTileData(t){const r=t.key,n=this._distanceTileDataCache;if(n[r])return n[r];const i=t.canonical,s=1/this.height,o=this.cameraWorldSize,a=o/this.zoomScale(i.z),l=(i.x+Math.pow(2,i.z)*t.wrap)*a,c=i.y*a,u=this.point;u.x*=o/this.worldSize,u.y*=o/this.worldSize;const d=this.angle,h=Math.sin(-d),p=-Math.cos(-d);return n[r]={bearing:[h,p],center:[(u.x-l)*s,(u.y-c)*s],scale:a/e.al*s},n[r]}calculateFogTileMatrix(t){const r=t.key,n=this._fogTileMatrixCache;if(n[r])return n[r];const i=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,t);return e.aB(i,this.worldToFogMatrix,i),n[r]=new Float32Array(i),n[r]}calculateProjMatrix(t){let r=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];const i=t.key;let s;if(s=n?this._expandedProjMatrixCache:r?this._alignedProjMatrixCache:this._projMatrixCache,s[i])return s[i];const o=this.calculatePosMatrix(t,this.worldSize);let a;return a=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:n?this.expandedFarZProjMatrix:r?this.alignedProjMatrix:this.projMatrix,e.aB(o,a,o),s[i]=new Float32Array(o),s[i]}calculatePixelsToTileUnitsMatrix(t){const r=t.tileID.key,n=this._pixelsToTileUnitsCache;if(n[r])return n[r];const i=e.cN(t,this);return n[r]=i,n[r]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if("globe"===this.projection.name){const t=1/this.worldSize,r=e.bq([],[t,t,t]);return e.aB(r,r,this.globeMatrix),r}}recenterOnTerrain(){if(!this._elevation||"globe"===this.projection.name)return;const t=this._elevation;this._updateCameraState();const r=e.cf(1,this._center.lat)*this.worldSize,n=this._computeCameraPosition(r),i=this._camera.forward(),s=e.cf(1,this._center.lat);n[2]/=s,i[2]/=s,e.aw(i,i);const o=t.raycast(n,i,t.exaggeration());if(o){const t=e.bH([],n,i,o),r=new e.ae(t[0],t[1],e.cf(t[2],e.a$(t[1]))),a=(r.z+e.ag([r.x-n[0],r.y-n[1],r.z-n[2]*s]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(a),this._centerAltitude=r.toAltitude(),this._center=this.coordinateLocation(r),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(){let t=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!this._elevation)return;const r=this._elevation,n=e.cf(1,this._center.lat)*this.worldSize,i=this._computeCameraPosition(n),s=r.getAtPointOrZero(new e.ae(...i)),o=this.pixelsPerMeter/this.worldSize*s,a=this._minimumHeightOverTerrain(),l=i[2]-o;if(l<=a)if(l<0||t){const t=this.locationCoordinate(this._center,this._centerAltitude),r=[i[0],i[1],t.z-i[2]],n=e.ag(r);r[2]-=(a-l)/this._pixelsPerMercatorPixel;const s=e.ag(r);if(0===s)return;e.c5(r,r,n/s*this._pixelsPerMercatorPixel),this._camera.position=[i[0],i[1],t.z*this._pixelsPerMercatorPixel-r[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const t="globe"===this.projection.name||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||t){const r=this.center;return r.lat=e.aA(r.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!t)&&(r.lng=e.aA(r.lng,this.minLng,this.maxLng)),this.center=r,void(this._constraining=!1)}const r=this._unmodified,{x:n,y:i}=this.point;let s=0,o=n,a=i;const l=this.width/2,c=this.height/2,u=this.worldMinY*this.scale,d=this.worldMaxY*this.scale;if(i-c<u&&(a=u+c),i+c>d&&(a=d-c),d-u<this.height&&(s=Math.max(s,this.height/(d-u)),a=(d+u)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const e=this.worldMinX*this.scale,t=this.worldMaxX*this.scale,r=this.worldSize/2-(e+t)/2;o=(n+r+this.worldSize)%this.worldSize-r,o-l<e&&(o=e+l),o+l>t&&(o=t-l),t-e<this.width&&(s=Math.max(s,this.width/(t-e)),o=(t+e)/2)}o===n&&a===i||this._allowWorldUnderZoom||(this.center=this.unproject(new e.P(o,a))),s&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(s)),this._constrainCamera(),this._unmodified=r,this._constraining=!1}_minZoomForBounds(){let e=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(e=Math.max(e,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),e}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const t=this.centerOffset,r="globe"===this.projection.name,n=this.pixelsPerMeter;"globe"===this.projection.name&&(this._mercatorScaleRatio=e.cf(1,this.center.lat)/e.cf(1,e.d2));const i=e.cO(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,i),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const s="meters"===this.projection.zAxisUnit?n:1,o=this._camera.getWorldToCamera(this.worldSize,s);let a;const l=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(l[8]=2*-t.x/this.width,l[9]=2*t.y/this.height,this.isOrthographic){let r=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),n=r*this.aspect,i=-n,s=-r;n-=t.x,i-=t.x,r+=t.y,s+=t.y,a=this._camera.getCameraToClipOrthographic(i,n,s,r,this._nearZ,this._farZ),((t,r,n,i)=>{for(let s=0;s<16;s++)t[s]=e.ak(r[s],n[s],i)})(a,a,l,e.d0(this.pitch>=hn?1:this.pitch/hn))}else a=l;const c=e.cP([],l,o);let u=e.cP([],a,o);if(this.projection.isReprojectedInTileSpace){const t=this.locationCoordinate(this.center),r=e.bA([]);e.br(r,r,[t.x*this.worldSize,t.y*this.worldSize,0]),e.aB(r,r,e.cQ(this)),e.br(r,r,[-t.x*this.worldSize,-t.y*this.worldSize,0]),e.aB(u,u,r),e.aB(c,c,r),this.inverseAdjustmentMatrix=e.cR(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=e.cS([],u,[this.worldSize,this.worldSize,this.worldSize/s,1]),this.projMatrix=u,this.invProjMatrix=e.bl(new Float64Array(16),this.projMatrix),r){const r=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);r[8]=2*-t.x/this.width,r[9]=2*t.y/this.height,this.expandedFarZProjMatrix=e.cP([],r,o)}else this.expandedFarZProjMatrix=this.projMatrix;const d=e.bl([],a);this.frustumCorners=e.cT.fromInvProjectionMatrix(d,this.horizonLineFromTop(),this.height),this.cameraFrustum=e.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!r);const h=new Float32Array(16);e.bA(h),e.cS(h,h,[1,-1,1]),e.cU(h,h,this._pitch),e.bB(h,h,this.angle);const p=e.cd(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=e.bz(p);const m=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;p[8]=2*-t.x/this.width,p[9]=2*(t.y+m)/this.height,this.skyboxMatrix=e.aB(h,p,h);const f=this.point,g=f.x,y=f.y,_=this.width%2/2,v=this.height%2/2,x=Math.cos(this.angle),b=Math.sin(this.angle),w=g-Math.round(g)+x*_+b*v,j=y-Math.round(y)+x*v+b*_,S=new Float64Array(u);if(e.br(S,S,[w>.5?w-1:w,j>.5?j-1:j,0]),this.alignedProjMatrix=S,u=e.bC(),e.cS(u,u,[this.width/2,-this.height/2,1]),e.br(u,u,[1,-1,0]),this.labelPlaneMatrix=u,u=e.bC(),e.cS(u,u,[1,-1,1]),e.br(u,u,[-1,-1,0]),e.cS(u,u,[2/this.width,2/this.height,1]),this.glCoordMatrix=u,this.pixelMatrix=e.aB(new Float64Array(16),this.labelPlaneMatrix,c),this._calcFogMatrices(),this._distanceTileDataCache={},u=e.bl(new Float64Array(16),this.pixelMatrix),!u)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=u,"globe"===this.projection.name||this.mercatorFromTransition){this.globeMatrix=e.cV(this);const t=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=e.af(t,t,o),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=u;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const t=this.cameraWorldSizeForFog,r=this.cameraPixelsPerMeter,n=this._camera.position,i=1/this.height/this._pixelsPerMercatorPixel,s=[t,t,r];e.c5(s,s,i),e.c5(n,n,-1),e.cW(n,n,s);const o=e.bC();e.br(o,o,n),e.cS(o,o,s),this.mercatorFogMatrix=o,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(t,r,i)}_computeCameraPosition(e){const t=(e=e||this.pixelsPerMeter)/this.pixelsPerMeter,r=this._camera.forward(),n=this.point,i=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*t-e/this.worldSize*this._centerAltitude;return[n.x/this.worldSize-r[0]*i,n.y/this.worldSize-r[1]*i,e/this.worldSize*this._centerAltitude-r[2]*i]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(t){const r=this._maxCameraBoundsDistance()*Math.cos(this._pitch),n=this._camera.position[2],i=t[2];let s=1;this.projection.wrap&&(this.center=this.center.wrap()),i>0&&(s=Math.min((r-n)/i,1)),this._camera.position=e.bH([],this._camera.position,t,s),this._updateStateFromCamera()}_updateStateFromCamera(){const t=this._camera.position,r=this._camera.forward(),{pitch:n,bearing:i}=this._camera.getPitchBearing(),s=e.cf(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,o=this._mercatorZfromZoom(this._maxZoom)*Math.cos(e.an(this._maxPitch)),a=Math.max((t[2]-s)/Math.cos(n),o),l=this._zoomFromMercatorZ(a);e.bH(t,t,r,a),this._pitch=e.aA(n,e.an(this.minPitch),e.an(this.maxPitch)),this.angle=e.bT(i,-Math.PI,Math.PI),this._setZoom(e.aA(l,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new e.ae(t[0],t[1],t[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(e){return Math.pow(2,e)*this.tileSize}_mercatorZfromZoom(e){return this.cameraToCenterDistance/this._worldSizeFromZoom(e)}_minimumHeightOverTerrain(){const e=Math.min(null!=this._seaLevelZoom?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(e)}_zoomFromMercatorZ(e){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,e)*this.tileSize))}zoomFromMercatorZAdjusted(t){let r=0,n=e.cL,i=0,s=1/0;for(;n-r>1e-6&&n>r;){const e=r+.5*(n-r),o=this.tileSize*Math.pow(2,e),a=this.getCameraToCenterDistance(this.projection,e,o),l=this.scaleZoom(a/(Math.max(0,t)*this.tileSize)),c=Math.abs(e-l);c<s&&(s=c,i=e),e<l?r=e:n=e}return i}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(e.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(t,r){const n=Math.min(t.x,r.x),i=Math.max(t.x,r.x),s=Math.min(t.y,r.y),o=Math.max(t.y,r.y);if(s<this.horizonLineFromTop(!1))return!0;if("mercator"!==this.projection.name)return!1;const a=[new e.P(n,s),new e.P(i,o),new e.P(n,o),new e.P(i,s)],l=this.renderWorldCopies?-3:0,c=this.renderWorldCopies?4:1;for(const e of a){const t=this.pointRayIntersection(e);if(t.t<0)return!0;const r=this.rayIntersectionCoordinate(t);if(r.x<l||r.y<0||r.x>c||r.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+e.cX(this.fovAboveCenter)>88||this.anyCornerOffEdge(new e.P(0,0),new e.P(this.width,this.height))}zoomDeltaToMovement(t,r){const n=e.ag(e.av([],this._camera.position,t)),i=this._zoomFromMercatorZ(n)+r;return n-this._mercatorZfromZoom(i)}getCameraPoint(){if("globe"===this.projection.name){const t=function(t,r){let[n,i,s]=t;const o=[n,i,s,1];e.aC(o,o,r);const a=o[3]=Math.max(o[3],1e-6);return o[0]/=a,o[1]/=a,o[2]/=a,o}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new e.P(t[0],t[1])}{const t=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new e.P(0,t))}}getCameraToCenterDistance(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.zoom,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.worldSize;const i=e.cO(t,r,this.width,this.height,1024),s=t.pixelSpaceConversion(this.center.lat,n,i);let o=.5/Math.tan(.5*this._fov)*this.height*s;return this.isOrthographic&&(o=e.ak(1,o,e.d0(this.pitch>=hn?1:this.pitch/hn))),o}getWorldToCameraMatrix(){const t=this._camera.getWorldToCamera(this.worldSize,"meters"===this.projection.zAxisUnit?this.pixelsPerMeter:1);return"globe"===this.projection.name&&e.aB(t,t,this.globeMatrix),t}getFrustum(t){return e.cB.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,t,"meters"===this.projection.zAxisUnit)}}const mn=(t,r)=>{if(r>0&&t.terrain&&e.w("Cutoff is currently disabled on terrain"),r<=0||t.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const n=t.transform,i=Math.max(Math.abs(n._zoom-(t.minCutoffZoom-1)),1),s=n.isLODDisabled(!1)?e.ah(60,45,n.pitch):e.ah(30,15,n.pitch),o=n._farZ-n._nearZ,a=r*n.height,l=((1-(c=s))*n.cameraToCenterDistance+c*(n._farZ+a))*i;var c;return{shouldRenderCutoff:s<1,uniformValues:{u_cutoff_params:[n._nearZ,n._farZ,(l-n._nearZ)/o,(l-a-n._nearZ)/o]}}},fn=2048;class gn{constructor(e,t){this.aabb=e,this.lastCascade=t}}class yn{add(e,t){const r=this.receivers[e.key];void 0!==r?(r.aabb.min[0]=Math.min(r.aabb.min[0],t.min[0]),r.aabb.min[1]=Math.min(r.aabb.min[1],t.min[1]),r.aabb.min[2]=Math.min(r.aabb.min[2],t.min[2]),r.aabb.max[0]=Math.max(r.aabb.max[0],t.max[0]),r.aabb.max[1]=Math.max(r.aabb.max[1],t.max[1]),r.aabb.max[2]=Math.max(r.aabb.max[2],t.max[2])):this.receivers[e.key]=new gn(t,null)}clear(){this.receivers={}}get(e){return this.receivers[e.key]}computeRequiredCascades(t,r,n){const i=e.d9.fromPoints(t.points);let s=0;for(const o in this.receivers){const t=this.receivers[o];if(!t)continue;if(!i.intersectsAabb(t.aabb))continue;t.aabb.min=i.closestPoint(t.aabb.min),t.aabb.max=i.closestPoint(t.aabb.max);const a=t.aabb.getCorners();for(let i=0;i<n.length;i++){let o=!0;for(const t of a){const s=[t[0]*r,t[1]*r,t[2]];if(e.af(s,s,n[i].matrix),s[0]<-1||s[0]>1||s[1]<-1||s[1]>1){o=!1;break}}if(t.lastCascade=i,s=Math.max(s,i),o)break}}return s+1}}class _n{constructor(e){this.painter=e,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new yn,this._depthMode=new Qr(e.context.gl.LEQUAL,Qr.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1}destroy(){for(const e of this._cascades)e.texture.destroy(),e.framebuffer.destroy();this._cascades=[]}updateShadowParameters(t,r){const n=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!r||!r.properties)return;const i=r.properties.get("shadow-intensity");if(!r.shadowsEnabled()||i<=0)return;if(this._shadowLayerCount=n.style.order.reduce((e,r)=>{const i=n.style._mergedLayers[r];return e+(i.hasShadowPass()&&!i.isHidden(t.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled)return;const s=n.context,o=fn,a=fn;if(0===this._cascades.length||fn!==this._cascades[0].texture.size[0]){this._cascades=[];for(let t=0;t<2;++t){const t=n._shadowMapDebug,r=s.gl,i=s.createFramebuffer(o,a,t?1:0,"texture"),l=new e.T(s,{width:o,height:a,data:null},r.DEPTH_COMPONENT16);if(i.depthAttachment.set(l.texture),t){const t=new e.T(s,{width:o,height:a,data:null},r.RGBA8);i.colorAttachment0.set(t.texture)}this._cascades.push({framebuffer:i,texture:l,matrix:[],far:0,boundingSphereRadius:0,frustum:new e.cB,scale:0})}}this.shadowDirection=xn(r);let l=0;if(t.elevation){const e=t.elevation,r=[1e4,-1e4];e.visibleDemTiles.filter(e=>e.dem).forEach(e=>{const t=e.dem.tree;r[0]=Math.min(r[0],t.minimums[0]),r[1]=Math.max(r[1],t.maximums[0])}),1e4!==r[0]&&(l=(r[1]-r[0])*e.exaggeration())}const c=1.5*t.cameraToCenterDistance,u=3*c,d=new Float64Array(16);for(let m=0;m<this._cascades.length;++m){const r=this._cascades[m];let n=t.height/50,i=1;0===m?i=c:(n=c,i=u);const[s,o]=wn(t,this.shadowDirection,n,i,fn,l);r.scale=t.scale,r.matrix=s,r.boundingSphereRadius=o,e.bl(d,r.matrix),r.frustum=e.cB.fromInvProjectionMatrix(d,1,0,!0),r.far=i}const h=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[h].far,this._cascades[h].far],this._uniformValues.u_shadow_intensity=i,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=.00048828125,this._uniformValues.u_shadow_map_resolution=fn,this._uniformValues.u_shadowmap_0=un.ShadowMap0,this._uniformValues.u_shadowmap_1=un.ShadowMap0+1,this._groundShadowTiles=n.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const p=n.transform.elevation;for(const e of this._groundShadowTiles){let t={min:0,max:0};if(p){const r=p.getMinMaxForTile(e);r&&(t=r)}this.addShadowReceiver(e.toUnwrapped(),t.min,t.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(e){this._enabled=e}drawShadowPass(t,r){if(!this.enabled)return;const n=this.painter,i=n.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(n.transform.getFrustum(0),n.transform.worldSize,this._cascades),i.viewport.set([0,0,fn,fn]);for(let s=0;s<this._numCascadesToRender;++s){n.currentShadowCascade=s,i.bindFramebuffer.set(this._cascades[s].framebuffer.framebuffer),i.clear({color:e.ao.white,depth:1});for(const e of t.order){const i=t._mergedLayers[e];if(!i.hasShadowPass()||i.isHidden(n.transform.zoom))continue;const s=t.getLayerSourceCache(i),o=s?r[s.id]:void 0;("model"===i.type||o&&o.length)&&n.renderLayer(n,s,i,o)}}n.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const e=this.painter,t=e.style,r=e.context,n=r.gl,i=t.directionalLight,s=t.ambientLight;if(!i||!s)return;const o=[],a=mn(e,e.longestCutoffRange);a.shouldRenderCutoff&&o.push("RENDER_CUTOFF"),o.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&o.push("NORMAL_OFFSET");const l=bn(t,i,s),c=new Qr(n.LEQUAL,Qr.ReadOnly,e.depthRangeFor3D),u=new en({func:n.EQUAL,mask:255},0,255,n.KEEP,n.KEEP,n.KEEP);for(const d of this._groundShadowTiles){const t=d.toUnwrapped(),i=e.isTileAffectedByFog(d),s=e.getOrCreateProgram("groundShadow",{defines:o,overrideFog:i});this.setupShadows(t,s),e.uploadCommonUniforms(r,s,t,null,a);const h={u_matrix:e.transform.calculateProjMatrix(t),u_ground_shadow_factor:l};s.draw(e,n.TRIANGLES,c,u,Jr.multiply,nn.disabled,h,"ground_shadow",e.tileExtentBuffer,e.quadTriangleIndexBuffer,e.tileExtentSegments,null,e.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Jr.unblended:Jr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(t){const r=this.painter.transform,n=r.calculatePosMatrix(t,r.worldSize);return e.aB(n,this._cascades[this.painter.currentShadowCascade].matrix,n),Float32Array.from(n)}calculateShadowPassMatrixFromMatrix(t){const r=e.bz(t);return e.aB(r,this._cascades[this.painter.currentShadowCascade].matrix,t),r}setupShadows(t,r,n){if(!this.enabled)return;const i=this.painter.transform,s=this.painter.context,o=s.gl,a=this._uniformValues,l=new Float64Array(16),c=i.calculatePosMatrix(t,i.worldSize);for(let u=0;u<this._cascades.length;u++)e.aB(l,this._cascades[u].matrix,c),a[0===u?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(l),s.activeTexture.set(o.TEXTURE0+un.ShadowMap0+u),this._cascades[u].texture.bindExtraParam(o.LINEAR,o.LINEAR,o.CLAMP_TO_EDGE,o.CLAMP_TO_EDGE,o.GREATER);if(this.useNormalOffset=!!n,this.useNormalOffset){const r=e.d7(t.canonical),s=2/i.tileSize*e.al/fn,o=s*this._cascades[0].boundingSphereRadius,l=s*this._cascades[this._cascades.length-1].boundingSphereRadius,c=("vector-tile"===n?1:3)*function(t){const r=e.aA((t-22)/-22,0,1);return.125*(1-r)+4*r}(i.zoom);a.u_shadow_normal_offset=[r,o*c,l*c],a.u_shadow_bias=[1e-4,.0012,.012]}else a.u_shadow_bias=[36e-5,.0012,.012];r.setShadowUniformValues(s,a)}setupShadowsFromMatrix(t,r){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(!this.enabled)return;const i=this.painter.context,s=i.gl,o=this._uniformValues,a=new Float64Array(16);for(let l=0;l<2;l++)e.aB(a,this._cascades[l].matrix,t),o[0===l?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(a),i.activeTexture.set(s.TEXTURE0+un.ShadowMap0+l),this._cascades[l].texture.bindExtraParam(s.LINEAR,s.LINEAR,s.CLAMP_TO_EDGE,s.CLAMP_TO_EDGE,s.GREATER);this.useNormalOffset=n,n?(o.u_shadow_normal_offset=[1,3,3],o.u_shadow_bias=[6e-5,.0012,.012]):o.u_shadow_bias=[36e-5,.0012,.012],r.setShadowUniformValues(i,o)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(t,r,n,i){if(i[2]>=0)return{};const s=function(t,r,n){const i=n/(1<<t.canonical.z);return new e.d9([t.canonical.x*i+t.wrap*n,t.canonical.y*i+t.wrap*n,0],[(t.canonical.x+1)*i+t.wrap*n,(t.canonical.y+1)*i+t.wrap*n,r])}(t,r,n).getCorners(),o=r/-i[2];i[0]<0?(e.d8(s[0],s[0],[i[0]*o,0,0]),e.d8(s[3],s[3],[i[0]*o,0,0])):i[0]>0&&(e.d8(s[1],s[1],[i[0]*o,0,0]),e.d8(s[2],s[2],[i[0]*o,0,0])),i[1]<0?(e.d8(s[0],s[0],[0,i[1]*o,0]),e.d8(s[1],s[1],[0,i[1]*o,0])):i[1]>0&&(e.d8(s[2],s[2],[0,i[1]*o,0]),e.d8(s[3],s[3],[0,i[1]*o,0]));const a={};return a.vertices=s,a.planes=[vn(s[1],s[0],s[4]),vn(s[2],s[1],s[5]),vn(s[3],s[2],s[6]),vn(s[0],s[3],s[7])],a}addShadowReceiver(t,r,n){this._receivers.add(t,e.d9.fromTileIdAndHeight(t,r,n))}getMaxCascadeForTile(e){const t=this._receivers.get(e);return t&&t.lastCascade?t.lastCascade:0}}function vn(t,r,n){const i=e.av([],n,r),s=e.av([],t,r),o=e.bI([],i,s),a=e.ag(o);return 0===a?[0,0,1,0]:(e.c5(o,o,1/a),[o[0],o[1],o[2],-e.bJ(o,r)])}function xn(t){const r=t.properties.get("direction"),n=e.d4(r.x,r.y,r.z);n[2]=e.aA(n[2],0,75);const i=e.d6([n[0],n[1],n[2]]);return e.d5(i.x,i.y,i.z)}function bn(t,r,n){const i="none"===r.properties.get("color-use-theme"),s=r.properties.get("color"),o=r.properties.get("intensity"),a=r.properties.get("direction"),l=[a.x,a.y,a.z],c="none"===n.properties.get("color-use-theme"),u=n.properties.get("color"),d=n.properties.get("intensity"),h=Math.max(e.bJ([0,0,1],l),0),p=[0,0,0];e.c5(p,u.toPremultipliedRenderColor(c?null:t.getLut(r.scope)).toArray01Linear().slice(0,3),d);const m=[0,0,0];return e.c5(m,s.toPremultipliedRenderColor(i?null:t.getLut(n.scope)).toArray01Linear().slice(0,3),h*o),e.db([p[0]>0?p[0]/(p[0]+m[0]):0,p[1]>0?p[1]/(p[1]+m[1]):0,p[2]>0?p[2]/(p[2]+m[2]):0])}function wn(t,r,n,i,s,o){const a=t.zoom,l=t.scale,c=t.worldSize,u=1/c,d=t.aspect,h=Math.sqrt(1+d*d)*Math.tan(.5*t.fovX),p=h*h,m=i-n,f=i+n;let g,y;p>m/f?(g=i,y=i*h):(g=.5*f*(1+p),y=.5*Math.sqrt(m*m+2*(i*i+n*n)*p+f*f*p*p));const _=t.projection.pixelsPerMeter(t.center.lat,c),v=t._camera.getCameraToWorldMercator(),x=[0,0,-g*u];e.af(x,x,v);let b=y*u;const w=t._edgeInsets;if(!(0===w.left&&0===w.top&&0===w.right&&0===w.bottom||w.left===w.right&&w.top===w.bottom)){const r=t._camera.getWorldToCamera(t.worldSize,"meters"===t.projection.zAxisUnit?_:1),s=t._camera.getCameraToClipPerspective(t._fov,t.width/t.height,n,i);s[8]=2*-t.centerOffset.x/t.width,s[9]=2*t.centerOffset.y/t.height;const o=new Float64Array(16);e.cP(o,s,r);const u=new Float64Array(16);e.bl(u,o);const d=e.cB.fromInvProjectionMatrix(u,c,a,!0);for(const n of d.points){const r=((j=n)[0]/=l,j[1]/=l,j[2]=e.cf(j[2],t._center.lat),j);b=Math.max(b,e.c6(e.da([],x,r)))}}var j;b*=s/(s-1);const S=Math.acos(r[2]),T=Math.atan2(-r[0],-r[1]),k=new cn;k.position=x,k.setPitchBearing(S,T);const A=k.getWorldToCamera(c,_),C=b*c,E=Math.min(t._mercatorZfromZoom(17)*c*-2,-2*C),N=k.getCameraToClipOrthographic(-C,C,-C,C,E,(C+o*_)/r[2]),I=new Float64Array(16);e.aB(I,N,A);const P=e.d5(Math.floor(1e6*x[0])/1e6*c,Math.floor(1e6*x[1])/1e6*c,0),M=.5*s,L=[0,0,0];e.af(L,P,I),e.c5(L,L,M);const R=[Math.floor(L[0]),Math.floor(L[1]),Math.floor(L[2])],D=[0,0,0];e.av(D,L,R),e.c5(D,D,-1/M);const F=new Float64Array(16);return e.bA(F),e.br(F,F,D),e.aB(I,F,I),[I,C]}class jn extends e.E{constructor(e){super(),this.requestManager=e,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(t,r){return e.dc(this.requestManager.transformRequest(r,e.R.Model).url).then(n=>{if(!n)return;const i=e.dd(n),s=new e.de(t,r,void 0,void 0,i);return s.computeBoundsAndApplyParent(),s}).catch(n=>{if(n&&404===n.status)return null;this.fire(new e.y(new Error("Could not load model ".concat(t," from ").concat(r,": ").concat(n.message))))})}load(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{forceReload:!1};this.models[r]||(this.models[r]={});const i=Object.keys(t),s=[],o=[];for(const e of i){const i=t[e];this.hasURLBeenRequested(i)&&!n.forceReload||(this.modelByURL[i]={modelId:e,scope:r},s.push(this.loadModel(e,i)),o.push(e)),this.models[r][e]||(this.models[r][e]={model:null,numReferences:1})}this.numModelsLoading[r]=(this.numModelsLoading[r]||0)+o.length,Promise.allSettled(s).then(t=>{for(let e=0;e<t.length;e++){const{status:n}=t[e];if("rejected"===n)continue;const{value:i}=t[e];this.models[r][o[e]]||(this.models[r][o[e]]={model:null,numReferences:1}),this.models[r][o[e]].model=i}this.numModelsLoading[r]-=o.length,this.fire(new e.z("data",{dataType:"style"}))}).catch(t=>{this.fire(new e.y(new Error("Could not load models: ".concat(t.message))))})}isLoaded(){for(const e in this.numModelsLoading)if(this.numModelsLoading[e]>0)return!1;return!0}hasModel(e,t){return!!((arguments.length>2&&void 0!==arguments[2]?arguments[2]:{exactIdMatch:!1}).exactIdMatch?this.getModel(e,t):this.getModelByURL(this.modelUris[t][e]))}getModel(e,t){return this.models[t]||(this.models[t]={}),this.models[t][e]?this.models[t][e].model:void 0}getModelByURL(e){if(!e)return null;const t=this.modelByURL[e];return t?this.models[t.scope][t.modelId].model:null}hasModelBeenAdded(e,t){return this.models[t]&&void 0!==this.models[t][e]}getModelURIs(e){return this.modelUris[e]||{}}addModel(e,t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const n=this.requestManager.normalizeModelURL(t);if((this.hasModel(e,r,{exactIdMatch:!0})||this.hasModelBeenAdded(e,r))&&this.modelUris[r][e]===n)this.models[r][e].numReferences++;else if(this.hasURLBeenRequested(n)){const{scope:e,modelId:t}=this.modelByURL[n];this.models[e][t].numReferences++}else this.modelUris[r][e]=n,this.load({[e]:this.modelUris[r][e]},r)}addModelURLs(e,t){this.models[t]||(this.models[t]={}),this.modelUris[t]||(this.modelUris[t]={});const r=this.modelUris[t];for(const n in e)r[n]=this.requestManager.normalizeModelURL(e[n])}reloadModels(e){this.load(this.modelUris[e],e,{forceReload:!0})}addModelsFromBucket(t,r){this.models[r]||(this.models[r]={}),this.modelUris[r]||(this.modelUris[r]={});const n={};for(const i of t)this.hasModel(i,r,{exactIdMatch:!0})||this.hasURLBeenRequested(i)?this.models[r][i].numReferences++:this.modelUris[r][i]&&!this.hasURLBeenRequested(i)?n[i]=this.modelUris[r][i]:!this.hasURLBeenRequested(i)&&e.df(i,!1)&&(this.modelUris[r][i]=this.requestManager.normalizeModelURL(i),n[i]=this.modelUris[r][i]);this.load(n,r)}hasURLBeenRequested(e){return void 0!==this.modelByURL[e]}removeModel(e,t){let r=arguments.length>2&&void 0!==arguments[2]&&arguments[2],n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.models[t]&&this.models[t][e]&&(this.models[t][e].numReferences--,0===this.models[t][e].numReferences||n)){const n=this.modelUris[t][e];r||delete this.modelUris[t][e],delete this.modelByURL[n];const i=this.models[t][e].model;if(!i)return;delete this.models[t][e],i.destroy()}}destroy(){for(const e of Object.keys(this.models))for(const t of Object.keys(this.models[e])){const r=this.models[e][t].model;delete this.models[e][t],r&&r.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(e){return this.models[e]||(this.models[e]={}),Object.keys(this.models[e])}upload(e,t){this.models[t]||(this.models[t]={});for(const r in this.models[t])this.models[t][r].model&&this.models[t][r].model.upload(e.context)}}const Sn=e.a6.colorTheme,Tn=new e.a9({data:new e.aa(Sn.data)});function kn(t){if(!t.metadata||!t.metadata.content_area)return;const r=e.o.devicePixelRatio,{left:n,top:i,width:s,height:o}=t.metadata.content_area,a=n*r,l=i*r;return[a,l,a+s*r,l+o*r]}function An(t){if(t)return t.map(t=>{let[r,n]=t;return[r*e.o.devicePixelRatio,n*e.o.devicePixelRatio]})}class Cn{constructor(e,t,r){this.id=e,this.scope=t,this.sourceCache=r,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(e){this.missingRequests.has(e.name)||this.pendingRequests.has(e.name)||this.pendingRequests.add(e.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const t=new Map;if(!this.sourceCache.loaded())return t;const r=this.sourceCache.getVisibleCoordinates();if(0===r.length)return t;const n=this.sourceCache.getSource();if(!(n instanceof yt))return t;const i=r.map(e=>this.sourceCache.getTile(e)),s=n.getImages(i,Array.from(this.pendingRequests));for(const[o,a]of s)t.set(e.I.from({name:o,iconsetId:this.id}),a),this.pendingRequests.delete(o);for(const e of this.pendingRequests)this.missingRequests.add(e);return this.pendingRequests.clear(),t}}const En=(e,t)=>ze(e,t&&t.filter(e=>"source.canvas"!==e.identifier)),Nn=e.aH(Gt,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setLayerProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),In=e.aH(Gt,["setCenter","setZoom","setBearing","setPitch"]),Pn=new Set(["background","sky","slot","custom"]),Mn={version:8,layers:[],sources:{}},Ln={duration:300,delay:0};class Rn extends e.E{constructor(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};super(),this.map=t,this.scope=r.scope||"",this.globalId=null,this.fragments=[],this.importDepth=r.importDepth||0,this.importsCache=r.importsCache||new Map,this.resolvedImports=r.resolvedImports||new Set,this.transition=Object.assign({},Ln),this._buildingIndex=new qt(this),this.crossTileSymbolIndex=new Yr,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedIndoor={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._hasAppearances=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._importedAsBasemap=!1,this._changes=r.styleChanges||new X,this._hasDataDrivenEmissive=!1,this.dispatcher=r.dispatcher?r.dispatcher:new e.D(e.dh(),this),r.imageManager?this.imageManager=r.imageManager:(this.imageManager=new Q(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=r.glyphManager?r.glyphManager:new e.di(t._requestManager,r.localFontFamily?e.dj.all:r.localIdeographFontFamily?e.dj.ideographs:e.dj.none,r.localFontFamily||r.localIdeographFontFamily),r.modelManager?this.modelManager=r.modelManager:(this.modelManager=new jn(t._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=r.configOptions?r.configOptions:new Map,this._configDependentLayers=r.configDependentLayers?r.configDependentLayers:new Set,this._indoorDependentLayers=r.indoorDependentLayers?r.indoorDependentLayers:new Set,this._config=r.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:r.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=r.initialConfig,this.dispatcher.broadcast("setReferrer",e.dk());const n=this;this._rtlTextPluginCallback=Rn.registerForPluginStateChange(t=>{n.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:t.pluginStatus,pluginURL:t.pluginURL},(t,r)=>{if(e.dl(t),r&&r.every(e=>e))for(const e in n._sourceCaches){const t=n._sourceCaches[e],r=t.getSource().type;"vector"!==r&&"geojson"!==r||t.reload()}})}),this.on("data",e=>{if("source"!==e.dataType||"metadata"!==e.sourceDataType)return;const t=this.getOwnSource(e.sourceId);if(t&&t.vectorLayerIds)for(const r in this._layers){const e=this._layers[r];e.source===t.id&&this._validateLayer(e)}})}load(e){return e?("string"==typeof e?this.loadURL(e):this.loadJSON(e),this):this}_getGlobalId(t){if(!t)return null;if("string"==typeof t){if(e.h(t))return t;const r=e.dm(t);if(!r.startsWith("http"))try{return new URL(r,location.href).toString()}catch(e){return r}return r}return"json://".concat(e.dn(JSON.stringify(t)))}_diffStyle(t,r,n){this.globalId=this._getGlobalId(t);const i=(e,t)=>{try{t(null,this.setState(e,n))}catch(e){t(e,!1)}};if("string"==typeof t){const n=this.map._requestManager.normalizeStyleURL(t),s=this.map._requestManager.transformRequest(n,e.R.Style);e.m(s,(t,n)=>{t?this.fire(new e.y(t)):n&&i(n,r)})}else"object"==typeof t&&i(t,r)}loadURL(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.z("dataloading",{dataType:"style"}));const n="boolean"==typeof r.validate?r.validate:!e.h(t);this.globalId=this._getGlobalId(t),t=this.map._requestManager.normalizeStyleURL(t,r.accessToken),this.resolvedImports.add(t);const i=this.importsCache.get(t);if(i)return this._load(i,n);const s=this.map._requestManager.transformRequest(t,e.R.Style);this._request=e.m(s,(r,i)=>{if(this._request=null,r)this.fire(new e.y(r));else if(i)return this.importsCache.set(t,i),this._load(i,n)})}loadJSON(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};this.fire(new e.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(t),this._request=e.o.frame(()=>{this._request=null,this._load(t,!1!==r.validate)})}loadEmpty(){this.fire(new e.z("dataloading",{dataType:"style"})),this._load(Mn,!1)}_loadImports(t,r,n){if(this.importDepth>=4)return e.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const i=[];for(const e of t){const t=this._createFragmentStyle(e),s=new Promise(e=>{t.once("style.import.load",e),t.once("error",e)}).then(()=>this.mergeAll());if(i.push(s),this.resolvedImports.has(e.url)){t.loadEmpty();continue}const o=e.data||this.importsCache.get(e.url);o?(t.loadJSON(o,{validate:r}),this._isInternalStyle(o)&&(t.globalId=null)):e.url?t.loadURL(e.url,{validate:r}):t.loadEmpty();const a={style:t,id:e.id,config:e.config};if(n){const e=this.fragments.findIndex(e=>{let{id:t}=e;return t===n});this.fragments=this.fragments.slice(0,e).concat(a).concat(this.fragments.slice(e))}else this.fragments.push(a)}return Promise.allSettled(i)}getImportGlobalIds(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:new Set;for(const r of e.fragments)r.style.globalId&&t.add(r.style.globalId),this.getImportGlobalIds(r.style,t);return[...t.values()]}_createFragmentStyle(t){const r=this.scope?e.B(t.id,this.scope):t.id;let n;const i=this._initialConfig&&this._initialConfig[r];(t.config||i)&&(n=Object.assign({},t.config,i));const s=new Rn(this.map,{scope:r,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:n,configOptions:this.options,colorThemeOverride:t["color-theme"],configDependentLayers:this._configDependentLayers,indoorDependentLayers:this._indoorDependentLayers});return s.setEventedParent(this.map,{style:s}),s}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this._updateLayers(this._indoorDependentLayers),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(e){return this.isRootStyle()&&(e.fragment||!!e.schema&&!1!==e.fragment)}_load(t,r){if(this._isInternalStyle(t)){const e=Object.assign({},Mn,{imports:[{id:"basemap",data:t,url:""}]},t.center?{center:t.center}:{},t.bearing?{bearing:t.bearing}:{},t.pitch?{pitch:t.pitch}:{},t.zoom?{zoom:t.zoom}:{},t.light?{light:t.light}:{});return this._importedAsBasemap=!0,void this._load(e,r)}if(this.updateConfig(this._config,t.schema),r&&En(this,Te(t)))return;this._loaded=!0,this.stylesheet=e.dp(t);const n=()=>{for(const e in t.sources)this.addSource(e,t.sources[e],{validate:!1,isInitialLoad:!0});if(t.iconsets)for(const e in t.iconsets)this.addIconset(e,t.iconsets[e]);t.sprite?this._loadIconset(t.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&t.glyphs&&this.glyphManager.setURL(t.glyphs);const n=Ht(this.stylesheet.layers);if(this._order=n.map(e=>e.id),this.stylesheet.light&&e.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(1===this.stylesheet.lights.length&&"flat"===this.stylesheet.lights[0].type){const e=this.stylesheet.lights[0];this.light=new Ve(e.properties,e.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Ve(this.stylesheet.light)),this._layers={};for(const t of n){const r=e.du(t,this.scope,this._styleColorTheme.lut,this.options);0!==r.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(r.fqid),r.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(r.fqid),this._hasAppearances=this._hasAppearances||0!==r.getAppearances().length,r.setEventedParent(this,{layer:{id:r.id}}),this._layers[r.id]=r;const n=this.getOwnLayerSourceCache(r),i=!!this.directionalLight&&this.directionalLight.shadowsEnabled();n&&r.canCastShadows()&&i&&(n.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const i=this.stylesheet.terrain;i&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(i,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new e.z("data",{dataType:"style"}));const s=this.isRootStyle();t.imports?this._loadImports(t.imports,r).then(()=>{this._reloadImports(),this.fire(new e.z(s?"style.load":"style.import.load"))}).catch(t=>{this.fire(new e.y(new Error("Failed to load imports",t))),this.fire(new e.z(s?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new e.z(s?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const i=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(i){const t=this._evaluateColorThemeData(i);this._loadColorTheme(t).then(()=>{n()}).catch(t=>{e.w("Couldn't load color theme from the stylesheet: ".concat(t)),n()})}else this._styleColorTheme.lut=null,n()}isRootStyle(){return 0===this.importDepth}hasAppearances(){return this._hasAppearances||this.fragments.some(e=>e.style.hasAppearances())}mergeAll(){let e,t,r,n,i,s,o,a,l,c;const u={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(d=>{if(d.stylesheet){if(null!=d.light&&(e=d.light),d.stylesheet.lights)for(const e of d.stylesheet.lights)"ambient"===e.type&&null!=d.ambientLight&&(t=d.ambientLight),"directional"===e.type&&null!=d.directionalLight&&(r=d.directionalLight);n=this._prioritizeTerrain(n,d.terrain,d.stylesheet.terrain),d.stylesheet.fog&&null!=d.fog&&(i=d.fog),d.stylesheet.snow&&null!=d.snow&&(s=d.snow),d.stylesheet.rain&&null!=d.rain&&(o=d.rain),null!=d.stylesheet.camera&&(c=d.stylesheet.camera),null!=d.stylesheet.projection&&(a=d.stylesheet.projection),null!=d.stylesheet.transition&&(l=d.stylesheet.transition),u[d.scope]=d._styleColorTheme}}),this.light=e,this.ambientLight=t,this.directionalLight=r,this.fog=i,this.snow=s,this.rain=o,this._styleColorThemeForScope=u,null===n?delete this.terrain:this.terrain=n,this.camera=c||{"camera-projection":"perspective"},this.projection=a||{name:"mercator"},this.transition=Object.assign({},Ln,l),this.mergeSources(),this.mergeLayers(),this.mergeIndoor()}forEachFragmentStyle(e){const t=r=>{for(const e of r.fragments)t(e.style);e(r)};t(this)}_prioritizeTerrain(e,t,r){const n=e&&0===e.drapeRenderMode;return null===r?t&&0===t.drapeRenderMode?t:n?e:null:null!=t&&(!e||n||t&&1===t.drapeRenderMode)?t:e}mergeTerrain(){let e;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(t=>{e=this._prioritizeTerrain(e,t.terrain,t.stylesheet.terrain)}),null===e?delete this.terrain:this.terrain=e}mergeProjection(){let e;this.forEachFragmentStyle(t=>{null!=t.stylesheet.projection&&(e=t.stylesheet.projection)}),this.projection=e||{name:"mercator"}}mergeSources(){const t={},r={},n={};this.forEachFragmentStyle(i=>{for(const r in i._sourceCaches){const n=e.B(r,i.scope);t[n]=i._sourceCaches[r]}for(const t in i._otherSourceCaches){const n=e.B(t,i.scope);r[n]=i._otherSourceCaches[t]}for(const t in i._symbolSourceCaches){const r=e.B(t,i.scope);n[r]=i._symbolSourceCaches[t]}}),this._mergedSourceCaches=t,this._mergedOtherSourceCaches=r,this._mergedSymbolSourceCaches=n}mergeIndoor(){this.forEachFragmentStyle(t=>{if(t.stylesheet&&t.stylesheet.indoor)for(const r of Object.values(t.stylesheet.indoor)){const n=r,i=e.B(n.sourceId,t.scope);this._mergedIndoor[i]=new Set(n.sourceLayers||[])}})}mergeLayers(){var t=this;const r={},n=[],i={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(t=>{for(const i of t._order){const s=t._layers[i];if("slot"===s.type){const t=e.dq(i);if(r[t])continue;r[t]=[]}s.slot&&r[s.slot]?r[s.slot].push(s):n.push(s)}}),this._mergedOrder=[];let s=-1;const o=function(){let n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[];for(const a of n)if("slot"===a.type){const n=e.dq(a.id);r[n]&&o(r[n]),t._mergedSlots.push(n)}else{const r=e.B(a.id,a.scope);t._mergedOrder.push(r),i[r]=a,a.is3D(!!t.terrain)&&(t._has3DLayers=!0,s=t._mergedOrder.length-1),"circle"===a.type&&(t._hasCircleLayers=!0),"symbol"===a.type&&(t._hasSymbolLayers=!0),"clip"===a.type&&(t._clipLayerPresent=!0)}};if(o(n),this._has3DLayers){const e={};for(let t=0;t<this._mergedOrder.length;++t){const r=this._mergedOrder[t];e[r]=t===s?1:t<s?i[r].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort((t,r)=>e[t]-e[r])}this._mergedLayers=i,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged(),this._updateDataDrivenEmissiveStrength()}terrainSetForDrapingOnly(){return!!this.terrain&&0===this.terrain.drapeRenderMode}getCamera(){return this.stylesheet.camera}setCamera(e){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,e),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(t){return t.data?function(t,r,n){const i=Object.assign({},r);for(const e of Object.keys(Sn))void 0===i[e]&&(i[e]=Sn[e].default);const s=new e.a8(Tn,t,new Map(n));return s.setTransitionOrValue(i,n),s.untransitioned().possiblyEvaluate(new e.ac(0,{worldview:void 0}))}(this.scope,t,this.options).get("data"):null}_loadColorTheme(t){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const r=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((n,i)=>{const s="data:image/png;base64,";if(!t||0===t.length)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void n();let o=t;o.startsWith(s)||(o=s+o);const a=e.I.from("mapbox-reserved-lut"),l=new Image;l.src=o,l.onerror=()=>{this._styleColorTheme.lutLoading=!1,i(new Error("Failed to load image data"))},l.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==r)return void n();this._styleColorTheme.lutLoading=!1;const{width:s,height:o,data:c}=e.o.getImageData(l);if(o>32)return void i(new Error("The height of the image must be less than or equal to 32 pixels."));if(s!==o*o)return void i(new Error("The width of the image must be equal to the height squared."));this.getImage(a)&&this.removeImage(a),this.addImage(a,{data:new e.q({width:s,height:o},c),pixelRatio:1,sdf:!1,usvg:!1,version:0});const u=this.imageManager.getImage(a,this.scope);u?(this._styleColorTheme.lut={image:u.data,data:t},n()):i(new Error("Missing LUT image."))}})}getLut(e){const t=this._styleColorThemeForScope[e];return t?t.lut:null}setProjection(e){e?this.stylesheet.projection=e:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(t){this._spriteRequest=function(t,r,n){let i,s,o;const a=e.o.devicePixelRatio>1?"@2x":"";let l=e.m(r.transformRequest(r.normalizeSpriteURL(t,a,".json"),e.R.SpriteJSON),(e,t)=>{l=null,o||(o=e,i=t,u())}),c=e.n(r.transformRequest(r.normalizeSpriteURL(t,a,".png"),e.R.SpriteImage),(e,t)=>{c=null,o||(o=e,s=t,u())});function u(){if(o)n(o);else if(i&&s){const t=e.o.getImageData(s),r={};for(const n in i){const{width:s,height:o,x:a,y:l,sdf:c,pixelRatio:u,stretchX:d,stretchY:h,content:p}=i[n],m=new e.q({width:s,height:o});e.q.copy(t,m,{x:a,y:l},{x:0,y:0},{width:s,height:o},null),r[n]={data:m,pixelRatio:void 0!==u?u:1,sdf:void 0!==c&&c,stretchX:d,stretchY:h,content:p,usvg:!1,version:0}}n(null,r)}}return{cancel(){l&&(l.cancel(),l=null),c&&(c.cancel(),c=null)}}}(t,this.map._requestManager,(t,r)=>{if(this._spriteRequest=null,t)this.fire(new e.y(t));else if(r){const t=new Map;for(const n in r)t.set(e.I.from(n),r[n]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.z("data",{dataType:"style"}))})}addIconset(t,r){if("sprite"===r.type)return void this._loadSprite(r.url);const n=this.getOwnSourceCache(r.source);if(!n)return void this.fire(new e.y(new Error('Source "'.concat(r.source,'" as specified by iconset "').concat(t,'" does not exist and cannot be used as an iconset source'))));const i=n.getSource();if("raster-array"!==i.type)return void this.fire(new e.y(new Error('Source "'.concat(r.source,'" as specified by iconset "').concat(t,'" is not a "raster-array" source and cannot be used as an iconset source'))));i.partial=!1;const s=new Cn(t,this.scope,n);this.imageManager.addImageProvider(s,this.scope)}removeIconset(e){this.imageManager.removeImageProvider(e,this.scope)}_loadIconset(t){if(!e.h(t)&&"icon_set"!==this.map._spriteFormat||"raster"===this.map._spriteFormat)return void this._loadSprite(t);const r="auto"===this.map._spriteFormat;var n,i;this._spriteRequest=(i=(n,i)=>{if(this._spriteRequest=null,n)r?this._loadSprite(t):this.fire(new e.y(n));else if(i){const t=new Map;for(const r in i)t.set(e.I.from(r),i[r]);this.addImages(t)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new e.z("data",{dataType:"style"}))},e.bu((n=this.map._requestManager).transformRequest(n.normalizeIconsetURL(t),e.R.Iconset),(t,r)=>{if(t)return void i(t);const n={},s=e.dg(new e.bt(r));for(const i of s.icons){const t={version:1,pixelRatio:e.o.devicePixelRatio,content:kn(i),stretchX:i.metadata?An(i.metadata.stretch_x_areas):void 0,stretchY:i.metadata?An(i.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:i};n[i.name]=t}i(null,n)}))}_validateLayer(t){const r=this.getOwnSource(t.source);if(!r)return;const n=t.sourceLayer;n&&("geojson"===r.type||r.vectorLayerIds&&-1===r.vectorLayerIds.indexOf(n))&&this.fire(new e.y(new Error('Source layer "'.concat(n,'" does not exist on source "').concat(r.id,'" as specified by style layer "').concat(t.id,'"'))))}loaded(){if(!this._loaded)return!1;if(Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const e in this._sourceCaches)if(!this._sourceCaches[e].loaded())return!1;if(!this.imageManager.isLoaded())return!1;if(this.imageManager.hasPatternsInFlight())return!1;if(!this.modelManager.isLoaded())return!1;if(this._styleColorTheme.lutLoading)return!1;for(const{style:e}of this.fragments)if(!e.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((e,t)=>{const r=this.fragments[t];return r&&r.style&&(e.data=r.style.serialize()),e})}_serializeSources(){const e={};for(const t in this._sourceCaches){const r=this._sourceCaches[t].getSource();e[r.id]||(e[r.id]=r.serialize())}return e}_serializeLayers(e){const t=[];for(const r of e){const e=this._layers[r];e&&"custom"!==e.type&&t.push(e.serialize())}return t}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions())return!0;if(this.hasFogTransition())return!0;if(this.hasSnowTransition())return!0;if(this.hasRainTransition())return!0;for(const e in this._sourceCaches)if(this._sourceCaches[e].hasTransition())return!0;for(const e in this._layers)if(this._layers[e].hasTransition())return!0;return!1}_updateDataDrivenEmissiveStrength(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];if(t._transitionablePaint&&t._transitionablePaint._values){const e=t._transitionablePaint._values["line-emissive-strength"];if(e&&e.value&&e.value.isDataDriven())return void(this._hasDataDrivenEmissive=!0)}}this._hasDataDrivenEmissive=!1}hasDataDrivenEmissiveStrength(){return this._hasDataDrivenEmissive}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(e){return e?this.order:this._mergedOrder}isLayerDraped(e){return!!this.terrain&&e.isDraped(this.getLayerSourceCache(e))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(t){const r=this.getOwnLayer(t);if(r)return r;this.fire(new e.y(new Error("The layer '".concat(t,"' does not exist in the map's style."))))}_checkSource(t){const r=this.getOwnSource(t);if(r)return r;this.fire(new e.y(new Error("The source '".concat(t,"' does not exist in the map's style."))))}precompilePrograms(e,t){const r=this.map.painter;if(r)for(let n=e.minzoom||0;n<(e.maxzoom||25.5);n++){const n=e.getProgramIds();if(n)for(const i of n){const n=e.getDefaultProgramParams(i,t.zoom,this._styleColorTheme.lut);n&&(r.style=this,this.fog&&(r._fogVisible=!0,n.overrideFog=!0,r.getOrCreateProgram(i,n)),r._fogVisible=!1,n.overrideFog=!1,r.getOrCreateProgram(i,n),(this.stylesheet.terrain||this.stylesheet.projection&&"globe"===this.stylesheet.projection.name)&&(n.overrideRtt=!0,r.getOrCreateProgram(i,n)))}}}update(t){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(t),this.directionalLight&&this.directionalLight.recalculate(t);const r=this.calculateLightsBrightness();t.brightness=r||0,r!==this._brightness&&(this._brightness=r,this.dispatcher.broadcast("setBrightness",r)),t.worldview!==this._worldview&&(this._worldview=t.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const n=this._changes.isDirty();let i=!1;if(this._changes.isDirty()){const e=this._changes.getLayerUpdatesByScope();for(const t in e){const{updatedIds:r,removedIds:n}=e[t];(r||n)&&(this._updateWorkerLayers(t,r,n),i=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(t),this.light&&this.light.updateTransitions(t),this.ambientLight&&this.ambientLight.updateTransitions(t),this.directionalLight&&this.directionalLight.updateTransitions(t),this.fog&&this.fog.updateTransitions(t),this.snow&&this.snow.updateTransitions(t),this.rain&&this.rain.updateTransitions(t),this._changes.reset()}const s={};for(const e in this._mergedSourceCaches){const t=this._mergedSourceCaches[e];s[e]=t.used,t.used=!1,t.tileCoverLift=0}for(const e of this._mergedOrder){const r=this._mergedLayers[e];if("none"!==r.visibility&&r.recalculate(t,this._availableImages),!r.isHidden(t.zoom)){const e=this.getLayerSourceCache(r);e&&(e.used=!0,e.tileCoverLift=Math.max(e.tileCoverLift,r.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(r,t)}):this.precompilePrograms(r,t))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&i&&this.mergeLayers();const o=this.imageManager.getPendingImageProviders();for(const e of o)e.sourceCache.used=!0;for(const a in s){const t=this._mergedSourceCaches[a];s[a]!==t.used&&t.getSource().fire(new e.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:t.getSource().id}))}this.light&&this.light.recalculate(t),this.terrain&&this.terrain.recalculate(t),this.fog&&this.fog.recalculate(t),this.snow&&this.snow.recalculate(t),this.rain&&this.rain.recalculate(t),this.z=t.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),n&&this.fire(new e.z("data",{dataType:"style"}))}updateImageProviders(){const e=this.imageManager.getPendingImageProviders();for(const t of e){const e=t.resolvePendingRequests(),r=this.getFragmentStyle(t.scope);r&&r.addImages(e)}}_updateTilesForChangedImages(){const e={};for(const t in this._mergedSourceCaches){const r=this._mergedSourceCaches[t].getSource().scope;e[r]=e[r]||this._changes.getUpdatedImages(r),0!==e[r].length&&this._mergedSourceCaches[t].reloadTilesForDependencies(["icons","patterns"],e[r])}for(const t in e)this._changes.resetUpdatedImages(t)}_updateWorkerLayers(e,t,r){const n=this.getFragmentStyle(e);n&&this.dispatcher.broadcast("updateLayers",{layers:t?n._serializeLayers(t):[],scope:e,removedIds:r||[],options:n.options})}setState(t,r){if(this._checkLoaded(),En(this,Te(t)))return!1;(t=e.dp(t)).layers=Ht(t.layers);const n=function(t,r){if(!t)return[{command:Gt.setStyle,args:[r]}];let n=[];try{if(!e.by(t.version,r.version))return[{command:Gt.setStyle,args:[r]}];if(e.by(t.center,r.center)||n.push({command:Gt.setCenter,args:[r.center]}),e.by(t.zoom,r.zoom)||n.push({command:Gt.setZoom,args:[r.zoom]}),e.by(t.bearing,r.bearing)||n.push({command:Gt.setBearing,args:[r.bearing]}),e.by(t.pitch,r.pitch)||n.push({command:Gt.setPitch,args:[r.pitch]}),e.by(t.sprite,r.sprite)||n.push({command:Gt.setSprite,args:[r.sprite]}),e.by(t.glyphs,r.glyphs)||n.push({command:Gt.setGlyphs,args:[r.glyphs]}),e.by(t.imports,r.imports)||function(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[],n=arguments.length>2?arguments[2]:void 0;r=r||[];const i=(t=t||[]).map(Qt),s=r.map(Qt),o=t.reduce($t,{}),a=r.reduce($t,{}),l=i.slice();let c,u,d,h;for(c=0,u=0;c<i.length;c++)d=i[c],a.hasOwnProperty(d)?u++:(n.push({command:Gt.removeImport,args:[d]}),l.splice(l.indexOf(d,u),1));for(c=0,u=0;c<s.length;c++)d=s[s.length-1-c],l[l.length-1-c]!==d&&(o.hasOwnProperty(d)?(n.push({command:Gt.removeImport,args:[d]}),l.splice(l.lastIndexOf(d,l.length-u),1)):u++,h=l[l.length-c],n.push({command:Gt.addImport,args:[a[d],h]}),l.splice(l.length-c,0,d));for(const p of r){const t=o[p.id];t&&(delete t.data,e.by(t,p)||n.push({command:Gt.updateImport,args:[p.id,p]}))}}(t.imports,r.imports,n),e.by(t.transition,r.transition)||n.push({command:Gt.setTransition,args:[r.transition]}),e.by(t.light,r.light)||n.push({command:Gt.setLight,args:[r.light]}),e.by(t.fog,r.fog)||n.push({command:Gt.setFog,args:[r.fog]}),e.by(t.snow,r.snow)||n.push({command:Gt.setSnow,args:[r.snow]}),e.by(t.rain,r.rain)||n.push({command:Gt.setRain,args:[r.rain]}),e.by(t.projection,r.projection)||n.push({command:Gt.setProjection,args:[r.projection]}),e.by(t.lights,r.lights)||n.push({command:Gt.setLights,args:[r.lights]}),e.by(t.camera,r.camera)||n.push({command:Gt.setCamera,args:[r.camera]}),e.by(t.iconsets,r.iconsets)||function(t,r,n){let i;for(i in r=r||{},t=t||{})t.hasOwnProperty(i)&&(r.hasOwnProperty(i)||n.push({command:Gt.removeIconset,args:[i]}));for(i in r){if(!r.hasOwnProperty(i))continue;const s=r[i];t.hasOwnProperty(i)?e.by(t[i],s)||(n.push({command:Gt.removeIconset,args:[i]}),n.push({command:Gt.addIconset,args:[i,s]})):n.push({command:Gt.addIconset,args:[i,s]})}}(t.iconsets,r.iconsets,n),!e.by(t["color-theme"],r["color-theme"]))return[{command:Gt.setStyle,args:[r]}];const i={},s=[];!function(t,r,n,i){let s;for(s in r=r||{},t=t||{})t.hasOwnProperty(s)&&(r.hasOwnProperty(s)||Kt(s,n,i));for(s in r){if(!r.hasOwnProperty(s))continue;const o=r[s];t.hasOwnProperty(s)?e.by(t[s],o)||("geojson"===t[s].type&&"geojson"===o.type&&Xt(t,r,s)?n.push({command:Gt.setGeoJSONSourceData,args:[s,o.data]}):Yt(s,r,n,i)):Zt(s,r,n)}}(t.sources,r.sources,s,i);const o=[];t.layers&&t.layers.forEach(e=>{e.source&&i[e.source]?n.push({command:Gt.removeLayer,args:[e.id]}):o.push(e)});let a=t.terrain;a&&i[a.source]&&(n.push({command:Gt.setTerrain,args:[void 0]}),a=void 0),n=n.concat(s),e.by(a,r.terrain)||n.push({command:Gt.setTerrain,args:[r.terrain]}),function(t,r,n){r=r||[];const i=(t=t||[]).map(Qt),s=r.map(Qt),o=t.reduce($t,{}),a=r.reduce($t,{}),l=i.slice(),c=Object.create(null);let u,d,h,p,m,f,g;for(u=0,d=0;u<i.length;u++)h=i[u],a.hasOwnProperty(h)?d++:(n.push({command:Gt.removeLayer,args:[h]}),l.splice(l.indexOf(h,d),1));for(u=0,d=0;u<s.length;u++)h=s[s.length-1-u],l[l.length-1-u]!==h&&(o.hasOwnProperty(h)?(n.push({command:Gt.removeLayer,args:[h]}),l.splice(l.lastIndexOf(h,l.length-d),1)):d++,f=l[l.length-u],n.push({command:Gt.addLayer,args:[a[h],f]}),l.splice(l.length-u,0,h),c[h]=!0);for(u=0;u<s.length;u++)if(h=s[u],p=o[h],m=a[h],!c[h]&&!e.by(p,m))if(e.by(p.source,m.source)&&e.by(p["source-layer"],m["source-layer"])&&e.by(p.type,m.type)){for(g in Jt(p.layout,m.layout,n,h,null,Gt.setLayoutProperty),Jt(p.paint,m.paint,n,h,null,Gt.setPaintProperty),e.by(p.slot,m.slot)||n.push({command:Gt.setSlot,args:[h,m.slot]}),e.by(p.filter,m.filter)||n.push({command:Gt.setFilter,args:[h,m.filter]}),e.by(p.minzoom,m.minzoom)&&e.by(p.maxzoom,m.maxzoom)||n.push({command:Gt.setLayerZoomRange,args:[h,m.minzoom,m.maxzoom]}),p)p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Jt(p[g],m[g],n,h,g.slice(6),Gt.setPaintProperty):e.by(p[g],m[g])||n.push({command:Gt.setLayerProperty,args:[h,g,m[g]]}));for(g in m)m.hasOwnProperty(g)&&!p.hasOwnProperty(g)&&"layout"!==g&&"paint"!==g&&"filter"!==g&&"metadata"!==g&&"minzoom"!==g&&"maxzoom"!==g&&"slot"!==g&&(0===g.indexOf("paint.")?Jt(p[g],m[g],n,h,g.slice(6),Gt.setPaintProperty):e.by(p[g],m[g])||n.push({command:Gt.setLayerProperty,args:[h,g,m[g]]}))}else n.push({command:Gt.removeLayer,args:[h]}),f=l[l.lastIndexOf(h)+1],n.push({command:Gt.addLayer,args:[m,f]})}(o,r.layers,n)}catch(e){console.warn("Unable to compute style diff:",e),n=[{command:Gt.setStyle,args:[r]}]}return n}(this.serialize(),t).filter(e=>!(e.command in In));if(0===n.length)return!1;const i=n.filter(e=>!(e.command in Nn));if(i.length>0)throw new Error("Unimplemented: ".concat(i.map(e=>e.command).join(", "),"."));const s=[];return n.forEach(e=>{s.push(this[e.command](...e.args))}),r&&Promise.all(s).then(r).catch(r),this.stylesheet=t,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(t){if(0===t.size)return this;for(const[r,n]of t.entries()){if(this.getImage(r))return this.fire(new e.y(new Error('An image with the name "'.concat(r.name,'" already exists.'))));this.imageManager.addImage(r,this.scope,n),this._changes.updateImage(r,this.scope)}return this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})),this}addImage(t,r){return this.getImage(t)?this.fire(new e.y(new Error('An image with the name "'.concat(t.name,'" already exists.')))):(this.imageManager.addImage(t,this.scope,r),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})),this)}updateImage(t,r){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this.imageManager.updateImage(t,this.scope,r),n&&(this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})))}getImage(e){return this.imageManager.getImage(e,this.scope)}removeImage(t){return this.getImage(t)?(this.imageManager.removeImage(t,this.scope),this._changes.updateImage(t,this.scope),this._updateWorkerImages(),this.fire(new e.z("data",{dataType:"style"})),this):this.fire(new e.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}getActualScope(){return this._importedAsBasemap?"basemap":this.scope}addModelURLs(t){return this.modelManager.addModelURLs(t,this.getActualScope()),this._updateWorkerModels(),this.fire(new e.z("data",{dataType:"style"})),this}addModel(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._checkLoaded(),this._validate(Fe,"models.".concat(t),r,null,n)||(this.modelManager.addModel(t,r,this.getActualScope()),this.fire(new e.z("data",{dataType:"style"}))),this}hasModel(e){return this.modelManager.hasModel(e,this.getActualScope())}removeModel(t){return this.hasModel(t)?(this.modelManager.removeModel(t,this.getActualScope(),!1,!0),this.fire(new e.z("data",{dataType:"style"})),this):this.fire(new e.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.getActualScope())}addSource(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};if(this._checkLoaded(),void 0!==this.getOwnSource(t))throw new Error('There is already a source with ID "'.concat(t,'".'));if(!r.type)throw new Error("The type property must be defined, but only the following properties were given: ".concat(Object.keys(r).join(", "),"."));if(["vector","raster","geojson","video","image"].indexOf(r.type)>=0&&this._validate(ke,"sources.".concat(t),r,null,n))return;this.map&&this.map._collectResourceTiming&&(r.collectResourceTiming=!0);const i=vt(t,r,this.dispatcher,this);i.scope=this.scope,i.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(i.id),source:i.serialize(),sourceId:i.id}));const s=t=>{const r=(t?"symbol:":"other:")+i.id,n=e.B(r,this.scope),s=this._sourceCaches[r]=new zt(n,i,t);(t?this._symbolSourceCaches:this._otherSourceCaches)[i.id]=s,s.onAdd(this.map)};s(!1),"vector"!==r.type&&"geojson"!==r.type||s(!0),i.onAdd&&i.onAdd(this.map),n.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(t){this._checkLoaded();const r=this.getOwnSource(t);if(!r)throw new Error("There is no source with this ID");for(const i in this._layers)if(this._layers[i].source===t)return this.fire(new e.y(new Error('Source "'.concat(t,'" cannot be removed while layer "').concat(i,'" is using it.'))));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===t)return this.fire(new e.y(new Error('Source "'.concat(t,'" cannot be removed while terrain is using it.'))));if(this.stylesheet.iconsets){const r=Object.entries(this.stylesheet.iconsets).find(e=>{let[r,n]=e;return"source"===n.type&&n.source===t});if(r)return this.fire(new e.y(new Error('Source "'.concat(t,'" cannot be removed while iconset "').concat(r[0],'" is using it.'))))}const n=this.getOwnSourceCaches(t);for(const i of n){const t=e.dq(i.id);delete this._sourceCaches[t],this._changes.discardSourceCacheUpdate(i.id),i.fire(new e.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:i.getSource().id})),i.setEventedParent(null),i.clearTiles()}return delete this._otherSourceCaches[t],delete this._symbolSourceCaches[t],this.mergeSources(),r.setEventedParent(null),r.onRemove&&r.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(e,t){this._checkLoaded(),this.getOwnSource(e).setData(t),this._changes.setDirty()}getOwnSource(e){const t=this.getOwnSourceCache(e);return t&&t.getSource()}getOwnSources(){const e=[];for(const t in this._otherSourceCaches){const r=this.getOwnSourceCache(t);r&&e.push(r.getSource())}return e}areTilesLoaded(){const e=this._mergedSourceCaches;for(const t in e){const r=e[t]._tiles;for(const e in r){const t=r[e];if("loaded"!==t.state&&"errored"!==t.state)return!1}}return!0}setLights(t){if(this._checkLoaded(),!t)return delete this.ambientLight,void delete this.directionalLight;const r=this._getTransitionParameters();for(const s of t){if(this._validate(Ce,"lights",s))return;switch(s.type){case"ambient":if(this.ambientLight){const e=this.ambientLight;e.set(s),e.updateTransitions(r)}else this.ambientLight=new ot(s,rt||(rt=new e.a9({color:new e.aa(e.a6.properties_light_ambient.color),"color-use-theme":new e.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.aa(e.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const e=this.directionalLight;e.set(s),e.updateTransitions(r)}else this.directionalLight=new ot(s,nt||(nt=new e.a9({direction:new e.ap(e.a6.properties_light_directional.direction),color:new e.aa(e.a6.properties_light_directional.color),"color-use-theme":new e.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new e.aa(e.a6.properties_light_directional.intensity),"cast-shadows":new e.aa(e.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new e.aa(e.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new e.aa(e.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const n=Object.assign(r,{worldview:this.map.getWorldview()}),i=new e.ac(this.z||0,n);this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const t=this.directionalLight,r=this.ambientLight;if(!t||!r)return;const n=e=>.2126*(e[0]<=.03928?e[0]/12.92:Math.pow((e[0]+.055)/1.055,2.4))+.7152*(e[1]<=.03928?e[1]/12.92:Math.pow((e[1]+.055)/1.055,2.4))+.0722*(e[2]<=.03928?e[2]/12.92:Math.pow((e[2]+.055)/1.055,2.4)),i=t.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),s=t.properties.get("intensity"),o=t.properties.get("direction"),a=1-e.d4(o.x,o.y,o.z)[2]/90,l=n(i)*s*a,c=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),u=r.properties.get("intensity"),d=n(c)*u;return Number(((l+d)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const e=[];return this.directionalLight&&e.push(this.directionalLight.get()),this.ambientLight&&e.push(this.ambientLight.get()),e}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(t){if(null==t||""===t&&this.isRootStyle())return this;if(e.dr(t)){const r=e.ds(t),n=this.fragments.find(e=>{let{id:t}=e;return t===r});if(!n)return;const i=e.dq(t);return n.style.getFragmentStyle(i)}{const e=this.fragments.find(e=>{let{id:r}=e;return r===t});return e?e.style:void 0}}setFeaturesetSelectors(t){if(!t)return;const r={},n=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";return"".concat(e,"::").concat(t)};this._featuresetSelectors={};for(const i in t){const s=this._featuresetSelectors[i]=[];for(const o of t[i].selectors){if(o.featureNamespace){const t=this.getOwnLayer(o.layer);if(!t){e.w("Layer is undefined for selector: ".concat(o.layer));continue}const s=n(t.source,t.sourceLayer);if(s in r&&r[s]!==o.featureNamespace){e.w('"featureNamespace '.concat(o.featureNamespace," of featureset ").concat(i,"'s selector is not associated to the same source, skip this selector"));continue}r[s]=o.featureNamespace}let t;if(o.properties)for(const r in o.properties){const n=e.U(o.properties[r]);"success"===n.result&&(t=t||{},t[r]=n.value)}s.push({layerId:o.layer,namespace:o.featureNamespace,properties:t,uniqueFeatureID:o._uniqueFeatureID})}}}getFeaturesetDescriptors(e){const t=this.getFragmentStyle(e);if(!t||!t.stylesheet.featuresets)return[];const r=[];for(const n in t.stylesheet.featuresets)r.push({featuresetId:n,importId:t.scope?t.scope:void 0});return r}getFeaturesetLayers(t,r){const n=this.getFragmentStyle(r),i=n.stylesheet.featuresets;if(!i||!i[t])return this.fire(new e.y(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried.")))),[];const s=[];for(const e of i[t].selectors){const t=n.getOwnLayer(e.layer);t&&s.push(t)}return s}getConfigProperty(t,r){const n=this.getFragmentStyle(t);if(!n)return null;const i=e.B(r,n.scope),s=n.options.get(i),o=s?s.value||s.default:null;return o?o.serialize():null}isIndoorEnabled(){return Object.keys(this._mergedIndoor).length>0}getIndoorSourceLayers(t,r){const n=e.B(t,r);return this._mergedIndoor[n]}setIndoorData(e,t){this.map.indoor.setIndoorData(t)}updateIndoorDependentLayers(){this._updateLayers(this._indoorDependentLayers),this.map._styleDirty=!0,this.map.triggerRepaint()}setConfigProperty(t,r,n){const i=this.getFragmentStyle(t);if(!i)return;const s=i.stylesheet.schema;if(!s||!s[r])return;const o=e.U(n);if("success"!==o.result)return void En(this,o.value);const a=o.value.expression,l=e.B(r,i.scope),c=i.options.get(l);if(!c)return;let u;const{minValue:d,maxValue:h,stepValue:p,type:m,values:f}=s[r],g=e.U(s[r].default);"success"===g.result&&(u=g.value.expression),u?(this.options.set(l,Object.assign({},c,{value:a,default:u,minValue:d,maxValue:h,stepValue:p,type:m,values:f})),this.updateConfigDependencies(r)):this.fire(new e.y(new Error('No schema defined for the config option "'.concat(r,'" in the "').concat(t,'" fragment.'))))}getConfig(t){const r=this.getFragmentStyle(t);if(!r)return null;const n=r.stylesheet.schema;if(!n)return null;const i={};for(const s in n){const t=e.B(s,r.scope),n=r.options.get(t),o=n?n.value||n.default:null;i[s]=o?o.serialize():null}return i}setConfig(e,t){const r=this.getFragmentStyle(e);r&&(r.updateConfig(t,r.stylesheet.schema),this.updateConfigDependencies())}getSchema(e){const t=this.getFragmentStyle(e);return t?t.stylesheet.schema:null}setSchema(e,t){const r=this.getFragmentStyle(e);r&&(r.stylesheet.schema=t,r.updateConfig(r._config,t),this.updateConfigDependencies())}updateConfig(t,r){if(this._config=t,t||r)if(r)for(const n in r){let i,s;const o=e.U(r[n].default);if("success"===o.result&&(i=o.value.expression),t&&void 0!==t[n]){const r=e.U(t[n]);"success"===r.result&&(s=r.value.expression)}const{minValue:a,maxValue:l,stepValue:c,type:u,values:d}=r[n];if(i){const t=e.B(n,this.scope);this.options.set(t,{default:i,value:s,minValue:a,maxValue:l,stepValue:c,type:u,values:d})}else this.fire(new e.y(new Error('No schema defined for config option "'.concat(n,'".'))))}else this.fire(new e.y(new Error("Attempting to set config for a style without schema.")))}_updateLayers(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:()=>!0;for(const r of e){const e=this.getLayer(r);e&&t(e)&&(e.possiblyEvaluateVisibility(),this._updateLayer(e),this._changes.setDirty())}}updateConfigDependencies(e){this._updateLayers(this._configDependentLayers,t=>!e||t.expressionDependencies.configDependencies.has(e)),this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(e=>{const t=e._styleColorTheme.colorThemeOverride?e._styleColorTheme.colorThemeOverride:e._styleColorTheme.colorTheme;if(t){const r=e._evaluateColorThemeData(t);(!e._styleColorTheme.lut&&""!==r||e._styleColorTheme.lut&&r!==e._styleColorTheme.lut.data)&&e.setColorTheme(t)}}),this._changes.setDirty()}addLayer(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=t.id;if(this._layers[i])return void this.fire(new e.y(new Error('Layer with id "'.concat(i,'" already exists on this map'))));let s;if("custom"===t.type){if(En(this,e.dt(t)))return;s=e.du(t,this.scope,this._styleColorTheme.lut,this.options)}else{if("object"==typeof t.source&&(this.addSource(i,t.source),t=e.dp(t),t=Object.assign(t,{source:i})),this._validate(Me,"layers.".concat(i),t,{arrayIndex:-1},n))return;s=e.du(t,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(s),s.setEventedParent(this,{layer:{id:i}})}const o=e.B(s.source,s.scope);0!==s.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(o),s.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(o);let a=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.y(new Error('Layer with id "'.concat(r,'" does not exist on this map.'))));s.slot===this._layers[r].slot?a=t:e.w('Layer with id "'.concat(r,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(a,0,i),this._layerOrderChanged=!0,this._layers[i]=s;const l=this.getOwnLayerSourceCache(s),c=!!this.directionalLight&&this.directionalLight.shadowsEnabled();l&&s.canCastShadows()&&c&&(l.castsShadows=!0);const u=this._changes.getRemovedLayer(s);if(u&&s.source&&l&&"custom"!==s.type){this._changes.discardLayerRemoval(s);const t=e.B(s.source,s.scope);u.type!==s.type?this._changes.updateSourceCache(t,"clear"):(this._changes.updateSourceCache(t,"reload"),l.pause())}this._updateLayer(s),s.onAdd&&s.onAdd(this.map),s.scope=this.scope,this.mergeLayers()}moveLayer(t,r){this._checkLoaded();const n=this._checkLayer(t);if(!n)return;if(t===r)return;const i=this._order.indexOf(t);this._order.splice(i,1);let s=this._order.length;if(r){const t=this._order.indexOf(r);if(-1===t)return void this.fire(new e.y(new Error('Layer with id "'.concat(r,'" does not exist on this map.'))));n.slot===this._layers[r].slot?s=t:e.w('Layer with id "'.concat(r,'" has a different slot. Layers can only be rearranged within the same slot.'))}this._order.splice(s,0,t),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(e){this._checkLoaded();const t=this._checkLayer(e);if(!t)return;t.setEventedParent(null);const r=this._order.indexOf(e);this._order.splice(r,1),delete this._layers[e],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(t.fqid),this._indoorDependentLayers.delete(t.fqid),this._changes.removeLayer(t);const n=this.getOwnLayerSourceCache(t);if(n&&n.castsShadows){let e=!1;for(const r in this._layers)if(this._layers[r].source===t.source&&this._layers[r].canCastShadows()){e=!0;break}n.castsShadows=e}t.onRemove&&t.onRemove(this.map),this.mergeLayers()}getOwnLayer(e){return this._layers[e]}hasLayer(e){return e in this._mergedLayers}hasLayerType(e){for(const t in this._layers)if(this._layers[t].type===e)return!0;return!1}setLayerZoomRange(e,t,r){this._checkLoaded();const n=this._checkLayer(e);n&&(n.minzoom===t&&n.maxzoom===r||(null!=t&&(n.minzoom=t),null!=r&&(n.maxzoom=r),this._updateLayer(n)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(e,t){this._checkLoaded();const r=this._checkLayer(e);r&&r.slot!==t&&(r.slot=t,this._updateLayer(r))}setFilter(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this._checkLayer(t);if(i&&!e.by(i.filter,r))return null==r?(i.filter=void 0,void this._updateLayer(i)):void(this._validate(Le,"layers.".concat(i.id,".filter"),r,{layerType:i.type},n)||(i.filter=e.dp(r),this._updateLayer(i)))}getFilter(t){const r=this._checkLayer(t);if(r)return e.dp(r.filter)}setLayoutProperty(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const s=this._checkLayer(t);if(s&&!e.by(s.getLayoutProperty(r),n)){if(null!=n&&(!i||!1!==i.validate)&&En(s,De.call(Te,{key:"layers.".concat(t,".layout.").concat(r),layerType:s.type,objectKey:r,value:n,styleSpec:e.a6,style:{glyphs:!0,sprite:!0}})))return;s.setLayoutProperty(r,n),0!==s.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(s.fqid),s.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(s.fqid),this._updateLayer(s)}}setLayerProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const i=this._checkLayer(e);i&&("appearances"===t?(i.setAppearances(r),this._changes.setDirty()):i.isPaintProperty(t)?this.setPaintProperty(e,t,r,n):this.setLayoutProperty(e,t,r,n))}getLayoutProperty(e,t){const r=this._checkLayer(e);if(r)return r.getLayoutProperty(t)}setPaintProperty(t,r,n){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};this._checkLoaded();const s=this._checkLayer(t);if(!s)return;if(e.by(s.getPaintProperty(r),n))return;if(null!=n&&(!i||!1!==i.validate)&&En(s,Re.call(Te,{key:"layers.".concat(t,".paint.").concat(r),layerType:s.type,objectKey:r,value:n,styleSpec:e.a6})))return;const o=s.setPaintProperty(r,n);0!==s.expressionDependencies.configDependencies.size&&this._configDependentLayers.add(s.fqid),s.expressionDependencies.isIndoorDependent&&this._indoorDependentLayers.add(s.fqid),o&&this._updateLayer(s),this._changes.updatePaintProperties(s)}getPaintProperty(e,t){const r=this._checkLayer(e);if(r)return r.getPaintProperty(t)}setFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:n}=t.target,i=this.getFragmentStyle(n),s=i.getFeaturesetLayers(e);for(const{source:o,sourceLayer:a}of s)i.setFeatureState({id:t.id,source:o,sourceLayer:a},r)}else if("layerId"in t.target){const{layerId:e}=t.target,n=this.getLayer(e);this.setFeatureState({id:t.id,source:n.source,sourceLayer:n.sourceLayer},r)}return}const n=t.source,i=t.sourceLayer,s=this._checkSource(n);if(!s)return;const o=s.type;if("geojson"===o&&i)return void this.fire(new e.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if("vector"===o&&!i)return void this.fire(new e.y(new Error("The sourceLayer parameter must be provided for vector source types.")));void 0===t.id&&this.fire(new e.y(new Error("The feature id parameter must be provided.")));const a=this.getOwnSourceCaches(n);for(const e of a)e.setFeatureState(i,t.id,r)}removeFeatureState(t,r){if(this._checkLoaded(),"target"in t){if("featuresetId"in t.target){const{featuresetId:e,importId:n}=t.target,i=this.getFragmentStyle(n),s=i.getFeaturesetLayers(e);for(const{source:o,sourceLayer:a}of s)i.removeFeatureState({id:t.id,source:o,sourceLayer:a},r)}else if("layerId"in t.target){const{layerId:e}=t.target,n=this.getLayer(e);this.removeFeatureState({id:t.id,source:n.source,sourceLayer:n.sourceLayer},r)}return}const n=t.source,i=this._checkSource(n);if(!i)return;const s=i.type,o="vector"===s?t.sourceLayer:void 0;if("vector"===s&&!o)return void this.fire(new e.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(r&&"string"!=typeof t.id&&"number"!=typeof t.id)return void this.fire(new e.y(new Error("A feature id is required to remove its specific state property.")));const a=this.getOwnSourceCaches(n);for(const e of a)e.removeFeatureState(o,t.id,r)}getFeatureState(t){if(this._checkLoaded(),"target"in t){let r;if("featuresetId"in t.target){const{featuresetId:n,importId:i}=t.target,s=this.getFragmentStyle(i),o=s.getFeaturesetLayers(n);for(const{source:a,sourceLayer:l}of o){const n=s.getFeatureState({id:t.id,source:a,sourceLayer:l});if(n&&!r)r=n;else if(!e.by(r,n))return void this.fire(new e.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in t.target){const{layerId:e}=t.target,n=this.getLayer(e);r=this.getFeatureState({id:t.id,source:n.source,sourceLayer:n.sourceLayer})}return r}const r=t.source,n=t.sourceLayer,i=this._checkSource(r);if(i){if("vector"!==i.type||n)return void 0===t.id&&this.fire(new e.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(r)[0].getFeatureState(n,t.id);this.fire(new e.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(e){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,e),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const t=this.getTerrain(),r=t&&this.terrain&&this.terrain.scope===this.scope?t:this.stylesheet.terrain;return e.dv({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:r,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},e=>void 0!==e)}_updateFilteredLayers(e){for(const t of Object.values(this._mergedLayers))e(t)&&this._updateLayer(t)}_updateLayer(t){this._changes.updateLayer(t);const r=this.getLayerSourceCache(t),n=e.B(t.source,t.scope),i=this._changes.getUpdatedSourceCaches();t.source&&!i[n]&&r&&"raster"!==r.getSource().type&&(this._changes.updateSourceCache(n,"reload"),r.pause()),t.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(e){const t=e=>this._mergedLayers[e].is3D(!!this.terrain),r=this.order,n={},i=[];for(let o=r.length-1;o>=0;o--){const s=r[o];if(t(s)){n[s]=o;for(const t of e){const e=t[s];if(e)for(const t of e)i.push(t)}}}i.sort((e,t)=>t.intersectionZ-e.intersectionZ);const s=[];for(let o=r.length-1;o>=0;o--){const a=r[o];if(t(a))for(let e=i.length-1;e>=0;e--){const t=i[e].feature;if(t.layer&&n[t.layer.id]<o)break;s.push(t),i.pop()}else for(const t of e){const e=t[a];if(e)for(const t of e)s.push(t.feature)}}return s}queryRasterValue(t,r,n){const i=this.getOwnSource(t);return i?"raster-array"!==i.type?(this.fire(new e.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):i.queryRasterArrayValue(r,n):(this.fire(new e.y(new Error('Source with id "'.concat(t,'" does not exist in the style.')))),Promise.resolve(null))}queryRenderedFeatures(t,r,n){let i;r&&!Array.isArray(r)&&r.filter&&(this._validate(Le,"queryRenderedFeatures.filter",r.filter,null,r),i=e.b6(r.filter));const s={},o=e=>{if(Pn.has(e.type))return;const t=this.getOwnLayerSourceCache(e),r=s[t.id]=s[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};e.is3D(!!this.terrain)&&(r.has3DLayers=!0),r.layers[e.fqid]=r.layers[e.fqid]||{styleLayer:e,targets:[]},r.layers[e.fqid].targets.push({filter:i})};if(r&&r.layers){if(!Array.isArray(r.layers))return this.fire(new e.y(new Error("parameters.layers must be an Array."))),[];for(const t of r.layers){const r=this._layers[t];if(!r)return this.fire(new e.y(new Error("The layer '".concat(t,"' does not exist in the map's style and cannot be queried for features.")))),[];o(r)}}else for(const e in this._layers)o(this._layers[e]);const a=this._queryRenderedFeatures(t,s,n),l=this._flattenAndSortRenderedFeatures(a),c=[];for(const u of l)e.dw(u.layer.id)===this.scope&&c.push(u);return c}queryRenderedFeatureset(t,r,n){let i;r&&!Array.isArray(r)&&r.filter&&(this._validate(Le,"queryRenderedFeatures.filter",r.filter,null,r),i=e.b6(r.filter));const s="mock",o=[];if(r&&r.target)o.push(Object.assign({},r,{targetId:s,filter:i}));else{const e=this.getFeaturesetDescriptors();for(const t of e)o.push({targetId:s,filter:i,target:t});for(const{style:t}of this.fragments){const e=t.getFeaturesetDescriptors();for(const t of e)o.push({targetId:s,filter:i,target:t})}}const a=this.queryRenderedTargets(t,o,n),l=[],c=new Set;for(const u of a)for(const t of u.variants[s])bt(t,u,c)||l.push(new e.dx(u,t));return l}queryRenderedTargets(t,r,n){const i={},s=(e,t,r,n)=>{const s=i[t.id]=i[t.id]||{sourceCache:t,layers:{},has3DLayers:!1};if(s.layers[e.fqid]=s.layers[e.fqid]||{styleLayer:e,targets:[]},e.is3D(!!this.terrain)&&(s.has3DLayers=!0),!n)return r.uniqueFeatureID=!1,void s.layers[e.fqid].targets.push(r);s.layers[e.fqid].targets.push(Object.assign({},r,{namespace:n.namespace,properties:n.properties,uniqueFeatureID:n.uniqueFeatureID}))};for(const a of r)if("featuresetId"in a.target){const{featuresetId:t,importId:r}=a.target,n=this.getFragmentStyle(r);if(!n||!n._featuresetSelectors)continue;const i=n._featuresetSelectors[t];if(!i){this.fire(new e.y(new Error("The featureset '".concat(t,"' does not exist in the map's style and cannot be queried for features."))));continue}for(const e of i){const t=n.getOwnLayer(e.layerId);t&&!Pn.has(t.type)&&s(t,n.getOwnLayerSourceCache(t),a,e)}}else if("layerId"in a.target){const{layerId:e}=a.target,t=this.getLayer(e);if(!t||Pn.has(t.type))continue;s(t,this.getLayerSourceCache(t),a)}const o=this._queryRenderedFeatures(t,i,n);return this._flattenAndSortRenderedFeatures(o)}_queryRenderedFeatures(e,t,r){const n=[],i=!!this.map._showQueryGeometry,s=at.createFromScreenPoints(e,r);for(const o in t){const e=wt(s,t[o],this._availableImages,r,i);Object.keys(e).length&&n.push(e)}if(this.placement)for(const o in t){if(!t[o].sourceCache._onlySymbols)continue;const e=jt(s.screenGeometry,t[o],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(e).length&&n.push(e)}return n}querySourceFeatures(e,t){const r=t&&t.filter;r&&this._validate(Le,"querySourceFeatures.filter",r,null,t);let n=[];const i=this.getOwnSourceCaches(e);for(const s of i)n=n.concat(St(s,t));return n}addSourceType(e,t,r){return Rn.getSourceType(e)?r(new Error('A source type called "'.concat(e,'" already exists.'))):(Rn.setSourceType(e,t),t.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:e,url:t.workerSourceURL},r):r(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._checkLoaded();const i=this.light.getLight();let s=!1;for(const a in t)if(!e.by(t[a],i[a])){s=!0;break}if(!s)return;const o=this._getTransitionParameters();this.light.setLight(t,r,n),this.light.updateTransitions(o)}getTerrain(){return this.terrain&&1===this.terrain.drapeRenderMode?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){void 0===this.disableElevatedTerrain&&(this.disableElevatedTerrain=e.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&e.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(t){let r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1;if(this._checkLoaded(),!t)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),0===r&&delete this.terrain,null===t?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let n=t;const i=!("source"in t)||null==t.source;if(1===r){if(this.disableElevatedTerrain)return;if("source"in n&&"object"==typeof n.source){const t="terrain-dem-src";this.addSource(t,n.source),n=e.dp(n),n=Object.assign(n,{source:t})}const t=Object.assign({},n),r={};if(this.terrain&&i){t.source=this.terrain.get().source;const e=this.terrain?this.getFragmentStyle(this.terrain.scope):null;e&&(r.style=e.serialize())}if(this._validate(Ee,"terrain",t,r))return}if(!this.terrain||this.terrain.scope!==this.scope&&!i||this.terrain&&r!==this.terrain.drapeRenderMode){if(!n)return;this._createTerrain(n,r),this.fire(new e.z("data",{dataType:"style"}))}else{const r=this.terrain,i=r.get();for(const t of Object.keys(e.a6.terrain))!n.hasOwnProperty(t)&&e.a6.terrain[t].default&&(n[t]=e.a6.terrain[t].default);for(const n in t)if(!e.by(t[n],i[n])){r.set(t,this.options),this.stylesheet.terrain=t;const n=this._getTransitionParameters({duration:0});r.updateTransitions(n),this.fire(new e.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(e){const t=this.fog=new $e(e,this.map.transform,this.scope,this.options);this.stylesheet.fog=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_createSnow(e){const t=this.snow=new it(e,this.map.transform,this.scope,this.options);this.stylesheet.snow=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_createRain(e){const t=this.rain=new st(e,this.map.transform,this.scope,this.options);this.stylesheet.rain=t.get();const r=this._getTransitionParameters({duration:0});t.updateTransitions(r)}_updateMarkersOpacity(){0!==this.map._markers.length&&this.map._requestDomTask(()=>{for(const e of this.map._markers)e._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(t){if(this._checkLoaded(),!t)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const r=this.fog;if(!e.by(r.get(),t)){r.set(t,this.options),this.stylesheet.fog=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createFog(t);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(t){if(this._checkLoaded(),!t)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const r=this.snow;if(!e.by(r.get(),t)){r.set(t,this.options),this.stylesheet.snow=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createSnow(t);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(t){if(this._checkLoaded(),!t)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const r=this.rain;if(!e.by(r.get(),t)){r.set(t,this.options),this.stylesheet.rain=r.get();const e=this._getTransitionParameters({duration:0});r.updateTransitions(e)}}else this._createRain(t);this._markersNeedUpdate=!0}_reloadColorTheme(){const t=()=>{for(const e in this._layers)this._layers[e].lut=this._styleColorTheme.lut;for(const e in this._sourceCaches)this._sourceCaches[e].clearTiles()},r=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!r)return this._styleColorTheme.lut=null,void t();const n=this._evaluateColorThemeData(r);this._loadColorTheme(n).then(()=>{this.fire(new e.z("colorthemeset")),t()}).catch(t=>{e.w("Couldn't set color theme: ".concat(t))})}setColorTheme(t){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&e.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=t,this._reloadColorTheme()}setImportColorTheme(e,t){const r=this.getFragmentStyle(e);r&&(r._styleColorTheme.colorThemeOverride=t,r._reloadColorTheme())}_getTransitionParameters(t){return{now:e.o.now(),transition:Object.assign(this.transition,t)}}updateDrapeFirstLayers(){if(!this.terrain)return;const e=[],t=[];for(const r of this._mergedOrder)this.isLayerDraped(this._mergedLayers[r])?e.push(r):t.push(r);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...e),this._drapedFirstOrder.push(...t)}_createTerrain(e,t){const r=this.terrain=new We(e,t,this.scope,this.options,this.map.getWorldview());1===t&&(this.stylesheet.terrain=e),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const n=this._getTransitionParameters({duration:0});r.updateTransitions(n)}_force3DLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"fill-extrusion"===t.type&&this._updateLayer(t)}}_forceSymbolLayerUpdate(){for(const e in this._layers){const t=this._layers[e];"symbol"===t.type&&this._updateLayer(t)}}_validate(t,r,n,i){let s=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{};if(s&&!1===s.validate)return!1;const o=Object.assign({},this.serialize());return En(this,t.call(Te,Object.assign({key:r,style:o,value:n,styleSpec:e.a6},i)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),e.dy.off("pluginStateChange",this._rtlTextPluginCallback);for(const e in this._mergedLayers)this._mergedLayers[e].setEventedParent(null);for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles(),this._mergedSourceCaches[e].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(e){const t=this.getSourceCaches(e);for(const r of t)r.clearTiles()}clearSources(){for(const e in this._mergedSourceCaches)this._mergedSourceCaches[e].clearTiles()}clearLayers(){for(const e in this._mergedLayers){const t=this._mergedLayers[e];t._clear&&t._clear()}}reloadSource(e){const t=this.getSourceCaches(e);for(const r of t)r.resume(),r.reload()}reloadSources(){for(const e of this.getSources())e.reload&&e.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(e=>{e.modelManager.reloadModels(e.scope)})}updateSources(e){let t;this.directionalLight&&(t=xn(this.directionalLight));const r=new Set,n=new Set;for(const i in this._mergedLayers){const e=this._mergedLayers[i];"building"===e.type&&r.add(e.source),e.hasElevation()&&!n.has(e.source)&&n.add(e.source)}for(const i in this._mergedSourceCaches){const s=this._mergedSourceCaches[i],o=n.has(s._source.id);r.has(s._source.id)&&(s._source.reparseOverscaled=!1),s.update(e,void 0,void 0,t,o)}}_generateCollisionBoxes(){for(const e in this._sourceCaches){const t=this._sourceCaches[e];t.resume(),t.reload()}}_updatePlacement(t,r,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]&&arguments[6],l=!1,c=!1;const u={},d={};for(const f of this._mergedOrder){const t=this._mergedLayers[f];if("symbol"!==t.type)continue;const n=e.B(t.source,t.scope);let i=u[n];if(!i){const e=this.getLayerSourceCache(t);if(!e)continue;const r=e.getRenderableIds(!0).map(t=>e.getTileByID(t));d[n]=r.slice(),i=u[n]=r.sort((e,t)=>t.tileID.overscaledZ-e.tileID.overscaledZ||(e.tileID.isLessThan(t.tileID)?-1:1))}const s=this.crossTileSymbolIndex.addLayer(t,i,r.center.lng,r.projection);l=l||s}this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),a=a||this._layerOrderChanged,this._layerOrderChanged&&this.fire(new e.z("neworder"));const h=Boolean(this.placement&&!r.equals(this.placement.transform)),p=Boolean(this.placement&&(0!==this.placement.lastReplacementSourceUpdateTime&&!o||this.placement.lastReplacementSourceUpdateTime!==o.updateTime)),m=(h||p||l||this.placement&&this.placement.isStale())&&0===i;if((a||!this.pauseablePlacement||m||0!==i&&this.pauseablePlacement.isDone()&&!this.placement.stillRecent(e.o.now(),r.zoom))&&(this.pauseablePlacement=new Wr(r,this._mergedOrder,a||0===i,n,i,s,this.placement,this.fog&&r.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,u,d,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(e.o.now()),c=!0),l&&this.pauseablePlacement.placement.setStale()),c||l){this._buildingIndex.onNewFrame(r.zoom);for(let t=0;t<this._mergedOrder.length;t++){const r=this._mergedLayers[this._mergedOrder[t]];if("symbol"!==r.type)continue;if("none"===r.visibility)continue;const n=this.isLayerClipped(r);this.placement.updateLayerOpacities(r,u[e.B(r.source,r.scope)],t,n?o:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(e.o.now())}}_releaseSymbolFadeTiles(){for(const e in this._sourceCaches)this._sourceCaches[e].releaseSymbolFadeTiles()}addImport(t,r){this._checkLoaded();const n=this.stylesheet.imports=this.stylesheet.imports||[];if(-1!==n.findIndex(e=>{let{id:r}=e;return r===t.id}))return void this.fire(new e.y(new Error("Import with id '".concat(t.id,"' already exists in the map's style."))));if(!r)return n.push(t),this._loadImports([t],!0);const i=n.findIndex(e=>{let{id:t}=e;return t===r});return-1===i&&this.fire(new e.y(new Error('Import with id "'.concat(r,'" does not exist on this map.')))),this.stylesheet.imports=n.slice(0,i).concat(t).concat(n.slice(i)),this._loadImports([t],!0,r)}updateImport(t,r){this._checkLoaded();const n=this.stylesheet.imports||[],i=this.getImportIndex(t);return-1===i?this:"string"==typeof r?(this.setImportUrl(t,r),this):(r.url&&r.url!==n[i].url&&this.setImportUrl(t,r.url),e.by(r.config,n[i].config)||this.setImportConfig(t,r.config,r.data.schema),e.by(r.data,n[i].data)||this.setImportData(t,r.data),this)}moveImport(e,t){this._checkLoaded();let r=this.stylesheet.imports||[];const n=this.getImportIndex(e);if(-1===n)return this;const i=this.getImportIndex(t);if(-1===i)return this;const s=r[n],o=this.fragments[n];return r=r.filter(t=>{let{id:r}=t;return r!==e}),this.fragments=this.fragments.filter(t=>{let{id:r}=t;return r!==e}),this.stylesheet.imports=r.slice(0,i).concat(s).concat(r.slice(i)),this.fragments=this.fragments.slice(0,i).concat(o).concat(this.fragments.slice(i)),this.mergeLayers(),this}setImportUrl(e,t){this._checkLoaded();const r=this.stylesheet.imports||[],n=this.getImportIndex(e);if(-1===n)return this;r[n].url=t;const i=this.fragments[n];return i.style=this._createFragmentStyle(r[n]),i.style.on("style.import.load",()=>this.mergeAll()),i.style.loadURL(t),this}setImportData(e,t){this._checkLoaded();const r=this.getImportIndex(e),n=this.stylesheet.imports||[];return-1===r?this:t?(this.fragments[r].style.setState(t),this._reloadImports(),this):(delete n[r].data,this.setImportUrl(e,n[r].url))}setImportConfig(e,t,r){this._checkLoaded();const n=this.getImportIndex(e),i=this.stylesheet.imports||[];if(-1===n)return this;t?i[n].config=t:delete i[n].config;const s=this.fragments[n];r&&s.style.stylesheet&&(s.style.stylesheet.schema=r);const o=s.style.stylesheet&&s.style.stylesheet.schema;return s.config=t,s.style.updateConfig(t,o),this.updateConfigDependencies(),this}removeImport(e){this._checkLoaded();const t=this.stylesheet.imports||[],r=this.getImportIndex(e);-1!==r&&(t.splice(r,1),this.fragments[r].style._remove(),this.fragments.splice(r,1),this._reloadImports())}getImportIndex(t){const r=(this.stylesheet.imports||[]).findIndex(e=>e.id===t);return-1===r&&this.fire(new e.y(new Error("Import '".concat(t,"' does not exist in the map's style and cannot be updated.")))),r}getLayer(e){return this._mergedLayers[e]}getSources(){const e=[];for(const t in this._mergedOtherSourceCaches){const r=this._mergedOtherSourceCaches[t];r&&e.push(r.getSource())}return e}getSource(e,t){const r=this.getSourceCache(e,t);return r&&r.getSource()}getLayerSource(e){const t=this.getLayerSourceCache(e);return t&&t.getSource()}getSourceCache(t,r){const n=e.B(t,r);return this._mergedOtherSourceCaches[n]}getLayerSourceCache(t){const r=e.B(t.source,t.scope);return"symbol"===t.type?this._mergedSymbolSourceCaches[r]:this._mergedOtherSourceCaches[r]}getSourceCaches(e){if(null==e)return Object.values(this._mergedSourceCaches);const t=[];return this._mergedOtherSourceCaches[e]&&t.push(this._mergedOtherSourceCaches[e]),this._mergedSymbolSourceCaches[e]&&t.push(this._mergedSymbolSourceCaches[e]),t}updateSourceCaches(){const e=this._changes.getUpdatedSourceCaches();for(const t in e){const r=e[t];"reload"===r?this.reloadSource(t):"clear"===r&&this.clearSource(t)}}updateLayers(e){const t=this._changes.getUpdatedPaintProperties();for(const r of t){const t=this.getLayer(r);t&&t.updateTransitions(e)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(e){this.stylesheet.glyphs=e,this.glyphManager.setURL(e)}getImages(t,r,n){this.imageManager.getImages(r.images,r.scope,n),this._updateTilesForChangedImages();const i=t=>{if(t){const n=r.images.map(t=>e.I.toString(t));t.setDependencies(r.tileID.key,r.type,n)}},s=e.B(r.source,r.scope);i(this._mergedOtherSourceCaches[s]),i(this._mergedSymbolSourceCaches[s]),r.images.some(e=>e.iconsetId)&&this.fire(new e.z("data",{dataType:"style"}))}rasterizeImages(e,t,r){this.imageManager.rasterizeImages(t,r)}getGlyphs(e,t,r){this.glyphManager.getGlyphs(t.stacks,r)}getResource(t,r,n){return e.dz(r,n)}getOwnSourceCache(e){return this._otherSourceCaches[e]}getOwnLayerSourceCache(e){return"symbol"===e.type?this._symbolSourceCaches[e.source]:this._otherSourceCaches[e.source]}getOwnSourceCaches(e){const t=[];return this._otherSourceCaches[e]&&t.push(this._otherSourceCaches[e]),this._symbolSourceCaches[e]&&t.push(this._symbolSourceCaches[e]),t}_isSourceCacheLoaded(t){const r=this.getOwnSourceCaches(t);return 0===r.length?(this.fire(new e.y(new Error("There is no source with ID '".concat(t,"'")))),!1):r.every(e=>e.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(e,t){if(!this._clipLayerPresent&&"fill-extrusion"!==e.type&&"building"!==e.type)return!1;const r="fill-extrusion"===e.type&&("building"===e.sourceLayer||"procedural_buildings"===e.sourceLayer),n="building"===e.type;if(e.is3D(!!this.terrain)){if(r||n||t&&"batched-model"===t.type)return!0;if("model"===e.type)return!0}else if("symbol"===e.type)return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(e=>{e.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Rn.getSourceType=function(e){return _t[e]},Rn.setSourceType=function(e,t){_t[e]=t},Rn.registerForPluginStateChange=e.dA;class Dn extends e.E{constructor(t){super(),this._style=t,this._buildings={},this._activeFloors=new Set,this._activeFloorsVisible=!0,this._indoorState={selectedFloorId:null,lastActiveFloors:null,activeFloorsVisible:!0},e.aY(["_updateUI"],this)}destroy(){this._buildings={},this._activeFloors=new Set,this._indoorState=null}selectFloor(e){e===this._selectedFloorId&&this._activeFloorsVisible||(this._selectedFloorId=e,this._activeFloorsVisible=!0,this._updateActiveFloors())}setActiveFloorsVisibility(e){this._activeFloorsVisible=e,this._updateActiveFloors(),this._updateIndoorSelector()}setIndoorData(e){for(const[t,r]of Object.entries(e.buildings))if(this._buildings[t])for(const e of r.floorIds)this._buildings[t].floors[e]||(this._buildings[t].floors[e]=r.floors[e]);else this._buildings[t]=r;for(const t of e.activeFloors)this._activeFloors.add(t);this._updateIndoorSelector()}getIndoorTileOptions(e,t){const r=this._style.getIndoorSourceLayers(e,t);return r&&this._indoorState?{sourceLayers:r,indoorState:this._indoorState}:null}_updateUI(t,r,n){const i=function(t,r,n,i){let s=null,o=Number.MAX_SAFE_INTEGER;if(i<16)return null;for(const[a,l]of Object.entries(t)){const t=l.center;if(t){const i=r.distanceTo(e.aT.convert(t));i<o&&n.contains(t)&&(o=i,s=a)}}return s}(this._buildings,r,n,t);i!==this._closestBuildingId&&(this._closestBuildingId=i,this._updateIndoorSelector())}_updateIndoorSelector(){const t=this._buildings,r=this._closestBuildingId,n=r&&t?t[r]:void 0;if(!n)return void this.fire(new e.z("selector-update",{selectedFloorId:null,activeFloorsVisible:this._activeFloorsVisible,floors:[]}));let i=null;for(const e of n.floorIds)if(this._activeFloors&&this._activeFloors.has(e)){i=e;break}const s=Array.from(n.floorIds).map(e=>({id:e,name:n.floors[e].name,zIndex:n.floors[e].zIndex})).sort((e,t)=>t.zIndex-e.zIndex);this.fire(new e.z("selector-update",{selectedFloorId:i,activeFloorsVisible:this._activeFloorsVisible,floors:s}))}_updateActiveFloors(){const e=this._activeFloors;this._activeFloors=new Set,this._indoorState={selectedFloorId:this._selectedFloorId,lastActiveFloors:e,activeFloorsVisible:this._activeFloorsVisible},this._style.updateIndoorDependentLayers()}}var Fn="\n#define EPSILON 0.0000001\n#define PI 3.141592653589793\n#ifdef RENDER_CUTOFF\nfloat cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}\n#endif",On="\n#ifdef DUAL_SOURCE_BLENDING\nlayout(location=0,index=0) out vec4 glFragColor;layout(location=0,index=1) out vec4 glFragColorSrc1;\n#else\nlayout(location=0) out vec4 glFragColor;\n#endif\n#ifdef USE_MRT1\nlayout(location=1) out vec4 out_Target1;\n#endif\nhighp float unpack_depth(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}\n#ifdef INDICATOR_CUTOUT\nuniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;\n#endif\nvec4 applyCutout(vec4 color,float height) {\n#ifdef INDICATOR_CUTOUT\nfloat verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);\n#else\nreturn color;\n#endif\n}\n#ifdef DEBUG_WIREFRAME\n#define HANDLE_WIREFRAME_DEBUG \\\nglFragColor=vec4(0.7,0.0,0.0,0.7); \\\ngl_FragDepth=gl_FragCoord.z-0.0001;\n#else\n#define HANDLE_WIREFRAME_DEBUG\n#endif\n#ifdef RENDER_CUTOFF\nuniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;\n#endif\nvec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}",zn="\n#define EXTENT 8192.0\n#define RAD_TO_DEG 180.0/PI\n#define DEG_TO_RAD PI/180.0\n#define GLOBE_RADIUS EXTENT/PI/2.0\nfloat wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {\n#ifndef PROJECTED_POS_ON_VIEWPORT\nfloat tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;\n#else\nreturn vec3(0.0);\n#endif\n}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}\n#endif\nvec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(\nunpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0\n);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}\n#ifdef RENDER_CUTOFF\nuniform vec4 u_cutoff_params;out float v_cutoff_opacity;\n#endif\nconst vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)\n{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}\n#ifndef HAS_SHADER_STORAGE_BLOCK_material_buffer\n#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_id) attrib\n#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_id) attrib\n#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_id) attrib\n#define DECLARE_MATERIAL_TABLE_INFO\n#endif",Bn="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Un="\n#define ELEVATION_SCALE 7.0\n#define ELEVATION_OFFSET 450.0\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(\nmix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}\n#else\nvec3 elevationVector(vec2 pos) { return vec3(0,0,1); }\n#endif\n#ifdef TERRAIN\nuniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}float prevElevation(vec2 apos) {\n#ifdef TERRAIN_DEM_FLOAT_FORMAT\nvec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;\n#else\nfloat dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);\n#endif\n}\n#ifdef TERRAIN_VERTEX_MORPHING\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nfloat nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}\n#else\nfloat elevation(vec2 apos) {\n#ifdef ZERO_EXAGGERATION\nreturn 0.0;\n#endif\nreturn currentElevation(apos);}\n#endif\nvec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}\n#else\nfloat elevation(vec2 pos) { return 0.0; }\n#endif\n#ifdef DEPTH_OCCLUSION\nuniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;\n#ifdef DEPTH_D24\nfloat unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}\n#else\nhighp float unpack_depth_rgba(vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;\n#ifdef CLIP_ZERO_TO_ONE\ncoord.z=-1.0+2.0*coord.z; \n#endif\n#ifdef DEPTH_D24\nfloat depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);\n#else\nfloat depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));\n#endif\nreturn coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef DEPTH_D24\nhighp vec4 depth=vec4(\ntexture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r\n);depth=unpack_depth4(depth);\n#else\nhighp vec4 depth=vec4(\nunpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))\n);\n#endif\nreturn depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;\n#ifdef CLIP_ZERO_TO_ONE\ncoord.z=-1.0+2.0*coord.z; \n#endif\nint NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));\n#endif\nres+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;\n#ifdef CLIP_ZERO_TO_ONE\ncoord.z=-1.0+2.0*coord.z; \n#endif\nhighp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}\n#else\nbool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }\n#endif",Vn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}\n#endif",qn="#ifdef FOG\nuniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}\n#endif",Wn="#ifdef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)\n);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)\n);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}\n#endif",Hn="#ifdef RASTER_ARRAY\nuniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}\n#endif\nuniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}",Gn="#ifdef RENDER_SHADOWS\nuniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}\n#endif",Zn="#ifdef RENDER_SHADOWS\nprecision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {\n#ifdef CLIP_ZERO_TO_ONE\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);\n#else\nhighp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);\n#endif\nreturn texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;\n#ifdef SHADOWS_SINGLE_CASCADE\nvec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);\n#else\nlight_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);\n#endif\n}highp float calculate_shadow_bias(float NDotL) {\n#ifdef NORMAL_OFFSET\nreturn 0.5*u_shadow_bias.x;\n#else\nreturn 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));\n#endif\n}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)\n{highp vec2 biasUV=vec2(\npos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}\n#endif";const Kn=/#include\s+"([^"]+)"/g,Yn=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,Xn=/\b[A-Za-z_][A-Za-z0-9_]*\b/g,Jn=new Set(["ifdef","ifndef","elif","if","defined"]),Qn=new Set;oi(Fn,Qn),oi(zn,Qn),oi(On,Qn);const $n={"_prelude_fog.vertex.glsl":Vn,"_prelude_terrain.vertex.glsl":Un,"_prelude_shadow.vertex.glsl":Gn,"_prelude_material_table.vertex.glsl":"#ifdef HAS_SHADER_STORAGE_BLOCK_material_buffer\n#define MATERIAL_TABLE_DEBUG 0\nuniform int u_material_offset;uniform int u_vertex_offset;layout(std140,binding=0)readonly buffer material_buffer{uvec4 material_data[];};struct MaterialInfo{uint dataOffset;\n#if MATERIAL_TABLE_DEBUG\nvec4 colorDebug;\n#endif\n};uint read_buf_no_offset(uint iDword) {return material_data[iDword/4u][iDword % 4u];}uint read_buf(uint iDword) {iDword+=uint(u_material_offset/4);return read_buf_no_offset(iDword);}float read_buf_float(uint iDword){return uintBitsToFloat(read_buf(iDword));}uint read_buf_uint8(uint iDword,uint iUint8){uint dwordOffset=iDword+(iUint8/4u);uint byteOffset=iUint8 & 3u;uint bitOffset=8u*byteOffset;uint mask=0xffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint read_buf_uint16(uint iDword,uint iUint16){uint dwordOffset=iDword+(iUint16 >> 1u);uint bitOffset=(iUint16 & 1u)*16u;uint mask=0xffffu << bitOffset;uint dwordVal=read_buf(dwordOffset);return (dwordVal & mask) >> bitOffset;}uint nrDwordsForVertexIdEntries(uint nrMaterialLookupEntries) {return nrMaterialLookupEntries;}uint nrDwordsForMaterialIdEntries(uint nrMaterialLookupEntries) {return (nrMaterialLookupEntries*2u+3u)/4u;}uint findRangeBinarySearch(uint vertexId,uint numRanges,uint dwordOffset) {uint left=0u;uint right=numRanges-1u;for (uint i=0u; i < 16u; i++) { \nif (left > right) {break;}uint mid=(left+right)/2u;uint start=read_buf(dwordOffset+mid);uint nextStart=(mid+1u < numRanges) ? read_buf(dwordOffset+mid+1u) : 0xffffffffu;if (vertexId >=start && vertexId < nextStart) {return mid;} else if (vertexId < start) {if (mid==0u) {break;}right=mid-1u;} else {left=mid+1u;}}return 0u; \n}uint readVertexId(uint dwordOffset,uint iMaterialLookupEntry) {return read_buf(dwordOffset+iMaterialLookupEntry);}uint findRange(uint vertexId,uint numRanges,uint dwordOffset) {uint iRange;if(numRanges <=64u){uint vertexBegin;for(iRange=0u; iRange < numRanges;++iRange) {vertexBegin=readVertexId(dwordOffset,iRange);if(vertexBegin > vertexId) {break;}}iRange=iRange==0u? 0u : iRange-1u;} else { \niRange=findRangeBinarySearch(vertexId,numRanges,dwordOffset);}return iRange;}MaterialInfo read_material_info(uint vertex_id) {MaterialInfo info;\n#if MATERIAL_TABLE_DEBUG\nconst vec4 red=vec4(1.0,0.0,0.0,1.0);const vec4 orange=vec4(1.0,0.5,0.0,1.0);const vec4 yellow=vec4(1.0,1.0,0.0,1.0);const vec4 green=vec4(0.0,1.0,0.0,1.0);const vec4 indigo=vec4(0.294,0.0,0.510,1.0);const vec4 blue=vec4(0.0,0.0,1.0,1.0);const vec4 purple=vec4(0.5,0.0,0.5,1.0);const vec4 pink=vec4(1.0,0.0,1.0,1.0);info.colorDebug=green;\n#endif\nuint offset=0u;\n#if MATERIAL_TABLE_DEBUG\nbool keepFinding=true;uint magic=read_buf(offset);if(magic !=0xCAFEBABEu) {info.colorDebug=red;keepFinding=false;return info;}\n#endif\noffset++;\n#if MATERIAL_TABLE_DEBUG\nuint nrMaterials=read_buf(offset);uint nrVertices=read_buf(offset+1u);if(keepFinding && vertex_id >=nrVertices) {info.colorDebug=red;keepFinding=false;}\n#endif\noffset+=2u;uint nrMaterialLookupEntries=read_buf(offset++);uint perMaterialEntrySizeDwords=read_buf(offset++);\n#if MATERIAL_TABLE_DEBUG\nif(keepFinding && perMaterialEntrySizeDwords !=1u) {info.colorDebug=red;keepFinding=false;}\n#endif\nuint iMaterialLookup=findRange(vertex_id,nrMaterialLookupEntries,offset);\n#if MATERIAL_TABLE_DEBUG\nif(keepFinding)\n{uint vertexBeginCheck=readVertexId(offset,iMaterialLookup);if(vertexBeginCheck > vertex_id) {info.colorDebug=red;keepFinding=false;}if(iMaterialLookup < nrMaterialLookupEntries-1u) {uint vertexEndCheck=readVertexId(offset,iMaterialLookup+1u);if(vertexEndCheck <=vertex_id) {info.colorDebug=red;keepFinding=false;}}}\n#endif\noffset+=nrDwordsForVertexIdEntries(nrMaterialLookupEntries);uint materialId=iMaterialLookup;\n#if MATERIAL_TABLE_DEBUG\nif(keepFinding) {if(materialId >=nrMaterialLookupEntries) {info.colorDebug=red;}}\n#endif\ninfo.dataOffset=offset+materialId*perMaterialEntrySizeDwords;return info;}uint get_data_location(const MaterialInfo matInfo,uint attribOffsetBytes)\n{uint attribFieldOffsetDwords=attribOffsetBytes/4u;return matInfo.dataOffset+attribFieldOffsetDwords;}vec4 read_material_vec4(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec4(read_buf_float(loc),read_buf_float(loc+1u),read_buf_float(loc+2u),read_buf_float(loc+3u));}vec2 read_material_vec2(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return vec2(read_buf_float(loc),read_buf_float(loc+1u));}float read_material_float(const MaterialInfo matInfo,uint attribOffsetBytes){uint loc=get_data_location(matInfo,attribOffsetBytes);return read_buf_float(loc);}\n#define GET_ATTRIBUTE_float(attrib,matInfo,attrib_offset) read_material_float(matInfo,attrib_offset)\n#define GET_ATTRIBUTE_vec4(attrib,matInfo,attrib_offset) read_material_vec4(matInfo,attrib_offset)\n#define GET_ATTRIBUTE_vec2(attrib,matInfo,attrib_offset) read_material_vec2(matInfo,attrib_offset)\n#define DECLARE_MATERIAL_TABLE_INFO MaterialInfo materialInfo=read_material_info(uint(gl_VertexID));\n#define DECLARE_MATERIAL_TABLE_INFO_DEBUG(dbgColor) MaterialInfo materialInfo=read_material_info(uint(gl_VertexID)); dbgColor=materialInfo.colorDebug;\n#endif","_prelude_fog.fragment.glsl":qn,"_prelude_shadow.fragment.glsl":Zn,"_prelude_lighting.glsl":"\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}\n#endif","_prelude_raster_array.glsl":Wn,"_prelude_raster_particle.glsl":Hn},ei={};ai("",Un),ai(qn,Vn),ai(Zn,Gn),ai(Wn,""),ai(Hn,"");const ti=ai(On,zn),ri=Fn,ni=["\n#if defined(GL_EXT_blend_func_extended) && defined(DUAL_SOURCE_BLENDING)\n#extension GL_EXT_blend_func_extended : require\n#endif","precision mediump float;",ri,ti.fragmentSource].join("\n"),ii=["precision highp float;",ri,ti.vertexSource].join("\n");var si={background:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec4 u_color;uniform float u_opacity;uniform mediump float u_emissive_strength;\n#ifdef LIGHTING_3D_MODE\nin vec4 v_color;\n#endif\nvoid main() {vec4 out_color;\n#ifdef LIGHTING_3D_MODE\nout_color=v_color;\n#else\nout_color=u_color;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_lighting.glsl"\nin vec2 a_pos;uniform mat4 u_matrix;uniform mediump float u_emissive_strength;\n#ifdef LIGHTING_3D_MODE\nuniform mediump vec4 u_color;out vec4 v_color;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0,1);\n#ifdef LIGHTING_3D_MODE\nv_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),backgroundPattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*u_opacity;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),building:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nconst float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nin lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;\n#endif\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\n#ifdef FLOOD_LIGHT\nin highp float v_flood_radius;in float v_has_flood_light;\n#endif\nuniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;uniform vec3 u_flood_light_color;uniform float u_flood_light_intensity;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}\n#ifdef BUILDING_FAUX_FACADE\nfloat hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;\n#if 0\nif (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;\n#else\nif (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;\n#endif\nreturn out_color;}\n#endif\nvec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;\n#ifdef BUILDING_FAUX_FACADE\nif (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}\n#endif\nvec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;\n#ifdef RENDER_SHADOWS\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\n#else\nshadowed_lighting_factor=dot(xy_flipped_normal,u_lighting_directional_dir);\n#endif\ncolor.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=linearTosRGB(color.rgb);\n#ifdef FLOOD_LIGHT\nfloat flood_radiance=(1.0-min(v_pos.z/v_flood_radius,1.0))*u_flood_light_intensity*v_has_flood_light;color.rgb=mix(color.rgb,u_flood_light_color,flood_radiance);\n#endif\ncolor.rgb=mix(color.rgb,linearTosRGB(base_color.rgb),emissive);\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));\n#endif\ncolor*=u_opacity;\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_pos.z);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color; \n#ifdef DEBUG_SHOW_NORMALS\ncolor.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in float a_flood_light_wall_radius_1i16;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;\n#ifdef BUILDING_FAUX_FACADE\nout lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#ifdef FLOOD_LIGHT\nout highp float v_flood_radius;out float v_has_flood_light;\n#endif\nconst float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;const float FLOOD_LIGHT_MAX_RADIUS_METER=2048.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#ifdef BUILDING_FAUX_FACADE\nmat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}\n#endif\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive\nvoid main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive\n#ifdef FLOOD_LIGHT\nv_flood_radius=(a_flood_light_wall_radius_1i16/MAX_INT_16*FLOOD_LIGHT_MAX_RADIUS_METER);v_has_flood_light=step(0.0,v_flood_radius);\n#endif\nvec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;float depth_offset=0.0;\n#ifdef BUILDING_FAUX_FACADE\nv_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);float height=a_centroid_3.z;depth_offset=min(1000.0,height)*0.0000002;}\n#endif\nv_pos=a_pos_3f;\n#ifdef RENDER_CUTOFF\nvec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shadow_pos=v_pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(v_pos);\n#endif\ngl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);gl_Position.z-=depth_offset*gl_Position.w;}'),buildingBloom:ai("in vec4 v_color_emissive;\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\nfloat saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;\n#ifdef HAS_ATTRIBUTE_a_bloom_attenuation\nfloat distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);\n#endif\n#ifdef RENDER_CUTOFF\nopacity*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}","in vec3 a_pos_3f;\n#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive\n#pragma mapbox: define-attribute highp vec4 bloom_attenuation\nout vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive\n#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation\n#ifdef HAS_ATTRIBUTE_a_part_color_emissive\nvec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);\n#else\nv_color_emissive=vec4(1.0);\n#endif\ngl_Position=u_matrix*vec4(a_pos_3f,1.0);\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}"),buildingDepth:ai("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec3 v_data;in float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nuniform float u_emissive_strength;void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? \nsmoothstep(0.0,-antialiased_blur,1.0-extrude_length) : \nsmoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(\nantialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)\n);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#endif\n#ifdef FOG\nout_color=fog_apply_premultiplied(out_color,v_fog_pos);\n#endif\nglFragColor=out_color*(v_visibility*opacity_t);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define NUM_VISIBILITY_RINGS 2\n#define INV_SQRT2 0.70710678\n#define ELEVATION_BIAS 0.0001\n#define NUM_SAMPLES_PER_RING 16\nuniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\n#ifdef ELEVATED_ROADS\nin float a_circle_z_offset;\n#endif\nout vec3 v_data;out float v_visibility;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump float radius\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp vec4 stroke_color\n#pragma mapbox: define mediump float stroke_width\n#pragma mapbox: define lowp float stroke_opacity\nvec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {\n#if defined(TERRAIN)\nreturn elevation(pos)+ELEVATION_BIAS;\n#else\nreturn 0.0;\n#endif\n}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);\n#ifdef PITCH_WITH_MAP\n#ifdef PROJECTION_GLOBE_VIEW\nreturn u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );\n#else\nreturn u_matrix*( world_center+vec4(sample_offset,0,0) );\n#endif\n#else\nreturn projected_center+vec4(sample_offset,0,0);\n#endif\n}float get_sample_step() {\n#ifdef PITCH_WITH_MAP\nreturn 2.0*PI/float(NUM_SAMPLES_PER_RING);\n#else\nreturn PI/float(NUM_SAMPLES_PER_RING);\n#endif\n}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump float radius\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp vec4 stroke_color\n#pragma mapbox: initialize mediump float stroke_width\n#pragma mapbox: initialize lowp float stroke_opacity\nvec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);\n#else \nsurface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);\n#endif\n#ifdef ELEVATED_ROADS\nworld_center.z+=a_circle_z_offset+ELEVATION_BIAS;\n#endif\nvec4 projected_center=u_matrix*world_center;float view_scale=0.0;\n#ifdef PITCH_WITH_MAP\n#ifdef SCALE_WITH_MAP\nview_scale=1.0;\n#else\nview_scale=projected_center.w/u_camera_to_center_distance;\n#endif\n#else\n#ifdef SCALE_WITH_MAP\nview_scale=u_camera_to_center_distance;\n#else\nview_scale=projected_center.w;\n#endif\n#endif\ngl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;\n#ifdef TERRAIN\nfloat step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;\n#ifdef PITCH_WITH_MAP\nfloat cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;\n#else\nocclusion_world_center=world_center;occlusion_projected_center=projected_center;\n#endif\nfor(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);\n#else\nvisibility=1.0;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nvisibility=1.0;\n#endif\nv_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);\n#ifdef FOG\nv_fog_pos=fog_position(world_center.xyz);\n#endif\n}'),clippingMask:ai("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:ai('#include "_prelude_fog.fragment.glsl"\nuniform highp float u_intensity;in vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\nfloat d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);\n#ifdef FOG\nif (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;\n#endif\nout vec2 v_extrude;\n#pragma mapbox: define highp float weight\n#pragma mapbox: define mediump float radius\nconst highp float ZERO=1.0/255.0/16.0;\n#define GAUSS_COEF 0.3989422804014327\nvoid main() {\n#pragma mapbox: initialize highp float weight\n#pragma mapbox: initialize mediump float radius\nvec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#else\npos=vec3(tilePos+extrude,elevation(tilePos));\n#endif\ngl_Position=u_matrix*vec4(pos,1);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),heatmapTexture:ai("uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(0.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}","in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:ai("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",'#include "_prelude_terrain.vertex.glsl"\nin vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;\n#endif\nout float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);\n#ifdef PROJECTION_GLOBE_VIEW\n#ifndef PROJECTED_POS_ON_VIEWPORT\nvec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);\n#endif\n#endif\nvec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}'),collisionCircle:ai("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}","in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(\nmix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(\n0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}"),debug:ai("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",'#include "_prelude_terrain.vertex.glsl"\nin vec2 a_pos;\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;\n#endif\nout vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\ngl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);\n#else\ngl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);\n#endif\n}'),elevatedStructuresDepth:ai("void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=vec4(0.);\n#endif\n}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:ai("#ifdef DEPTH_RECONSTRUCTION\nin float v_height;\n#endif\nvoid main() {\n#ifdef DEPTH_RECONSTRUCTION\nif (v_height >=0.0)\ndiscard;\n#else\n#ifdef FEATURE_CUTOUT\napply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);\n#endif\n#endif\nglFragColor=vec4(1.0,0.0,0.0,1.0);}","in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;\n#ifdef DEPTH_RECONSTRUCTION\nout float v_height;\n#endif\nvoid main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);\n#ifdef DEPTH_RECONSTRUCTION\nif (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;\n#endif\ngl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}"),elevatedStructures:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin vec3 v_normal;in float v_height;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;\n#endif\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)\n{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nvec3 color=structure_color.xyz;\n#ifdef LIGHTING_3D_MODE\nvec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);\n#ifdef RENDER_SHADOWS\nfloat shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);\n#else\ncolor=apply_lighting(color,transformed_normal);\n#endif\ncolor=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}\n#endif\n#ifdef FOG\ncolor=fog_apply(color,v_fog_pos);\n#endif\nvec4 out_color=vec4(color,1.0);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_height);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;\n#endif\n#pragma mapbox: define highp vec4 structure_color\nvoid main() {\n#pragma mapbox: initialize highp vec4 structure_color\nv_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fill:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\nuniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\nvec4 out_color=color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=opacity;\n#ifdef INDICATOR_CUTOUT\nif (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=z_offset;\n#endif\n}'),fillOutline:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\nfloat dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nuniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;\n#pragma mapbox: define highp vec4 outline_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 outline_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize highp float z_offset\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);\n#ifdef FLIP_Y\nv_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillOutlinePattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nuniform float u_emissive_strength;\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nin highp vec2 v_pos;in highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*(alpha*opacity);\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;out highp vec2 v_pos_world;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef FLIP_Y\nv_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;\n#else\nv_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;\n#endif\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillPattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin highp vec2 v_pos;uniform float u_emissive_strength;\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef FILL_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nglFragColor=out_color*opacity;\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;\n#ifdef ELEVATED_ROADS\nin float a_road_z_offset;out highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\nout highp vec2 v_pos;\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp vec4 pattern\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define lowp float pixel_ratio\n#pragma mapbox: define highp float z_offset\nvoid main() {\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump vec4 pattern\n#pragma mapbox: initialize lowp float pixel_ratio\n#pragma mapbox: initialize highp float z_offset\n#ifdef FILL_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;\n#ifdef ELEVATED_ROADS\nz_offset+=a_road_z_offset;v_road_z_offset=z_offset;\n#endif\nfloat hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),fillExtrusion:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nin vec4 v_color;in vec4 v_flat;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;\n#endif\nuniform lowp float u_opacity;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec2 v_ao;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nin vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nin highp vec3 v_normal;\n#endif\nuniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nin float v_flood_radius;in float v_has_floodlight;\n#endif\nin float v_height;\n#pragma mapbox: define highp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp float emissive_strength\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nvec3 normal=normalize(v_normal);\n#endif\nfloat z;vec4 color=v_color;\n#ifdef ZERO_ROOF_RADIUS\nz=float(normal.z > 0.00001);\n#ifdef LIGHTING_3D_MODE\nnormal=mix(normal,vec3(0.0,0.0,1.0),z);\n#else\ncolor=mix(v_color,v_roof_color,z);\n#endif\n#endif\nfloat h=max(0.0,v_height);float ao_shade=1.0;\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;\n#ifdef ZERO_ROOF_RADIUS\nconcave*=(1.0-z);\n#endif\nfloat x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\ncolor.rgb*=mix(ao_shade,1.0,v_has_floodlight);\n#else\ncolor.rgb*=ao_shade;\n#endif\n#else\ncolor.rgb*=ao_shade;\n#endif\n#endif\n#ifdef LIGHTING_3D_MODE\nfloat flood_radiance=0.0;\n#ifdef FLOOD_LIGHT\nflood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;\n#endif\n#ifdef RENDER_SHADOWS\n#ifdef FLOOD_LIGHT\nfloat ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);\n#else\nfloat shadowed_lighting_factor;\n#ifdef RENDER_CUTOFF\nshadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}\n#else\nshadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);\n#endif\ncolor.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);\n#endif\n#else\ncolor.rgb=apply_lighting(color.rgb,normal);\n#ifdef FLOOD_LIGHT\ncolor.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);\n#endif\n#endif\ncolor.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));\n#endif\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,h);\n#endif\n#ifdef FEATURE_CUTOUT\ncolor=apply_feature_cutout(color,gl_FragCoord);\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_material_table.vertex.glsl"\nuniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nuniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nout vec4 v_roof_color;\n#endif\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nout highp vec3 v_normal;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec2 v_ao;\n#endif\n#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)\nout float v_flood_radius;out float v_has_floodlight;\n#endif\nout float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define highp float flood_light_wall_radius\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp float emissive_strength\nvoid main() {DECLARE_MATERIAL_TABLE_INFO\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize highp float flood_light_wall_radius\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp float emissive_strength\nbase*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));\n#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)\nv_normal=normal;\n#endif\nbase=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\nh=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\nfloat cutoff=1.0;vec3 scaled_pos=pos;\n#ifdef RENDER_CUTOFF\nvec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);\n#ifdef CLIP_ZERO_TO_ONE\ncutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);\n#else\ncutoff=cutoff_opacity(u_cutoff_params,ground.z);\n#endif\nif (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\ngl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;\n#ifdef RENDER_SHADOWS\nvec3 shd_pos0=pos;vec3 shd_pos1=pos;\n#ifdef NORMAL_OFFSET\nvec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);\n#endif\nfloat NdotL=0.0;float colorvalue=0.0;\n#ifndef LIGHTING_3D_MODE\ncolorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#endif\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\n#ifdef FLOOD_LIGHT\nfloat is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;\n#endif\nv_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);\n#else\nv_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;\n#endif\n#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)\nfloat roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n}'),fillExtrusionDepth:ai("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}",'#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_material_table.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nin vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp float line_width\n#pragma mapbox: define highp vec4 color\nout highp float v_depth;void main() {DECLARE_MATERIAL_TABLE_INFO\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp float line_width\n#pragma mapbox: initialize highp vec4 color\nbase*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nvec3 pos;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);\n#else\npos=vec3(pos_nx.xy,t > 0.0 ? height : base);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}'),fillExtrusionPattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform vec2 u_texsize;uniform sampler2D u_image;\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;in vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nin vec3 v_normal;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\nin highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\nvoid main() {\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;\n#else\nout_color=out_color*v_lighting;\n#endif\n#ifdef FAUX_AO\nfloat intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,height);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_material_table.vertex.glsl"\nuniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;\n#ifdef RENDER_WALL_MODE\nin vec3 a_join_normal_inside;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;\n#endif\n#ifdef TERRAIN\nuniform int u_height_type;uniform int u_base_type;\n#endif\nout highp vec2 v_pos;out vec4 v_lighting;\n#ifdef FAUX_AO\nuniform lowp vec2 u_ao;out vec3 v_ao;\n#endif\n#ifdef LIGHTING_3D_MODE\nout vec3 v_normal;\n#endif\n#pragma mapbox: define highp float base\n#pragma mapbox: define highp float height\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define highp float pixel_ratio\n#pragma mapbox: define highp float line_width\nvoid main() {DECLARE_MATERIAL_TABLE_INFO\n#pragma mapbox: initialize highp float base\n#pragma mapbox: initialize highp float height\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef FILL_EXTRUSION_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize highp float pixel_ratio\n#pragma mapbox: initialize highp float line_width\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);\n#if defined(HAS_CENTROID) || defined(TERRAIN)\ncentroid_pos=a_centroid_pos;\n#endif\nfloat ele=0.0;float h=z;vec3 p;float c_ele;\n#ifdef TERRAIN\nbool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);\n#else\np=vec3(pos_nx.xy,z);\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nfloat lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);\n#endif\n#ifdef RENDER_WALL_MODE\nvec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;\n#endif\nfloat hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0\n? pos_nx.xy\n: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;\n#ifdef LIGHTING_3D_MODE\nNdotL=calculate_NdotL(normal);\n#else\nNdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);\n#endif\nif (normal.y !=0.0) {float r=0.84;\n#ifndef LIGHTING_3D_MODE\nr=mix(0.7,0.98,1.0-u_lightintensity);\n#endif\nNdotL*=(\n(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}\n#ifdef FAUX_AO\nfloat concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;\n#ifdef TERRAIN\ntop_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);\n#endif\nv_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);\n#ifdef PROJECTION_GLOBE_VIEW\ntop_height+=u_height_lift;\n#endif\ngl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;\n#endif\n#ifdef LIGHTING_3D_MODE\nv_normal=normal;\n#else\nv_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(p);\n#endif\n}'),groundShadow:ai('#include "_prelude_shadow.fragment.glsl"\nprecision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\nvoid main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);\n#ifdef RENDER_CUTOFF\nshadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));\n#endif\n#ifdef FOG\nshadow=mix(shadow,vec3(1.0),v_fog_opacity);\n#endif\n#ifdef INDICATOR_CUTOUT\nshadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);\n#endif\nglFragColor=vec4(shadow,1.0);}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\nvoid main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);\n#endif\n}'),fillExtrusionGroundEffect:ai("uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;\n#ifdef SDF_SUBPASS\nin highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}\n#ifdef FOG\nin highp float v_fog;\n#endif\n#endif\nvoid main() {\n#ifdef CLEAR_SUBPASS\nvec4 color=vec4(1.0);\n#ifdef CLEAR_FROM_TEXTURE\ncolor=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));\n#endif\nglFragColor=color;\n#else\n#ifdef SDF_SUBPASS\nhighp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;\n#ifdef FOG\nfog=v_fog;\n#endif\n#ifdef RENDER_CUTOFF\nfog*=v_cutoff_opacity;\n#endif\nglFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));\n#else\n#ifdef USE_MRT1\nout_Target1=vec4(1.0-texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size)).a,0.0,0.0,0.0);\n#else\nvec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);\n#ifdef OVERDRAW_INSPECTOR\ncolor=vec4(1.0);\n#endif\nglFragColor=color;\n#endif\n#endif\nHANDLE_WIREFRAME_DEBUG;\n#endif\n}",'#include "_prelude_fog.vertex.glsl"\nin highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;\n#ifdef SDF_SUBPASS\nout highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;\n#ifdef FOG\nout highp float v_fog;\n#endif\n#endif\nuniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;\n#pragma mapbox: define highp float flood_light_ground_radius\nconst float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {\n#pragma mapbox: initialize highp float flood_light_ground_radius\nvec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;\n#ifdef SDF_SUBPASS\nv_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);\n#ifdef FOG\nv_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);\n#endif\n#endif\nfloat hidden_by_landmark=0.0;\n#ifdef HAS_CENTROID\nhidden_by_landmark=a_hidden_by_landmark;\n#endif\nfloat isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n}'),hillshadePrepare:ai("precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(\n(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)\n)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(\nderiv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}","uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;\n#ifdef LIGHTING_3D_MODE\nglFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);\n#endif\n#ifdef FOG\nglFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));\n#endif\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n}'),line:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform sampler2D u_dash_image;in vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform sampler2D u_gradient_image;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\nfloat luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float side_z_offset\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\n#pragma mapbox: define lowp float emissive_strength\nfloat linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float side_z_offset\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\n#pragma mapbox: initialize lowp float emissive_strength\nfloat dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);alpha=side_z_offset > 0.0 ? 1.0-alpha : alpha;\n#ifdef RENDER_LINE_DASH\nfloat sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);\n#endif\nhighp vec4 out_color;\n#ifdef RENDER_LINE_GRADIENT\nout_color=texture(u_gradient_image,v_uv.xy);\n#ifdef MULTIPLY_LINE_GRADIENT_COLOR\nout_color*=color;\n#endif\n#else\nout_color=color;\n#endif\nfloat trim_alpha=1.0;\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}\n#endif\nif (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}\n#ifdef RENDER_LINE_BORDER\nfloat edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}\n#endif\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\nout_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\nout_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));\n#endif\nout_color*=(alpha*opacity);\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef DUAL_SOURCE_BLENDING\nglFragColorSrc1=vec4(vec3(0.0),emissive_strength);\n#else\n#ifdef USE_MRT1\nout_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define EXTRUDE_SCALE 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)\nin vec3 a_z_offset_width;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nin highp vec3 a_packed;\n#endif\n#ifdef RENDER_LINE_DASH\nin float a_linesofar;\n#endif\nuniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_LINE_DASH\nuniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;\n#endif\n#ifdef RENDER_LINE_GRADIENT\nuniform float u_image_height;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 color\n#pragma mapbox: define lowp float floorwidth\n#pragma mapbox: define lowp vec4 dash\n#pragma mapbox: define lowp float blur\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define lowp float offset\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float side_z_offset\n#pragma mapbox: define lowp float border_width\n#pragma mapbox: define lowp vec4 border_color\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 color\n#pragma mapbox: initialize lowp float floorwidth\n#pragma mapbox: initialize lowp vec4 dash\n#pragma mapbox: initialize lowp float blur\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize lowp float offset\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float side_z_offset\n#pragma mapbox: initialize lowp float border_width\n#pragma mapbox: initialize lowp vec4 border_color\n#pragma mapbox: initialize lowp float emissive_strength\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;\n#ifdef VARIABLE_LINE_WIDTH\nbool left=normal.y==1.0;halfwidth=(u_width_scale*(left ? a_z_offset_width.y : a_z_offset_width.z))/2.0;a_z_offset+=left ? side_z_offset : 0.0;v_normal=side_z_offset > 0.0 && left ? vec2(0.0) : v_normal;\n#else\nhalfwidth=(u_width_scale*width)/2.0;\n#endif\noffset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)\nhighp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];\n#ifdef RENDER_LINE_GRADIENT\nhighp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);\n#else\nv_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\n#endif\n#ifdef RENDER_LINE_DASH\nfloat scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);\n#endif\nv_width2=vec2(outset,inset);\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),linePattern:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\nuniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef LINE_PATTERN_TRANSITION\nuniform float u_pattern_transition;\n#endif\nin vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nin highp float v_road_z_offset;\n#endif\n#ifdef LINE_JOIN_NONE\nin vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize lowp float emissive_strength\nvec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\n#ifdef LINE_PATTERN_TRANSITION\nvec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}\n#endif\n#ifdef LINE_JOIN_NONE\nhighp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}\n#endif\n#ifdef LIGHTING_3D_MODE\ncolor=apply_lighting_with_emission_ground(color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef ELEVATED_ROADS\ncolor.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#else\ncolor.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}\n#ifdef INDICATOR_CUTOUT\ncolor=applyCutout(color,v_z_offset);\n#endif\nglFragColor=color;\n#ifdef DUAL_SOURCE_BLENDING\nglFragColorSrc1=vec4(vec3(0.0),emissive_strength);\n#else\n#ifdef USE_MRT1\nout_Target1=vec4(emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\n#define scale 0.015873016\nin vec2 a_pos_normal;in vec4 a_data;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\nin vec3 a_z_offset_width;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nin highp vec3 a_packed;\n#endif\nin highp float a_linesofar;\n#ifdef LINE_JOIN_NONE\nin highp vec3 a_pattern_data;out vec2 v_pattern_data;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#endif\nuniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;\n#ifdef ELEVATED\nuniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {\n#ifdef ELEVATION_REFERENCE_SEA\nreturn 0.0;\n#else\nreturn elevation(apos);\n#endif\n}\n#endif\nout vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;\n#ifdef RENDER_LINE_TRIM_OFFSET\nout highp vec3 v_uv;\n#endif\n#ifdef ELEVATED_ROADS\nout highp float v_road_z_offset;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define mediump float blur\n#pragma mapbox: define mediump float opacity\n#pragma mapbox: define mediump float offset\n#pragma mapbox: define mediump float gapwidth\n#pragma mapbox: define mediump float width\n#pragma mapbox: define mediump float floorwidth\n#pragma mapbox: define mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: define mediump vec4 pattern_b\n#endif\n#pragma mapbox: define mediump float pixel_ratio\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize mediump float blur\n#pragma mapbox: initialize mediump float opacity\n#pragma mapbox: initialize mediump float offset\n#pragma mapbox: initialize mediump float gapwidth\n#pragma mapbox: initialize mediump float width\n#pragma mapbox: initialize mediump float floorwidth\n#pragma mapbox: initialize mediump vec4 pattern\n#ifdef LINE_PATTERN_TRANSITION\n#pragma mapbox: initialize mediump vec4 pattern_b\n#endif\n#pragma mapbox: initialize mediump float pixel_ratio\n#pragma mapbox: initialize lowp float emissive_strength\nfloat a_z_offset;\n#if defined(ELEVATED) || defined(ELEVATED_ROADS)\na_z_offset=a_z_offset_width.x;\n#endif\nfloat ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;\n#ifdef ELEVATED_ROADS\nv_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;\n#else\n#ifdef ELEVATED\nvec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;\n#ifdef CROSS_SLOPE_VERTICAL\nfloat top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);\n#else\n#ifdef CROSS_SLOPE_HORIZONTAL\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;\n#else\nfloat ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;\n#endif\n#endif\ngl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);\n#else\ngl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);\n#endif\n#endif\n#ifdef ELEVATED_ROADS\n#ifdef RENDER_SHADOWS\nvec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#endif\n#ifndef RENDER_TO_TEXTURE\nfloat extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));\n#else\nv_gamma_scale=1.0;\n#endif\n#ifdef RENDER_LINE_TRIM_OFFSET\nhighp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);\n#endif\nv_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);\n#ifdef LINE_JOIN_NONE\nv_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(pos);\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=a_z_offset;\n#endif\n}'),raster:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\n#include "_prelude_raster_array.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nin float v_split_fade;\n#endif\nuniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;\n#ifndef RASTER_ARRAY\nuniform highp sampler2D u_image0;uniform sampler2D u_image1;\n#endif\n#ifdef RASTER_COLOR\nuniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;\n#endif\nvoid main() {vec4 color0,color1,color;vec2 value;\n#ifdef RASTER_COLOR\n#ifdef RASTER_ARRAY\n#ifdef RASTER_ARRAY_LINEAR\nvalue=mix(\nraTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#else\nvalue=mix(\nraTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t\n);\n#endif\nif (value.y > 0.0) value.x/=value.y;\n#else\ncolor=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);\n#endif\ncolor=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;\n#else\ncolor0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);\n#endif\ncolor.a*=u_opacity;\n#ifdef GLOBE_POLES\ncolor.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);\n#endif\nvec3 rgb=color.rgb;rgb=vec3(\ndot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef PROJECTION_GLOBE_VIEW\nglFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));\n#endif\n#ifdef RENDER_CUTOFF\nglFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);\n#endif\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n#ifdef USE_MRT1\nout_Target1=vec4(u_emissive_strength*glFragColor.a,0.0,0.0,glFragColor.a);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;in vec2 a_texture_pos;\n#endif\nout vec2 v_pos0;out vec2 v_pos1;out float v_depth;\n#ifdef PROJECTION_GLOBE_VIEW\nout float v_split_fade;\n#endif\nvoid main() {vec2 uv;\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);\n#endif\n#else\nfloat w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    \nv_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\ngl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;\n#ifdef RENDER_CUTOFF\nv_depth=gl_Position.z;\n#endif\n}'),rasterParticle:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),1.0).rgb;\n#endif\n#ifdef FOG\nhighp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));\n#endif\nglFragColor=vec4(out_color*color.a,color.a);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\nuniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;\n#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8\nin vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n#else\nuv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);\n#ifdef FOG\nv_fog_pos=fog_position(a_pos);\n#endif\n#endif\nv_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}'),rasterParticleDraw:ai("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",'#include "_prelude_raster_particle.glsl"\nin float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(\nmod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}'),rasterParticleTexture:ai("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:ai('#include "_prelude_raster_particle.glsl"\nuniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(\nlinearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)\n);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}',"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:ai('#include "_prelude_lighting.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#define SDF_PX 8.0\n#define SDF 1.0\n#define ICON 0.0\nuniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;\n#ifdef ICON_TRANSITION\nuniform float u_icon_transition;\n#endif\n#ifdef COLOR_ADJUSTMENT\nuniform mat4 u_color_adj_mat;\n#endif\n#ifdef INDICATOR_CUTOUT\nin highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nin highp float v_z_offset;\n#endif\n#endif\nin vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nin vec2 v_tex_b;\n#endif\nin float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nin float is_sdf;in vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\nvec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];\n#ifdef RENDER_TEXT_AND_SYMBOL\nif (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nreturn;}\n#endif\n#ifdef RENDER_SDF\nfloat EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;\n#else\n#ifdef ICON_TRANSITION\nvec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);\n#else\nout_color=texture(u_texture,v_tex_a);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nout_color=applyLUT(u_lutTexture,out_color);\n#endif\n#ifdef COLOR_ADJUSTMENT\nout_color=u_color_adj_mat*out_color;\n#endif\n#endif\nout_color*=opacity*fade_opacity;\n#ifdef LIGHTING_3D_MODE\nout_color=apply_lighting_with_emission_ground(out_color,emissive_strength);\n#ifdef RENDER_SHADOWS\nfloat light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);\n#ifdef TERRAIN\nout_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);\n#else\nout_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);\n#endif\n#endif\n#endif\n#ifdef INDICATOR_CUTOUT\nout_color=applyCutout(out_color,v_z_offset);\n#endif\n#ifdef FEATURE_CUTOUT\nout_color=apply_feature_cutout(out_color,gl_FragCoord);\n#endif\nglFragColor=out_color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_terrain.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\n#define APPEARANCE_ICON 1.0\nin vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;\n#ifdef Z_OFFSET\nin float a_auto_z_offset;\n#endif\n#ifdef PROJECTION_GLOBE_VIEW\nin vec3 a_globe_anchor;in vec3 a_globe_normal;\n#endif\n#ifdef ICON_TRANSITION\nin vec2 a_texb;\n#endif\n#ifdef OCCLUSION_QUERIES\nin float a_occlusion_query_opacity;\n#endif\n#ifdef ELEVATED_ROADS\nin vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;\n#endif\n#ifdef INDICATOR_CUTOUT\nout highp float v_z_offset;\n#else\n#ifdef RENDER_SHADOWS\nout highp float v_z_offset;\n#endif\n#endif\nuniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;\n#ifdef PROJECTION_GLOBE_VIEW\nuniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;\n#endif\nout vec2 v_tex_a;\n#ifdef ICON_TRANSITION\nout vec2 v_tex_b;\n#endif\nout float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;\n#ifdef RENDER_TEXT_AND_SYMBOL\nout float is_sdf;out vec2 v_tex_a_icon;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;\n#endif\n#pragma mapbox: define highp vec4 fill_color\n#pragma mapbox: define highp vec4 halo_color\n#pragma mapbox: define lowp float opacity\n#pragma mapbox: define lowp float halo_width\n#pragma mapbox: define lowp float halo_blur\n#pragma mapbox: define lowp float emissive_strength\n#pragma mapbox: define lowp float occlusion_opacity\n#pragma mapbox: define lowp float z_offset\nvoid main() {\n#pragma mapbox: initialize highp vec4 fill_color\n#pragma mapbox: initialize highp vec4 halo_color\n#pragma mapbox: initialize lowp float opacity\n#pragma mapbox: initialize lowp float halo_width\n#pragma mapbox: initialize lowp float halo_blur\n#pragma mapbox: initialize lowp float emissive_strength\n#pragma mapbox: initialize lowp float occlusion_opacity\n#pragma mapbox: initialize lowp float z_offset\nvec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);float a_size_max= floor(a_size[1]*0.5);float a_apperance_icon=a_size[1]-2.0*a_size_max;vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (a_apperance_icon==APPEARANCE_ICON) {size=a_size_max/128.0;} else if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size_max,u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);\n#ifdef Z_OFFSET\ne+=a_auto_z_offset;\n#endif\nvec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;\n#ifdef PROJECTION_GLOBE_VIEW\nmercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;\n#else\nworld_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?\ncamera_to_anchor_distance/u_camera_to_center_distance :\nu_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(\n0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;\n#else\noffsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;\n#endif\nvec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;\n#ifdef PROJECTION_GLOBE_VIEW\n#ifdef PROJECTED_POS_ON_VIEWPORT\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);\n#else\nvec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    \n#endif\n#else\nprojected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);\n#endif\nhighp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);\n#ifdef TERRAIN\n#ifdef PITCH_WITH_MAP_TERRAIN\nvec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);\n#endif\n#endif\n#ifdef Z_OFFSET\nz+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;\n#else\nz+=u_pitch_with_map ? z_offset : 0.0;\n#endif\nfloat occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));\n#ifdef DEPTH_OCCLUSION\nfloat depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;\n#endif\n#ifdef OCCLUSION_QUERIES\nfloat occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;\n#endif\n#ifdef Z_TEST_OCCLUSION\nout_fade_opacity*=occlusion_opacity;\n#endif\nfloat alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;\n#ifdef PROJECTION_GLOBE_VIEW\nvec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\n#ifdef ELEVATED_ROADS\nvec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;\n#else\npos=vec3(projected_pos.xy/projected_pos.w+offset,z);\n#endif\n#endif\ngl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;\n#ifdef RENDER_TEXT_AND_SYMBOL\nis_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;\n#endif\n#ifdef ICON_TRANSITION\nv_tex_b=a_texb/u_texsize;\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;\n#ifdef NORMAL_OFFSET\nvec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();\n#endif\nv_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;\n#endif\n#ifdef INDICATOR_CUTOUT\nv_z_offset=e;\n#else\n#ifdef RENDER_SHADOWS\nv_z_offset=e;\n#endif\n#endif\n}'),terrainRaster:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nuniform sampler2D u_image1;uniform float u_emissive_texture_available;\n#endif\nin vec2 v_pos0;\n#ifdef FOG\nin float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nin vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;\n#endif\nuniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;\n#ifdef LIGHTING_3D_MODE\nconst vec3 normal=vec3(0.0,0.0,1.0);\n#ifdef RENDER_SHADOWS\nfloat cutoffOpacity=1.0;\n#ifdef RENDER_CUTOFF\ncutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);\n#endif\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;vec3 unlit_base=image_color.rgb*(1.0-emissive_strength);vec3 emissive_base=image_color.rgb*emissive_strength;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;\n#else\nfloat lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));\n#endif\n#else\nfloat lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : image_color.a;color.rgb=mix(color.rgb,image_color.rgb,emissive_strength);color.a=1.0;\n#endif\n#endif\n#else\ncolor=image_color;\n#endif\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#else\ncolor=fog_dither(fog_apply_from_vert(color,v_fog_opacity));\n#endif\n#endif\nglFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;\n#ifdef FOG\nout float v_fog_opacity;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;\n#endif\nvoid main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);\n#ifdef FOG\n#ifdef ZERO_EXAGGERATION\nv_fog_pos=fog_position(decodedPos);\n#else\nv_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);\n#endif\n}'),terrainDepth:ai("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",'#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}'),skybox:ai('#include "_prelude_fog.fragment.glsl"\nin lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(\ncos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;\n#ifdef FOG\nsky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);\n#endif\nsky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Bn),skyboxGradient:ai('#include "_prelude_fog.fragment.glsl"\nin highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));\n#ifdef FOG\ncolor.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;\n#endif\ncolor*=u_opacity;glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\n}',Bn),skyboxCapture:ai("\nin highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;\n#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)\n#define BETA_M                  vec3(21e-6,21e-6,21e-6)\n#define MIE_G                   0.76\n#define DENSITY_HEIGHT_SCALE_R  8000.0\n#define DENSITY_HEIGHT_SCALE_M  1200.0\n#define PLANET_RADIUS           6360e3\n#define ATMOSPHERE_RADIUS       6420e3\n#define SAMPLE_STEPS            10\n#define DENSITY_STEPS           4\nfloat ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}","in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform sampler2D u_image0;\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nuniform sampler2D u_image1;uniform float u_emissive_texture_available;\n#endif\nuniform float u_far_z_cutoff;in vec2 v_pos0;\n#ifndef FOG\nuniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;\n#endif\nvoid main() {vec4 color;\n#ifdef CUSTOM_ANTIALIASING\nhighp vec2 uv=gl_FragCoord.xy/u_viewport;\n#ifdef FLIP_Y\nuv.y=1.0-uv.y;\n#endif\nhighp vec3 ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : raster.a;raster=apply_lighting_with_emission_ground(raster,emissive_strength);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);\n#else\nraster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=vec4(raster.rgb*antialias,raster.a*antialias);\n#endif\n#else\ncolor=texture(u_image0,v_pos0);\n#ifdef LIGHTING_3D_MODE\n#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS\nfloat emissive_strength=u_emissive_texture_available > 0.5 ? texture(u_image1,v_pos0).r : color.a;color=apply_lighting_with_emission_ground(color,emissive_strength);color.a=1.0;\n#else\ncolor=apply_lighting_ground(color);\n#endif\n#endif\n#endif\n#ifdef FOG\ncolor=fog_dither(fog_apply_premultiplied(color,v_fog_pos));\n#endif\ncolor*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_terrain.vertex.glsl"\nuniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;\n#ifdef GLOBE_POLES\nin vec3 a_globe_pos;in vec2 a_uv;\n#else\nin vec2 a_pos;\n#endif\nout vec2 v_pos0;void main() {\n#ifdef GLOBE_POLES\nvec3 globe_pos=a_globe_pos;vec2 uv=a_uv;\n#else\nfloat tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);\n#endif\nv_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;\n#ifdef GLOBE_POLES\nvec3 up_vector=globe_derived_up_vector;\n#else\nvec3 up_vector=elevationVector(tile_pos);\n#endif\nfloat height=elevation(tile_pos);globe_pos+=up_vector*height;\n#ifndef GLOBE_POLES\nglobe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;\n#endif\n#ifdef GLOBE_POLES\nvec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);\n#else\nvec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);\n#endif\ngl_Position=u_proj_matrix*interpolated_pos;\n#ifdef FOG\nv_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);\n#endif\n}'),globeAtmosphere:ai('#include "_prelude_fog.fragment.glsl"\nuniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;\n#ifdef PROJECTION_GLOBE_VIEW\nglobe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {\n#ifdef ALPHA_PASS\nglFragColor=vec4(0,0,0,0);return;\n#else\n#ifdef NATIVE\nglFragColor=vec4(1,1,1,1);\n#else\nglFragColor=vec4(0,0,0,1);\n#endif\nreturn;\n#endif\n}\n#endif\nhighp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?\n0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;\n#ifdef PROJECTION_GLOBE_VIEW\nhighp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?\nPI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);\n#else\nhorizon_angle=horizon_angle_mercator;\n#endif\nhorizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;\n#ifdef ALPHA_PASS\nfloat a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);\n#else\nvec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);\n#endif\n}',"in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(\nmix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(\nmix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}"),model:ai('#include "_prelude_fog.fragment.glsl"\n#include "_prelude_shadow.fragment.glsl"\n#include "_prelude_lighting.glsl"\nuniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;\n#ifdef RENDER_SHADOWS\nin highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;\n#endif\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nuniform vec4 u_occlusionTextureTransform;\n#endif\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#ifdef HAS_ATTRIBUTE_a_pbr\nin lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;\n#endif\n#ifdef HAS_TEXTURE_u_baseColorTexture\nuniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;\n#endif\n#ifdef HAS_TEXTURE_u_metallicRoughnessTexture\nuniform sampler2D u_metallicRoughnessTexture;\n#endif\n#ifdef HAS_TEXTURE_u_occlusionTexture\nuniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;\n#endif\n#ifdef HAS_TEXTURE_u_normalTexture\nuniform sampler2D u_normalTexture;\n#endif\n#ifdef HAS_TEXTURE_u_emissionTexture\nuniform sampler2D u_emissionTexture;\n#endif\n#ifdef APPLY_LUT_ON_GPU\nuniform highp sampler3D u_lutTexture;\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nin highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;\n#ifdef DEPTH_D24\nhighp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}\n#else\nhighp float unpack_depth_rgba(highp vec4 rgba_depth)\n{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}\n#endif\nbool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;\n#ifdef FLIP_Y\ncoord.y=1.0-coord.y;\n#endif\n#ifdef DEPTH_D24\nhighp float depth=unpack_depth(texture(u_depthTexture,coord).r);\n#else\nhighp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));\n#endif\nreturn v_depth > depth+0.0005;}\n#endif\n#define saturate(_x) clamp(_x,0.,1.)\nvec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)\n{\n#ifdef LIGHTING_3D_MODE\nvec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));\n#endif\nreturn apply_lighting(albedo,transformed_normal,lighting_factor);\n#else\nvec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;\n#endif\n}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;\n#ifdef HAS_ATTRIBUTE_a_color_3f\nalbedo*=vec4(color_3f,1.0);\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#else\n#ifdef HAS_ATTRIBUTE_a_color_4f\nalbedo*=color_4f;\n#endif\n#endif\n#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)\nvec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}\n#ifdef UNPREMULT_TEXTURE_IN_SHADER\nif(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;\n#endif\nif(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}\n#endif\nvec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);\n#ifdef APPLY_LUT_ON_GPU\ncolor=applyLUT(u_lutTexture,color);\n#endif\nreturn color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {\n#ifdef HAS_TEXTURE_u_normalTexture\nhighp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;\n#ifdef FLIP_Y\nT=-T;B=-B;\n#endif\nhighp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;\n#else\nreturn mat3(1.0);\n#endif\n}highp vec3 getNormal(){highp vec3 n;\n#ifdef HAS_ATTRIBUTE_a_normal_3f\nn=normalize(normal_3f);\n#else\nhighp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));\n#ifdef FLIP_Y\nn=normalize(cross(fdx,fdy));\n#else\nn=normalize(cross(fdx,fdy))*-1.0;\n#endif\n#endif\n#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nvec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);\n#endif\nreturn n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;\n#ifdef HAS_ATTRIBUTE_a_pbr\nmat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;\n#endif\n#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) \nvec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;\n#endif\nconst float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)\n{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)\n{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)\n{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)\n{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)\n{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)\n{\n#ifdef LIGHTING_3D_MODE\nreturn mat.diffuseColor;\n#else\nreturn mat.diffuseColor/PI;\n#endif\n}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)\n{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)\n{vec3 env_light=vec3(0.65,0.65,0.65);\n#ifdef LIGHTING_3D_MODE\nfloat ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;\n#endif\nvec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)\n{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;\n#ifdef RENDER_SHADOWS\nlighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);\n#else\nlighting_factor=NdotL;\n#endif\nvec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;\n#if !defined(LIGHTING_3D_MODE)\nconst vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);\n#endif\ncolor*=intensityFactor;return color;}void main() {\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nif (isOccluded()) {discard;}\n#endif\nvec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;\n#ifdef LIGHTING_3D_MODE\nlightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;\n#endif\nvec4 finalColor;\n#ifdef DIFFUSE_SHADED\nvec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);\n#ifdef HAS_TEXTURE_u_occlusionTexture\nfloat ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;\n#endif\nfinalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;\n#else\nMaterial mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;\n#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\n#ifdef OCCLUSION_TEXTURE_TRANSFORM\nvec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;\n#else\nvec2 uv=uv_2f;\n#endif\nao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;\n#endif\nvec4 emissive=u_emissiveFactor;\n#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)\nemissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);\n#endif\n#ifdef APPLY_LUT_ON_GPU\nfloat emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;\n#endif\ncolor+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;\n#ifdef HAS_ATTRIBUTE_a_pbr\nfloat resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;\n#ifdef APPLY_LUT_ON_GPU\ncolor_mix=applyLUT(u_lutTexture,color_mix);\n#endif\ncolor=mix(color,color_mix,min(1.0,resEmission));\n#ifdef HAS_ATTRIBUTE_a_color_4f\nfloat distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);\n#endif\n#endif\nvec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);\n#endif\n#ifdef FOG\nfinalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));\n#endif\n#ifdef RENDER_CUTOFF\nfinalColor*=v_cutoff_opacity;\n#endif\n#ifdef INDICATOR_CUTOUT\nfinalColor=applyCutout(finalColor,v_position_height.w);\n#endif\n#ifdef FEATURE_CUTOUT\nfinalColor=apply_feature_cutout(finalColor,gl_FragCoord);\n#endif\nglFragColor=finalColor;\n#ifdef OVERDRAW_INSPECTOR\nglFragColor=vec4(1.0);\n#endif\nHANDLE_WIREFRAME_DEBUG;}','#include "_prelude_fog.vertex.glsl"\n#include "_prelude_shadow.vertex.glsl"\nin vec3 a_pos_3f;\n#pragma mapbox: define-attribute highp vec3 normal_3f\n#pragma mapbox: define-attribute highp vec2 uv_2f\n#pragma mapbox: define-attribute highp vec3 color_3f\n#pragma mapbox: define-attribute highp vec4 color_4f\n#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr\n#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength\nuniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_normal_matrix;\n#endif\n#ifdef RENDER_SHADOWS\nuniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;\n#endif\nout vec4 v_position_height;out lowp vec4 v_color_mix;\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nout highp float v_depth;\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\nout lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;\n#endif\nvec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {\n#pragma mapbox: initialize-attribute highp vec3 normal_3f\n#pragma mapbox: initialize-attribute highp vec2 uv_2f\n#pragma mapbox: initialize-attribute highp vec3 color_3f\n#pragma mapbox: initialize-attribute highp vec4 color_4f\n#pragma mapbox: initialize-attribute-custom highp vec4 pbr\n#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength\nhighp mat4 normal_matrix;\n#ifdef INSTANCED_ARRAYS\nnormal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\nnormal_matrix=u_normal_matrix;\n#endif\nvec3 local_pos;mat3 rs;\n#ifdef MODEL_POSITION_ON_GPU\nvec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;\n#else\nlocal_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);\n#endif\nv_position_height.w=a_pos_3f.z;\n#ifdef HAS_ATTRIBUTE_a_pbr\nvec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;\n#endif\n#ifdef FOG\nv_fog_pos=fog_position(local_pos);\n#endif\n#ifdef RENDER_CUTOFF\nv_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);\n#endif\n#ifdef TERRAIN_FRAGMENT_OCCLUSION\nv_depth=gl_Position.z/gl_Position.w;\n#ifdef CLIP_ZERO_TO_ONE\nv_depth=-1.0+2.0*v_depth; \n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nfloat x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);\n#else\nnormal_3f=vec3(normal_matrix*vec4(normal_3f,0));\n#endif\n#endif\n#ifdef HAS_ATTRIBUTE_a_pbr\n#ifdef HAS_ATTRIBUTE_a_color_4f\nv_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);\n#endif\n#endif\n#ifdef RENDER_SHADOWS\nvec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);\n#ifdef NORMAL_OFFSET\n#ifdef HAS_ATTRIBUTE_a_normal_3f\n#ifdef MODEL_POSITION_ON_GPU\nvec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#else\nvec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();\n#endif\n#endif\n#endif\nv_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;\n#endif\n}'),modelDepth:ai("in highp float v_depth;void main() {\n#ifndef DEPTH_TEXTURE\nglFragColor=pack_depth(v_depth);\n#endif\n}","in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;\n#ifdef MODEL_POSITION_ON_GPU\n#ifdef INSTANCED_ARRAYS\nin vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;\n#else\nuniform highp mat4 u_instance;\n#endif\nuniform highp mat4 u_node_matrix;\n#endif\nvoid main() {\n#ifdef MODEL_POSITION_ON_GPU\nhighp mat4 instance;\n#ifdef INSTANCED_ARRAYS\ninstance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);\n#else\ninstance=u_instance;\n#endif\nvec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);\n#else\ngl_Position=u_matrix*vec4(a_pos_3f,1);\n#endif\nv_depth=gl_Position.z/gl_Position.w;}"),stars:ai("in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)\n{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}","\nin vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}"),snowParticle:ai("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; \nuniform float u_horizontalOscillationRate; \nuniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}"),rainParticle:ai("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}","\nin highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; \nuniform float u_velocity; \nuniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; \npos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+\nlocalY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}"),vignette:ai("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:ai("uniform vec4 u_color;void main() {glFragColor=u_color;}",'#include "_prelude_terrain.vertex.glsl"\nin highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;\n#ifdef TERRAIN\nfloat e=elevation(world_pos.xy);world_pos.z+=e;\n#endif\nvec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}')};function oi(e,t){const r=e.split("\n");for(let n of r){if(n=n.trimStart(),"#"!==n[0])continue;if(!n.includes("if"))continue;if(n.startsWith("#endif"))continue;const e=n.match(Xn);if(e)for(const r of e)Jn.has(r)||t.add(r)}}function ai(e,t){const r=new Set,n=[],i=[];e=e.replace(Kn,(e,t)=>(i.push(t),"")),t=t.replace(Kn,(e,t)=>(n.push(t),""));let s=new Set(Qn);oi(e,s),oi(t,s);for(const o of[...n,...i])ei[o]||(ei[o]=new Set,oi($n[o],ei[o])),s=new Set([...s,...ei[o]]);return{fragmentSource:e=e.replace(Yn,(e,t,n,i,s)=>(r.add(s),"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(s,"\nin ").concat(n," ").concat(i," ").concat(s,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(s,";\n#endif\n"):"initialize"===t?"\n#ifdef HAS_UNIFORM_u_".concat(s,"\n    ").concat(n," ").concat(i," ").concat(s," = u_").concat(s,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(s,"\n    in ").concat(n," ").concat(i," ").concat(s,";\n#endif\n"):"initialize-attribute"===t?"":void 0)),vertexSource:t=t.replace(Yn,(e,t,n,i,s)=>{const o="MATERIAL_ATTRIBUTE_OFFSET_".concat(s),a="float"===i?"vec2":i,l="GET_ATTRIBUTE_".concat(a,"(a_").concat(s,", materialInfo, ").concat(o,")"),c=s.match(/color/)?"color":a;return"define-attribute-vertex-shader-only"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(s,"\nin ").concat(n," ").concat(i," a_").concat(s,";\n#endif\n"):r.has(s)?"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(s,"\nuniform lowp float u_").concat(s,"_t;\n    #if !defined(").concat(o,")\n        in ").concat(n," ").concat(a," a_").concat(s,";\n    #endif\nout ").concat(n," ").concat(i," ").concat(s,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(s,";\n#endif\n"):"initialize"===t?"vec4"===c?"\n#ifndef HAS_UNIFORM_u_".concat(s,"\n    ").concat(s," = a_").concat(s,";\n#else\n    ").concat(n," ").concat(i," ").concat(s," = u_").concat(s,";\n#endif\n"):"\n#if !defined(HAS_UNIFORM_u_".concat(s,")\n    #ifdef ").concat(o,"\n        ").concat(s," = unpack_mix_").concat(c,"(").concat(l,", u_").concat(s,"_t);\n    #else\n        ").concat(s," = unpack_mix_").concat(c,"(a_").concat(s,", u_").concat(s,"_t);\n    #endif\n#else\n    ").concat(n," ").concat(i," ").concat(s," = u_").concat(s,";\n#endif\n"):"define-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(s,"\n    in ").concat(n," ").concat(i," a_").concat(s,";\n    out ").concat(n," ").concat(i," ").concat(s,";\n#endif\n"):"initialize-attribute"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(s,"\n    ").concat(s," = a_").concat(s,";\n#endif\n"):void 0:"define"===t?"\n#ifndef HAS_UNIFORM_u_".concat(s,"\nuniform lowp float u_").concat(s,"_t;\n    #if !defined(").concat(o,")\n        in ").concat(n," ").concat(a," a_").concat(s,";\n    #endif\n#else\nuniform ").concat(n," ").concat(i," u_").concat(s,";\n#endif\n"):"define-instanced"===t?"mat4"===c?"\n#ifdef INSTANCED_ARRAYS\nin vec4 a_".concat(s,"0;\nin vec4 a_").concat(s,"1;\nin vec4 a_").concat(s,"2;\nin vec4 a_").concat(s,"3;\n#else\nuniform ").concat(n," ").concat(i," u_").concat(s,";\n#endif\n"):"\n#ifdef INSTANCED_ARRAYS\nin ".concat(n," ").concat(a," a_").concat(s,";\n#else\nuniform ").concat(n," ").concat(i," u_").concat(s,";\n#endif\n"):"initialize-attribute-custom"===t?"\n#ifdef HAS_ATTRIBUTE_a_".concat(s,"\n    ").concat(n," ").concat(i," ").concat(s," = a_").concat(s,";\n#endif\n"):"vec4"===c?"\n#ifndef HAS_UNIFORM_u_".concat(s,"\n    #ifdef ").concat(o,"\n        ").concat(n," ").concat(i," ").concat(s," = ").concat(l,";\n    #else\n        ").concat(n," ").concat(i," ").concat(s," = a_").concat(s,";\n    #endif\n#else\n    ").concat(n," ").concat(i," ").concat(s," = u_").concat(s,";\n#endif\n"):"\n#ifndef HAS_UNIFORM_u_".concat(s,"\n    #ifdef ").concat(o,"\n        ").concat(n," ").concat(i," ").concat(s," = unpack_mix_").concat(c,"(").concat(l,", u_").concat(s,"_t);\n    #else\n        ").concat(n," ").concat(i," ").concat(s," = unpack_mix_").concat(c,"(a_").concat(s,", u_").concat(s,"_t);\n    #endif\n#else\n    ").concat(n," ").concat(i," ").concat(s," = u_").concat(s,";\n#endif\n")}),usedDefines:s,vertexIncludes:n,fragmentIncludes:i}}class li{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(e,t,r,n,i,s,o,a){this.context=e;let l=this.boundPaintVertexBuffers.length!==n.length;for(let u=0;!l&&u<n.length;u++)this.boundPaintVertexBuffers[u]!==n[u]&&(l=!0);let c=this.boundDynamicVertexBuffers.length!==o.length;for(let u=0;!c&&u<o.length;u++)this.boundDynamicVertexBuffers[u]!==o[u]&&(c=!0);if(!this.vao||this.boundProgram!==t||this.boundLayoutVertexBuffer!==r||l||c||this.boundIndexBuffer!==i||this.boundVertexOffset!==s)this.freshBind(t,r,n,i,s,o,a);else{e.bindVertexArrayOES.set(this.vao);for(const r of o)r&&(r.bind(),a&&r.instanceCount&&r.setVertexAttribDivisor(e.gl,t,a));i&&i.dynamicDraw&&i.bind()}}freshBind(e,t,r,n,i,s,o){const a=this.context,l=a.gl;this.vao&&this.destroy(),this.vao=a.gl.createVertexArray(),a.bindVertexArrayOES.set(this.vao),this.boundProgram=e,this.boundLayoutVertexBuffer=t,this.boundPaintVertexBuffers=r,this.boundIndexBuffer=n,this.boundVertexOffset=i,this.boundDynamicVertexBuffers=s,t.enableAttributes(l,e),t.bind(),t.setVertexAttribPointers(l,e,i);for(const c of r)c.enableAttributes(l,e),c.bind(),c.setVertexAttribPointers(l,e,i);for(const c of s)c&&(c.enableAttributes(l,e),c.bind(),c.setVertexAttribPointers(l,e,i),o&&c.instanceCount&&c.setVertexAttribDivisor(l,e,o));n&&n.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function ci(t,r){const n=Math.pow(2,r.canonical.z),i=r.canonical.y;return[new e.ae(0,i/n).toLngLat().lat,new e.ae(0,(i+1)/n).toLngLat().lat]}function ui(t,r,n,i,s,o,a){const l=t.context,c=l.gl,u=n.hillshadeFBO;if(!u)return;t.prepareDrawTile();const d=t.isTileAffectedByFog(r),h=[];t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode&&h.push("USE_MRT1");const p=t.getOrCreateProgram("hillshade",{overrideFog:d,defines:h});l.activeTexture.set(c.TEXTURE0),c.bindTexture(c.TEXTURE_2D,u.colorAttachment0.get());const m=((t,r,n,i)=>{const s=n.paint.get("hillshade-shadow-color"),o="none"===n.paint.get("hillshade-shadow-color-use-theme").constantOr("default"),a=n.paint.get("hillshade-highlight-color"),l="none"===n.paint.get("hillshade-highlight-color-use-theme").constantOr("default"),c=n.paint.get("hillshade-accent-color"),u="none"===n.paint.get("hillshade-accent-color-use-theme").constantOr("default"),d=n.paint.get("hillshade-emissive-strength");let h=e.an(n.paint.get("hillshade-illumination-direction"));if("viewport"===n.paint.get("hillshade-illumination-anchor"))h-=t.transform.angle;else if(t.style&&t.style.enable3dLights()&&t.style.directionalLight){const r=t.style.directionalLight.properties.get("direction"),n=e.d4(r.x,r.y,r.z);h=e.an(n[1])}const p=!t.options.moving;return{u_matrix:i||t.transform.calculateProjMatrix(r.tileID.toUnwrapped(),p),u_image:0,u_latrange:ci(0,r.tileID),u_light:[n.paint.get("hillshade-exaggeration"),h],u_shadow:s.toPremultipliedRenderColor(o?null:n.lut),u_highlight:a.toPremultipliedRenderColor(l?null:n.lut),u_emissive_strength:d,u_accent:c.toPremultipliedRenderColor(u?null:n.lut)}})(t,n,i,t.terrain?r.projMatrix:null);t.uploadCommonUniforms(l,p,r.toUnwrapped());const{tileBoundsBuffer:f,tileBoundsIndexBuffer:g,tileBoundsSegments:y}=t.getTileBoundsBuffers(n);p.draw(t,c.TRIANGLES,s,o,a,nn.disabled,m,i.id,f,g,y)}function di(t,r,n){if(!r.needsDEMTextureUpload)return;const i=t.context,s=i.gl;i.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||t.getTileTexture(n.stride);const o=n.getPixels();r.demTexture?r.demTexture.update(o,{premultiply:!1}):r.demTexture=new e.T(i,o,s.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function hi(t,r,n){const i=t.context,s=i.gl;if(!r.dem)return;const o=r.dem;if(i.activeTexture.set(s.TEXTURE1),di(t,r,o),!r.demTexture)return;r.demTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE);const a=o.dim;i.activeTexture.set(s.TEXTURE0);let l=r.hillshadeFBO;if(!l){const t=new e.T(i,{width:a,height:a,data:null},s.RGBA8);t.bind(s.LINEAR,s.CLAMP_TO_EDGE),l=r.hillshadeFBO=i.createFramebuffer(a,a,1,"renderbuffer"),l.colorAttachment0.set(t.texture)}i.bindFramebuffer.set(l.framebuffer),i.viewport.set([0,0,a,a]);const{tileBoundsBuffer:c,tileBoundsIndexBuffer:u,tileBoundsSegments:d}=t.getMercatorTileBoundsBuffers(),h=[];t.linearFloatFilteringSupported()&&h.push("TERRAIN_DEM_FLOAT_FORMAT"),t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode&&h.push("USE_MRT1"),t.getOrCreateProgram("hillshadePrepare",{defines:h}).draw(t,s.TRIANGLES,Qr.disabled,en.disabled,Jr.unblended,nn.disabled,((t,r)=>{const n=r.stride,i=e.bC();return e.ce(i,0,e.al,-e.al,0,0,1),e.br(i,i,[0,-e.al,0]),{u_matrix:i,u_image:1,u_dimension:[n,n],u_zoom:t.overscaledZ}})(r.tileID,o),n.id,c,u,d),r.needsHillshadePrepare=!1}class pi{constructor(e){this.gl=e.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(e){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class mi extends pi{getDefault(){return e.ao.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.clearColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class fi extends pi{getDefault(){return 1}set(e){(e!==this.current||this.dirty)&&(this.gl.clearDepth(e),this.current=e,this.dirty=!1)}}class gi extends pi{getDefault(){return 0}set(e){(e!==this.current||this.dirty)&&(this.gl.clearStencil(e),this.current=e,this.dirty=!1)}}class yi extends pi{getDefault(){return[!0,!0,!0,!0]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.colorMask(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class _i extends pi{getDefault(){return!0}set(e){(e!==this.current||this.dirty)&&(this.gl.depthMask(e),this.current=e,this.dirty=!1)}}class vi extends pi{getDefault(){return 255}set(e){(e!==this.current||this.dirty)&&(this.gl.stencilMask(e),this.current=e,this.dirty=!1)}}class xi extends pi{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(e){const t=this.current;(e.func!==t.func||e.ref!==t.ref||e.mask!==t.mask||this.dirty)&&(this.gl.stencilFunc(e.func,e.ref,e.mask),this.current=e,this.dirty=!1)}}class bi extends pi{getDefault(){const e=this.gl;return[e.KEEP,e.KEEP,e.KEEP]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||this.dirty)&&(this.gl.stencilOp(e[0],e[1],e[2]),this.current=e,this.dirty=!1)}}class wi extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.STENCIL_TEST):t.disable(t.STENCIL_TEST),this.current=e,this.dirty=!1}}class ji extends pi{getDefault(){return[0,1]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||this.dirty)&&(this.gl.depthRange(e[0],e[1]),this.current=e,this.dirty=!1)}}class Si extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.DEPTH_TEST):t.disable(t.DEPTH_TEST),this.current=e,this.dirty=!1}}class Ti extends pi{getDefault(){return this.gl.LESS}set(e){(e!==this.current||this.dirty)&&(this.gl.depthFunc(e),this.current=e,this.dirty=!1)}}class ki extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.BLEND):t.disable(t.BLEND),this.current=e,this.dirty=!1}}class Ai extends pi{getDefault(){const e=this.gl;return[e.ONE,e.ZERO,e.ONE,e.ZERO]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.blendFuncSeparate(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Ci extends pi{getDefault(){return e.ao.transparent.toNonPremultipliedRenderColor(null)}set(e){const t=this.current;(e.r!==t.r||e.g!==t.g||e.b!==t.b||e.a!==t.a||this.dirty)&&(this.gl.blendColor(e.r,e.g,e.b,e.a),this.current=e,this.dirty=!1)}}class Ei extends pi{getDefault(){return this.gl.FUNC_ADD}set(e){(e!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(e,e),this.current=e,this.dirty=!1)}}class Ni extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;e?t.enable(t.CULL_FACE):t.disable(t.CULL_FACE),this.current=e,this.dirty=!1}}class Ii extends pi{getDefault(){return this.gl.BACK}set(e){(e!==this.current||this.dirty)&&(this.gl.cullFace(e),this.current=e,this.dirty=!1)}}class Pi extends pi{getDefault(){return this.gl.CCW}set(e){(e!==this.current||this.dirty)&&(this.gl.frontFace(e),this.current=e,this.dirty=!1)}}let Mi=class extends pi{getDefault(){return null}set(e){(e!==this.current||this.dirty)&&(this.gl.useProgram(e),this.current=e,this.dirty=!1)}};class Li extends pi{getDefault(){return this.gl.TEXTURE0}set(e){(e!==this.current||this.dirty)&&(this.gl.activeTexture(e),this.current=e,this.dirty=!1)}}class Ri extends pi{getDefault(){const e=this.gl;return[0,0,e.drawingBufferWidth,e.drawingBufferHeight]}set(e){const t=this.current;(e[0]!==t[0]||e[1]!==t[1]||e[2]!==t[2]||e[3]!==t[3]||this.dirty)&&(this.gl.viewport(e[0],e[1],e[2],e[3]),this.current=e,this.dirty=!1)}}class Di extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindFramebuffer(t.FRAMEBUFFER,e),this.current=e,this.dirty=!1}}class Fi extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindRenderbuffer(t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Oi extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindTexture(t.TEXTURE_2D,e),this.current=e,this.dirty=!1}}class zi extends pi{getDefault(){return null}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.bindBuffer(t.ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Bi extends pi{getDefault(){return null}set(e){const t=this.gl;t.bindBuffer(t.ELEMENT_ARRAY_BUFFER,e),this.current=e,this.dirty=!1}}class Ui extends pi{getDefault(){return null}set(e){this.gl&&(e!==this.current||this.dirty)&&(this.gl.bindVertexArray(e),this.current=e,this.dirty=!1)}}class Vi extends pi{getDefault(){return 4}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_ALIGNMENT,e),this.current=e,this.dirty=!1}}class qi extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_PREMULTIPLY_ALPHA_WEBGL,e),this.current=e,this.dirty=!1}}class Wi extends pi{getDefault(){return!1}set(e){if(e===this.current&&!this.dirty)return;const t=this.gl;t.pixelStorei(t.UNPACK_FLIP_Y_WEBGL,e),this.current=e,this.dirty=!1}}class Hi extends pi{constructor(e,t){super(e),this.context=e,this.parent=t}getDefault(){return null}}class Gi extends Hi{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(e,t),this.attachmentPoint=e.gl.COLOR_ATTACHMENT0+r}setDirty(){this.dirty=!0}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachmentPoint,t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Zi extends Hi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferRenderbuffer(t.FRAMEBUFFER,this.attachment(),t.RENDERBUFFER,e),this.current=e,this.dirty=!1}}class Ki extends Hi{attachment(){return this.gl.DEPTH_ATTACHMENT}set(e){if(e===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const t=this.gl;t.framebufferTexture2D(t.FRAMEBUFFER,this.attachment(),t.TEXTURE_2D,e,0),this.current=e,this.dirty=!1}}class Yi extends Zi{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const Xi=(e,t,r,n)=>({u_matrix:e,u_image0:0,u_image1:1,u_skirt_height:t,u_ground_shadow_factor:r,u_emissive_texture_available:n}),Ji=(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g)=>({u_proj_matrix:Float32Array.from(e),u_globe_matrix:t,u_normalize_matrix:Float32Array.from(n),u_merc_matrix:r,u_zoom_transition:i,u_merc_center:s,u_image0:0,u_image1:1,u_frustum_tl:o,u_frustum_tr:a,u_frustum_br:l,u_frustum_bl:c,u_globe_pos:u,u_globe_radius:d,u_viewport:h,u_grid_matrix:g?Float32Array.from(g):new Float32Array(9),u_skirt_height:p,u_far_z_cutoff:m,u_emissive_texture_available:f});function Qi(e,t){return null!=e&&null!=t&&!(!e.hasData()||!t.hasData())&&null!=e.demTexture&&null!=t.demTexture&&e.tileID.key!==t.tileID.key}const $i=new class{constructor(){this.operations={}}newMorphing(e,t,r,n,i){if(e in this.operations){const t=this.operations[e];t.to.tileID.key!==r.tileID.key&&(t.queued=r)}else this.operations[e]={startTime:n,phase:0,duration:i,from:t,to:r,queued:null}}getMorphValuesForProxy(e){if(!(e in this.operations))return null;const t=this.operations[e];return{from:t.from,to:t.to,phase:t.phase}}update(e){for(const t in this.operations){const r=this.operations[t];for(r.phase=(e-r.startTime)/r.duration;r.phase>=1||!this._validOp(r);)if(!this._nextOp(r,e)){delete this.operations[t];break}}}_nextOp(e,t){return!!e.queued&&(e.from=e.to,e.to=e.queued,e.queued=null,e.phase=0,e.startTime=t,!0)}_validOp(e){return e.from.hasData()&&e.to.hasData()}},es={0:null,1:"TERRAIN_VERTEX_MORPHING"};function ts(e,t,r){if(0===t)return 0;const n=t<1&&514===r?.25/t:1;return 6*Math.pow(1.5,22-e)*Math.max(t,1)*n}function rs(e,t){const r=1<<e.z;return!t&&(0===e.x||e.x===r-1)||0===e.y||e.y===r-1}function ns(e,t){if(!e.style||!e.style.enable3dLights())return;const r=e.context,n=r.gl;r.activeTexture.set(n.TEXTURE1),t?t.bind(n.LINEAR,n.CLAMP_TO_EDGE):e.emptyTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}const is=e=>({u_matrix:e});function ss(t,r,n,i,s){if(s>0){const o=e.o.now(),a=(o-t.timeAdded)/s,l=r?(o-r.timeAdded)/s:-1,c=n.getSource(),u=i.coveringZoomLevel({tileSize:c.tileSize,roundZoom:c.roundZoom}),d=!r||Math.abs(r.tileID.overscaledZ-u)>Math.abs(t.tileID.overscaledZ-u),h=d&&t.refreshedUponExpiration?1:e.aA(d?a:1-l,0,1);return r?{opacity:1,mix:1-h,isFading:a<1}:{opacity:h,mix:0,isFading:a<1}}return{opacity:1,mix:0,isFading:!1}}class os extends zt{constructor(e){const t=vt("mock-dem",{type:"raster-dem",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("mock-dem",t,!1),t.setEventedParent(this),this._sourceLoaded=!0}_loadTile(e,t){e.state="loaded",t(null)}}class as extends zt{constructor(e){const t=vt("proxy",{type:"geojson",maxzoom:e.transform.maxZoom},e.style.dispatcher,e.style);super("proxy",t,!1),t.setEventedParent(this),this.map=this.getSource().map=e,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(e,t,r){if(e.freezeTileCoverage)return;this.transform=e;const n=e.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((t,r)=>{if(t[r.key]="",!this._tiles[r.key]){const t=new Rt(r,this._source.tileSize*r.overscaleFactor(),e.tileZoom,void 0,void 0,this._source.worldview);t.state="loaded",this._tiles[r.key]=t}return t},{});for(const i in this._tiles)i in n||(this.freeFBO(i),this._tiles[i].unloadVectorData(),delete this._tiles[i])}freeFBO(e){const t=this.proxyCachedFBO[e];if(void 0!==t){const r=Object.values(t);this.renderCachePool.push(...r),delete this.proxyCachedFBO[e]}}deallocRenderCache(){this.renderCache.forEach(e=>e.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class ls extends e.aQ{constructor(e,t,r){super(e.overscaledZ,e.wrap,e.canonical.z,e.canonical.x,e.canonical.y),this.proxyTileKey=t,this.projMatrix=r}}class cs extends e.bV{constructor(t,r){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},this.painter=t,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[n,i,s]=function(){const t=new e.bd,r=new e.b0,n=131;t.reserve(17161),r.reserve(33800);const i=e.al/128,s=e.al+i/2,o=s+i;for(let l=-i;l<o;l+=i)for(let r=-i;r<o;r+=i){const n=r<0||r>s||l<0||l>s?24575:0,i=e.aA(Math.round(r),0,e.al),o=e.aA(Math.round(l),0,e.al);t.emplaceBack(i+n,o)}const a=(e,t)=>{const i=t*n+e;r.emplaceBack(i+1,i,i+n),r.emplaceBack(i+n,i+n+1,i+1)};for(let e=1;e<129;e++)for(let t=1;t<129;t++)a(t,e);return[0,129].forEach(e=>{for(let t=0;t<130;t++)a(t,e),a(e,t)}),[t,r,32768]}(),o=t.context;this.gridBuffer=o.createVertexBuffer(n,e.bf.members),this.gridIndexBuffer=o.createIndexBuffer(i),this.gridSegments=e.bg.simpleSegment(0,0,n.length,i.length),this.gridNoSkirtSegments=e.bg.simpleSegment(0,0,n.length,s),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new as(r.map),this.orthoMatrix=e.bC(),e.ce(this.orthoMatrix,"globe"===this.painter.transform.projection.name?.015:0,e.al,0,e.al,0,1);const a=o.gl;this._overlapStencilMode=new en({func:a.GEQUAL,mask:255},0,255,a.KEEP,a.KEEP,a.REPLACE),this._previousZoom=t.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=r,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new os(r.map),this._pendingGroundEffectLayers=[],this._emissiveTexture=!1}set style(e){e.on("data",this._onStyleDataEvent.bind(this)),this._style=e,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(t,r,n){if(t&&t.terrain){this._style!==t&&(this.style=t,this._evaluationZoom=void 0);const i=t.terrain.properties,s=0===t.terrain.drapeRenderMode,o=t.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=e.o.now();const a=t.terrain&&t.terrain.scope,l=i.get("source"),c=s?this._mockSourceCache:t.getSourceCache(l,a);if(!c)return void e.w("Couldn't find terrain source \"".concat(l,'".'));if(this.sourceCache=c,this._attenuationRange=t.terrain.getAttenuationRange(),this._exaggeration=o?this.calculateExaggeration(r):i.get("exaggeration"),!r.projection.requiresDraping&&o&&0===this._exaggeration)return void this._disable();this.enabled=!0;const u=()=>{this.sourceCache.used&&e.w("Raster DEM source '".concat(this.sourceCache.id,"' is used both for terrain and as layer source.\nThis leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source."));const t=this.getScaledDemTileSize();this.sourceCache.update(r,t,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,u(),this._initializing=!0),u(),r.updateElevation(!0,n),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(r),this._emptyDEMTextureDirty=!0,this._previousZoom=r.zoom}else this._disable()}calculateExaggeration(t){if(this._attenuationRange&&t.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(t.zoom);const r=this._previousCameraAltitude,n=t.getFreeCameraOptions().position.z/t.pixelsPerMeter*t.worldSize;this._previousCameraAltitude=n;const i=null!=r?n-r:Number.MAX_VALUE;if(Math.abs(i)<2)return this._exaggeration;const s=t.zoom,o=this._style.terrain;if(!this._previousUpdateTimestamp)return o.getExaggeration(s);let a=s-this._previousZoom;const l=this._previousUpdateTimestamp;let c=s;null!=this._evaluationZoom&&(c=this._evaluationZoom,Math.abs(s-c)>.5&&(a=.5*(s-c+a)),a*i<0&&(c+=a)),this._evaluationZoom=c;const u=o.getExaggeration(c),d=u===o.getExaggeration(Math.max(0,c-.1));if(d&&Math.abs(u-this._exaggeration)<.01)return u;let h=Math.min(.1,.00375*(this._updateTimestamp-l));return(d||u<.1||Math.abs(a)<1e-4)&&(h=Math.min(.2,4*h)),e.ak(this._exaggeration,u,h)}resetTileLookupCache(e){this._findCoveringTileCache[e]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(e){"source"===e.dataType&&e.coord?this._clearRenderCacheForTile(e.sourceCacheId,e.coord):"style"===e.dataType&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const e in this._style._mergedSourceCaches)this._style._mergedSourceCaches[e].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(e=>e.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const e=2*this.proxySourceCache.getSource().tileSize;return[e,e]}set useVertexMorphing(e){this._useVertexMorphing=e}updateTileBinding(t){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const r=this.proxySourceCache,n=this.painter.transform;this._initializing&&(this._initializing=0===n._centerAltitude&&-1===this.getAtPointOrZero(e.ae.fromLngLat(n.center),-1),this._emptyDEMTextureDirty=!this._initializing);const i=this.proxyCoords=r.getIds().map(e=>{const t=r.getTileByID(e).tileID;return t.projMatrix=n.calculateProjMatrix(t.toUnwrapped()),t});!function(t,r){const n=r.transform.pointCoordinate(r.transform.getCameraPoint()),i=new e.P(n.x,n.y);t.sort((t,r)=>{if(r.overscaledZ-t.overscaledZ)return r.overscaledZ-t.overscaledZ;const n=new e.P(t.canonical.x+(1<<t.canonical.z)*t.wrap,t.canonical.y),s=new e.P(r.canonical.x+(1<<r.canonical.z)*r.wrap,r.canonical.y),o=i.mult(1<<t.canonical.z);return o.x-=.5,o.y-=.5,o.distSqr(n)-o.distSqr(s)})}(i,this.painter);const s=this.proxyToSource||{};this.proxyToSource={},i.forEach(e=>{this.proxyToSource[e.key]={}}),this.terrainTileForTile={};const o=this._style._mergedSourceCaches;for(const e in o){const r=o[e];if(!r.used)continue;if(r!==this.sourceCache&&this.resetTileLookupCache(r.id),this._setupProxiedCoordsForOrtho(r,t[e],s),r.usedForTerrain)continue;const n=t[e];r.getSource().reparseOverscaled&&this._assignTerrainTiles(n)}this.proxiedCoords[r.id]=i.map(e=>new ls(e,e.key,this.orthoMatrix)),this._assignTerrainTiles(i),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(s),this.renderingToTexture=!1;const a={};this._visibleDemTiles=[];for(const e of this.proxyCoords){const t=this.terrainTileForTile[e.key];if(!t)continue;const r=t.tileID.key;r in a||(this._visibleDemTiles.push(t),a[r]=r)}}_assignTerrainTiles(e){this._initializing||e.forEach(e=>{if(this.terrainTileForTile[e.key])return;const t=this._findTileCoveringTileID(e,this.sourceCache);t&&(this.terrainTileForTile[e.key]=t)})}_prepareDEMTextures(){const e=this.painter.context,t=e.gl;for(const r in this.terrainTileForTile){const n=this.terrainTileForTile[r],i=n.dem;!i||n.demTexture&&!n.needsDEMTextureUpload||(e.activeTexture.set(t.TEXTURE1),di(this.painter,n,i))}}_prepareDemTileUniforms(e,t,r,n){if(!t||null==t.demTexture)return!1;const i=e.tileID.canonical,s=Math.pow(2,t.tileID.canonical.z-i.z),o=n||"";return r["u_dem_tl".concat(o)]=[i.x*s%1,i.y*s%1],r["u_dem_scale".concat(o)]=s,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let e=0;const t=this._visibleDemTiles.reduce((t,r)=>{if(!r.dem)return t;const n=r.dem.tree.minimums[0];return n>0&&e++,t+n},0);return e?t/e:0}_updateEmptyDEMTexture(){const t=this.painter.context,r=t.gl;t.activeTexture.set(r.TEXTURE2);const n=this._getLoadedAreaMinimum(),i=new e.dL({width:1,height:1},new Float32Array([n]));this._emptyDEMTextureDirty=!1;let s=this._emptyDEMTexture;return s?s.update(i,{premultiply:!1}):s=this._emptyDEMTexture=new e.T(t,i,r.R32F,{premultiply:!1}),s}setupElevationDraw(t,r,n){const i=this.painter.context,s=i.gl,o={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};o.u_exaggeration=this.exaggeration();let a=null,l=null,c=1;if(n&&n.morphing&&this._useVertexMorphing){const e=n.morphing.srcDemTile,r=n.morphing.dstDemTile;c=n.morphing.phase,e&&r&&(this._prepareDemTileUniforms(t,e,o,"_prev")&&(l=e),this._prepareDemTileUniforms(t,r,o)&&(a=r))}const u=e=>e&&e.demTexture&&this.painter.linearFloatFilteringSupported()?s.LINEAR:s.NEAREST;let d=null;var h;if(this.enabled?l&&a?(d=a.demTexture,i.activeTexture.set(s.TEXTURE4),l.demTexture.bind(u(l),s.CLAMP_TO_EDGE),o.u_dem_lerp=c):(a=this.terrainTileForTile[t.tileID.key],d=this._prepareDemTileUniforms(t,a,o)?a.demTexture:this.emptyDEMTexture):d=this.emptyDEMTexture,i.activeTexture.set(s.TEXTURE2),d&&(o.u_dem_size=1===(h=d).size[0]?1:h.size[0]-2,d.bind(u(a),s.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(n&&n.useDepthForOcclusion,r,o),n&&n.useMeterToDem&&a){const t=(1<<a.tileID.canonical.z)*e.cf(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;o.u_meter_to_dem=t}if(n&&n.labelPlaneMatrixInv&&(o.u_label_plane_matrix_inv=n.labelPlaneMatrixInv),r.setTerrainUniformValues(i,o),"globe"===this.painter.transform.projection.name){const e=this.globeUniformValues(this.painter.transform,t.tileID.canonical,n&&n.useDenormalizedUpVectorScale);r.setGlobeUniformValues(i,e)}}globeUniformValues(t,r,n){const i=t.projection;return{u_tile_tl_up:i.upVector(r,0,0),u_tile_tr_up:i.upVector(r,e.al,0),u_tile_br_up:i.upVector(r,e.al,e.al),u_tile_bl_up:i.upVector(r,0,e.al),u_tile_up_scale:n?e.dM(1):i.upVectorScale(r,t.center.lat,t.worldSize).metersToTile}}renderToBackBuffer(t){const r=this.painter,n=this.painter.context;0!==t.length&&(n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),r.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(t,r,n,i,s){if("globe"===t.transform.projection.name)!function(t,r,n,i,s){const o=t.context,a=o.gl;let l,c;const u=t.transform,d=e.dE(t,o,u),h=(e,r)=>{if(c===r)return;const n=[es[r],"PROJECTION_GLOBE_VIEW"];d&&n.push("CUSTOM_ANTIALIASING");const i=t.isTileAffectedByFog(e);l=t.getOrCreateProgram("globeRaster",{defines:n,overrideFog:i}),c=r},p=t.colorModeForRenderPass(),m=new Qr(a.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D);$i.update(s);const f=e.dF(u),g=[e.aF(u.center.lng),e.aJ(u.center.lat)],y=t.globeSharedBuffers,_=[u.width*e.o.devicePixelRatio,u.height*e.o.devicePixelRatio],v=Float32Array.from(u.globeMatrix),x={useDenormalizedUpVectorScale:!0};{const u=t.transform,d=ts(u.zoom,r.exaggeration(),r.sourceCache._source.tileSize);c=-1;const b=a.TRIANGLES;for(const c of i){const i=n.getTile(c),w=en.disabled,j=r.prevTerrainTileForTile[c.key],S=r.terrainTileForTile[c.key];Qi(j,S)&&$i.newMorphing(c.key,j,S,s,250),ns(t,i.emissiveTexture),o.activeTexture.set(a.TEXTURE0),i.texture&&i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const T=$i.getMorphValuesForProxy(c.key),k=T?1:0;T&&Object.assign(x,{morphing:{srcDemTile:T.from,dstDemTile:T.to,phase:e.dD(T.phase)}});const A=e.dG(c.canonical),C=e.dH(A.getCenter().lat),E=e.dI(c.canonical,A,C,u.worldSize/u._pixelsPerMercatorPixel),N=e.bk(e.dJ(c.canonical)),I="mrt-fallback"===t.emissiveMode?1:0,P=Ji(u.expandedFarZProjMatrix,v,f,N,e.aj(u.zoom),g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,d,u._farZ,I,E);if(h(c,k),l&&(r.setupElevationDraw(i,l,x),t.uploadCommonUniforms(o,l,c.toUnwrapped()),y)){const[e,r,n]=y.getGridBuffers(C,0!==d);l.draw(t,b,m,w,p,nn.backCCW,P,"globe_raster",e,r,n)}}}if(y&&(t.renderDefaultNorthPole||t.renderDefaultSouthPole)){const s=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];d&&s.push("CUSTOM_ANTIALIASING"),l=t.getOrCreateProgram("globeRaster",{defines:s});for(const c of i){const{x:i,y:s,z:d}=c.canonical,h=0===s,f=s===(1<<d)-1,[v,b,w,j]=y.getPoleBuffers(d,!1);if(j&&(h||f)){const s=n.getTile(c);ns(t,s.emissiveTexture),o.activeTexture.set(a.TEXTURE0),s.texture&&s.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);let y=e.dK(d,i,u);const S=e.bk(e.dJ(c.canonical)),T="mrt-fallback"===t.emissiveMode?1:0,k=(e,r)=>e.draw(t,a.TRIANGLES,m,en.disabled,p,nn.disabled,Ji(u.expandedFarZProjMatrix,y,y,S,0,g,u.frustumCorners.TL,u.frustumCorners.TR,u.frustumCorners.BR,u.frustumCorners.BL,u.globeCenterInViewSpace,u.globeRadius,_,0,u._farZ,T),"globe_pole_raster",r,w,j);r.setupElevationDraw(s,l,x),t.uploadCommonUniforms(o,l,c.toUnwrapped()),h&&t.renderDefaultNorthPole&&k(l,v),f&&t.renderDefaultSouthPole&&(y=e.cS(e.bC(),y,[1,-1,1]),k(l,b))}}}}(t,r,n,i,s);else{const o=t.context,a=o.gl;let l,c;const u=t.shadowRenderer,d=mn(t,t.longestCutoffRange),h=e=>{if(c===e)return;const r=[];r.push(es[e]),d.shouldRenderCutoff&&r.push("RENDER_CUTOFF"),u&&(r.push("RENDER_SHADOWS","DEPTH_TEXTURE"),u.useNormalOffset&&r.push("NORMAL_OFFSET")),l=t.getOrCreateProgram("terrainRaster",{defines:r}),c=e},p=t.colorModeForRenderPass(),m=new Qr(a.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D);$i.update(s);const f=t.transform,g=ts(f.zoom,r.exaggeration(),r.sourceCache._source.tileSize);let y=[0,0,0];if(u){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(y=bn(t.style,e,r))}{c=-1;const _=a.TRIANGLES,[v,x]=[r.gridIndexBuffer,r.gridSegments];for(const c of i){const i=n.getTile(c),b=en.disabled,w=r.prevTerrainTileForTile[c.key],j=r.terrainTileForTile[c.key];Qi(w,j)&&$i.newMorphing(c.key,w,j,s,250),ns(t,i.emissiveTexture),o.activeTexture.set(a.TEXTURE0),i.texture&&i.texture.bind(a.LINEAR,a.CLAMP_TO_EDGE);const S=$i.getMorphValuesForProxy(c.key),T=S?1:0;let k;S&&(k={morphing:{srcDemTile:S.from,dstDemTile:S.to,phase:e.dD(S.phase)}});const A="mrt-fallback"===t.emissiveMode?1:0,C=Xi(c.projMatrix,rs(c.canonical,f.renderWorldCopies)?g/10:g,y,A);if(h(T),!l)continue;r.setupElevationDraw(i,l,k);const E=c.toUnwrapped();u&&u.setupShadows(E,l),t.uploadCommonUniforms(o,l,E,null,d),l.draw(t,_,m,b,p,nn.backCCW,C,"terrain_raster",r.gridBuffer,v,x)}}}}(r,this,this.proxySourceCache,t,this._updateTimestamp),this.renderingToTexture=!0,r.gpuTimingDeferredRenderEnd(),t.splice(0,t.length))}renderBatch(t){if(0===this._drapedRenderBatches.length)return t+1;this.renderingToTexture=!0;const r=this.painter,n=this.painter.context,i=this.proxySourceCache,s=this.proxiedCoords[i.id],o=this._drapedRenderBatches.shift(),a=r.style.order,l=[];this._updateFBOs("mrt-fallback"===r.emissiveMode);let c=0;for(const u of s){const s=i.getTileByID(u.proxyTileKey),d=i.proxyCachedFBO[u.key]?i.proxyCachedFBO[u.key][t]:void 0,h=void 0!==d?i.renderCache[d]:this.pool[c++],p=void 0!==d;if(s.texture=h.tex,s.emissiveTexture=h.emissiveTex,p&&!h.dirty){l.push(s.tileID);continue}n.bindFramebuffer.set(h.fb.framebuffer);const m=n.gl;let f;m.drawBuffers("mrt-fallback"===r.emissiveMode?[m.COLOR_ATTACHMENT0,m.COLOR_ATTACHMENT1]:[m.COLOR_ATTACHMENT0]),this.renderedToTile=!1,h.dirty&&(n.clear({color:e.ao.transparent,stencil:0}),h.dirty=!1);for(let e=o.start;e<=o.end;++e){const t=r.style._mergedLayers[a[e]];if(t.isHidden(r.transform.zoom))continue;const i=r.style.getLayerSourceCache(t),s=i?this.proxyToSource[u.key][i.id]:[u];if(!s)continue;const o=s;n.viewport.set([0,0,h.fb.width,h.fb.height]),f!==(i?i.id:null)&&(this._setupStencil(h,s,t,i),f=i?i.id:null),r.renderLayer(r,i,t,o)}if(m.drawBuffers([m.COLOR_ATTACHMENT0]),0===this._drapedRenderBatches.length)for(const e of this._pendingGroundEffectLayers){const t=r.style._mergedLayers[a[e]];if(t.isHidden(r.transform.zoom))continue;const i=r.style.getLayerSourceCache(t),s=i?this.proxyToSource[u.key][i.id]:[u];if(!s)continue;const o=s;n.viewport.set([0,0,h.fb.width,h.fb.height]),f!==(i?i.id:null)&&(this._setupStencil(h,s,t,i),f=i?i.id:null),r.renderLayer(r,i,t,o)}this.renderedToTile?(h.dirty=!0,l.push(s.tileID)):p||--c,5===c&&(c=0,this.renderToBackBuffer(l))}return this.renderToBackBuffer(l),this.renderingToTexture=!1,n.bindFramebuffer.set(null),n.viewport.set([0,0,r.width,r.height]),o.end+1}postRender(){}isLayerOrderingCorrect(e){const t=e.order.length;let r=-1,n=t;for(let i=0;i<t;++i)this._style.isLayerDraped(e._mergedLayers[e.order[i]])?r=Math.max(r,i):n=Math.min(n,i);return n>r}getMinElevationBelowMSL(){let e=0;return this._visibleDemTiles.filter(e=>e.dem).forEach(t=>{e=Math.min(e,t.dem.tree.minimums[0])}),0===e?e:(e-30)*this._exaggeration}raycast(e,t,r){if(!this._visibleDemTiles)return null;const n=this._visibleDemTiles.filter(e=>e.dem).map(n=>{const i=n.tileID,s=1<<i.overscaledZ,{x:o,y:a}=i.canonical,l=o/s,c=(o+1)/s,u=a/s,d=(a+1)/s;return{minx:l,miny:u,maxx:c,maxy:d,t:n.dem.tree.raycastRoot(l,u,c,d,e,t,r),tile:n}});n.sort((e,t)=>(null!==e.t?e.t:Number.MAX_VALUE)-(null!==t.t?t.t:Number.MAX_VALUE));for(const i of n){if(null==i.t)return null;const n=i.tile.dem.tree.raycast(i.minx,i.miny,i.maxx,i.maxy,e,t,r);if(null!=n)return n}return null}_createFBO(){const t=this.painter.context,r=t.gl,n=this.drapeBufferSize;t.activeTexture.set(r.TEXTURE0);const i=new e.T(t,{width:n[0],height:n[1],data:null},r.RGBA8);i.bind(r.LINEAR,r.CLAMP_TO_EDGE);const s=t.createFramebuffer(n[0],n[1],1,null);let o;return s.colorAttachment0.set(i.texture),this._emissiveTexture&&(o=new e.T(t,{width:n[0],height:n[1],data:null},r.R8),o.bind(r.LINEAR,r.CLAMP_TO_EDGE),s.createColorAttachment(t,1),s.colorAttachment1.set(o.texture)),s.depthAttachment=new Yi(t,s.framebuffer),void 0===this._sharedDepthStencil?(this._sharedDepthStencil=t.createRenderbuffer(t.gl.DEPTH_STENCIL,n[0],n[1]),this._stencilRef=0,s.depthAttachment.set(this._sharedDepthStencil),t.clear({stencil:0})):s.depthAttachment.set(this._sharedDepthStencil),t.extTextureFilterAnisotropic&&r.texParameterf(r.TEXTURE_2D,t.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,t.extTextureFilterAnisotropicMax),{fb:s,tex:i,emissiveTex:o,dirty:!1}}_updateFBOs(e){if(this._emissiveTexture!==e){for(const t of this.pool)this._updateFBO(t,e);for(const t of this.proxySourceCache.renderCache)this._updateFBO(t,e);this._emissiveTexture=e}}_updateFBO(t,r){const n=t.fb,i=this.painter.context,s=i.gl,o=this.drapeBufferSize;if(r){const r=new e.T(i,{width:o[0],height:o[1],data:null},s.R8);r.bind(s.LINEAR,s.CLAMP_TO_EDGE),t.emissiveTex=r,n.createColorAttachment(i,1),n.colorAttachment1.set(r.texture)}else t.emissiveTex=void 0,n.removeColorAttachment(i,1);t.dirty=!0}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache)return!0;if(this._style.hasLightTransitions())return!0;for(const e in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[e].hasTransition())return!0;return this._style.order.some(e=>{const t=this._style._mergedLayers[e],r=t.isHidden(this.painter.transform.zoom);return"hillshade"===t.type||"custom"===t.type?!r&&t.shouldRedrape():!r&&t.hasTransition()})}_clearLineLayersFromRenderCache(){let t=!1;for(const e of this._style.getSources())if(e instanceof mt){t=!0;break}if(!t)return;const r={};for(let n=0;n<this._style.order.length;++n){const t=this._style._mergedLayers[this._style.order[n]],i=this._style.getLayerSourceCache(t);if(!i||r[i.id])continue;if(t.isHidden(this.painter.transform.zoom)||"line"!==t.type)continue;const s=t.widthExpression(),o=t.emissiveStrengthExpression();if(s instanceof e.ad||o instanceof e.ad){r[i.id]=!0;for(const e of this.proxyCoords){const t=this.proxyToSource[e.key][i.id];if(t)for(const e of t)this._clearRenderCacheForTile(i.id,e)}}}}_clearRasterLayersFromRenderCache(){let e=!1;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r]._source instanceof ft){e=!0;break}if(!e)return;const t={};for(let r=0;r<this._style.order.length;++r){const e=this._style._mergedLayers[this._style.order[r]],n=this._style.getLayerSourceCache(e);if(!n||t[n.id])continue;if(e.isHidden(this.painter.transform.zoom)||"raster"!==e.type)continue;const i=e.paint.get("raster-fade-duration");for(const t of this.proxyCoords){const e=this.proxyToSource[t.key][n.id];if(e)for(const t of e){const e=ss(n.getTile(t),n.findLoadedParent(t,0),n,this.painter.transform,i);(1!==e.opacity||0!==e.mix)&&this._clearRenderCacheForTile(n.id,t)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const t=this._style.order,r=t.length;if(0===r)return;const n=[];this._pendingGroundEffectLayers=[];let i,s=0,o=this._style._mergedLayers[t[s]];for(;!this._style.isLayerDraped(o)&&o.isHidden(this.painter.transform.zoom)&&++s<r;)o=this._style._mergedLayers[t[s]];for(;s<r;++s){const e=this._style._mergedLayers[t[s]];e.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(e)?void 0===i&&(i=s):("fill-extrusion"===e.type&&this._pendingGroundEffectLayers.push(s),void 0!==i&&(n.push({start:i,end:s-1}),i=void 0)))}if(void 0!==i&&n.push({start:i,end:s-1}),0!==n.length){const t=n[n.length-1];this._pendingGroundEffectLayers.every(e=>e>t.end)||e.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=n}_setupRenderCache(e){const t=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,t.renderCache.length>t.renderCachePool.length){const e=Object.values(t.proxyCachedFBO);t.proxyCachedFBO={};for(let r=0;r<e.length;++r){const n=Object.values(e[r]);t.renderCachePool.push(...n)}}return}this._clearRasterLayersFromRenderCache();const r=this.proxyCoords,n=this._tilesDirty;for(let s=r.length-1;s>=0;s--){const i=r[s];if(t.getTileByID(i.key),void 0!==t.proxyCachedFBO[i.key]){const r=e[i.key],s=this.proxyToSource[i.key];let o=0;for(const e in s){const t=s[e],i=r[e];if(!i||i.length!==t.length||t.some((t,r)=>t!==i[r]||n[e]&&n[e].hasOwnProperty(t.key))){o=-1;break}++o}for(const e in t.proxyCachedFBO[i.key])t.renderCache[t.proxyCachedFBO[i.key][e]].dirty=o<0||o!==Object.values(r).length}}const i=[...this._drapedRenderBatches];i.sort((e,t)=>t.end-t.start-(e.end-e.start));for(const s of i)for(const e of r){if(t.proxyCachedFBO[e.key])continue;let r=t.renderCachePool.pop();void 0===r&&t.renderCache.length<50&&(r=t.renderCache.length,t.renderCache.push(this._createFBO())),void 0!==r&&(t.proxyCachedFBO[e.key]={},t.proxyCachedFBO[e.key][s.start]=r,t.renderCache[r].dirty=!0)}this._tilesDirty={}}_setupStencil(e,t,r,n){if(!n||!this._sourceTilesOverlap[n.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const i=this.painter.context,s=i.gl;if(t.length<=1)return void(this._overlapStencilType=!1);let o;if(r.isTileClipped())o=t.length,this._overlapStencilMode.test={func:s.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(t[0].overscaledZ>t[t.length-1].overscaledZ))return void(this._overlapStencilType=!1);o=1,this._overlapStencilMode.test={func:s.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+o>255&&(i.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=o,this._overlapStencilMode.ref=this._stencilRef,r.isTileClipped()&&this._renderTileClippingMasks(t,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return"Clip"===this._overlapStencilType||"Mask"===this._overlapStencilType}stencilModeForRTTOverlap(e){return this.renderingToTexture&&this._overlapStencilType?("Clip"===this._overlapStencilType&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[e.key]),this._overlapStencilMode):en.disabled}_renderTileClippingMasks(e,t){const r=this.painter,n=this.painter.context,i=n.gl;r._tileClippingMaskIDs={},n.setColorMode(Jr.disabled),n.setDepthMode(Qr.disabled);const s=r.getOrCreateProgram("clippingMask");for(const o of e){const e=r._tileClippingMaskIDs[o.key]=--t;s.draw(r,i.TRIANGLES,Qr.disabled,new en({func:i.ALWAYS,mask:0},e,255,i.KEEP,i.KEEP,i.REPLACE),Jr.disabled,nn.disabled,is(o.projMatrix),"$clipping",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments)}}pointCoordinate(t){const r=this.painter.transform;if(t.x<0||t.x>r.width||t.y<0||t.y>r.height)return null;const n=[t.x,t.y,1,1];e.aC(n,n,r.pixelMatrixInverse),e.cK(n,n,1/n[3]),n[0]/=r.worldSize,n[1]/=r.worldSize;const i=r._camera.position,s=e.cf(1,r.center.lat),o=[i[0],i[1],i[2]/s,0],a=e.da([],n.slice(0,3),o);e.aw(a,a);const l=this.raycast(o,a,this._exaggeration);return null!==l&&l?(e.bH(o,o,a,l),o[3]=o[2],o[2]*=s,o):null}_setupProxiedCoordsForOrtho(t,r,n){if(t.getSource()instanceof e.aU)return this._setupProxiedCoordsForImageSource(t,r,n);this._findCoveringTileCache[t.id]=this._findCoveringTileCache[t.id]||{};const i=this.proxiedCoords[t.id]=[],s=this.proxyCoords;for(let e=0;e<s.length;e++){const r=s[e],o=this._findTileCoveringTileID(r,t);if(o){const e=this._createProxiedId(r,o,n[r.key]&&n[r.key][t.id]);i.push(e),this.proxyToSource[r.key][t.id]=[e]}}let o=!1;const a=new Set;for(let e=0;e<r.length;e++){const s=t.getTile(r[e]);if(!s||!s.hasData())continue;const l=this._findTileCoveringTileID(s.tileID,this.proxySourceCache);if(l&&l.tileID.canonical.z!==s.tileID.canonical.z){const e=this.proxyToSource[l.tileID.key][t.id],r=this._createProxiedId(l.tileID,s,n[l.tileID.key]&&n[l.tileID.key][t.id]);e?e.splice(e.length-1,0,r):this.proxyToSource[l.tileID.key][t.id]=[r];const c=this.proxyToSource[l.tileID.key][t.id];a.has(c)||a.add(c),i.push(r),o=!0}}if(this._sourceTilesOverlap[t.id]=o,o&&this._debugParams.sortTilesHiZFirst)for(const e of a)e.sort((e,t)=>t.overscaledZ-e.overscaledZ)}_setupProxiedCoordsForImageSource(t,r,n){if(!t.getSource().loaded())return;const i=this.proxiedCoords[t.id]=[],s=this.proxyCoords,o=t.getSource(),a=o.tileID;if(!a)return;const l=new e.P(a.x,a.y)._div(1<<a.z),c=o.coordinates.map(e.ae.fromLngLat).reduce((e,t)=>(e.min.x=Math.min(e.min.x,t.x-l.x),e.min.y=Math.min(e.min.y,t.y-l.y),e.max.x=Math.max(e.max.x,t.x-l.x),e.max.y=Math.max(e.max.y,t.y-l.y),e),{min:new e.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new e.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),u=(t,r)=>{const n=t.wrap+t.canonical.x/(1<<t.canonical.z),i=t.canonical.y/(1<<t.canonical.z),s=e.al/(1<<t.canonical.z),o=r.wrap+r.canonical.x/(1<<r.canonical.z),a=r.canonical.y/(1<<r.canonical.z);return n+s<o+c.min.x||n>o+c.max.x||i+s<a+c.min.y||i>a+c.max.y};for(let e=0;e<s.length;e++){const o=s[e];for(let e=0;e<r.length;e++){const s=t.getTile(r[e]);if(!s||!s.hasData())continue;if(u(o,s.tileID))continue;const a=this._createProxiedId(o,s,n[o.key]&&n[o.key][t.id]),l=this.proxyToSource[o.key][t.id];l?l.push(a):this.proxyToSource[o.key][t.id]=[a],i.push(a)}}}_createProxiedId(t,r,n){let i=this.orthoMatrix;if(n){const e=n.find(e=>e.key===r.tileID.key);if(e)return e}if(r.tileID.key!==t.key){const n=t.canonical.z-r.tileID.canonical.z;let s,o,a;i=e.bC();const l=r.tileID.wrap-t.wrap<<t.overscaledZ;n>0?(s=e.al>>n,o=s*((r.tileID.canonical.x<<n)-t.canonical.x+l),a=s*((r.tileID.canonical.y<<n)-t.canonical.y)):(s=e.al<<-n,o=e.al*(r.tileID.canonical.x-(t.canonical.x+l<<-n)),a=e.al*(r.tileID.canonical.y-(t.canonical.y<<-n))),e.ce(i,0,s,0,s,0,1),e.br(i,i,[o,a,0])}return new ls(r.tileID,t.key,i)}_findTileCoveringTileID(t,r){let n=r.getTile(t);if(n&&n.hasData())return n;const i=this._findCoveringTileCache[r.id],s=i[t.key];if(n=s?r.getTileByID(s):null,n&&n.hasData()||null===s)return n;let o=n?n.tileID:t,a=o.overscaledZ;const l=r.getSource().minzoom,c=[];if(!s){const i=r.getSource().maxzoom;if(t.canonical.z>=i){const n=t.canonical.z-i;r.getSource().reparseOverscaled?(a=Math.max(t.canonical.z+2,r.transform.tileZoom),o=new e.aQ(a,t.wrap,i,t.canonical.x>>n,t.canonical.y>>n)):0!==n&&(a=i,o=new e.aQ(a,t.wrap,i,t.canonical.x>>n,t.canonical.y>>n))}o.key!==t.key&&(c.push(o.key),n=r.getTile(o))}const u=e=>{c.forEach(t=>{i[t]=e}),c.length=0};for(a-=1;a>=l&&(!n||!n.hasData());a--){n&&u(n.tileID.key);const e=o.calculateScaledKey(a);if(n=r.getTileByID(e),n&&n.hasData())break;const t=i[e];if(null===t)break;void 0===t?c.push(e):n=r.getTileByID(t)}return u(n?n.tileID.key:null),n&&n.hasData()?n:null}findDEMTileFor(e){return this.enabled?this._findTileCoveringTileID(e,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(e,t){let r=this._tilesDirty[e];r||(r=this._tilesDirty[e]={}),r[t.key]=!0}}function us(t,r,n){const i=function(t,r,n){const i=e.bJ(r,t),s=e.bJ(n,[.2126,.7152,.0722]),o=(e,t,r)=>(1-r)*e+r*t,a=o(1-.3*Math.min(s,1),1,Math.min(i+1,1));return o(.92,1,Math.asin(e.aA(r[2],-1,1))/Math.PI+.5)*a}(t,[0,0,1],r),s=[0,0,0];e.c5(s,n.slice(0,3),i);const o=[0,0,0];e.c5(o,r.slice(0,3),t[2]);const a=[0,0,0];return e.d8(a,s,o),e.db(a)}const ds=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],hs=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","building","buildingBloom","elevatedStructures","model","symbol"];class ps{static cacheKey(e,t,r,n){const i=[t];n&&i.push(n.cacheKey);for(const s of r)e.usedDefines.has(s)&&i.push(s);return i.join("/")}constructor(t,r,n,i,s,o){const a=t.gl;this.program=a.createProgram(),this.configuration=i,this.name=r,this.fixedDefines=[...o];const l="#version 300 es\n".concat((i?i.defines():[]).concat(o.map(e=>"#define ".concat(e))).join("\n")),c=[l,ni];for(const e of n.fragmentIncludes)c.push($n[e]);c.push(n.fragmentSource);const u=c.join("\n"),d=[l,ii];for(const e of n.vertexIncludes)d.push($n[e]);this.forceManualRenderingForInstanceIDShaders=t.forceManualRenderingForInstanceIDShaders&&n.vertexSource.includes("gl_InstanceID"),this.forceManualRenderingForInstanceIDShaders&&d.push("uniform int u_instanceID;"),d.push(n.vertexSource);let h=d.join("\n");this.forceManualRenderingForInstanceIDShaders&&(h=h.replaceAll("gl_InstanceID","u_instanceID"));const p=a.createShader(a.FRAGMENT_SHADER);if(a.isContextLost())return void(this.failedToCreate=!0);a.shaderSource(p,u),a.compileShader(p),a.attachShader(this.program,p);const m=a.createShader(a.VERTEX_SHADER);a.isContextLost()?this.failedToCreate=!0:(a.shaderSource(m,h),a.compileShader(m),a.attachShader(this.program,m),this.attributes={},a.linkProgram(this.program),a.deleteShader(m),a.deleteShader(p),this.fixedUniforms=s(t),this.fixedUniformsEntries=Object.entries(this.fixedUniforms),this.binderUniforms=i?i.getUniforms(t):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(t=>({u_instanceID:new e.ch(t)}))(t)),(o.includes("TERRAIN")||r.includes("symbol")||r.includes("circle"))&&(this.terrainUniforms=(t=>({u_dem:new e.ch(t),u_dem_prev:new e.ch(t),u_dem_tl:new e.ck(t),u_dem_scale:new e.cj(t),u_dem_tl_prev:new e.ck(t),u_dem_scale_prev:new e.cj(t),u_dem_size:new e.cj(t),u_dem_lerp:new e.cj(t),u_exaggeration:new e.cj(t),u_depth:new e.ch(t),u_depth_size_inv:new e.ck(t),u_depth_range_unpack:new e.ck(t),u_occluder_half_size:new e.cj(t),u_occlusion_depth_offset:new e.cj(t),u_meter_to_dem:new e.cj(t),u_label_plane_matrix_inv:new e.cl(t)}))(t)),o.includes("GLOBE")&&(this.globeUniforms=(t=>({u_tile_tl_up:new e.ci(t),u_tile_tr_up:new e.ci(t),u_tile_br_up:new e.ci(t),u_tile_bl_up:new e.ci(t),u_tile_up_scale:new e.cj(t)}))(t)),o.includes("FOG")&&(this.fogUniforms=(t=>({u_fog_matrix:new e.cl(t),u_fog_range:new e.ck(t),u_fog_color:new e.d3(t),u_fog_horizon_blend:new e.cj(t),u_fog_vertical_limit:new e.ck(t),u_fog_temporal_offset:new e.cj(t),u_frustum_tl:new e.ci(t),u_frustum_tr:new e.ci(t),u_frustum_br:new e.ci(t),u_frustum_bl:new e.ci(t),u_globe_pos:new e.ci(t),u_globe_radius:new e.cj(t),u_globe_transition:new e.cj(t),u_is_globe:new e.ch(t),u_viewport:new e.ck(t)}))(t)),o.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(t=>({u_cutoff_params:new e.d3(t)}))(t)),o.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(t=>({u_lighting_ambient_color:new e.ci(t),u_lighting_directional_dir:new e.ci(t),u_lighting_directional_color:new e.ci(t),u_ground_radiance:new e.ci(t)}))(t)),o.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(t=>({u_light_matrix_0:new e.cl(t),u_light_matrix_1:new e.cl(t),u_fade_range:new e.ck(t),u_shadow_normal_offset:new e.ci(t),u_shadow_intensity:new e.cj(t),u_shadow_texel_size:new e.cj(t),u_shadow_map_resolution:new e.cj(t),u_shadow_direction:new e.ci(t),u_shadow_bias:new e.ci(t),u_shadowmap_0:new e.ch(t),u_shadowmap_1:new e.ch(t)}))(t)))}getAttributeLocation(e,t){let r=this.attributes[t];return void 0===r&&(r=this.attributes[t]=e.getAttribLocation(this.program,t)),r}setTerrainUniformValues(e,t){if(!this.terrainUniforms)return;const r=this.terrainUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setGlobeUniformValues(e,t){if(!this.globeUniforms)return;const r=this.globeUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e]&&r[e].set(this.program,e,t[e])}}setFogUniformValues(e,t){if(!this.fogUniforms)return;const r=this.fogUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setCutoffUniformValues(e,t){if(!this.cutoffUniforms)return;const r=this.cutoffUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setLightsUniformValues(e,t){if(!this.lightsUniforms)return;const r=this.lightsUniforms;if(!this.failedToCreate){e.program.set(this.program);for(const e in t)r[e].set(this.program,e,t[e])}}setShadowUniformValues(e,t){if(this.failedToCreate||!this.shadowUniforms)return;const r=this.shadowUniforms;e.program.set(this.program);for(const n in t)r[n].set(this.program,n,t[n])}_drawDebugWireframe(t,r,n,i,s,o,a,l,c,u){const d=t.options.wireframe;if(!1===d.terrain&&!1===d.layers2D&&!1===d.layers3D)return;const h=t.context;if(!(()=>!(!d.terrain||"terrainRaster"!==this.name&&"globeRaster"!==this.name)||!(!d.layers2D||t._terrain&&t._terrain.renderingToTexture||!ds.includes(this.name))||!(!d.layers3D||!hs.includes(this.name)))())return;const p=h.gl,m=t.wireframeDebugCache.getLinesFromTrianglesBuffer(t.frameCounter,s,h);if(!m)return;const f=[...this.fixedDefines,"DEBUG_WIREFRAME"],g=t.getOrCreateProgram(this.name,{config:this.configuration,defines:f});h.program.set(g.program);const y=(e,t,r)=>{if(t[e]&&r[e])for(const n in t[e])r[e][n]&&r[e][n].set(r.program,n,t[e][n].current)};c&&c.setUniforms(g.program,h,g.binderUniforms,a,{zoom:l}),y("fixedUniforms",this,g),y("terrainUniforms",this,g),y("globeUniforms",this,g),y("fogUniforms",this,g),y("lightsUniforms",this,g),y("shadowUniforms",this,g),m.bind(),h.setColorMode(new Jr([p.ONE,p.ONE_MINUS_SRC_ALPHA,p.ZERO,p.ONE],e.ao.transparent,[!0,!0,!0,!1])),h.setDepthMode(new Qr(r.func===p.LESS?p.LEQUAL:r.func,Qr.ReadOnly,r.range)),h.setStencilMode(en.disabled);const _=3*o.primitiveLength*2,v=3*o.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const e=u||1;for(let t=0;t<e;++t)g.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",t),p.drawElements(p.LINES,_,p.UNSIGNED_SHORT,v)}else u&&u>1?p.drawElementsInstanced(p.LINES,_,p.UNSIGNED_SHORT,v,u):p.drawElements(p.LINES,_,p.UNSIGNED_SHORT,v);s.bind(),h.program.set(this.program),h.setDepthMode(r),h.setStencilMode(n),h.setColorMode(i)}checkUniforms(e,t,r){if(this.fixedDefines.includes(t))for(const n of Object.keys(r))if(!r[n].initialized)throw new Error("Program '".concat(this.name,"', from draw '").concat(e,"': uniform ").concat(n," not set but required by ").concat(t," being defined"))}draw(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f){const g=e.context,y=g.gl;if(this.failedToCreate)return;g.program.set(this.program),g.setDepthMode(r),g.setStencilMode(n),g.setColorMode(i),g.setCullFace(s);for(const[j,S]of this.fixedUniformsEntries)S.set(this.program,j,o[j]);p&&p.setUniforms(this.program,g,this.binderUniforms,d,{zoom:h});const _={[y.POINTS]:1,[y.LINES]:2,[y.TRIANGLES]:3,[y.LINE_STRIP]:1}[t];this.checkUniforms(a,"RENDER_SHADOWS",this.shadowUniforms);const v=m||[],x=p?p.getPaintVertexBuffers():[],b=t===y.TRIANGLES&&c,w=f&&f>0?1:void 0;for(const j of u.get()){const s=j.vaos||(j.vaos={});if((s[a]||(s[a]=new li)).bind(g,this,l,x,c,j.vertexOffset,v,w),this.forceManualRenderingForInstanceIDShaders){const e=f||1;for(let r=0;r<e;++r)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",r),c?y.drawElements(t,j.primitiveLength*_,y.UNSIGNED_SHORT,j.primitiveOffset*_*2):y.drawArrays(t,j.vertexOffset,j.vertexLength)}else f&&f>1?y.drawElementsInstanced(t,j.primitiveLength*_,y.UNSIGNED_SHORT,j.primitiveOffset*_*2,f):c?y.drawElements(t,j.primitiveLength*_,y.UNSIGNED_SHORT,j.primitiveOffset*_*2):y.drawArrays(t,j.vertexOffset,j.vertexLength);b&&this._drawDebugWireframe(e,r,n,i,c,j,d,h,p,f)}}}function ms(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;const i=Math.pow(2,r.tileID.overscaledZ),s=r.tileSize*Math.pow(2,t.transform.tileZoom)/i,o=s*(r.tileID.canonical.x+r.tileID.wrap*i),a=s*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/e.ay(r,1,t.transform.tileZoom),u_pixel_coord_upper:[o>>16,a>>16],u_pixel_coord_lower:[65535&o,65535&a],u_pattern_transition:n}}const fs={terrain:0,flat:1},gs=e.bC(),ys=(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_)=>{const v=r.style.light,x=v.properties.get("position"),b=[x.x,x.y,x.z],w=e.dO();"viewport"===v.properties.get("anchor")&&(e.dP(w,-r.transform.angle),e.dQ(b,b,w));const j=v.properties.get("color").toPremultipliedRenderColor(null),S=r.transform,T={u_matrix:t,u_lightpos:b,u_lightintensity:v.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_vertical_gradient:+n,u_opacity:i,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:gs,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:fs[u],u_base_type:fs[d],u_ao:s,u_edge_radius:o,u_width_scale:a,u_flood_light_color:f,u_vertical_scale:g,u_flood_light_intensity:y,u_ground_shadow_factor:_};return"globe"===S.projection.name&&(T.u_tile_id=[l.canonical.x,l.canonical.y,1<<l.canonical.z],T.u_zoom_transition=h,T.u_inv_rot_matrix=m,T.u_merc_center=p,T.u_up_dir=S.projection.upVector(new e.cD(0,0,0),p[0]*e.al,p[1]*e.al),T.u_height_lift=c),T},_s=(e,t,r,n,i,s)=>({u_matrix:e,u_edge_radius:t,u_width_scale:r,u_vertical_scale:n,u_height_type:fs[i],u_base_type:fs[s]}),vs=(e,t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y)=>{const _=ys(e,t,r,n,i,s,o,a,c,u,d,h,p,m,f,g,1,[0,0,0]),v={u_height_factor:-Math.pow(2,a.overscaledZ)/l.tileSize/8};return Object.assign(_,ms(t,l,y),v)},xs=(e,t,r,n,i,s,o,a,l,c,u)=>({u_matrix:t,u_opacity:r,u_ao_pass:n?1:0,u_meter_to_tile:i,u_ao:s,u_flood_light_intensity:o,u_flood_light_color:a,u_attenuation:l,u_edge_radius:c,u_fb:0,u_fb_size:u,u_dynamic_offset:1}),bs=(e,t,r)=>({u_matrix:e,u_emissive_strength:t,u_ground_shadow_factor:r}),ws=function(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:0;return Object.assign(bs(e,t,i),ms(r,n,s))},js=(e,t,r,n)=>({u_matrix:e,u_world:r,u_emissive_strength:t,u_ground_shadow_factor:n}),Ss=function(e,t,r,n,i,s){let o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:0;return Object.assign(ws(e,t,r,n,s,o),{u_world:i})},Ts=(e,t)=>({u_matrix:e,u_ground_shadow_factor:t}),ks=(e,t,r,n,i)=>({u_matrix:e,u_camera_pos:[t[0],t[1],t[2]],u_depth_bias:r,u_height_scale:n,u_reset_depth:i}),As=(e,t,r,n,i,s,o,a,l)=>({u_matrix:e,u_normal_matrix:t,u_opacity:r,u_faux_facade_ao_intensity:n,u_camera_pos:i,u_tile_to_meter:s,u_facade_emissive_chance:o,u_flood_light_color:a,u_flood_light_intensity:l}),Cs=e=>({u_matrix:e}),Es=e=>({u_matrix:e}),Ns=(t,r,n,i,s,o,a,l)=>{const c=e.al/o.tileSize;return{u_matrix:t,u_inv_rot_matrix:r,u_camera_to_center_distance:n.getCameraToCenterDistance(l),u_extrude_scale:[n.pixelsToGLUnits[0]/c,n.pixelsToGLUnits[1]/c],u_zoom_transition:i,u_tile_id:a,u_merc_center:s}},Is=function(e,t){return{u_matrix:e,u_color:t,u_overlay:0,u_overlay_scale:arguments.length>2&&void 0!==arguments[2]?arguments[2]:1}},Ps=e.bC(),Ms=(t,r,n,i,s,o,a)=>{const l=t.transform,c="globe"===l.projection.name,u=c?e.dR(l.zoom,r.canonical)*l._pixelsPerMercatorPixel:e.ay(n,1,o),d={u_matrix:r.projMatrix,u_extrude_scale:u,u_intensity:a,u_inv_rot_matrix:Ps,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(c){d.u_inv_rot_matrix=i,d.u_merc_center=s,d.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],d.u_zoom_transition=e.aj(l.zoom);const t=s[0]*e.al,n=s[1]*e.al;d.u_up_dir=l.projection.upVector(new e.cD(0,0,0),t,n)}return d};function Ls(e,t,r){let[n,i,s,o]=t,[a,l]=r;if(a===l)return[0,0,0,0];const c=255*(e-1)/(e*(l-a));return[n*c,i*c,s*c,o*c]}function Rs(e,t,r){let[n,i]=r;return n===i?0:.5/e+(t-n)*(e-1)/(e*(i-n))}const Ds=(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b)=>({u_matrix:t,u_normalize_matrix:r,u_globe_matrix:n,u_merc_matrix:i,u_grid_matrix:s,u_tl_parent:o,u_scale_parent:u,u_fade_t:d.mix,u_opacity:d.opacity*h.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:h.paint.get("raster-brightness-min"),u_brightness_high:h.paint.get("raster-brightness-max"),u_saturation_factor:e.dT(h.paint.get("raster-saturation")),u_contrast_factor:e.dS(h.paint.get("raster-contrast")),u_spin_weights:Fs(h.paint.get("raster-hue-rotate")),u_perspective_transform:p,u_raster_elevation:m,u_zoom_transition:a,u_merc_center:l,u_cutoff_params:c,u_colorization_mix:Ls(e.dU,g,_),u_colorization_offset:Rs(e.dU,y,_),u_color_ramp:f,u_texture_offset:[x/(v+2*x),v/(v+2*x)],u_texture_res:[v+2*x,v+2*x],u_emissive_strength:b});function Fs(e){e*=Math.PI/180;const t=Math.sin(e),r=Math.cos(e);return[(2*r+1)/3,(-Math.sqrt(3)*t-r+1)/3,(Math.sqrt(3)*t-r+1)/3]}const Os=.05,zs=(e,t,r,n,i,s,o,a,l,c,u,d)=>({u_matrix:e,u_normalize_matrix:t,u_globe_matrix:r,u_merc_matrix:n,u_grid_matrix:i,u_tl_parent:s,u_scale_parent:c,u_fade_t:u.mix,u_opacity:u.opacity,u_image0:0,u_image1:1,u_raster_elevation:d,u_zoom_transition:o,u_merc_center:a,u_cutoff_params:l}),Bs=(e,t,r,n,i,s,o,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_tile_offset:r,u_velocity:n,u_color_ramp:s,u_velocity_res:i,u_max_speed:o,u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[Os,Os]}),Us=(e,t,r,n,i,s,o,a,l,c)=>({u_particle_texture:e,u_particle_texture_side_len:t,u_velocity:r,u_velocity_res:n,u_max_speed:i,u_speed_factor:s,u_reset_rate:o,u_rand_seed:Math.random(),u_uv_offset:a,u_data_scale:[255*l[0],255*l[1]],u_data_offset:c,u_particle_pos_scale:1.1,u_particle_pos_offset:[Os,Os]}),Vs=e.bC(),qs=(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x,b,w,j,S)=>{const T=s.transform,k={u_is_size_zoom_constant:+("constant"===t||"source"===t),u_is_size_feature_constant:+("constant"===t||"camera"===t),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:T.getCameraToCenterDistance(v),u_rotate_symbol:+n,u_aspect_ratio:T.width/T.height,u_fade_change:s.options.fadeDuration?s.symbolFadeChange:1,u_matrix:o,u_label_plane_matrix:a,u_coord_matrix:l,u_is_text:+u,u_elevation_from_sea:c?1:0,u_pitch_with_map:+i,u_texsize:d,u_texsize_icon:h,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Vs,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:Vs,u_up_vector:[0,-1,0],u_color_adj_mat:w,u_icon_transition:j||0,u_gamma_scale:i?s.transform.getCameraToCenterDistance(v)*Math.cos(s.terrain?0:s.transform._pitch):1,u_device_pixel_ratio:e.o.devicePixelRatio,u_is_halo:1,u_scale_factor:S||1,u_ground_shadow_factor:x,u_inv_matrix:e.bl(e.bC(),a),u_normal_scale:b,u_lutTexture:un.LUT};return"globe"===v.name&&(k.u_tile_id=[m.canonical.x,m.canonical.y,1<<m.canonical.z],k.u_zoom_transition=f,k.u_inv_rot_matrix=y,k.u_merc_center=g,k.u_camera_forward=T._camera.forward(),k.u_ecef_origin=e.dV(T.globeMatrix,m.toUnwrapped()),k.u_tile_matrix=Float32Array.from(T.globeMatrix),k.u_up_vector=_),k},Ws=(e,t,r,n)=>({u_matrix:e,u_emissive_strength:t,u_opacity:r,u_color:n}),Hs=(t,r,n,i,s,o,a,l,c)=>Object.assign(function(t,r,n,i,s,o){const{width:a,height:l}=i.imageManager.getPixelSize(r),c=Math.pow(2,o.tileID.overscaledZ),u=o.tileSize*Math.pow(2,i.transform.tileZoom)/c,d=u*(o.tileID.canonical.x+o.tileID.wrap*c),h=u*o.tileID.canonical.y;return{u_image:0,u_pattern_tl:n.tl,u_pattern_br:n.br,u_texsize:[a,l],u_pattern_size:n.displaySize,u_pattern_units_to_pixels:s?[i.transform.width,-1*i.transform.height]:[1/e.ay(o,1,i.transform.tileZoom),1/e.ay(o,1,i.transform.tileZoom)],u_pixel_coord_upper:[d>>16,h>>16],u_pixel_coord_lower:[65535&d,65535&h]}}(0,o,a,i,l,c),{u_matrix:t,u_emissive_strength:r,u_opacity:n}),Gs=new Float32Array(e.bA([])),Zs=function(t,r,n,i,s,o,a,l,c,u,d,h,p){let m=arguments.length>13&&void 0!==arguments[13]?arguments[13]:[0,0,0],f=arguments.length>14?arguments[14]:void 0,g=arguments.length>15?arguments[15]:void 0,y=arguments.length>16?arguments[16]:void 0;const _=s.style.light,v=_.properties.get("position"),x=[-v.x,-v.y,v.z],b=e.dO();"viewport"===_.properties.get("anchor")&&(e.dP(b,-s.transform.angle),e.dQ(x,x,b));const w="MASK"===d.alphaMode,j=_.properties.get("color").toNonPremultipliedRenderColor(null),S=p.paint.get("model-ambient-occlusion-intensity"),T=p.paint.get("model-color").constantOr(e.ao.white).toNonPremultipliedRenderColor(null);return T.a=p.paint.get("model-color-mix-intensity").constantOr(0),y&&(T.r=y[0],T.g=y[1],T.b=y[2],T.a=y[3]),g&&(T.r=g.color.r,T.g=g.color.g,T.b=g.color.b,T.a=g.colorMix,h=g.emissionStrength,o*=g.opacity),{u_matrix:t,u_lighting_matrix:r,u_normal_matrix:n,u_node_matrix:i||Gs,u_lightpos:x,u_lightintensity:_.properties.get("intensity"),u_lightcolor:[j.r,j.g,j.b],u_camera_pos:m,u_opacity:o,u_baseTextureIsAlpha:0,u_alphaMask:+w,u_alphaCutoff:d.alphaCutoff,u_baseColorFactor:a.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:l.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:c,u_roughnessFactor:u,u_baseColorTexture:un.BaseColor,u_metallicRoughnessTexture:un.MetallicRoughness,u_normalTexture:un.Normal,u_occlusionTexture:un.Occlusion,u_emissionTexture:un.Emission,u_lutTexture:un.LUT,u_color_mix:T.toArray01(),u_aoIntensity:S,u_emissive_strength:h,u_occlusionTextureTransform:f||[0,0,0,0]}},Ks=function(e){return{u_matrix:e,u_instance:arguments.length>1&&void 0!==arguments[1]?arguments[1]:Gs,u_node_matrix:arguments.length>2&&void 0!==arguments[2]?arguments[2]:Gs}},Ys={fillExtrusion:t=>({u_matrix:new e.cl(t),u_lightpos:new e.ci(t),u_lightintensity:new e.cj(t),u_lightcolor:new e.ci(t),u_vertical_gradient:new e.cj(t),u_opacity:new e.cj(t),u_edge_radius:new e.cj(t),u_width_scale:new e.cj(t),u_ao:new e.ck(t),u_height_type:new e.ch(t),u_base_type:new e.ch(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_up_dir:new e.ci(t),u_height_lift:new e.cj(t),u_flood_light_color:new e.ci(t),u_vertical_scale:new e.cj(t),u_flood_light_intensity:new e.cj(t),u_ground_shadow_factor:new e.ci(t)}),fillExtrusionDepth:t=>({u_matrix:new e.cl(t),u_edge_radius:new e.cj(t),u_width_scale:new e.cj(t),u_vertical_scale:new e.cj(t),u_height_type:new e.ch(t),u_base_type:new e.ch(t)}),fillExtrusionPattern:t=>({u_matrix:new e.cl(t),u_lightpos:new e.ci(t),u_lightintensity:new e.cj(t),u_lightcolor:new e.ci(t),u_vertical_gradient:new e.cj(t),u_height_factor:new e.cj(t),u_edge_radius:new e.cj(t),u_width_scale:new e.cj(t),u_ao:new e.ck(t),u_height_type:new e.ch(t),u_base_type:new e.ch(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_up_dir:new e.ci(t),u_height_lift:new e.cj(t),u_image:new e.ch(t),u_texsize:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_tile_units_to_pixels:new e.cj(t),u_opacity:new e.cj(t),u_pattern_transition:new e.cj(t)}),fillExtrusionGroundEffect:t=>({u_matrix:new e.cl(t),u_opacity:new e.cj(t),u_ao_pass:new e.cj(t),u_meter_to_tile:new e.cj(t),u_ao:new e.ck(t),u_flood_light_intensity:new e.cj(t),u_flood_light_color:new e.ci(t),u_attenuation:new e.cj(t),u_edge_radius:new e.cj(t),u_fb:new e.ch(t),u_fb_size:new e.cj(t),u_dynamic_offset:new e.cj(t)}),fill:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_ground_shadow_factor:new e.ci(t)}),fillPattern:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_image:new e.ch(t),u_texsize:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_tile_units_to_pixels:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_pattern_transition:new e.cj(t)}),fillOutline:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_world:new e.ck(t),u_ground_shadow_factor:new e.ci(t)}),fillOutlinePattern:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_world:new e.ck(t),u_image:new e.ch(t),u_texsize:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_tile_units_to_pixels:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_pattern_transition:new e.cj(t)}),building:t=>({u_matrix:new e.cl(t),u_normal_matrix:new e.cl(t),u_opacity:new e.cj(t),u_faux_facade_ao_intensity:new e.cj(t),u_camera_pos:new e.ci(t),u_tile_to_meter:new e.cj(t),u_facade_emissive_chance:new e.cj(t),u_flood_light_color:new e.ci(t),u_flood_light_intensity:new e.cj(t)}),buildingBloom:t=>({u_matrix:new e.cl(t)}),buildingDepth:t=>({u_matrix:new e.cl(t)}),elevatedStructuresDepth:t=>({u_matrix:new e.cl(t),u_depth_bias:new e.cj(t)}),elevatedStructures:t=>({u_matrix:new e.cl(t),u_ground_shadow_factor:new e.ci(t)}),elevatedStructuresDepthReconstruct:t=>({u_matrix:new e.cl(t),u_camera_pos:new e.ci(t),u_depth_bias:new e.cj(t),u_height_scale:new e.cj(t),u_reset_depth:new e.cj(t)}),circle:e.dY,collisionBox:t=>({u_matrix:new e.cl(t),u_inv_rot_matrix:new e.cl(t),u_camera_to_center_distance:new e.cj(t),u_extrude_scale:new e.ck(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_tile_id:new e.ci(t)}),collisionCircle:t=>({u_matrix:new e.cl(t),u_inv_matrix:new e.cl(t),u_camera_to_center_distance:new e.cj(t),u_viewport_size:new e.ck(t)}),debug:t=>({u_color:new e.dB(t),u_matrix:new e.cl(t),u_overlay:new e.ch(t),u_overlay_scale:new e.cj(t)}),clippingMask:t=>({u_matrix:new e.cl(t)}),heatmap:t=>({u_extrude_scale:new e.cj(t),u_intensity:new e.cj(t),u_matrix:new e.cl(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_up_dir:new e.ci(t)}),heatmapTexture:t=>({u_image:new e.ch(t),u_color_ramp:new e.ch(t),u_opacity:new e.cj(t)}),hillshade:t=>({u_matrix:new e.cl(t),u_image:new e.ch(t),u_latrange:new e.ck(t),u_light:new e.ck(t),u_shadow:new e.dB(t),u_highlight:new e.dB(t),u_emissive_strength:new e.cj(t),u_accent:new e.dB(t)}),hillshadePrepare:t=>({u_matrix:new e.cl(t),u_image:new e.ch(t),u_dimension:new e.ck(t),u_zoom:new e.cj(t)}),line:e.dX,linePattern:e.dW,raster:t=>({u_matrix:new e.cl(t),u_normalize_matrix:new e.cl(t),u_globe_matrix:new e.cl(t),u_merc_matrix:new e.cl(t),u_grid_matrix:new e.dC(t),u_tl_parent:new e.ck(t),u_scale_parent:new e.cj(t),u_fade_t:new e.cj(t),u_opacity:new e.cj(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_brightness_low:new e.cj(t),u_brightness_high:new e.cj(t),u_saturation_factor:new e.cj(t),u_contrast_factor:new e.cj(t),u_spin_weights:new e.ci(t),u_perspective_transform:new e.ck(t),u_raster_elevation:new e.cj(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_cutoff_params:new e.d3(t),u_colorization_mix:new e.d3(t),u_colorization_offset:new e.cj(t),u_color_ramp:new e.ch(t),u_texture_offset:new e.ck(t),u_texture_res:new e.ck(t),u_emissive_strength:new e.cj(t)}),rasterParticle:t=>({u_matrix:new e.cl(t),u_normalize_matrix:new e.cl(t),u_globe_matrix:new e.cl(t),u_merc_matrix:new e.cl(t),u_grid_matrix:new e.dC(t),u_tl_parent:new e.ck(t),u_scale_parent:new e.cj(t),u_fade_t:new e.cj(t),u_opacity:new e.cj(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_raster_elevation:new e.cj(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_cutoff_params:new e.d3(t)}),rasterParticleTexture:t=>({u_texture:new e.ch(t),u_opacity:new e.cj(t)}),rasterParticleDraw:t=>({u_particle_texture:new e.ch(t),u_particle_texture_side_len:new e.cj(t),u_tile_offset:new e.ck(t),u_velocity:new e.ch(t),u_color_ramp:new e.ch(t),u_velocity_res:new e.ck(t),u_max_speed:new e.cj(t),u_uv_offset:new e.ck(t),u_data_scale:new e.ck(t),u_data_offset:new e.cj(t),u_particle_pos_scale:new e.cj(t),u_particle_pos_offset:new e.ck(t)}),rasterParticleUpdate:t=>({u_particle_texture:new e.ch(t),u_particle_texture_side_len:new e.cj(t),u_velocity:new e.ch(t),u_velocity_res:new e.ck(t),u_max_speed:new e.cj(t),u_speed_factor:new e.cj(t),u_reset_rate:new e.cj(t),u_rand_seed:new e.cj(t),u_uv_offset:new e.ck(t),u_data_scale:new e.ck(t),u_data_offset:new e.cj(t),u_particle_pos_scale:new e.cj(t),u_particle_pos_offset:new e.ck(t)}),symbol:t=>({u_is_size_zoom_constant:new e.ch(t),u_is_size_feature_constant:new e.ch(t),u_size_t:new e.cj(t),u_size:new e.cj(t),u_camera_to_center_distance:new e.cj(t),u_rotate_symbol:new e.ch(t),u_aspect_ratio:new e.cj(t),u_fade_change:new e.cj(t),u_matrix:new e.cl(t),u_label_plane_matrix:new e.cl(t),u_coord_matrix:new e.cl(t),u_is_text:new e.ch(t),u_elevation_from_sea:new e.ch(t),u_pitch_with_map:new e.ch(t),u_texsize:new e.ck(t),u_texsize_icon:new e.ck(t),u_texture:new e.ch(t),u_texture_icon:new e.ch(t),u_gamma_scale:new e.cj(t),u_device_pixel_ratio:new e.cj(t),u_tile_id:new e.ci(t),u_zoom_transition:new e.cj(t),u_inv_rot_matrix:new e.cl(t),u_merc_center:new e.ck(t),u_camera_forward:new e.ci(t),u_tile_matrix:new e.cl(t),u_up_vector:new e.ci(t),u_ecef_origin:new e.ci(t),u_is_halo:new e.ch(t),u_icon_transition:new e.cj(t),u_color_adj_mat:new e.cl(t),u_scale_factor:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_inv_matrix:new e.cl(t),u_normal_scale:new e.cj(t),u_lutTexture:new e.ch(t)}),background:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_opacity:new e.cj(t),u_color:new e.dB(t)}),backgroundPattern:t=>({u_matrix:new e.cl(t),u_emissive_strength:new e.cj(t),u_opacity:new e.cj(t),u_image:new e.ch(t),u_pattern_tl:new e.ck(t),u_pattern_br:new e.ck(t),u_texsize:new e.ck(t),u_pattern_size:new e.ck(t),u_pixel_coord_upper:new e.ck(t),u_pixel_coord_lower:new e.ck(t),u_pattern_units_to_pixels:new e.ck(t)}),terrainRaster:t=>({u_matrix:new e.cl(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_skirt_height:new e.cj(t),u_ground_shadow_factor:new e.ci(t),u_emissive_texture_available:new e.cj(t)}),skybox:t=>({u_matrix:new e.cl(t),u_sun_direction:new e.ci(t),u_cubemap:new e.ch(t),u_opacity:new e.cj(t),u_temporal_offset:new e.cj(t)}),skyboxGradient:t=>({u_matrix:new e.cl(t),u_color_ramp:new e.ch(t),u_center_direction:new e.ci(t),u_radius:new e.cj(t),u_opacity:new e.cj(t),u_temporal_offset:new e.cj(t)}),skyboxCapture:t=>({u_matrix_3f:new e.dC(t),u_sun_direction:new e.ci(t),u_sun_intensity:new e.cj(t),u_color_tint_r:new e.d3(t),u_color_tint_m:new e.d3(t),u_luminance:new e.cj(t)}),globeRaster:t=>({u_proj_matrix:new e.cl(t),u_globe_matrix:new e.cl(t),u_normalize_matrix:new e.cl(t),u_merc_matrix:new e.cl(t),u_zoom_transition:new e.cj(t),u_merc_center:new e.ck(t),u_image0:new e.ch(t),u_image1:new e.ch(t),u_grid_matrix:new e.dC(t),u_skirt_height:new e.cj(t),u_far_z_cutoff:new e.cj(t),u_frustum_tl:new e.ci(t),u_frustum_tr:new e.ci(t),u_frustum_br:new e.ci(t),u_frustum_bl:new e.ci(t),u_globe_pos:new e.ci(t),u_globe_radius:new e.cj(t),u_viewport:new e.ck(t),u_emissive_texture_available:new e.cj(t)}),globeAtmosphere:t=>({u_frustum_tl:new e.ci(t),u_frustum_tr:new e.ci(t),u_frustum_br:new e.ci(t),u_frustum_bl:new e.ci(t),u_horizon:new e.cj(t),u_transition:new e.cj(t),u_fadeout_range:new e.cj(t),u_atmosphere_fog_color:new e.d3(t),u_high_color:new e.d3(t),u_space_color:new e.d3(t),u_temporal_offset:new e.cj(t),u_horizon_angle:new e.cj(t)}),model:t=>({u_matrix:new e.cl(t),u_lighting_matrix:new e.cl(t),u_normal_matrix:new e.cl(t),u_node_matrix:new e.cl(t),u_lightpos:new e.ci(t),u_lightintensity:new e.cj(t),u_lightcolor:new e.ci(t),u_camera_pos:new e.ci(t),u_opacity:new e.cj(t),u_baseColorFactor:new e.d3(t),u_emissiveFactor:new e.d3(t),u_metallicFactor:new e.cj(t),u_roughnessFactor:new e.cj(t),u_baseTextureIsAlpha:new e.ch(t),u_alphaMask:new e.ch(t),u_alphaCutoff:new e.cj(t),u_baseColorTexture:new e.ch(t),u_metallicRoughnessTexture:new e.ch(t),u_normalTexture:new e.ch(t),u_occlusionTexture:new e.ch(t),u_emissionTexture:new e.ch(t),u_lutTexture:new e.ch(t),u_color_mix:new e.d3(t),u_aoIntensity:new e.cj(t),u_emissive_strength:new e.cj(t),u_occlusionTextureTransform:new e.d3(t)}),modelDepth:t=>({u_matrix:new e.cl(t),u_instance:new e.cl(t),u_node_matrix:new e.cl(t)}),groundShadow:t=>({u_matrix:new e.cl(t),u_ground_shadow_factor:new e.ci(t)}),stars:t=>({u_matrix:new e.cl(t),u_up:new e.ci(t),u_right:new e.ci(t),u_intensity_multiplier:new e.cj(t)}),snowParticle:t=>({u_modelview:new e.cl(t),u_projection:new e.cl(t),u_time:new e.cj(t),u_cam_pos:new e.ci(t),u_velocityConeAperture:new e.cj(t),u_velocity:new e.cj(t),u_horizontalOscillationRadius:new e.cj(t),u_horizontalOscillationRate:new e.cj(t),u_boxSize:new e.cj(t),u_billboardSize:new e.cj(t),u_simpleShapeParameters:new e.ck(t),u_screenSize:new e.ck(t),u_thinningCenterPos:new e.ck(t),u_thinningShape:new e.ci(t),u_thinningAffectedRatio:new e.cj(t),u_thinningParticleOffset:new e.cj(t),u_particleColor:new e.d3(t),u_direction:new e.ci(t)}),rainParticle:t=>({u_modelview:new e.cl(t),u_projection:new e.cl(t),u_time:new e.cj(t),u_cam_pos:new e.ci(t),u_texScreen:new e.ch(t),u_velocityConeAperture:new e.cj(t),u_velocity:new e.cj(t),u_boxSize:new e.cj(t),u_rainDropletSize:new e.ck(t),u_distortionStrength:new e.cj(t),u_rainDirection:new e.ci(t),u_color:new e.d3(t),u_screenSize:new e.ck(t),u_thinningCenterPos:new e.ck(t),u_thinningShape:new e.ci(t),u_thinningAffectedRatio:new e.cj(t),u_thinningParticleOffset:new e.cj(t),u_shapeDirectionalPower:new e.cj(t),u_shapeNormalPower:new e.cj(t),u_mode:new e.cj(t)}),vignette:t=>({u_vignetteShape:new e.ci(t),u_vignetteColor:new e.d3(t)}),occlusion:t=>({u_matrix:new e.cl(t),u_anchorPos:new e.ci(t),u_screenSizePx:new e.ck(t),u_occluderSizePx:new e.ck(t),u_color:new e.d3(t)})};class Xs{constructor(e,t,r,n){this.id=Xs.uniqueIdxCounter,Xs.uniqueIdxCounter++,this.context=e;const i=e.gl;this.buffer=i.createBuffer(),this.dynamicDraw=Boolean(r),this.context.unbindVAO(),e.bindElementBuffer.set(this.buffer),i.bufferData(i.ELEMENT_ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?i.DYNAMIC_DRAW:i.STATIC_DRAW),this.dynamicDraw||n||t.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(e){this.id=Xs.uniqueIdxCounter,Xs.uniqueIdxCounter++;const t=this.context.gl;this.context.unbindVAO(),this.bind(),t.bufferSubData(t.ELEMENT_ARRAY_BUFFER,0,e.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Xs.uniqueIdxCounter=0;const Js={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Qs{constructor(e,t,r,n,i,s){this.length=t.length,this.attributes=r,this.itemSize=t.bytesPerElement,this.dynamicDraw=n,this.instanceCount=s,this.context=e;const o=e.gl;this.buffer=o.createBuffer(),e.bindVertexBuffer.set(this.buffer),o.bufferData(o.ARRAY_BUFFER,t.arrayBuffer,this.dynamicDraw?o.DYNAMIC_DRAW:o.STATIC_DRAW),this.dynamicDraw||i||t.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(e){const t=this.context.gl;this.bind(),t.bufferSubData(t.ARRAY_BUFFER,0,e.arrayBuffer)}enableAttributes(e,t){for(let r=0;r<this.attributes.length;r++){const n=t.getAttributeLocation(e,this.attributes[r].name);-1!==n&&e.enableVertexAttribArray(n)}}setVertexAttribPointers(e,t,r){for(let n=0;n<this.attributes.length;n++){const i=this.attributes[n],s=t.getAttributeLocation(e,i.name);-1!==s&&e.vertexAttribPointer(s,i.components,e[Js[i.type]],!1,this.itemSize,i.offset+this.itemSize*(r||0))}}setVertexAttribDivisor(e,t,r){for(let n=0;n<this.attributes.length;n++){const i=t.getAttributeLocation(e,this.attributes[n].name);-1!==i&&this.instanceCount&&this.instanceCount>0&&e.vertexAttribDivisor(i,r)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class $s{constructor(e,t,r,n,i){this.context=e,this.width=t,this.height=r;const s=this.framebuffer=e.gl.createFramebuffer();n>0&&(this.colorAttachment0=new Gi(e,s,0)),n>1&&(this.colorAttachment1=new Gi(e,s,1)),i&&(this.depthAttachmentType=i,this.depthAttachment="renderbuffer"===i?new Zi(e,s):new Ki(e,s))}createColorAttachment(e,t){0===t?this.colorAttachment0=new Gi(e,this.framebuffer,0):1===t&&(this.colorAttachment1=new Gi(e,this.framebuffer,1))}removeColorAttachment(e,t){const r=this.context.gl;let n;0===t?(n=this.colorAttachment0.get(),this.colorAttachment0=void 0):1===t&&(n=this.colorAttachment1.get(),this.colorAttachment1=void 0),n&&r.deleteTexture(n)}destroy(){const e=this.context.gl;if(this.colorAttachment0){const t=this.colorAttachment0.get();t&&e.deleteTexture(t)}if(this.colorAttachment1){const t=this.colorAttachment1.get();t&&e.deleteTexture(t)}if(this.depthAttachment&&this.depthAttachmentType)if("renderbuffer"===this.depthAttachmentType){const t=this.depthAttachment.get();t&&e.deleteRenderbuffer(t)}else{const t=this.depthAttachment.get();t&&e.deleteTexture(t)}e.deleteFramebuffer(this.framebuffer)}}class eo{constructor(e,t){this.gl=e,this.clearColor=new mi(this),this.clearDepth=new fi(this),this.clearStencil=new gi(this),this.colorMask=new yi(this),this.depthMask=new _i(this),this.stencilMask=new vi(this),this.stencilFunc=new xi(this),this.stencilOp=new bi(this),this.stencilTest=new wi(this),this.depthRange=new ji(this),this.depthTest=new Si(this),this.depthFunc=new Ti(this),this.blend=new ki(this),this.blendFunc=new Ai(this),this.blendColor=new Ci(this),this.blendEquation=new Ei(this),this.cullFace=new Ni(this),this.cullFaceSide=new Ii(this),this.frontFace=new Pi(this),this.program=new Mi(this),this.activeTexture=new Li(this),this.viewport=new Ri(this),this.bindFramebuffer=new Di(this),this.bindRenderbuffer=new Fi(this),this.bindTexture=new Oi(this),this.bindVertexBuffer=new zi(this),this.bindElementBuffer=new Bi(this),this.bindVertexArrayOES=new Ui(this),this.pixelStoreUnpack=new Vi(this),this.pixelStoreUnpackPremultiplyAlpha=new qi(this),this.pixelStoreUnpackFlipY=new Wi(this),this.options=t?Object.assign({},t):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=e.getExtension("EXT_texture_filter_anisotropic")||e.getExtension("MOZ_EXT_texture_filter_anisotropic")||e.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=e.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=e.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=e.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=e.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=t&&!!t.forceManualRenderingForInstanceIDShaders||this.renderer&&-1!==this.renderer.indexOf("PowerVR"),this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=e.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=e.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=e.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=e.getParameter(e.MAX_TEXTURE_SIZE),this.extBlendFuncExtended=e.getExtension("WEBGL_blend_func_extended")}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(e,t,r){return new Xs(this,e,t,r)}createVertexBuffer(e,t,r,n,i){return new Qs(this,e,t,r,n,i)}createRenderbuffer(e,t,r){const n=this.gl,i=n.createRenderbuffer();return this.bindRenderbuffer.set(i),n.renderbufferStorage(n.RENDERBUFFER,e,t,r),this.bindRenderbuffer.set(null),i}createFramebuffer(e,t,r,n){return new $s(this,e,t,r,n)}clear(e){let{color:t,depth:r,stencil:n,colorMask:i}=e;const s=this.gl;let o=0;t&&(o|=s.COLOR_BUFFER_BIT,this.clearColor.set(t.toNonPremultipliedRenderColor(null)),this.colorMask.set(i||[!0,!0,!0,!0])),void 0!==r&&(o|=s.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(r),this.depthMask.set(!0)),void 0!==n&&(o|=s.STENCIL_BUFFER_BIT,this.clearStencil.set(n),this.stencilMask.set(255)),s.clear(o)}setCullFace(e){!1===e.enable?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(e.mode),this.frontFace.set(e.frontFace))}setDepthMode(e){e.func!==this.gl.ALWAYS||e.mask?(this.depthTest.set(!0),this.depthFunc.set(e.func),this.depthMask.set(e.mask),this.depthRange.set(e.range)):this.depthTest.set(!1)}setStencilMode(e){e.test.func!==this.gl.ALWAYS||e.mask?(this.stencilTest.set(!0),this.stencilMask.set(e.mask),this.stencilOp.set([e.fail,e.depthFail,e.pass]),this.stencilFunc.set({func:e.test.func,ref:e.ref,mask:e.test.mask})):this.stencilTest.set(!1)}setColorMode(t){e.by(t.blendFunction,Jr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(t.blendFunction),this.blendColor.set(t.blendColor),t.blendEquation?this.blendEquation.set(t.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(t.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let to;function ro(t,r,n,i,s,o,a){const l=t.context,c=l.gl,u=t.transform,d=[e.aF(u.center.lng),e.aJ(u.center.lat)],h=n.layout.get("symbol-placement"),p=n.layout.get("text-variable-anchor"),m="map"===n.layout.get("icon-rotation-alignment"),f="map"===n.layout.get("text-rotation-alignment"),g="point"!==h,y=[];let _=0,v=0;for(let k=0;k<i.length;k++){const l=i[k],h=r.getTile(l),x=h.getBucket(n);if(!x)continue;const b=x.getProjection().createInversionMatrix(u,l.canonical),w=[],j=tr(l,x,u),S=!a&&m&&g,T=a&&f&&g,A=p&&x.hasTextData(),C=x.hasIconTextFit()&&A&&x.hasIconData(),E=S||T||a&&A||C,N="globe"===x.projection.name,I=N?e.aj(u.zoom):0;N&&(w.push("PROJECTION_GLOBE_VIEW"),E&&w.push("PROJECTED_POS_ON_VIEWPORT"));const P=t.getOrCreateProgram("collisionBox",{defines:w});let M=j;0===s[0]&&0===s[1]||(M=t.translatePosMatrix(j,h,s,o));const L=a?x.textCollisionBox:x.iconCollisionBox,R=x.collisionCircleArray;if(R.length>0){const t=e.bC(),r=M;e.cP(t,x.placementInvProjMatrix,u.glCoordMatrix),e.cP(t,t,x.placementViewportMatrix),y.push({circleArray:R,circleOffset:v,transform:r,invTransform:t,projection:x.getProjection()}),_+=R.length/4,v=_}if(!L)continue;t.terrain&&t.terrain.setupElevationDraw(h,P);const D=N?[l.canonical.x,l.canonical.y,1<<l.canonical.z]:[0,0,0];P.draw(t,c.LINES,Qr.disabled,en.disabled,t.colorModeForRenderPass(),nn.disabled,Ns(M,b,u,I,d,h,D,x.getProjection()),n.id,L.layoutVertexBuffer,L.indexBuffer,L.segments,null,u.zoom,null,[L.collisionVertexBuffer,L.collisionVertexBufferExt])}if(!a||!y.length)return;const x=t.getOrCreateProgram("collisionCircle"),b=new e.dZ;b.resize(4*_),b._trim();let w=0;for(const e of y)for(let t=0;t<e.circleArray.length/4;t++){const r=4*t,n=e.circleArray[r+0],i=e.circleArray[r+1],s=e.circleArray[r+2],o=e.circleArray[r+3];b.emplace(w++,n,i,s,o,0),b.emplace(w++,n,i,s,o,1),b.emplace(w++,n,i,s,o,2),b.emplace(w++,n,i,s,o,3)}(!to||to.length<2*_)&&(to=function(t){const r=2*t,n=new e.b0;n.resize(r),n._trim();for(let e=0;e<r;e++){const t=6*e;n.uint16[t+0]=4*e+0,n.uint16[t+1]=4*e+1,n.uint16[t+2]=4*e+2,n.uint16[t+3]=4*e+2,n.uint16[t+4]=4*e+3,n.uint16[t+5]=4*e+0}return n}(_));const j=l.createIndexBuffer(to,!0),S=l.createVertexBuffer(b,e.d_.members,!0);for(const k of y){const r={u_matrix:k.transform,u_inv_matrix:k.invTransform,u_camera_to_center_distance:(T=u).getCameraToCenterDistance(k.projection),u_viewport_size:[T.width,T.height]};x.draw(t,c.TRIANGLES,Qr.disabled,en.disabled,t.colorModeForRenderPass(),nn.disabled,r,n.id,S,j,e.bg.simpleSegment(0,2*k.circleOffset,k.circleArray.length,k.circleArray.length/2),null,u.zoom)}var T;S.destroy(),j.destroy()}const no=e.bC();function io(t){const r=t._camera.getWorldToCamera(t.worldSize,1),n=e.aB([],r,t.globeMatrix);e.bl(n,n);const i=[0,0,0],s=[0,1,0,0];return e.aC(s,s,n),i[0]=s[0],i[1]=s[1],i[2]=s[2],e.aw(i,i),i}function so(t,r){let{width:n,height:i,anchor:s,textOffset:o,textScale:a}=t;const{horizontalAlign:l,verticalAlign:c}=e.c1(s),u=-(l-.5)*n,d=-(c-.5)*i,h=e.c2(s,o);return new e.P((u/a+h[0])*r,(d/a+h[1])*r)}function oo(t,r,n,i,s,o,a,l,c,u){const d=t.text.placedSymbolArray,h=t.text.dynamicLayoutVertexArray,p=t.icon.dynamicLayoutVertexArray,m={},f=t.getProjection(),g=rr(a,f,s),y=s.elevation,_=f.upVectorScale(a.canonical,s.center.lat,s.worldSize).metersToTile;h.clear();for(let v=0;v<d.length;v++){const p=d.get(v),{tileAnchorX:x,tileAnchorY:b,numGlyphs:w}=p,j=p.hidden||!p.crossTileID||t.allowVerticalPlacement&&!p.placedOrientation?null:i[p.crossTileID];if(j){let i=0,d=0,S=0;const T="road"===t.elevationType;if(y||T){const r=T?t.getElevationFeatureForText(v):null,n=e.bV.getAtTileOffset(a,new e.P(x,b),y,r),[s,o,l]=f.upVector(a.canonical,x,b);i=n*s*_,d=n*o*_,S=n*l*_}let[k,A,C,E]=ur(p.projectedAnchorX+i,p.projectedAnchorY+d,p.projectedAnchorZ+S,n?g:o);const N=dr(s.getCameraToCenterDistance(f),E);let I=e.bM(t.textSizeData,c,p)*N/e.bY;n&&(I*=t.tilePixelRatio/l);const P=so(j,I);n?(({x:k,y:A,z:C}=f.projectTilePoint(x+P.x,b+P.y,a.canonical)),[k,A,C]=ur(k+i,A+d,C+S,o)):(r&&P._rotate(-s.angle),k+=P.x,A+=P.y,C=0);const M=t.allowVerticalPlacement&&p.placedOrientation===e.bL.vertical?Math.PI/2:0;for(let t=0;t<w;t++)e.bO(h,k,A,C,M);u&&p.associatedIconIndex>=0&&(m[p.associatedIconIndex]={x:k,y:A,z:C,angle:M})}else xr(w,h)}if(u){p.clear();const r=t.icon.placedSymbolArray;for(let t=0;t<r.length;t++){const n=r.get(t),{numGlyphs:i}=n,s=m[t];if(n.hidden||!s)xr(i,p);else{const{x:t,y:r,z:n,angle:o}=s;for(let s=0;s<i;s++)e.bO(p,t,r,n,o)}}t.icon.dynamicLayoutVertexBuffer.updateData(p)}t.text.dynamicLayoutVertexBuffer.updateData(h)}function ao(t,r,n,i,s,o){let a=arguments.length>6&&void 0!==arguments[6]?arguments[6]:{};const l=n.paint.get("icon-translate"),c=n.paint.get("text-translate"),u=n.paint.get("icon-translate-anchor"),d=n.paint.get("text-translate-anchor"),h=n.layout.get("icon-rotation-alignment"),p=n.layout.get("text-rotation-alignment"),m=n.layout.get("icon-pitch-alignment"),f=n.layout.get("text-pitch-alignment"),g=n.layout.get("icon-keep-upright"),y=n.layout.get("text-keep-upright"),_=n.paint.get("icon-color-saturation"),v=n.paint.get("icon-color-contrast"),x=n.paint.get("icon-color-brightness-min"),b=n.paint.get("icon-color-brightness-max"),w="sea"===n.layout.get("symbol-elevation-reference"),j="none"===n.layout.get("icon-image-use-theme"),S=t.context,T=S.gl,k=t.transform,A="map"===h,C="map"===p,E="map"===m,N="map"===f,I=void 0!==n.layout.get("symbol-sort-key").constantOr(1);let P=!1;const M=t.depthModeForSublayer(0,Qr.ReadOnly),L=new Qr(t.context.gl.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D),R=[e.aF(k.center.lng),e.aJ(k.center.lat)],D=n.layout.get("text-variable-anchor"),F="globe"===k.projection.name,O=[],z=[0,-1,0];for(const B of i){const i=r.getTile(B),s=i.getBucket(n);if(!s)continue;if("mercator"===s.projection.name&&F)continue;if(s.fullyClipped)continue;const o="globe"===s.projection.name,h=o?e.aj(k.zoom):0,p=rr(B,s.getProjection(),k),m=k.calculatePixelsToTileUnitsMatrix(i),f=D&&s.hasTextData(),U=s.hasIconTextFit()&&f&&s.hasIconData(),V=s.getProjection().createInversionMatrix(k,B.canonical),q=(1<<i.tileID.canonical.z)*e.al/t.transform.worldSize,W=e=>{let r=[0,0,0];if(e){const e=t.style.directionalLight,n=t.style.ambientLight;e&&n&&(r=bn(t.style,e,n))}return r},H=e=>{k.depthOcclusionForSymbolsAndCircles&&(n.hasOcclusionOpacityProperties||t.terrain)&&(e.push("DEPTH_D24"),e.push("DEPTH_OCCLUSION"))},G=r=>{n.lut&&!j&&(n.lut.texture||(n.lut.texture=new e.d$(t.context,n.lut.image,[n.lut.image.height,n.lut.image.height,n.lut.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+un.LUT),n.lut.texture&&n.lut.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),r.push("APPLY_LUT_ON_GPU"))},Z=()=>{const r=A&&"point"!==n.layout.get("symbol-placement"),a=[];H(a),G(a);const c=r||U,d="road"===s.elevationType,f=t.shadowRenderer,y=d&&E&&!!f&&f.enabled,j=W(y),S=d&&E&&!t.terrain?L:M,C=n.paint.get("icon-image-cross-fade");t.terrainRenderModeElevated()&&E&&a.push("PITCH_WITH_MAP_TERRAIN"),o&&(a.push("PROJECTION_GLOBE_VIEW"),c&&a.push("PROJECTED_POS_ON_VIEWPORT")),C>0&&s.hasAnySecondaryIcon&&a.push("ICON_TRANSITION"),!s.icon.zOffsetVertexBuffer||d&&t.terrain||a.push("Z_OFFSET"),0===_&&0===v&&0===x&&1===b||a.push("COLOR_ADJUSTMENT"),s.sdfIcons&&a.push("RENDER_SDF"),y&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),d&&E&&!t.terrain&&s.icon.orientationVertexBuffer&&a.push("ELEVATED_ROADS");const N=s.icon.programConfigurations.get(n.id),I=t.getOrCreateProgram("symbol",{config:N,defines:a}),P=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],D=s.iconSizeData,O=e.bK(D,k.zoom),Z=E||!k.isOrthographic,K=ar(p,i.tileID.canonical,E,A,k,s.getProjection(),m),Y=cr(p,i.tileID.canonical,E,A,k,s.getProjection(),m),X=t.translatePosMatrix(Y,i,l,u,!0),J=t.translatePosMatrix(p,i,l,u),Q=c?no:K,$=A&&!E&&!r;let ee=z;!F&&!k.mercatorFromTransition||A||(ee=io(k));const te=o?ee:z,re=n.getColorAdjustmentMatrix(_,v,x,b),ne=qs(D.kind,O,$,E,t,J,Q,X,w,!1,P,[0,0],0,B,h,R,V,te,s.getProjection(),j,q,re,C,null),ie=i.imageAtlasTexture?i.imageAtlasTexture:null,se=1!==n.layout.get("icon-size").constantOr(0)||s.iconsNeedLinear,oe=s.sdfIcons||t.options.rotating||t.options.zooming||se||Z?T.LINEAR:T.NEAREST,ae=s.sdfIcons&&0!==n.paint.get("icon-halo-width").constantOr(1),le=t.terrain&&E&&r?e.bl(e.bC(),K):no;if(r&&s.icon){const r=e.bV.getAtTileOffsetFunc(B,k.center.lat,k.worldSize,s.getProjection()),o=lr(p,i.tileID.canonical,E,A,k,s.getProjection(),m),a=n.layout.get("icon-size-scale-range"),l=e.aA(t.scaleFactor,a[0],a[1]);pr(s,p,t,!1,o,Y,E,g,r,B,l)}return{program:I,buffers:s.icon,uniformValues:ne,atlasTexture:ie,atlasTextureIcon:null,atlasInterpolation:oe,atlasInterpolationIcon:null,isSDF:s.sdfIcons,hasHalo:ae,depthMode:S,tile:i,renderWithShadows:y,labelPlaneMatrixInv:le}},K=()=>{const r=C&&"point"!==n.layout.get("symbol-placement"),a=[],l=r||D||U,u="road"===s.elevationType,f=t.shadowRenderer,g=u&&N&&!!f&&f.enabled,_=W(g),v=u&&N&&!t.terrain?L:M;t.terrainRenderModeElevated()&&N&&a.push("PITCH_WITH_MAP_TERRAIN"),o&&(a.push("PROJECTION_GLOBE_VIEW"),l&&a.push("PROJECTED_POS_ON_VIEWPORT")),!s.text.zOffsetVertexBuffer||u&&t.terrain||a.push("Z_OFFSET"),s.iconsInText&&a.push("RENDER_TEXT_AND_SYMBOL"),a.push("RENDER_SDF"),g&&a.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),u&&N&&!t.terrain&&s.text.orientationVertexBuffer&&a.push("ELEVATED_ROADS"),H(a);const x=s.text.programConfigurations.get(n.id),b=t.getOrCreateProgram("symbol",{config:x,defines:a});let j,S=[0,0],A=null;const E=s.textSizeData;s.iconsInText&&(S=i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],A=i.imageAtlasTexture?i.imageAtlasTexture:null,j=N||!k.isOrthographic||t.options.rotating||t.options.zooming||"composite"===E.kind||"camera"===E.kind?T.LINEAR:T.NEAREST);const I=i.glyphAtlasTexture?i.glyphAtlasTexture.size:[0,0],P=n.layout.get("text-size-scale-range"),O=e.aA(t.scaleFactor,P[0],P[1]),G=e.bK(E,k.zoom,O),Z=ar(p,i.tileID.canonical,N,C,k,s.getProjection(),m),K=cr(p,i.tileID.canonical,N,C,k,s.getProjection(),m),Y=t.translatePosMatrix(K,i,c,d,!0),X=t.translatePosMatrix(p,i,c,d),J=l?no:Z,Q=C&&!N&&!r;let $=z;!F&&!k.mercatorFromTransition||C||($=io(k));const ee=qs(E.kind,G,Q,N,t,X,J,Y,w,!0,I,S,0,B,h,R,V,o?$:z,s.getProjection(),_,q,null,null,O),te=i.glyphAtlasTexture?i.glyphAtlasTexture:null,re=T.LINEAR,ne=0!==n.paint.get("text-halo-width").constantOr(1),ie=t.terrain&&N&&r?e.bl(e.bC(),Z):no;if(r&&s.text){const r=e.bV.getAtTileOffsetFunc(B,k.center.lat,k.worldSize,s.getProjection()),n=lr(p,i.tileID.canonical,N,C,k,s.getProjection(),m);pr(s,p,t,!0,n,K,N,y,r,B,O)}return{program:b,buffers:s.text,uniformValues:ee,atlasTexture:te,atlasTextureIcon:A,atlasInterpolation:re,atlasInterpolationIcon:j,isSDF:!0,hasHalo:ne,depthMode:v,tile:i,renderWithShadows:g,labelPlaneMatrixInv:ie}},Y=s.icon.segments.get().length,X=s.text.segments.get().length,J=Y&&!a.onlyText?Z():null,Q=X&&!a.onlyIcons?K():null,$=n.paint.get("icon-opacity").constantOr(1),ee=n.paint.get("text-opacity").constantOr(1);if(I&&s.canOverlap){P=!0;const t=$&&!a.onlyText?s.icon.segments.get():[],r=ee&&!a.onlyIcons?s.text.segments.get():[];for(const n of t)O.push({segments:new e.bg([n]),sortKey:n.sortKey,state:J});for(const n of r)O.push({segments:new e.bg([n]),sortKey:n.sortKey,state:Q})}else a.onlyText||O.push({segments:$?s.icon.segments:new e.bg([]),sortKey:0,state:J}),a.onlyIcons||O.push({segments:ee?s.text.segments:new e.bg([]),sortKey:0,state:Q})}P&&O.sort((e,t)=>e.sortKey-t.sortKey);for(const e of O){const r=e.state;if(r)if(t.terrain?t.terrain.setupElevationDraw(r.tile,r.program,{useDepthForOcclusion:k.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:r.labelPlaneMatrixInv}):t.setupDepthForOcclusion(k.depthOcclusionForSymbolsAndCircles,r.program),S.activeTexture.set(T.TEXTURE0),r.atlasTexture&&r.atlasTexture.bind(r.atlasInterpolation,T.CLAMP_TO_EDGE,!0),r.atlasTextureIcon&&(S.activeTexture.set(T.TEXTURE1),r.atlasTextureIcon&&r.atlasTextureIcon.bind(r.atlasInterpolationIcon,T.CLAMP_TO_EDGE,!0)),r.renderWithShadows&&t.shadowRenderer.setupShadows(r.tile.tileID.toUnwrapped(),r.program,"vector-tile"),t.uploadCommonLightUniforms(t.context,r.program),r.hasHalo){const i=r.uniformValues;i.u_is_halo=1,lo(r.buffers,e.segments,n,t,r.program,r.depthMode,s,o,i,2),i.u_is_halo=0}else{if(r.isSDF){const i=r.uniformValues;r.hasHalo&&(i.u_is_halo=1,lo(r.buffers,e.segments,n,t,r.program,r.depthMode,s,o,i,1)),i.u_is_halo=0}lo(r.buffers,e.segments,n,t,r.program,r.depthMode,s,o,r.uniformValues,1)}}}function lo(e,t,r,n,i,s,o,a,l,c){const u=[e.dynamicLayoutVertexBuffer,e.opacityVertexBuffer,e.iconTransitioningVertexBuffer,e.globeExtVertexBuffer,e.zOffsetVertexBuffer,e.orientationVertexBuffer];i.draw(n,n.context.gl.TRIANGLES,s,o,a,nn.disabled,l,r.id,e.layoutVertexBuffer,e.indexBuffer,t,r.paint,n.transform.zoom,e.programConfigurations.get(r.id),u,c)}function co(t,r){const n=1<<t.canonical.z,i=(r.x*n-t.canonical.x-t.wrap*n)*e.al,s=(r.y*n-t.canonical.y)*e.al,o=e.e8(r.z,r.y);return e.d5(i,s,o)}function uo(t,r,n,i,s){if(!n.layout||"none"===n.layout.get("fill-elevation-reference")||0===n.paint.get("fill-opacity").constantOr(1))return;const o=t.context.gl,a=new Qr(t.context.gl.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D),l=new Qr(t.context.gl.GREATER,Qr.ReadWrite,t.depthRangeFor3D),c=function(t){let r=.01;return t.isOrthographic&&(r=e.ak(1e-4,r,e.d0(t.pitch>=hn?1:t.pitch/hn))),2*r}(t.transform),u=t.transform.getFreeCameraOptions().position,d="elevatedStructuresDepthReconstruct",h=t.getOrCreateProgram(d,{defines:["DEPTH_RECONSTRUCTION"]}),p=t.getOrCreateProgram(d);for(const e of i){const i=r.getTile(e),d=i.getBucket(n);if(!d)continue;const m=d.elevatedStructures;if(!m)continue;const f=d.elevationBufferData.heightRange,g=co(e.toUnwrapped(),u),y=t.translatePosMatrix(e.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));let _,v,x,b;if("initialize"===s){if(!f||f.min>=1||0===m.depthSegments.segments[0].primitiveLength)continue;_=ks(y,g,c,1,0),v=a,x=m.depthSegments,b=h}else if("reset"===s){if(!f||f.min>=0||0===m.maskSegments.segments[0].primitiveLength)continue;_=ks(y,g,0,0,1),v=l,x=m.maskSegments,b=h}else if("geometry"===s){if(0===m.depthSegments.segments[0].primitiveLength)continue;_=ks(y,g,c,1,0),v=a,x=m.depthSegments,b=p}b.draw(t,o.TRIANGLES,v,en.disabled,Jr.disabled,nn.disabled,_,n.id,m.vertexBuffer,m.indexBuffer,x,n.paint,t.transform.zoom)}}function ho(t,r,n,i){const{painter:s,sourceCache:o,layer:a,coords:l,colorMode:c,elevationType:u,terrainEnabled:d,pass:h}=t,p=s.context.gl,m=a.paint.get("fill-pattern"),f=a.paint.get("fill-pattern-cross-fade"),g=m.constantOr(null);let y=u;"road"!==u||r&&!d||(y="none");const _="road"===y,v=t.painter.shadowRenderer,x=_&&!!v&&v.enabled,b=new Qr(s.context.gl.LEQUAL,Qr.ReadOnly,s.depthRangeFor3D);let w=[0,0,0];if(x){const e=s.style.directionalLight,t=s.style.ambientLight;e&&t&&(w=bn(s.style,e,t))}const j=m&&m.constantOr(1),S=s.terrain&&s.terrain.renderingToTexture,T=(t,h)=>{let m,y,T,k,A;h?(m=j&&!a.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",T=p.LINES):(m=j?"fillPattern":"fill",T=p.TRIANGLES);for(const C of l){const l=o.getTile(C);if(j&&!l.patternsLoaded())continue;const E=l.getBucket(a);if(!E)continue;const N=r?E.elevationBufferData:E.bufferData;if(N.isEmpty())continue;s.prepareDrawTile();const I=N.programConfigurations.get(a.id),P=s.isTileAffectedByFog(C),M=[],L=[];_&&(M.push("ELEVATED_ROADS"),L.push(N.elevatedLayoutVertexBuffer)),x&&M.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),S&&n&&M.push("USE_MRT1"),j&&(s.context.activeTexture.set(p.TEXTURE0),l.imageAtlasTexture&&l.imageAtlasTexture.bind(p.LINEAR,p.CLAMP_TO_EDGE),I.updatePaintBuffers());let R=!1;if(g&&l.imageAtlas){const t=l.imageAtlas,r=e.e3.from(g),n=r.getPrimary().scaleSelf(e.o.devicePixelRatio).toString(),i=r.getSecondary(),s=t.patternPositions.get(n),o=i?t.patternPositions.get(i.scaleSelf(e.o.devicePixelRatio).toString()):null;R=!!s&&!!o,s&&I.setConstantPatternPositions(s,o)}f>0&&(R||I.getPatternTransitionVertexBuffer("fill-pattern"))&&M.push("FILL_PATTERN_TRANSITION");const D=s.getOrCreateProgram(m,{config:I,overrideFog:P,defines:M}),F=s.translatePosMatrix(C.projMatrix,l,a.paint.get("fill-translate"),a.paint.get("fill-translate-anchor"));x&&v.setupShadows(l.tileID.toUnwrapped(),D,"vector-tile");const O=a.paint.get("fill-emissive-strength");if(h){k=N.lineIndexBuffer,A=N.lineSegments;const e=s.terrain&&s.terrain.renderingToTexture?s.terrain.drapeBufferSize:[p.drawingBufferWidth,p.drawingBufferHeight];y="fillOutlinePattern"===m&&j?Ss(F,O,s,l,e,w,f):js(F,O,e,w)}else k=N.indexBuffer,A=N.triangleSegments,y=j?ws(F,O,s,l,w,f):bs(F,O,w);s.uploadCommonUniforms(s.context,D,C.toUnwrapped());let z=t;("road"===u&&!d||"offset"===u)&&(z=b),D.draw(s,T,z,i||s.stencilModeForClipping(C),c,nn.disabled,y,a.id,N.layoutVertexBuffer,k,A,a.paint,s.transform.zoom,I,L)}};s.renderPass===h&&T(s.depthModeForSublayer(1,"opaque"===s.renderPass?Qr.ReadWrite:Qr.ReadOnly),!1),"none"===y&&"translucent"===s.renderPass&&a.paint.get("fill-antialias")&&T(s.depthModeForSublayer(a.getPaintProperty("fill-outline-color")?2:0,Qr.ReadOnly),!0)}function po(t,r,n,i,s,o,a,l){n.resetLayerRenderingStats(t);const c=t.context,u=c.gl,d=t.transform,h=n.paint.get("fill-extrusion-pattern"),p=n.paint.get("fill-extrusion-pattern-cross-fade"),m=h.constantOr(null),f=h.constantOr(1),g=n.paint.get("fill-extrusion-opacity"),y=t.style.enable3dLights(),_=n.paint.get(y&&!f?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),v=[n.paint.get("fill-extrusion-ambient-occlusion-intensity"),_],x=n.layout.get("fill-extrusion-edge-radius"),b=x>0&&!n.paint.get("fill-extrusion-rounded-roof"),w=b?0:x,j="globe"===d.projection.name?e.eb():0,S="globe"===d.projection.name,T=S?e.aj(d.zoom):0,k=[e.aF(d.center.lng),e.aJ(d.center.lat)],A="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),C=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(A?null:n.lut).toArray01().slice(0,3),E=n.paint.get("fill-extrusion-flood-light-intensity"),N=n.paint.get("fill-extrusion-vertical-scale"),I=0!==n.paint.get("fill-extrusion-line-width").constantOr(1),P=n.paint.get("fill-extrusion-height-alignment"),M=n.paint.get("fill-extrusion-base-alignment"),L=mn(t,n.paint.get("fill-extrusion-cutoff-fade-range")),R=[];let D;S&&R.push("PROJECTION_GLOBE_VIEW"),v[0]>0&&R.push("FAUX_AO"),b&&R.push("ZERO_ROOF_RADIUS"),l&&R.push("HAS_CENTROID"),E>0&&R.push("FLOOD_LIGHT"),L.shouldRenderCutoff&&R.push("RENDER_CUTOFF"),I&&R.push("RENDER_WALL_MODE");const F="shadow"===t.renderPass,O=t.shadowRenderer,z=F&&!!O,B=F?nn.disabled:nn.backCCW;t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!0);let U=[0,0,0];if(O){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(U=bn(t.style,e,r)),F||(R.push("RENDER_SHADOWS","DEPTH_TEXTURE"),O.useNormalOffset&&R.push("NORMAL_OFFSET")),D=R.concat(["SHADOWS_SINGLE_CASCADE"])}const V=z?"fillExtrusionDepth":f?"fillExtrusionPattern":"fillExtrusion",q=n.getLayerRenderingStats();for(const W of i){const i=r.getTile(W),h=i.getBucket(n);if(!h||h.projection.name!==d.projection.name)continue;let y=!1;O&&(y=0===O.getMaxCascadeForTile(W.toUnwrapped()));const _=t.isTileAffectedByFog(W),x=h.programConfigurations.get(n.id);let b=!1;if(m&&i.imageAtlas){const t=i.imageAtlas,r=e.e3.from(m),n=r.getPrimary().scaleSelf(e.o.devicePixelRatio).toString(),s=r.getSecondary(),o=t.patternPositions.get(n),a=s?t.patternPositions.get(s.scaleSelf(e.o.devicePixelRatio).toString()):null;b=!!o&&!!a,o&&x.setConstantPatternPositions(o,a)}p>0&&(b||x.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&R.push("FILL_EXTRUSION_PATTERN_TRANSITION");const A=t.getOrCreateProgram(V,{config:x,defines:y?D:R,overrideFog:_});if(t.terrain&&t.terrain.setupElevationDraw(i,A,{useMeterToDem:!0}),!h.centroidVertexBuffer){const e=A.getAttributeLocation(u,"a_centroid_pos");-1!==e&&u.vertexAttrib2f(e,0,0)}!F&&O&&O.setupShadows(i.tileID.toUnwrapped(),A,"vector-tile"),f&&(t.context.activeTexture.set(u.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),x.updatePaintBuffers());const z=n.paint.get("fill-extrusion-vertical-gradient"),H=1/h.tileToMeter;let G;if(F&&O){if(xo(i.tileID,h.maxHeight,t))continue;const e=O.calculateShadowPassMatrixFromTile(i.tileID.toUnwrapped());G=_s(e,w,H,N,P,M)}else{const e=t.translatePosMatrix(W.expandedProjMatrix,i,n.paint.get("fill-extrusion-translate"),n.paint.get("fill-extrusion-translate-anchor")),r=d.projection.createInversionMatrix(d,W.canonical);G=f?vs(e,t,z,g,v,w,H,W,i,j,P,M,T,k,r,C,N,p):ys(e,t,z,g,v,w,H,W,j,P,M,T,k,r,C,N,E,U)}t.uploadCommonUniforms(c,A,W.toUnwrapped(),null,L);let Z=h.segments;if("mercator"===d.projection.name&&!F&&(Z=h.getVisibleSegments(i.tileID,t.terrain,t.transform.getFrustum(0)),!Z.get().length))continue;if(q)if(F)for(const e of Z.get())q.numRenderedVerticesInShadowPass+=e.primitiveLength;else for(const e of Z.get())q.numRenderedVerticesInTransparentPass+=e.primitiveLength;const K=[];(t.terrain||l)&&K.push(h.centroidVertexBuffer),S&&K.push(h.layoutVertexExtBuffer),I&&K.push(h.wallVertexBuffer),A.draw(t,c.gl.TRIANGLES,s,o,a,B,G,n.id,h.layoutVertexBuffer,h.indexBuffer,Z,n.paint,t.transform.zoom,x,K)}t.shadowRenderer&&(t.shadowRenderer.useNormalOffset=!1)}class mo{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function fo(t,r,n,i,s,o,a,l,c,u,d,h,p,m,f,g,y,_,v,x){const b=r.context,w=b.gl,j=r.transform,S=r.transform.zoom,T=[],k=t.translate,A=t.translateAnchor,C=t.edgeRadius,E=mn(r,t.cutoffFadeRange);"clear"===d?(T.push("CLEAR_SUBPASS"),x&&(T.push("CLEAR_FROM_TEXTURE"),b.activeTexture.set(w.TEXTURE0),x.bind(w.LINEAR,w.CLAMP_TO_EDGE))):"sdf"===d?T.push("SDF_SUBPASS"):"emissive"===d&&(T.push("USE_MRT1"),b.activeTexture.set(w.TEXTURE0),x.bind(w.LINEAR,w.CLAMP_TO_EDGE)),_&&T.push("HAS_CENTROID"),E.shouldRenderCutoff&&T.push("RENDER_CUTOFF");const N=(e,t,n,s,d)=>{let v=T;null!=t.groundRadiusBuffer&&(v=T.concat("HAS_ATTRIBUTE_a_flood_light_ground_radius"));const w=t.programConfigurations.get(i.id),j=r.isTileAffectedByFog(e),k=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:w,defines:v,overrideFog:j}),A=xs(r,s,h,u,d,[p,m*d],f,g,y,S>=17?0:C*d,x?x.size[0]:0),N=[];_&&N.push(t.hiddenByLandmarkVertexBuffer),null!=t.groundRadiusBuffer&&N.push(t.groundRadiusBuffer),r.uploadCommonUniforms(b,k,e.toUnwrapped(),null,E),k.draw(r,b.gl.TRIANGLES,o,a,l,c,A,i.id,t.vertexBuffer,t.indexBuffer,n,i.paint,S,w,N)};for(const I of s){const t=n.getTile(I),s=t.getBucket(i);if(!s||s.projection.name!==j.projection.name||!s.groundEffect||s.groundEffect&&!s.groundEffect.hasData())continue;const o=s.groundEffect,a=1/s.tileToMeter;{const e=r.translatePosMatrix(I.projMatrix,t,k,A),n=o.getDefaultSegment();N(I,o,n,e,a)}if(v)for(let l=0;l<4;l++){const s=e.e9[l](I),o=n.getTile(s);if(!o)continue;const c=o.getBucket(i);if(!c||c.projection.name!==j.projection.name||!c.groundEffect||c.groundEffect&&!c.groundEffect.hasData())continue;const u=c.groundEffect;let d,h;0===l?(d=[-e.al,0,0],h=1):1===l?(d=[e.al,0,0],h=0):2===l?(d=[0,-e.al,0],h=3):(d=[0,e.al,0],h=2);const p=u.regionSegments[h];if(!p)continue;const m=new Float32Array(16);e.br(m,I.projMatrix,d),N(I,u,p,r.translatePosMatrix(m,t,k,A),a)}}}function go(t,r,n,i,s,o,a){0===i.centroidVertexArray.length&&i.createCentroidsBuffer();const l=o?o.findDEMTileFor(n):null;if(!(l&&l.dem||a))return;o&&l&&l.dem&&i.selfDEMTileTimestamp!==l.dem._timestamp&&(i.borderDoneWithNeighborZ=[-1,-1,-1,-1],i.selfDEMTileTimestamp=l.dem._timestamp);const c=t=>new e.P(Math.ceil((t+e.ed)*e.ee),0),u=e=>{const t=r.getSource().minzoom,n=e=>{const t=r.getTileByID(e);if(t&&t.hasData())return t.getBucket(s)},i=[0,-1,1];for(const r of i){if(e.overscaledZ+r<t)continue;const i=n(e.calculateScaledKey(e.overscaledZ+r));if(i)return i}},d=[0,0,0],h=(t,r)=>(d[0]=Math.min(t.min.y,r.min.y),d[1]=Math.max(t.max.y,r.max.y),d[2]=e.al-r.min.x>t.max.x?r.min.x-e.al:t.max.x,d),p=(t,r)=>(d[0]=Math.min(t.min.x,r.min.x),d[1]=Math.max(t.max.x,r.max.x),d[2]=e.al-r.min.y>t.max.y?r.min.y-e.al:t.max.y,d),m=[(e,t)=>h(e,t),(e,t)=>h(t,e),(e,t)=>p(e,t),(e,t)=>p(t,e)],f=(t,r,i,s,a,c,u)=>{if(!o)return 0;const d=[[c?i:t,c?t:i,0],[c?i:r,c?r:i,0]],h=u<0?e.al+u:u,p=[c?h:(t+r)/2,c?(t+r)/2:h,0];return 0===i&&u<0||0!==i&&u>0?o.getForTilePoints(a,[p],!0,s):d.push(p),o.getForTilePoints(n,d,!0,l),Math.max(d[0][2],d[1][2],p[2])/o.exaggeration()};for(let _=0;_<4;_++){const t=i.borderFeatureIndices[_];if(0===t.length)continue;const r=e.e9[_](n),s=u(r);if(!(s&&s instanceof e.ea))continue;const l=o?o.findDEMTileFor(r):null;if(!(l&&l.dem||a))continue;if(o&&l&&l.dem&&i.borderDEMTileTimestamp[_]!==l.dem._timestamp&&(i.borderDoneWithNeighborZ[_]=-1,i.borderDEMTileTimestamp[_]=l.dem._timestamp),i.borderDoneWithNeighborZ[_]===s.canonical.z)continue;0===s.centroidVertexArray.length&&s.createCentroidsBuffer();const d=(_<2?1:5)-_,h=s.borderDoneWithNeighborZ[d]!==i.canonical.z,p=s.borderFeatureIndices[d];let v=0;if(i.canonical.z!==s.canonical.z){for(const e of t)i.showCentroid(i.featuresOnBorder[e]);if(h)for(const e of p)s.showCentroid(s.featuresOnBorder[e]);i.borderDoneWithNeighborZ[_]=s.canonical.z,s.borderDoneWithNeighborZ[d]=i.canonical.z}for(const n of t){const t=i.featuresOnBorder[n],o=i.centroidData[t.centroidDataIndex],u=t.borders[_];let h;for(;v<p.length;){h=s.featuresOnBorder[p[v]];const e=h.borders[d];if(e[1]>u[0]+3||e[0]>u[0]-3)break;s.showCentroid(h),v++}if(h&&v<p.length){const n=v;let x=0;for(;!(h.borders[d][0]>u[1]-3)&&(x++,++v!==p.length);)h=s.featuresOnBorder[p[v]];h=s.featuresOnBorder[p[n]];let b=!1;if(x>=1){const e=h.borders[d];Math.abs(u[0]-e[0])<3&&Math.abs(u[1]-e[1])<3&&(x=1,b=!0,v=n+1)}else if(0===x){i.showCentroid(t);continue}const w=s.centroidData[h.centroidDataIndex];a&&b&&(((g=o).flags|(y=w).flags)&e.ec?(g.flags|=e.ec,y.flags|=e.ec):(g.flags&=~e.ec,y.flags&=~e.ec));const j=t.intersectsCount()>1||h.intersectsCount()>1;if(x>1)v=n,o.centroidXY=w.centroidXY=new e.P(0,0);else if(l&&l.dem&&!j){const t=m[_](o,w),n=_%2?e.al-1:0,i=f(t[0],Math.min(e.al-1,t[1]),n,l,r,_<2,t[2]);o.centroidXY=w.centroidXY=c(i)}else j?o.centroidXY=w.centroidXY=new e.P(0,0):(o.centroidXY=i.encodeBorderCentroid(t),w.centroidXY=s.encodeBorderCentroid(h));i.writeCentroidToBuffer(o),s.writeCentroidToBuffer(w)}else i.showCentroid(t)}i.borderDoneWithNeighborZ[_]=s.canonical.z,s.borderDoneWithNeighborZ[d]=i.canonical.z}var g,y;(i.needsCentroidUpdate||!i.centroidVertexBuffer&&0!==i.centroidVertexArray.length)&&i.uploadCentroid(t)}const yo=[1,0,0],_o=[0,1,0],vo=[0,0,1];function xo(t,r,n){const i=n.transform,s=n.shadowRenderer;if(!s)return!0;const o=t.toUnwrapped(),a=i.tileSize*s._cascades[n.currentShadowCascade].scale;let l=r;if(i.elevation){const e=i.elevation.getMinMaxForTile(t);e&&(l+=e.max)}const c=[...s.shadowDirection];c[2]=-c[2];const u=s.computeSimplifiedTileShadowVolume(o,l,a,c);if(!u)return!1;const d=[yo,_o,vo,c,[c[0],0,c[2]],[0,c[1],c[2]]],h="globe"===i.projection.name,p=i.scaleZoom(a),m=e.cB.fromInvProjectionMatrix(i.invProjMatrix,i.worldSize,p,!h),f=s.getCurrentCascadeFrustum();return 0===m.intersectsPrecise(u.vertices,u.planes,d)||0===f.intersectsPrecise(u.vertices,u.planes,d)}function bo(t){const{painter:r,source:n,layer:i,coords:s}=t;let o=t.defines;const a=r.context,l="shadow"===r.renderPass,c="light-beam"===r.renderPass,u=r.shadowRenderer,d=e.ef(r.transform.center.lat,r.transform.zoom),h=mn(r,i.paint.get("building-cutoff-fade-range"));h.shouldRenderCutoff&&(o=o.concat("RENDER_CUTOFF")),t.floodLightIntensity>0&&(o=o.concat("FLOOD_LIGHT"));for(const p of s){const s=n.getTile(p),m=s.getBucket(i);if(!m)continue;u&&0===u.getMaxCascadeForTile(p.toUnwrapped())&&(o=o.concat("SHADOWS_SINGLE_CASCADE"));const f=m.programConfigurations.get(i.id);let g,y,_,v=r.translatePosMatrix(p.expandedProjMatrix,s,[0,0],"map");if(v=e.cS(e.bC(),v,[1,1,t.verticalScale]),l&&u){if(xo(s.tileID,m.maxHeight*d,r))continue;let n=u.calculateShadowPassMatrixFromTile(s.tileID.toUnwrapped());n=e.cS(e.bC(),n,[1,1,t.verticalScale]),_=Es(n),g=y=r.getOrCreateProgram("buildingDepth",{config:f,defines:o,overrideFog:!1})}else if(c)g=y=r.getOrCreateProgram("buildingBloom",{config:f,defines:o,overrideFog:!1}),_=Cs(v);else{const n=r.transform.calculatePosMatrix(p.toUnwrapped(),r.transform.worldSize);e.cS(n,n,[1,1,t.verticalScale]);const i=e.bC();e.cS(i,n,[1,-1,1/d]),e.bl(i,i),e.eg(i,i);const s=r.transform.getFreeCameraOptions().position,a=1<<p.canonical.z;if(_=As(v,i,t.opacity,t.facadeAOIntensity,[((s.x-p.wrap)*a-p.canonical.x)*e.al,(s.y*a-p.canonical.y)*e.al,s.z*a*e.al],m.tileToMeter,t.facadeEmissiveChance,t.floodLightColor,t.floodLightIntensity),y=r.getOrCreateProgram("building",{config:f,defines:o,overrideFog:!1}),!0===t.depthOnly)g=y;else{const e=o.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);g=r.getOrCreateProgram("building",{config:f,defines:e,overrideFog:!1})}u&&(u.setupShadowsFromMatrix(n,y,!0),g!==y&&u.setupShadowsFromMatrix(n,g,!0))}const x=(e,n)=>{if(c){const s=e.entranceBloom;n.draw(r,a.gl.TRIANGLES,t.depthMode,en.disabled,t.blendMode,nn.disabled,_,i.id,s.layoutVertexBuffer,s.indexBuffer,s.segmentsBucket,i.paint,r.transform.zoom,f,[s.layoutAttenuationBuffer,s.layoutColorBuffer])}else{const s=e.segmentsBucket;let o=[e.layoutNormalBuffer,e.layoutCentroidBuffer,e.layoutColorBuffer,e.layoutFloodLightDataBuffer];e.layoutFacadePaintBuffer&&(o=o.concat([e.layoutFacadeDataBuffer,e.layoutFacadeVerticalRangeBuffer,e.layoutFacadePaintBuffer])),n.draw(r,a.gl.TRIANGLES,t.depthMode,en.disabled,t.blendMode,l?nn.disabled:nn.backCW,_,i.id,e.layoutVertexBuffer,e.indexBuffer,s,i.paint,r.transform.zoom,f,o)}};r.uploadCommonUniforms(a,y,p.toUnwrapped(),null,h),m.buildingWithoutFacade&&x(m.buildingWithoutFacade,y),m.buildingWithFacade&&(g!==y&&r.uploadCommonUniforms(a,g,p.toUnwrapped(),null,h),x(m.buildingWithFacade,g))}}function wo(t,r,n,i,s,o,a,l,c,u,d,h,p){const m=t.context.gl,f=t.depthModeForSublayer(1,Qr.ReadOnly,m.LEQUAL,!0),g=.1*(1-(y=d))+3*y;var y;const _=t._showOverdrawInspector,v=h,x=new mo;_||fo(x,t,r,n,i,f,new en({func:m.ALWAYS,mask:255},255,255,m.KEEP,m.KEEP,m.REPLACE),new Jr([m.ONE,m.ONE,m.ONE,m.ONE],e.ao.transparent,[!1,!1,!1,!0],m.MIN),nn.disabled,s,"sdf",o,a,l,c,u,g,v,!1);{const d=_?en.disabled:new en({func:m.EQUAL,mask:255},255,255,m.KEEP,m.DECR,m.DECR),h=_?t.colorModeForRenderPass():new Jr([m.ONE_MINUS_DST_ALPHA,m.DST_ALPHA,m.ONE,m.ONE],e.ao.transparent,[!0,!0,!0,!0]);fo(x,t,r,n,i,f,d,h,nn.disabled,s,"color",o,a,l,c,u,g,v,!1)}}function jo(t){return[t[0]*e.eh,t[1]*e.eh,t[2]*e.eh,0]}function So(t,r,n,i,s,o,a,l,c){const u=i.getSource(),d=n.globeSharedBuffers;if(!d)return;let h,p,m;if(r&&(h=i.getTile(r)),u instanceof e.aU?(p=u.texture,m=e.dK(0,0,n.transform)):h&&r&&(p=h.texture,m=e.dK(r.canonical.z,r.canonical.x,n.transform)),!p||!m)return;t||(m=e.cS(e.bC(),m,[1,-1,1]));const f=n.context,g=f.gl,y="nearest"===s.paint.get("raster-resampling")?g.NEAREST:g.LINEAR,_=n.colorModeForDrapableLayerRenderPass(o),v=a.defines;v.push("GLOBE_POLES");const x=new Qr(g.LEQUAL,Qr.ReadWrite,n.depthRangeFor3D),b=Float32Array.from(n.transform.expandedFarZProjMatrix),w=Float32Array.from(e.bk(e.dJ(new e.cD(0,0,0))));n.terrain&&n.terrain.prepareDrawTile(),f.activeTexture.set(g.TEXTURE0),p.bind(y,g.CLAMP_TO_EDGE),f.activeTexture.set(g.TEXTURE1),p.bind(y,g.CLAMP_TO_EDGE),"useMipmap"in p&&f.extTextureFilterAnisotropic&&n.transform.pitch>20&&g.texParameterf(g.TEXTURE_2D,f.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,f.extTextureFilterAnisotropicMax);const[j,S,T,k]=r?d.getPoleBuffers(r.canonical.z,!1):d.getPoleBuffers(0,!0),A=s.paint.get("raster-elevation");let C;t?(C=j,n.renderDefaultNorthPole=0!==A):(C=S,n.renderDefaultSouthPole=0!==A);const E=jo(a.mix),N=((e,t,r,n,i,s,o,a,l,c,u,d,h)=>Ds(e,t,r,new Float32Array(16),new Float32Array(9),[0,0],n,[0,0],[0,0,0,0],1,{opacity:1,mix:0},s,[0,0]||0,a,2,c,u,d,1,0,h))(b,w,m,e.aj(n.transform.zoom),0,s,0,A,0,E,a.offset,a.range,o),I=n.getOrCreateProgram("raster",{defines:v});n.uploadCommonUniforms(f,I,null),I.draw(n,g.TRIANGLES,x,c,_,l,N,s.id,C,T,k)}function To(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),n=r-t,i=.2*e.height,s=t+i;return[t,r,(s-i-t)/n,(s-t)/n]}function ko(e,t,r,n){if(e)return t instanceof yt&&e instanceof Dt?t.getTextureDescriptor(e,r,!0):{texture:e.texture,mix:jo(n.mix),offset:n.offset,buffer:0,tileSize:1}}var Ao=e.ei([{name:"a_index",type:"Int16",components:1}]);class Co{constructor(t,r,n,i){const s={width:n[0],height:n[1],data:null},o=t.gl;this.targetColorTexture=new e.T(t,s,o.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new e.T(t,s,o.RGBA8,{useMipmap:!1}),this.context=t,this.updateParticleTexture(r,i),this.lastInvalidatedAt=0}updateParticleTexture(t,r){if(this.particleTextureDimension===r.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const n=this.context.gl,i=r.width*r.height;this.particleTexture0=new e.T(this.context,r,n.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new e.T(this.context,r,n.RGBA8,{premultiply:!1,useMipmap:!1});const s=new e.ej;s.reserve(i);for(let e=0;e<i;e++)s.emplaceBack(e);this.particleIndexBuffer=this.context.createVertexBuffer(s,Ao.members,!0),this.particleSegment=e.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=r.width}update(t){return!(this.lastInvalidatedAt<t&&(this.lastInvalidatedAt=e.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Eo(t,r,n){if(!t)return null;const i=r.getTextureDescriptor(t,n,!0);if(!i)return null;let{texture:s,mix:o,offset:a,tileSize:l,buffer:c,format:u}=i;if(!s||!u)return null;let d=!1;return"uint32"===u&&(d=!0,o[3]=0,o=Ls(e.ek,o,[0,n.paint.get("raster-particle-max-speed")]),a=Rs(e.ek,a,[0,n.paint.get("raster-particle-max-speed")])),{texture:s,textureOffset:[c/(l+2*c),l/(l+2*c)],tileSize:l,scalarData:d,scale:o,offset:a,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[u]]}}function No(e){const t=e._nearZ,r=e.projection.farthestPixelDistance(e),n=r-t,i=.2*e.height,s=t+i;return[t,r,(s-i-t)/n,(s-t)/n]}const Io=new e.ao(1,0,0,1),Po=new e.ao(0,1,0,1),Mo=new e.ao(0,0,1,1),Lo=new e.ao(1,0,1,1),Ro=new e.ao(0,1,1,1);function Do(t,r,n,i,s,o){for(let a=0;a<n.length;a++)if(s){const s=1,l=.8,c=new e.ao(i.r*l,i.g*l,i.b*l,1);Fo(t,r,n[a],i,-s,-s,o),Fo(t,r,n[a],i,-s,s,o),Fo(t,r,n[a],i,s,s,o),Fo(t,r,n[a],i,s,-s,o),Fo(t,r,n[a],c,0,0,o)}else Fo(t,r,n[a],i,0,0,o)}function Fo(t,r,n,i,s,o,a){const l=t.context,c=t.transform,u=l.gl,d="globe"===c.projection.name,h=d?["PROJECTION_GLOBE_VIEW"]:[];let p=e.bz(n.projMatrix);if(d&&e.aj(c.zoom)>0){const t=e.bj(n.canonical,c),r=e.el(t);p=e.aB(new Float32Array(16),c.globeMatrix,r),e.aB(p,c.projMatrix,p)}const m=e.bC();m[12]+=2*s/(e.o.devicePixelRatio*c.width),m[13]+=2*o/(e.o.devicePixelRatio*c.height),e.aB(p,m,p);const f=t.getOrCreateProgram("debug",{defines:h}),g=r.getTileByID(n.key);t.terrain&&t.terrain.setupElevationDraw(g,f);const y=Qr.disabled,_=en.disabled,v=t.colorModeForRenderPass(),x="$debug";l.activeTexture.set(u.TEXTURE0),t.emptyTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),d?g._makeGlobeTileDebugBuffers(t.context,c):g._makeDebugTileBoundsBuffers(t.context,c.projection);const b=g._tileDebugBuffer||t.debugBuffer,w=g._tileDebugIndexBuffer||t.debugIndexBuffer,j=g._tileDebugSegments||t.debugSegments;if(f.draw(t,u.LINE_STRIP,y,_,v,nn.disabled,Is(p,i.toPremultipliedRenderColor(null)),x,b,w,j,null,null,null,[g._globeTileDebugBorderBuffer]),a){const e=g.latestRawTileData,r=Math.floor((e&&e.byteLength||0)/1024);let i=n.canonical.toString();n.overscaledZ!==n.canonical.z&&(i+=" => ".concat(n.overscaledZ)),i+=" ".concat(g.state),i+=" ".concat(r,"kb"),function(e,t){e.initDebugOverlayCanvas();const r=e.debugOverlayCanvas,n=e.context.gl,i=e.debugOverlayCanvas.getContext("2d");i.clearRect(0,0,r.width,r.height),i.shadowColor="white",i.shadowBlur=2,i.lineWidth=1.5,i.strokeStyle="white",i.textBaseline="top",i.font="bold 36px Open Sans, sans-serif",i.fillText(t,5,5),i.strokeText(t,5,5),e.debugOverlayTexture.update(r),e.debugOverlayTexture.bind(n.LINEAR,n.CLAMP_TO_EDGE)}(t,i)}const S=r.getTile(n).tileSize,T=512/Math.min(S,512)*(n.overscaledZ/c.zoom)*.5,k=g._tileDebugTextBuffer||t.debugBuffer,A=g._tileDebugTextIndexBuffer||t.quadTriangleIndexBuffer,C=g._tileDebugTextSegments||t.debugSegments;f.draw(t,u.TRIANGLES,y,_,Jr.alphaBlended,nn.disabled,Is(p,e.ao.transparent.toPremultipliedRenderColor(null),T),x,k,A,C,null,null,null,[g._globeTileDebugTextBuffer])}function Oo(e,t,r,n){Bo(e,0,t+r/2,e.transform.width,r,n)}function zo(e,t,r,n){Bo(e,t-r/2,0,r,e.transform.height,n)}function Bo(t,r,n,i,s,o){const a=t.context,l=a.gl;l.enable(l.SCISSOR_TEST),l.scissor(r*e.o.devicePixelRatio,n*e.o.devicePixelRatio,i*e.o.devicePixelRatio,s*e.o.devicePixelRatio),a.clear({color:o}),l.disable(l.SCISSOR_TEST)}const Uo=e.ei([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Vo}=Uo;function qo(e,t,r,n){e.emplaceBack(t,r,n)}class Wo{constructor(t){this.vertexArray=new e.em,this.indices=new e.b0,qo(this.vertexArray,-1,-1,1),qo(this.vertexArray,1,-1,1),qo(this.vertexArray,-1,1,1),qo(this.vertexArray,1,1,1),qo(this.vertexArray,-1,-1,-1),qo(this.vertexArray,1,-1,-1),qo(this.vertexArray,-1,1,-1),qo(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=t.createVertexBuffer(this.vertexArray,Vo),this.indexBuffer=t.createIndexBuffer(this.indices),this.segment=e.bg.simpleSegment(0,0,36,12)}}function Ho(t,r,n,i,s,o){const a=t.context.gl,l=r.paint.get("sky-atmosphere-color"),c=r.paint.get("sky-atmosphere-halo-color"),u=r.paint.get("sky-atmosphere-sun-intensity"),d=((e,t,r,n,i)=>({u_matrix_3f:e,u_sun_direction:t,u_sun_intensity:r,u_color_tint_r:[n.r,n.g,n.b,n.a],u_color_tint_m:[i.r,i.g,i.b,i.a],u_luminance:5e-5}))(e.eo(e.dO(),i),s,u,l.toPremultipliedRenderColor(null),c.toPremultipliedRenderColor(null));a.framebufferTexture2D(a.FRAMEBUFFER,a.COLOR_ATTACHMENT0,a.TEXTURE_CUBE_MAP_POSITIVE_X+o,r.skyboxTexture,0),n.draw(t,a.TRIANGLES,Qr.disabled,en.disabled,Jr.unblended,nn.frontCW,d,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Go=e.ei([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Zo{constructor(t){const r=new e.ep;r.emplaceBack(-1,1,1,0,0),r.emplaceBack(1,1,1,1,0),r.emplaceBack(1,-1,1,1,1),r.emplaceBack(-1,-1,1,0,1);const n=new e.b0;n.emplaceBack(0,1,2),n.emplaceBack(2,3,0),this.vertexBuffer=t.createVertexBuffer(r,Go.members),this.indexBuffer=t.createIndexBuffer(n),this.segments=e.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Ko=e.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Yo{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Xo{constructor(t){this.colorModeAlphaBlendedWriteRGB=new Jr([1,Xr,1,Xr],e.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Jr([1,0,1,0],e.ao.transparent,[!1,!1,!1,!0]),this.params=new Yo,this.updateNeeded=!0}update(t){const r=t.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Zo(r);const t=this.params.sizeRange,n=this.params.intensityRange,i=function(t){const r=e.eq(30),n=[];for(let i=0;i<t;++i){const t=2*Math.PI*r(),i=Math.acos(1-2*r())-.5*Math.PI;n.push(e.d5(Math.cos(i)*Math.cos(t),Math.cos(i)*Math.sin(t),Math.sin(i)))}return n}(this.params.starsCount),s=e.eq(300),o=new e.er,a=new e.b0;let l=0;for(let r=0;r<i.length;++r){const c=e.c5([],i[r],200),u=Math.max(0,1+.01*t*(1*s()-.5)),d=Math.max(0,1+.01*n*(1*s()-.5));o.emplaceBack(c[0],c[1],c[2],-1,-1,u,d),o.emplaceBack(c[0],c[1],c[2],1,-1,u,d),o.emplaceBack(c[0],c[1],c[2],1,1,u,d),o.emplaceBack(c[0],c[1],c[2],-1,1,u,d),a.emplaceBack(l+0,l+1,l+2),a.emplaceBack(l+0,l+2,l+3),l+=4}this.starsVx=r.createVertexBuffer(o,Ko.members),this.starsIdx=r.createIndexBuffer(a),this.starsSegments=e.bg.simpleSegment(0,0,o.length,a.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(t,r){const n=t.context,i=n.gl,s=t.transform,o=new Qr(i.LEQUAL,Qr.ReadOnly,[0,1]),a=e.aj(s.zoom),l=t.style.getLut(r.scope),c="none"===r.properties.get("color-use-theme"),u=r.properties.get("color").toNonPremultipliedRenderColor(c?null:l),d="none"===r.properties.get("high-color-use-theme"),h=r.properties.get("high-color").toNonPremultipliedRenderColor(d?null:l),p="none"===r.properties.get("space-color-use-theme"),m=r.properties.get("space-color").toNonPremultipliedRenderColor(p?null:l),f=5e-4,g=e.es(r.properties.get("horizon-blend"),0,1,f,.25),y=e.dE(t,n,s)&&g===f?s.worldSize/(2*Math.PI*1.025)-1:s.globeRadius,_=t.frameCounter/1e3%1,v=e.ag(s.globeCenterInViewSpace),x=Math.sqrt(Math.pow(v,2)-Math.pow(y,2)),b=Math.acos(x/v),w=e=>{const r="globe"===s.projection.name?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];e&&r.push("ALPHA_PASS");const l=t.getOrCreateProgram("globeAtmosphere",{defines:r}),c=((e,t,r,n,i,s,o,a,l,c,u,d)=>({u_frustum_tl:e,u_frustum_tr:t,u_frustum_br:r,u_frustum_bl:n,u_horizon:i,u_transition:s,u_fadeout_range:o,u_atmosphere_fog_color:a.toArray01(),u_high_color:l.toArray01(),u_space_color:c.toArray01(),u_temporal_offset:u,u_horizon_angle:d}))(s.frustumCorners.TL,s.frustumCorners.TR,s.frustumCorners.BR,s.frustumCorners.BL,s.frustumCorners.horizon,a,g,u,h,m,_,b);t.uploadCommonUniforms(n,l);const d=this.atmosphereBuffer;d&&l.draw(t,i.TRIANGLES,o,en.disabled,e?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,nn.backCW,c,e?"atmosphere_glow_alpha":"atmosphere_glow",d.vertexBuffer,d.indexBuffer,d.segments)};w(!1),w(!0)}drawStars(t,r){const n=e.aA(r.properties.get("star-intensity"),0,1);if(0===n)return;const i=t.context,s=i.gl,o=t.transform,a=t.getOrCreateProgram("stars"),l=e.c7([]);e.c9(l,l,-o._pitch),e.c8(l,l,-o.angle),e.c9(l,l,e.an(o._center.lat)),e.et(l,l,-e.an(o._center.lng));const c=e.cc(new Float32Array(16),l),u=e.aB([],o.starsProjMatrix,c),d=e.eo([],c),h=e.eu([],d),p=[0,1,0];e.dQ(p,p,h),e.c5(p,p,this.params.sizeMultiplier);const m=[1,0,0];e.dQ(m,m,h),e.c5(m,m,this.params.sizeMultiplier);const f=(g=p,y=m,_=n,{u_matrix:Float32Array.from(u),u_up:g,u_right:y,u_intensity_multiplier:_});var g,y,_;t.uploadCommonUniforms(i,a),this.starsVx&&this.starsIdx&&a.draw(t,s.TRIANGLES,Qr.disabled,en.disabled,this.colorModeAlphaBlendedWriteRGB,nn.disabled,f,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class Jo{constructor(){this.visibleTiles=[]}updateBorders(t,r){const n=[],i=[],s=t._getRenderableCoordinates(!1,!0);for(const e of s){const s=t.getTile(e);if(!s.hasData())continue;const o=s.getBucket(r);o&&(o.isEmpty()||(n.push(e.key),i.push({bucket:o,tileID:e.canonical})))}let o=n.length!==this.visibleTiles.length;if(!o){n.sort();for(let e=0;e<n.length;e++)if(n[e]!==this.visibleTiles[e]){o=!0;break}}if(!o)return;const a=new Set;this.visibleTiles=n,i.sort((e,t)=>e.tileID.z-t.tileID.z||e.tileID.x-t.tileID.x||e.tileID.y-t.tileID.y);for(const l of i){const t=new Array,r=new Array,n=l.bucket;for(const e of n.featuresOnBorder)a.has(e.featureId)?r.push(e.footprintIndex):(a.add(e.featureId),t.push(e.footprintIndex));n.updateFootprintHiddenFlags(t,e.ev,!1),n.updateFootprintHiddenFlags(r,e.ev,!0)}}}function Qo(t,r){const n=[...t],i=r.cameraWorldSizeForFog/r.worldSize,s=e.bA([]);return e.cS(s,s,[i,i,1]),e.aB(n,s,n),e.aB(n,r.worldToFogMatrix,n),n}function $o(t,r,n,i,s){const o=n.material,a=i.context,{baseColorTexture:l,metallicRoughnessTexture:c}=o.pbrMetallicRoughness,{normalTexture:u,occlusionTexture:d,emissionTexture:h}=o;function p(e,r,n){if(e&&(t.push(r),a.activeTexture.set(a.gl.TEXTURE0+n),e.gfxTexture)){const{minFilter:t,magFilter:r,wrapS:n,wrapT:i}=e.sampler;e.gfxTexture.bindExtraParam(t,r,n,i)}}p(l,"HAS_TEXTURE_u_baseColorTexture",un.BaseColor),p(c,"HAS_TEXTURE_u_metallicRoughnessTexture",un.MetallicRoughness),p(u,"HAS_TEXTURE_u_normalTexture",un.Normal),p(d,"HAS_TEXTURE_u_occlusionTexture",un.Occlusion),p(h,"HAS_TEXTURE_u_emissionTexture",un.Emission),s&&(s.texture||(s.texture=new e.d$(i.context,s.image,[s.image.height,s.image.height,s.image.height],a.gl.RGBA8)),a.activeTexture.set(a.gl.TEXTURE0+un.LUT),s.texture&&s.texture.bind(a.gl.LINEAR,a.gl.CLAMP_TO_EDGE),t.push("APPLY_LUT_ON_GPU")),n.texcoordBuffer&&(t.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(n.texcoordBuffer)),n.colorBuffer&&(t.push(12===n.colorBuffer.itemSize?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(n.colorBuffer)),n.normalBuffer&&(t.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(n.normalBuffer)),n.pbrBuffer&&(t.push("HAS_ATTRIBUTE_a_pbr"),t.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(n.pbrBuffer)),"OPAQUE"!==o.alphaMode&&"MASK"!==o.alphaMode||t.push("UNPREMULT_TEXTURE_IN_SHADER"),o.defined||t.push("DIFFUSE_SHADED");const m=i.shadowRenderer;m&&(t.push("RENDER_SHADOWS","DEPTH_TEXTURE"),m.useNormalOffset&&t.push("NORMAL_OFFSET"))}function ea(t,r,n,i,s,o){const a=t.modelOpacity,l=r.context,c=new Qr(r.context.gl.LEQUAL,t.isLightMesh?Qr.ReadOnly:Qr.ReadWrite,r.depthRangeFor3D),u=r.transform,d=t.mesh,h=d.material,p=h.pbrMetallicRoughness,m=r.style.fog;let f;f="pixels"===r.transform.projection.zAxisUnit?[...t.nodeModelMatrix]:e.aB([],i.zScaleMatrix,t.nodeModelMatrix),e.aB(f,i.negCameraPosMatrix,f);const g=e.bl([],f);e.eg(g,g);const y="none"===n.paint.get("model-color-use-theme").constantOr("default"),_=n.paint.get("model-emissive-strength").constantOr(0),v=Zs(new Float32Array(t.worldViewProjection),new Float32Array(f),new Float32Array(g),null,r,a,p.baseColorFactor,h.emissiveFactor,p.metallicFactor,p.roughnessFactor,h,_,n,void 0,void 0,t.materialOverride,t.modelColor),x={defines:[]},b=[],w=r.shadowRenderer;w&&(w.useNormalOffset=!1),$o(x.defines,b,d,r,y?null:n.lut);let j=null;if(m){const e=Qo(t.nodeModelMatrix,r.transform);if(j=new Float32Array(e),"globe"!==u.projection.name){const t=d.aabb.min,r=d.aabb.max,[n,i]=m.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);x.overrideFog=n>=Ze||i>=Ze}}const S=mn(r,n.paint.get("model-cutoff-fade-range"));S.shouldRenderCutoff&&x.defines.push("RENDER_CUTOFF");const T=r.getOrCreateProgram("model",x);r.uploadCommonUniforms(l,T,null,j,S),"shadow"!==r.renderPass&&w&&w.setupShadowsFromMatrix(t.nodeModelMatrix,T),T.draw(r,l.gl.TRIANGLES,c,s,o,d.material.doubleSided?nn.disabled:nn.backCCW,v,n.id,d.vertexBuffer,d.indexBuffer,d.segments,n.paint,r.transform.zoom,void 0,b)}function ta(e,t){return e.style._importedAsBasemap?"basemap":t.scope}function ra(t,r,n,i,s,o,a,l,c,u){const d=t.transform,h=!!r.isGeometryBloom&&r.isGeometryBloom;if(h&&"shadow"===t.renderPass)return;const p="globe"===d.projection.name?e.eD(n,d):[...n];e.aB(p,p,r.globalMatrix);const m=e.aB([],i,p);if(r.meshes)for(const f of r.meshes){const t=l.get(f.material.name);if(t&&t.opacity<=0)continue;if("BLEND"!==f.material.alphaMode){a.push({mesh:f,depth:0,modelIndex:s,worldViewProjection:m,nodeModelMatrix:p,isLightMesh:h,materialOverride:t,modelOpacity:c,modelColor:u});continue}const r=e.af([],f.centroid,m);!d.isOrthographic&&r[2]<=0||o.push({mesh:f,depth:r[2],modelIndex:s,worldViewProjection:m,nodeModelMatrix:p,isLightMesh:h,materialOverride:t,modelOpacity:c,modelColor:u})}if(r.children)for(const e of r.children)ra(t,e,n,i,s,o,a,l,c,u)}function na(e,t,r,n){const i=r.shadowRenderer;if(!i)return;const s=i.getShadowPassDepthMode(),o=i.getShadowPassColorMode(),a=i.calculateShadowPassMatrixFromMatrix(t),l=Ks(a);r.getOrCreateProgram("modelDepth",{defines:r._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(r,r.context.gl.TRIANGLES,s,en.disabled,o,nn.disabled,l,n.id,e.vertexBuffer,e.indexBuffer,e.segments,n.paint,r.transform.zoom,void 0,void 0)}function ia(e,t,r,n,i,s){for(const o of i){const i=Object.assign({},n);i.part=o;const a={type:"Unknown",id:t,properties:i},l={orientation:e.paint.get("model-rotation").evaluate(a,r)};s.set(o,l)}}function sa(e,t,r,n,i,s){for(const o of i){const i=Object.assign({},n);i.part=o;const a={type:"Unknown",id:t,properties:i},l={color:e.paint.get("model-color").evaluate(a,r),colorMix:e.paint.get("model-color-mix-intensity").evaluate(a,r),opacity:e.paint.get("model-opacity").evaluate(a,r),emissionStrength:e.paint.get("model-emissive-strength").evaluate(a,r)};s.set(o,l)}}function oa(e,t,r,n,i){let s=!1;for(const a of n)1!==a.modelOpacity&&(ea(a,e,t,i[a.modelIndex],en.disabled,Jr.disabled),s=!0);for(const a of n)ea(a,e,t,i[a.modelIndex],1!==a.modelOpacity?e.stencilModeFor3D():en.disabled,e.colorModeForRenderPass());s&&e.resetStencilClippingMasks();const o=Jr.additive;for(const a of r)ea(a,e,t,i[a.modelIndex],en.disabled,a.isLightMesh?o:e.colorModeForRenderPass())}function aa(t,r,n){const i=r.updateZoomBasedPaintProperties(),s=function(t,r,n){let i,s,o,a=t.terrain?t.terrain.exaggeration():0;if(t.terrain&&a>0){const r=t.terrain,s=r.findDEMTileFor(n);s&&s.dem?i=e.eF.create(r,n,s):a=0}if(0===a&&(r.terrainElevationMin=0,r.terrainElevationMax=0),a===r.validForExaggeration&&(0===a||i&&i._demTile&&i._demTile.tileID===r.validForDEMTile.id&&i._dem._timestamp===r.validForDEMTile.timestamp))return!1;for(const e in r.instancesPerModel){const t=r.instancesPerModel[e];for(let e=0;e<t.instancedDataArray.length;++e){const n=(i?a*i.getElevationAt(0|t.instancedDataArray.float32[16*e],0|t.instancedDataArray.float32[16*e+1],!0,!0):0)+t.instancesEvaluatedElevation[e];t.instancedDataArray.float32[16*e+6]=n,s=s?Math.min(r.terrainElevationMin,n):n,o=o?Math.max(r.terrainElevationMax,n):n}}return r.terrainElevationMin=s||0,r.terrainElevationMax=o||0,r.validForExaggeration=a,r.validForDEMTile=i&&i._demTile?{id:i._demTile.tileID,timestamp:i._dem._timestamp}:{id:void 0,timestamp:0},!0}(t,r,n);(i||s)&&(r.uploaded=!1,r.upload(t.context))}const la={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new e.d9([0,0,0],[e.al,e.al,0])};function ca(t,r){const n=1<<t.canonical.z,i=r.getFreeCameraOptions().position,s=r.elevation,o=t.canonical.x/n,a=(t.canonical.x+1)/n,l=t.canonical.y/n,c=(t.canonical.y+1)/n;let u=r._centerAltitude;if(s){const e=s.getMinMaxForTile(t);e&&e.max>u&&(u=e.max)}const d=e.aA(i.x,o,a)-i.x,h=e.aA(i.y,l,c)-i.y,p=e.cf(u,r.center.lat)-i.z;return r._zoomFromMercatorZ(Math.sqrt(d*d+h*h+p*p))}function ua(e,t,r,n,i,s,o){const a=e.context,l="shadow"===e.renderPass,c=e.shadowRenderer,u=l&&c?c.getShadowPassDepthMode():new Qr(a.gl.LEQUAL,Qr.ReadWrite,e.depthRangeFor3D),d=e.isTileAffectedByFog(s),h="globe"===e.transform.projection.name;if(r.meshes)for(const p of r.meshes){const m=h?[]:["MODEL_POSITION_ON_GPU"],f=[];let g,y,_;const v=!h&&n.instancedDataArray.length>20;v&&m.push("INSTANCED_ARRAYS");const x=mn(e,t.paint.get("model-cutoff-fade-range"));if(x.shouldRenderCutoff&&m.push("RENDER_CUTOFF"),l&&c)g=e.getOrCreateProgram("modelDepth",{defines:m}),y=Ks(o.shadowTileMatrix,o.shadowTileMatrix,Float32Array.from(r.globalMatrix)),_=c.getShadowPassColorMode();else{$o(m,f,p,e,"none"===t.paint.get("model-color-use-theme").constantOr("default")?null:t.lut),g=e.getOrCreateProgram("model",{defines:m,overrideFog:d});const n=p.material,l=n.pbrMetallicRoughness,u=t.paint.get("model-opacity").constantOr(1),h=t.paint.get("model-emissive-strength").constantOr(0);y=Zs(s.expandedProjMatrix,Float32Array.from(r.globalMatrix),new Float32Array(16),null,e,u,l.baseColorFactor,n.emissiveFactor,l.metallicFactor,l.roughnessFactor,n,h,t,i),c&&(o.shadowUniformsInitialized?g.setShadowUniformValues(a,c.getShadowUniformValues()):(c.setupShadows(s.toUnwrapped(),g,"model-tile"),o.shadowUniformsInitialized=!0)),_=x.shouldRenderCutoff||u<1||"OPAQUE"!==n.alphaMode?Jr.alphaBlended:Jr.unblended}e.uploadCommonUniforms(a,g,s.toUnwrapped(),null,x);const b=p.material.doubleSided?nn.disabled:nn.backCCW;if(v)f.push(n.instancedDataBuffer),g.draw(e,a.gl.TRIANGLES,u,en.disabled,_,b,y,t.id,p.vertexBuffer,p.indexBuffer,p.segments,t.paint,e.transform.zoom,void 0,f,n.instancedDataArray.length);else{const r=l?"u_instance":"u_normal_matrix";for(let i=0;i<n.instancedDataArray.length;++i)y[r]=new Float32Array(n.instancedDataArray.arrayBuffer,64*i,16),g.draw(e,a.gl.TRIANGLES,u,en.disabled,_,b,y,t.id,p.vertexBuffer,p.indexBuffer,p.segments,t.paint,e.transform.zoom,void 0,f)}}if(r.children)for(const p of r.children)ua(e,t,p,n,i,s,o)}const da=[1,-1,1];function ha(t,r,n,i){if(!n.modelManager)return!0;const s=n.modelManager;if(!n.shadowRenderer)return!0;const o=n.shadowRenderer,a=r.aabb;let l=!0,c=t.maxHeight;if(0===c){let e=0;for(const r in t.instancesPerModel){const t=s.getModel(r,i);t?e=Math.max(e,Math.max(Math.max(t.aabb.max[0],t.aabb.max[1]),t.aabb.max[2])):l=!1}c=t.maxScale*e*1.41+t.maxVerticalOffset,l&&(t.maxHeight=c)}a.max[2]=c,a.min[2]+=t.terrainElevationMin,a.max[2]+=t.terrainElevationMax,e.af(a.min,a.min,r.tileMatrix),e.af(a.max,a.max,r.tileMatrix);const u=a.intersects(o.getCurrentCascadeFrustum());return 0===n.currentShadowCascade&&(t.isInsideFirstShadowMapFrustum=2===u),0===u}function pa(t,r){const n=t.uniformValues.u_cutoff_params[0],i=t.uniformValues.u_cutoff_params[1],s=t.uniformValues.u_cutoff_params[2],o=t.uniformValues.u_cutoff_params[3];return i===n||o===s?1:e.aA(((r-n)/(i-n)-s)/(o-s),0,1)}function ma(t,r,n,i){if(r.pitch<20)return 1;const s=r.getWorldToCameraMatrix();e.aB(s,s,t);const o=e.bU(n.min[0],n.min[1],n.min[2],1);let a=e.aC(e.eG(),o,s),l=a,c=a;o[1]=n.max[1],a=e.aC(e.eG(),o,s),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,o[0]=n.max[0],a=e.aC(e.eG(),o,s),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c,o[1]=n.min[1],a=e.aC(e.eG(),o,s),l=a[1]<l[1]?a:l,c=a[1]>c[1]?a:c;const u=e.aA(i[0],0,1),d=100*r.pixelsPerMeter*e.aA(i[1],0,1),h=e.aA(i[2],0,1),p=e.eH(e.eG(),l,c,u),m=Math.tan(.5*r.fovX),f=-p[2]*m;if(0===d)return p[1]<-Math.abs(f)?h:1;const g=(-Math.abs(f)-p[1])/d,y=(e,t,r)=>(1-r)*e+r*t,_=e.aA(y(1,h,g),h,1);return y(1,_,e.aA((r.pitch-20)/20,0,1))}class fa{}class ga{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(t,r,n){{const e=this._storage.get(r.id);if(e)return e.lastUsedFrameIdx=t,e.buf}const i=n.gl,s=i.getBufferParameter(i.ELEMENT_ARRAY_BUFFER,i.BUFFER_SIZE),o=new ArrayBuffer(s),a=new Int16Array(o);i.getBufferSubData(i.ELEMENT_ARRAY_BUFFER,0,new Int16Array(o));const l=new e.eJ;for(let e=0;e<s/2;e+=3){const t=a[e],r=a[e+1],n=a[e+2];l.emplaceBack(t,r),l.emplaceBack(r,n),l.emplaceBack(n,t)}const c=n.bindVertexArrayOES.current,u=new fa;return u.buf=new Xs(n,l),u.lastUsedFrameIdx=t,this._storage.set(r.id,u),n.bindVertexArrayOES.set(c),u.buf}update(e){for(const[t,r]of this._storage)e-r.lastUsedFrameIdx>30&&(r.buf.destroy(),this._storage.delete(t))}destroy(){for(const[e,t]of this._storage)t.buf.destroy(),this._storage.delete(e)}}class ya{constructor(){this.occluderSize=30,this.depthOffset=-1e-4}}const _a=e.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class va{constructor(e){this.revealStart=11,this.revealRange=2}}const xa=e.ei([{type:"Float32",name:"a_pos_2f",components:2}]);class ba{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(t,r){const n=t.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const r=new e.eK,n=new e.b0;r.emplaceBack(-1,-1),r.emplaceBack(1,-1),r.emplaceBack(1,1),r.emplaceBack(-1,1),n.emplaceBack(0,1,2),n.emplaceBack(0,2,3),this.vignetteVx=t.context.createVertexBuffer(r,xa.members),this.vignetteIdx=t.context.createIndexBuffer(n)}const i=e.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){t.uploadCommonUniforms(t.context,n);const e={u_vignetteShape:(s={vignetteShape:[r.start,r.range,Math.pow(10,r.fadePower)],vignetteColor:[r.color.r,r.color.g,r.color.b,r.color.a*r.strength]}).vignetteShape,u_vignetteColor:s.vignetteColor};n.draw(t,t.context.gl.TRIANGLES,Qr.disabled,en.disabled,Jr.alphaBlended,nn.disabled,e,"vignette",this.vignetteVx,this.vignetteIdx,i)}var s}}class wa{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(t,r){const n=t.getFreeCameraOptions().position,i=n.toAltitude(),s=n.toLngLat(),o=e.an(s.lng),a=e.an(s.lat),l=t.pixelsPerMeter/r,c=o*e.eM,u=e.eM*Math.log(Math.tan(Math.PI/4+a/2));if(void 0===this._offsetXPrev)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const e=-this._offsetYPrev+u,t=-this._elevationPrev+i;this._accumulatedOffsetX+=(-this._offsetXPrev+c)*l,this._accumulatedOffsetY+=e*l,this._accumulatedElevation+=t*l,this._offsetXPrev=c,this._offsetYPrev=u,this._elevationPrev=i}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ja(e,t){return[-(e[0]-Math.floor(e[0]/t)*t),-(e[1]-Math.floor(e[1]/t)*t),-(e[2]-Math.floor(e[2]/t)*t)]}function Sa(t){const r=e.eq(1323123451230),n=[];for(let i=0;i<t;++i){const t=2*r()-1,i=2*r()-1,s=2*r()-1;n.push(e.d5(t,i,s))}return n}function Ta(t,r,n,i,s){const o=e.aA((s-n)/(i-n),0,1);return(1-o)*t+o*r}class ka{constructor(e){this._movement=new wa,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new ba,this._ppmScaleFactor=e}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(t,r){const n=t.transform;this._movement.update(n,this._ppmScaleFactor);const i=n.starsProjMatrix,s=e.c7([]);e.c9(s,s,e.an(90)-n._pitch),e.c8(s,s,-n.angle);const o=e.cc(new Float32Array(16),s),a=e.eL(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),l=e.eg([],a),c=e.aB([],l,o),u=Date.now()/1e3;return this._accumulatedTimeFromStart+=(u-this._prevTime)*r,this._prevTime=u,{projectionMatrix:i,modelviewMatrix:c}}}class Aa extends ka{constructor(e){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new va("Precipitation > Rain"),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const t=Sa(this.particlesCount),n=new e.eN,i=new e.b0;let s=0;const o=e.eq(1323123451230);for(let e=0;e<t.length;++e){const r=t[e],a=[2*o()-1,o(),o(),o()];n.emplaceBack(r[0],r[1],r[2],-1,-1,...a),n.emplaceBack(r[0],r[1],r[2],1,-1,...a),n.emplaceBack(r[0],r[1],r[2],1,1,...a),n.emplaceBack(r[0],r[1],r[2],-1,1,...a),i.emplaceBack(s+0,s+1,s+2),i.emplaceBack(s+0,s+2,s+3),s+=4}this.particlesVx=r.createVertexBuffer(n,_a.members),this.particlesIdx=r.createIndexBuffer(i)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.rain)return;const r=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},n=t.transform.zoom;if(r.revealStart>n)return;const i=Ta(0,1,r.revealStart,r.revealStart+r.revealRange,n);if(!this.particlesVx||!this.particlesIdx)return;const s=structuredClone(this._params);let o=[-s.direction.x,s.direction.y,-100];e.aw(o,o);const a=structuredClone(this._vignetteParams);a.strength*=i,s.overrideStyleParameters||(s.intensity=t.style.rain.state.density,s.timeFactor=t.style.rain.state.intensity,s.color=structuredClone(t.style.rain.state.color),o=structuredClone(t.style.rain.state.direction),s.screenThinning.intensity=t.style.rain.state.centerThinning,s.dropletSizeX=t.style.rain.state.dropletSize[0],s.dropletSizeYScale=t.style.rain.state.dropletSize[1]/t.style.rain.state.dropletSize[0],s.distortionStrength=100*t.style.rain.state.distortionStrength,a.strength=1,a.color=structuredClone(t.style.rain.state.vignetteColor));const l=this.updateOnRender(t,s.timeFactor),c=t.context,u=c.gl,d=t.transform;this.screenTexture&&this.screenTexture.size[0]===t.width&&this.screenTexture.size[1]===t.height||(this.screenTexture=new e.T(c,{width:t.width,height:t.height,data:null},u.RGBA8)),s.distortionStrength>0&&(c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE),u.copyTexSubImage2D(u.TEXTURE_2D,0,0,0,0,0,t.width,t.height));const h=t.getOrCreateProgram("rainParticle");t.uploadCommonUniforms(c,h),c.activeTexture.set(u.TEXTURE0),this.screenTexture.bind(u.LINEAR,u.CLAMP_TO_EDGE);const p=[s.color.r,s.color.g,s.color.b,s.color.a],m=(r,n)=>{const i=ja(this._movement.getPosition(),r),a=s.dropletSizeX,c=s.dropletSizeX*s.dropletSizeYScale,m=t.width/2,f=t.height/2,g=Ta(0,s.screenThinning.start,0,1,s.screenThinning.intensity),y=Ta(.001,s.screenThinning.range,0,1,s.screenThinning.intensity),_=Ta(0,s.screenThinning.particleOffset,0,1,s.screenThinning.intensity),v=(x={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:i,velocityConeAperture:s.velocityConeAperture,velocity:s.velocity,boxSize:r,rainDropletSize:[a,c],distortionStrength:s.distortionStrength,rainDirection:o,color:p,screenSize:[d.width,d.height],thinningCenterPos:[m,f],thinningShape:[g,y,Math.pow(10,s.screenThinning.fadePower)],thinningAffectedRatio:s.screenThinning.affectedRatio,thinningParticleOffset:_,shapeDirectionalPower:s.shapeDirPower,shapeNormalPower:s.shapeNormalPower,mode:n?0:1},{u_modelview:Float32Array.from(x.modelview),u_projection:Float32Array.from(x.projection),u_time:x.time,u_cam_pos:x.camPos,u_texScreen:0,u_velocityConeAperture:x.velocityConeAperture,u_velocity:x.velocity,u_boxSize:x.boxSize,u_rainDropletSize:x.rainDropletSize,u_distortionStrength:x.distortionStrength,u_rainDirection:x.rainDirection,u_color:x.color,u_screenSize:x.screenSize,u_thinningCenterPos:x.thinningCenterPos,u_thinningShape:x.thinningShape,u_thinningAffectedRatio:x.thinningAffectedRatio,u_thinningParticleOffset:x.thinningParticleOffset,u_shapeDirectionalPower:x.shapeDirectionalPower,u_shapeNormalPower:x.shapeNormalPower,u_mode:x.mode});var x;const b=Math.round(s.intensity*this.particlesCount),w=e.bg.simpleSegment(0,0,4*b,2*b);h.draw(t,u.TRIANGLES,Qr.disabled,en.disabled,Jr.alphaBlended,nn.disabled,v,"rain_particles",this.particlesVx,this.particlesIdx,w)};s.distortionStrength>0&&m(s.boxSize,!0),m(s.boxSize,!1),this._vignette.draw(t,a)}}const Ca=e.ei([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ea extends ka{constructor(e){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new va("Precipitation > Snow"),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(t){const r=t.context;if(!this.particlesVx){const t=Sa(this.particlesCount),n=new e.eO,i=new e.b0;let s=0;const o=e.eq(1323123451230);for(let e=0;e<t.length;++e){const r=t[e],a=o(),l=o(),c=o(),u=[e/t.length,a,l,c],d=[o(),o()];n.emplaceBack(r[0],r[1],r[2],-1,-1,...u,...d),n.emplaceBack(r[0],r[1],r[2],1,-1,...u,...d),n.emplaceBack(r[0],r[1],r[2],1,1,...u,...d),n.emplaceBack(r[0],r[1],r[2],-1,1,...u,...d),i.emplaceBack(s+0,s+1,s+2),i.emplaceBack(s+0,s+2,s+3),s+=4}this.particlesVx=r.createVertexBuffer(n,Ca.members),this.particlesIdx=r.createIndexBuffer(i)}}draw(t){if(!this._params.overrideStyleParameters&&!t.style.snow)return;const r=structuredClone(this._params);let n=[-r.direction.x,r.direction.y,-100];e.aw(n,n);const i=structuredClone(this._vignetteParams),s=r.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},o=t.transform.zoom;if(s.revealStart>o)return;const a=Ta(0,1,s.revealStart,s.revealStart+s.revealRange,o);i.strength*=a,r.overrideStyleParameters||(r.intensity=t.style.snow.state.density,r.timeFactor=t.style.snow.state.intensity,r.color=structuredClone(t.style.snow.state.color),n=structuredClone(t.style.snow.state.direction),r.screenThinning.intensity=t.style.snow.state.centerThinning,r.billboardSize=2.79*t.style.snow.state.flakeSize,i.strength=1,i.color=structuredClone(t.style.snow.state.vignetteColor));const l=this.updateOnRender(t,r.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const c=t.context,u=c.gl,d=t.transform,h=t.getOrCreateProgram("snowParticle");t.uploadCommonUniforms(c,h),((r,i,s)=>{const o=ja(this._movement.getPosition(),r),a=d.width/2,c=d.height/2,p=Ta(0,s.screenThinning.start,0,1,s.screenThinning.intensity),m=Ta(.001,s.screenThinning.range,0,1,s.screenThinning.intensity),f=Ta(0,s.screenThinning.particleOffset,0,1,s.screenThinning.intensity),g=(y={modelview:l.modelviewMatrix,projection:l.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:o,velocityConeAperture:s.velocityConeAperture,velocity:s.velocity,horizontalOscillationRadius:s.horizontalOscillationRadius,horizontalOscillationRate:s.horizontalOscillationRate,boxSize:r,billboardSize:1*s.billboardSize,simpleShapeParameters:[s.shapeFadeStart,s.shapeFadePower],screenSize:[d.width,d.height],thinningCenterPos:[a,c],thinningShape:[p,m,Math.pow(10,s.screenThinning.fadePower)],thinningAffectedRatio:s.screenThinning.affectedRatio,thinningParticleOffset:f,color:[s.color.r,s.color.g,s.color.b,s.color.a],direction:n},{u_modelview:Float32Array.from(y.modelview),u_projection:Float32Array.from(y.projection),u_time:y.time,u_cam_pos:y.camPos,u_velocityConeAperture:y.velocityConeAperture,u_velocity:y.velocity,u_horizontalOscillationRadius:y.horizontalOscillationRadius,u_horizontalOscillationRate:y.horizontalOscillationRate,u_boxSize:y.boxSize,u_billboardSize:y.billboardSize,u_simpleShapeParameters:y.simpleShapeParameters,u_screenSize:y.screenSize,u_thinningCenterPos:y.thinningCenterPos,u_thinningShape:y.thinningShape,u_thinningAffectedRatio:y.thinningAffectedRatio,u_thinningParticleOffset:y.thinningParticleOffset,u_particleColor:y.color,u_direction:y.direction});var y;const _=Math.round(s.intensity*this.particlesCount),v=e.bg.simpleSegment(0,0,4*_,2*_);this.particlesVx&&this.particlesIdx&&h.draw(t,u.TRIANGLES,Qr.disabled,en.disabled,Jr.alphaBlended,nn.disabled,g,"snow_particles",this.particlesVx,this.particlesIdx,v)})(r.boxSize,0,r),this._vignette.draw(t,i)}}const Na={symbol:function(t,r,n,i,s){if("translucent"!==t.renderPass)return;const o=en.disabled,a=t.colorModeForRenderPass(),l=n.layout.get("text-variable-anchor"),c=n.layout.get("text-size-scale-range"),u=e.aA(t.scaleFactor,c[0],c[1]);l&&function(t,r,n,i,s,o,a,l){const c=r.transform,u="map"===s,d="map"===o;for(const h of t){const t=i.getTile(h),r=t.getBucket(n);if(!r||!r.text||!r.text.segments.get().length)continue;const s=e.bK(r.textSizeData,c.zoom,l),o=rr(h,r.getProjection(),c),p=c.calculatePixelsToTileUnitsMatrix(t),m=ar(o,t.tileID.canonical,d,u,c,r.getProjection(),p),f=r.hasIconTextFit()&&r.hasIconData();s&&oo(r,u,d,a,c,m,h,Math.pow(2,c.zoom-t.tileID.overscaledZ),s,f)}}(i,t,n,r,n.layout.get("text-rotation-alignment"),n.layout.get("text-pitch-alignment"),s,u);const d=0!==n.paint.get("icon-opacity").constantOr(1),h=0!==n.paint.get("text-opacity").constantOr(1);void 0!==n.layout.get("symbol-sort-key").constantOr(1)&&(d||h)?ao(t,r,n,i,o,a):(d&&ao(t,r,n,i,o,a,{onlyIcons:!0}),h&&ao(t,r,n,i,o,a,{onlyText:!0})),r.map.showCollisionBoxes&&(ro(t,r,n,i,n.paint.get("text-translate"),n.paint.get("text-translate-anchor"),!0),ro(t,r,n,i,n.paint.get("icon-translate"),n.paint.get("icon-translate-anchor"),!1))},circle:function(t,r,n,i){if("translucent"!==t.renderPass)return;const s=n.paint.get("circle-opacity"),o=n.paint.get("circle-stroke-width"),a=n.paint.get("circle-stroke-opacity"),l=void 0!==n.layout.get("circle-sort-key").constantOr(1),c=n.paint.get("circle-emissive-strength");if(0===s.constantOr(1)&&(0===o.constantOr(1)||0===a.constantOr(1)))return;const u=t.context,d=u.gl,h=t.transform,p=!(!t.terrain||!t.terrain.enabled),m=n.layout.get("circle-elevation-reference"),f=t.depthModeForSublayer(0,Qr.ReadOnly),g=new Qr(t.context.gl.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D),y="none"===m||p?f:g,_=en.disabled,v=t.colorModeForDrapableLayerRenderPass(c),x="globe"===h.projection.name,b=[e.aF(h.center.lng),e.aJ(h.center.lat)],w=[];for(let S=0;S<i.length;S++){const s=i[S],o=r.getTile(s),a=o.getBucket(n);if(!a||a.projection.name!==h.projection.name)continue;const c=a.programConfigurations.get(n.id),u=a.layoutVertexBuffer,d=a.globeExtVertexBuffer,p=a.indexBuffer,m=e.e0(n),f=[d],g=t.isTileAffectedByFog(s);x&&m.push("PROJECTION_GLOBE_VIEW"),m.push("DEPTH_D24"),t.terrain&&h.depthOcclusionForSymbolsAndCircles&&m.push("DEPTH_OCCLUSION"),a.hasElevation&&!t.terrain&&(m.push("ELEVATED_ROADS"),f.push(a.elevatedLayoutVertexBuffer));const y=t.getOrCreateProgram("circle",{config:c,defines:m,overrideFog:g}),_=h.projection.createInversionMatrix(h,s.canonical),v={programConfiguration:c,program:y,layoutVertexBuffer:u,dynamicBuffers:f,indexBuffer:p,uniformValues:e.e1(t,s,o,_,b,n),tile:o};if(l){const t=a.segments.get();for(const r of t)w.push({segments:new e.bg([r]),sortKey:r.sortKey,state:v})}else w.push({segments:a.segments,sortKey:0,state:v})}l&&w.sort((e,t)=>e.sortKey-t.sortKey);const j={useDepthForOcclusion:h.depthOcclusionForSymbolsAndCircles};for(const e of w){const{programConfiguration:r,program:i,layoutVertexBuffer:s,dynamicBuffers:o,indexBuffer:a,uniformValues:l,tile:c}=e.state,p=e.segments;t.terrain&&t.terrain.setupElevationDraw(c,i,j),t.uploadCommonUniforms(u,i,c.tileID.toUnwrapped()),i.draw(t,d.TRIANGLES,y,_,v,nn.disabled,l,n.id,s,a,p,n.paint,h.zoom,r,o)}},heatmap:function(t,r,n,i){if(0!==n.paint.get("heatmap-opacity"))if("offscreen"===t.renderPass){const s=t.context,o=s.gl,a=en.disabled,l=new Jr([o.ONE,o.ONE,o.ONE,o.ONE],e.ao.transparent,[!0,!0,!0,!0]);!function(e,t,r,n){const i=e.gl,s=t.width*n,o=t.height*n;e.activeTexture.set(i.TEXTURE1),e.viewport.set([0,0,s,o]);let a=r.heatmapFbo;if(!a||a&&(a.width!==s||a.height!==o)){a&&a.destroy();const t=i.createTexture();i.bindTexture(i.TEXTURE_2D,t),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_2D,i.TEXTURE_MAG_FILTER,i.LINEAR),a=r.heatmapFbo=e.createFramebuffer(s,o,1,null),function(e,t,r,n,i,s){const o=e.gl;o.texImage2D(o.TEXTURE_2D,0,e.extRenderToTextureHalfFloat?o.RGBA16F:o.RGBA,i,s,0,o.RGBA,e.extRenderToTextureHalfFloat?o.HALF_FLOAT:o.UNSIGNED_BYTE,null),n.colorAttachment0.set(r)}(e,0,t,a,s,o)}else i.bindTexture(i.TEXTURE_2D,a.colorAttachment0.get()),e.bindFramebuffer.set(a.framebuffer)}(s,t,n,"globe"===t.transform.projection.name?.5:.25),s.clear({color:e.ao.transparent});const c=t.transform,u="globe"===c.projection.name,d=u?["PROJECTION_GLOBE_VIEW"]:[],h=u?nn.frontCCW:nn.disabled,p=[e.aF(c.center.lng),e.aJ(c.center.lat)];for(let e=0;e<i.length;e++){const m=i[e];if(r.hasRenderableParent(m))continue;const f=r.getTile(m),g=f.getBucket(n);if(!g||g.projection.name!==c.projection.name)continue;const y=t.isTileAffectedByFog(m),_=g.programConfigurations.get(n.id),v=t.getOrCreateProgram("heatmap",{config:_,defines:d,overrideFog:y}),{zoom:x}=t.transform;t.terrain&&t.terrain.setupElevationDraw(f,v),t.uploadCommonUniforms(s,v,m.toUnwrapped());const b=c.projection.createInversionMatrix(c,m.canonical);v.draw(t,o.TRIANGLES,Qr.disabled,a,l,h,Ms(t,m,f,b,p,x,n.paint.get("heatmap-intensity")),n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,_,u?[g.globeExtVertexBuffer]:null)}s.viewport.set([0,0,t.width,t.height])}else"translucent"===t.renderPass&&(t.context.setColorMode(t.colorModeForRenderPass()),function(t,r){const n=t.context,i=n.gl,s=r.heatmapFbo;if(!s)return;n.activeTexture.set(i.TEXTURE0),i.bindTexture(i.TEXTURE_2D,s.colorAttachment0.get()),n.activeTexture.set(i.TEXTURE1);let o=r.colorRampTexture;o||(o=r.colorRampTexture=new e.T(n,r.colorRamp,i.RGBA8)),o.bind(i.LINEAR,i.CLAMP_TO_EDGE),t.getOrCreateProgram("heatmapTexture").draw(t,i.TRIANGLES,Qr.disabled,en.disabled,t.colorModeForRenderPass(),nn.disabled,((e,t)=>({u_image:0,u_color_ramp:1,u_opacity:t.paint.get("heatmap-opacity")}))(0,r),r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments,r.paint,t.transform.zoom)}(t,n))},line:function(t,r,n,i){if("translucent"!==t.renderPass)return;const s=n.paint.get("line-opacity"),o=n.paint.get("line-width");if(0===s.constantOr(1)||0===o.constantOr(1))return;const a=n.paint.get("line-emissive-strength").isConstant(),l=n.paint.get("line-emissive-strength").constantOr(0),c=n.paint.get("line-occlusion-opacity"),u=n.layout.get("line-elevation-reference"),d="meters"===n.layout.get("line-width-unit"),h="sea"===u,p=!(!t.terrain||!t.terrain.enabled),m=t.context,f=m.gl;if(n.hasElevatedBuckets&&"globe"===t.transform.projection.name)return;const g=n.layout.get("line-cross-slope"),y=void 0!==g,_=g<1,v=t.colorModeForDrapableLayerRenderPass(a?l:null),x=t.terrain&&t.terrain.renderingToTexture,b=x?1:e.o.devicePixelRatio,w=n.paint.get("line-dasharray"),j=w.constantOr(1),S=n.layout.get("line-cap"),T=w.constantOr(null),k=S.constantOr(null),A=n.paint.get("line-pattern"),C=A.constantOr(1),E=n.paint.get("line-pattern-cross-fade"),N=A.constantOr(null),I=n.paint.get("line-opacity").constantOr(1);let P=!C&&1!==I||t.depthOcclusion&&c>0&&c<1;const M=n.paint.get("line-gradient"),L=C?"linePattern":"line",R=e.e2(n);let D;if(x&&t.terrain&&t.terrain.clipOrMaskOverlapStencilType()&&(P=!1),0!==c&&t.depthOcclusion){const t=n.paint._values["line-opacity"];t&&t.value&&"constant"===t.value.kind?D=t.value:e.w("Occlusion opacity for layer ".concat(n.id," is supported only when line-opacity isn't data-driven."))}"constant"!==o.value.kind&&!1===o.value.isLineProgressConstant&&R.push("VARIABLE_LINE_WIDTH"),x&&("dual-source-blending"!==t.emissiveMode||a?"mrt-fallback"===t.emissiveMode&&R.push("USE_MRT1"):R.push("DUAL_SOURCE_BLENDING"));const F=(i,s,o,a,l,u)=>{for(const p of i){const i=r.getTile(p);if(C&&!i.patternsLoaded())continue;const g=i.getBucket(n);if(!g)continue;if("none"!==g.elevationType&&!l||"none"===g.elevationType&&l)continue;t.prepareDrawTile();const y=[...s],_=t.shadowRenderer,w="road"===g.elevationType&&!!_&&_.enabled;let S=[0,0,0];if(w){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(S=bn(t.style,e,r)),y.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const A=g.programConfigurations.get(n.id);let R=!1;if(N&&i.imageAtlas){const t=e.e3.from(N),r=t.getPrimary().scaleSelf(b).toString(),n=i.imageAtlas.patternPositions.get(r),s=t.getSecondary(),o=s?i.imageAtlas.patternPositions.get(s.scaleSelf(b).toString()):null;R=!!n&&!!o,n&&A.setConstantPatternPositions(n,o)}E>0&&(R||A.getPatternTransitionVertexBuffer("line-pattern"))&&y.push("LINE_PATTERN_TRANSITION");const F=t.isTileAffectedByFog(p),O=t.getOrCreateProgram(L,{config:A,defines:y,overrideFog:F});if(!C&&T&&k&&i.lineAtlas){const e=i.lineAtlas.getDash(T,k);e&&A.setConstantPatternPositions(e)}w&&_.setupShadows(i.tileID.toUnwrapped(),O,"vector-tile");let[z,B]=n.paint.get("line-trim-offset");if("round"===k||"square"===k){const e=1;z!==B&&(0===z&&(z-=e),1===B&&(B+=e))}const U=x?p.projMatrix:null,V=d?1/g.tileToMeter/e.ay(i,1,t.transform.zoom):1,q=d?1/g.tileToMeter/e.ay(i,1,Math.floor(t.transform.zoom)):1,W=C?e.e4(t,i,n,U,b,V,q,[z,B],S,E):e.e5(t,i,n,U,g.lineClipsArray.length,b,V,q,[z,B],S);if(M){const i=g.gradients[n.id];let s=i.texture;if(n.gradientVersion!==i.version){let o=256;if(n.stepInterpolant){const n=r.getSource().maxzoom,i=p.canonical.z===n?Math.ceil(1<<t.transform.maxZoom-p.canonical.z):1;o=e.aA(e.e6(g.maxLineLength/e.al*1024*i),256,m.maxTextureSize)}i.gradient=e.e7({expression:n.gradientExpression(),evaluationKey:"lineProgress",resolution:o,image:i.gradient||void 0,clips:g.lineClipsArray}),i.texture?i.texture.update(i.gradient):i.texture=new e.T(m,i.gradient,f.RGBA8),i.version=n.gradientVersion,s=i.texture}m.activeTexture.set(f.TEXTURE1),s.bind(n.stepInterpolant?f.NEAREST:f.LINEAR,f.CLAMP_TO_EDGE)}j&&(m.activeTexture.set(f.TEXTURE0),i.lineAtlasTexture&&i.lineAtlasTexture.bind(f.LINEAR,f.REPEAT),A.updatePaintBuffers()),C&&(m.activeTexture.set(f.TEXTURE0),i.imageAtlasTexture&&i.imageAtlasTexture.bind(f.LINEAR,f.CLAMP_TO_EDGE),A.updatePaintBuffers()),l&&!h&&t.terrain.setupElevationDraw(i,O),t.uploadCommonUniforms(m,O,p.toUnwrapped());const H=e=>{null!=D&&(D.value=I*c),O.draw(t,f.TRIANGLES,o,e,v,nn.disabled,W,n.id,g.layoutVertexBuffer,g.indexBuffer,g.segments,n.paint,t.transform.zoom,A,[g.layoutVertexBuffer2,g.patternVertexBuffer,g.zOffsetVertexBuffer]),null!=D&&(D.value=I)};if(P&&!l){const e=t.stencilModeForClipping(p).ref;0===e&&x&&m.clear({stencil:0});const r={func:f.EQUAL,mask:255};W.u_alpha_discard_threshold=.8,H(new en(r,e,255,f.KEEP,f.KEEP,f.INVERT)),W.u_alpha_discard_threshold=0,H(new en(r,e,255,f.KEEP,f.KEEP,f.KEEP))}else W.u_alpha_discard_threshold=P&&l&&u?.8:0,H(l?a:t.stencilModeForClipping(p))}};let O=t.depthModeForSublayer(0,Qr.ReadOnly);const z=new Qr(t.depthOcclusion?f.GREATER:f.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D);if(n.hasNonElevatedBuckets){const r=!x&&t.terrain;0!==c&&r?e.w("Occlusion opacity for layer ".concat(n.id," is supported on terrain only if the layer has line-z-offset enabled.")):r?e.w("Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ".concat(n.id,".")):F(i,R,O,en.disabled,!1,!0)}if(n.hasElevatedBuckets){"hd-road-markup"===u?p||(O=z,R.push("ELEVATED_ROADS")):(R.push("ELEVATED"),O=z,y&&R.push(_?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),h&&R.push("ELEVATION_REFERENCE_SEA"));const e=P?t.stencilModeFor3D():en.disabled;t.forceTerrainMode=!0,F(i,R,O,e,!0,!0),P&&F(i,R,O,e,!0,!1),t.forceTerrainMode=!1}P&&(t.resetStencilClippingMasks(),x&&m.clear({stencil:0})),0===c||t.depthOcclusion||x||t.layersWithOcclusionOpacity.push(t.currentLayer)},fill:function(t,r,n,i){const s=n.paint.get("fill-color"),o=n.paint.get("fill-opacity");if(0===o.constantOr(1))return;const a=n.paint.get("fill-emissive-strength"),l=t.colorModeForDrapableLayerRenderPass(a),c=n.paint.get("fill-pattern"),u=t.opaquePassEnabledForLayer()&&!c.constantOr(1)&&1===s.constantOr(e.ao.transparent).a&&1===o.constantOr(0)?"opaque":"translucent";let d="none";"none"!==n.layout.get("fill-elevation-reference")?d="road":0!==n.paint.get("fill-z-offset").constantOr(1)&&(d="offset");const h=!(!t.terrain||!t.terrain.enabled),p={painter:t,sourceCache:r,layer:n,coords:i,colorMode:l,elevationType:d,terrainEnabled:h,pass:u};if("shadow"===t.renderPass)return void(t.shadowRenderer&&"road"===d&&!h&&function(e){const{painter:t,sourceCache:r,layer:n,coords:i}=e,s=t.context.gl,o=e.painter.shadowRenderer;for(const a of i){const e=r.getTile(a),i=e.getBucket(n);if(!i)continue;const l=i.elevatedStructures;if(!l)continue;if(!l.shadowCasterSegments||0===l.shadowCasterSegments.segments[0].primitiveLength)continue;t.prepareDrawTile();const c=i.bufferData.programConfigurations.get(n.id),u=t.isTileAffectedByFog(a),d=t.getOrCreateProgram("elevatedStructuresDepth",{config:c,overrideFog:u}),h=o.calculateShadowPassMatrixFromTile(e.tileID.toUnwrapped());t.uploadCommonUniforms(t.context,d,a.toUnwrapped());const p={u_matrix:h,u_depth_bias:0};d.draw(t,s.TRIANGLES,o.getShadowPassDepthMode(),en.disabled,o.getShadowPassColorMode(),nn.disabled,p,n.id,l.vertexBuffer,l.indexBuffer,l.shadowCasterSegments,n.paint,t.transform.zoom,c)}}(p));const m="mrt-fallback"===t.emissiveMode;if("offset"!==d){if(ho(p,!1,m),"road"===d){const e=!h&&"translucent"===t.renderPass;e&&uo(t,r,n,i,"geometry"),ho(p,!0,m,en.disabled),e&&function(e){const{painter:t,sourceCache:r,layer:n,coords:i,colorMode:s}=e,o=t.context.gl,a=e.painter.shadowRenderer,l=!!a&&a.enabled,c=new Qr(t.context.gl.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D);let u=[0,0,0];if(l){const e=t.style.directionalLight,r=t.style.ambientLight;e&&r&&(u=bn(t.style,e,r))}const d=e=>{for(const d of i){const i=r.getTile(d),h=i.getBucket(n);if(!h)continue;const p=h.elevatedStructures;if(!p)continue;let m,f;if(e?(m=p.renderableBridgeSegments,f=p.bridgeProgramConfigurations.get(n.id)):(m=p.renderableTunnelSegments,f=p.tunnelProgramConfigurations.get(n.id)),!m||0===m.segments[0].primitiveLength)continue;f.updatePaintBuffers(),t.prepareDrawTile();const g=t.isTileAffectedByFog(d),y=[];l&&y.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const _=t.getOrCreateProgram("elevatedStructures",{config:f,overrideFog:g,defines:y}),v=t.translatePosMatrix(d.projMatrix,i,n.paint.get("fill-translate"),n.paint.get("fill-translate-anchor"));l&&a.setupShadows(i.tileID.toUnwrapped(),_,"vector-tile");const x=Ts(v,u);t.uploadCommonUniforms(t.context,_,d.toUnwrapped()),_.draw(t,o.TRIANGLES,c,en.disabled,s,nn.backCCW,x,n.id,p.vertexBuffer,p.indexBuffer,m,n.paint,t.transform.zoom,f,[p.vertexBufferNormal])}};d(!0),d(!1)}(p)}}else ho(p,!1,m,t.stencilModeFor3D())},"fill-extrusion":function(t,r,n,i){const s=n.paint.get("fill-extrusion-opacity"),o=t.context,a=o.gl,l=t.terrain,c=l&&l.renderingToTexture;if(0===s)return;const u="mrt-fallback"===t.emissiveMode,d=t.conflationActive&&t.style.isLayerClipped(n,r.getSource()),h=t.style.order.indexOf(n.fqid);if(d&&function(e,t,r,n,i){for(const s of n){const n=t.getTile(s).getBucket(r);n&&(n.updateReplacement(s,e.replacementSource,i),n.uploadCentroid(e.context))}}(t,r,n,i,h),l||d)for(const e of i){const i=r.getTile(e).getBucket(n);i&&go(t.context,r,e,i,n,l,d)}if("shadow"===t.renderPass&&t.shadowRenderer){const o=t.shadowRenderer;if(l&&s<.65&&n._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof e.ad)return;const a=o.getShadowPassDepthMode(),c=o.getShadowPassColorMode();po(t,r,n,i,a,en.disabled,c,d)}else if("translucent"===t.renderPass){const h=!n.paint.get("fill-extrusion-pattern").constantOr(1),p=n.paint.get("fill-extrusion-color").constantOr(e.ao.white);if(!c&&0!==p.a){const e=new Qr(t.context.gl.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D);1===s&&h?po(t,r,n,i,e,en.disabled,Jr.unblended,d):(po(t,r,n,i,e,en.disabled,Jr.disabled,d),po(t,r,n,i,e,t.stencilModeFor3D(),t.colorModeForRenderPass(),d),t.resetStencilClippingMasks())}if(t.style.enable3dLights()&&h&&(!l&&"globe"!==t.transform.projection.name||c)){const s=n.paint.get("fill-extrusion-opacity"),h=n.paint.get("fill-extrusion-ambient-occlusion-intensity"),p=n.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),m=n.paint.get("fill-extrusion-flood-light-intensity"),f="none"===n.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default"),g=n.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(f?null:n.lut).toArray01().slice(0,3),y=h>0&&p>0,_=m>0,v=(e,t,r)=>(1-r)*e+r*t,x=new mo;x.translate=n.paint.get("fill-extrusion-translate"),x.translateAnchor=n.paint.get("fill-extrusion-translate-anchor"),x.edgeRadius=n.layout.get("fill-extrusion-edge-radius"),x.cutoffFadeRange=n.paint.get("fill-extrusion-cutoff-fade-range");const b=o=>{const l=t.depthModeForSublayer(1,Qr.ReadOnly,a.LEQUAL,!0),c=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),u=v(.1,3,c),f=t._showOverdrawInspector;if(!f){const c=new en({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),f=new Jr([a.ONE,a.ONE,a.ONE,a.ONE],e.ao.transparent,[!1,!1,!1,!0],a.MIN);fo(x,t,r,n,i,l,c,f,nn.disabled,o,"sdf",s,h,p,m,g,u,d,!1)}{const c=f?en.disabled:new en({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),y=f?t.colorModeForRenderPass():new Jr([a.ONE_MINUS_DST_ALPHA,a.DST_ALPHA,a.ONE,a.ONE],e.ao.transparent,[!0,!0,!0,!0]);fo(x,t,r,n,i,l,c,y,nn.disabled,o,"color",s,h,p,m,g,u,d,!1)}};if(c){const c=()=>{const t=l.drapeBufferSize[0],r=l.drapeBufferSize[1];let n=l.framebufferCopyTexture;return n&&(!n||n.size[0]===t&&n.size[1]===r)||(n&&n.destroy(),n=l.framebufferCopyTexture=new e.T(o,new e.q({width:t,height:r}),a.RGBA8)),n.bind(a.LINEAR,a.CLAMP_TO_EDGE),a.copyTexSubImage2D(a.TEXTURE_2D,0,0,0,0,0,t,r),n},f=(o,l,f)=>{const y=t.depthModeForSublayer(1,Qr.ReadOnly,a.LEQUAL,!1),_=n.paint.get(o?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),b=v(.1,3,_);{const c=new Jr([a.ONE,a.ONE,a.ONE,a.ONE],e.ao.transparent,[!1,!1,!1,!0]);fo(x,t,r,n,i,y,en.disabled,c,nn.disabled,o,"clear",s,h,p,m,g,b,d,l)}{const c=new en({func:a.ALWAYS,mask:255},255,255,a.KEEP,a.KEEP,a.REPLACE),u=new Jr([a.ONE,a.ONE,a.ONE,a.ONE],e.ao.transparent,[!1,!1,!1,!0],a.MIN);fo(x,t,r,n,i,y,c,u,nn.disabled,o,"sdf",s,h,p,m,g,b,d,l)}u&&!o&&(f=c());{const c=o?a.ZERO:a.ONE_MINUS_DST_ALPHA,u=new en({func:a.EQUAL,mask:255},255,255,a.KEEP,a.DECR,a.DECR),f=new Jr([c,a.DST_ALPHA,a.ONE_MINUS_DST_ALPHA,a.ZERO],e.ao.transparent,[!0,!0,!0,!0]);fo(x,t,r,n,i,y,u,f,nn.disabled,o,"color",s,h,p,m,g,b,d,l)}if(!u||o){const c=new Jr([a.ONE,a.ONE,a.ONE,o?a.ZERO:a.ONE],e.ao.transparent,[!1,!1,!1,!0],o?a.FUNC_ADD:a.MAX);fo(x,t,r,n,i,y,en.disabled,c,nn.disabled,o,"clear",s,h,p,m,g,b,d,l,f)}else{a.drawBuffers([a.NONE,a.COLOR_ATTACHMENT1]);const c=new en({func:a.EQUAL,mask:255},254,255,a.KEEP,a.DECR,a.DECR),u=new Jr([a.ONE,a.ONE,a.ONE,a.ONE],e.ao.transparent,[!0,!1,!1,!1],a.MAX);fo(x,t,r,n,i,y,c,u,nn.disabled,o,"emissive",s,h,p,m,g,b,d,l,f),a.drawBuffers([a.COLOR_ATTACHMENT0])}};if(y||_){let e;t.prepareDrawTile(),u&&!y||(e=c()),y&&f(!0,!1,e),_&&f(!1,!0,e)}}else y&&b(!0),_&&b(!1),(y||_)&&t.resetStencilClippingMasks()}}},building:function(e,t,r,n){e.currentLayer<e.firstLightBeamLayer&&(e.firstLightBeamLayer=e.currentLayer);const i=r.paint.get("building-ambient-occlusion-ground-intensity"),s=r.paint.get("building-ambient-occlusion-ground-radius"),o=r.paint.get("building-ambient-occlusion-ground-attenuation"),a=r.paint.get("building-opacity");if(a<=0)return;let l=i>0&&s>0,c=!0;const u=r.paint.get("building-vertical-scale");if(u<=0)return;e.shadowRenderer||(c=!1);const d=e.conflationActive&&e.style.isLayerClipped(r,t.getSource()),h=e.style.order.indexOf(r.fqid);if(function(e,t,r,n,i,s){for(const o of s){const s=t.getTile(o).getBucket(r);s&&(i&&s.updateReplacement(o,e.replacementSource,n),s.uploadUpdatedIndexBuffer(e.context))}}(e,t,r,h,d,n),function(e,t,r,n){for(const i of n){const n=t.getTile(i).getBucket(r);n&&n.needsEvaluation()&&n.uploadUpdatedColorBuffer(e.context)}}(e,t,r,n),r.resetLayerRenderingStats(e),e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!0),"shadow"===e.renderPass&&e.shadowRenderer){const i=e.shadowRenderer,s=[],o=i.getShadowPassDepthMode();bo({painter:e,source:t,layer:r,coords:n,defines:s,blendMode:i.getShadowPassColorMode(),depthMode:o,opacity:a,verticalScale:u,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}else if("translucent"===e.renderPass){let h=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];c&&(h=h.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),e.shadowRenderer&&e.shadowRenderer.useNormalOffset&&(h=h.concat("NORMAL_OFFSET"));const p=r.paint.get("building-facade-emissive-chance"),m=r.paint.get("building-ambient-occlusion-intensity"),f=r.paint.get("building-flood-light-intensity"),g="none"===r.paint.get("building-flood-light-color-use-theme").constantOr("default"),y=r.paint.get("building-flood-light-color").toNonPremultipliedRenderColor(g?null:r.lut).toArray01().slice(0,3),_=r.paint.get("building-flood-light-ground-attenuation"),v=f>0,x=new Qr(e.context.gl.LEQUAL,Qr.ReadWrite,e.depthRangeFor3D);a<1&&bo({painter:e,source:t,layer:r,coords:n,defines:h,blendMode:Jr.disabled,depthMode:x,opacity:a,verticalScale:u,facadeEmissiveChance:p,facadeAOIntensity:m,floodLightIntensity:f,floodLightColor:y,depthOnly:!0});const b=e.colorModeForRenderPass();bo({painter:e,source:t,layer:r,coords:n,defines:h,blendMode:b,depthMode:x,opacity:a,verticalScale:u,facadeEmissiveChance:p,facadeAOIntensity:m,floodLightIntensity:f,floodLightColor:y}),l&&wo(e,t,r,n,!0,a,i,s,f,y,o,d),v&&wo(e,t,r,n,!1,a,i,s,f,y,_,d)}else if("light-beam"===e.renderPass){const i=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],s=new Qr(e.context.gl.LEQUAL,Qr.ReadOnly,e.depthRangeFor3D);bo({painter:e,source:t,layer:r,coords:n,defines:i,blendMode:Jr.alphaBlended,depthMode:s,opacity:a,verticalScale:u,facadeEmissiveChance:0,facadeAOIntensity:0,floodLightIntensity:0,floodLightColor:[0,0,0]})}e.shadowRenderer&&(e.shadowRenderer.useNormalOffset=!1),e.resetStencilClippingMasks()},hillshade:function(e,t,r,n){if("offscreen"!==e.renderPass&&"translucent"!==e.renderPass)return;if(e.style.disableElevatedTerrain)return;const i=e.context,s=e.terrain&&e.terrain.renderingToTexture,[o,a]="translucent"!==e.renderPass||s?[{},n]:e.stencilConfigForOverlap(n);for(const l of a){const n=t.getTile(l);if(n.needsHillshadePrepare&&"offscreen"===e.renderPass)hi(e,n,r);else if("translucent"===e.renderPass){const t=e.depthModeForSublayer(0,Qr.ReadOnly),i=r.paint.get("hillshade-emissive-strength"),a=e.colorModeForDrapableLayerRenderPass(i),c=s&&e.terrain?e.terrain.stencilModeForRTTOverlap(l):o[l.overscaledZ];ui(e,l,n,r,t,c,a)}}i.viewport.set([0,0,e.width,e.height]),e.resetStencilClippingMasks()},raster:function(t,r,n,i,s,o){if("translucent"!==t.renderPass)return;if(0===n.paint.get("raster-opacity"))return;const a="globe"===t.transform.projection.name,l=0!==n.paint.get("raster-elevation"),c=l&&a;if(t.renderElevatedRasterBackface&&!c)return;const u=t.context,d=u.gl,h=r.getSource(),p=function(t,r,n,i,s){const o=r.paint.get("raster-color"),a="raster-array"===t.type,l=[],c=r.paint.get("raster-resampling"),u=r.paint.get("raster-color-mix");let d=r.paint.get("raster-color-range");const h=[u[0],u[1],u[2],0],p=u[3];let m="nearest"===c?i.NEAREST:i.LINEAR;if(a&&(l.push("RASTER_ARRAY"),o||l.push("RASTER_COLOR"),"linear"===c&&l.push("RASTER_ARRAY_LINEAR"),m=i.NEAREST,!d&&t.rasterLayers)){const e=t.rasterLayers.find(e=>{let{id:t}=e;return t===r.sourceLayer});e&&e.fields&&e.fields.range&&(d=e.fields.range)}if(d=d||[0,1],o){l.push("RASTER_COLOR"),n.activeTexture.set(i.TEXTURE2),r.updateColorRamp(d);let t=r.colorRampTexture;t||(t=r.colorRampTexture=new e.T(n,r.colorRamp,i.RGBA8)),t.bind(i.LINEAR,i.CLAMP_TO_EDGE)}return s&&l.push("USE_MRT1"),{mix:h,range:d,offset:p,defines:l,resampling:m}}(h,n,u,d,t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode);if(h instanceof e.aU&&!i.length&&!a)return;const m=n.paint.get("raster-emissive-strength"),f=t.colorModeForDrapableLayerRenderPass(m),g=t.terrain&&t.terrain.renderingToTexture,y=!t.options.moving,_="nearest"===n.paint.get("raster-resampling")?d.NEAREST:d.LINEAR;if(h instanceof e.aU&&!i.length&&(h.onNorthPole||h.onSouthPole)){const e=l?t.stencilModeFor3D():en.disabled;return void So(!!h.onNorthPole,null,t,r,n,m,p,nn.disabled,e)}if(!i.length)return;const[v,x]=h instanceof e.aU||g?[{},i]:t.stencilConfigForOverlap(i),b=x[x.length-1].overscaledZ;c&&p.defines.push("PROJECTION_GLOBE_VIEW"),l&&p.defines.push("RENDER_CUTOFF");const w=(i,s,x)=>{for(const w of i){const i=w.toUnwrapped(),j=r.getTile(w);if(g&&(!j||!j.hasData()))continue;u.activeTexture.set(d.TEXTURE0);const S=ko(j,h,n,p);if(!S||!S.texture)continue;const{texture:T,mix:k,offset:A,tileSize:C,buffer:E}=S;let N,I;g?(N=Qr.disabled,I=w.projMatrix):l?(N=new Qr(d.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D),I=a?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(i,y)):(N=t.depthModeForSublayer(w.overscaledZ-b,1===n.paint.get("raster-opacity")?Qr.ReadWrite:Qr.ReadOnly,d.LESS),I=t.transform.calculateProjMatrix(i,y));const P=t.terrain&&g?t.terrain.stencilModeForRTTOverlap(w):v[w.overscaledZ],M=o?0:n.paint.get("raster-fade-duration");j.registerFadeDuration(M);const L=r.findLoadedParent(w,0),R=ss(j,L,r,t.transform,M);let D,F;!R.isFading&&j.refreshedUponExpiration&&(j.refreshedUponExpiration=!1),t.terrain&&t.terrain.prepareDrawTile(),u.activeTexture.set(d.TEXTURE0),T.bind(_,d.CLAMP_TO_EDGE),u.activeTexture.set(d.TEXTURE1),L?(L.texture&&L.texture.bind(_,d.CLAMP_TO_EDGE),D=Math.pow(2,L.tileID.overscaledZ-j.tileID.overscaledZ),F=[j.tileID.canonical.x*D%1,j.tileID.canonical.y*D%1]):T.bind(_,d.CLAMP_TO_EDGE),"useMipmap"in T&&u.extTextureFilterAnisotropic&&t.transform.pitch>20&&d.texParameterf(d.TEXTURE_2D,u.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,u.extTextureFilterAnisotropicMax);const O=t.transform;let z;const B=l?To(O):[0,0,0,0];let U,V,q,W,H,G=0;if(c&&h instanceof e.aU&&h.coordinates.length>3)U=Float32Array.from(e.bk(e.dJ(new e.cD(0,0,0)))),V=Float32Array.from(O.globeMatrix),q=Float32Array.from(e.dF(O)),W=[e.aF(O.center.lng),e.aJ(O.center.lat)],z=h.elevatedGlobePerspectiveTransform,H=h.elevatedGlobeGridMatrix||new Float32Array(9);else if(c){const t=e.dG(w.canonical);G=e.dH(t.getCenter().lat),U=Float32Array.from(e.bk(e.dJ(w.canonical))),V=Float32Array.from(O.globeMatrix),q=Float32Array.from(e.dF(O)),W=[e.aF(O.center.lng),e.aJ(O.center.lat)],z=[0,0],H=Float32Array.from(e.dI(w.canonical,t,G,O.worldSize/O._pixelsPerMercatorPixel))}else z=h instanceof e.aU?h.perspectiveTransform:[0,0],U=new Float32Array(16),V=new Float32Array(9),q=new Float32Array(16),W=[0,0],H=new Float32Array(9);const Z=Ds(I,U,V,q,H,F||[0,0],e.aj(t.transform.zoom),W,B,D||1,R,n,z,l?n.paint.get("raster-elevation"):0,2,k,A,p.range,C,E,m),K=t.isTileAffectedByFog(w),Y=t.getOrCreateProgram("raster",{defines:p.defines,overrideFog:K});if(t.uploadCommonUniforms(u,Y,i),h instanceof e.aU){const r=h.elevatedGlobeVertexBuffer,i=h.elevatedGlobeIndexBuffer;if(g||!a)h.boundsBuffer&&h.boundsSegments&&Y.draw(t,d.TRIANGLES,N,en.disabled,f,nn.disabled,Z,n.id,h.boundsBuffer,t.quadTriangleIndexBuffer,h.boundsSegments);else if(r&&i){const o=O.zoom<=e.c_?h.elevatedGlobeSegments:h.getSegmentsForLongitude(O.center.lng);o&&Y.draw(t,d.TRIANGLES,N,en.disabled,f,s,Z,n.id,r,i,o)}}else if(c){N=new Qr(d.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D);const e=t.globeSharedBuffers;if(e){const[r,i,o]=e.getGridBuffers(G,!1);Y.draw(t,d.TRIANGLES,N,x||P,t.colorModeForRenderPass(),s,Z,n.id,r,i,o)}}else{const{tileBoundsBuffer:e,tileBoundsIndexBuffer:r,tileBoundsSegments:i}=t.getTileBoundsBuffers(j);Y.draw(t,d.TRIANGLES,N,P,f,nn.disabled,Z,n.id,e,r,i)}}if(!(h instanceof e.aU)&&c)for(const e of i){const i=e.canonical.y===(1<<e.canonical.z)-1;0===e.canonical.y&&So(!0,e,t,r,n,m,p,s,x||en.disabled),i&&So(!1,e,t,r,n,m,p,s===nn.frontCW?nn.backCW:nn.frontCW,x||en.disabled)}};c?w(x,t.renderElevatedRasterBackface?nn.backCW:nn.frontCW,t.stencilModeFor3D()):w(x,nn.disabled,void 0),t.resetStencilClippingMasks()},"raster-particle":function(t,r,n,i,s,o){"offscreen"===t.renderPass&&function(t,r,n,i){if(!i.length)return;const s=t.context,o=s.gl,a=r.getSource();if(!(a instanceof yt))return;const l=Math.ceil(Math.sqrt(n.paint.get("raster-particle-count")));let c=n.particlePositionRGBAImage;if(!c||c.width!==l){const t=function(e){const t=e*e,r=new Uint8Array(4*t),n=function(e){return e|=0,e=Math.imul(2747636419^e,2654435769),e=Math.imul(e^e>>>16,2654435769),((e=Math.imul(e^e>>>16,2654435769))>>>0)/4294967296},i=1/1.1;for(let s=0;s<t;s++){const e=i*(n(2*s+0)+Os),t=i*(n(2*s+1)+Os),o=255*e%1,a=255*t%1,l=o,c=t-a/255,u=a;r[4*s+0]=255*(e-o/255),r[4*s+1]=255*l,r[4*s+2]=255*c,r[4*s+3]=255*u}return r}(l);c=n.particlePositionRGBAImage=new e.q({width:l,height:l},t)}let u=n.particleFramebuffer;u?u.width!==l&&(u.destroy(),u=n.particleFramebuffer=s.createFramebuffer(l,l,1,null)):u=n.particleFramebuffer=s.createFramebuffer(l,l,1,null);const d=[];for(const e of i){const t=r.getTile(e);if(!(t instanceof Dt))continue;const i=Eo(t,a,n);if(!i)continue;const o=[t.tileSize,t.tileSize];let u=n.tileFramebuffer;u||(u=n.tileFramebuffer=s.createFramebuffer(o[0],o[1],1,null));let h=t.rasterParticleState;h||(h=t.rasterParticleState=new Co(s,e,o,c));const p=h.update(n.lastInvalidatedAt);h.particleTextureDimension!==l&&h.updateParticleTexture(e,c);const m=h.targetColorTexture;h.targetColorTexture=h.backgroundColorTexture,h.backgroundColorTexture=m;const f=h.particleTexture0;h.particleTexture0=h.particleTexture1,h.particleTexture1=f,d.push([e,i,h,p])}if(0===d.length)return;const h=e.o.now(),p=n.previousDrawTimestamp?.001*(h-n.previousDrawTimestamp):.0167;if(n.previousDrawTimestamp=h,n.hasColorMap()){s.activeTexture.set(o.TEXTURE0+2);let t=n.colorRampTexture;t||(t=n.colorRampTexture=new e.T(s,n.colorRamp,o.RGBA8)),t.bind(o.LINEAR,o.CLAMP_TO_EDGE)}s.bindFramebuffer.set(n.tileFramebuffer.framebuffer),function(t,r,n){const i=t.context,s=i.gl,o=r.tileFramebuffer;i.activeTexture.set(s.TEXTURE0);const a={u_texture:0,u_opacity:1.05*(c=r.paint.get("raster-particle-fade-opacity-factor"))/(c+.05)},l=t.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var c;for(const u of n){const[,,n,c]=u;o.colorAttachment0.set(n.targetColorTexture.texture),i.viewport.set([0,0,o.width,o.height]),i.clear({color:e.ao.transparent}),c&&(n.backgroundColorTexture.bind(s.NEAREST,s.CLAMP_TO_EDGE),l.draw(t,s.TRIANGLES,Qr.disabled,en.disabled,Jr.alphaBlended,nn.disabled,a,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments))}}(t,n,d),function(t,r,n,i){const s=t.context,o=s.gl,a=n.tileFramebuffer,l="globe"===t.transform.projection.name,c=n.paint.get("raster-particle-max-speed");for(const u of i){const[i,d,h]=u;s.activeTexture.set(o.TEXTURE0+0),d.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),a.colorAttachment0.set(h.targetColorTexture.texture);const p=t.getOrCreateProgram("rasterParticleDraw",{defines:d.defines,overrideFog:!1});s.activeTexture.set(o.TEXTURE0+1);const m=d.scalarData?[]:[0,1,2,3].map(t=>e.e9[t](i));m.push(i);const f=i.canonical.x,g=i.canonical.y;for(const e of m){const s=r.getTile(l?e.wrapped():e);if(!s)continue;const a=s.rasterParticleState;if(!a)continue;const u=e.canonical.x+(1<<e.canonical.z)*(e.wrap-i.wrap),h=e.canonical.y;a.particleTexture0.bind(o.NEAREST,o.CLAMP_TO_EDGE);const m=Bs(1,a.particleTexture0.size[0],[u-f,h-g],0,d.texture.size,2,c,d.textureOffset,d.scale,d.offset);p.draw(t,o.POINTS,Qr.disabled,en.disabled,Jr.alphaBlended,nn.disabled,m,n.id,a.particleIndexBuffer,void 0,a.particleSegment)}}}(t,r,n,d),s.bindFramebuffer.set(n.particleFramebuffer.framebuffer),function(t,r,n,i){const s=t.context,o=s.gl,a=r.paint.get("raster-particle-max-speed"),l=i*r.paint.get("raster-particle-speed-factor")*.15,c=function(e){return Math.pow(e,6)}(.01+1*r.paint.get("raster-particle-reset-rate-factor")),u=r.particleFramebuffer;s.viewport.set([0,0,u.width,u.height]);for(const d of n){const[,n,i]=d;s.activeTexture.set(o.TEXTURE0+0),n.texture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.activeTexture.set(o.TEXTURE0+1);const h=i.particleTexture0;h.bind(o.NEAREST,o.CLAMP_TO_EDGE);const p=Us(1,h.size[0],0,n.texture.size,a,l,c,n.textureOffset,n.scale,n.offset);u.colorAttachment0.set(i.particleTexture1.texture),s.clear({color:e.ao.transparent}),t.getOrCreateProgram("rasterParticleUpdate",{defines:n.defines}).draw(t,o.TRIANGLES,Qr.disabled,en.disabled,Jr.unblended,nn.disabled,p,r.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}}(t,n,d,p)}(t,r,n,i),"translucent"===t.renderPass&&(function(t,r,n,i){const s=t.context,o=s.gl,a=r.getSource().tileSize,l=5*(1-e.ah(e.cL,e.cL+1,t.transform.zoom))*a+n.paint.get("raster-particle-elevation"),c=!t.options.moving,u="globe"===t.transform.projection.name;if(!i.length)return;const[d,h]=t.stencilConfigForOverlap(i),p=[];u&&p.push("PROJECTION_GLOBE_VIEW");const m=t.stencilModeFor3D();for(const f of h){const i=f.toUnwrapped(),a=r.getTile(f);if(!a.rasterParticleState)continue;const h=a.rasterParticleState,g=100;a.registerFadeDuration(g);const y=r.findLoadedParent(f,0),_=ss(a,y,r,t.transform,g);let v,x;t.terrain&&t.terrain.prepareDrawTile(),s.activeTexture.set(o.TEXTURE0),h.targetColorTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),s.activeTexture.set(o.TEXTURE1),y&&y.rasterParticleState?(y.rasterParticleState.targetColorTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE),v=Math.pow(2,y.tileID.overscaledZ-a.tileID.overscaledZ),x=[a.tileID.canonical.x*v%1,a.tileID.canonical.y*v%1]):h.targetColorTexture.bind(o.LINEAR,o.CLAMP_TO_EDGE);const b=u?Float32Array.from(t.transform.expandedFarZProjMatrix):t.transform.calculateProjMatrix(i,c),w=t.transform,j=No(w),S=e.dG(f.canonical),T=e.dH(S.getCenter().lat);let k,A,C,E,N;u?(k=Float32Array.from(e.bk(e.dJ(f.canonical))),A=Float32Array.from(w.globeMatrix),C=Float32Array.from(e.dF(w)),E=[e.aF(w.center.lng),e.aJ(w.center.lat)],N=Float32Array.from(e.dI(f.canonical,S,T,w.worldSize/w._pixelsPerMercatorPixel))):(k=new Float32Array(16),A=new Float32Array(9),C=new Float32Array(16),E=[0,0],N=new Float32Array(9));const I=zs(b,k,A,C,N,x||[0,0],e.aj(t.transform.zoom),E,j,v||1,_,l),P=t.isTileAffectedByFog(f),M=t.getOrCreateProgram("rasterParticle",{defines:p,overrideFog:P});if(t.uploadCommonUniforms(s,M,i),u){const e=new Qr(o.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D),r=0,i=t.globeSharedBuffers;if(i){const[s,a,l]=i.getGridBuffers(T,0!==r);M.draw(t,o.TRIANGLES,e,m,Jr.alphaBlended,t.renderElevatedRasterBackface?nn.frontCCW:nn.backCCW,I,n.id,s,a,l)}}else{const e=t.depthModeForSublayer(0,Qr.ReadOnly),r=d[f.overscaledZ],{tileBoundsBuffer:i,tileBoundsIndexBuffer:s,tileBoundsSegments:l}=t.getTileBoundsBuffers(a);M.draw(t,o.TRIANGLES,e,r,Jr.alphaBlended,nn.disabled,I,n.id,i,s,l)}}t.resetStencilClippingMasks()}(t,r,n,i),t.style.map.triggerRepaint())},background:function(t,r,n,i){const s=n.paint.get("background-color"),o="none"===n.paint.get("background-color-use-theme").constantOr("default"),a=n.paint.get("background-opacity"),l=n.paint.get("background-emissive-strength"),c="viewport"===n.paint.get("background-pitch-alignment");if(0===a)return;const u=t.context,d=u.gl,h=t.transform,p=h.tileSize,m=n.paint.get("background-pattern");let f;if(void 0!==m){if(null===m)return;if(f=t.imageManager.getPattern(e.I.from(m.toString()),n.scope,t.style.getLut(n.scope)),!f)return}const g=!m&&1===s.a&&1===a&&t.opaquePassEnabledForLayer()?"opaque":"translucent";if(t.renderPass!==g)return;const y=en.disabled,_=t.depthModeForSublayer(0,"opaque"===g?Qr.ReadWrite:Qr.ReadOnly),v=t.colorModeForDrapableLayerRenderPass(l),x=m?"backgroundPattern":"background";let b,w=i;w||(b=t.getBackgroundTiles(),w=Object.values(b).map(e=>e.tileID)),m&&(u.activeTexture.set(d.TEXTURE0),t.imageManager.bind(t.context,n.scope));const j=[];if(t.terrain&&t.terrain.renderingToTexture&&"mrt-fallback"===t.emissiveMode&&j.push("USE_MRT1"),c){const r=t.getOrCreateProgram(x,{overrideFog:!1,overrideRtt:!0,defines:j}),i=new Float32Array(e.bA([])),u=new e.aQ(0,0,0,0,0),h=m?Hs(i,l,a,t,0,n.scope,f,c,{tileID:u,tileSize:p}):Ws(i,l,a,s.toPremultipliedRenderColor(o?null:n.lut));r.draw(t,d.TRIANGLES,_,y,v,nn.disabled,h,n.id,t.viewportBuffer,t.quadTriangleIndexBuffer,t.viewportSegments)}else for(const e of w){const g=t.isTileAffectedByFog(e),w=t.getOrCreateProgram(x,{overrideFog:g,defines:j}),S=e.toUnwrapped(),T=i?e.projMatrix:t.transform.calculateProjMatrix(S);t.prepareDrawTile();const k=r?r.getTile(e):b?b[e.key]:new Rt(e,p,h.zoom,t),A=m?Hs(T,l,a,t,0,n.scope,f,c,{tileID:e,tileSize:p}):Ws(T,l,a,s.toPremultipliedRenderColor(o?null:n.lut));t.uploadCommonUniforms(u,w,S);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:E,tileBoundsSegments:N}=t.getTileBoundsBuffers(k);w.draw(t,d.TRIANGLES,_,y,v,nn.disabled,A,n.id,C,E,N)}},sky:function(t,r,n){const i=t._atmosphere?e.aj(t.transform.zoom):1,s=n.paint.get("sky-opacity")*i;if(0===s)return;const o=t.context,a=n.paint.get("sky-type"),l=new Qr(o.gl.LEQUAL,Qr.ReadOnly,[0,1]),c=t.frameCounter/1e3%1;"atmosphere"===a?"offscreen"===t.renderPass?n.needsSkyboxCapture(t)&&(function(t,r){const n=t.context,i=n.gl;let s=r.skyboxFbo;if(!s){s=r.skyboxFbo=n.createFramebuffer(32,32,1,null),r.skyboxGeometry=new Wo(n),r.skyboxTexture=n.gl.createTexture(),i.bindTexture(i.TEXTURE_CUBE_MAP,r.skyboxTexture),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_S,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_WRAP_T,i.CLAMP_TO_EDGE),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MIN_FILTER,i.LINEAR),i.texParameteri(i.TEXTURE_CUBE_MAP,i.TEXTURE_MAG_FILTER,i.LINEAR);for(let e=0;e<6;++e)i.texImage2D(i.TEXTURE_CUBE_MAP_POSITIVE_X+e,0,i.RGBA,32,32,0,i.RGBA,i.UNSIGNED_BYTE,null)}n.bindFramebuffer.set(s.framebuffer),n.viewport.set([0,0,32,32]);const o=r.getCenter(t,!0),a=t.getOrCreateProgram("skyboxCapture"),l=new Float64Array(16);e.bA(l),e.en(l,l,.5*-Math.PI),Ho(t,r,a,l,o,0),e.bA(l),e.en(l,l,.5*Math.PI),Ho(t,r,a,l,o,1),e.bA(l),e.cU(l,l,.5*-Math.PI),Ho(t,r,a,l,o,2),e.bA(l),e.cU(l,l,.5*Math.PI),Ho(t,r,a,l,o,3),e.bA(l),Ho(t,r,a,l,o,4),e.bA(l),e.en(l,l,Math.PI),Ho(t,r,a,l,o,5),n.viewport.set([0,0,t.width,t.height])}(t,n),n.markSkyboxValid(t)):"sky"===t.renderPass&&function(e,t,r,n,i){const s=e.context,o=s.gl,a=e.transform,l=e.getOrCreateProgram("skybox");s.activeTexture.set(o.TEXTURE0),o.bindTexture(o.TEXTURE_CUBE_MAP,t.skyboxTexture);const c=((e,t,r,n,i)=>({u_matrix:e,u_sun_direction:t,u_cubemap:0,u_opacity:n,u_temporal_offset:i}))(a.skyboxMatrix,t.getCenter(e,!1),0,n,i);e.uploadCommonUniforms(s,l),l.draw(e,o.TRIANGLES,r,en.disabled,e.colorModeForRenderPass(),nn.backCW,c,"skybox",t.skyboxGeometry.vertexBuffer,t.skyboxGeometry.indexBuffer,t.skyboxGeometry.segment)}(t,n,l,s,c):"gradient"===a&&"sky"===t.renderPass&&function(t,r,n,i,s){const o=t.context,a=o.gl,l=t.transform,c=t.getOrCreateProgram("skyboxGradient");r.skyboxGeometry||(r.skyboxGeometry=new Wo(o)),o.activeTexture.set(a.TEXTURE0);let u=r.colorRampTexture;u||(u=r.colorRampTexture=new e.T(o,r.colorRamp,a.RGBA8)),u.bind(a.LINEAR,a.CLAMP_TO_EDGE);const d=((t,r,n,i,s)=>({u_matrix:t,u_color_ramp:0,u_center_direction:r,u_radius:e.an(n),u_opacity:i,u_temporal_offset:s}))(l.skyboxMatrix,r.getCenter(t,!1),r.paint.get("sky-gradient-radius"),i,s);t.uploadCommonUniforms(o,c),c.draw(t,a.TRIANGLES,n,en.disabled,t.colorModeForRenderPass(),nn.backCW,d,"skyboxGradient",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}(t,n,l,s,c)},custom:function(t,r,n,i){const s=t.context,o=n.implementation;if(!t.transform.projection.unsupportedLayers||!t.transform.projection.unsupportedLayers.includes("custom")||t.terrain&&(t.terrain.renderingToTexture||"offscreen"===t.renderPass)&&n.isDraped(r)){if("offscreen"===t.renderPass){const r=o.prerender;if(r){if(t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),"globe"===t.transform.projection.name){const n=t.transform.pointMerc;r.call(o,s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.aj(t.transform.zoom),[n.x,n.y],t.transform.pixelsPerMeterRatio)}else r.call(o,s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState()}}else if("translucent"===t.renderPass){if(t.terrain&&t.terrain.renderingToTexture){const e=o.renderToTile;if(e){const r=i[0].canonical,n={x:r.x+i[0].wrap*(o.wrapTileId?0:1<<r.z),y:r.y,z:r.z};s.setDepthMode(Qr.disabled),s.setStencilMode(en.disabled),s.setColorMode(t.colorModeForRenderPass()),t.setCustomLayerDefaults(),e.call(o,s.gl,n),s.setDirty(),t.setBaseState()}return}t.setCustomLayerDefaults(),s.setColorMode(t.colorModeForRenderPass()),s.setStencilMode(en.disabled);const r="3d"===o.renderingMode?new Qr(t.context.gl.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D):t.depthModeForSublayer(0,Qr.ReadOnly);if(s.setDepthMode(r),"globe"===t.transform.projection.name){const r=t.transform.pointMerc;o.render(s.gl,t.transform.customLayerMatrix(),t.transform.getProjection(),t.transform.globeToMercatorMatrix(),e.aj(t.transform.zoom),[r.x,r.y],t.transform.pixelsPerMeterRatio)}else o.render(s.gl,t.transform.customLayerMatrix());s.setDirty(),t.setBaseState(),s.bindFramebuffer.set(null)}}else e.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(t,r,n,i){if("opaque"===t.renderPass)return;const s=n.paint.get("model-opacity").constantOr(1),o=n.paint.get("model-elevation-reference"),a="ground"===o,l="ground"===o;if(0===s)return;const c=n.paint.get("model-cast-shadows");if("shadow"===t.renderPass){if(!c)return;if(t.terrain&&s<.65&&n._transitionablePaint._values["model-opacity"].value.expression instanceof e.ad)return}const u=t.shadowRenderer,d=n.paint.get("model-receive-shadows");u&&(u.useNormalOffset=!0,d||(u.enabled=!1));const h=()=>{u&&(u.useNormalOffset=!0,d||(u.enabled=!0))},p=r.getSource();if("light-beam"===t.renderPass&&"batched-model"!==p.type)return;if("vector"===p.type||"geojson"===p.type)return function(t,r,n,i,s){const o=t.transform,a="globe"===o.projection.name,l=o.getFreeCameraOptions().position;if(!t.modelManager)return;const c=t.modelManager;n.modelManager=c;const u=t.shadowRenderer;if(!n._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const d=n._unevaluatedLayout._values["model-id"],h=Object.assign({},n.layout.get("model-id").parameters),p=t.style.order.indexOf(n.fqid),m=n.paint.get("model-opacity").constantOr(1);for(const f of i){const i=r.getTile(f).getBucket(n);if(!i||i.projection.name!==o.projection.name)continue;const g=i.getModelUris();if(g&&!i.modelsRequested&&(c.addModelsFromBucket(g,s),i.modelsRequested=!0),a)h.zoom=f.overscaledZ;else{const e=ca(f,o);h.zoom=e}const y=d.possiblyEvaluate(h);if(aa(t,i,f),la.shadowUniformsInitialized=!1,la.useSingleShadowCascade=!!u&&0===u.getMaxCascadeForTile(f.toUnwrapped()),"shadow"===t.renderPass&&u){if(1===t.currentShadowCascade&&i.isInsideFirstShadowMapFrustum)continue;const r=o.calculatePosMatrix(f.toUnwrapped(),o.worldSize);if(la.tileMatrix.set(r),la.shadowTileMatrix=Float32Array.from(u.calculateShadowPassMatrixFromMatrix(r)),la.aabb.min=[0,0,0],la.aabb.max[0]=la.aabb.max[1]=e.al,la.aabb.max[2]=0,ha(i,la,t,n.scope))continue}const _=1<<f.canonical.z,v=[((l.x-f.wrap)*_-f.canonical.x)*e.al,(l.y*_-f.canonical.y)*e.al,l.z*_*e.al];t.conflationActive&&Object.keys(i.instancesPerModel).length>0&&t.style.isLayerClipped(n,r.getSource())&&i.updateReplacement(f,t.replacementSource,p,n.scope)&&(i.uploaded=!1,i.upload(t.context));let x=0;const b=new Array,w=new Array,j=new Array;for(let r in i.instancesPerModel){const o=i.instancesPerModel[r];o.features.length>0&&!a&&(r=y.evaluate(o.features[0].feature,{}));const u=c.getModel(r,s);if(u||c.hasURLBeenRequested(r)||i.modelUris.includes(r)||(i.modelUris.push(r),i.modelsRequested=!1),u&&u.uploaded)if(a){const r=e.c5([],[l.x,l.y,l.z],t.transform.worldSize);e.ew(r,r);for(let n=0;n<o.instancedDataArray.length;++n){const s=[0,0,0],a=[1,1,1],l=e.ex(),c=o.tileCoordinatesForInstance(n),d=o.transformForInstance(n);e.ey(a,d),e.ez(l,d),e.eA(s,l);const h=o.translationForInstance(n),p=new e.aT(0,0);e.eB(i.canonical,p,c.x,c.y);const f=e.bC();e.eC(f,u,t.transform,p,s,a,h,!0,!1,!1);const g=o.colorForInstance(n),y=e.bA([]),_=e.ef(p.lat,t.transform.zoom),v=e.bq([],[1,1,1/_]);e.br(y,y,r),j.push({zScaleMatrix:v,negCameraPosMatrix:y});for(const e of u.nodes)ra(t,e,f,t.transform.expandedFarZProjMatrix,x,b,w,u.materialOverrides,m,g);++x}}else for(const e of u.nodes)ua(t,n,e,o,v,f,la)}if(a)if("shadow"===t.renderPass){for(const e of w)na(e.mesh,e.nodeModelMatrix,t,n);for(const e of b)na(e.mesh,e.nodeModelMatrix,t,n)}else oa(t,n,b,w,j)}}(t,r,n,i,ta(t,n)),void h();if(!p.loaded())return;if("batched-model"===p.type)return function(t,r,n,i){n.resetLayerRenderingStats(t);const s=t.context,o=t.transform,a=t.style.fog,l=t.shadowRenderer;if("mercator"!==o.projection.name)return void e.w("Drawing 3D landmark models for ".concat(o.projection.name," projection is not yet implemented"));const c=t.transform.getFreeCameraOptions().position,u=e.c5([],[c.x,c.y,c.z],t.transform.worldSize),d=e.ew([],u),h=e.bA([]),p=e.ef(o.center.lat,o.zoom),m=e.bq([],[1,1,1/p]);e.br(h,h,d);const f=n.paint.get("model-opacity").constantOr(1),g=new Qr(s.gl.LEQUAL,Qr.ReadWrite,t.depthRangeFor3D),y=new Qr(s.gl.LEQUAL,Qr.ReadOnly,t.depthRangeFor3D),_=new e.d9([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),v="shadow"===t.renderPass,x=v&&l?l.getCurrentCascadeFrustum():o.getFrustum(o.scaleZoom(o.worldSize)),b=n.paint.get("model-front-cutoff"),w=b[2]<1,j=mn(t,n.paint.get("model-cutoff-fade-range")),S=n.getLayerRenderingStats();(function(e,t,r,n){const i=e.terrain?e.terrain.exaggeration():0,s=e.transform.zoom;for(const o of n){const n=t.getTile(o).getBucket(r);n&&(n.setFilter(r.filter),e.conflationActive&&n.updateReplacement(o,e.replacementSource),n.evaluateTransform(e,r),e.terrain&&i>0&&n.elevationUpdate(e.terrain,i,o,r.source),n.needsReEvaluation(e,s,r)&&n.evaluate(r))}})(t,r,n,i),function(){let c,d,T;w?(c=i.length-1,d=-1,T=-1):(c=0,d=i.length,T=1);const k=new Float64Array(16),A=e.cA(),C=new e.P(0,0);for(let E=c;E!==d;E+=T){const c=i[E],d=r.getTile(c).getBucket(n);if(!d||!d.uploaded)continue;let T=!1;l&&(T=0===l.getMaxCascadeForTile(c.toUnwrapped()));const N=o.calculatePosMatrix(c.toUnwrapped(),o.worldSize),I=d.modelTraits;!v&&w&&(e.bl(k,N),e.af(A,u,k),C.x=A[0],C.y=A[1]);const P=[];d.setFilter(n.filter);for(const r of d.getNodesInfo()){if(r.hiddenByReplacement)continue;if(!r.node.meshes)continue;const n=r.node;let i=0;t.terrain&&n.elevation&&(i=n.elevation*t.terrain.exaggeration());const s=(()=>{const t=r.aabb;return _.min=[...t.min],_.max=[...t.max],_.min[2]+=i,_.max[2]+=i,e.af(_.min,_.min,N),e.af(_.max,_.max,N),_})(),a=r.evaluatedScale;if(a[0]<=1&&a[1]<=1&&a[2]<=1&&0===s.intersects(x))continue;if(!v&&w){const t=1/6;r.cameraCollisionOpacity=u[0]>s.min[0]&&u[0]<s.max[0]&&u[1]>s.min[1]&&u[1]<s.max[1]&&u[2]*p<s.max[2]&&n.footprint&&e.c0(C,n.footprint)?Math.max(r.cameraCollisionOpacity-t,0):Math.min(1,r.cameraCollisionOpacity+t)}const l=[...N],d=1/e.d7(c.canonical),h=n.anchor?n.anchor[0]:0,m=n.anchor?n.anchor[1]:0;e.br(l,l,[h*(a[0]-1)+r.evaluatedTranslation[0]*d,m*(a[1]-1)+r.evaluatedTranslation[1]*d,i+r.evaluatedTranslation[2]]),e.cq(a,e.eE)||e.cS(l,l,a);const g=e.aB([],l,n.globalMatrix),y=e.aB([],o.expandedFarZProjMatrix,g),S=e.aB([],o.expandedFarZProjMatrix,l),T=e.aC([],[h,m,i,1],y)[2];n.hidden=!1;let k=f;v||(w&&(k*=r.cameraCollisionOpacity,k*=ma(l,o,r.aabb,b)),k*=pa(j,T)),0!==k?P.push({nodeInfo:r,depth:T,opacity:k,wvpForNode:y,wvpForTile:S,nodeModelMatrix:g,tileModelMatrix:l}):n.hidden=!0}v||P.sort((e,t)=>!w||1===e.opacity&&1===t.opacity?e.depth<t.depth?-1:1:1===e.opacity?-1:1===t.opacity?1:e.depth>t.depth?-1:1);for(const r of P){const i=r.nodeInfo,c=i.node;let u=e.aB([],m,r.tileModelMatrix);e.aB(u,h,u);const d=e.bl([],u);e.eg(d,d),e.cS(d,d,da),u=e.aB(u,u,c.globalMatrix);const p="light-beam"===t.renderPass,f="none"===n.paint.get("model-color-use-theme").constantOr("default"),_=I&e.eI.HasMapboxMeshFeatures,x=_?0:i.evaluatedRMEA[0][2];for(let e=0;e<c.meshes.length;++e){const h=c.meshes[e],m=e===c.lightMeshIndex;let b=r.wvpForNode;if(m){if(!p&&!t.terrain&&t.shadowRenderer){t.currentLayer<t.firstLightBeamLayer&&(t.firstLightBeamLayer=t.currentLayer);continue}b=r.wvpForTile}else if(p)continue;const w={defines:[]},j=[];if(!v&&l&&(l.useNormalOffset=!!h.normalBuffer),$o(w.defines,j,h,t,f?null:n.lut),_||w.defines.push("DIFFUSE_SHADED"),T&&w.defines.push("SHADOWS_SINGLE_CASCADE"),S&&(v?S.numRenderedVerticesInShadowPass+=h.vertexArray.length:S.numRenderedVerticesInTransparentPass+=h.vertexArray.length),v){na(h,r.nodeModelMatrix,t,n);continue}let k=null;if(a){const e=Qo(r.nodeModelMatrix,t.transform);if(k=new Float32Array(e),"globe"!==o.projection.name){const t=h.aabb.min,r=h.aabb.max,[n,i]=a.getOpacityForBounds(e,t[0],t[1],r[0],r[1]);w.overrideFog=n>=Ze||i>=Ze}}const A=h.material;let C;A.occlusionTexture&&A.occlusionTexture.offsetScale&&(C=A.occlusionTexture.offsetScale,w.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const E=t.getOrCreateProgram("model",w);!v&&l&&l.setupShadowsFromMatrix(r.tileModelMatrix,E,l.useNormalOffset),t.uploadCommonUniforms(s,E,null,k);const N=A.pbrMetallicRoughness;N.metallicFactor=.9,N.roughnessFactor=.5;const I=Zs(new Float32Array(b),new Float32Array(u),new Float32Array(d),new Float32Array(c.globalMatrix),t,r.opacity,N.baseColorFactor,A.emissiveFactor,N.metallicFactor,N.roughnessFactor,A,x,n,[0,0,0],C);!m&&(i.hasTranslucentParts||r.opacity<1)&&E.draw(t,s.gl.TRIANGLES,g,en.disabled,Jr.disabled,nn.backCCW,I,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,t.transform.zoom,void 0,j),E.draw(t,s.gl.TRIANGLES,m?y:g,en.disabled,m||r.opacity<1||i.hasTranslucentParts?Jr.alphaBlended:Jr.unblended,nn.backCCW,I,n.id,h.vertexBuffer,h.indexBuffer,h.segments,n.paint,t.transform.zoom,void 0,j)}}}}()}(t,r,n,i),void h();if("model"!==p.type)return;const m=p.getModels(),f=[],g=t.transform.getFreeCameraOptions().position,y=e.c5([],[g.x,g.y,g.z],t.transform.worldSize);e.ew(y,y);const _=[],v=[];let x=0;for(const b of m){const i=r.getFeatureState("",b.id),s={type:"Unknown",id:b.id,properties:b.featureProperties},o=n.paint.get("model-rotation").evaluate(s,i),c=n.paint.get("model-scale").evaluate(s,i),u=n.paint.get("model-translation").evaluate(s,i),d=n.paint.get("model-opacity").evaluate(s,i);ia(n,b.id,i,b.featureProperties,b.nodeOverrideNames,b.nodeOverrides),sa(n,b.id,i,b.featureProperties,b.materialOverrideNames,b.materialOverrides),b.nodeOverrides.size>0&&b.computeBoundsAndApplyParent(),b.computeModelMatrix(t,o,c,u,l,a,!1);const h=e.bA([]),p=e.ef(b.position.lat,t.transform.zoom),m=e.bq([],[1,1,1/p]);e.br(h,h,y),f.push({zScaleMatrix:m,negCameraPosMatrix:h});for(const e of b.nodes)ra(t,e,b.matrix,t.transform.expandedFarZProjMatrix,x,_,v,b.materialOverrides,d);x++}if(_.sort((e,t)=>t.depth-e.depth),"shadow"!==t.renderPass)oa(t,n,_,v,f),h();else{for(const e of v)na(e.mesh,e.nodeModelMatrix,t,n);for(const e of _)na(e.mesh,e.nodeModelMatrix,t,n);h()}}},Ia={line:function(e,t,r){if(e.hasElevatedBuckets=!1,e.hasNonElevatedBuckets=!1,void 0!==e._unevaluatedLayout.getValue("line-elevation-reference")||void 0!==e._unevaluatedLayout.getValue("line-z-offset")){if(t){const r=t.getVisibleCoordinates();for(const n of r){const r=t.getTile(n).getBucket(e);if(r&&("none"!==r.elevationType?e.hasElevatedBuckets=!0:e.hasNonElevatedBuckets=!0,e.hasElevatedBuckets&&e.hasNonElevatedBuckets))break}}}else e.hasNonElevatedBuckets=!0},model:function(e,t,r){const n=t.getSource();if(!n.loaded())return;if("vector"===n.type||"geojson"===n.type)return void(r.modelManager&&r.modelManager.upload(r,ta(r,e)));if("batched-model"===n.type)return;if("model"!==n.type)return;const i=n.getModels();for(const s of i)s.upload(r.context)},raster:function(e,t,r){const n=t.getSource();if(!(n instanceof yt&&n.loaded()))return;const i=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!i)return;const s=e.paint.get("raster-array-band")||n.getInitialBand(i);if(null==s)return;const o=t.getIds().map(e=>t.getTileByID(e));for(const a of o)a.updateNeeded(e.id,s)&&n.prepareTile(a,i,e.id,s)},"raster-particle":function(e,t,r){const n=t.getSource();if(!(n instanceof yt&&n.loaded()))return;const i=e.sourceLayer||n.rasterLayerIds&&n.rasterLayerIds[0];if(!i)return;const s=e.paint.get("raster-particle-array-band")||n.getInitialBand(i);if(null==s)return;const o=t.getIds().map(e=>t.getTileByID(e));for(const a of o)a.updateNeeded(e.id,s)&&n.prepareTile(a,i,e.id,s)}},Pa={fill:uo},Ma={fill:function(e,t,r,n){if(!r.layout||"none"===r.layout.get("fill-elevation-reference")||0===r.paint.get("fill-opacity").constantOr(1))return;const i=e.context.gl,s=new Qr(i.LEQUAL,Qr.ReadOnly,e.depthRangeFor3D),o=new en({func:i.ALWAYS,mask:255},255,255,i.KEEP,i.KEEP,i.REPLACE),a=e.transform.getFreeCameraOptions().position,l=e.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const c of n){const n=t.getTile(c),u=n.getBucket(r);if(!u)continue;const d=u.elevatedStructures;if(!d||0===d.depthSegments.segments[0].primitiveLength)continue;const h=co(c.toUnwrapped(),a),p=e.translatePosMatrix(c.projMatrix,n,r.paint.get("fill-translate"),r.paint.get("fill-translate-anchor")),m=ks(p,h,0,1,0);l.draw(e,i.TRIANGLES,s,o,Jr.disabled,nn.disabled,m,r.id,d.vertexBuffer,d.indexBuffer,d.depthSegments,r.paint,e.transform.zoom)}}};class La{constructor(t,r,n,i,s){this.context=new eo(t,r),this.transform=n,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this._timeStamp=e.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const o=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const e of o)this._debugParams.enabledLayers[e]=!0;for(const e of o);this.occlusionParams=new ya,this.setup(),this.numSublayers=zt.maxUnderzooming+zt.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new e.eP,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new _n(this),this._wireframeDebugCache=new ga,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const a=new e.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new e.T(this.context,a,t.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=i,this.worldview=s,this._forceEmissiveMode=!1,this.emissiveMode="constant"}updateTerrain(e,t){const r=!!e&&!!e.terrain&&this.transform.projection.supportsTerrain;if(!(r||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new cs(this,e));const n=this._terrain;this.transform.elevation=r?n:null,n.update(e,this.transform,t),this.transform.elevation&&!n.enabled&&(this.transform.elevation=null)}_updateFog(e){const t=e.fog;if(!t||"globe"===this.transform.projection.name||t.getOpacity(this.transform.pitch)<1||t.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[r,n]=t.getFovAdjustedRange(this.transform._fov);if(r>n)return void(this.transform.fogCullDistSq=null);const i=r+.78*(n-r);this.transform.fogCullDistSq=i*i}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(e){e&&!this._terrain&&(this._terrain=new cs(this,this.style)),this._forceTerrainMode=e}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(t,r){if(this.width=t*e.o.devicePixelRatio,this.height=r*e.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const e of this.style.order)this.style._mergedLayers[e].resize()}setup(){const t=this.context,r=new e.bd;r.emplaceBack(0,0),r.emplaceBack(e.al,0),r.emplaceBack(0,e.al),r.emplaceBack(e.al,e.al),this.tileExtentBuffer=t.createVertexBuffer(r,e.bf.members),this.tileExtentSegments=e.bg.simpleSegment(0,0,4,2);const n=new e.bd;n.emplaceBack(0,0),n.emplaceBack(e.al,0),n.emplaceBack(0,e.al),n.emplaceBack(e.al,e.al),this.debugBuffer=t.createVertexBuffer(n,e.bf.members),this.debugSegments=e.bg.simpleSegment(0,0,4,5);const i=new e.bd;i.emplaceBack(-1,-1),i.emplaceBack(1,-1),i.emplaceBack(-1,1),i.emplaceBack(1,1),this.viewportBuffer=t.createVertexBuffer(i,e.bf.members),this.viewportSegments=e.bg.simpleSegment(0,0,4,2);const s=new e.b1;s.emplaceBack(0,0,0,0),s.emplaceBack(e.al,0,e.al,0),s.emplaceBack(0,e.al,0,e.al),s.emplaceBack(e.al,e.al,e.al,e.al),this.mercatorBoundsBuffer=t.createVertexBuffer(s,e.bi.members),this.mercatorBoundsSegments=e.bg.simpleSegment(0,0,4,2);const o=new e.b0;o.emplaceBack(0,1,2),o.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=t.createIndexBuffer(o);const a=new e.be;for(const e of[0,1,3,2,0])a.emplaceBack(e);this.debugIndexBuffer=t.createIndexBuffer(a),this.emptyTexture=new e.T(t,new e.q({width:1,height:1},Uint8Array.of(0,0,0,0)),t.gl.RGBA8),this.identityMat=e.bC();const l=this.context.gl;this.stencilClearMode=new en({func:l.ALWAYS,mask:0},0,255,l.ZERO,l.ZERO,l.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(e){return e._makeTileBoundsBuffers(this.context,this.transform.projection),e._tileBoundsBuffer?{tileBoundsBuffer:e._tileBoundsBuffer,tileBoundsIndexBuffer:e._tileBoundsIndexBuffer,tileBoundsSegments:e._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const e=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,e.TRIANGLES,Qr.disabled,this.stencilClearMode,Jr.disabled,nn.disabled,is(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(e,t,r){if(!t||this.currentStencilSource===t.id||!e.isTileClipped()||!r||0===r.length)return;if(this._tileClippingMaskIDs&&!this.terrain){let e=!1;for(const t of r)if(void 0===this._tileClippingMaskIDs[t.key]){e=!0;break}if(!e)return}this.currentStencilSource=t.id;const n=this.context,i=n.gl;this.nextStencilID+r.length>256&&this.clearStencil(),n.setColorMode(Jr.disabled),n.setDepthMode(Qr.disabled);const s=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const o of r){const e=t.getTile(o),r=this._tileClippingMaskIDs[o.key]=this.nextStencilID++,{tileBoundsBuffer:n,tileBoundsIndexBuffer:a,tileBoundsSegments:l}=this.getTileBoundsBuffers(e);s.draw(this,i.TRIANGLES,Qr.disabled,new en({func:i.ALWAYS,mask:0},r,255,i.KEEP,i.KEEP,i.REPLACE),Jr.disabled,nn.disabled,is(o.projMatrix),"$clipping",n,a,l)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const e=this.nextStencilID++,t=this.context.gl;return new en({func:t.NOTEQUAL,mask:255},e,255,t.KEEP,t.KEEP,t.REPLACE)}stencilModeForClipping(e){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(e);const t=this.context.gl;return new en({func:t.EQUAL,mask:255},this._tileClippingMaskIDs[e.key],0,t.KEEP,t.KEEP,t.REPLACE)}stencilConfigForOverlap(e){const t=this.context.gl,r=e.sort((e,t)=>t.overscaledZ-e.overscaledZ),n=r[r.length-1].overscaledZ,i=r[0].overscaledZ-n+1;if(i>1){this.currentStencilSource=void 0,this.nextStencilID+i>256&&this.clearStencil();const e={};for(let r=0;r<i;r++)e[r+n]=new en({func:t.GEQUAL,mask:255},r+this.nextStencilID,255,t.KEEP,t.KEEP,t.REPLACE);return this.nextStencilID+=i,[e,r]}return[{[n]:en.disabled},r]}colorModeForRenderPass(){const t=this.context.gl;if(this._showOverdrawInspector){const r=1/8;return new Jr([t.CONSTANT_COLOR,t.ONE,t.CONSTANT_COLOR,t.ONE],new e.ao(r,r,r,0),[!0,!0,!0,!0])}return"opaque"===this.renderPass?Jr.unblended:Jr.alphaBlended}colorModeForDrapableLayerRenderPass(t){const r=this.context.gl;return(()=>this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture)()&&"translucent"===this.renderPass?null!=t&&"mrt-fallback"!==this.emissiveMode||"constant"===this.emissiveMode?new Jr([r.ONE,r.ONE_MINUS_SRC_ALPHA,r.CONSTANT_ALPHA,r.ONE_MINUS_SRC_ALPHA],new e.ao(0,0,0,null!=t?t:0),[!0,!0,!0,!0]):"dual-source-blending"===this.emissiveMode?new Jr([r.ONE,r.ONE_MINUS_SRC_ALPHA,this.context.extBlendFuncExtended.SRC1_ALPHA_WEBGL,r.ONE_MINUS_SRC_ALPHA],e.ao.transparent,[!0,!0,!0,!0]):this.colorModeForRenderPass():this.colorModeForRenderPass()}depthModeForSublayer(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(this.depthOcclusion)return new Qr(this.context.gl.GREATER,Qr.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!n)return Qr.disabled;const i=1-((1+this.currentLayer)*this.numSublayers+e)*this.depthEpsilon;return new Qr(r||this.context.gl.LEQUAL,t,[i,i])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const t=this.context.gl,r=Math.ceil(this.width),n=Math.ceil(this.height),i=this.context.bindFramebuffer.get(),s=t.getParameter(t.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===r&&this.depthFBO.height===n||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),0!==r&&0!==n&&(this.depthFBO=new $s(this.context,r,n,0,"texture"),this.depthTexture=new e.T(this.context,{width:r,height:n,data:null},t.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(i),t.bindTexture(t.TEXTURE_2D,s),this.depthFBO&&(t.bindFramebuffer(t.READ_FRAMEBUFFER,null),t.bindFramebuffer(t.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),t.blitFramebuffer(0,0,r,n,0,0,r,n,t.DEPTH_BUFFER_BIT,t.NEAREST),t.bindFramebuffer(t.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(0===this._dt?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((e,t)=>e+t/this._fpsHistory.length,0))}render(t,r){const n=e.o.now();this._dt=n-this._timeStamp,this._timeStamp=n,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=t.map.repaint,this.style=t,this.options=r;const i=this.style._mergedLayers,s=!(!this.terrain||!this.terrain.enabled),o=()=>this.style._getOrder(s).filter(e=>{const t=i[e];return!(t.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[t.type]});let a=o(),l=!1,c=!1,u=null,d=0,h=!1;for(const e of a){const t=i[e];"none"!==t.visibility&&("circle"===t.type?l=!0:"building"===t.type?(u=t,++d):"symbol"===t.type&&(t.hasOcclusionOpacityProperties?c=!0:l=!0))}this.updateEmissiveMode();let p=a.map(e=>i[e]);const m=this.style._mergedSourceCaches;this.imageManager=t.imageManager,this.modelManager=t.modelManager,this.symbolFadeChange=t.placement.symbolFadeChange(e.o.now()),this.imageManager.beginFrame();for(const e in m){const t=m[e];t.used&&(t.prepare(this.context),t.getSource().usedInConflation&&++d)}let f=!1;for(const e of p)e.isHidden(this.transform.zoom)||("clip"===e.type&&(f=!0),this.prepareLayer(e));const g={},y={},_={},v={},x={};for(const e in m){const t=m[e];g[e]=t.getVisibleCoordinates(),y[e]=g[e].slice().reverse(),_[e]=t.getVisibleCoordinates(!0).reverse(),v[e]=t.getShadowCasterCoordinates(),x[e]=t.sortCoordinatesByDistance(g[e])}const b=e=>{const t=this.style.getLayerSourceCache(e);return t&&t.used?t.getSource():null};if(d||f||this._clippingActiveLastFrame){const t=[],r=[];let n=0;for(const e of p)this.isSourceForClippingOrConflation(e,b(e))&&(t.push(e),r.push(n)),n++;if(t&&(f||t.length>1)||this._clippingActiveLastFrame){f=!1;const n=[];for(let i=0;i<t.length;i++){const s=t[i],o=r[i],a=this.style.getLayerSourceCache(s);if(!a||!a.used||!a.getSource().usedInConflation&&"clip"!==s.type&&"building"!==s.type)continue;let l=e.eQ,c=e.b_.None;const u=[];let d=!0;if("building"===s.type)l=e.eS;else if("clip"===s.type){l=o;for(const t of s.layout.get("clip-layer-types"))c|="model"===t?e.b_.Model:"symbol"===t?e.b_.Symbol:e.b_.FillExtrusion;for(const e of s.layout.get("clip-layer-scope"))u.push(e);s.isHidden(this.transform.zoom)?d=!1:f=!0}d&&n.push({layer:s.fqid,cache:a,order:l,clipMask:c,clipScope:u})}this.replacementSource.setSources(n),h=!0}}this._clippingActiveLastFrame=f,h||this.replacementSource.clear(),this.conflationActive=h,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let e=0;e<p.length;e++){const t=p[e];if("none"===t.visibility)continue;const r=t.cutoffRange();if(this.longestCutoffRange=Math.max(r,this.longestCutoffRange),r>0){const e=b(t);e&&(this.minCutoffZoom=Math.max(e.minzoom,this.minCutoffZoom)),t.minzoom&&(this.minCutoffZoom=Math.max(t.minzoom,this.minCutoffZoom))}t.is3D(s)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=e),this._lastOcclusionLayer=e)}const w=this.style&&this.style.fog;w?(this._fogVisible=0!==w.getOpacity(this.transform.pitch),this._fogVisible&&"globe"!==this.transform.projection.name&&(this._fogVisible=w.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(_),this.opaquePassCutoff=0,a=o(),p=a.map(e=>i[e]));const j=this._shadowRenderer;if(j){j.updateShadowParameters(this.transform,this.style.directionalLight);for(const e in m)for(const t of g[e]){let e={min:0,max:0};this.terrain&&(e=this.terrain.getMinMaxForTile(t)||e),j.addShadowReceiver(t.toUnwrapped(),e.min,e.max)}}"globe"!==this.transform.projection.name||this.globeSharedBuffers||(this.globeSharedBuffers=new e.eR(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Xo(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const S=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),T=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(S&&!this._snow&&(this._snow=new Ea(this)),!S&&this._snow&&(this._snow.destroy(),delete this._snow),T&&!this._rain&&(this._rain=new Aa(this)),!T&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),u){this.buildingTileBorderManager||(this.buildingTileBorderManager=new Jo);const e=this.style.getLayerSourceCache(u);this.buildingTileBorderManager.updateBorders(e,u)}if(!K.has(this.context.gl))return;this.renderPass="offscreen";for(const e of p){const r=t.getLayerSourceCache(e);if(!e.hasOffscreenPass()||e.isHidden(this.transform.zoom))continue;const n=r?y[r.id]:void 0;("custom"===e.type||"raster"===e.type||"raster-particle"===e.type||e.isSky()||n&&n.length)&&this.renderLayer(this,r,e,n)}this.depthRangeFor3D=[0,1-(p.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,v)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const k="globe"===this.transform.projection.name||this.transform.isHorizonVisible(),A=(()=>{if(r.showOverdrawInspector)return e.ao.black;const t=this.style.fog;if(t&&this.transform.projection.supportsFog){const r=this.style.getLut(t.scope);if(!k){const n="none"===t.properties.get("color-use-theme"),i=t.properties.get("color").toNonPremultipliedRenderColor(n?null:r).toArray01();return new e.ao(...i)}if(k){const n="none"===t.properties.get("space-color-use-theme"),i=t.properties.get("space-color").toNonPremultipliedRenderColor(n?null:r).toArray01();return new e.ao(...i)}}return e.ao.transparent})();if(this.context.clear({color:A,depth:1}),this.clearStencil(),this._showOverdrawInspector=r.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&k&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=a.length-1;this.currentLayer>=0;this.currentLayer--){const e=p[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())continue;const n=r?(e.is3D(s)?x:y)[r.id]:void 0;this._renderTileClippingMasks(e,r,n),this.renderLayer(this,r,e,n)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&k&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||e.aj(this.transform.zoom)>0)&&("globe"===this.transform.projection.name||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<a.length;this.currentLayer++){const e=p[this.currentLayer],r=t.getLayerSourceCache(e);e.isSky()&&this.renderLayer(this,r,e,r?y[r.id]:void 0)}function C(e,t){let r;return t&&(r=("symbol"===e.type?_:e.is3D(s)?x:y)[t.id]),r}if(this.renderPass="translucent","globe"===this.transform.projection.name){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<a.length;){const e=p[this.currentLayer];if("raster"===e.type||"raster-particle"===e.type){const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,C(e,r))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let E=0;j&&(E=j.getShadowCastingLayerCount());let N=!1,I=-1;for(let e=0;e<a.length;++e){const t=p[e];t.isHidden(this.transform.zoom)||t.is3D(s)&&(I=e)}c&&-1===I&&(l=!0);let P=!1;for(;this.currentLayer<a.length;){const e=p[this.currentLayer],r=t.getLayerSourceCache(e);if(e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(e)){if(e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!P&&e.is3D(s)&&!s){const e=this.currentLayer,t=e=>{for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const t=p[this.currentLayer];if(Pa[t.type]){const r=this.style.getLayerSourceCache(t);Pa[t.type](this,r,t,C(t,r),e)}}};t("initialize"),t("reset"),this.currentLayer=e,P=!0}if(l&&!N&&this.terrain&&!this.transform.isOrthographic&&(N=!0,this.blitDepth()),c&&-1!==I&&this.currentLayer===I+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(e,r,r?g[r.id]:void 0),this.renderLayer(this,r,e,C(e,r)),!this.terrain&&j&&E>0&&e.hasShadowPass()&&0==--E){{this.clearStencil(),this.resetStencilClippingMasks();const e=this.currentLayer;for(this.currentLayer=0;this.currentLayer<p.length;this.currentLayer++){const e=p[this.currentLayer];if(Ma[e.type]){const t=this.style.getLayerSourceCache(e);Ma[e.type](this,t,e,C(e,t))}}this.currentLayer=e}if(j.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const e=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=e;this.currentLayer++){const e=p[this.currentLayer];if(!e.hasLightBeamPass())continue;const r=t.getLayerSourceCache(e);this.renderLayer(this,r,e,r?y[r.id]:void 0)}this.currentLayer=e,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const e=this.currentLayer;this.depthOcclusion=!0;for(const r of this.layersWithOcclusionOpacity){this.currentLayer=r;const e=p[this.currentLayer],n=t.getLayerSourceCache(e),i=n?y[n.id]:void 0;this.terrain||this._renderTileClippingMasks(e,n,n?g[n.id]:void 0),this.renderLayer(this,n,e,i)}this.depthOcclusion=!1,this.currentLayer=e,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let r=null;p.forEach(e=>{const n=t.getLayerSourceCache(e);n&&!e.isHidden(this.transform.zoom)&&n.getVisibleCoordinates().length&&(!r||r.getSource().maxzoom<n.getSource().maxzoom)&&(r=n)}),r&&this.options.showTileBoundaries&&Do(this,r,r.getVisibleCoordinates(),e.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&Do(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new e.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function(e){const t=e.transform.padding;Oo(e,e.transform.height-(t.top||0),3,Io),Oo(e,t.bottom||0,3,Po),zo(e,t.left||0,3,Mo),zo(e,e.transform.width-(t.right||0),3,Lo);const r=e.transform.centerPoint;!function(e,t,r,n){Bo(e,t-1,r-10,2,20,n),Bo(e,t-10,r-1,20,2,n)}(e,r.x,e.transform.height-r.y,Ro)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),h||(this.conflationActive=!1)}prepareLayer(e){this.gpuTimingStart(e);const{unsupportedLayers:t}=this.transform.projection,r=!t||!t.includes(e.type);if(Ia[e.type]&&(r||this.terrain&&"custom"===e.type)){const t=this.style.getLayerSourceCache(e);Ia[e.type](e,t,this)}this.gpuTimingEnd()}renderLayer(e,t,r,n){r.isHidden(this.transform.zoom)||("background"===r.type||"sky"===r.type||"custom"===r.type||"model"===r.type||"raster"===r.type||"raster-particle"===r.type||n&&n.length)&&(this.id=r.id,this.gpuTimingStart(r),e.transform.projection.unsupportedLayers&&e.transform.projection.unsupportedLayers.includes(r.type)&&(!e.terrain||"custom"!==r.type)||"clip"===r.type||Na[r.type](e,t,r,n,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(e){if(!this.options.gpuTiming)return;const t=this.context.extTimerQuery,r=this.context.gl;let n=this.gpuTimers[e.id];n||(n=this.gpuTimers[e.id]={calls:0,cpuTime:0,query:r.createQuery()}),n.calls++,r.beginQuery(t.TIME_ELAPSED_EXT,n.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const e=this.context.extTimerQuery,t=this.context.gl,r=t.createQuery();this.deferredRenderGpuTimeQueries.push(r),t.beginQuery(e.TIME_ELAPSED_EXT,r)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const e=this.gpuTimers;return this.gpuTimers={},e}collectDeferredRenderGpuQueries(){const e=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],e}queryGpuTimers(e){const t={};for(const r in e){const n=e[r],i=this.context.extTimerQuery,s=i.getQueryParameter(n.query,this.context.gl.QUERY_RESULT)/1e6;i.deleteQueryEXT(n.query),t[r]=s}return t}queryGpuTimeDeferredRender(e){if(!this.options.gpuTimingDeferredRender)return 0;const t=this.context.gl;let r=0;for(const n of e)r+=t.getQueryParameter(n,t.QUERY_RESULT)/1e6,t.deleteQuery(n);return r}translatePosMatrix(t,r,n,i,s){if(!n[0]&&!n[1])return t;const o=s?"map"===i?this.transform.angle:0:"viewport"===i?-this.transform.angle:0;if(o){const e=Math.sin(o),t=Math.cos(o);n=[n[0]*t-n[1]*e,n[0]*e+n[1]*t]}const a=[s?n[0]:e.ay(r,n[0],this.transform.zoom),s?n[1]:e.ay(r,n[1],this.transform.zoom),0],l=new Float32Array(16);return e.br(l,t,a),l}saveTileTexture(e){if(e.context!==this.context)return;const t=e.size[0],r=this._tileTextures[t];r?r.push(e):this._tileTextures[t]=[e]}getTileTexture(e){const t=this._tileTextures[e];return t&&t.length>0?t.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return null!=this.context.extTextureFloatLinear}currentGlobalDefines(e,t,r){const n=void 0===r?this.terrain&&this.terrain.renderingToTexture:r,i=[];return this.style&&this.style.enable3dLights()&&("globeRaster"===e||"terrainRaster"===e?(i.push("LIGHTING_3D_MODE"),i.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):n||i.push("LIGHTING_3D_MODE")),"shadow"===this.renderPass&&(this._shadowMapDebug||i.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(i.push("TERRAIN"),this.linearFloatFilteringSupported()&&i.push("TERRAIN_DEM_FLOAT_FORMAT")),"globe"===this.transform.projection.name&&i.push("GLOBE"),!this._fogVisible||n||void 0!==t&&!t||i.push("FOG","FOG_DITHERING"),n&&i.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&i.push("OVERDRAW_INSPECTOR"),i}getOrCreateProgram(e,t){this.cache=this.cache||{};const r=t&&t.defines||[],n=t&&t.config,i=this.currentGlobalDefines(e,t&&t.overrideFog,t&&t.overrideRtt).concat(r),s=ps.cacheKey(si[e],e,i,n);return this.cache[s]||(this.cache[s]=new ps(this.context,e,si[e],n,Ys[e],i)),this.cache[s]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const e=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(e.FUNC_ADD)}initDebugOverlayCanvas(){null==this.debugOverlayCanvas&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new e.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(t,r){if(this.style.enable3dLights()){const n=this.style.directionalLight,i=this.style.ambientLight;if(n&&i){const s=((t,r,n)=>{const i=t.properties.get("direction"),s="none"===t.properties.get("color-use-theme"),o=t.properties.get("color").toNonPremultipliedRenderColor(s?null:n.getLut(t.scope)).toArray01(),a=t.properties.get("intensity"),l="none"===r.properties.get("color-use-theme"),c=r.properties.get("color").toNonPremultipliedRenderColor(l?null:n.getLut(r.scope)).toArray01(),u=r.properties.get("intensity"),d=[i.x,i.y,i.z],h=e.dN(c,u),p=e.dN(o,a);return{u_lighting_ambient_color:h,u_lighting_directional_dir:d,u_lighting_directional_color:p,u_ground_radiance:us(d,p,h)}})(n,i,this.style);r.setLightsUniformValues(t,s)}}}uploadCommonUniforms(t,r,n,i,s){if(this.uploadCommonLightUniforms(t,r),this.terrain&&this.terrain.renderingToTexture)return;const o=this.style.fog;if(o){const s=o.getOpacity(this.transform.pitch),a=((t,r,n,i,s,o,a,l,c,u,d,h)=>{const p=t.transform,m="none"===r.properties.get("color-use-theme"),f=r.properties.get("color").toNonPremultipliedRenderColor(m?null:t.style.getLut(r.scope)).toArray01();f[3]=i;const g=t.frameCounter/1e3%1,[y,_]=r.properties.get("vertical-range");return{u_fog_matrix:n?p.calculateFogTileMatrix(n):h||t.identityMat,u_fog_range:r.getFovAdjustedRange(p._fov),u_fog_color:f,u_fog_horizon_blend:r.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(y,_),_],u_fog_temporal_offset:g,u_frustum_tl:s,u_frustum_tr:o,u_frustum_br:a,u_frustum_bl:l,u_globe_pos:c,u_globe_radius:u,u_viewport:d,u_globe_transition:e.aj(p.zoom),u_is_globe:+("globe"===p.projection.name)}})(this,o,n,s,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*e.o.devicePixelRatio,this.transform.height*e.o.devicePixelRatio],i);r.setFogUniformValues(t,a)}s&&r.setCutoffUniformValues(t,s.uniformValues)}setTileLoadedFlag(e){this.tileLoaded=e}saveCanvasCopy(){const e=this.canvasCopy();e&&(this.frameCopies.push(e),this.tileLoaded=!1)}canvasCopy(){const e=this.context.gl,t=e.createTexture();return e.bindTexture(e.TEXTURE_2D,t),e.copyTexImage2D(e.TEXTURE_2D,0,e.RGBA,0,0,e.drawingBufferWidth,e.drawingBufferHeight,0),t}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const e=this.style&&this.style.fog;return!!e&&0!==e.getOpacity(this.transform.pitch)}getBackgroundTiles(){const e=this._backgroundTiles,t=this._backgroundTiles={},r=this.transform.coveringTiles({tileSize:512});for(const n of r)t[n.key]=e[n.key]||new Rt(n,512,this.transform.tileZoom,this,void 0,this.worldview);return t}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(e,t){return!(!e.is3D(!(!this.terrain||!this.terrain.enabled))||"clip"!==e.type&&"building"!==e.type&&(e.minzoom&&e.minzoom>this.transform.zoom||(this.style._clipLayerPresent||"building"!==e.sourceLayer&&"procedural_buildings"!==e.sourceLayer)&&(!t||"batched-model"!==t.type)))}isTileAffectedByFog(e){if(!this.style||!this.style.fog)return!1;if("globe"===this.transform.projection.name)return!0;let t=this._cachedTileFogOpacities[e.key];return t||(this._cachedTileFogOpacities[e.key]=t=this.style.fog.getOpacityForTile(e)),t[0]>=Ze||t[1]>=Ze}setupDepthForOcclusion(e,t,r){const n=this.context,i=n.gl,s=!!r;var o;r||(r={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),n.activeTexture.set(i.TEXTURE3),e&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),r.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],r.u_depth_range_unpack=[2/((o=this.depthRangeFor3D)[1]-o[0]),-1-2*o[0]/(o[1]-o[0])],r.u_occluder_half_size=.5*this.occlusionParams.occluderSize,r.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(i.NEAREST,i.CLAMP_TO_EDGE),n.activeTexture.set(i.TEXTURE0),s||t.setTerrainUniformValues(n,r)}updateEmissiveMode(){if(this._forceEmissiveMode)return;const e=this.style.hasDataDrivenEmissiveStrength();this.emissiveMode=e?this.context.extBlendFuncExtended?"dual-source-blending":"mrt-fallback":"constant"}}function Ra(e,t){let r=!1,n=null;const i=()=>{n=null,r&&(e(),n=setTimeout(i,t),r=!1)};return()=>(r=!0,n||i(),n)}class Da{constructor(t){this._hashName=t&&encodeURIComponent(t),e.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=Ra(this._updateHashUnthrottled.bind(this),300)}addTo(e){return this._map=e,window.addEventListener("hashchange",this._onHashChange,!1),e.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const e=this._map;if(!e)return"";const t=Fa(e);if(this._hashName){const e=this._hashName;let r=!1;const n=location.hash.slice(1).split("&").map(n=>{const i=n.split("=")[0];return i===e?(r=!0,"".concat(i,"=").concat(t)):n}).filter(e=>e);return r||n.push("".concat(e,"=").concat(t)),"#".concat(n.join("&"))}return"#".concat(t)}_getCurrentHash(){const e=location.hash.replace("#","");if(this._hashName){let t;return e.split("&").map(e=>e.split("=")).forEach(e=>{e[0]===this._hashName&&(t=e)}),(t&&t[1]||"").split("/")}return e.split("/")}_onHashChange(){const e=this._map;if(!e)return!1;const t=this._getCurrentHash();if(t.length>=3&&!t.some(e=>isNaN(Number(e)))){const r=e.dragRotate.isEnabled()&&e.touchZoomRotate.isEnabled()?+(t[3]||0):e.getBearing();return e.jumpTo({center:[+t[2],+t[1]],zoom:+t[0],bearing:r,pitch:+(t[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Fa(e,t){const r=e.getCenter(),n=Math.round(100*e.getZoom())/100,i=Math.ceil((n*Math.LN2+Math.log(512/360/.5))/Math.LN10),s=Math.pow(10,i),o=Math.round(r.lng*s)/s,a=Math.round(r.lat*s)/s,l=e.getBearing(),c=e.getPitch();let u=t?"/".concat(o,"/").concat(a,"/").concat(n):"".concat(n,"/").concat(a,"/").concat(o);return(l||c)&&(u+="/"+Math.round(10*l)/10),c&&(u+="/".concat(Math.round(c))),u}const Oa={linearity:.3,easing:e.eT(0,0,.3,1)},za=Object.assign({deceleration:2500,maxSpeed:1400},Oa),Ba=Object.assign({deceleration:20,maxSpeed:1400},Oa),Ua=Object.assign({deceleration:1e3,maxSpeed:360},Oa),Va=Object.assign({deceleration:1e3,maxSpeed:90},Oa);class qa{constructor(e){this._map=e,this.clear()}clear(){this._inertiaBuffer=[]}record(t){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:e.o.now(),settings:t})}_drainInertiaBuffer(){const t=this._inertiaBuffer,r=e.o.now();for(;t.length>0&&r-t[0].time>160;)t.shift()}_onMoveEnd(t){if(this._map._prefersReducedMotion())return;if(this._drainInertiaBuffer(),this._inertiaBuffer.length<2)return;const r={zoom:0,bearing:0,pitch:0,pan:new e.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:e}of this._inertiaBuffer)r.zoom+=e.zoomDelta||0,r.bearing+=e.bearingDelta||0,r.pitch+=e.pitchDelta||0,e.panDelta&&r.pan._add(e.panDelta),e.around&&(r.around=e.around),e.pinchAround&&(r.pinchAround=e.pinchAround);const n=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,i={};if(r.pan.mag()){const e=Ha(r.pan.mag(),n,Object.assign({},za,t||{}));i.offset=r.pan.mult(e.amount/r.pan.mag()),i.center=this._map.transform.center,Wa(i,e)}if(r.zoom){const e=Ha(r.zoom,n,Ba);i.zoom=this._map.transform.zoom+e.amount,Wa(i,e)}if(r.bearing){const t=Ha(r.bearing,n,Ua);i.bearing=this._map.transform.bearing+e.aA(t.amount,-179,179),Wa(i,t)}if(r.pitch){const e=Ha(r.pitch,n,Va);i.pitch=this._map.transform.pitch+e.amount,Wa(i,e)}if(i.zoom||i.bearing){const e=void 0===r.pinchAround?r.around:r.pinchAround;i.around=e?this._map.unproject(e):this._map.getCenter()}return this.clear(),i.noMoveStart=!0,i}}function Wa(e,t){(!e.duration||e.duration<t.duration)&&(e.duration=t.duration,e.easing=t.easing)}function Ha(t,r,n){const{maxSpeed:i,linearity:s,deceleration:o}=n,a=e.aA(t*s/(r/1e3),-i,i),l=Math.abs(a)/(o*s);return{easing:n.easing,duration:1e3*l,amount:a*(l/2)}}class Ga extends e.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};const i=x(t.getCanvasContainer(),r),s=t.unproject(i);super(e,Object.assign({point:i,lngLat:s,originalEvent:r},n)),this._defaultPrevented=!1,this.target=t}}class Za extends e.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(t,r,n){const i="touchend"===t?n.changedTouches:n.touches,s=b(r.getCanvasContainer(),i),o=s.map(e=>r.unproject(e)),a=s.reduce((e,t,r,n)=>e.add(t.div(n.length)),new e.P(0,0));super(t,{points:s,point:a,lngLats:o,lngLat:r.unproject(a),originalEvent:n}),this._defaultPrevented=!1}}class Ka extends e.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(e,t){super("wheel",{originalEvent:t}),this._defaultPrevented=!1}}class Ya{constructor(e,t){this._map=e,this._clickTolerance=t.clickTolerance}reset(){this._mousedownPos=void 0}wheel(e){return this._firePreventable(new Ka(this._map,e))}mousedown(e,t){return this._mousedownPos=t,this._firePreventable(new Ga(e.type,this._map,e))}mouseup(e){this._map.fire(new Ga(e.type,this._map,e))}preclick(e){const t=new MouseEvent("preclick",e);this._map.fire(new Ga(t.type,this._map,t))}click(e,t){this._mousedownPos&&this._mousedownPos.dist(t)>=this._clickTolerance||(this.preclick(e),this._map.fire(new Ga(e.type,this._map,e)))}dblclick(e){return this._firePreventable(new Ga(e.type,this._map,e))}mouseover(e){this._map.fire(new Ga(e.type,this._map,e))}mouseout(e){this._map.fire(new Ga(e.type,this._map,e))}touchstart(e){return this._firePreventable(new Za(e.type,this._map,e))}touchmove(e){this._map.fire(new Za(e.type,this._map,e))}touchend(e){this._map.fire(new Za(e.type,this._map,e))}touchcancel(e){this._map.fire(new Za(e.type,this._map,e))}_firePreventable(e){if(this._map.fire(e),e.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Xa{constructor(e){this._map=e}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(e){this._map.fire(new Ga(e.type,this._map,e))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Ga("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(e){this._delayContextMenu?this._contextMenuEvent=e:this._map.fire(new Ga(e.type,this._map,e)),this._map.listens("contextmenu")&&e.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ja{constructor(e,t){this._map=e,this._el=e.getCanvasContainer(),this._container=e.getContainer(),this._clickTolerance=t.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(e,t){this.isEnabled()&&e.shiftKey&&0===e.button&&(g(),this._startPos=this._lastPos=t,this._active=!0)}mousemoveWindow(e,t){if(!this._active)return;const r=t,n=this._startPos,i=this._lastPos;if(!n||!i||i.equals(r)||!this._box&&r.dist(n)<this._clickTolerance)return;this._lastPos=r,this._box||(this._box=d("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",e));const s=Math.min(n.x,r.x),o=Math.max(n.x,r.x),a=Math.min(n.y,r.y),l=Math.max(n.y,r.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform="translate(".concat(s,"px,").concat(a,"px)"),this._box.style.width=o-s+"px",this._box.style.height=l-a+"px")})}mouseupWindow(t,r){if(!this._active)return;const n=this._startPos,i=r;if(n&&0===t.button){if(this.reset(),v(),n.x!==i.x||n.y!==i.y)return this._map.fire(new e.z("boxzoomend",{originalEvent:t})),{cameraAnimation:e=>e.fitScreenCoordinates(n,i,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",t)}}keydown(e){this._active&&27===e.keyCode&&(this.reset(),this._fireEvent("boxzoomcancel",e))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),y(),delete this._startPos,delete this._lastPos}_fireEvent(t,r){return this._map.fire(new e.z(t,{originalEvent:r}))}}function Qa(e,t){const r={};for(let n=0;n<e.length;n++)r[e[n].identifier]=t[n];return r}class $a{constructor(e){this.reset(),this.numTouches=e.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(t,r,n){(this.centroid||n.length>this.numTouches)&&(this.aborted=!0),this.aborted||(0===this.startTime&&(this.startTime=t.timeStamp),n.length===this.numTouches&&(this.centroid=function(t){const r=new e.P(0,0);for(const e of t)r._add(e);return r.div(t.length)}(r),this.touches=Qa(n,r)))}touchmove(e,t,r){if(this.aborted||!this.centroid)return;const n=Qa(r,t);for(const i in this.touches){const e=n[i];(!e||e.dist(this.touches[i])>30)&&(this.aborted=!0)}}touchend(e,t,r){if((!this.centroid||e.timeStamp-this.startTime>500)&&(this.aborted=!0),0===r.length){const e=!this.aborted&&this.centroid;if(this.reset(),e)return e}}}class el{constructor(e){this.singleTap=new $a(e),this.numTaps=e.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(e,t,r){this.singleTap.touchstart(e,t,r)}touchmove(e,t,r){this.singleTap.touchmove(e,t,r)}touchend(e,t,r){const n=this.singleTap.touchend(e,t,r);if(n){const t=e.timeStamp-this.lastTime<500,r=!this.lastTap||this.lastTap.dist(n)<30;if(t&&r||this.reset(),this.count++,this.lastTime=e.timeStamp,this.lastTap=n,this.count===this.numTaps)return this.reset(),n}}}class tl{constructor(){this._zoomIn=new el({numTouches:1,numTaps:2}),this._zoomOut=new el({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(e,t,r){this._zoomIn.touchstart(e,t,r),this._zoomOut.touchstart(e,t,r)}touchmove(e,t,r){this._zoomIn.touchmove(e,t,r),this._zoomOut.touchmove(e,t,r)}touchend(e,t,r){const n=this._zoomIn.touchend(e,t,r),i=this._zoomOut.touchend(e,t,r);return n?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()+1,around:t.unproject(n)},{originalEvent:e})}):i?(this._active=!0,e.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:t=>t.easeTo({duration:300,zoom:t.getZoom()-1,around:t.unproject(i)},{originalEvent:e})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const rl={0:1,2:2},nl={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class il{constructor(e){this.reset(),this._clickTolerance=e.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(e,t){return!1}_move(e,t){return{}}mousedown(e,t){if(this._lastPoint)return;const r=w(e);this._correctButton(e,r)&&(this._lastPoint=t,this._eventButton=r)}mousemoveWindow(e,t){const r=this._lastPoint;if(r)if(e.preventDefault(),null!=this._eventButton&&function(e,t){const r=rl[t];return void 0===e.buttons||(e.buttons&r)!==r}(e,this._eventButton))this.reset();else if(this._moved||!(t.dist(r)<this._clickTolerance))return this._moved=!0,this._lastPoint=t,this._move(r,t)}mouseupWindow(e){this._lastPoint&&w(e)===this._eventButton&&(this._moved&&v(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class sl extends il{mousedown(e,t){super.mousedown(e,t),this._lastPoint&&(this._active=!0)}_correctButton(e,t){return 0===t&&!e.ctrlKey}_move(e,t){return{around:t,panDelta:t.sub(e)}}}class ol extends il{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?nl[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const r=.8*(t.x-e.x);if(r)return this._active=!0,{bearingDelta:r}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class al extends il{constructor(e){super(e),this._pitchRotateKey=e.pitchRotateKey?nl[e.pitchRotateKey]:void 0}_correctButton(e,t){return this._pitchRotateKey?0===t&&e[this._pitchRotateKey]:0===t&&e.ctrlKey||2===t}_move(e,t){const r=-.5*(t.y-e.y);if(r)return this._active=!0,{pitchDelta:r}}contextmenu(e){this._pitchRotateKey||e.preventDefault()}}class ll{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._minTouches=1,this._clickTolerance=r.clickTolerance||1,this.reset(),e.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new e.P(0,0)}touchstart(e,t,r){return this._calculateTransform(e,t,r)}touchmove(t,r,n){if(this._active&&!(n.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(1===n.length&&!e.eU())return void this._showTouchPanBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return t.cancelable&&t.preventDefault(),this._calculateTransform(t,r,n)}}touchend(e,t,r){this._calculateTransform(e,t,r),this._active&&r.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(t,r,n){n.length>0&&(this._active=!0);const i=Qa(n,r),s=new e.P(0,0),o=new e.P(0,0);let a=0;for(const e in i){const t=i[e],r=this._touches[e];r&&(s._add(t),o._add(t.sub(r)),a++,i[e]=t)}if(this._touches=i,a<this._minTouches||!o.mag())return;const l=o.div(a);return this._sum._add(l),this._sum.mag()<this._clickTolerance?void 0:{around:s.div(a),panDelta:l}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=d("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class cl{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(e){}_move(e,t,r){return{}}touchstart(e,t,r){this._firstTwoTouches||r.length<2||(this._firstTwoTouches=[r[0].identifier,r[1].identifier],this._start([t[0],t[1]]))}touchmove(e,t,r){const n=this._firstTwoTouches;if(!n)return;e.preventDefault();const[i,s]=n,o=ul(r,t,i),a=ul(r,t,s);if(!o||!a)return;const l=this._aroundCenter?null:o.add(a).div(2);return this._move([o,a],l,e)}touchend(e,t,r){if(!this._firstTwoTouches)return;const[n,i]=this._firstTwoTouches,s=ul(r,t,n),o=ul(r,t,i);s&&o||(this._active&&v(),this.reset())}touchcancel(){this.reset()}enable(e){this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function ul(e,t,r){for(let n=0;n<e.length;n++)if(e[n].identifier===r)return t[n]}function dl(e,t){return Math.log2(e/t)}class hl extends cl{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(e){this._startDistance=this._distance=e[0].dist(e[1])}_move(e,t){const r=this._distance;if(this._distance=e[0].dist(e[1]),this._active||!(Math.abs(dl(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:dl(this._distance,r),pinchAround:t}}}function pl(e,t){return 180*e.angleWith(t)/Math.PI}class ml extends cl{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(e){this._startVector=this._vector=e[0].sub(e[1]),this._minDiameter=e[0].dist(e[1])}_move(e,t){const r=this._vector;if(this._vector=e[0].sub(e[1]),r&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:pl(this._vector,r),pinchAround:t}}_isBelowThreshold(e){this._minDiameter=Math.min(this._minDiameter,e.mag());const t=25/(Math.PI*this._minDiameter)*360,r=this._startVector;if(!r)return!1;const n=pl(e,r);return Math.abs(n)<t}}function fl(e){return Math.abs(e.y)>Math.abs(e.x)}class gl extends cl{constructor(e){super(),this._map=e}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(e){this._lastPoints=e,fl(e[0].sub(e[1]))&&(this._valid=!1)}_move(t,r,n){const i=this._lastPoints;if(!i)return;const s=t[0].sub(i[0]),o=t[1].sub(i[1]);return this._map._cooperativeGestures&&!e.eU()&&n.touches.length<3||(this._valid=this.gestureBeginsVertically(s,o,n.timeStamp),!this._valid)?void 0:(this._lastPoints=t,this._active=!0,{pitchDelta:(s.y+o.y)/2*-.5})}gestureBeginsVertically(e,t,r){if(void 0!==this._valid)return this._valid;const n=e.mag()>=2,i=t.mag()>=2;if(!n&&!i)return;if(!n||!i)return null==this._firstMove&&(this._firstMove=r),r-this._firstMove<100&&void 0;const s=e.y>0==t.y>0;return fl(e)&&fl(t)&&s}}const yl={panStep:100,bearingStep:15,pitchStep:10};class _l{constructor(){const e=yl;this._panStep=e.panStep,this._bearingStep=e.bearingStep,this._pitchStep=e.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(e){if(e.altKey||e.ctrlKey||e.metaKey)return;let t=0,r=0,n=0,i=0,s=0;switch(e.keyCode){case 61:case 107:case 171:case 187:t=1;break;case 189:case 109:case 173:t=-1;break;case 37:e.shiftKey?r=-1:(e.preventDefault(),i=-1);break;case 39:e.shiftKey?r=1:(e.preventDefault(),i=1);break;case 38:e.shiftKey?n=1:(e.preventDefault(),s=-1);break;case 40:e.shiftKey?n=-1:(e.preventDefault(),s=1);break;default:return}return this._rotationDisabled&&(r=0,n=0),{cameraAnimation:o=>{const a=o.getZoom();o.easeTo({duration:300,easeId:"keyboardHandler",easing:vl,zoom:t?Math.round(a)+t*(e.shiftKey?2:1):a,bearing:o.getBearing()+r*this._bearingStep,pitch:o.getPitch()+n*this._pitchStep,offset:[-i*this._panStep,-s*this._panStep],center:o.getCenter()},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function vl(e){return e*(2-e)}const xl=4.000244140625,bl=1/450;class wl{constructor(t,r){this._map=t,this._el=t.getCanvasContainer(),this._handler=r,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=bl,e.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(e){this._defaultZoomRate=e}setWheelZoomRate(e){this._wheelZoomRate=e}isEnabled(){return!!this._enabled}isActive(){return this._active||void 0!==this._finishTimeout}isZooming(){return!!this._zooming}enable(e){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!e&&"center"===e.around,this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(t){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(t.ctrlKey||t.metaKey||this.isZooming()||e.eU()))return void this._showBlockerAlert();"hidden"!==this._alertContainer.style.visibility&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let r=t.deltaMode===WheelEvent.DOM_DELTA_LINE?40*t.deltaY:t.deltaY;const n=e.o.now(),i=n-(this._lastWheelEventTime||0);this._lastWheelEventTime=n,0!==r&&r%xl==0?this._type="wheel":0!==r&&Math.abs(r)<4?this._type="trackpad":i>400?(this._type=null,this._lastValue=r,this._timeout=window.setTimeout(this._onTimeout,40,t)):this._type||(this._type=Math.abs(i*r)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,r+=this._lastValue)),t.shiftKey&&r&&(r/=4),this._type&&(this._lastWheelEvent=t,this._delta-=r,this._active||this._start(t)),t.preventDefault()}_onTimeout(e){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(e)}_start(e){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const t=x(this._el,e);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:t,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId)return;if(this._frameId=null,!this.isActive())return;const t=this._map.transform;"wheel"===this._type&&t.projection.wrap&&(t._center.lng>=180||t._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const r=()=>t._terrainEnabled()&&this._aroundCoord?t.computeZoomRelativeTo(this._aroundCoord):t.zoom;if(0!==this._delta){const e="wheel"===this._type&&Math.abs(this._delta)>xl?this._wheelZoomRate:this._defaultZoomRate;let n=2/(1+Math.exp(-Math.abs(this._delta*e)));this._delta<0&&0!==n&&(n=1/n);const i=r(),s=Math.pow(2,i),o="number"==typeof this._targetZoom?t.zoomScale(this._targetZoom):s;this._targetZoom=Math.min(t.maxZoom,Math.max(t.minZoom,t.scaleZoom(o*n))),"wheel"===this._type&&(this._startZoom=i,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const n="number"==typeof this._targetZoom?this._targetZoom:r(),i=this._startZoom,s=this._easing;let o,a=!1;if("wheel"===this._type&&i&&s){const t=Math.min((e.o.now()-this._lastWheelEventTime)/200,1),r=s(t);o=e.ak(i,n,r),t<1?this._frameId||(this._frameId=!0):a=!0}else o=n,a=!0;this._active=!0,a&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let l=o-r();return l*this._lastDelta<0&&(l=0),{noInertia:!0,needsRenderFrame:!a,zoomDelta:l,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(t){let r=e.eV;if(this._prevEase){const t=this._prevEase,n=(e.o.now()-t.start)/t.duration,i=t.easing(n+.01)-t.easing(n),s=.27/Math.sqrt(i*i+1e-4)*.01,o=Math.sqrt(.0729-s*s);r=e.eT(s,o,.25,1)}return this._prevEase={start:e.o.now(),duration:t,easing:r},r}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=d("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize="".concat(Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth))),"px"))}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class jl{constructor(e,t){this._clickZoom=e,this._tapZoom=t}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Sl{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(e,t){return e.preventDefault(),{cameraAnimation:r=>{r.easeTo({duration:300,zoom:r.getZoom()+(e.shiftKey?-1:1),around:r.unproject(t)},{originalEvent:e})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Tl{constructor(){this._tap=new el({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(e,t,r){this._swipePoint||(this._tapTime&&e.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?r.length>0&&(this._swipePoint=t[0],this._swipeTouch=r[0].identifier):this._tap.touchstart(e,t,r))}touchmove(e,t,r){if(this._tapTime){if(this._swipePoint){if(r[0].identifier!==this._swipeTouch)return;const n=t[0],i=n.y-this._swipePoint.y;return this._swipePoint=n,e.preventDefault(),this._active=!0,{zoomDelta:i/128}}}else this._tap.touchmove(e,t,r)}touchend(e,t,r){this._tapTime?this._swipePoint&&0===r.length&&this.reset():this._tap.touchend(e,t,r)&&(this._tapTime=e.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class kl{constructor(e,t,r){this._el=e,this._mousePan=t,this._touchPan=r}enable(e){this._inertiaOptions=e||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class Al{constructor(e,t,r){this._pitchWithRotate=e.pitchWithRotate,this._mouseRotate=t,this._mousePitch=r}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Cl{constructor(e,t,r,n){this._el=e,this._touchZoom=t,this._touchRotate=r,this._tapDragZoom=n,this._rotationDisabled=!1,this._enabled=!0}enable(e){this._touchZoom.enable(e),this._rotationDisabled||this._touchRotate.enable(e),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const El=e=>e.zoom||e.drag||e.pitch||e.rotate;class Nl extends e.z{}class Il{constructor(){this.constants=[1,1,.01],this.radius=0}setup(t,r){const n=e.av([],r,t);this.radius=e.ag(n[2]<0?e.eX([],n,this.constants):[n[0],n[1],0])}projectRay(t){e.eX(t,t,this.constants),e.aw(t,t),e.eY(t,t,this.constants);const r=e.c5([],t,this.radius);if(r[2]>0){const t=e.c5([],[0,0,1],e.bJ(r,[0,0,1])),n=e.c5([],e.aw([],[r[0],r[1],0]),this.radius),i=e.d8([],r,e.c5([],e.av([],e.d8([],n,t),r),2));r[0]=i[0],r[1]=i[1]}return r}}function Pl(e){return e.panDelta&&e.panDelta.mag()||e.zoomDelta||e.bearingDelta||e.pitchDelta}class Ml{constructor(t,r){this._map=t,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new qa(t),this._bearingSnap=r.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Il,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(r),e.aY(["handleEvent","handleWindowEvent"],this);const n=this._el;this._listeners=[[n,"touchstart",{passive:!0}],[n,"touchmove",{passive:!1}],[n,"touchend",void 0],[n,"touchcancel",void 0],[n,"mousedown",void 0],[n,"mousemove",void 0],[n,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[n,"mouseover",void 0],[n,"mouseout",void 0],[n,"dblclick",void 0],[n,"click",void 0],[n,"keydown",{capture:!1}],[n,"keyup",void 0],[n,"wheel",{passive:!1}],[n,"contextmenu",void 0],[window,"blur",void 0]];for(const[e,i,s]of this._listeners){const t=e===document?this.handleWindowEvent:this.handleEvent;e.addEventListener(i,t,s)}}destroy(){for(const[e,t,r]of this._listeners){const n=e===document?this.handleWindowEvent:this.handleEvent;e.removeEventListener(t,n,r)}}_addDefaultHandlers(e){const t=this._map,r=t.getCanvasContainer();this._add("mapEvent",new Ya(t,e));const n=t.boxZoom=new Ja(t,e);this._add("boxZoom",n);const i=new tl,s=new Sl;t.doubleClickZoom=new jl(s,i),this._add("tapZoom",i),this._add("clickZoom",s);const o=new Tl;this._add("tapDragZoom",o);const a=t.touchPitch=new gl(t);this._add("touchPitch",a);const l=new ol(e),c=new al(e);t.dragRotate=new Al(e,l,c),this._add("mouseRotate",l,["mousePitch"]),this._add("mousePitch",c,["mouseRotate"]);const u=new sl(e),d=new ll(t,e);t.dragPan=new kl(r,u,d),this._add("mousePan",u),this._add("touchPan",d,["touchZoom","touchRotate"]);const h=new ml,p=new hl;t.touchZoomRotate=new Cl(r,p,h,o),this._add("touchRotate",h,["touchPan","touchZoom"]),this._add("touchZoom",p,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Xa(t));const m=t.scrollZoom=new wl(t,this);this._add("scrollZoom",m,["mousePan"]);const f=t.keyboard=new _l;this._add("keyboard",f);for(const g of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])e.interactive&&e[g]&&t[g].enable(e[g])}_add(e,t,r){this._handlers.push({handlerName:e,handler:t,allowed:r}),this._handlersById[e]=t}stop(e){if(!this._updatingCamera){for(const{handler:e}of this._handlers)e.reset();this._inertia.clear(),this._fireEvents({},{},e),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:e}of this._handlers)if(e.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!El(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(e,t,r){for(const n in e)if(n!==r&&(!t||t.indexOf(n)<0))return!0;return!1}handleWindowEvent(e){this.handleEvent(e,"".concat(e.type,"Window"))}_getMapTouches(e){const t=[];for(const r of e)this._el.contains(r.target)&&t.push(r);return t}handleEvent(e,t){this._updatingCamera=!0;const r="renderFrame"===e.type,n=r?void 0:e,i={needsRenderFrame:!1},s={},o={},a=e.touches?this._getMapTouches(e.touches):void 0,l=a?b(this._el,a):r?void 0:x(this._el,e);for(const{handlerName:d,handler:h,allowed:p}of this._handlers){if(!h.isEnabled())continue;let r;this._blockedByActive(o,p,d)?h.reset():h[t||e.type]&&(r=h[t||e.type](e,l,a),this.mergeHandlerResult(i,s,r,d,n),r&&r.needsRenderFrame&&this._triggerRenderFrame()),(r||h.isActive())&&(o[d]=h)}const c={};for(const d in this._previousActiveHandlers)o[d]||(c[d]=n);this._previousActiveHandlers=o,(Object.keys(c).length||Pl(i))&&(this._changes.push([i,s,c]),this._triggerRenderFrame()),(Object.keys(o).length||Pl(i))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:u}=i;u&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],u(this._map))}mergeHandlerResult(e,t,r,n,i){if(!r)return;Object.assign(e,r);const s={handlerName:n,originalEvent:r.originalEvent||i};void 0!==r.zoomDelta&&(t.zoom=s),void 0!==r.panDelta&&(t.drag=s),void 0!==r.pitchDelta&&(t.pitch=s),void 0!==r.bearingDelta&&(t.rotate=s)}_applyChanges(){const t={},r={},n={};for(const[i,s,o]of this._changes)i.panDelta&&(t.panDelta=(t.panDelta||new e.P(0,0))._add(i.panDelta)),i.zoomDelta&&(t.zoomDelta=(t.zoomDelta||0)+i.zoomDelta),i.bearingDelta&&(t.bearingDelta=(t.bearingDelta||0)+i.bearingDelta),i.pitchDelta&&(t.pitchDelta=(t.pitchDelta||0)+i.pitchDelta),void 0!==i.around&&(t.around=i.around),void 0!==i.aroundCoord&&(t.aroundCoord=i.aroundCoord),void 0!==i.pinchAround&&(t.pinchAround=i.pinchAround),i.noInertia&&(t.noInertia=i.noInertia),Object.assign(r,s),Object.assign(n,o);this._updateMapTransform(t,r,n),this._changes=[]}_updateMapTransform(t,r,n){const i=this._map,s=i.transform,o=e=>[e.x,e.y,e.z];if((()=>{const e=this._eventsInProgress.drag;return e&&!this._handlersById[e.handlerName].isActive()})()&&!Pl(t)){const e=s.zoom;s.cameraElevationReference="sea",null!=this._originalZoom&&s._orthographicProjectionAtLowPitch&&"globe"!==s.projection.name&&0===s.pitch?(s.cameraElevationReference="ground",s.zoom=this._originalZoom):(s.recenterOnTerrain(),s.cameraElevationReference="ground"),e!==s.zoom&&this._map._update(!0)}if(s._isCameraConstrained&&i._stop(!0),!Pl(t))return void this._fireEvents(r,n,!0);let{panDelta:a,zoomDelta:l,bearingDelta:c,pitchDelta:u,around:d,aroundCoord:h,pinchAround:p}=t;s._isCameraConstrained&&(l>0&&(l=0),s._isCameraConstrained=!1),void 0!==p&&(d=p),(l||(e=>r[e]&&!this._eventsInProgress[e])("drag"))&&d&&(this._dragOrigin=o(s.pointCoordinate3D(d)),this._originalZoom=s.zoom,this._trackingEllipsoid.setup(s._camera.position,this._dragOrigin)),s.cameraElevationReference="sea",i._stop(!0),d=d||i.transform.centerPoint,c&&(s.bearing+=c),u&&(s.pitch+=u),s._updateCameraState();const m=[0,0,0];if(a)if("mercator"===s.projection.name){const e=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(d).dir),t=this._trackingEllipsoid.projectRay(s.screenPointToMercatorRay(d.sub(a)).dir);m[0]=t[0]-e[0],m[1]=t[1]-e[1]}else{const t=s.pointCoordinate(d);if("globe"===s.projection.name){a=a.rotate(-s.angle);const r=s._pixelsPerMercatorPixel/s.worldSize;m[0]=-a.x*e.eW(e.a$(t.y))*r,m[1]=-a.y*e.eW(s.center.lat)*r}else{const e=s.pointCoordinate(d.sub(a));t&&e&&(m[0]=e.x-t.x,m[1]=e.y-t.y)}}const f=s.zoom,g=[0,0,0];if(l){const t=o(h||s.pointCoordinate3D(d)),r={dir:e.aw([],e.av([],t,s._camera.position))};if(r.dir[2]<0){const n=s.zoomDeltaToMovement(t,l);e.c5(g,r.dir,n)}}const y=e.d8(m,m,g);s._translateCameraConstrained(y),l&&Math.abs(s.zoom-f)>1e-4&&s.recenterOnTerrain(),s.cameraElevationReference="ground",this._map._update(),t.noInertia||this._inertia.record(t),this._fireEvents(r,n,!0)}_fireEvents(t,r,n){const i=El(this._eventsInProgress),s=El(t),o={};for(const e in t){const{originalEvent:r}=t[e];this._eventsInProgress[e]||(o["".concat(e,"start")]=r),this._eventsInProgress[e]=t[e]}!i&&s&&this._fireEvent("movestart",s.originalEvent);for(const e in o)this._fireEvent(e,o[e]);s&&this._fireEvent("move",s.originalEvent);for(const e in t){const{originalEvent:r}=t[e];this._fireEvent(e,r)}const a={};let l;for(const e in this._eventsInProgress){const{handlerName:t,originalEvent:n}=this._eventsInProgress[e];this._handlersById[t].isActive()||(delete this._eventsInProgress[e],l=r[t]||n,a["".concat(e,"end")]=l)}for(const e in a)this._fireEvent(e,a[e]);const c=El(this._eventsInProgress);if(n&&(i||s)&&!c){this._updatingCamera=!0;const t=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),r=e=>0!==e&&-this._bearingSnap<e&&e<this._bearingSnap;t?(r(t.bearing||this._map.getBearing())&&(t.bearing=0),this._map.easeTo(t,{originalEvent:l})):(this._map.fire(new e.z("moveend",{originalEvent:l})),r(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(t,r){this._map.fire(new e.z(t,r?{originalEvent:r}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(e=>{this._frameId=void 0,this.handleEvent(new Nl("renderFrame",{timeStamp:e})),this._applyChanges()})}_triggerRenderFrame(){void 0===this._frameId&&(this._frameId=this._requestFrame())}}const Ll="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class Rl extends e.E{constructor(t,r){super(),this._moving=!1,this._zooming=!1,this.transform=t,this._bearingSnap=r.bearingSnap,this._respectPrefersReducedMotion=!1!==r.respectPrefersReducedMotion,e.aY(["_renderFrameCallback"],this)}getCenter(){return new e.aT(this.transform.center.lng,this.transform.center.lat)}setCenter(e,t){return this.jumpTo({center:e},t)}panBy(t,r,n){return t=e.P.convert(t).mult(-1),this.panTo(this.transform.center,Object.assign({offset:t},r),n)}panTo(e,t,r){return this.easeTo(Object.assign({center:e},t),r)}getZoom(){return this.transform.zoom}setZoom(e,t){return this.jumpTo({zoom:e},t),this}zoomTo(e,t,r){return this.easeTo(Object.assign({zoom:e},t),r)}zoomIn(e,t){return this.zoomTo(this.getZoom()+1,e,t),this}zoomOut(e,t){return this.zoomTo(this.getZoom()-1,e,t),this}getBearing(){return this.transform.bearing}setBearing(e,t){return this.jumpTo({bearing:e},t),this}getPadding(){return this.transform.padding}setPadding(e,t){return this.jumpTo({padding:e},t),this}rotateTo(e,t,r){return this.easeTo(Object.assign({bearing:e},t),r)}resetNorth(e,t){return this.rotateTo(0,Object.assign({duration:1e3},e),t),this}resetNorthPitch(e,t){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},e),t),this}snapToNorth(e,t){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(e,t):this}getPitch(){return this.transform.pitch}setPitch(e,t){return this.jumpTo({pitch:e},t),this}cameraForBounds(t,r){t=e.aI.convert(t);const n=r&&r.bearing||0,i=r&&r.pitch||0,s=t.getNorthWest(),o=t.getSouthEast();return this._cameraForBounds(this.transform,s,o,n,i,r)}_extendPadding(e){const t={top:0,right:0,bottom:0,left:0};return null==e?Object.assign({},t,this.transform.padding):"number"==typeof e?{top:e,bottom:e,right:e,left:e}:Object.assign({},t,e)}_extendCameraOptions(e){return(e=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},e)).padding=this._extendPadding(e.padding),e}_minimumAABBFrustumDistance(e,t){const r=t.max[0]-t.min[0],n=t.max[1]-t.min[1];return r/n>e.aspect?r/(2*Math.tan(.5*e.fovX)*e.aspect):n/(2*Math.tan(.5*e.fovY)*e.aspect)}_cameraForBoundsOnGlobe(t,r,n,i,s,o){const a=t.clone(),l=this._extendCameraOptions(o);a.bearing=i,a.pitch=s;const c=e.aT.convert(r),u=e.aT.convert(n),d=.5*(c.lat+u.lat),h=.5*(c.lng+u.lng),p=e.eZ(d,h),m=e.aw([],p),f=e.aw([],e.bI([],m,[0,1,0])),g=e.bI([],f,m),y=[f[0],f[1],f[2],0,g[0],g[1],g[2],0,m[0],m[1],m[2],0,0,0,0,1],_=[p,e.eZ(c.lat,c.lng),e.eZ(u.lat,c.lng),e.eZ(u.lat,u.lng),e.eZ(c.lat,u.lng),e.eZ(d,c.lng),e.eZ(d,u.lng),e.eZ(c.lat,h),e.eZ(u.lat,h)];let v=e.d9.fromPoints(_.map(t=>[e.bJ(f,t),e.bJ(g,t),e.bJ(m,t)]));const x=e.af([],v.center,y);0===e.e_(x)&&e.e$(x,0,0,1),e.aw(x,x),e.c5(x,x,e.aD),a.center=e.f0(x);const b=a.getWorldToCameraMatrix(),w=e.bl(new Float64Array(16),b);v=e.d9.applyTransform(v,e.aB([],b,y));const j=this._extendAABB(v,a,l,i);if(!j)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");v=j,e.af(x,x,b);const S=.5*(v.max[2]-v.min[2]),T=this._minimumAABBFrustumDistance(a,v),k=e.c5([],[0,0,1],S),A=e.d8(k,x,k),C=T+(0===a.pitch?0:e.bG(x,A)),E=a.globeCenterInViewSpace,N=e.av([],x,[E[0],E[1],E[2]]);e.aw(N,N),e.c5(N,N,C);const I=e.d8([],x,N);e.af(I,I,w);const P=e.eM/e.aD,M=e.ag(I),L=e.cf(Math.max(M*P-e.eM,Number.EPSILON),0),R=Math.min(a.zoomFromMercatorZAdjusted(L),l.maxZoom);return R>.5*(e.c_+e.cL)?(a.setProjection({name:"mercator"}),a.zoom=R,this._cameraForBounds(a,r,n,i,s,o)):{center:a.center,zoom:R,bearing:i,pitch:s}}_extendAABB(t,r,n,i){const s=.5*((n.padding.left||0)+(n.padding.right||0)),o=.5*((n.padding.top||0)+(n.padding.bottom||0)),a=o,l=s,c=s,u=o,d=r.width-(l+c),h=r.height-(a+u),p=e.av([],t.max,t.min),m=Math.min(d/p[0],h/p[1]),f=Math.min(r.scaleZoom(r.scale*m),n.maxZoom);if(isNaN(f))return null;const g=r.scale/r.zoomScale(f),y=new e.d9([t.min[0]-l*g,t.min[1]-u*g,t.min[2]],[t.max[0]+c*g,t.max[1]+a*g,t.max[2]]),_=("number"==typeof n.offset.x&&"number"==typeof n.offset.y?new e.P(n.offset.x,n.offset.y):e.P.convert(n.offset)).rotate(-e.an(i));return y.center[0]-=_.x*g,y.center[1]+=_.y*g,y}queryTerrainElevation(t,r){const n=this.transform.elevation;return n?(r=Object.assign({},{exaggerated:!0},r),n.getAtPoint(e.ae.fromLngLat(t),null,r.exaggerated)):null}_cameraForBounds(t,r,n,i,s,o){if("globe"===t.projection.name)return this._cameraForBoundsOnGlobe(t,r,n,i,s,o);const a=t.clone(),l=this._extendCameraOptions(o);a.bearing=i,a.pitch=s;const c=e.aT.convert(r),u=e.aT.convert(n),d=new e.aT(c.lng,u.lat),h=new e.aT(u.lng,c.lat),p=a.project(c),m=a.project(u),f=this.queryTerrainElevation(c),g=this.queryTerrainElevation(u),y=this.queryTerrainElevation(d),_=this.queryTerrainElevation(h),v=[[p.x,p.y,Math.min(f||0,g||0,y||0,_||0)],[m.x,m.y,Math.max(f||0,g||0,y||0,_||0)]];let x=e.d9.fromPoints(v);const b=a.getWorldToCameraMatrix(),w=e.bl(new Float64Array(16),b);x=e.d9.applyTransform(x,b);const j=this._extendAABB(x,a,l,i);if(!j)return void e.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");x=j;const S=.5*e.av([],x.max,x.min)[2],T=this._minimumAABBFrustumDistance(a,x),k=[0,0,1,0];e.aC(k,k,b),e.f1(k,k);const A=e.c5([],k,T+S),C=e.d8([],x.center,A);e.af(x.center,x.center,w),e.af(C,C,w);const E=a.unproject(new e.P(x.center[0],x.center[1])),N=e.f2(a.projection,E),I=Math.pow(2,N),P=Math.min(a._zoomFromMercatorZ(C[2]*a.pixelsPerMeter*I/a.worldSize),l.maxZoom);return a.mercatorFromTransition&&P<.5*(e.c_+e.cL)?(a.setProjection({name:"globe"}),a.zoom=P,this._cameraForBounds(a,r,n,i,s,o)):{center:E,zoom:P,bearing:i,pitch:s}}fitBounds(e,t,r){const n=this.cameraForBounds(e,t);return this._fitInternal(n,t,r)}fitScreenCoordinates(t,r,n,i,s){const o=e.P.convert(t),a=e.P.convert(r),l=new e.P(Math.min(o.x,a.x),Math.min(o.y,a.y)),c=new e.P(Math.max(o.x,a.x),Math.max(o.y,a.y));if("mercator"===this.transform.projection.name&&this.transform.anyCornerOffEdge(o,a))return this;const u=this.transform.pointLocation3D(l),d=this.transform.pointLocation3D(c),h=this.transform.pointLocation3D(new e.P(l.x,c.y)),p=this.transform.pointLocation3D(new e.P(c.x,l.y)),m=[Math.min(u.lng,d.lng,h.lng,p.lng),Math.min(u.lat,d.lat,h.lat,p.lat)],f=[Math.max(u.lng,d.lng,h.lng,p.lng),Math.max(u.lat,d.lat,h.lat,p.lat)],g=i&&i.pitch?i.pitch:this.getPitch(),y=this._cameraForBounds(this.transform,m,f,n,g,i);return this._fitInternal(y,i,s)}_fitInternal(e,t,r){return e?(t=Object.assign(e,t)).linear?this.easeTo(t,r):this.flyTo(t,r):this}jumpTo(t,r){this.stop();const n=t.preloadOnly?this.transform.clone():this.transform;let i=!1,s=!1,o=!1;"zoom"in t&&n.zoom!==+t.zoom&&(i=!0,n.zoom=+t.zoom),void 0!==t.center&&(n.center=e.aT.convert(t.center)),"bearing"in t&&n.bearing!==+t.bearing&&(s=!0,n.bearing=+t.bearing),"pitch"in t&&n.pitch!==+t.pitch&&(o=!0,n.pitch=+t.pitch);const a="number"==typeof t.padding?this._extendPadding(t.padding):t.padding;if(null!=t.padding&&!n.isPaddingEqual(a))if(!1===t.retainPadding){const e=n.clone();e.padding=a,n.setLocationAtPoint(n.center,e.centerPoint)}else n.padding=a;return t.preloadOnly?(this._preloadTiles(n),this):(this.fire(new e.z("movestart",r)).fire(new e.z("move",r)),i&&this.fire(new e.z("zoomstart",r)).fire(new e.z("zoom",r)).fire(new e.z("zoomend",r)),s&&this.fire(new e.z("rotatestart",r)).fire(new e.z("rotate",r)).fire(new e.z("rotateend",r)),o&&this.fire(new e.z("pitchstart",r)).fire(new e.z("pitch",r)).fire(new e.z("pitchend",r)),this.fire(new e.z("moveend",r)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||e.w(Ll),this.transform.getFreeCameraOptions()}setFreeCameraOptions(t,r){const n=this.transform;if(!n.projection.supportsFreeCamera)return e.w(Ll),this;this.stop();const i=n.zoom,s=n.pitch,o=n.bearing;n.setFreeCameraOptions(t);const a=i!==n.zoom,l=s!==n.pitch,c=o!==n.bearing;return this.fire(new e.z("movestart",r)).fire(new e.z("move",r)),a&&this.fire(new e.z("zoomstart",r)).fire(new e.z("zoom",r)).fire(new e.z("zoomend",r)),c&&this.fire(new e.z("rotatestart",r)).fire(new e.z("rotate",r)).fire(new e.z("rotateend",r)),l&&this.fire(new e.z("pitchstart",r)).fire(new e.z("pitch",r)).fire(new e.z("pitchend",r)),this.fire(new e.z("moveend",r)),this}easeTo(t,r){this._stop(!1,t.easeId),(!1===(t=Object.assign({offset:[0,0],duration:500,easing:e.eV},t)).animate||this._prefersReducedMotion(t))&&(t.duration=0);const n=this.transform,i=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in t?+t.zoom:i,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,u="pitch"in t?+t.pitch:o,d=this._extendPadding(t.padding),h=e.P.convert(t.offset);let p,m,f;if("globe"===n.projection.name){const r=e.ae.fromLngLat(n.center),i=h.rotate(-n.angle);r.x+=i.x/n.worldSize,r.y+=i.y/n.worldSize;const s=r.toLngLat(),o=e.aT.convert(t.center||s);this._normalizeCenter(o),p=n.centerPoint.add(i),m=new e.P(r.x,r.y).mult(n.worldSize),f=new e.P(e.aF(o.lng),e.aJ(o.lat)).mult(n.worldSize).sub(m)}else{p=n.centerPoint.add(h);const r=n.pointLocation(p),i=e.aT.convert(t.center||r);this._normalizeCenter(i),m=n.project(r),f=n.project(i).sub(m)}const g=n.zoomScale(l-i);let y,_;t.around&&(y=e.aT.convert(t.around),_=n.locationPoint(y));const v=this._zooming||l!==i,x=this._rotating||s!==c,b=this._pitching||u!==o,w=!n.isPaddingEqual(d),j=!1===t.retainPadding?n.clone():n,S=n=>S=>{if(v&&(n.zoom=e.ak(i,l,S)),x&&(n.bearing=e.ak(s,c,S)),b&&(n.pitch=e.ak(o,u,S)),w&&(j.interpolatePadding(a,d,S),p=j.centerPoint.add(h)),y)n.setLocationAtPoint(y,_);else{const e=n.zoomScale(n.zoom-i),t=l>i?Math.min(2,g):Math.max(.5,g),r=Math.pow(t,1-S),s=n.unproject(m.add(f.mult(S*r)).mult(e));n.setLocationAtPoint(n.renderWorldCopies?s.wrap():s,p)}return t.preloadOnly||this._fireMoveEvents(r),n};if(t.preloadOnly){const e=this._emulate(S,t.duration,n);return this._preloadTiles(e),this}const T={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=v,this._rotating=x,this._pitching=b,this._padding=w,this._easeId=t.easeId,this._prepareEase(r,t.noMoveStart,T),this._ease(S(n),e=>{"sea"===n.cameraElevationReference&&n.recenterOnTerrain(),this._afterEase(r,e)},t),this}_prepareEase(t,r){let n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&0===this.transform.pitch&&"globe"!==this.transform.projection.name&&(this.transform.cameraElevationReference="ground"),r||n.moving||this.fire(new e.z("movestart",t)),this._zooming&&!n.zooming&&this.fire(new e.z("zoomstart",t)),this._rotating&&!n.rotating&&this.fire(new e.z("rotatestart",t)),this._pitching&&!n.pitching&&this.fire(new e.z("pitchstart",t))}_fireMoveEvents(t){this.fire(new e.z("move",t)),this._zooming&&this.fire(new e.z("zoom",t)),this._rotating&&this.fire(new e.z("rotate",t)),this._pitching&&this.fire(new e.z("pitch",t))}_afterEase(t,r){if(this._easeId&&r&&this._easeId===r)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const n=this._zooming,i=this._rotating,s=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,n&&this.fire(new e.z("zoomend",t)),i&&this.fire(new e.z("rotateend",t)),s&&this.fire(new e.z("pitchend",t)),this.fire(new e.z("moveend",t))}flyTo(t,r){if(this._prefersReducedMotion(t)){const n=e.aH(t,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(n,r)}this.stop(),t=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:e.eV},t);const n=this.transform,i=this.getZoom(),s=this.getBearing(),o=this.getPitch(),a=this.getPadding(),l="zoom"in t?e.aA(+t.zoom,n.minZoom,n.maxZoom):i,c="bearing"in t?this._normalizeBearing(t.bearing,s):s,u="pitch"in t?+t.pitch:o,d=this._extendPadding(t.padding),h=n.zoomScale(l-i),p=e.P.convert(t.offset);let m=n.centerPoint.add(p);const f=n.pointLocation(m),g=e.aT.convert(t.center||f);this._normalizeCenter(g);const y=n.project(f),_=n.project(g).sub(y);let v=t.curve;const x=Math.max(n.width,n.height),b=x/h,w=_.mag();if("minZoom"in t){const r=e.aA(Math.min(t.minZoom,i,l),n.minZoom,n.maxZoom),s=x/n.zoomScale(r-i);v=Math.sqrt(s/w*2)}const j=v*v;function S(e){const t=(b*b-x*x+(e?-1:1)*j*j*w*w)/(2*(e?b:x)*j*w);return Math.log(Math.sqrt(t*t+1)-t)}function T(e){return(Math.exp(e)-Math.exp(-e))/2}function k(e){return(Math.exp(e)+Math.exp(-e))/2}const A=S(0);let C=function(e){return k(A)/k(A+v*e)},E=function(e){return x*((k(A)*(T(t=A+v*e)/k(t))-T(A))/j)/w;var t},N=(S(1)-A)/v;if(Math.abs(w)<1e-6||!isFinite(N)){if(Math.abs(x-b)<1e-6)return this.easeTo(t,r);const e=b<x?-1:1;N=Math.abs(Math.log(b/x))/v,E=function(){return 0},C=function(t){return Math.exp(e*v*t)}}t.duration="duration"in t?+t.duration:1e3*N/("screenSpeed"in t?+t.screenSpeed/v:+t.speed),t.maxDuration&&t.duration>t.maxDuration&&(t.duration=0);const I=s!==c,P=u!==o,M=!n.isPaddingEqual(d),L=!1===t.retainPadding?n.clone():n,R=n=>h=>{const f=h*N,v=1/C(f);n.zoom=1===h?l:i+n.scaleZoom(v),I&&(n.bearing=e.ak(s,c,h)),P&&(n.pitch=e.ak(o,u,h)),M&&(L.interpolatePadding(a,d,h),m=L.centerPoint.add(p));const x=1===h?g:n.unproject(y.add(_.mult(E(f))).mult(v));return n.setLocationAtPoint(n.renderWorldCopies?x.wrap():x,m),n._updateCameraOnTerrain(),t.preloadOnly||this._fireMoveEvents(r),n};if(t.preloadOnly){const e=this._emulate(R,t.duration,n);return this._preloadTiles(e),this}return this._zooming=!0,this._rotating=I,this._pitching=P,this._padding=M,this._prepareEase(r,!1),this._ease(R(n),()=>this._afterEase(r),t),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(e){}_cancelRenderFrame(e){}_stop(e,t){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const e=this._onEaseEnd;this._onEaseEnd=void 0,e.call(this,t)}if(!e){const e=this.handlers;e&&e.stop(!1)}return this}_ease(t,r,n){!1===n.animate||0===n.duration?(t(1),r()):(this._easeStart=e.o.now(),this._easeOptions=n,this._onEaseFrame=t,this._onEaseEnd=r,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const t=Math.min((e.o.now()-this._easeStart)/this._easeOptions.duration,1),r=this._onEaseFrame;r&&r(this._easeOptions.easing(t)),t<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(t,r){t=e.bT(t,-180,180);const n=Math.abs(t-r);return Math.abs(t-360-r)<n&&(t-=360),Math.abs(t+360-r)<n&&(t+=360),t}_normalizeCenter(e){const t=this.transform;if(t.maxBounds)return;if("globe"!==t.projection.name&&!t.renderWorldCopies)return;const r=e.lng-t.center.lng;e.lng+=r>180?-360:r<-180?360:0}_prefersReducedMotion(t){return this._respectPrefersReducedMotion&&e.o.prefersReducedMotion&&!(t&&t.essential)}_emulate(e,t,r){const n=Math.ceil(15*t/1e3),i=[],s=e(r.clone());for(let o=0;o<=n;o++){const e=s(o/n);i.push(e.clone())}return i}_preloadTiles(e,t){}}class Dl{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=t,e.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(e){const t=this.options&&this.options.compact,r=e._getUIString("AttributionControl.ToggleAttribution");this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=d("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",r);const n=d("span","mapboxgl-ctrl-icon",this._compactButton);return n.setAttribute("aria-hidden","true"),n.setAttribute("title",r),this._innerContainer=d("div","mapboxgl-ctrl-attrib-inner",this._container),t&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),void 0===t&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let t=this._editLink;t||(t=this._editLink=this._container.querySelector(".mapbox-improve-map"));const r=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||e.e.ACCESS_TOKEN}];if(t){const n=r.reduce((e,t,n)=>(t.value&&(e+="".concat(t.key,"=").concat(t.value).concat(n<r.length-1?"&":"")),e),"?");t.href="".concat(e.e.FEEDBACK_URL,"/").concat(n,"#").concat(Fa(this._map,!0)),t.rel="noopener nofollow"}}_updateData(e){!e||("source"!==e.dataType||"metadata"!==e.sourceDataType&&"visibility"!==e.sourceDataType)&&"style"!==e.dataType||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let e=[];if(this._map.style.stylesheet){const e=this._map.style.stylesheet;this.styleOwner=e.owner,this.styleId=e.id}const t=this._map.style._mergedSourceCaches;for(const n in t){const r=t[n];if(r.used){const t=r.getSource();t.attribution&&e.indexOf(t.attribution)<0&&e.push(t.attribution)}}e.sort((e,t)=>e.length-t.length),e=e.filter((t,r)=>{for(let n=r+1;n<e.length;n++)if(e[n].indexOf(t)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?e=[...this.options.customAttribution,...e]:e.unshift(this.options.customAttribution));const r=e.map(e=>function(e){const t=(new DOMParser).parseFromString(e,"text/html");return Array.from(t.body.querySelectorAll("*")).forEach(e=>{const r=e.textContent||"";if("A"!==e.tagName)return void e.replaceWith(t.createTextNode(r));const n=e.getAttribute("href");if(!n||!/^(https?:|mailto:)/i.test(n))return void e.replaceWith(t.createTextNode(r));const i=t.createElement("a");i.href=n,i.textContent=r,i.rel="noopener nofollow";const s=e.getAttribute("class");s&&(i.className=s),e.replaceWith(i)}),t.body.innerHTML}(e)).join(" | ");r!==this._attribHTML&&(this._attribHTML=r,e.length?(this._innerContainer.innerHTML=r,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Fl{constructor(){e.aY(["_updateLogo","_updateCompact"],this)}onAdd(e){this._map=e,this._container=d("div","mapboxgl-ctrl");const t=d("a","mapboxgl-ctrl-logo");return t.target="_blank",t.rel="noopener nofollow",t.href="https://www.mapbox.com/",t.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),t.setAttribute("rel","noopener nofollow"),this._container.appendChild(t),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(e){e&&"metadata"!==e.sourceDataType||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const e=this._map.style._sourceCaches;if(0===Object.entries(e).length)return!0;for(const t in e){const r=e[t].getSource();if(r.hasOwnProperty("mapbox_logo")&&!r.mapbox_logo)return!1}return!0}_updateCompact(){const e=this._container.children;if(e.length){const t=e[0];this._map.getCanvasContainer().offsetWidth<250?t.classList.add("mapboxgl-compact"):t.classList.remove("mapboxgl-compact")}}}class Ol{constructor(){e.aY(["_onIndoorUpdate"],this)}onAdd(e){return this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("selector-update",e=>this._onIndoorUpdate(e)),this._container}_createButton(e,t){const r=d("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_createSeparator(){return d("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(e,t){this._map&&(e.setAttribute("aria-label",t),e.textContent=t)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("selector-update",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(e){if(!e||!e.floors)return this._model=e,void(this._container.style.display="none");const t=this._model;this._model=e,this._container.style.display="inline-block",this._container.style.borderRadius="8px",t&&Array.from(this._container.children).forEach(e=>e.remove()),e.floors.length>0&&(this.addBuildingsToggleButton(),this.addCurrentFloors(e.floors,e.activeFloorsVisible),this._updateBuildingsButtonState())}addBuildingsToggleButton(){const e=this._createButton("mapboxgl-ctrl-buildings-toggle",()=>{const e=this._map;this._model&&e&&e._setIndoorActiveFloorsVisibility(!this._model.activeFloorsVisible)});d("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.classList.add("mapboxgl-ctrl-level-button","mapboxgl-ctrl-buildings-toggle"),this._model&&!this._model.activeFloorsVisible&&e.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(e),this._createSeparator()}_updateBuildingsButtonState(){const e=this._container.querySelector(".mapboxgl-ctrl-buildings-toggle");e&&this._model&&(this._model.activeFloorsVisible?e.classList.remove("mapboxgl-ctrl-level-button-selected"):e.classList.add("mapboxgl-ctrl-level-button-selected"))}addCurrentFloors(e,t){for(let r=0;r<e.length;r++){const n=e[r],i=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(n.id)});this._setButtonTitle(i,n.zIndex.toString()),this._model&&n.id===this._model.selectedFloorId&&t&&i.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(i),r<e.length-1&&this._createSeparator()}}}class zl{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(e){const t=++this._id;return this._queue.push({callback:e,id:t,cancelled:!1}),t}remove(e){const t=this._currentlyRunning,r=t?this._queue.concat(t):this._queue;for(const n of r)if(n.id===e)return void(n.cancelled=!0)}run(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=this._currentlyRunning=this._queue;this._queue=[];for(const r of t)if(!r.cancelled&&(r.callback(e),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Bl{constructor(e){this.jumpTo(e)}getValue(t){if(t<=this._startTime)return this._start;if(t>=this._endTime)return this._end;const r=e.dD((t-this._startTime)/(this._endTime-this._startTime));return this._start*(1-r)+this._end*r}isEasing(e){return e>=this._startTime&&e<=this._endTime}jumpTo(e){this._startTime=-1/0,this._endTime=-1/0,this._start=e,this._end=e}easeTo(e,t,r){this._start=this.getValue(t),this._end=e,this._startTime=t,this._endTime=t+r}}const Ul={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use \u2318 + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class Vl extends e.z{constructor(e,t,r,n){const{point:i,lngLat:s,originalEvent:o,target:a}=e;super(e.type,{point:i,lngLat:s,originalEvent:o,target:a}),this.preventDefault=()=>{e.preventDefault()},this.id=t,this.interaction=r,this.feature=n}}class ql{constructor(e){this.map=e,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(t,r){if(this.typeById.has(t))throw new Error('Interaction id "'.concat(t,'" already exists.'));const n=r.filter;let i=r.type;n&&this.filters.set(t,e.b6(n)),"mouseover"===i&&(i="mouseenter"),"mouseout"===i&&(i="mouseleave");const s=this.interactionsByType.get(i)||new Map;"mouseenter"===i||"mouseleave"===i?(0===this.delegatedInteractions.size&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(t,r)):0===s.size&&this.map.on(i,this.handleType),0===s.size&&this.interactionsByType.set(i,s),s.set(t,r),this.typeById.set(t,i)}get(e){const t=this.typeById.get(e);if(!t)return;const r=this.interactionsByType.get(t);return r?r.get(e):void 0}remove(e){const t=this.typeById.get(e);if(!t)return;this.typeById.delete(e),this.filters.delete(e);const r=this.interactionsByType.get(t);r&&(r.delete(e),"mouseenter"===t||"mouseleave"===t?(this.delegatedInteractions.delete(e),0===this.delegatedInteractions.size&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):0===r.size&&this.map.off(t,this.handleType))}queryTargets(e,t){const r=[];for(const[n,i]of t)i.target&&r.push({targetId:n,target:i.target,filter:this.filters.get(n)});return this.map.style.queryRenderedTargets(e,r,this.map.transform)}handleMove(e){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const t=this.queryTargets(e.point,Array.from(this.delegatedInteractions).reverse());t.length&&(e.type="mouseenter",this.handleType(e,t));const r=new Map;for(const[n,{feature:i}]of this.prevHoveredFeatures)this.hoveredFeatures.has(n)||r.set(i.id,i);r.size&&(e.type="mouseleave",this.handleType(e,Array.from(r.values())))}handleOut(e){const t=Array.from(this.hoveredFeatures.values()).map(e=>{let{feature:t}=e;return t});t.length&&(e.type="mouseleave",this.handleType(e,t)),this.hoveredFeatures.clear()}handleType(t,r){const n="mouseenter"===t.type;if(n&&!this.interactionsByType.has(t.type))return void e.w("mouseenter interaction required for mouseleave to work.");const i=Array.from(this.interactionsByType.get(t.type)).reverse(),s=!!r;r=r||this.queryTargets(t.point,i);let o=!1;const a=new Set;for(const l of r){for(const[r,c]of i){if(!c.target)continue;const i=l.variants?l.variants[r]:null;if(i){for(const u of i){if(bt(u,l,a,r))continue;const i=new e.dx(l,u),d=xt(u,l,r);s&&void 0!==i.id&&(i.state=this.map.getFeatureState(i));const h=n?this.prevHoveredFeatures.get(d):null,p=new Vl(t,r,c,i),m=h?h.stop:c.handler(p);if(n&&this.hoveredFeatures.set(d,{feature:l,stop:m}),!1!==m){o=!0;break}}if(o)break}}if(o)break}if(!o)for(const[e,l]of i){const{handler:r,target:n}=l;if(!n&&!1!==r(new Vl(t,e,l,null)))break}}}function Wl(t,r){if(Array.isArray(t)&&Array.isArray(r)){const e=new Set(t),n=new Set(r);return e.size===n.size&&t.every(e=>n.has(e))}return e.by(t,r)}const Hl={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Gl={showCompass:!0,showZoom:!0,visualizePitch:!1};class Zl{constructor(t,r){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];this._clickTolerance=10,this.element=r,this.mouseRotate=new ol({clickTolerance:t.dragRotate._mouseRotate._clickTolerance}),this.map=t,n&&(this.mousePitch=new al({clickTolerance:t.dragRotate._mousePitch._clickTolerance})),e.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),r.addEventListener("mousedown",this.mousedown),r.addEventListener("touchstart",this.touchstart,{passive:!1}),r.addEventListener("touchmove",this.touchmove),r.addEventListener("touchend",this.touchend),r.addEventListener("touchcancel",this.reset)}down(e,t){this.mouseRotate.mousedown(e,t),this.mousePitch&&this.mousePitch.mousedown(e,t),g()}move(e,t){const r=this.map,n=this.mouseRotate.mousemoveWindow(e,t),i=n&&n.bearingDelta;if(i&&r.setBearing(r.getBearing()+i),this.mousePitch){const n=this.mousePitch.mousemoveWindow(e,t),i=n&&n.pitchDelta;i&&r.setPitch(r.getPitch()+i)}}off(){const e=this.element;e.removeEventListener("mousedown",this.mousedown),e.removeEventListener("touchstart",this.touchstart),e.removeEventListener("touchmove",this.touchmove),e.removeEventListener("touchend",this.touchend),e.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){y(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(e){this.down(Object.assign({},e,{ctrlKey:!0,preventDefault:()=>e.preventDefault()}),x(this.element,e)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(e){this.move(e,x(this.element,e))}mouseup(e){this.mouseRotate.mouseupWindow(e),this.mousePitch&&this.mousePitch.mouseupWindow(e),this.offTemp()}touchstart(e){1!==e.targetTouches.length?this.reset():(this._startPos=this._lastPos=b(this.element,e.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>e.preventDefault()},this._startPos))}touchmove(e){1!==e.targetTouches.length?this.reset():(this._lastPos=b(this.element,e.targetTouches)[0],this.move({preventDefault:()=>e.preventDefault()},this._lastPos))}touchend(e){0===e.targetTouches.length&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Kl(t,r,n){if(t=new e.aT(t.lng,t.lat),r){const i=new e.aT(t.lng-360,t.lat),s=new e.aT(t.lng+360,t.lat),o=360*Math.ceil(Math.abs(t.lng-n.center.lng)/360),a=n.locationPoint3D(t).distSqr(r),l=r.x<0||r.y<0||r.x>n.width||r.y>n.height;n.locationPoint3D(i).distSqr(r)<a&&(l||Math.abs(i.lng-n.center.lng)<o)?t=i:n.locationPoint3D(s).distSqr(r)<a&&(l||Math.abs(s.lng-n.center.lng)<o)&&(t=s)}for(;Math.abs(t.lng-n.center.lng)>180;){const e=n.locationPoint3D(t);if(e.x>=0&&e.y>=0&&e.x<=n.width&&e.y<=n.height)break;t.lng>n.center.lng?t.lng-=360:t.lng+=360}return t}const Yl={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Xl={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class Jl extends e.E{constructor(t,r){super(),(t instanceof HTMLElement||r)&&(t=Object.assign({element:t},r)),e.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:n="center",color:i="#3FB1CE",scale:s=1,draggable:o=!1,clickTolerance:a=0,rotation:l=Xl.rotation,rotationAlignment:c=Xl.rotationAlignment,pitchAlignment:u=Xl.pitchAlignment,occludedOpacity:d=Xl.occludedOpacity,altitude:h=Xl.altitude}=t||{};this._anchor=n,this._color=i,this._scale=s,this._draggable=o,this._clickTolerance=a,this._rotation=l,this._rotationAlignment=c,this._pitchAlignment=u,this._occludedOpacity=d,this._altitude=h,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),t&&t.element?(this._element=t.element,this._offset=e.P.convert(t&&t.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=e.P.convert(t&&t.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",e=>{e.preventDefault()}),this._element.addEventListener("mousedown",e=>{e.preventDefault()});const p=this._element.classList;for(const e in Yl)p.remove("mapboxgl-marker-anchor-".concat(e));p.add("mapboxgl-marker-anchor-".concat(this._anchor));const m=t&&t.className?t.className.trim().split(/\s+/):[];p.add(...m),this._popup=null}_createDefaultMarker(){const e=d("div"),t=h("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},e);if(0===this._altitude){const e=h("radialGradient",{id:"shadowGradient"},h("defs",{},t));h("stop",{offset:"10%","stop-opacity":.4},e),h("stop",{offset:"100%","stop-opacity":.05},e),h("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},t)}return h("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},t),h("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},t),h("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},t),e}addTo(e){return e===this._map||(this.remove(),this._map=e,e.getCanvasContainer().appendChild(this._element),e.on("move",this._updateMoving),e.on("moveend",this._update),e.on("remove",this._clearFadeTimer),e._addMarker(this),this.setDraggable(this._draggable),this._update(),e.on("click",this._onMapClick)),this}remove(){const e=this._map;return e&&(e.off("click",this._onMapClick),e.off("move",this._updateMoving),e.off("moveend",this._update),e.off("mousedown",this._addDragHandler),e.off("touchstart",this._addDragHandler),e.off("mouseup",this._onUp),e.off("touchend",this._onUp),e.off("mousemove",this._onMove),e.off("touchmove",this._onMove),e.off("remove",this._clearFadeTimer),e._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(t){return this._lngLat=e.aT.convert(t),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(e){return e===this._altitude||(this._defaultMarker&&(0===this._altitude&&0!==e||0!==this._altitude&&0===e)&&(this._element=this._createDefaultMarker()),this._altitude=e||Xl.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(e){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),e){if(!("offset"in e.options)){const t=38.1,r=13.5,n=Math.sqrt(Math.pow(r,2)/2);e.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-t],"bottom-left":[n,-1*(t-r+n)],"bottom-right":[-n,-1*(t-r+n)],left:[r,-1*(t-r)],right:[-r,-1*(t-r)]}:this._offset}this._popup=e,e._marker=this,e._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(e){const t=e.code,r=e.charCode||e.keyCode;"Space"!==t&&"Enter"!==t&&32!==r&&13!==r||this.togglePopup()}_onMapClick(e){const t=e.originalEvent.target,r=this._element;this._popup&&(t===r||r.contains(t))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const e=this._popup;return e?(e.isOpen()?(e.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(e.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const e=this._map,t=this._pos;if(!e||!t)return!1;const r=e.unproject(t,this._altitude),n=e.getFreeCameraOptions();if(!n.position)return!1;const i=n.position.toLngLat();return i.distanceTo(r)<.9*i.distanceTo(this._lngLat)}_evaluateOpacity(){const t=this._map;if(!t)return;const r=this._pos;if(!r||r.x<0||r.x>t.transform.width||r.y<0||r.y>t.transform.height)return void this._clearFadeTimer();const n=t.unproject(r,this._altitude);let i;t._showingGlobe()&&e.f5(t.transform,this._lngLat)?i=0:(i=1-t._queryFogOpacity(n),t.transform._terrainEnabled()&&t.getTerrain()&&this._behindTerrain()&&(i*=this._occludedOpacity)),this._element.style.opacity="".concat(i),this._element.style.pointerEvents=i>0?"auto":"none",this._popup&&this._popup._setOpacity(i),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const e=this._pos;if(!e||!this._map)return;const t=this._offset.mult(this._scale);this._element.style.transform="\n            translate(".concat(e.x,"px,").concat(e.y,"px)\n            ").concat(Yl[this._anchor],"\n            ").concat(this._calculateXYTransform()," ").concat(this._calculateZTransform(),"\n            translate(").concat(t.x,"px,").concat(t.y,"px)\n        ")}_calculateXYTransform(){const t=this._pos,r=this._map,n=this.getPitchAlignment();if(!r||!t||"map"!==n)return"";if(!r._showingGlobe()){const e=r.getPitch();return e?"rotateX(".concat(e,"deg)"):""}const i=e.cX(e.f6(r.transform,this._lngLat)),s=t.sub(e.f7(r.transform)),o=Math.abs(s.x)+Math.abs(s.y);if(0===o)return"";const a=i/o;return"rotateX(".concat(-s.y*a,"deg) rotateY(").concat(s.x*a,"deg)")}_calculateZTransform(){const t=this._pos,r=this._map;if(!r||!t)return"";let n=0;const i=this.getRotationAlignment();if("map"===i)if(r._showingGlobe()){const t=r.project(new e.aT(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),i=r.project(new e.aT(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(t);n=e.cX(Math.atan2(i.y,i.x))-90}else n=-r.getBearing();else if("horizon"===i){const i=e.ah(4,6,r.getZoom()),s=e.f7(r.transform);s.y+=i*r.transform.height;const o=t.sub(s),a=e.cX(Math.atan2(o.y,o.x));n=(a>90?a-270:a+90)*(1-i)}return n+=this._rotation,n?"rotateZ(".concat(n,"deg)"):""}_update(e){cancelAnimationFrame(this._updateFrameId);const t=this._map;t&&(t.transform.renderWorldCopies&&(this._lngLat=Kl(this._lngLat,this._pos,t.transform)),this._pos=t.project(this._lngLat,this._altitude),!0===e?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),t._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(t._showingGlobe()||t.getTerrain()||t.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(t){return this._offset=e.P.convert(t),this._update(),this}addClassName(e){return this._element.classList.add(e),this}removeClassName(e){return this._element.classList.remove(e),this}toggleClassName(e){return this._element.classList.toggle(e)}_onMove(t){const r=this._map;if(!r)return;const n=this._pointerdownPos,i=this._positionDelta;if(n&&i){if(!this._isDragging){const e=this._clickTolerance||r._clickTolerance;if(t.point.dist(n)<e)return;this._isDragging=!0}this._pos=t.point.sub(i),this._lngLat=r.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none","pending"===this._state&&(this._state="active",this.fire(new e.z("dragstart"))),this.fire(new e.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const t=this._map;t&&(t.off("mousemove",this._onMove),t.off("touchmove",this._onMove)),"active"===this._state&&this.fire(new e.z("dragend")),this._state="inactive"}_addDragHandler(e){const t=this._map,r=this._pos;t&&r&&this._element.contains(e.originalEvent.target)&&(e.preventDefault(),this._positionDelta=e.point.sub(r),this._pointerdownPos=e.point,this._state="pending",t.on("mousemove",this._onMove),t.on("touchmove",this._onMove),t.once("mouseup",this._onUp),t.once("touchend",this._onUp))}setDraggable(e){this._draggable=!!e;const t=this._map;return t&&(e?(t.on("mousedown",this._addDragHandler),t.on("touchstart",this._addDragHandler)):(t.off("mousedown",this._addDragHandler),t.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(e){return this._rotation=e||Xl.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(e){return this._rotationAlignment=e||Xl.rotationAlignment,this._update(),this}getRotationAlignment(){return"auto"===this._rotationAlignment||"horizon"===this._rotationAlignment&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(e){return this._pitchAlignment=e||Xl.pitchAlignment,this._update(),this}getPitchAlignment(){return"auto"===this._pitchAlignment?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(e){return this._occludedOpacity=e||Xl.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const Ql={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},$l={maxWidth:100,unit:"metric"},ec={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},tc={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},rc=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function nc(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:new e.P(0,0),r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"bottom";if("number"==typeof t){const n=Math.round(Math.sqrt(.5*Math.pow(t,2)));switch(r){case"top":return new e.P(0,t);case"top-left":return new e.P(n,n);case"top-right":return new e.P(-n,n);case"bottom":return new e.P(0,-t);case"bottom-left":return new e.P(n,-n);case"bottom-right":return new e.P(-n,-n);case"left":return new e.P(t,0);case"right":return new e.P(-t,0)}return new e.P(0,0)}return t instanceof e.P||Array.isArray(t)?e.P.convert(t):e.P.convert(t[r]||[0,0])}const ic={version:t,supported:u.supported,setRTLTextPlugin:e.fb,getRTLTextPluginStatus:e.fa,Map:class extends Rl{constructor(t){o.mark(r.create);const n=t;if(null!=(t=Object.assign({},Hl,t)).minZoom&&null!=t.maxZoom&&t.minZoom>t.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(null!=t.minPitch&&null!=t.maxPitch&&t.minPitch>t.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(null!=t.minPitch&&t.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(null!=t.maxPitch&&t.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(t.antialias&&e.f3(window)&&(t.antialias=!1,e.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new pn(t.minZoom,t.maxZoom,t.minPitch,t.maxPitch,t.renderWorldCopies,null,null),t),this._repaint=!!t.repaint,this._interactive=t.interactive,this._minTileCacheSize=t.minTileCacheSize,this._maxTileCacheSize=t.maxTileCacheSize,this._failIfMajorPerformanceCaveat=t.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=t.preserveDrawingBuffer,this._antialias=t.antialias,this._trackResize=t.trackResize,this._bearingSnap=t.bearingSnap,this._refreshExpiredTiles=t.refreshExpiredTiles,this._fadeDuration=t.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=t.crossSourceCollisions,this._collectResourceTiming=t.collectResourceTiming,this._language=this._parseLanguage(t.language),this._worldview=t.worldview,this._renderTaskQueue=new zl,this._domRenderTaskQueue=new zl,this._controls=[],this._markers=[],this._popups=[],this._mapId=e.b2(),this._locale=Object.assign({},Ul,t.locale),this._clickTolerance=t.clickTolerance,this._cooperativeGestures=t.cooperativeGestures,this._performanceMetricsCollection=t.performanceMetricsCollection,this._tessellationStep=t.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=t.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=t.scaleFactor,this._requestManager=new k(t.transformRequest,t.accessToken,t.testMode),this._silenceAuthErrors=!!t.testMode,this._contextCreateOptions=t.contextCreateOptions?Object.assign({},t.contextCreateOptions):{},"string"==typeof t.container){const e=document.getElementById(t.container);if(!e)throw new Error("Container '".concat(t.container.toString(),"' not found."));this._container=e}else{if(!(t.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=t.container}if(this._container.childNodes.length>0&&e.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),t.maxBounds&&this.setMaxBounds(t.maxBounds),this._spriteFormat=t.spriteFormat,e.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._setupPainter(),void 0===this.painter)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Ml(this,t),this._localFontFamily=t.localFontFamily,this._localIdeographFontFamily=t.localIdeographFontFamily,(t.style||!t.testMode)&&this.setStyle(t.style||e.e.DEFAULT_STYLE,{config:t.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),t.projection&&this.setProjection(t.projection),t.hash&&(this._hash=new Da("string"==typeof t.hash&&t.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){null==n.center&&null==n.zoom||(this.transform._unmodified=!1),this.jumpTo({center:t.center,zoom:t.zoom,bearing:t.bearing,pitch:t.pitch});const e=t.bounds;e&&(this.resize(),this.fitBounds(e,Object.assign({},t.fitBoundsOptions,{duration:0})))}this.resize(),t.attributionControl&&this.addControl(new Dl({customAttribution:t.customAttribution})),this._logoControl=new Fl,this.addControl(this._logoControl,t.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent(),this._postStyleWithAppearanceEvent(),this._setupIndoor()}),this.on("data",t=>{this._update("style"===t.dataType),this.fire(new e.z("".concat(t.dataType,"data"),t))}),this.on("dataloading",t=>{this.fire(new e.z("".concat(t.dataType,"dataloading"),t))}),this._interactions=new ql(this)}_getMapId(){return this._mapId}addControl(t,r){if(void 0===r&&(r=t.getDefaultPosition?t.getDefaultPosition():"top-right"),!t||!t.onAdd)return this.fire(new e.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const n=t.onAdd(this);this._controls.push(t);const i=this._controlPositions[r];return-1!==r.indexOf("bottom")?i.insertBefore(n,i.firstChild):i.appendChild(n),this}removeControl(t){if(!t||!t.onRemove)return this.fire(new e.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(t);return r>-1&&this._controls.splice(r,1),t.onRemove(this),this}hasControl(e){return this._controls.indexOf(e)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(t){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new e.z("movestart",t)).fire(new e.z("move",t)),this.fire(new e.z("resize",t)),r&&this.fire(new e.z("moveend",t)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(t){return this.transform.setMaxBounds(e.aI.convert(t)),this._update()}setMinZoom(t){if((t=null!==t&&void 0!==t?t:-2)>=-2&&t<=this.transform.maxZoom)return this.transform.minZoom=t,this._update(),this.getZoom()<t?this.setZoom(t):this.fire(new e.z("zoomstart")).fire(new e.z("zoom")).fire(new e.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(t){if((t=null!==t&&void 0!==t?t:22)>=this.transform.minZoom)return this.transform.maxZoom=t,this._update(),this.getZoom()>t?this.setZoom(t):this.fire(new e.z("zoomstart")).fire(new e.z("zoom")).fire(new e.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(t){if((t=null!==t&&void 0!==t?t:0)<0)throw new Error("minPitch must be greater than or equal to 0");if(t>=0&&t<=this.transform.maxPitch)return this.transform.minPitch=t,this._update(),this.getPitch()<t?this.setPitch(t):this.fire(new e.z("pitchstart")).fire(new e.z("pitch")).fire(new e.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(t){if((t=null!==t&&void 0!==t?t:85)>85)throw new Error("maxPitch must be less than or equal to 85");if(t>=this.transform.minPitch)return this.transform.maxPitch=t,this._update(),this.getPitch()>t?this.setPitch(t):this.fire(new e.z("pitchstart")).fire(new e.z("pitch")).fire(new e.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(e){return this._scaleFactor=e,this.painter.scaleFactor=e,this._scaleFactorChanged=!0,this.style._updateFilteredLayers(e=>"symbol"===e.type),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(e){return this.transform.renderWorldCopies=e,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(e){return"auto"===e?navigator.language:Array.isArray(e)?0===e.length?void 0:e.map(e=>"auto"===e?navigator.language:e):e}setLanguage(e){const t=this._parseLanguage(e);if(!this.style||t===this._language)return this;this._language=t,this.style.reloadSources();for(const r of this._controls)r._setLanguage&&r._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(e){return this.style&&e!==this._worldview?(this._worldview=e,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return"globe"===this.transform.projection.name}setProjection(e){return this._lazyInitEmptyStyle(),e?"string"==typeof e&&(e={name:e}):e=null,this._useExplicitProjection=!!e,this._prioritizeAndUpdateProjection(e,this.style.projection)}_updateProjectionTransition(){if("globe"!==this.getProjection().name)return;const t=this.transform,r=t.projection.name;let n;"globe"===r&&t.zoom>=e.cL?(t.setMercatorFromTransition(),n=!0):"mercator"===r&&t.zoom<e.cL&&(t.setProjection({name:"globe"}),n=!0),n&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(e,t){return this._updateProjection(e||t||{name:"mercator"})}_updateProjection(t){let r;const n=this.transform.mercatorFromTransition;r="globe"===t.name&&this.transform.zoom>=e.cL?this.transform.setMercatorFromTransition():this.transform.setProjection(t),this.style.applyProjectionUpdate();const i="mercator"===this.transform.getProjection().name&&n!==this.transform.mercatorFromTransition;return(r||i)&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(t,r){return this.transform.locationPoint3D(e.aT.convert(t),r)}unproject(t,r){return this.transform.pointLocation3D(e.P.convert(t),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(e,t,r){const n=e=>{let r=[];if(Array.isArray(t)){const n=t.filter(e=>this.getLayer(e));r=n.length?this.queryRenderedFeatures(e,{layers:n}):[]}else r=this.queryRenderedFeatures(e,{target:t});return r};if("mouseenter"===e||"mouseover"===e){let i=!1;const s=t=>{const s=n(t.point);s.length?i||(i=!0,r.call(this,new Ga(e,this,t.originalEvent,{features:s}))):i=!1};return{listener:r,targets:t,delegates:{mousemove:s,mouseout:()=>{i=!1}}}}if("mouseleave"===e||"mouseout"===e){let i=!1;const s=t=>{n(t.point).length?i=!0:i&&(i=!1,r.call(this,new Ga(e,this,t.originalEvent)))},o=t=>{i&&(i=!1,r.call(this,new Ga(e,this,t.originalEvent)))};return{listener:r,targets:t,delegates:{mousemove:s,mouseout:o}}}{const i=e=>{const t=n(e.point);t.length&&(e.features=t,r.call(this,e),delete e.features)};return{listener:r,targets:t,delegates:{[e]:i}}}}on(e,t,r){if("function"==typeof t||void 0===r)return super.on(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const n=this._createDelegatedListener(e,t,r);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[e]=this._delegatedListeners[e]||[],this._delegatedListeners[e].push(n);for(const i in n.delegates)this.on(i,n.delegates[i]);return this}once(e,t,r){if("function"==typeof t||void 0===r)return super.once(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const n=this._createDelegatedListener(e,t,r);for(const i in n.delegates)this.once(i,n.delegates[i]);return this}off(e,t,r){if("function"==typeof t||void 0===r)return super.off(e,t);if("string"==typeof t&&(t=[t]),!this._areTargetsValid(t))return this;const n=this._delegatedListeners?this._delegatedListeners[e]:void 0;return n&&(e=>{for(let n=0;n<e.length;n++){const i=e[n];if(i.listener===r&&Wl(i.targets,t)){for(const e in i.delegates)this.off(e,i.delegates[e]);return e.splice(n,1),this}}})(n),this}queryRenderedFeatures(t,r){if(!this.style)return[];if(void 0===t||t instanceof e.P||Array.isArray(t)||void 0!==r||(r=t,t=void 0),t=t||[[0,0],[this.transform.width,this.transform.height]],!r){const e=this.style.queryRenderedFeatures(t,void 0,this.transform),r=this.style.queryRenderedFeatureset(t,void 0,this.transform);return e.concat(r)}let n=!0;if(r.target&&(n=this._isTargetValid(r.target),n&&!r.layers))return this.style.queryRenderedFeatureset(t,r,this.transform);let i=!0;if(r.layers&&Array.isArray(r.layers)){for(const e of r.layers)if(!this._isValidId(e)){i=!1;break}if(i&&!r.target)return this.style.queryRenderedFeatures(t,r,this.transform)}let s=[];return i&&(s=s.concat(this.style.queryRenderedFeatures(t,r,this.transform))),n&&(s=s.concat(this.style.queryRenderedFeatureset(t,r,this.transform))),s}querySourceFeatures(e,t){return!e||"string"==typeof e&&!this._isValidId(e)?[]:this.style.querySourceFeatures(e,t)}queryRasterValue(e,t,r){return this._isValidId(e)?this.style.queryRasterValue(e,t,r):Promise.resolve(null)}isPointOnSurface(t){const{name:r}=this.transform.projection;return"globe"!==r&&"mercator"!==r&&e.w("".concat(r," projection does not support isPointOnSurface, this API may behave unexpectedly.")),this.transform.isPointOnSurface(e.P.convert(t))}addInteraction(e,t){return this._interactions.add(e,t),this}removeInteraction(e){return this._interactions.remove(e),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(e){return this._cooperativeGestures=e,this}setStyle(t,r){return r=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&t&&!1!==r.diff&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(t,(n,i)=>{if(n){const i="string"==typeof n?n:n instanceof Error?n.message:n.error;e.w("Unable to perform style diff: ".concat(i,". Rebuilding the style from scratch.")),this._updateStyle(t,r)}else i&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(t,r))}_getUIString(e){const t=this._locale[e];if(null==t)throw new Error("Missing UI string '".concat(e,"'"));return t}_updateStyle(e,t){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),e){const r=Object.assign({},t);t&&t.config&&(r.initialConfig=t.config,delete r.config),this.style=new Rn(this,r).load(e),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Rn(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(e.w("There is no style added to the map."),!1)}_isValidId(t){return null==t?(this.fire(new e.y(new Error("IDs can't be empty."))),!1):!e.dr(t)||(this.fire(new e.y(new Error("IDs can't contain special symbols: \"".concat(t,'".')))),!1)}_isTargetValid(e){return"featuresetId"in e?this._isValidId("importId"in e?e.importId:e.featuresetId):"layerId"in e&&this._isValidId(e.layerId)}_areTargetsValid(e){if(Array.isArray(e)){for(const t of e)if(!this._isValidId(t))return!1;return!0}return this._isTargetValid(e)}addSource(e,t){return this._isValidId(e)?(this._lazyInitEmptyStyle(),this.style.addSource(e,t),this._update(!0)):this}isSourceLoaded(e){return!!this._isValidId(e)&&!!this.style&&this.style._isSourceCacheLoaded(e)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(e,t,r){this._lazyInitEmptyStyle(),this.style.addSourceType(e,t,r)}removeSource(e){return this._isValidId(e)?(this.style.removeSource(e),this._updateTerrain(),this._update(!0)):this}getSource(e){return this._isValidId(e)?this.style.getOwnSource(e):null}addImage(t,r){let{pixelRatio:n=1,sdf:i=!1,stretchX:s,stretchY:o,content:a}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};this._lazyInitEmptyStyle();const l=e.I.from(t);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:t,height:c,data:u}=e.o.getImageData(r);this.style.addImage(l,{data:new e.q({width:t,height:c},u),pixelRatio:n,stretchX:s,stretchY:o,content:a,sdf:i,version:0,usvg:!1})}else if(void 0===r.width||void 0===r.height)this.fire(new e.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:c,height:u}=r,d=r;this.style.addImage(l,{data:new e.q({width:c,height:u},new Uint8Array(d.data)),pixelRatio:n,stretchX:s,stretchY:o,content:a,sdf:i,usvg:!1,version:0,userImage:d}),d.onAdd&&d.onAdd(this,t)}}updateImage(t,r){this._lazyInitEmptyStyle();const n=e.I.from(t),i=this.style.getImage(n);if(!i)return void this.fire(new e.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const s=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?e.o.getImageData(r):r,{width:o,height:a,data:l}=s;if(void 0===o||void 0===a)return void this.fire(new e.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(o!==(i.usvg?i.icon.usvg_tree.width:i.data.width)||a!==(i.usvg?i.icon.usvg_tree.height:i.data.height))return void this.fire(new e.y(new Error("The width and height of the updated image (".concat(o,", ").concat(a,")\n                must be that same as the previous version of the image\n                (").concat(i.data.width,", ").concat(i.data.height,")"))));const c=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let u=!1;i.usvg?(i.data=new e.q({width:o,height:a},new Uint8Array(l)),i.usvg=!1,i.icon=void 0,u=!0):i.data.replace(l,c),this.style.updateImage(n,i,u)}hasImage(t){return t?!!this.style&&!!this.style.getImage(e.I.from(t)):(this.fire(new e.y(new Error("Missing required image id"))),!1)}removeImage(t){this.style.removeImage(e.I.from(t))}loadImage(t,r){e.n(this._requestManager.transformRequest(t,e.R.Image),(t,n)=>{r(t,n instanceof HTMLImageElement?e.o.getImageData(n):n)})}listImages(){return this.style.listImages().map(e=>e.name)}addModel(e,t){this._lazyInitEmptyStyle(),this.style.addModel(e,t)}hasModel(t){return t?this.style.hasModel(t):(this.fire(new e.y(new Error("Missing required model id"))),!1)}removeModel(e){this.style.removeModel(e)}listModels(){return this.style.listModels()}addLayer(e,t){return this._isValidId(e.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(e,t),this._update(!0)):this}getSlot(e){const t=this.getLayer(e);return t&&t.slot||null}setSlot(e,t){return this.style.setSlot(e,t),this.style.mergeLayers(),this._update(!0)}addImport(t,r){return this.style.addImport(t,r).catch(t=>this.fire(new e.y(new Error("Failed to add import",t)))),this}updateImport(e,t){return"string"!=typeof t&&t.id!==e?(this.removeImport(e),this.addImport(t)):(this.style.updateImport(e,t),this._update(!0))}removeImport(e){return this.style.removeImport(e),this}moveImport(e,t){return this.style.moveImport(e,t),this._update(!0)}moveLayer(e,t){return this._isValidId(e)?(this.style.moveLayer(e,t),this._update(!0)):this}removeLayer(e){return this._isValidId(e)?(this.style.removeLayer(e),this._update(!0)):this}getLayer(e){if(!this._isValidId(e))return null;const t=this.style.getOwnLayer(e);return t?"custom"===t.type?t.implementation:t.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(e,t,r){return this._isValidId(e)?(this.style.setLayerZoomRange(e,t,r),this._update(!0)):this}setFilter(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};return this._isValidId(e)?(this.style.setFilter(e,t,r),this._update(!0)):this}getFilter(e){return this._isValidId(e)?this.style.getFilter(e):null}setPaintProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setPaintProperty(e,t,r,n),this._update(!0)):this}getPaintProperty(e,t){return this._isValidId(e)?this.style.getPaintProperty(e,t):null}setLayoutProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?(this.style.setLayoutProperty(e,t,r,n),this._update(!0)):this}getLayoutProperty(e,t){return this._isValidId(e)?this.style.getLayoutProperty(e,t):null}setLayerProperty(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return this._isValidId(e)?("appearances"===t&&this._postAddingAppearancesToStyleEvent(),this.style.setLayerProperty(e,t,r,n),this._update(!0)):this}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(e){return this.style.setGlyphsUrl(e),this._update(!0)}getSchema(e){return this.style.getSchema(e)}setSchema(e,t){return this.style.setSchema(e,t),this._update(!0)}getConfig(e){return this.style.getConfig(e)}setConfig(e,t){return this.style.setConfig(e,t),this._update(!0)}getConfigProperty(e,t){return this.style.getConfigProperty(e,t)}setConfigProperty(e,t,r){return this.style.setConfigProperty(e,t,r),this._update(!0)}getFeaturesetDescriptors(e){return this.style.getFeaturesetDescriptors(e)}setLights(e){if(this._lazyInitEmptyStyle(),e&&1===e.length&&"flat"===e[0].type){const t=e[0];t.properties?this.style.setFlatLight(t.properties,t.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(e),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const e=this.style.getLights()||[];return 0===e.length&&e.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),e}setLight(e){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:e}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(e){return this._lazyInitEmptyStyle(),!e&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(e),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(e){return this._lazyInitEmptyStyle(),this.style.setFog(e),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(e){return this._lazyInitEmptyStyle(),this.style.setSnow(e),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(e){return this._lazyInitEmptyStyle(),this.style.setRain(e),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(e){return this._lazyInitEmptyStyle(),this.style.setColorTheme(e),this._update(!0)}setImportColorTheme(e,t){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(e,t),this._update(!0)}setCamera(e){return this.style.setCamera(e),this._triggerCameraUpdate(e)}_triggerCameraUpdate(e){return this._update(this.transform.setOrthographicProjectionAtLowPitch("orthographic"===e["camera-projection"]))}getCamera(){return this.style.camera}_queryFogOpacity(t){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(e.aT.convert(t),this.transform):0}setFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.setFeatureState(e,t),this._update())}removeFeatureState(e,t){return e.source&&!this._isValidId(e.source)?this:(this.style.removeFeatureState(e,t),this._update())}getFeatureState(e){return e.source&&!this._isValidId(e.source)?null:this.style.getFeatureState(e)}_selectIndoorFloor(e){this.indoor.selectFloor(e)}_setIndoorActiveFloorsVisibility(e){this.indoor.setActiveFloorsVisibility(e)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Ol),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const e=this._container.getBoundingClientRect().width||400,t=this._container.getBoundingClientRect().height||300;let r,n,i,s=this._container;for(;s&&(!n||!i);){const e=window.getComputedStyle(s).transform;e&&"none"!==e&&(r=e.match(/matrix.*\((.+)\)/)[1].split(", "),r[0]&&"0"!==r[0]&&"1"!==r[0]&&(n=r[0]),r[3]&&"0"!==r[3]&&"1"!==r[3]&&(i=r[3])),s=s.parentElement}this._containerWidth=n?Math.abs(e/n):e,this._containerHeight=i?Math.abs(t/i):t}_detectMissingCSS(){"rgb(250, 128, 114)"!==window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")&&e.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupIndoor(){this.style.isIndoorEnabled()&&(this.indoor=new Dn(this.style),this.on("load",()=>{this._addIndoorControl(),this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds()),this.on("move",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())}),this.on("idle",()=>{this.indoor._updateUI(this.transform.zoom,this.transform.center,this.transform.getBounds())})}))}_setupContainer(){const e=this._container;e.classList.add("mapboxgl-map"),(this._missingCSSCanary=d("div","mapboxgl-canary",e)).style.visibility="hidden",this._detectMissingCSS();const t=this._canvasContainer=d("div","mapboxgl-canvas-container",e);this._canvas=d("canvas","mapboxgl-canvas",t),this._interactive&&(t.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const r=this._controlContainer=d("div","mapboxgl-control-container",e),n=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(e=>{n[e]=d("div","mapboxgl-ctrl-".concat(e),r)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(t,r){const n=e.o.devicePixelRatio||1;this._canvas.width=n*Math.ceil(t),this._canvas.height=n*Math.ceil(r),this._canvas.style.width="".concat(t,"px"),this._canvas.style.height="".concat(r,"px")}_addMarker(e){this._markers.push(e)}_removeMarker(e){const t=this._markers.indexOf(e);-1!==t&&this._markers.splice(t,1)}_addPopup(e){this._popups.push(e)}_removePopup(e){const t=this._popups.indexOf(e);-1!==t&&this._popups.splice(t,1)}_setupPainter(){const t=Object.assign({},u.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",t);r?(Y(r,!0),this.painter=new La(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._worldview),this.on("data",e=>{"source"===e.dataType&&this.painter.setTileLoadedFlag(!0)}),e.k.testSupport(r)):this.fire(new e.y(new Error("Failed to initialize WebGL")))}_contextLost(t){t.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new e.z("webglcontextlost",{originalEvent:t}))}_contextRestored(t){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new e.z("webglcontextrestored",{originalEvent:t}))}_onMapScroll(e){if(e.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(e){return this.style?(this._styleDirty=this._styleDirty||e,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(e){return this._update(),this._renderTaskQueue.add(e)}_cancelRenderFrame(e){this._renderTaskQueue.remove(e)}_requestDomTask(e){!this.loaded()||this.loaded()&&!this.isMoving()?e():this._domRenderTaskQueue.add(e)}_render(t){let n;this.fire(new e.z("renderstart")),++this._frameId;const i=this.painter.context.extTimerQuery,s=e.o.now(),a=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(n=a.createQuery(),a.beginQuery(i.TIME_ELAPSED_EXT,n)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(t),this._domRenderTaskQueue.run(t),this._removed)return;this._updateProjectionTransition();const l=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const t=this.transform.zoom,r=this.transform.pitch,n=e.o.now(),i=new e.ac(t,{now:n,fadeDuration:l,pitch:r,transition:this.style.transition,worldview:this._worldview});this.style.update(i)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let c=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),c=this._updateAverageElevation(s),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):c=this._updateAverageElevation(s);const u=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,l,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),u&&(this._placementDirty=u.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:l,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new e.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,o.mark(r.load),this.fire(new e.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),n){const t=e.o.now()-s;a.endQuery(i.TIME_ELAPSED_EXT),setTimeout(()=>{const r=a.getQueryParameter(n,a.QUERY_RESULT)/1e6;a.deleteQuery(n),this.fire(new e.z("gpu-timing-frame",{cpuTime:t,gpuTime:r}))},50)}if(this.listens("gpu-timing-layer")){const t=this.painter.collectGpuTimers();setTimeout(()=>{const r=this.painter.queryGpuTimers(t);this.fire(new e.z("gpu-timing-layer",{layerTimes:r}))},50)}if(this.listens("gpu-timing-deferred-render")){const t=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const r=this.painter.queryGpuTimeDeferredRender(t);this.fire(new e.z("gpu-timing-deferred-render",{gpuTime:r}))},50)}const d=this._sourcesDirty||this._styleDirty||this._placementDirty||c;if(d||this._repaint)this.triggerRepaint();else{const t=this.idle();if(t&&(c=this._updateAverageElevation(s,!0)),c)this.triggerRepaint();else if(this._triggerFrame(!1),t&&(this.fire(new e.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const t=this._calculateSpeedIndex();this.fire(new e.z("speedindexcompleted",{speedIndex:t})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||d||(this._fullyLoaded=!0,o.mark(r.fullLoad),this._performanceMetricsCollection&&H(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(e){for(const t of this._markers)e&&!this.getRenderWorldCopies()&&(t._lngLat=t._lngLat.wrap()),t._update();for(const t of this._popups)!e||this.getRenderWorldCopies()||t._trackPointer||(t._lngLat=t._lngLat.wrap()),t._update()}_updateAverageElevation(e){let t=arguments.length>1&&void 0!==arguments[1]&&arguments[1];const r=e=>(this.transform.averageElevation=e,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return 0!==this.transform.averageElevation&&r(0);const n=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(n||(t||e-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(e)){const t=this.transform.averageElevation;let i=this.transform.sampleAverageElevation();null!=this.transform.elevation&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(i)?i=0:this._averageElevationLastSampledAt=e;const s=Math.abs(t-i);if(s>1){if(this._isInitialLoad||n)return this._averageElevation.jumpTo(i),r(i);this._averageElevation.easeTo(i,e,300)}else if(s>1e-4)return this._averageElevation.jumpTo(i),r(i)}return!!this._averageElevation.isEasing(e)&&r(this._averageElevation.getValue(e))}_authenticate(){Z(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,t=>{if(t&&(t.message===T||401===t.status)){const t=this.painter.context.gl;Y(t,!1),this._logoControl instanceof Fl&&this._logoControl._updateLogo(),t&&t.clear(t.DEPTH_BUFFER_BIT|t.COLOR_BUFFER_BIT|t.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new e.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),F(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&z(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_postStyleWithAppearanceEvent(){this.style.globalId&&this.style.hasAppearances()&&U(this._requestManager._customAccessToken)}_postAddingAppearancesToStyleEvent(){q(this._requestManager._customAccessToken)}_updateTerrain(){const e=this._isDragging();this.painter.updateTerrain(this.style,e)}_calculateSpeedIndex(){const e=this.painter.canvasCopy(),t=this.painter.getCanvasCopiesAndTimestamps();t.timeStamps.push(performance.now());const r=this.painter.context.gl,n=r.createFramebuffer();function i(e){r.framebufferTexture2D(r.FRAMEBUFFER,r.COLOR_ATTACHMENT0,r.TEXTURE_2D,e,0);const t=new Uint8Array(r.drawingBufferWidth*r.drawingBufferHeight*4);return r.readPixels(0,0,r.drawingBufferWidth,r.drawingBufferHeight,r.RGBA,r.UNSIGNED_BYTE,t),t}return r.bindFramebuffer(r.FRAMEBUFFER,n),this._canvasPixelComparison(i(e),t.canvasCopies.map(i),t.timeStamps)}_canvasPixelComparison(e,t,r){let n=r[1]-r[0];const i=e.length/4;for(let s=0;s<t.length;s++){const o=t[s];let a=0;for(let t=0;t<o.length;t+=4)o[t]===e[t]&&o[t+1]===e[t+1]&&o[t+2]===e[t+2]&&o[t+3]===e[t+3]&&(a+=1);n+=(r[s+2]-r[s+1])*(1-a/i)}return n}remove(){this._hash&&this._hash.remove();for(const e of this._controls)e.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor&&this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const t=this.painter.context.gl.getExtension("WEBGL_lose_context");t&&t.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),K.delete(this.painter.context.gl),G.remove(),D.remove(),this._removed=!0,this.fire(new e.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(t){this._renderNextFrame=this._renderNextFrame||t,this.style&&!this._frame&&(this._frame=e.o.frame(e=>{const t=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,t&&this._render(e)}))}_preloadTiles(t){const r=this.style?this.style.getSourceCaches():[];return e.bw(r,(e,r)=>e._preloadTiles(t,r),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(e){this._trackResize&&this.resize({originalEvent:e})._update()}_onVisibilityChange(){"hidden"===document.visibilityState&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(e){this._showTileBoundaries!==e&&(this._showTileBoundaries=e,this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(e){this._showParseStatus!==e&&(this._showParseStatus=e,this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(e){this._showTerrainWireframe!==e&&(this._showTerrainWireframe=e,this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(e){this._showLayers2DWireframe!==e&&(this._showLayers2DWireframe=e,this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(e){this._showLayers3DWireframe!==e&&(this._showLayers3DWireframe=e,this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(e){this._speedIndexTiming!==e&&(this._speedIndexTiming=e,this._update())}get showPadding(){return!!this._showPadding}set showPadding(e){this._showPadding!==e&&(this._showPadding=e,this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(e){this._showCollisionBoxes!==e&&(this._showCollisionBoxes=e,this.style&&e?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(e){this._showOverdrawInspector!==e&&(this._showOverdrawInspector=e,this._update())}get repaint(){return!!this._repaint}set repaint(e){this._repaint!==e&&(this._repaint=e,this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(e){this._vertices=e,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(e){this._showTileAABBs!==e&&(this._showTileAABBs=e,e&&this._update())}_setCacheLimits(t,r){e.f4(t,r)}get version(){return t}},NavigationControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Object.assign({},Gl,t),this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",e=>e.preventDefault()),this.options.showZoom&&(e.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",e=>{this._map&&this._map.zoomIn({},{originalEvent:e})}),d("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",e=>{this._map&&this._map.zoomOut({},{originalEvent:e})}),d("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(e.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",e=>{const t=this._map;t&&(this.options.visualizePitch?t.resetNorthPitch({},{originalEvent:e}):t.resetNorth({},{originalEvent:e}))}),this._compassIcon=d("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const e=this._map;if(!e)return;const t=e.getZoom(),r=t===e.getMaxZoom(),n=t===e.getMinZoom();this._zoomInButton.disabled=r,this._zoomOutButton.disabled=n,this._zoomInButton.setAttribute("aria-disabled",r.toString()),this._zoomOutButton.setAttribute("aria-disabled",n.toString())}_rotateCompassArrow(){const e=this._map;if(!e)return;const t=this.options.visualizePitch?"scale(".concat(1/Math.pow(Math.cos(e.transform.pitch*(Math.PI/180)),.5),") rotateX(").concat(e.transform.pitch,"deg) rotateZ(").concat(e.transform.angle*(180/Math.PI),"deg)"):"rotate(".concat(e.transform.angle*(180/Math.PI),"deg)");e._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=t)})}onAdd(e){return this._map=e,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),e.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&e.on("pitch",this._rotateCompassArrow),e.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Zl(e,this._compass,this.options.visualizePitch)),this._container}onRemove(){const e=this._map;e&&(this._container.remove(),this.options.showZoom&&e.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&e.off("pitch",this._rotateCompassArrow),e.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(e,t){const r=d("button",e,this._container);return r.type="button",r.addEventListener("click",t),r}_setButtonTitle(e,t){if(!this._map)return;const r=this._map._getUIString("NavigationControl.".concat(t));e.setAttribute("aria-label",r),e.firstElementChild&&e.firstElementChild.setAttribute("title",r)}},GeolocateControl:class extends e.E{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};super();const r=navigator.geolocation;this.options=Object.assign({geolocation:r},Ql,t),e.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=Ra(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(e){return this._map=e,this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){void 0!==this._geolocationWatchID&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(e){var t=this;const r=function(){let r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:!!t.options.geolocation;t._supportsGeolocation=r,e(r)};void 0!==this._supportsGeolocation?e(this._supportsGeolocation):void 0!==navigator.permissions?navigator.permissions.query({name:"geolocation"}).then(e=>r("denied"!==e.state)).catch(()=>r()):r()}_isOutOfMapMaxBounds(e){const t=this._map.getMaxBounds(),r=e.coords;return!!t&&(r.longitude<t.getWest()||r.longitude>t.getEast()||r.latitude<t.getSouth()||r.latitude>t.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(t){if(this._map){if(this._isOutOfMapMaxBounds(t))return this._setErrorState(),this.fire(new e.z("outofmaxbounds",t)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=t,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&"OFF"!==this._watchState&&this._updateMarker(t),this.options.trackUserLocation&&"ACTIVE_LOCK"!==this._watchState||this._updateCamera(t),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.z("geolocate",Object.assign({coords:t.coords,timestamp:t.timestamp},t.toJSON?{toJSON:t.toJSON.bind(t)}:{}))),this._finish()}}_updateCamera(t){const r=new e.aT(t.coords.longitude,t.coords.latitude),n=t.coords.accuracy,i=this._map.getBearing(),s=Object.assign({bearing:i},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(n),s,{geolocateSource:!0})}_updateMarker(t){if(t){const r=new e.aT(t.coords.longitude,t.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=t.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const t=this._map.transform,r=e.cf(1,t._center.lat)*t.worldSize,n=Math.ceil(2*this._accuracy*r);this._circleElement.style.width="".concat(n,"px"),this._circleElement.style.height="".concat(n,"px")}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&"number"==typeof this._heading?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(t){if(this._map){if(this.options.trackUserLocation)if(1===t.code){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const e=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e),void 0!==this._geolocationWatchID&&this._clearWatch()}else{if(3===t.code&&this._noTimeout)return;this._setErrorState()}"OFF"!==this._watchState&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new e.z("error",t)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(t){if(void 0!==this._map){if(this._container.addEventListener("contextmenu",e=>e.preventDefault()),this._geolocateButton=d("button","mapboxgl-ctrl-geolocate",this._container),d("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",!1===t){e.w("Geolocation support is not available so the GeolocateControl will be disabled.");const t=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",t),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",t)}else{const e=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",e),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",e)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=d("div","mapboxgl-user-location"),this._dotElement.appendChild(d("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(d("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new Jl({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=d("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new Jl({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",t=>{t.geolocateSource||"ACTIVE_LOCK"!==this._watchState||t.originalEvent&&"resize"===t.originalEvent.type||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new e.z("trackuserlocationend")))})}}_onDeviceOrientation(e){this._userLocationDotMarker&&(e.webkitCompassHeading?this._heading=e.webkitCompassHeading:!0===e.absolute&&(this._heading=-1*e.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return e.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new e.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new e.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new e.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if("OFF"===this._watchState&&void 0!==this._geolocationWatchID)this._clearWatch();else if(void 0===this._geolocationWatchID){let e;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(e={maximumAge:6e5,timeout:0},this._noTimeout=!0):(e=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,e),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const e=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};"undefined"!=typeof DeviceMotionEvent&&"function"==typeof DeviceMotionEvent.requestPermission?DeviceOrientationEvent.requestPermission().then(t=>{"granted"===t&&e()}).catch(console.error):e()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Dl,ScaleControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this.options=Object.assign({},$l,t),e.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const e=this.options.maxWidth||100,t=this._map,r=t._containerHeight/2,n=t._containerWidth/2-e/2,i=t.unproject([n,r]),s=t.unproject([n+e,r]),o=i.distanceTo(s);if("imperial"===this.options.unit){const t=3.2808*o;t>5280?this._setScale(e,t/5280,"mile"):this._setScale(e,t,"foot")}else"nautical"===this.options.unit?this._setScale(e,o/1852,"nautical-mile"):o>=1e3?this._setScale(e,o/1e3,"kilometer"):this._setScale(e,o,"meter")}_setScale(e,t,r){this._map._requestDomTask(()=>{const n=function(e){const t=Math.pow(10,"".concat(Math.floor(e)).length-1);let r=e/t;return r=r>=10?10:r>=5?5:r>=3?3:r>=2?2:r>=1?1:function(e){const t=Math.pow(10,Math.ceil(-Math.log(e)/Math.LN10));return Math.round(e*t)/t}(r),t*r}(t),i=n/t;this._container.innerHTML="nautical-mile"!==r?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:r}).format(n):"".concat(n,"&nbsp;").concat(ec[r]),this._container.style.width=e*i+"px"})}onAdd(e){return this._map=e,this._language=e.getLanguage(),this._container=d("div","mapboxgl-ctrl mapboxgl-ctrl-scale",e.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(e){this._language=e,this._update()}setUnit(e){this.options.unit=e,this._update()}},FullscreenControl:class{constructor(){let t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};this._fullscreen=!1,t&&t.container&&(t.container instanceof HTMLElement?this._container=t.container:e.w("Full screen control 'container' must be a DOM element.")),e.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(t){return this._map=t,this._container||(this._container=this._map.getContainer()),this._controlContainer=d("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",e.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const e=this._fullscreenButton=d("button","mapboxgl-ctrl-fullscreen",this._controlContainer);d("span","mapboxgl-ctrl-icon",e).setAttribute("aria-hidden","true"),e.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const e=this._getTitle();this._fullscreenButton.setAttribute("aria-label",e),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",e)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Ol,Popup:class extends e.E{constructor(t){super(),this.options=Object.assign(Object.create(tc),t),this._altitude=this.options.altitude,e.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(t&&t.className?t.className.trim().split(/\s+/):[])}addTo(t){return this._map&&this.remove(),this._map=t,this.options.closeOnClick&&t.on("preclick",this._onClose),this.options.closeOnMove&&t.on("move",this._onClose),t.on("remove",this.remove),this._update(),t._addPopup(this),this._focusFirstElement(),this._trackPointer?(t.on("mousemove",this._onMouseEvent),t.on("mouseup",this._onMouseEvent),t._canvasContainer.classList.add("mapboxgl-track-pointer")):t.on("move",this._update),this.fire(new e.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const t=this._map;return t&&(t.off("move",this._update),t.off("move",this._onClose),t.off("preclick",this._onClose),t.off("click",this._onClose),t.off("remove",this.remove),t.off("mousemove",this._onMouseEvent),t.off("mouseup",this._onMouseEvent),t.off("drag",this._onMouseEvent),t._canvasContainer&&t._canvasContainer.classList.remove("mapboxgl-track-pointer"),t._removePopup(this),this._map=void 0),this.fire(new e.z("close")),this}getLngLat(){return this._lngLat}setLngLat(t){this._lngLat=e.aT.convert(t),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(e){return this._altitude=e,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const e=this._map;return e&&(e.off("move",this._update),e.on("mousemove",this._onMouseEvent),e.on("drag",this._onMouseEvent),e._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(e){return this.setDOMContent(document.createTextNode(e))}setHTML(e){const t=document.createDocumentFragment(),r=document.createElement("body");let n;for(r.innerHTML=e;n=r.firstChild,n;)t.appendChild(n);return this.setDOMContent(t)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(e){return this.options.maxWidth=e,this._update(),this}setDOMContent(e){let t=this._content;if(t)for(;t.hasChildNodes();)t.firstChild&&t.removeChild(t.firstChild);else t=this._content=d("div","mapboxgl-popup-content",this._container||void 0);if(t.appendChild(e),this.options.closeButton){const e=this._closeButton=d("button","mapboxgl-popup-close-button",t);e.type="button",e.setAttribute("aria-label","Close popup"),e.innerHTML='<span aria-hidden="true">&#215;</span>',e.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(e){return this._classList.add(e),this._updateClassList(),this}removeClassName(e){return this._classList.delete(e),this._updateClassList(),this}setOffset(e){return this.options.offset=e,this._update(),this}toggleClassName(e){let t;return this._classList.delete(e)?t=!1:(this._classList.add(e),t=!0),this._updateClassList(),t}_onMouseEvent(e){this._update(e.point)}_getAnchor(e){if(this.options.anchor)return this.options.anchor;const t=this._map,r=this._container,n=this._pos;if(!t||!r||!n)return"bottom";const i=r.offsetWidth,s=r.offsetHeight,o=n.x<i/2,a=n.x>t.transform.width-i/2;if(n.y+e<s)return o?"top-left":a?"top-right":"top";if(n.y>t.transform.height-s){if(o)return"bottom-left";if(a)return"bottom-right"}return o?"left":a?"right":"bottom"}_updateClassList(){const e=this._container;if(!e)return;const t=[...this._classList];t.push("mapboxgl-popup"),this._anchor&&t.push("mapboxgl-popup-anchor-".concat(this._anchor)),this._trackPointer&&t.push("mapboxgl-popup-track-pointer"),e.className=t.join(" ")}_update(t){const r=this._map,n=this._content;if(!r||!this._lngLat&&!this._trackPointer||!n)return;let i=this._container;if(i||(i=this._container=d("div","mapboxgl-popup",r.getContainer()),this._tip=d("div","mapboxgl-popup-tip",i),i.appendChild(n)),this.options.maxWidth&&i.style.maxWidth!==this.options.maxWidth&&(i.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Kl(this._lngLat,this._pos,r.transform)),!this._trackPointer||t){const n=this._pos=this._trackPointer&&t instanceof e.P?t:r.project(this._lngLat,this._altitude),i=nc(this.options.offset),s=this._anchor=this._getAnchor(i.y),o=nc(this.options.offset,s),a=n.add(o).round();r._requestDomTask(()=>{this._container&&s&&(this._container.style.transform="".concat(Yl[s]," translate(").concat(a.x,"px,").concat(a.y,"px)"))})}if(!this._marker&&r._showingGlobe()){const t=e.f5(r.transform,this._lngLat)?0:1;this._setOpacity(t)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const e=this._container.querySelector(rc);e&&e.focus()}_onClose(){this.remove()}_setOpacity(e){this._container&&(this._container.style.opacity="".concat(e)),this._content&&(this._content.style.pointerEvents=e?"auto":"none")}},Marker:Jl,Style:Rn,LngLat:e.aT,LngLatBounds:e.aI,Point:e.P,MercatorCoordinate:e.ae,FreeCameraOptions:ln,Evented:e.E,config:e.e,prewarm:e.f9,clearPrewarmedResources:e.f8,get accessToken(){return e.e.ACCESS_TOKEN},set accessToken(t){e.e.ACCESS_TOKEN=t},get baseApiUrl(){return e.e.API_URL},set baseApiUrl(t){e.e.API_URL=t},get workerCount(){return e.fi.workerCount},set workerCount(t){e.fi.workerCount=t},get maxParallelImageRequests(){return e.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(t){e.e.MAX_PARALLEL_IMAGE_REQUESTS=t},clearStorage(t){e.fh(t)},get workerUrl(){return e.fg.workerUrl},set workerUrl(t){e.fg.workerUrl=t},get workerClass(){return e.fg.workerClass},set workerClass(t){e.fg.workerClass=t},get workerParams(){return e.fg.workerParams},set workerParams(t){e.fg.workerParams=t},get dracoUrl(){return e.ff()},set dracoUrl(t){e.fe(t)},get meshoptUrl(){return e.fd()},set meshoptUrl(t){e.fc(t)},setNow:e.o.setNow,restoreNow:e.o.restoreNow};return ic}),r}()},893(e){e.exports=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r},e.exports.__esModule=!0,e.exports.default=e.exports},896(e,t){"use strict";function r(e,t){var r=e.length;e.push(t);e:for(;0<r;){var n=r-1>>>1,i=e[n];if(!(0<s(i,t)))break e;e[n]=t,e[r]=i,r=n}}function n(e){return 0===e.length?null:e[0]}function i(e){if(0===e.length)return null;var t=e[0],r=e.pop();if(r!==t){e[0]=r;e:for(var n=0,i=e.length,o=i>>>1;n<o;){var a=2*(n+1)-1,l=e[a],c=a+1,u=e[c];if(0>s(l,r))c<i&&0>s(u,l)?(e[n]=u,e[c]=r,n=c):(e[n]=l,e[a]=r,n=a);else{if(!(c<i&&0>s(u,r)))break e;e[n]=u,e[c]=r,n=c}}}return t}function s(e,t){var r=e.sortIndex-t.sortIndex;return 0!==r?r:e.id-t.id}if(t.unstable_now=void 0,"object"===typeof performance&&"function"===typeof performance.now){var o=performance;t.unstable_now=function(){return o.now()}}else{var a=Date,l=a.now();t.unstable_now=function(){return a.now()-l}}var c=[],u=[],d=1,h=null,p=3,m=!1,f=!1,g=!1,y=!1,_="function"===typeof setTimeout?setTimeout:null,v="function"===typeof clearTimeout?clearTimeout:null,x="undefined"!==typeof setImmediate?setImmediate:null;function b(e){for(var t=n(u);null!==t;){if(null===t.callback)i(u);else{if(!(t.startTime<=e))break;i(u),t.sortIndex=t.expirationTime,r(c,t)}t=n(u)}}function w(e){if(g=!1,b(e),!f)if(null!==n(c))f=!0,S||(S=!0,j());else{var t=n(u);null!==t&&P(w,t.startTime-e)}}var j,S=!1,T=-1,k=5,A=-1;function C(){return!!y||!(t.unstable_now()-A<k)}function E(){if(y=!1,S){var e=t.unstable_now();A=e;var r=!0;try{e:{f=!1,g&&(g=!1,v(T),T=-1),m=!0;var s=p;try{t:{for(b(e),h=n(c);null!==h&&!(h.expirationTime>e&&C());){var o=h.callback;if("function"===typeof o){h.callback=null,p=h.priorityLevel;var a=o(h.expirationTime<=e);if(e=t.unstable_now(),"function"===typeof a){h.callback=a,b(e),r=!0;break t}h===n(c)&&i(c),b(e)}else i(c);h=n(c)}if(null!==h)r=!0;else{var l=n(u);null!==l&&P(w,l.startTime-e),r=!1}}break e}finally{h=null,p=s,m=!1}r=void 0}}finally{r?j():S=!1}}}if("function"===typeof x)j=function(){x(E)};else if("undefined"!==typeof MessageChannel){var N=new MessageChannel,I=N.port2;N.port1.onmessage=E,j=function(){I.postMessage(null)}}else j=function(){_(E,0)};function P(e,r){T=_(function(){e(t.unstable_now())},r)}t.unstable_IdlePriority=5,t.unstable_ImmediatePriority=1,t.unstable_LowPriority=4,t.unstable_NormalPriority=3,t.unstable_Profiling=null,t.unstable_UserBlockingPriority=2,t.unstable_cancelCallback=function(e){e.callback=null},t.unstable_forceFrameRate=function(e){0>e||125<e?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):k=0<e?Math.floor(1e3/e):5},t.unstable_getCurrentPriorityLevel=function(){return p},t.unstable_next=function(e){switch(p){case 1:case 2:case 3:var t=3;break;default:t=p}var r=p;p=t;try{return e()}finally{p=r}},t.unstable_requestPaint=function(){y=!0},t.unstable_runWithPriority=function(e,t){switch(e){case 1:case 2:case 3:case 4:case 5:break;default:e=3}var r=p;p=e;try{return t()}finally{p=r}},t.unstable_scheduleCallback=function(e,i,s){var o=t.unstable_now();switch("object"===typeof s&&null!==s?s="number"===typeof(s=s.delay)&&0<s?o+s:o:s=o,e){case 1:var a=-1;break;case 2:a=250;break;case 5:a=1073741823;break;case 4:a=1e4;break;default:a=5e3}return e={id:d++,callback:i,priorityLevel:e,startTime:s,expirationTime:a=s+a,sortIndex:-1},s>o?(e.sortIndex=s,r(u,e),null===n(c)&&e===n(u)&&(g?(v(T),T=-1):g=!0,P(w,s-o))):(e.sortIndex=a,r(c,e),f||m||(f=!0,S||(S=!0,j()))),e},t.unstable_shouldYield=C,t.unstable_wrapCallback=function(e){var t=p;return function(){var r=p;p=t;try{return e.apply(this,arguments)}finally{p=r}}}},935(e,t,r){"use strict";r.d(t,{createOrGetChatRoom:()=>Qh,Ay:()=>lp,generateChatRoomId:()=>Jh,getChatRoomDetails:()=>sp,Wj:()=>np,ix:()=>tp,dP:()=>ep,uF:()=>rp,_z:()=>$h,BR:()=>ip,uploadProfileImageToFirebase:()=>ap,uploadPropertyImageToFirebase:()=>op});var n=r(555);const i=function(e){const t=[];let r=0;for(let n=0;n<e.length;n++){let i=e.charCodeAt(n);i<128?t[r++]=i:i<2048?(t[r++]=i>>6|192,t[r++]=63&i|128):55296===(64512&i)&&n+1<e.length&&56320===(64512&e.charCodeAt(n+1))?(i=65536+((1023&i)<<10)+(1023&e.charCodeAt(++n)),t[r++]=i>>18|240,t[r++]=i>>12&63|128,t[r++]=i>>6&63|128,t[r++]=63&i|128):(t[r++]=i>>12|224,t[r++]=i>>6&63|128,t[r++]=63&i|128)}return t},s={byteToCharMap_:null,charToByteMap_:null,byteToCharMapWebSafe_:null,charToByteMapWebSafe_:null,ENCODED_VALS_BASE:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",get ENCODED_VALS(){return this.ENCODED_VALS_BASE+"+/="},get ENCODED_VALS_WEBSAFE(){return this.ENCODED_VALS_BASE+"-_."},HAS_NATIVE_SUPPORT:"function"===typeof atob,encodeByteArray(e,t){if(!Array.isArray(e))throw Error("encodeByteArray takes an array as a parameter");this.init_();const r=t?this.byteToCharMapWebSafe_:this.byteToCharMap_,n=[];for(let i=0;i<e.length;i+=3){const t=e[i],s=i+1<e.length,o=s?e[i+1]:0,a=i+2<e.length,l=a?e[i+2]:0,c=t>>2,u=(3&t)<<4|o>>4;let d=(15&o)<<2|l>>6,h=63&l;a||(h=64,s||(d=64)),n.push(r[c],r[u],r[d],r[h])}return n.join("")},encodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?btoa(e):this.encodeByteArray(i(e),t)},decodeString(e,t){return this.HAS_NATIVE_SUPPORT&&!t?atob(e):function(e){const t=[];let r=0,n=0;for(;r<e.length;){const i=e[r++];if(i<128)t[n++]=String.fromCharCode(i);else if(i>191&&i<224){const s=e[r++];t[n++]=String.fromCharCode((31&i)<<6|63&s)}else if(i>239&&i<365){const s=((7&i)<<18|(63&e[r++])<<12|(63&e[r++])<<6|63&e[r++])-65536;t[n++]=String.fromCharCode(55296+(s>>10)),t[n++]=String.fromCharCode(56320+(1023&s))}else{const s=e[r++],o=e[r++];t[n++]=String.fromCharCode((15&i)<<12|(63&s)<<6|63&o)}}return t.join("")}(this.decodeStringToByteArray(e,t))},decodeStringToByteArray(e,t){this.init_();const r=t?this.charToByteMapWebSafe_:this.charToByteMap_,n=[];for(let i=0;i<e.length;){const t=r[e.charAt(i++)],s=i<e.length?r[e.charAt(i)]:0;++i;const a=i<e.length?r[e.charAt(i)]:64;++i;const l=i<e.length?r[e.charAt(i)]:64;if(++i,null==t||null==s||null==a||null==l)throw new o;const c=t<<2|s>>4;if(n.push(c),64!==a){const e=s<<4&240|a>>2;if(n.push(e),64!==l){const e=a<<6&192|l;n.push(e)}}}return n},init_(){if(!this.byteToCharMap_){this.byteToCharMap_={},this.charToByteMap_={},this.byteToCharMapWebSafe_={},this.charToByteMapWebSafe_={};for(let e=0;e<this.ENCODED_VALS.length;e++)this.byteToCharMap_[e]=this.ENCODED_VALS.charAt(e),this.charToByteMap_[this.byteToCharMap_[e]]=e,this.byteToCharMapWebSafe_[e]=this.ENCODED_VALS_WEBSAFE.charAt(e),this.charToByteMapWebSafe_[this.byteToCharMapWebSafe_[e]]=e,e>=this.ENCODED_VALS_BASE.length&&(this.charToByteMap_[this.ENCODED_VALS_WEBSAFE.charAt(e)]=e,this.charToByteMapWebSafe_[this.ENCODED_VALS.charAt(e)]=e)}}};class o extends Error{constructor(){super(...arguments),this.name="DecodeBase64StringError"}}const a=function(e){return function(e){const t=i(e);return s.encodeByteArray(t,!0)}(e).replace(/\./g,"")},l=function(e){try{return s.decodeString(e,!0)}catch(t){console.error("base64Decode failed: ",t)}return null};function c(){if("undefined"!==typeof self)return self;if("undefined"!==typeof window)return window;if("undefined"!==typeof r.g)return r.g;throw new Error("Unable to locate global object.")}const u=()=>{try{return c().__FIREBASE_DEFAULTS__||(()=>{if("undefined"===typeof process)return;const e={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.__FIREBASE_DEFAULTS__;return e?JSON.parse(e):void 0})()||(()=>{if("undefined"===typeof document)return;let e;try{e=document.cookie.match(/__FIREBASE_DEFAULTS__=([^;]+)/)}catch(r){return}const t=e&&l(e[1]);return t&&JSON.parse(t)})()}catch(e){return void console.info("Unable to get __FIREBASE_DEFAULTS__ due to: ".concat(e))}},d=e=>{const t=(e=>{var t;return null===(t=u())||void 0===t||null===(t=t.emulatorHosts)||void 0===t?void 0:t[e]})(e);if(!t)return;const r=t.lastIndexOf(":");if(r<=0||r+1===t.length)throw new Error("Invalid host ".concat(t," with no separate hostname and port!"));const n=parseInt(t.substring(r+1),10);return"["===t[0]?[t.substring(1,r-1),n]:[t.substring(0,r),n]},h=()=>{var e;return null===(e=u())||void 0===e?void 0:e.config};class p{constructor(){this.reject=()=>{},this.resolve=()=>{},this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}wrapCallback(e){return(t,r)=>{t?this.reject(t):this.resolve(r),"function"===typeof e&&(this.promise.catch(()=>{}),1===e.length?e(t):e(t,r))}}}function m(e){try{return(e.startsWith("http://")||e.startsWith("https://")?new URL(e).hostname:e).endsWith(".cloudworkstations.dev")}catch(t){return!1}}async function f(e){return(await fetch(e,{credentials:"include"})).ok}function g(e,t){if(e.uid)throw new Error('The "uid" field is no longer supported by mockUserToken. Please use "sub" instead for Firebase Auth User ID.');const r=t||"demo-project",i=e.iat||0,s=e.sub||e.user_id;if(!s)throw new Error("mockUserToken must contain 'sub' or 'user_id' field!");const o=(0,n.A)({iss:"https://securetoken.google.com/".concat(r),aud:r,iat:i,exp:i+3600,auth_time:i,sub:s,user_id:s,firebase:{sign_in_provider:"custom",identities:{}}},e);return[a(JSON.stringify({alg:"none",type:"JWT"})),a(JSON.stringify(o)),""].join(".")}const y={};let _=!1;function v(e,t){if("undefined"===typeof window||"undefined"===typeof document||!m(window.location.host)||y[e]===t||y[e]||_)return;function r(e){return"__firebase__banner__".concat(e)}y[e]=t;const n="__firebase__banner",i=function(){const e={prod:[],emulator:[]};for(const t of Object.keys(y))y[t]?e.emulator.push(t):e.prod.push(t);return e}().prod.length>0;function s(){const e=document.createElement("span");return e.style.cursor="pointer",e.style.marginLeft="16px",e.style.fontSize="24px",e.innerHTML=" &times;",e.onclick=()=>{_=!0,function(){const e=document.getElementById(n);e&&e.remove()}()},e}function o(){const e=function(e){let t=document.getElementById(e),r=!1;return t||(t=document.createElement("div"),t.setAttribute("id",e),r=!0),{created:r,element:t}}(n),t=r("text"),o=document.getElementById(t)||document.createElement("span"),a=r("learnmore"),l=document.getElementById(a)||document.createElement("a"),c=r("preprendIcon"),u=document.getElementById(c)||document.createElementNS("http://www.w3.org/2000/svg","svg");if(e.created){const t=e.element;!function(e){e.style.display="flex",e.style.background="#7faaf0",e.style.position="fixed",e.style.bottom="5px",e.style.left="5px",e.style.padding=".5em",e.style.borderRadius="5px",e.style.alignItems="center"}(t),function(e,t){e.setAttribute("id",t),e.innerText="Learn more",e.href="https://firebase.google.com/docs/studio/preview-apps#preview-backend",e.setAttribute("target","__blank"),e.style.paddingLeft="5px",e.style.textDecoration="underline"}(l,a);const r=s();!function(e,t){e.setAttribute("width","24"),e.setAttribute("id",t),e.setAttribute("height","24"),e.setAttribute("viewBox","0 0 24 24"),e.setAttribute("fill","none"),e.style.marginLeft="-6px"}(u,c),t.append(u,o,l,r),document.body.appendChild(t)}i?(o.innerText="Preview backend disconnected.",u.innerHTML='<g clip-path="url(#clip0_6013_33858)">\n<path d="M4.8 17.6L12 5.6L19.2 17.6H4.8ZM6.91667 16.4H17.0833L12 7.93333L6.91667 16.4ZM12 15.6C12.1667 15.6 12.3056 15.5444 12.4167 15.4333C12.5389 15.3111 12.6 15.1667 12.6 15C12.6 14.8333 12.5389 14.6944 12.4167 14.5833C12.3056 14.4611 12.1667 14.4 12 14.4C11.8333 14.4 11.6889 14.4611 11.5667 14.5833C11.4556 14.6944 11.4 14.8333 11.4 15C11.4 15.1667 11.4556 15.3111 11.5667 15.4333C11.6889 15.5444 11.8333 15.6 12 15.6ZM11.4 13.6H12.6V10.4H11.4V13.6Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6013_33858">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>'):(u.innerHTML='<g clip-path="url(#clip0_6083_34804)">\n<path d="M11.4 15.2H12.6V11.2H11.4V15.2ZM12 10C12.1667 10 12.3056 9.94444 12.4167 9.83333C12.5389 9.71111 12.6 9.56667 12.6 9.4C12.6 9.23333 12.5389 9.09444 12.4167 8.98333C12.3056 8.86111 12.1667 8.8 12 8.8C11.8333 8.8 11.6889 8.86111 11.5667 8.98333C11.4556 9.09444 11.4 9.23333 11.4 9.4C11.4 9.56667 11.4556 9.71111 11.5667 9.83333C11.6889 9.94444 11.8333 10 12 10ZM12 18.4C11.1222 18.4 10.2944 18.2333 9.51667 17.9C8.73889 17.5667 8.05556 17.1111 7.46667 16.5333C6.88889 15.9444 6.43333 15.2611 6.1 14.4833C5.76667 13.7056 5.6 12.8778 5.6 12C5.6 11.1111 5.76667 10.2833 6.1 9.51667C6.43333 8.73889 6.88889 8.06111 7.46667 7.48333C8.05556 6.89444 8.73889 6.43333 9.51667 6.1C10.2944 5.76667 11.1222 5.6 12 5.6C12.8889 5.6 13.7167 5.76667 14.4833 6.1C15.2611 6.43333 15.9389 6.89444 16.5167 7.48333C17.1056 8.06111 17.5667 8.73889 17.9 9.51667C18.2333 10.2833 18.4 11.1111 18.4 12C18.4 12.8778 18.2333 13.7056 17.9 14.4833C17.5667 15.2611 17.1056 15.9444 16.5167 16.5333C15.9389 17.1111 15.2611 17.5667 14.4833 17.9C13.7167 18.2333 12.8889 18.4 12 18.4ZM12 17.2C13.4444 17.2 14.6722 16.6944 15.6833 15.6833C16.6944 14.6722 17.2 13.4444 17.2 12C17.2 10.5556 16.6944 9.32778 15.6833 8.31667C14.6722 7.30555 13.4444 6.8 12 6.8C10.5556 6.8 9.32778 7.30555 8.31667 8.31667C7.30556 9.32778 6.8 10.5556 6.8 12C6.8 13.4444 7.30556 14.6722 8.31667 15.6833C9.32778 16.6944 10.5556 17.2 12 17.2Z" fill="#212121"/>\n</g>\n<defs>\n<clipPath id="clip0_6083_34804">\n<rect width="24" height="24" fill="white"/>\n</clipPath>\n</defs>',o.innerText="Preview backend running in this workspace."),o.setAttribute("id",t)}"loading"===document.readyState?window.addEventListener("DOMContentLoaded",o):o()}function x(){return"undefined"!==typeof navigator&&"string"===typeof navigator.userAgent?navigator.userAgent:""}function b(){var e;const t=null===(e=u())||void 0===e?void 0:e.forceEnvironment;if("node"===t)return!0;if("browser"===t)return!1;try{return"[object process]"===Object.prototype.toString.call(r.g.process)}catch(n){return!1}}function w(){return!b()&&!!navigator.userAgent&&navigator.userAgent.includes("Safari")&&!navigator.userAgent.includes("Chrome")}function j(){try{return"object"===typeof indexedDB}catch(e){return!1}}class S extends Error{constructor(e,t,r){super(t),this.code=e,this.customData=r,this.name="FirebaseError",Object.setPrototypeOf(this,S.prototype),Error.captureStackTrace&&Error.captureStackTrace(this,T.prototype.create)}}class T{constructor(e,t,r){this.service=e,this.serviceName=t,this.errors=r}create(e){const t=(arguments.length<=1?void 0:arguments[1])||{},r="".concat(this.service,"/").concat(e),n=this.errors[e],i=n?function(e,t){return e.replace(k,(e,r)=>{const n=t[r];return null!=n?String(n):"<".concat(r,"?>")})}(n,t):"Error",s="".concat(this.serviceName,": ").concat(i," (").concat(r,").");return new S(r,s,t)}}const k=/\{\$([^}]+)}/g;function A(e,t){if(e===t)return!0;const r=Object.keys(e),n=Object.keys(t);for(const i of r){if(!n.includes(i))return!1;const r=e[i],s=t[i];if(C(r)&&C(s)){if(!A(r,s))return!1}else if(r!==s)return!1}for(const i of n)if(!r.includes(i))return!1;return!0}function C(e){return null!==e&&"object"===typeof e}function E(e){return e&&e._delegate?e._delegate:e}class N{constructor(e,t,r){this.name=e,this.instanceFactory=t,this.type=r,this.multipleInstances=!1,this.serviceProps={},this.instantiationMode="LAZY",this.onInstanceCreated=null}setInstantiationMode(e){return this.instantiationMode=e,this}setMultipleInstances(e){return this.multipleInstances=e,this}setServiceProps(e){return this.serviceProps=e,this}setInstanceCreatedCallback(e){return this.onInstanceCreated=e,this}}const I="[DEFAULT]";class P{constructor(e,t){this.name=e,this.container=t,this.component=null,this.instances=new Map,this.instancesDeferred=new Map,this.instancesOptions=new Map,this.onInitCallbacks=new Map}get(e){const t=this.normalizeInstanceIdentifier(e);if(!this.instancesDeferred.has(t)){const e=new p;if(this.instancesDeferred.set(t,e),this.isInitialized(t)||this.shouldAutoInitialize())try{const r=this.getOrInitializeService({instanceIdentifier:t});r&&e.resolve(r)}catch(r){}}return this.instancesDeferred.get(t).promise}getImmediate(e){var t;const r=this.normalizeInstanceIdentifier(null===e||void 0===e?void 0:e.identifier),n=null!==(t=null===e||void 0===e?void 0:e.optional)&&void 0!==t&&t;if(!this.isInitialized(r)&&!this.shouldAutoInitialize()){if(n)return null;throw Error("Service ".concat(this.name," is not available"))}try{return this.getOrInitializeService({instanceIdentifier:r})}catch(i){if(n)return null;throw i}}getComponent(){return this.component}setComponent(e){if(e.name!==this.name)throw Error("Mismatching Component ".concat(e.name," for Provider ").concat(this.name,"."));if(this.component)throw Error("Component for ".concat(this.name," has already been provided"));if(this.component=e,this.shouldAutoInitialize()){if(function(e){return"EAGER"===e.instantiationMode}(e))try{this.getOrInitializeService({instanceIdentifier:I})}catch(t){}for(const[e,r]of this.instancesDeferred.entries()){const n=this.normalizeInstanceIdentifier(e);try{const e=this.getOrInitializeService({instanceIdentifier:n});r.resolve(e)}catch(t){}}}}clearInstance(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;this.instancesDeferred.delete(e),this.instancesOptions.delete(e),this.instances.delete(e)}async delete(){const e=Array.from(this.instances.values());await Promise.all([...e.filter(e=>"INTERNAL"in e).map(e=>e.INTERNAL.delete()),...e.filter(e=>"_delete"in e).map(e=>e._delete())])}isComponentSet(){return null!=this.component}isInitialized(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return this.instances.has(e)}getOptions(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return this.instancesOptions.get(e)||{}}initialize(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};const{options:t={}}=e,r=this.normalizeInstanceIdentifier(e.instanceIdentifier);if(this.isInitialized(r))throw Error("".concat(this.name,"(").concat(r,") has already been initialized"));if(!this.isComponentSet())throw Error("Component ".concat(this.name," has not been registered yet"));const n=this.getOrInitializeService({instanceIdentifier:r,options:t});for(const[i,s]of this.instancesDeferred.entries()){r===this.normalizeInstanceIdentifier(i)&&s.resolve(n)}return n}onInit(e,t){var r;const n=this.normalizeInstanceIdentifier(t),i=null!==(r=this.onInitCallbacks.get(n))&&void 0!==r?r:new Set;i.add(e),this.onInitCallbacks.set(n,i);const s=this.instances.get(n);return s&&e(s,n),()=>{i.delete(e)}}invokeOnInitCallbacks(e,t){const r=this.onInitCallbacks.get(t);if(r)for(const i of r)try{i(e,t)}catch(n){}}getOrInitializeService(e){let{instanceIdentifier:t,options:r={}}=e,n=this.instances.get(t);if(!n&&this.component&&(n=this.component.instanceFactory(this.container,{instanceIdentifier:(i=t,i===I?void 0:i),options:r}),this.instances.set(t,n),this.instancesOptions.set(t,r),this.invokeOnInitCallbacks(n,t),this.component.onInstanceCreated))try{this.component.onInstanceCreated(this.container,t,n)}catch(s){}var i;return n||null}normalizeInstanceIdentifier(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:I;return this.component?this.component.multipleInstances?e:I:e}shouldAutoInitialize(){return!!this.component&&"EXPLICIT"!==this.component.instantiationMode}}class M{constructor(e){this.name=e,this.providers=new Map}addComponent(e){const t=this.getProvider(e.name);if(t.isComponentSet())throw new Error("Component ".concat(e.name," has already been registered with ").concat(this.name));t.setComponent(e)}addOrOverwriteComponent(e){this.getProvider(e.name).isComponentSet()&&this.providers.delete(e.name),this.addComponent(e)}getProvider(e){if(this.providers.has(e))return this.providers.get(e);const t=new P(e,this);return this.providers.set(e,t),t}getProviders(){return Array.from(this.providers.values())}}const L=[];var R;!function(e){e[e.DEBUG=0]="DEBUG",e[e.VERBOSE=1]="VERBOSE",e[e.INFO=2]="INFO",e[e.WARN=3]="WARN",e[e.ERROR=4]="ERROR",e[e.SILENT=5]="SILENT"}(R||(R={}));const D={debug:R.DEBUG,verbose:R.VERBOSE,info:R.INFO,warn:R.WARN,error:R.ERROR,silent:R.SILENT},F=R.INFO,O={[R.DEBUG]:"log",[R.VERBOSE]:"log",[R.INFO]:"info",[R.WARN]:"warn",[R.ERROR]:"error"},z=function(e,t){if(t<e.logLevel)return;const r=(new Date).toISOString(),n=O[t];if(!n)throw new Error("Attempted to log a message with an invalid logType (value: ".concat(t,")"));for(var i=arguments.length,s=new Array(i>2?i-2:0),o=2;o<i;o++)s[o-2]=arguments[o];console[n]("[".concat(r,"]  ").concat(e.name,":"),...s)};class B{constructor(e){this.name=e,this._logLevel=F,this._logHandler=z,this._userLogHandler=null,L.push(this)}get logLevel(){return this._logLevel}set logLevel(e){if(!(e in R))throw new TypeError('Invalid value "'.concat(e,'" assigned to `logLevel`'));this._logLevel=e}setLogLevel(e){this._logLevel="string"===typeof e?D[e]:e}get logHandler(){return this._logHandler}set logHandler(e){if("function"!==typeof e)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=e}get userLogHandler(){return this._userLogHandler}set userLogHandler(e){this._userLogHandler=e}debug(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._userLogHandler&&this._userLogHandler(this,R.DEBUG,...t),this._logHandler(this,R.DEBUG,...t)}log(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._userLogHandler&&this._userLogHandler(this,R.VERBOSE,...t),this._logHandler(this,R.VERBOSE,...t)}info(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._userLogHandler&&this._userLogHandler(this,R.INFO,...t),this._logHandler(this,R.INFO,...t)}warn(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._userLogHandler&&this._userLogHandler(this,R.WARN,...t),this._logHandler(this,R.WARN,...t)}error(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];this._userLogHandler&&this._userLogHandler(this,R.ERROR,...t),this._logHandler(this,R.ERROR,...t)}}let U,V;const q=new WeakMap,W=new WeakMap,H=new WeakMap,G=new WeakMap,Z=new WeakMap;let K={get(e,t,r){if(e instanceof IDBTransaction){if("done"===t)return W.get(e);if("objectStoreNames"===t)return e.objectStoreNames||H.get(e);if("store"===t)return r.objectStoreNames[1]?void 0:r.objectStore(r.objectStoreNames[0])}return J(e[t])},set:(e,t,r)=>(e[t]=r,!0),has:(e,t)=>e instanceof IDBTransaction&&("done"===t||"store"===t)||t in e};function Y(e){return e!==IDBDatabase.prototype.transaction||"objectStoreNames"in IDBTransaction.prototype?(V||(V=[IDBCursor.prototype.advance,IDBCursor.prototype.continue,IDBCursor.prototype.continuePrimaryKey])).includes(e)?function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return e.apply(Q(this),r),J(q.get(this))}:function(){for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];return J(e.apply(Q(this),r))}:function(t){for(var r=arguments.length,n=new Array(r>1?r-1:0),i=1;i<r;i++)n[i-1]=arguments[i];const s=e.call(Q(this),t,...n);return H.set(s,t.sort?t.sort():[t]),J(s)}}function X(e){return"function"===typeof e?Y(e):(e instanceof IDBTransaction&&function(e){if(W.has(e))return;const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("complete",i),e.removeEventListener("error",s),e.removeEventListener("abort",s)},i=()=>{t(),n()},s=()=>{r(e.error||new DOMException("AbortError","AbortError")),n()};e.addEventListener("complete",i),e.addEventListener("error",s),e.addEventListener("abort",s)});W.set(e,t)}(e),t=e,(U||(U=[IDBDatabase,IDBObjectStore,IDBIndex,IDBCursor,IDBTransaction])).some(e=>t instanceof e)?new Proxy(e,K):e);var t}function J(e){if(e instanceof IDBRequest)return function(e){const t=new Promise((t,r)=>{const n=()=>{e.removeEventListener("success",i),e.removeEventListener("error",s)},i=()=>{t(J(e.result)),n()},s=()=>{r(e.error),n()};e.addEventListener("success",i),e.addEventListener("error",s)});return t.then(t=>{t instanceof IDBCursor&&q.set(t,e)}).catch(()=>{}),Z.set(t,e),t}(e);if(G.has(e))return G.get(e);const t=X(e);return t!==e&&(G.set(e,t),Z.set(t,e)),t}const Q=e=>Z.get(e);const $=["get","getKey","getAll","getAllKeys","count"],ee=["put","add","delete","clear"],te=new Map;function re(e,t){if(!(e instanceof IDBDatabase)||t in e||"string"!==typeof t)return;if(te.get(t))return te.get(t);const r=t.replace(/FromIndex$/,""),n=t!==r,i=ee.includes(r);if(!(r in(n?IDBIndex:IDBObjectStore).prototype)||!i&&!$.includes(r))return;const s=async function(e){const t=this.transaction(e,i?"readwrite":"readonly");let s=t.store;for(var o=arguments.length,a=new Array(o>1?o-1:0),l=1;l<o;l++)a[l-1]=arguments[l];return n&&(s=s.index(a.shift())),(await Promise.all([s[r](...a),i&&t.done]))[0]};return te.set(t,s),s}K=(e=>(0,n.A)((0,n.A)({},e),{},{get:(t,r,n)=>re(t,r)||e.get(t,r,n),has:(t,r)=>!!re(t,r)||e.has(t,r)}))(K);class ne{constructor(e){this.container=e}getPlatformInfoString(){return this.container.getProviders().map(e=>{if(function(e){const t=e.getComponent();return"VERSION"===(null===t||void 0===t?void 0:t.type)}(e)){const t=e.getImmediate();return"".concat(t.library,"/").concat(t.version)}return null}).filter(e=>e).join(" ")}}const ie="@firebase/app",se="0.14.6",oe=new B("@firebase/app"),ae="@firebase/app-compat",le="@firebase/analytics-compat",ce="@firebase/analytics",ue="@firebase/app-check-compat",de="@firebase/app-check",he="@firebase/auth",pe="@firebase/auth-compat",me="@firebase/database",fe="@firebase/data-connect",ge="@firebase/database-compat",ye="@firebase/functions",_e="@firebase/functions-compat",ve="@firebase/installations",xe="@firebase/installations-compat",be="@firebase/messaging",we="@firebase/messaging-compat",je="@firebase/performance",Se="@firebase/performance-compat",Te="@firebase/remote-config",ke="@firebase/remote-config-compat",Ae="@firebase/storage",Ce="@firebase/storage-compat",Ee="@firebase/firestore",Ne="@firebase/ai",Ie="@firebase/firestore-compat",Pe="firebase",Me="[DEFAULT]",Le={[ie]:"fire-core",[ae]:"fire-core-compat",[ce]:"fire-analytics",[le]:"fire-analytics-compat",[de]:"fire-app-check",[ue]:"fire-app-check-compat",[he]:"fire-auth",[pe]:"fire-auth-compat",[me]:"fire-rtdb",[fe]:"fire-data-connect",[ge]:"fire-rtdb-compat",[ye]:"fire-fn",[_e]:"fire-fn-compat",[ve]:"fire-iid",[xe]:"fire-iid-compat",[be]:"fire-fcm",[we]:"fire-fcm-compat",[je]:"fire-perf",[Se]:"fire-perf-compat",[Te]:"fire-rc",[ke]:"fire-rc-compat",[Ae]:"fire-gcs",[Ce]:"fire-gcs-compat",[Ee]:"fire-fst",[Ie]:"fire-fst-compat",[Ne]:"fire-vertex","fire-js":"fire-js",[Pe]:"fire-js-all"},Re=new Map,De=new Map,Fe=new Map;function Oe(e,t){try{e.container.addComponent(t)}catch(r){oe.debug("Component ".concat(t.name," failed to register with FirebaseApp ").concat(e.name),r)}}function ze(e){const t=e.name;if(Fe.has(t))return oe.debug("There were multiple attempts to register component ".concat(t,".")),!1;Fe.set(t,e);for(const r of Re.values())Oe(r,e);for(const r of De.values())Oe(r,e);return!0}function Be(e,t){const r=e.container.getProvider("heartbeat").getImmediate({optional:!0});return r&&r.triggerHeartbeat(),e.container.getProvider(t)}function Ue(e){return null!==e&&void 0!==e&&void 0!==e.settings}const Ve=new T("app","Firebase",{"no-app":"No Firebase App '{$appName}' has been created - call initializeApp() first","bad-app-name":"Illegal App name: '{$appName}'","duplicate-app":"Firebase App named '{$appName}' already exists with different options or config","app-deleted":"Firebase App named '{$appName}' already deleted","server-app-deleted":"Firebase Server App has been deleted","no-options":"Need to provide options, when not being deployed to hosting via source.","invalid-app-argument":"firebase.{$appName}() takes either no argument or a Firebase App instance.","invalid-log-argument":"First argument to `onLog` must be null or a function.","idb-open":"Error thrown when opening IndexedDB. Original error: {$originalErrorMessage}.","idb-get":"Error thrown when reading from IndexedDB. Original error: {$originalErrorMessage}.","idb-set":"Error thrown when writing to IndexedDB. Original error: {$originalErrorMessage}.","idb-delete":"Error thrown when deleting from IndexedDB. Original error: {$originalErrorMessage}.","finalization-registry-not-supported":"FirebaseServerApp deleteOnDeref field defined but the JS runtime does not support FinalizationRegistry.","invalid-server-app-environment":"FirebaseServerApp is not for use in browser environments."});class qe{constructor(e,t,r){this._isDeleted=!1,this._options=(0,n.A)({},e),this._config=(0,n.A)({},t),this._name=t.name,this._automaticDataCollectionEnabled=t.automaticDataCollectionEnabled,this._container=r,this.container.addComponent(new N("app",()=>this,"PUBLIC"))}get automaticDataCollectionEnabled(){return this.checkDestroyed(),this._automaticDataCollectionEnabled}set automaticDataCollectionEnabled(e){this.checkDestroyed(),this._automaticDataCollectionEnabled=e}get name(){return this.checkDestroyed(),this._name}get options(){return this.checkDestroyed(),this._options}get config(){return this.checkDestroyed(),this._config}get container(){return this._container}get isDeleted(){return this._isDeleted}set isDeleted(e){this._isDeleted=e}checkDestroyed(){if(this.isDeleted)throw Ve.create("app-deleted",{appName:this._name})}}const We="12.6.0";function He(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=e;if("object"!==typeof t){t={name:t}}const i=(0,n.A)({name:Me,automaticDataCollectionEnabled:!0},t),s=i.name;if("string"!==typeof s||!s)throw Ve.create("bad-app-name",{appName:String(s)});if(r||(r=h()),!r)throw Ve.create("no-options");const o=Re.get(s);if(o){if(A(r,o.options)&&A(i,o.config))return o;throw Ve.create("duplicate-app",{appName:s})}const a=new M(s);for(const n of Fe.values())a.addComponent(n);const l=new qe(r,i,a);return Re.set(s,l),l}function Ge(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Me;const t=Re.get(e);if(!t&&e===Me&&h())return He();if(!t)throw Ve.create("no-app",{appName:e});return t}function Ze(e,t,r){var n;let i=null!==(n=Le[e])&&void 0!==n?n:e;r&&(i+="-".concat(r));const s=i.match(/\s|\//),o=t.match(/\s|\//);if(s||o){const e=['Unable to register library "'.concat(i,'" with version "').concat(t,'":')];return s&&e.push('library name "'.concat(i,'" contains illegal characters (whitespace or "/")')),s&&o&&e.push("and"),o&&e.push('version name "'.concat(t,'" contains illegal characters (whitespace or "/")')),void oe.warn(e.join(" "))}ze(new N("".concat(i,"-version"),()=>({library:i,version:t}),"VERSION"))}const Ke="firebase-heartbeat-store";let Ye=null;function Xe(){return Ye||(Ye=function(e,t){let{blocked:r,upgrade:n,blocking:i,terminated:s}=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const o=indexedDB.open(e,t),a=J(o);return n&&o.addEventListener("upgradeneeded",e=>{n(J(o.result),e.oldVersion,e.newVersion,J(o.transaction),e)}),r&&o.addEventListener("blocked",e=>r(e.oldVersion,e.newVersion,e)),a.then(e=>{s&&e.addEventListener("close",()=>s()),i&&e.addEventListener("versionchange",e=>i(e.oldVersion,e.newVersion,e))}).catch(()=>{}),a}("firebase-heartbeat-database",1,{upgrade:(e,t)=>{if(0===t)try{e.createObjectStore(Ke)}catch(r){console.warn(r)}}}).catch(e=>{throw Ve.create("idb-open",{originalErrorMessage:e.message})})),Ye}async function Je(e,t){try{const r=(await Xe()).transaction(Ke,"readwrite"),n=r.objectStore(Ke);await n.put(t,Qe(e)),await r.done}catch(r){if(r instanceof S)oe.warn(r.message);else{const e=Ve.create("idb-set",{originalErrorMessage:null===r||void 0===r?void 0:r.message});oe.warn(e.message)}}}function Qe(e){return"".concat(e.name,"!").concat(e.options.appId)}class $e{constructor(e){this.container=e,this._heartbeatsCache=null;const t=this.container.getProvider("app").getImmediate();this._storage=new tt(t),this._heartbeatsCachePromise=this._storage.read().then(e=>(this._heartbeatsCache=e,e))}async triggerHeartbeat(){try{var e;const r=this.container.getProvider("platform-logger").getImmediate().getPlatformInfoString(),n=et();var t;if(null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats))if(this._heartbeatsCache=await this._heartbeatsCachePromise,null==(null===(t=this._heartbeatsCache)||void 0===t?void 0:t.heartbeats))return;if(this._heartbeatsCache.lastSentHeartbeatDate===n||this._heartbeatsCache.heartbeats.some(e=>e.date===n))return;if(this._heartbeatsCache.heartbeats.push({date:n,agent:r}),this._heartbeatsCache.heartbeats.length>30){const e=function(e){if(0===e.length)return-1;let t=0,r=e[0].date;for(let n=1;n<e.length;n++)e[n].date<r&&(r=e[n].date,t=n);return t}(this._heartbeatsCache.heartbeats);this._heartbeatsCache.heartbeats.splice(e,1)}return this._storage.overwrite(this._heartbeatsCache)}catch(r){oe.warn(r)}}async getHeartbeatsHeader(){try{var e;if(null===this._heartbeatsCache&&await this._heartbeatsCachePromise,null==(null===(e=this._heartbeatsCache)||void 0===e?void 0:e.heartbeats)||0===this._heartbeatsCache.heartbeats.length)return"";const t=et(),{heartbeatsToSend:r,unsentEntries:n}=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1024;const r=[];let n=e.slice();for(const i of e){const e=r.find(e=>e.agent===i.agent);if(e){if(e.dates.push(i.date),rt(r)>t){e.dates.pop();break}}else if(r.push({agent:i.agent,dates:[i.date]}),rt(r)>t){r.pop();break}n=n.slice(1)}return{heartbeatsToSend:r,unsentEntries:n}}(this._heartbeatsCache.heartbeats),i=a(JSON.stringify({version:2,heartbeats:r}));return this._heartbeatsCache.lastSentHeartbeatDate=t,n.length>0?(this._heartbeatsCache.heartbeats=n,await this._storage.overwrite(this._heartbeatsCache)):(this._heartbeatsCache.heartbeats=[],this._storage.overwrite(this._heartbeatsCache)),i}catch(t){return oe.warn(t),""}}}function et(){return(new Date).toISOString().substring(0,10)}class tt{constructor(e){this.app=e,this._canUseIndexedDBPromise=this.runIndexedDBEnvironmentCheck()}async runIndexedDBEnvironmentCheck(){return!!j()&&new Promise((e,t)=>{try{let r=!0;const n="validate-browser-context-for-indexeddb-analytics-module",i=self.indexedDB.open(n);i.onsuccess=()=>{i.result.close(),r||self.indexedDB.deleteDatabase(n),e(!0)},i.onupgradeneeded=()=>{r=!1},i.onerror=()=>{var e;t((null===(e=i.error)||void 0===e?void 0:e.message)||"")}}catch(r){t(r)}}).then(()=>!0).catch(()=>!1)}async read(){if(await this._canUseIndexedDBPromise){const e=await async function(e){try{const t=(await Xe()).transaction(Ke),r=await t.objectStore(Ke).get(Qe(e));return await t.done,r}catch(t){if(t instanceof S)oe.warn(t.message);else{const e=Ve.create("idb-get",{originalErrorMessage:null===t||void 0===t?void 0:t.message});oe.warn(e.message)}}}(this.app);return null!==e&&void 0!==e&&e.heartbeats?e:{heartbeats:[]}}return{heartbeats:[]}}async overwrite(e){if(await this._canUseIndexedDBPromise){var t;const r=await this.read();return Je(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:e.heartbeats})}}async add(e){if(await this._canUseIndexedDBPromise){var t;const r=await this.read();return Je(this.app,{lastSentHeartbeatDate:null!==(t=e.lastSentHeartbeatDate)&&void 0!==t?t:r.lastSentHeartbeatDate,heartbeats:[...r.heartbeats,...e.heartbeats]})}}}function rt(e){return a(JSON.stringify({version:2,heartbeats:e})).length}var nt;nt="",ze(new N("platform-logger",e=>new ne(e),"PRIVATE")),ze(new N("heartbeat",e=>new $e(e),"PRIVATE")),Ze(ie,se,nt),Ze(ie,se,"esm2020"),Ze("fire-js","");Ze("firebase","12.7.0","app");var it,st,ot="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:"undefined"!==typeof self?self:{},at={};(function(){var e;function t(){this.blockSize=-1,this.blockSize=64,this.g=Array(4),this.C=Array(this.blockSize),this.o=this.h=0,this.u()}function r(e,t,r){r||(r=0);const n=Array(16);if("string"===typeof t)for(var i=0;i<16;++i)n[i]=t.charCodeAt(r++)|t.charCodeAt(r++)<<8|t.charCodeAt(r++)<<16|t.charCodeAt(r++)<<24;else for(i=0;i<16;++i)n[i]=t[r++]|t[r++]<<8|t[r++]<<16|t[r++]<<24;t=e.g[0],r=e.g[1],i=e.g[2];let s,o=e.g[3];s=t+(o^r&(i^o))+n[0]+3614090360&4294967295,s=o+(i^(t=r+(s<<7&4294967295|s>>>25))&(r^i))+n[1]+3905402710&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(r^o&(t^r))+n[2]+606105819&4294967295,s=r+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+n[3]+3250441966&4294967295,s=t+(o^(r=i+(s<<22&4294967295|s>>>10))&(i^o))+n[4]+4118548399&4294967295,s=o+(i^(t=r+(s<<7&4294967295|s>>>25))&(r^i))+n[5]+1200080426&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(r^o&(t^r))+n[6]+2821735955&4294967295,s=r+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+n[7]+4249261313&4294967295,s=t+(o^(r=i+(s<<22&4294967295|s>>>10))&(i^o))+n[8]+1770035416&4294967295,s=o+(i^(t=r+(s<<7&4294967295|s>>>25))&(r^i))+n[9]+2336552879&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(r^o&(t^r))+n[10]+4294925233&4294967295,s=r+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+n[11]+2304563134&4294967295,s=t+(o^(r=i+(s<<22&4294967295|s>>>10))&(i^o))+n[12]+1804603682&4294967295,s=o+(i^(t=r+(s<<7&4294967295|s>>>25))&(r^i))+n[13]+4254626195&4294967295,o=t+(s<<12&4294967295|s>>>20),s=i+(r^o&(t^r))+n[14]+2792965006&4294967295,s=r+(t^(i=o+(s<<17&4294967295|s>>>15))&(o^t))+n[15]+1236535329&4294967295,s=t+(i^o&((r=i+(s<<22&4294967295|s>>>10))^i))+n[1]+4129170786&4294967295,s=o+(r^i&((t=r+(s<<5&4294967295|s>>>27))^r))+n[6]+3225465664&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^r&(o^t))+n[11]+643717713&4294967295,s=r+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+n[0]+3921069994&4294967295,s=t+(i^o&((r=i+(s<<20&4294967295|s>>>12))^i))+n[5]+3593408605&4294967295,s=o+(r^i&((t=r+(s<<5&4294967295|s>>>27))^r))+n[10]+38016083&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^r&(o^t))+n[15]+3634488961&4294967295,s=r+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+n[4]+3889429448&4294967295,s=t+(i^o&((r=i+(s<<20&4294967295|s>>>12))^i))+n[9]+568446438&4294967295,s=o+(r^i&((t=r+(s<<5&4294967295|s>>>27))^r))+n[14]+3275163606&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^r&(o^t))+n[3]+4107603335&4294967295,s=r+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+n[8]+1163531501&4294967295,s=t+(i^o&((r=i+(s<<20&4294967295|s>>>12))^i))+n[13]+2850285829&4294967295,s=o+(r^i&((t=r+(s<<5&4294967295|s>>>27))^r))+n[2]+4243563512&4294967295,o=t+(s<<9&4294967295|s>>>23),s=i+(t^r&(o^t))+n[7]+1735328473&4294967295,s=r+(o^t&((i=o+(s<<14&4294967295|s>>>18))^o))+n[12]+2368359562&4294967295,s=t+((r=i+(s<<20&4294967295|s>>>12))^i^o)+n[5]+4294588738&4294967295,s=o+((t=r+(s<<4&4294967295|s>>>28))^r^i)+n[8]+2272392833&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^r)+n[11]+1839030562&4294967295,s=r+((i=o+(s<<16&4294967295|s>>>16))^o^t)+n[14]+4259657740&4294967295,s=t+((r=i+(s<<23&4294967295|s>>>9))^i^o)+n[1]+2763975236&4294967295,s=o+((t=r+(s<<4&4294967295|s>>>28))^r^i)+n[4]+1272893353&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^r)+n[7]+4139469664&4294967295,s=r+((i=o+(s<<16&4294967295|s>>>16))^o^t)+n[10]+3200236656&4294967295,s=t+((r=i+(s<<23&4294967295|s>>>9))^i^o)+n[13]+681279174&4294967295,s=o+((t=r+(s<<4&4294967295|s>>>28))^r^i)+n[0]+3936430074&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^r)+n[3]+3572445317&4294967295,s=r+((i=o+(s<<16&4294967295|s>>>16))^o^t)+n[6]+76029189&4294967295,s=t+((r=i+(s<<23&4294967295|s>>>9))^i^o)+n[9]+3654602809&4294967295,s=o+((t=r+(s<<4&4294967295|s>>>28))^r^i)+n[12]+3873151461&4294967295,o=t+(s<<11&4294967295|s>>>21),s=i+(o^t^r)+n[15]+530742520&4294967295,s=r+((i=o+(s<<16&4294967295|s>>>16))^o^t)+n[2]+3299628645&4294967295,s=t+(i^((r=i+(s<<23&4294967295|s>>>9))|~o))+n[0]+4096336452&4294967295,s=o+(r^((t=r+(s<<6&4294967295|s>>>26))|~i))+n[7]+1126891415&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~r))+n[14]+2878612391&4294967295,s=r+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+n[5]+4237533241&4294967295,s=t+(i^((r=i+(s<<21&4294967295|s>>>11))|~o))+n[12]+1700485571&4294967295,s=o+(r^((t=r+(s<<6&4294967295|s>>>26))|~i))+n[3]+2399980690&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~r))+n[10]+4293915773&4294967295,s=r+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+n[1]+2240044497&4294967295,s=t+(i^((r=i+(s<<21&4294967295|s>>>11))|~o))+n[8]+1873313359&4294967295,s=o+(r^((t=r+(s<<6&4294967295|s>>>26))|~i))+n[15]+4264355552&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~r))+n[6]+2734768916&4294967295,s=r+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+n[13]+1309151649&4294967295,s=t+(i^((r=i+(s<<21&4294967295|s>>>11))|~o))+n[4]+4149444226&4294967295,s=o+(r^((t=r+(s<<6&4294967295|s>>>26))|~i))+n[11]+3174756917&4294967295,o=t+(s<<10&4294967295|s>>>22),s=i+(t^(o|~r))+n[2]+718787259&4294967295,s=r+(o^((i=o+(s<<15&4294967295|s>>>17))|~t))+n[9]+3951481745&4294967295,e.g[0]=e.g[0]+t&4294967295,e.g[1]=e.g[1]+(i+(s<<21&4294967295|s>>>11))&4294967295,e.g[2]=e.g[2]+i&4294967295,e.g[3]=e.g[3]+o&4294967295}function n(e,t){this.h=t;const r=[];let n=!0;for(let i=e.length-1;i>=0;i--){const s=0|e[i];n&&s==t||(r[i]=s,n=!1)}this.g=r}!function(e,t){function r(){}r.prototype=t.prototype,e.F=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.D=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}(t,function(){this.blockSize=-1}),t.prototype.u=function(){this.g[0]=1732584193,this.g[1]=4023233417,this.g[2]=2562383102,this.g[3]=271733878,this.o=this.h=0},t.prototype.v=function(e,t){void 0===t&&(t=e.length);const n=t-this.blockSize,i=this.C;let s=this.h,o=0;for(;o<t;){if(0==s)for(;o<=n;)r(this,e,o),o+=this.blockSize;if("string"===typeof e){for(;o<t;)if(i[s++]=e.charCodeAt(o++),s==this.blockSize){r(this,i),s=0;break}}else for(;o<t;)if(i[s++]=e[o++],s==this.blockSize){r(this,i),s=0;break}}this.h=s,this.o+=t},t.prototype.A=function(){var e=Array((this.h<56?this.blockSize:2*this.blockSize)-this.h);e[0]=128;for(var t=1;t<e.length-8;++t)e[t]=0;t=8*this.o;for(var r=e.length-8;r<e.length;++r)e[r]=255&t,t/=256;for(this.v(e),e=Array(16),t=0,r=0;r<4;++r)for(let n=0;n<32;n+=8)e[t++]=this.g[r]>>>n&255;return e};var i={};function s(e){return-128<=e&&e<128?function(e,t){var r=i;return Object.prototype.hasOwnProperty.call(r,e)?r[e]:r[e]=t(e)}(e,function(e){return new n([0|e],e<0?-1:0)}):new n([0|e],e<0?-1:0)}function o(e){if(isNaN(e)||!isFinite(e))return a;if(e<0)return h(o(-e));const t=[];let r=1;for(let n=0;e>=r;n++)t[n]=e/r|0,r*=4294967296;return new n(t,0)}var a=s(0),l=s(1),c=s(16777216);function u(e){if(0!=e.h)return!1;for(let t=0;t<e.g.length;t++)if(0!=e.g[t])return!1;return!0}function d(e){return-1==e.h}function h(e){const t=e.g.length,r=[];for(let n=0;n<t;n++)r[n]=~e.g[n];return new n(r,~e.h).add(l)}function p(e,t){return e.add(h(t))}function m(e,t){for(;(65535&e[t])!=e[t];)e[t+1]+=e[t]>>>16,e[t]&=65535,t++}function f(e,t){this.g=e,this.h=t}function g(e,t){if(u(t))throw Error("division by zero");if(u(e))return new f(a,a);if(d(e))return t=g(h(e),t),new f(h(t.g),h(t.h));if(d(t))return t=g(e,h(t)),new f(h(t.g),t.h);if(e.g.length>30){if(d(e)||d(t))throw Error("slowDivide_ only works with positive integers.");for(var r=l,n=t;n.l(e)<=0;)r=y(r),n=y(n);var i=_(r,1),s=_(n,1);for(n=_(n,2),r=_(r,2);!u(n);){var c=s.add(n);c.l(e)<=0&&(i=i.add(r),s=c),n=_(n,1),r=_(r,1)}return t=p(e,i.j(t)),new f(i,t)}for(i=a;e.l(t)>=0;){for(r=Math.max(1,Math.floor(e.m()/t.m())),n=(n=Math.ceil(Math.log(r)/Math.LN2))<=48?1:Math.pow(2,n-48),c=(s=o(r)).j(t);d(c)||c.l(e)>0;)c=(s=o(r-=n)).j(t);u(s)&&(s=l),i=i.add(s),e=p(e,c)}return new f(i,e)}function y(e){const t=e.g.length+1,r=[];for(let n=0;n<t;n++)r[n]=e.i(n)<<1|e.i(n-1)>>>31;return new n(r,e.h)}function _(e,t){const r=t>>5;t%=32;const i=e.g.length-r,s=[];for(let n=0;n<i;n++)s[n]=t>0?e.i(n+r)>>>t|e.i(n+r+1)<<32-t:e.i(n+r);return new n(s,e.h)}(e=n.prototype).m=function(){if(d(this))return-h(this).m();let e=0,t=1;for(let r=0;r<this.g.length;r++){const n=this.i(r);e+=(n>=0?n:4294967296+n)*t,t*=4294967296}return e},e.toString=function(e){if((e=e||10)<2||36<e)throw Error("radix out of range: "+e);if(u(this))return"0";if(d(this))return"-"+h(this).toString(e);const t=o(Math.pow(e,6));var r=this;let n="";for(;;){const i=g(r,t).g;let s=(((r=p(r,i.j(t))).g.length>0?r.g[0]:r.h)>>>0).toString(e);if(u(r=i))return s+n;for(;s.length<6;)s="0"+s;n=s+n}},e.i=function(e){return e<0?0:e<this.g.length?this.g[e]:this.h},e.l=function(e){return d(e=p(this,e))?-1:u(e)?0:1},e.abs=function(){return d(this)?h(this):this},e.add=function(e){const t=Math.max(this.g.length,e.g.length),r=[];let i=0;for(let n=0;n<=t;n++){let t=i+(65535&this.i(n))+(65535&e.i(n)),s=(t>>>16)+(this.i(n)>>>16)+(e.i(n)>>>16);i=s>>>16,t&=65535,s&=65535,r[n]=s<<16|t}return new n(r,-2147483648&r[r.length-1]?-1:0)},e.j=function(e){if(u(this)||u(e))return a;if(d(this))return d(e)?h(this).j(h(e)):h(h(this).j(e));if(d(e))return h(this.j(h(e)));if(this.l(c)<0&&e.l(c)<0)return o(this.m()*e.m());const t=this.g.length+e.g.length,r=[];for(var i=0;i<2*t;i++)r[i]=0;for(i=0;i<this.g.length;i++)for(let t=0;t<e.g.length;t++){const n=this.i(i)>>>16,s=65535&this.i(i),o=e.i(t)>>>16,a=65535&e.i(t);r[2*i+2*t]+=s*a,m(r,2*i+2*t),r[2*i+2*t+1]+=n*a,m(r,2*i+2*t+1),r[2*i+2*t+1]+=s*o,m(r,2*i+2*t+1),r[2*i+2*t+2]+=n*o,m(r,2*i+2*t+2)}for(e=0;e<t;e++)r[e]=r[2*e+1]<<16|r[2*e];for(e=t;e<2*t;e++)r[e]=0;return new n(r,0)},e.B=function(e){return g(this,e).h},e.and=function(e){const t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)&e.i(n);return new n(r,this.h&e.h)},e.or=function(e){const t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)|e.i(n);return new n(r,this.h|e.h)},e.xor=function(e){const t=Math.max(this.g.length,e.g.length),r=[];for(let n=0;n<t;n++)r[n]=this.i(n)^e.i(n);return new n(r,this.h^e.h)},t.prototype.digest=t.prototype.A,t.prototype.reset=t.prototype.u,t.prototype.update=t.prototype.v,st=at.Md5=t,n.prototype.add=n.prototype.add,n.prototype.multiply=n.prototype.j,n.prototype.modulo=n.prototype.B,n.prototype.compare=n.prototype.l,n.prototype.toNumber=n.prototype.m,n.prototype.toString=n.prototype.toString,n.prototype.getBits=n.prototype.i,n.fromNumber=o,n.fromString=function e(t,r){if(0==t.length)throw Error("number format error: empty string");if((r=r||10)<2||36<r)throw Error("radix out of range: "+r);if("-"==t.charAt(0))return h(e(t.substring(1),r));if(t.indexOf("-")>=0)throw Error('number format error: interior "-" character');const n=o(Math.pow(r,8));let i=a;for(let a=0;a<t.length;a+=8){var s=Math.min(8,t.length-a);const e=parseInt(t.substring(a,a+s),r);s<8?(s=o(Math.pow(r,s)),i=i.j(s).add(o(e))):(i=i.j(n),i=i.add(o(e)))}return i},it=at.Integer=n}).apply("undefined"!==typeof ot?ot:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});var lt,ct,ut,dt,ht,pt,mt,ft,gt="undefined"!==typeof globalThis?globalThis:"undefined"!==typeof window?window:"undefined"!==typeof r.g?r.g:"undefined"!==typeof self?self:{},yt={};(function(){var e,t=Object.defineProperty;var r=function(e){e=["object"==typeof globalThis&&globalThis,e,"object"==typeof window&&window,"object"==typeof self&&self,"object"==typeof gt&&gt];for(var t=0;t<e.length;++t){var r=e[t];if(r&&r.Math==Math)return r}throw Error("Cannot find global object")}(this);function n(e,n){if(n)e:{var i=r;e=e.split(".");for(var s=0;s<e.length-1;s++){var o=e[s];if(!(o in i))break e;i=i[o]}(n=n(s=i[e=e[e.length-1]]))!=s&&null!=n&&t(i,e,{configurable:!0,writable:!0,value:n})}}n("Symbol.dispose",function(e){return e||Symbol("Symbol.dispose")}),n("Array.prototype.values",function(e){return e||function(){return this[Symbol.iterator]()}}),n("Object.entries",function(e){return e||function(e){var t,r=[];for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&r.push([t,e[t]]);return r}});var i=i||{},s=this||self;function o(e){var t=typeof e;return"object"==t&&null!=e||"function"==t}function a(e,t,r){return e.call.apply(e.bind,arguments)}function l(e,t,r){return(l=a).apply(null,arguments)}function c(e,t){var r=Array.prototype.slice.call(arguments,1);return function(){var t=r.slice();return t.push.apply(t,arguments),e.apply(this,t)}}function u(e,t){function r(){}r.prototype=t.prototype,e.Z=t.prototype,e.prototype=new r,e.prototype.constructor=e,e.Ob=function(e,r,n){for(var i=Array(arguments.length-2),s=2;s<arguments.length;s++)i[s-2]=arguments[s];return t.prototype[r].apply(e,i)}}var d="undefined"!==typeof AsyncContext&&"function"===typeof AsyncContext.Snapshot?e=>e&&AsyncContext.Snapshot.wrap(e):e=>e;function h(e){const t=e.length;if(t>0){const r=Array(t);for(let n=0;n<t;n++)r[n]=e[n];return r}return[]}function p(e,t){for(let n=1;n<arguments.length;n++){const t=arguments[n];var r=typeof t;if("array"==(r="object"!=r?r:t?Array.isArray(t)?"array":r:"null")||"object"==r&&"number"==typeof t.length){r=e.length||0;const n=t.length||0;e.length=r+n;for(let i=0;i<n;i++)e[r+i]=t[i]}else e.push(t)}}function m(e){s.setTimeout(()=>{throw e},0)}function f(){var e=x;let t=null;return e.g&&(t=e.g,e.g=e.g.next,e.g||(e.h=null),t.next=null),t}var g=new class{constructor(e,t){this.i=e,this.j=t,this.h=0,this.g=null}get(){let e;return this.h>0?(this.h--,e=this.g,this.g=e.next,e.next=null):e=this.i(),e}}(()=>new y,e=>e.reset());class y{constructor(){this.next=this.g=this.h=null}set(e,t){this.h=e,this.g=t,this.next=null}reset(){this.next=this.g=this.h=null}}let _,v=!1,x=new class{constructor(){this.h=this.g=null}add(e,t){const r=g.get();r.set(e,t),this.h?this.h.next=r:this.g=r,this.h=r}},b=()=>{const e=Promise.resolve(void 0);_=()=>{e.then(w)}};function w(){for(var e;e=f();){try{e.h.call(e.g)}catch(r){m(r)}var t=g;t.j(e),t.h<100&&(t.h++,e.next=t.g,t.g=e)}v=!1}function j(){this.u=this.u,this.C=this.C}function S(e,t){this.type=e,this.g=this.target=t,this.defaultPrevented=!1}j.prototype.u=!1,j.prototype.dispose=function(){this.u||(this.u=!0,this.N())},j.prototype[Symbol.dispose]=function(){this.dispose()},j.prototype.N=function(){if(this.C)for(;this.C.length;)this.C.shift()()},S.prototype.h=function(){this.defaultPrevented=!0};var T=function(){if(!s.addEventListener||!Object.defineProperty)return!1;var e=!1,t=Object.defineProperty({},"passive",{get:function(){e=!0}});try{const e=()=>{};s.addEventListener("test",e,t),s.removeEventListener("test",e,t)}catch(r){}return e}();function k(e){return/^[\s\xa0]*$/.test(e)}function A(e,t){S.call(this,e?e.type:""),this.relatedTarget=this.g=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.state=null,this.pointerId=0,this.pointerType="",this.i=null,e&&this.init(e,t)}u(A,S),A.prototype.init=function(e,t){const r=this.type=e.type,n=e.changedTouches&&e.changedTouches.length?e.changedTouches[0]:null;this.target=e.target||e.srcElement,this.g=t,(t=e.relatedTarget)||("mouseover"==r?t=e.fromElement:"mouseout"==r&&(t=e.toElement)),this.relatedTarget=t,n?(this.clientX=void 0!==n.clientX?n.clientX:n.pageX,this.clientY=void 0!==n.clientY?n.clientY:n.pageY,this.screenX=n.screenX||0,this.screenY=n.screenY||0):(this.clientX=void 0!==e.clientX?e.clientX:e.pageX,this.clientY=void 0!==e.clientY?e.clientY:e.pageY,this.screenX=e.screenX||0,this.screenY=e.screenY||0),this.button=e.button,this.key=e.key||"",this.ctrlKey=e.ctrlKey,this.altKey=e.altKey,this.shiftKey=e.shiftKey,this.metaKey=e.metaKey,this.pointerId=e.pointerId||0,this.pointerType=e.pointerType,this.state=e.state,this.i=e,e.defaultPrevented&&A.Z.h.call(this)},A.prototype.h=function(){A.Z.h.call(this);const e=this.i;e.preventDefault?e.preventDefault():e.returnValue=!1};var C="closure_listenable_"+(1e6*Math.random()|0),E=0;function N(e,t,r,n,i){this.listener=e,this.proxy=null,this.src=t,this.type=r,this.capture=!!n,this.ha=i,this.key=++E,this.da=this.fa=!1}function I(e){e.da=!0,e.listener=null,e.proxy=null,e.src=null,e.ha=null}function P(e,t,r){for(const n in e)t.call(r,e[n],n,e)}function M(e){const t={};for(const r in e)t[r]=e[r];return t}const L="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function R(e,t){let r,n;for(let i=1;i<arguments.length;i++){for(r in n=arguments[i],n)e[r]=n[r];for(let t=0;t<L.length;t++)r=L[t],Object.prototype.hasOwnProperty.call(n,r)&&(e[r]=n[r])}}function D(e){this.src=e,this.g={},this.h=0}function F(e,t){const r=t.type;if(r in e.g){var n,i=e.g[r],s=Array.prototype.indexOf.call(i,t,void 0);(n=s>=0)&&Array.prototype.splice.call(i,s,1),n&&(I(t),0==e.g[r].length&&(delete e.g[r],e.h--))}}function O(e,t,r,n){for(let i=0;i<e.length;++i){const s=e[i];if(!s.da&&s.listener==t&&s.capture==!!r&&s.ha==n)return i}return-1}D.prototype.add=function(e,t,r,n,i){const s=e.toString();(e=this.g[s])||(e=this.g[s]=[],this.h++);const o=O(e,t,n,i);return o>-1?(t=e[o],r||(t.fa=!1)):((t=new N(t,this.src,s,!!n,i)).fa=r,e.push(t)),t};var z="closure_lm_"+(1e6*Math.random()|0),B={};function U(e,t,r,n,i){if(n&&n.once)return q(e,t,r,n,i);if(Array.isArray(t)){for(let s=0;s<t.length;s++)U(e,t[s],r,n,i);return null}return r=X(r),e&&e[C]?e.J(t,r,o(n)?!!n.capture:!!n,i):V(e,t,r,!1,n,i)}function V(e,t,r,n,i,s){if(!t)throw Error("Invalid event type");const a=o(i)?!!i.capture:!!i;let l=K(e);if(l||(e[z]=l=new D(e)),(r=l.add(t,r,n,a,s)).proxy)return r;if(n=function(){function e(r){return t.call(e.src,e.listener,r)}const t=Z;return e}(),r.proxy=n,n.src=e,n.listener=r,e.addEventListener)T||(i=a),void 0===i&&(i=!1),e.addEventListener(t.toString(),n,i);else if(e.attachEvent)e.attachEvent(G(t.toString()),n);else{if(!e.addListener||!e.removeListener)throw Error("addEventListener and attachEvent are unavailable.");e.addListener(n)}return r}function q(e,t,r,n,i){if(Array.isArray(t)){for(let s=0;s<t.length;s++)q(e,t[s],r,n,i);return null}return r=X(r),e&&e[C]?e.K(t,r,o(n)?!!n.capture:!!n,i):V(e,t,r,!0,n,i)}function W(e,t,r,n,i){if(Array.isArray(t))for(var s=0;s<t.length;s++)W(e,t[s],r,n,i);else n=o(n)?!!n.capture:!!n,r=X(r),e&&e[C]?(e=e.i,(s=String(t).toString())in e.g&&((r=O(t=e.g[s],r,n,i))>-1&&(I(t[r]),Array.prototype.splice.call(t,r,1),0==t.length&&(delete e.g[s],e.h--)))):e&&(e=K(e))&&(t=e.g[t.toString()],e=-1,t&&(e=O(t,r,n,i)),(r=e>-1?t[e]:null)&&H(r))}function H(e){if("number"!==typeof e&&e&&!e.da){var t=e.src;if(t&&t[C])F(t.i,e);else{var r=e.type,n=e.proxy;t.removeEventListener?t.removeEventListener(r,n,e.capture):t.detachEvent?t.detachEvent(G(r),n):t.addListener&&t.removeListener&&t.removeListener(n),(r=K(t))?(F(r,e),0==r.h&&(r.src=null,t[z]=null)):I(e)}}}function G(e){return e in B?B[e]:B[e]="on"+e}function Z(e,t){if(e.da)e=!0;else{t=new A(t,this);const r=e.listener,n=e.ha||e.src;e.fa&&H(e),e=r.call(n,t)}return e}function K(e){return(e=e[z])instanceof D?e:null}var Y="__closure_events_fn_"+(1e9*Math.random()>>>0);function X(e){return"function"===typeof e?e:(e[Y]||(e[Y]=function(t){return e.handleEvent(t)}),e[Y])}function J(){j.call(this),this.i=new D(this),this.M=this,this.G=null}function Q(e,t){var r,n=e.G;if(n)for(r=[];n;n=n.G)r.push(n);if(e=e.M,n=t.type||t,"string"===typeof t)t=new S(t,e);else if(t instanceof S)t.target=t.target||e;else{var i=t;R(t=new S(n,e),i)}let s,o;if(i=!0,r)for(o=r.length-1;o>=0;o--)s=t.g=r[o],i=$(s,n,!0,t)&&i;if(s=t.g=e,i=$(s,n,!0,t)&&i,i=$(s,n,!1,t)&&i,r)for(o=0;o<r.length;o++)s=t.g=r[o],i=$(s,n,!1,t)&&i}function $(e,t,r,n){if(!(t=e.i.g[String(t)]))return!0;t=t.concat();let i=!0;for(let s=0;s<t.length;++s){const o=t[s];if(o&&!o.da&&o.capture==r){const t=o.listener,r=o.ha||o.src;o.fa&&F(e.i,o),i=!1!==t.call(r,n)&&i}}return i&&!n.defaultPrevented}function ee(e){e.g=function(e,t){if("function"!==typeof e){if(!e||"function"!=typeof e.handleEvent)throw Error("Invalid listener argument");e=l(e.handleEvent,e)}return Number(t)>2147483647?-1:s.setTimeout(e,t||0)}(()=>{e.g=null,e.i&&(e.i=!1,ee(e))},e.l);const t=e.h;e.h=null,e.m.apply(null,t)}u(J,j),J.prototype[C]=!0,J.prototype.removeEventListener=function(e,t,r,n){W(this,e,t,r,n)},J.prototype.N=function(){if(J.Z.N.call(this),this.i){var e=this.i;for(const t in e.g){const r=e.g[t];for(let e=0;e<r.length;e++)I(r[e]);delete e.g[t],e.h--}}this.G=null},J.prototype.J=function(e,t,r,n){return this.i.add(String(e),t,!1,r,n)},J.prototype.K=function(e,t,r,n){return this.i.add(String(e),t,!0,r,n)};class te extends j{constructor(e,t){super(),this.m=e,this.l=t,this.h=null,this.i=!1,this.g=null}j(e){this.h=arguments,this.g?this.i=!0:ee(this)}N(){super.N(),this.g&&(s.clearTimeout(this.g),this.g=null,this.i=!1,this.h=null)}}function re(e){j.call(this),this.h=e,this.g={}}u(re,j);var ne=[];function ie(e){P(e.g,function(e,t){this.g.hasOwnProperty(t)&&H(e)},e),e.g={}}re.prototype.N=function(){re.Z.N.call(this),ie(this)},re.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var se=s.JSON.stringify,oe=s.JSON.parse,ae=class{stringify(e){return s.JSON.stringify(e,void 0)}parse(e){return s.JSON.parse(e,void 0)}};function le(){}function ce(){}var ue={OPEN:"a",hb:"b",ERROR:"c",tb:"d"};function de(){S.call(this,"d")}function he(){S.call(this,"c")}u(de,S),u(he,S);var pe={},me=null;function fe(){return me=me||new J}function ge(e){S.call(this,pe.Ia,e)}function ye(e){const t=fe();Q(t,new ge(t))}function _e(e,t){S.call(this,pe.STAT_EVENT,e),this.stat=t}function ve(e){const t=fe();Q(t,new _e(t,e))}function xe(e,t){S.call(this,pe.Ja,e),this.size=t}function be(e,t){if("function"!==typeof e)throw Error("Fn must not be null and must be a function");return s.setTimeout(function(){e()},t)}function we(){this.g=!0}function je(e,t,r,n){e.info(function(){return"XMLHTTP TEXT ("+t+"): "+function(e,t){if(!e.g)return t;if(!t)return null;try{const s=JSON.parse(t);if(s)for(e=0;e<s.length;e++)if(Array.isArray(s[e])){var r=s[e];if(!(r.length<2)){var n=r[1];if(Array.isArray(n)&&!(n.length<1)){var i=n[0];if("noop"!=i&&"stop"!=i&&"close"!=i)for(let e=1;e<n.length;e++)n[e]=""}}}return se(s)}catch(s){return t}}(e,r)+(n?" "+n:"")})}pe.Ia="serverreachability",u(ge,S),pe.STAT_EVENT="statevent",u(_e,S),pe.Ja="timingevent",u(xe,S),we.prototype.ua=function(){this.g=!1},we.prototype.info=function(){};var Se,Te={NO_ERROR:0,cb:1,qb:2,pb:3,kb:4,ob:5,rb:6,Ga:7,TIMEOUT:8,ub:9},ke={ib:"complete",Fb:"success",ERROR:"error",Ga:"abort",xb:"ready",yb:"readystatechange",TIMEOUT:"timeout",sb:"incrementaldata",wb:"progress",lb:"downloadprogress",Nb:"uploadprogress"};function Ae(){}function Ce(e){return encodeURIComponent(String(e))}function Ee(e){var t=1;e=e.split(":");const r=[];for(;t>0&&e.length;)r.push(e.shift()),t--;return e.length&&r.push(e.join(":")),r}function Ne(e,t,r,n){this.j=e,this.i=t,this.l=r,this.S=n||1,this.V=new re(this),this.H=45e3,this.J=null,this.o=!1,this.u=this.B=this.A=this.M=this.F=this.T=this.D=null,this.G=[],this.g=null,this.C=0,this.m=this.v=null,this.X=-1,this.K=!1,this.P=0,this.O=null,this.W=this.L=this.U=this.R=!1,this.h=new Ie}function Ie(){this.i=null,this.g="",this.h=!1}u(Ae,le),Ae.prototype.g=function(){return new XMLHttpRequest},Se=new Ae;var Pe={},Me={};function Le(e,t,r){e.M=1,e.A=st(et(t)),e.u=r,e.R=!0,Re(e,null)}function Re(e,t){e.F=Date.now(),Oe(e),e.B=et(e.A);var r=e.B,n=e.S;Array.isArray(n)||(n=[String(n)]),Nt(r.i,"t",n),e.C=0,r=e.j.L,e.h=new Ie,e.g=yr(e.j,r?t:null,!e.u),e.P>0&&(e.O=new te(l(e.Y,e,e.g),e.P)),t=e.V,r=e.g,n=e.ba;var i="readystatechange";Array.isArray(i)||(i&&(ne[0]=i.toString()),i=ne);for(let s=0;s<i.length;s++){const e=U(r,i[s],n||t.handleEvent,!1,t.h||t);if(!e)break;t.g[e.key]=e}t=e.J?M(e.J):{},e.u?(e.v||(e.v="POST"),t["Content-Type"]="application/x-www-form-urlencoded",e.g.ea(e.B,e.v,e.u,t)):(e.v="GET",e.g.ea(e.B,e.v,null,t)),ye(),function(e,t,r,n,i,s){e.info(function(){if(e.g)if(s){var o="",a=s.split("&");for(let e=0;e<a.length;e++){var l=a[e].split("=");if(l.length>1){const e=l[0];l=l[1];const t=e.split("_");o=t.length>=2&&"type"==t[1]?o+(e+"=")+l+"&":o+(e+"=redacted&")}}}else o=null;else o=s;return"XMLHTTP REQ ("+n+") [attempt "+i+"]: "+t+"\n"+r+"\n"+o})}(e.i,e.v,e.B,e.l,e.S,e.u)}function De(e){return!!e.g&&("GET"==e.v&&2!=e.M&&e.j.Aa)}function Fe(e,t){var r=e.C,n=t.indexOf("\n",r);return-1==n?Me:(r=Number(t.substring(r,n)),isNaN(r)?Pe:(n+=1)+r>t.length?Me:(t=t.slice(n,n+r),e.C=n+r,t))}function Oe(e){e.T=Date.now()+e.H,ze(e,e.H)}function ze(e,t){if(null!=e.D)throw Error("WatchDog timer not null");e.D=be(l(e.aa,e),t)}function Be(e){e.D&&(s.clearTimeout(e.D),e.D=null)}function Ue(e){0==e.j.I||e.K||hr(e.j,e)}function Ve(e){Be(e);var t=e.O;t&&"function"==typeof t.dispose&&t.dispose(),e.O=null,ie(e.V),e.g&&(t=e.g,e.g=null,t.abort(),t.dispose())}function qe(e,t){try{var r=e.j;if(0!=r.I&&(r.g==e||Ke(r.h,e)))if(!e.L&&Ke(r.h,e)&&3==r.I){try{var n=r.Ba.g.parse(t)}catch(u){n=null}if(Array.isArray(n)&&3==n.length){var i=n;if(0==i[0]){e:if(!r.v){if(r.g){if(!(r.g.F+3e3<e.F))break e;dr(r),tr(r)}lr(r),ve(18)}}else r.xa=i[1],0<r.xa-r.K&&i[2]<37500&&r.F&&0==r.A&&!r.C&&(r.C=be(l(r.Va,r),6e3));Ze(r.h)<=1&&r.ta&&(r.ta=void 0)}else mr(r,11)}else if((e.L||r.g==e)&&dr(r),!k(t))for(i=r.Ba.g.parse(t),t=0;t<i.length;t++){let l=i[t];const u=l[0];if(!(u<=r.K))if(r.K=u,l=l[1],2==r.I)if("c"==l[0]){r.M=l[1],r.ba=l[2];const t=l[3];null!=t&&(r.ka=t,r.j.info("VER="+r.ka));const i=l[4];null!=i&&(r.za=i,r.j.info("SVER="+r.za));const u=l[5];null!=u&&"number"===typeof u&&u>0&&(n=1.5*u,r.O=n,r.j.info("backChannelRequestTimeoutMs_="+n)),n=r;const d=e.g;if(d){const e=d.g?d.g.getResponseHeader("X-Client-Wire-Protocol"):null;if(e){var s=n.h;s.g||-1==e.indexOf("spdy")&&-1==e.indexOf("quic")&&-1==e.indexOf("h2")||(s.j=s.l,s.g=new Set,s.h&&(Ye(s,s.h),s.h=null))}if(n.G){const e=d.g?d.g.getResponseHeader("X-HTTP-Session-Id"):null;e&&(n.wa=e,it(n.J,n.G,e))}}r.I=3,r.l&&r.l.ra(),r.aa&&(r.T=Date.now()-e.F,r.j.info("Handshake RTT: "+r.T+"ms"));var o=e;if((n=r).na=gr(n,n.L?n.ba:null,n.W),o.L){Xe(n.h,o);var a=o,c=n.O;c&&(a.H=c),a.D&&(Be(a),Oe(a)),n.g=o}else ar(n);r.i.length>0&&nr(r)}else"stop"!=l[0]&&"close"!=l[0]||mr(r,7);else 3==r.I&&("stop"==l[0]||"close"==l[0]?"stop"==l[0]?mr(r,7):er(r):"noop"!=l[0]&&r.l&&r.l.qa(l),r.A=0)}ye()}catch(u){}}Ne.prototype.ba=function(e){e=e.target;const t=this.O;t&&3==Xt(e)?t.j():this.Y(e)},Ne.prototype.Y=function(e){try{if(e==this.g)e:{const l=Xt(this.g),c=this.g.ya();this.g.ca();if(!(l<3)&&(3!=l||this.g&&(this.h.h||this.g.la()||Jt(this.g)))){this.K||4!=l||7==c||ye(),Be(this);var t=this.g.ca();this.X=t;var r=function(e){if(!De(e))return e.g.la();const t=Jt(e.g);if(""===t)return"";let r="";const n=t.length,i=4==Xt(e.g);if(!e.h.i){if("undefined"===typeof TextDecoder)return Ve(e),Ue(e),"";e.h.i=new s.TextDecoder}for(let s=0;s<n;s++)e.h.h=!0,r+=e.h.i.decode(t[s],{stream:!(i&&s==n-1)});return t.length=0,e.h.g+=r,e.C=0,e.h.g}(this);if(this.o=200==t,function(e,t,r,n,i,s,o){e.info(function(){return"XMLHTTP RESP ("+n+") [ attempt "+i+"]: "+t+"\n"+r+"\n"+s+" "+o})}(this.i,this.v,this.B,this.l,this.S,l,t),this.o){if(this.U&&!this.L){t:{if(this.g){var n,i=this.g;if((n=i.g?i.g.getResponseHeader("X-HTTP-Initial-Response"):null)&&!k(n)){var o=n;break t}}o=null}if(!(e=o)){this.o=!1,this.m=3,ve(12),Ve(this),Ue(this);break e}je(this.i,this.l,e,"Initial handshake response via X-HTTP-Initial-Response"),this.L=!0,qe(this,e)}if(this.R){let t;for(e=!0;!this.K&&this.C<r.length;){if(t=Fe(this,r),t==Me){4==l&&(this.m=4,ve(14),e=!1),je(this.i,this.l,null,"[Incomplete Response]");break}if(t==Pe){this.m=4,ve(15),je(this.i,this.l,r,"[Invalid Chunk]"),e=!1;break}je(this.i,this.l,t,null),qe(this,t)}if(De(this)&&0!=this.C&&(this.h.g=this.h.g.slice(this.C),this.C=0),4!=l||0!=r.length||this.h.h||(this.m=1,ve(16),e=!1),this.o=this.o&&e,e){if(r.length>0&&!this.W){this.W=!0;var a=this.j;a.g==this&&a.aa&&!a.P&&(a.j.info("Great, no buffering proxy detected. Bytes received: "+r.length),cr(a),a.P=!0,ve(11))}}else je(this.i,this.l,r,"[Invalid Chunked Response]"),Ve(this),Ue(this)}else je(this.i,this.l,r,null),qe(this,r);4==l&&Ve(this),this.o&&!this.K&&(4==l?hr(this.j,this):(this.o=!1,Oe(this)))}else(function(e){const t={};e=(e.g&&Xt(e)>=2&&e.g.getAllResponseHeaders()||"").split("\r\n");for(let n=0;n<e.length;n++){if(k(e[n]))continue;var r=Ee(e[n]);const i=r[0];if("string"!==typeof(r=r[1]))continue;r=r.trim();const s=t[i]||[];t[i]=s,s.push(r)}!function(e,t){for(const r in e)t.call(void 0,e[r],r,e)}(t,function(e){return e.join(", ")})})(this.g),400==t&&r.indexOf("Unknown SID")>0?(this.m=3,ve(12)):(this.m=0,ve(13)),Ve(this),Ue(this)}}}catch(Yt){}},Ne.prototype.cancel=function(){this.K=!0,Ve(this)},Ne.prototype.aa=function(){this.D=null;const e=Date.now();e-this.T>=0?(function(e,t){e.info(function(){return"TIMEOUT: "+t})}(this.i,this.B),2!=this.M&&(ye(),ve(17)),Ve(this),this.m=2,Ue(this)):ze(this,this.T-e)};var We=class{constructor(e,t){this.g=e,this.map=t}};function He(e){this.l=e||10,s.PerformanceNavigationTiming?e=(e=s.performance.getEntriesByType("navigation")).length>0&&("hq"==e[0].nextHopProtocol||"h2"==e[0].nextHopProtocol):e=!!(s.chrome&&s.chrome.loadTimes&&s.chrome.loadTimes()&&s.chrome.loadTimes().wasFetchedViaSpdy),this.j=e?this.l:1,this.g=null,this.j>1&&(this.g=new Set),this.h=null,this.i=[]}function Ge(e){return!!e.h||!!e.g&&e.g.size>=e.j}function Ze(e){return e.h?1:e.g?e.g.size:0}function Ke(e,t){return e.h?e.h==t:!!e.g&&e.g.has(t)}function Ye(e,t){e.g?e.g.add(t):e.h=t}function Xe(e,t){e.h&&e.h==t?e.h=null:e.g&&e.g.has(t)&&e.g.delete(t)}function Je(e){if(null!=e.h)return e.i.concat(e.h.G);if(null!=e.g&&0!==e.g.size){let t=e.i;for(const r of e.g.values())t=t.concat(r.G);return t}return h(e.i)}He.prototype.cancel=function(){if(this.i=Je(this),this.h)this.h.cancel(),this.h=null;else if(this.g&&0!==this.g.size){for(const e of this.g.values())e.cancel();this.g.clear()}};var Qe=RegExp("^(?:([^:/?#.]+):)?(?://(?:([^\\\\/?#]*)@)?([^\\\\/?#]*?)(?::([0-9]+))?(?=[\\\\/?#]|$))?([^?#]+)?(?:\\?([^#]*))?(?:#([\\s\\S]*))?$");function $e(e){let t;this.g=this.o=this.j="",this.u=null,this.m=this.h="",this.l=!1,e instanceof $e?(this.l=e.l,tt(this,e.j),this.o=e.o,this.g=e.g,rt(this,e.u),this.h=e.h,nt(this,It(e.i)),this.m=e.m):e&&(t=String(e).match(Qe))?(this.l=!1,tt(this,t[1]||"",!0),this.o=ot(t[2]||""),this.g=ot(t[3]||"",!0),rt(this,t[4]),this.h=ot(t[5]||"",!0),nt(this,t[6]||"",!0),this.m=ot(t[7]||"")):(this.l=!1,this.i=new Tt(null,this.l))}function et(e){return new $e(e)}function tt(e,t,r){e.j=r?ot(t,!0):t,e.j&&(e.j=e.j.replace(/:$/,""))}function rt(e,t){if(t){if(t=Number(t),isNaN(t)||t<0)throw Error("Bad port number "+t);e.u=t}else e.u=null}function nt(e,t,r){t instanceof Tt?(e.i=t,function(e,t){t&&!e.j&&(kt(e),e.i=null,e.g.forEach(function(e,t){const r=t.toLowerCase();t!=r&&(At(this,t),Nt(this,r,e))},e)),e.j=t}(e.i,e.l)):(r||(t=at(t,jt)),e.i=new Tt(t,e.l))}function it(e,t,r){e.i.set(t,r)}function st(e){return it(e,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Date.now()).toString(36)),e}function ot(e,t){return e?t?decodeURI(e.replace(/%25/g,"%2525")):decodeURIComponent(e):""}function at(e,t,r){return"string"===typeof e?(e=encodeURI(e).replace(t,_t),r&&(e=e.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),e):null}function _t(e){return"%"+((e=e.charCodeAt(0))>>4&15).toString(16)+(15&e).toString(16)}$e.prototype.toString=function(){const e=[];var t=this.j;t&&e.push(at(t,xt,!0),":");var r=this.g;return(r||"file"==t)&&(e.push("//"),(t=this.o)&&e.push(at(t,xt,!0),"@"),e.push(Ce(r).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(r=this.u)&&e.push(":",String(r))),(r=this.h)&&(this.g&&"/"!=r.charAt(0)&&e.push("/"),e.push(at(r,"/"==r.charAt(0)?wt:bt,!0))),(r=this.i.toString())&&e.push("?",r),(r=this.m)&&e.push("#",at(r,St)),e.join("")},$e.prototype.resolve=function(e){const t=et(this);let r=!!e.j;r?tt(t,e.j):r=!!e.o,r?t.o=e.o:r=!!e.g,r?t.g=e.g:r=null!=e.u;var n=e.h;if(r)rt(t,e.u);else if(r=!!e.h){if("/"!=n.charAt(0))if(this.g&&!this.h)n="/"+n;else{var i=t.h.lastIndexOf("/");-1!=i&&(n=t.h.slice(0,i+1)+n)}if(".."==(i=n)||"."==i)n="";else if(-1!=i.indexOf("./")||-1!=i.indexOf("/.")){n=0==i.lastIndexOf("/",0),i=i.split("/");const e=[];for(let t=0;t<i.length;){const r=i[t++];"."==r?n&&t==i.length&&e.push(""):".."==r?((e.length>1||1==e.length&&""!=e[0])&&e.pop(),n&&t==i.length&&e.push("")):(e.push(r),n=!0)}n=e.join("/")}else n=i}return r?t.h=n:r=""!==e.i.toString(),r?nt(t,It(e.i)):r=!!e.m,r&&(t.m=e.m),t};var xt=/[#\/\?@]/g,bt=/[#\?:]/g,wt=/[#\?]/g,jt=/[#\?@]/g,St=/#/g;function Tt(e,t){this.h=this.g=null,this.i=e||null,this.j=!!t}function kt(e){e.g||(e.g=new Map,e.h=0,e.i&&function(e,t){if(e){e=e.split("&");for(let r=0;r<e.length;r++){const n=e[r].indexOf("=");let i,s=null;n>=0?(i=e[r].substring(0,n),s=e[r].substring(n+1)):i=e[r],t(i,s?decodeURIComponent(s.replace(/\+/g," ")):"")}}}(e.i,function(t,r){e.add(decodeURIComponent(t.replace(/\+/g," ")),r)}))}function At(e,t){kt(e),t=Pt(e,t),e.g.has(t)&&(e.i=null,e.h-=e.g.get(t).length,e.g.delete(t))}function Ct(e,t){return kt(e),t=Pt(e,t),e.g.has(t)}function Et(e,t){kt(e);let r=[];if("string"===typeof t)Ct(e,t)&&(r=r.concat(e.g.get(Pt(e,t))));else for(e=Array.from(e.g.values()),t=0;t<e.length;t++)r=r.concat(e[t]);return r}function Nt(e,t,r){At(e,t),r.length>0&&(e.i=null,e.g.set(Pt(e,t),h(r)),e.h+=r.length)}function It(e){const t=new Tt;return t.i=e.i,e.g&&(t.g=new Map(e.g),t.h=e.h),t}function Pt(e,t){return t=String(t),e.j&&(t=t.toLowerCase()),t}function Mt(e,t,r,n,i){try{i&&(i.onload=null,i.onerror=null,i.onabort=null,i.ontimeout=null),n(r)}catch(s){}}function Lt(){this.g=new ae}function Rt(e){this.i=e.Sb||null,this.h=e.ab||!1}function Dt(e,t){J.call(this),this.H=e,this.o=t,this.m=void 0,this.status=this.readyState=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.A=new Headers,this.h=null,this.F="GET",this.D="",this.g=!1,this.B=this.j=this.l=null,this.v=new AbortController}function Ft(e){e.j.read().then(e.Ma.bind(e)).catch(e.ga.bind(e))}function Ot(e){e.readyState=4,e.l=null,e.j=null,e.B=null,zt(e)}function zt(e){e.onreadystatechange&&e.onreadystatechange.call(e)}function Bt(e){let t="";return P(e,function(e,r){t+=r,t+=":",t+=e,t+="\r\n"}),t}function Ut(e,t,r){e:{for(n in r){var n=!1;break e}n=!0}n||(r=Bt(r),"string"===typeof e?null!=r&&Ce(r):it(e,t,r))}function Vt(e){J.call(this),this.headers=new Map,this.L=e||null,this.h=!1,this.g=null,this.D="",this.o=0,this.l="",this.j=this.B=this.v=this.A=!1,this.m=null,this.F="",this.H=!1}(e=Tt.prototype).add=function(e,t){kt(this),this.i=null,e=Pt(this,e);let r=this.g.get(e);return r||this.g.set(e,r=[]),r.push(t),this.h+=1,this},e.forEach=function(e,t){kt(this),this.g.forEach(function(r,n){r.forEach(function(r){e.call(t,r,n,this)},this)},this)},e.set=function(e,t){return kt(this),this.i=null,Ct(this,e=Pt(this,e))&&(this.h-=this.g.get(e).length),this.g.set(e,[t]),this.h+=1,this},e.get=function(e,t){return e&&(e=Et(this,e)).length>0?String(e[0]):t},e.toString=function(){if(this.i)return this.i;if(!this.g)return"";const e=[],t=Array.from(this.g.keys());for(let n=0;n<t.length;n++){var r=t[n];const i=Ce(r);r=Et(this,r);for(let t=0;t<r.length;t++){let n=i;""!==r[t]&&(n+="="+Ce(r[t])),e.push(n)}}return this.i=e.join("&")},u(Rt,le),Rt.prototype.g=function(){return new Dt(this.i,this.h)},u(Dt,J),(e=Dt.prototype).open=function(e,t){if(0!=this.readyState)throw this.abort(),Error("Error reopening a connection");this.F=e,this.D=t,this.readyState=1,zt(this)},e.send=function(e){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");if(this.v.signal.aborted)throw this.abort(),Error("Request was aborted.");this.g=!0;const t={headers:this.A,method:this.F,credentials:this.m,cache:void 0,signal:this.v.signal};e&&(t.body=e),(this.H||s).fetch(new Request(this.D,t)).then(this.Pa.bind(this),this.ga.bind(this))},e.abort=function(){this.response=this.responseText="",this.A=new Headers,this.status=0,this.v.abort(),this.j&&this.j.cancel("Request was aborted.").catch(()=>{}),this.readyState>=1&&this.g&&4!=this.readyState&&(this.g=!1,Ot(this)),this.readyState=0},e.Pa=function(e){if(this.g&&(this.l=e,this.h||(this.status=this.l.status,this.statusText=this.l.statusText,this.h=e.headers,this.readyState=2,zt(this)),this.g&&(this.readyState=3,zt(this),this.g)))if("arraybuffer"===this.responseType)e.arrayBuffer().then(this.Na.bind(this),this.ga.bind(this));else if("undefined"!==typeof s.ReadableStream&&"body"in e){if(this.j=e.body.getReader(),this.o){if(this.responseType)throw Error('responseType must be empty for "streamBinaryChunks" mode responses.');this.response=[]}else this.response=this.responseText="",this.B=new TextDecoder;Ft(this)}else e.text().then(this.Oa.bind(this),this.ga.bind(this))},e.Ma=function(e){if(this.g){if(this.o&&e.value)this.response.push(e.value);else if(!this.o){var t=e.value?e.value:new Uint8Array(0);(t=this.B.decode(t,{stream:!e.done}))&&(this.response=this.responseText+=t)}e.done?Ot(this):zt(this),3==this.readyState&&Ft(this)}},e.Oa=function(e){this.g&&(this.response=this.responseText=e,Ot(this))},e.Na=function(e){this.g&&(this.response=e,Ot(this))},e.ga=function(){this.g&&Ot(this)},e.setRequestHeader=function(e,t){this.A.append(e,t)},e.getResponseHeader=function(e){return this.h&&this.h.get(e.toLowerCase())||""},e.getAllResponseHeaders=function(){if(!this.h)return"";const e=[],t=this.h.entries();for(var r=t.next();!r.done;)r=r.value,e.push(r[0]+": "+r[1]),r=t.next();return e.join("\r\n")},Object.defineProperty(Dt.prototype,"withCredentials",{get:function(){return"include"===this.m},set:function(e){this.m=e?"include":"same-origin"}}),u(Vt,J);var qt=/^https?$/i,Wt=["POST","PUT"];function Ht(e,t){e.h=!1,e.g&&(e.j=!0,e.g.abort(),e.j=!1),e.l=t,e.o=5,Gt(e),Kt(e)}function Gt(e){e.A||(e.A=!0,Q(e,"complete"),Q(e,"error"))}function Zt(e){if(e.h&&"undefined"!=typeof i)if(e.v&&4==Xt(e))setTimeout(e.Ca.bind(e),0);else if(Q(e,"readystatechange"),4==Xt(e)){e.h=!1;try{const i=e.ca();e:switch(i){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var t=!0;break e;default:t=!1}var r;if(!(r=t)){var n;if(n=0===i){let t=String(e.D).match(Qe)[1]||null;!t&&s.self&&s.self.location&&(t=s.self.location.protocol.slice(0,-1)),n=!qt.test(t?t.toLowerCase():"")}r=n}if(r)Q(e,"complete"),Q(e,"success");else{e.o=6;try{var o=Xt(e)>2?e.g.statusText:""}catch(a){o=""}e.l=o+" ["+e.ca()+"]",Gt(e)}}finally{Kt(e)}}}function Kt(e,t){if(e.g){e.m&&(clearTimeout(e.m),e.m=null);const n=e.g;e.g=null,t||Q(e,"ready");try{n.onreadystatechange=null}catch(r){}}}function Xt(e){return e.g?e.g.readyState:0}function Jt(e){try{if(!e.g)return null;if("response"in e.g)return e.g.response;switch(e.F){case"":case"text":return e.g.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in e.g)return e.g.mozResponseArrayBuffer}return null}catch(t){return null}}function Qt(e,t,r){return r&&r.internalChannelParams&&r.internalChannelParams[e]||t}function $t(e){this.za=0,this.i=[],this.j=new we,this.ba=this.na=this.J=this.W=this.g=this.wa=this.G=this.H=this.u=this.U=this.o=null,this.Ya=this.V=0,this.Sa=Qt("failFast",!1,e),this.F=this.C=this.v=this.m=this.l=null,this.X=!0,this.xa=this.K=-1,this.Y=this.A=this.D=0,this.Qa=Qt("baseRetryDelayMs",5e3,e),this.Za=Qt("retryDelaySeedMs",1e4,e),this.Ta=Qt("forwardChannelMaxRetries",2,e),this.va=Qt("forwardChannelRequestTimeoutMs",2e4,e),this.ma=e&&e.xmlHttpFactory||void 0,this.Ua=e&&e.Rb||void 0,this.Aa=e&&e.useFetchStreams||!1,this.O=void 0,this.L=e&&e.supportsCrossDomainXhr||!1,this.M="",this.h=new He(e&&e.concurrentRequestLimit),this.Ba=new Lt,this.S=e&&e.fastHandshake||!1,this.R=e&&e.encodeInitMessageHeaders||!1,this.S&&this.R&&(this.R=!1),this.Ra=e&&e.Pb||!1,e&&e.ua&&this.j.ua(),e&&e.forceLongPolling&&(this.X=!1),this.aa=!this.S&&this.X&&e&&e.detectBufferingProxy||!1,this.ia=void 0,e&&e.longPollingTimeout&&e.longPollingTimeout>0&&(this.ia=e.longPollingTimeout),this.ta=void 0,this.T=0,this.P=!1,this.ja=this.B=null}function er(e){if(rr(e),3==e.I){var t=e.V++,r=et(e.J);if(it(r,"SID",e.M),it(r,"RID",t),it(r,"TYPE","terminate"),sr(e,r),(t=new Ne(e,e.j,t)).M=2,t.A=st(et(r)),r=!1,s.navigator&&s.navigator.sendBeacon)try{r=s.navigator.sendBeacon(t.A.toString(),"")}catch(n){}!r&&s.Image&&((new Image).src=t.A,r=!0),r||(t.g=yr(t.j,null),t.g.ea(t.A)),t.F=Date.now(),Oe(t)}fr(e)}function tr(e){e.g&&(cr(e),e.g.cancel(),e.g=null)}function rr(e){tr(e),e.v&&(s.clearTimeout(e.v),e.v=null),dr(e),e.h.cancel(),e.m&&("number"===typeof e.m&&s.clearTimeout(e.m),e.m=null)}function nr(e){if(!Ge(e.h)&&!e.m){e.m=!0;var t=e.Ea;_||b(),v||(_(),v=!0),x.add(t,e),e.D=0}}function ir(e,t){var r;r=t?t.l:e.V++;const n=et(e.J);it(n,"SID",e.M),it(n,"RID",r),it(n,"AID",e.K),sr(e,n),e.u&&e.o&&Ut(n,e.u,e.o),r=new Ne(e,e.j,r,e.D+1),null===e.u&&(r.J=e.o),t&&(e.i=t.G.concat(e.i)),t=or(e,r,1e3),r.H=Math.round(.5*e.va)+Math.round(.5*e.va*Math.random()),Ye(e.h,r),Le(r,n,t)}function sr(e,t){e.H&&P(e.H,function(e,r){it(t,r,e)}),e.l&&P({},function(e,r){it(t,r,e)})}function or(e,t,r){r=Math.min(e.i.length,r);const n=e.l?l(e.l.Ka,e.l,e):null;e:{var i=e.i;let t=-1;for(;;){const e=["count="+r];-1==t?r>0?(t=i[0].g,e.push("ofs="+t)):t=0:e.push("ofs="+t);let l=!0;for(let c=0;c<r;c++){var s=i[c].g;const r=i[c].map;if((s-=t)<0)t=Math.max(0,i[c].g-100),l=!1;else try{s="req"+s+"_"||0;try{var a=r instanceof Map?r:Object.entries(r);for(const[t,r]of a){let n=r;o(r)&&(n=se(r)),e.push(s+t+"="+encodeURIComponent(n))}}catch(vt){throw e.push(s+"type="+encodeURIComponent("_badmap")),vt}}catch(vt){n&&n(r)}}if(l){a=e.join("&");break e}}a=void 0}return e=e.i.splice(0,r),t.G=e,a}function ar(e){if(!e.g&&!e.v){e.Y=1;var t=e.Da;_||b(),v||(_(),v=!0),x.add(t,e),e.A=0}}function lr(e){return!(e.g||e.v||e.A>=3)&&(e.Y++,e.v=be(l(e.Da,e),pr(e,e.A)),e.A++,!0)}function cr(e){null!=e.B&&(s.clearTimeout(e.B),e.B=null)}function ur(e){e.g=new Ne(e,e.j,"rpc",e.Y),null===e.u&&(e.g.J=e.o),e.g.P=0;var t=et(e.na);it(t,"RID","rpc"),it(t,"SID",e.M),it(t,"AID",e.K),it(t,"CI",e.F?"0":"1"),!e.F&&e.ia&&it(t,"TO",e.ia),it(t,"TYPE","xmlhttp"),sr(e,t),e.u&&e.o&&Ut(t,e.u,e.o),e.O&&(e.g.H=e.O);var r=e.g;e=e.ba,r.M=1,r.A=st(et(t)),r.u=null,r.R=!0,Re(r,e)}function dr(e){null!=e.C&&(s.clearTimeout(e.C),e.C=null)}function hr(e,t){var r=null;if(e.g==t){dr(e),cr(e),e.g=null;var n=2}else{if(!Ke(e.h,t))return;r=t.G,Xe(e.h,t),n=1}if(0!=e.I)if(t.o)if(1==n){r=t.u?t.u.length:0,t=Date.now()-t.F;var i=e.D;Q(n=fe(),new xe(n,r)),nr(e)}else ar(e);else if(3==(i=t.m)||0==i&&t.X>0||!(1==n&&function(e,t){return!(Ze(e.h)>=e.h.j-(e.m?1:0))&&(e.m?(e.i=t.G.concat(e.i),!0):!(1==e.I||2==e.I||e.D>=(e.Sa?0:e.Ta))&&(e.m=be(l(e.Ea,e,t),pr(e,e.D)),e.D++,!0))}(e,t)||2==n&&lr(e)))switch(r&&r.length>0&&(t=e.h,t.i=t.i.concat(r)),i){case 1:mr(e,5);break;case 4:mr(e,10);break;case 3:mr(e,6);break;default:mr(e,2)}}function pr(e,t){let r=e.Qa+Math.floor(Math.random()*e.Za);return e.isActive()||(r*=2),r*t}function mr(e,t){if(e.j.info("Error code "+t),2==t){var r=l(e.bb,e),n=e.Ua;const t=!n;n=new $e(n||"//www.google.com/images/cleardot.gif"),s.location&&"http"==s.location.protocol||tt(n,"https"),st(n),t?function(e,t){const r=new we;if(s.Image){const n=new Image;n.onload=c(Mt,r,"TestLoadImage: loaded",!0,t,n),n.onerror=c(Mt,r,"TestLoadImage: error",!1,t,n),n.onabort=c(Mt,r,"TestLoadImage: abort",!1,t,n),n.ontimeout=c(Mt,r,"TestLoadImage: timeout",!1,t,n),s.setTimeout(function(){n.ontimeout&&n.ontimeout()},1e4),n.src=e}else t(!1)}(n.toString(),r):function(e,t){new we;const r=new AbortController,n=setTimeout(()=>{r.abort(),Mt(0,0,!1,t)},1e4);fetch(e,{signal:r.signal}).then(e=>{clearTimeout(n),e.ok?Mt(0,0,!0,t):Mt(0,0,!1,t)}).catch(()=>{clearTimeout(n),Mt(0,0,!1,t)})}(n.toString(),r)}else ve(2);e.I=0,e.l&&e.l.pa(t),fr(e),rr(e)}function fr(e){if(e.I=0,e.ja=[],e.l){const t=Je(e.h);0==t.length&&0==e.i.length||(p(e.ja,t),p(e.ja,e.i),e.h.i.length=0,h(e.i),e.i.length=0),e.l.oa()}}function gr(e,t,r){var n=r instanceof $e?et(r):new $e(r);if(""!=n.g)t&&(n.g=t+"."+n.g),rt(n,n.u);else{var i=s.location;n=i.protocol,t=t?t+"."+i.hostname:i.hostname,i=+i.port;const e=new $e(null);n&&tt(e,n),t&&(e.g=t),i&&rt(e,i),r&&(e.h=r),n=e}return r=e.G,t=e.wa,r&&t&&it(n,r,t),it(n,"VER",e.ka),sr(e,n),n}function yr(e,t,r){if(t&&!e.L)throw Error("Can't create secondary domain capable XhrIo object.");return(t=e.Aa&&!e.ma?new Vt(new Rt({ab:r})):new Vt(e.ma)).Fa(e.L),t}function _r(){}function vr(){}function xr(e,t){J.call(this),this.g=new $t(t),this.l=e,this.h=t&&t.messageUrlParams||null,e=t&&t.messageHeaders||null,t&&t.clientProtocolHeaderRequired&&(e?e["X-Client-Protocol"]="webchannel":e={"X-Client-Protocol":"webchannel"}),this.g.o=e,e=t&&t.initMessageHeaders||null,t&&t.messageContentType&&(e?e["X-WebChannel-Content-Type"]=t.messageContentType:e={"X-WebChannel-Content-Type":t.messageContentType}),t&&t.sa&&(e?e["X-WebChannel-Client-Profile"]=t.sa:e={"X-WebChannel-Client-Profile":t.sa}),this.g.U=e,(e=t&&t.Qb)&&!k(e)&&(this.g.u=e),this.A=t&&t.supportsCrossDomainXhr||!1,this.v=t&&t.sendRawJson||!1,(t=t&&t.httpSessionIdParam)&&!k(t)&&(this.g.G=t,null!==(e=this.h)&&t in e&&(t in(e=this.h)&&delete e[t])),this.j=new jr(this)}function br(e){de.call(this),e.__headers__&&(this.headers=e.__headers__,this.statusCode=e.__status__,delete e.__headers__,delete e.__status__);var t=e.__sm__;if(t){e:{for(const r in t){e=r;break e}e=void 0}(this.i=e)&&(e=this.i,t=null!==t&&e in t?t[e]:void 0),this.data=t}else this.data=e}function wr(){he.call(this),this.status=1}function jr(e){this.g=e}(e=Vt.prototype).Fa=function(e){this.H=e},e.ea=function(e,t,r,n){if(this.g)throw Error("[goog.net.XhrIo] Object is active with another request="+this.D+"; newUri="+e);t=t?t.toUpperCase():"GET",this.D=e,this.l="",this.o=0,this.A=!1,this.h=!0,this.g=this.L?this.L.g():Se.g(),this.g.onreadystatechange=d(l(this.Ca,this));try{this.B=!0,this.g.open(t,String(e),!0),this.B=!1}catch(o){return void Ht(this,o)}if(e=r||"",r=new Map(this.headers),n)if(Object.getPrototypeOf(n)===Object.prototype)for(var i in n)r.set(i,n[i]);else{if("function"!==typeof n.keys||"function"!==typeof n.get)throw Error("Unknown input type for opt_headers: "+String(n));for(const e of n.keys())r.set(e,n.get(e))}n=Array.from(r.keys()).find(e=>"content-type"==e.toLowerCase()),i=s.FormData&&e instanceof s.FormData,!(Array.prototype.indexOf.call(Wt,t,void 0)>=0)||n||i||r.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8");for(const[s,a]of r)this.g.setRequestHeader(s,a);this.F&&(this.g.responseType=this.F),"withCredentials"in this.g&&this.g.withCredentials!==this.H&&(this.g.withCredentials=this.H);try{this.m&&(clearTimeout(this.m),this.m=null),this.v=!0,this.g.send(e),this.v=!1}catch(o){Ht(this,o)}},e.abort=function(e){this.g&&this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1,this.o=e||7,Q(this,"complete"),Q(this,"abort"),Kt(this))},e.N=function(){this.g&&(this.h&&(this.h=!1,this.j=!0,this.g.abort(),this.j=!1),Kt(this,!0)),Vt.Z.N.call(this)},e.Ca=function(){this.u||(this.B||this.v||this.j?Zt(this):this.Xa())},e.Xa=function(){Zt(this)},e.isActive=function(){return!!this.g},e.ca=function(){try{return Xt(this)>2?this.g.status:-1}catch(e){return-1}},e.la=function(){try{return this.g?this.g.responseText:""}catch(e){return""}},e.La=function(e){if(this.g){var t=this.g.responseText;return e&&0==t.indexOf(e)&&(t=t.substring(e.length)),oe(t)}},e.ya=function(){return this.o},e.Ha=function(){return"string"===typeof this.l?this.l:String(this.l)},(e=$t.prototype).ka=8,e.I=1,e.connect=function(e,t,r,n){ve(0),this.W=e,this.H=t||{},r&&void 0!==n&&(this.H.OSID=r,this.H.OAID=n),this.F=this.X,this.J=gr(this,null,this.W),nr(this)},e.Ea=function(e){if(this.m)if(this.m=null,1==this.I){if(!e){this.V=Math.floor(1e5*Math.random()),e=this.V++;const i=new Ne(this,this.j,e);let s=this.o;if(this.U&&(s?(s=M(s),R(s,this.U)):s=this.U),null!==this.u||this.R||(i.J=s,s=null),this.S)e:{for(var t=0,r=0;r<this.i.length;r++){var n=this.i[r];if(void 0===(n="__data__"in n.map&&"string"===typeof(n=n.map.__data__)?n.length:void 0))break;if((t+=n)>4096){t=r;break e}if(4096===t||r===this.i.length-1){t=r+1;break e}}t=1e3}else t=1e3;t=or(this,i,t),it(r=et(this.J),"RID",e),it(r,"CVER",22),this.G&&it(r,"X-HTTP-Session-Id",this.G),sr(this,r),s&&(this.R?t="headers="+Ce(Bt(s))+"&"+t:this.u&&Ut(r,this.u,s)),Ye(this.h,i),this.Ra&&it(r,"TYPE","init"),this.S?(it(r,"$req",t),it(r,"SID","null"),i.U=!0,Le(i,r,null)):Le(i,r,t),this.I=2}}else 3==this.I&&(e?ir(this,e):0==this.i.length||Ge(this.h)||ir(this))},e.Da=function(){if(this.v=null,ur(this),this.aa&&!(this.P||null==this.g||this.T<=0)){var e=4*this.T;this.j.info("BP detection timer enabled: "+e),this.B=be(l(this.Wa,this),e)}},e.Wa=function(){this.B&&(this.B=null,this.j.info("BP detection timeout reached."),this.j.info("Buffering proxy detected and switch to long-polling!"),this.F=!1,this.P=!0,ve(10),tr(this),ur(this))},e.Va=function(){null!=this.C&&(this.C=null,tr(this),lr(this),ve(19))},e.bb=function(e){e?(this.j.info("Successfully pinged google.com"),ve(2)):(this.j.info("Failed to ping google.com"),ve(1))},e.isActive=function(){return!!this.l&&this.l.isActive(this)},(e=_r.prototype).ra=function(){},e.qa=function(){},e.pa=function(){},e.oa=function(){},e.isActive=function(){return!0},e.Ka=function(){},vr.prototype.g=function(e,t){return new xr(e,t)},u(xr,J),xr.prototype.m=function(){this.g.l=this.j,this.A&&(this.g.L=!0),this.g.connect(this.l,this.h||void 0)},xr.prototype.close=function(){er(this.g)},xr.prototype.o=function(e){var t=this.g;if("string"===typeof e){var r={};r.__data__=e,e=r}else this.v&&((r={}).__data__=se(e),e=r);t.i.push(new We(t.Ya++,e)),3==t.I&&nr(t)},xr.prototype.N=function(){this.g.l=null,delete this.j,er(this.g),delete this.g,xr.Z.N.call(this)},u(br,de),u(wr,he),u(jr,_r),jr.prototype.ra=function(){Q(this.g,"a")},jr.prototype.qa=function(e){Q(this.g,new br(e))},jr.prototype.pa=function(e){Q(this.g,new wr)},jr.prototype.oa=function(){Q(this.g,"b")},vr.prototype.createWebChannel=vr.prototype.g,xr.prototype.send=xr.prototype.o,xr.prototype.open=xr.prototype.m,xr.prototype.close=xr.prototype.close,ft=yt.createWebChannelTransport=function(){return new vr},mt=yt.getStatEventTarget=function(){return fe()},pt=yt.Event=pe,ht=yt.Stat={jb:0,mb:1,nb:2,Hb:3,Mb:4,Jb:5,Kb:6,Ib:7,Gb:8,Lb:9,PROXY:10,NOPROXY:11,Eb:12,Ab:13,Bb:14,zb:15,Cb:16,Db:17,fb:18,eb:19,gb:20},Te.NO_ERROR=0,Te.TIMEOUT=8,Te.HTTP_ERROR=6,dt=yt.ErrorCode=Te,ke.COMPLETE="complete",ut=yt.EventType=ke,ce.EventType=ue,ue.OPEN="a",ue.CLOSE="b",ue.ERROR="c",ue.MESSAGE="d",J.prototype.listen=J.prototype.J,ct=yt.WebChannel=ce,yt.FetchXmlHttpFactory=Rt,Vt.prototype.listenOnce=Vt.prototype.K,Vt.prototype.getLastError=Vt.prototype.Ha,Vt.prototype.getLastErrorCode=Vt.prototype.ya,Vt.prototype.getStatus=Vt.prototype.ca,Vt.prototype.getResponseJson=Vt.prototype.La,Vt.prototype.getResponseText=Vt.prototype.la,Vt.prototype.send=Vt.prototype.ea,Vt.prototype.setWithCredentials=Vt.prototype.Fa,lt=yt.XhrIo=Vt}).apply("undefined"!==typeof gt?gt:"undefined"!==typeof self?self:"undefined"!==typeof window?window:{});const _t="@firebase/firestore",vt="4.9.3";class xt{constructor(e){this.uid=e}isAuthenticated(){return null!=this.uid}toKey(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"}isEqual(e){return e.uid===this.uid}}xt.UNAUTHENTICATED=new xt(null),xt.GOOGLE_CREDENTIALS=new xt("google-credentials-uid"),xt.FIRST_PARTY=new xt("first-party-uid"),xt.MOCK_USER=new xt("mock-user");let bt="12.7.0";const wt=new B("@firebase/firestore");function jt(){return wt.logLevel}function St(e){if(wt.logLevel<=R.DEBUG){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const i=r.map(At);wt.debug("Firestore (".concat(bt,"): ").concat(e),...i)}}function Tt(e){if(wt.logLevel<=R.ERROR){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const i=r.map(At);wt.error("Firestore (".concat(bt,"): ").concat(e),...i)}}function kt(e){if(wt.logLevel<=R.WARN){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];const i=r.map(At);wt.warn("Firestore (".concat(bt,"): ").concat(e),...i)}}function At(e){if("string"==typeof e)return e;try{return function(e){return JSON.stringify(e)}(e)}catch(t){return e}}function Ct(e,t,r){let n="Unexpected state";"string"==typeof t?n=t:r=t,Et(e,n,r)}function Et(e,t,r){let n="FIRESTORE (".concat(bt,") INTERNAL ASSERTION FAILED: ").concat(t," (ID: ").concat(e.toString(16),")");if(void 0!==r)try{n+=" CONTEXT: "+JSON.stringify(r)}catch(e){n+=" CONTEXT: "+r}throw Tt(n),new Error(n)}function Nt(e,t,r,n){let i="Unexpected state";"string"==typeof r?i=r:n=r,e||Et(t,i,n)}function It(e,t){return e}const Pt={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Mt extends S{constructor(e,t){super(e,t),this.code=e,this.message=t,this.toString=()=>"".concat(this.name,": [code=").concat(this.code,"]: ").concat(this.message)}}class Lt{constructor(){this.promise=new Promise((e,t)=>{this.resolve=e,this.reject=t})}}class Rt{constructor(e,t){this.user=t,this.type="OAuth",this.headers=new Map,this.headers.set("Authorization","Bearer ".concat(e))}}class Dt{getToken(){return Promise.resolve(null)}invalidateToken(){}start(e,t){e.enqueueRetryable(()=>t(xt.UNAUTHENTICATED))}shutdown(){}}class Ft{constructor(e){this.token=e,this.changeListener=null}getToken(){return Promise.resolve(this.token)}invalidateToken(){}start(e,t){this.changeListener=t,e.enqueueRetryable(()=>t(this.token.user))}shutdown(){this.changeListener=null}}class Ot{constructor(e){this.t=e,this.currentUser=xt.UNAUTHENTICATED,this.i=0,this.forceRefresh=!1,this.auth=null}start(e,t){Nt(void 0===this.o,42304);let r=this.i;const n=e=>this.i!==r?(r=this.i,t(e)):Promise.resolve();let i=new Lt;this.o=()=>{this.i++,this.currentUser=this.u(),i.resolve(),i=new Lt,e.enqueueRetryable(()=>n(this.currentUser))};const s=()=>{const t=i;e.enqueueRetryable(async()=>{await t.promise,await n(this.currentUser)})},o=e=>{St("FirebaseAuthCredentialsProvider","Auth detected"),this.auth=e,this.o&&(this.auth.addAuthTokenListener(this.o),s())};this.t.onInit(e=>o(e)),setTimeout(()=>{if(!this.auth){const e=this.t.getImmediate({optional:!0});e?o(e):(St("FirebaseAuthCredentialsProvider","Auth not yet detected"),i.resolve(),i=new Lt)}},0),s()}getToken(){const e=this.i,t=this.forceRefresh;return this.forceRefresh=!1,this.auth?this.auth.getToken(t).then(t=>this.i!==e?(St("FirebaseAuthCredentialsProvider","getToken aborted due to token change."),this.getToken()):t?(Nt("string"==typeof t.accessToken,31837,{l:t}),new Rt(t.accessToken,this.currentUser)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.auth&&this.o&&this.auth.removeAuthTokenListener(this.o),this.o=void 0}u(){const e=this.auth&&this.auth.getUid();return Nt(null===e||"string"==typeof e,2055,{h:e}),new xt(e)}}class zt{constructor(e,t,r){this.P=e,this.T=t,this.I=r,this.type="FirstParty",this.user=xt.FIRST_PARTY,this.A=new Map}R(){return this.I?this.I():null}get headers(){this.A.set("X-Goog-AuthUser",this.P);const e=this.R();return e&&this.A.set("Authorization",e),this.T&&this.A.set("X-Goog-Iam-Authorization-Token",this.T),this.A}}class Bt{constructor(e,t,r){this.P=e,this.T=t,this.I=r}getToken(){return Promise.resolve(new zt(this.P,this.T,this.I))}start(e,t){e.enqueueRetryable(()=>t(xt.FIRST_PARTY))}shutdown(){}invalidateToken(){}}class Ut{constructor(e){this.value=e,this.type="AppCheck",this.headers=new Map,e&&e.length>0&&this.headers.set("x-firebase-appcheck",this.value)}}class Vt{constructor(e,t){this.V=t,this.forceRefresh=!1,this.appCheck=null,this.m=null,this.p=null,Ue(e)&&e.settings.appCheckToken&&(this.p=e.settings.appCheckToken)}start(e,t){Nt(void 0===this.o,3512);const r=e=>{null!=e.error&&St("FirebaseAppCheckTokenProvider","Error getting App Check token; using placeholder token instead. Error: ".concat(e.error.message));const r=e.token!==this.m;return this.m=e.token,St("FirebaseAppCheckTokenProvider","Received ".concat(r?"new":"existing"," token.")),r?t(e.token):Promise.resolve()};this.o=t=>{e.enqueueRetryable(()=>r(t))};const n=e=>{St("FirebaseAppCheckTokenProvider","AppCheck detected"),this.appCheck=e,this.o&&this.appCheck.addTokenListener(this.o)};this.V.onInit(e=>n(e)),setTimeout(()=>{if(!this.appCheck){const e=this.V.getImmediate({optional:!0});e?n(e):St("FirebaseAppCheckTokenProvider","AppCheck not yet detected")}},0)}getToken(){if(this.p)return Promise.resolve(new Ut(this.p));const e=this.forceRefresh;return this.forceRefresh=!1,this.appCheck?this.appCheck.getToken(e).then(e=>e?(Nt("string"==typeof e.token,44558,{tokenResult:e}),this.m=e.token,new Ut(e.token)):null):Promise.resolve(null)}invalidateToken(){this.forceRefresh=!0}shutdown(){this.appCheck&&this.o&&this.appCheck.removeTokenListener(this.o),this.o=void 0}}function qt(e){const t="undefined"!=typeof self&&(self.crypto||self.msCrypto),r=new Uint8Array(e);if(t&&"function"==typeof t.getRandomValues)t.getRandomValues(r);else for(let n=0;n<e;n++)r[n]=Math.floor(256*Math.random());return r}class Wt{static newId(){const e=62*Math.floor(256/62);let t="";for(;t.length<20;){const r=qt(40);for(let n=0;n<r.length;++n)t.length<20&&r[n]<e&&(t+="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789".charAt(r[n]%62))}return t}}function Ht(e,t){return e<t?-1:e>t?1:0}function Gt(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=e.charAt(n),i=t.charAt(n);if(r!==i)return Zt(r)===Zt(i)?Ht(r,i):Zt(r)?1:-1}return Ht(e.length,t.length)}function Zt(e){const t=e.charCodeAt(0);return t>=55296&&t<=57343}function Kt(e,t,r){return e.length===t.length&&e.every((e,n)=>r(e,t[n]))}const Yt="__name__";class Xt{constructor(e,t,r){void 0===t?t=0:t>e.length&&Ct(637,{offset:t,range:e.length}),void 0===r?r=e.length-t:r>e.length-t&&Ct(1746,{length:r,range:e.length-t}),this.segments=e,this.offset=t,this.len=r}get length(){return this.len}isEqual(e){return 0===Xt.comparator(this,e)}child(e){const t=this.segments.slice(this.offset,this.limit());return e instanceof Xt?e.forEach(e=>{t.push(e)}):t.push(e),this.construct(t)}limit(){return this.offset+this.length}popFirst(e){return e=void 0===e?1:e,this.construct(this.segments,this.offset+e,this.length-e)}popLast(){return this.construct(this.segments,this.offset,this.length-1)}firstSegment(){return this.segments[this.offset]}lastSegment(){return this.get(this.length-1)}get(e){return this.segments[this.offset+e]}isEmpty(){return 0===this.length}isPrefixOf(e){if(e.length<this.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}isImmediateParentOf(e){if(this.length+1!==e.length)return!1;for(let t=0;t<this.length;t++)if(this.get(t)!==e.get(t))return!1;return!0}forEach(e){for(let t=this.offset,r=this.limit();t<r;t++)e(this.segments[t])}toArray(){return this.segments.slice(this.offset,this.limit())}static comparator(e,t){const r=Math.min(e.length,t.length);for(let n=0;n<r;n++){const r=Xt.compareSegments(e.get(n),t.get(n));if(0!==r)return r}return Ht(e.length,t.length)}static compareSegments(e,t){const r=Xt.isNumericId(e),n=Xt.isNumericId(t);return r&&!n?-1:!r&&n?1:r&&n?Xt.extractNumericId(e).compare(Xt.extractNumericId(t)):Gt(e,t)}static isNumericId(e){return e.startsWith("__id")&&e.endsWith("__")}static extractNumericId(e){return it.fromString(e.substring(4,e.length-2))}}class Jt extends Xt{construct(e,t,r){return new Jt(e,t,r)}canonicalString(){return this.toArray().join("/")}toString(){return this.canonicalString()}toUriEncodedString(){return this.toArray().map(encodeURIComponent).join("/")}static fromString(){const e=[];for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const i of r){if(i.indexOf("//")>=0)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid segment (".concat(i,"). Paths must not contain // in them."));e.push(...i.split("/").filter(e=>e.length>0))}return new Jt(e)}static emptyPath(){return new Jt([])}}const Qt=/^[_a-zA-Z][_a-zA-Z0-9]*$/;class $t extends Xt{construct(e,t,r){return new $t(e,t,r)}static isValidIdentifier(e){return Qt.test(e)}canonicalString(){return this.toArray().map(e=>(e=e.replace(/\\/g,"\\\\").replace(/`/g,"\\`"),$t.isValidIdentifier(e)||(e="`"+e+"`"),e)).join(".")}toString(){return this.canonicalString()}isKeyField(){return 1===this.length&&this.get(0)===Yt}static keyField(){return new $t([Yt])}static fromServerFormat(e){const t=[];let r="",n=0;const i=()=>{if(0===r.length)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid field path (".concat(e,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"));t.push(r),r=""};let s=!1;for(;n<e.length;){const t=e[n];if("\\"===t){if(n+1===e.length)throw new Mt(Pt.INVALID_ARGUMENT,"Path has trailing escape character: "+e);const t=e[n+1];if("\\"!==t&&"."!==t&&"`"!==t)throw new Mt(Pt.INVALID_ARGUMENT,"Path has invalid escape sequence: "+e);r+=t,n+=2}else"`"===t?(s=!s,n++):"."!==t||s?(r+=t,n++):(i(),n++)}if(i(),s)throw new Mt(Pt.INVALID_ARGUMENT,"Unterminated ` in path: "+e);return new $t(t)}static emptyPath(){return new $t([])}}class er{constructor(e){this.path=e}static fromPath(e){return new er(Jt.fromString(e))}static fromName(e){return new er(Jt.fromString(e).popFirst(5))}static empty(){return new er(Jt.emptyPath())}get collectionGroup(){return this.path.popLast().lastSegment()}hasCollectionId(e){return this.path.length>=2&&this.path.get(this.path.length-2)===e}getCollectionGroup(){return this.path.get(this.path.length-2)}getCollectionPath(){return this.path.popLast()}isEqual(e){return null!==e&&0===Jt.comparator(this.path,e.path)}toString(){return this.path.toString()}static comparator(e,t){return Jt.comparator(e.path,t.path)}static isDocumentKey(e){return e.length%2==0}static fromSegments(e){return new er(new Jt(e.slice()))}}function tr(e,t,r){if(!r)throw new Mt(Pt.INVALID_ARGUMENT,"Function ".concat(e,"() cannot be called with an empty ").concat(t,"."))}function rr(e){if(!er.isDocumentKey(e))throw new Mt(Pt.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but ".concat(e," has ").concat(e.length,"."))}function nr(e){if(er.isDocumentKey(e))throw new Mt(Pt.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but ".concat(e," has ").concat(e.length,"."))}function ir(e){return"object"==typeof e&&null!==e&&(Object.getPrototypeOf(e)===Object.prototype||null===Object.getPrototypeOf(e))}function sr(e){if(void 0===e)return"undefined";if(null===e)return"null";if("string"==typeof e)return e.length>20&&(e="".concat(e.substring(0,20),"...")),JSON.stringify(e);if("number"==typeof e||"boolean"==typeof e)return""+e;if("object"==typeof e){if(e instanceof Array)return"an array";{const t=function(e){return e.constructor?e.constructor.name:null}(e);return t?"a custom ".concat(t," object"):"an object"}}return"function"==typeof e?"a function":Ct(12329,{type:typeof e})}function or(e,t){if("_delegate"in e&&(e=e._delegate),!(e instanceof t)){if(t.name===e.constructor.name)throw new Mt(Pt.INVALID_ARGUMENT,"Type does not match the expected instance. Did you pass a reference from a different Firestore SDK?");{const r=sr(e);throw new Mt(Pt.INVALID_ARGUMENT,"Expected type '".concat(t.name,"', but it was: ").concat(r))}}return e}function ar(e,t){const r={typeString:e};return t&&(r.value=t),r}function lr(e,t){if(!ir(e))throw new Mt(Pt.INVALID_ARGUMENT,"JSON must be an object");let r;for(const n in t)if(t[n]){const i=t[n].typeString,s="value"in t[n]?{value:t[n].value}:void 0;if(!(n in e)){r="JSON missing required field: '".concat(n,"'");break}const o=e[n];if(i&&typeof o!==i){r="JSON field '".concat(n,"' must be a ").concat(i,".");break}if(void 0!==s&&o!==s.value){r="Expected '".concat(n,"' field to equal '").concat(s.value,"'");break}}if(r)throw new Mt(Pt.INVALID_ARGUMENT,r);return!0}const cr=-62135596800,ur=1e6;class dr{static now(){return dr.fromMillis(Date.now())}static fromDate(e){return dr.fromMillis(e.getTime())}static fromMillis(e){const t=Math.floor(e/1e3),r=Math.floor((e-1e3*t)*ur);return new dr(t,r)}constructor(e,t){if(this.seconds=e,this.nanoseconds=t,t<0)throw new Mt(Pt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(t>=1e9)throw new Mt(Pt.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+t);if(e<cr)throw new Mt(Pt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e);if(e>=253402300800)throw new Mt(Pt.INVALID_ARGUMENT,"Timestamp seconds out of range: "+e)}toDate(){return new Date(this.toMillis())}toMillis(){return 1e3*this.seconds+this.nanoseconds/ur}_compareTo(e){return this.seconds===e.seconds?Ht(this.nanoseconds,e.nanoseconds):Ht(this.seconds,e.seconds)}isEqual(e){return e.seconds===this.seconds&&e.nanoseconds===this.nanoseconds}toString(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"}toJSON(){return{type:dr._jsonSchemaVersion,seconds:this.seconds,nanoseconds:this.nanoseconds}}static fromJSON(e){if(lr(e,dr._jsonSchema))return new dr(e.seconds,e.nanoseconds)}valueOf(){const e=this.seconds-cr;return String(e).padStart(12,"0")+"."+String(this.nanoseconds).padStart(9,"0")}}dr._jsonSchemaVersion="firestore/timestamp/1.0",dr._jsonSchema={type:ar("string",dr._jsonSchemaVersion),seconds:ar("number"),nanoseconds:ar("number")};class hr{static fromTimestamp(e){return new hr(e)}static min(){return new hr(new dr(0,0))}static max(){return new hr(new dr(253402300799,999999999))}constructor(e){this.timestamp=e}compareTo(e){return this.timestamp._compareTo(e.timestamp)}isEqual(e){return this.timestamp.isEqual(e.timestamp)}toMicroseconds(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3}toString(){return"SnapshotVersion("+this.timestamp.toString()+")"}toTimestamp(){return this.timestamp}}const pr=-1;class mr{constructor(e,t,r,n){this.indexId=e,this.collectionGroup=t,this.fields=r,this.indexState=n}}mr.UNKNOWN_ID=-1;function fr(e,t){const r=e.toTimestamp().seconds,n=e.toTimestamp().nanoseconds+1,i=hr.fromTimestamp(1e9===n?new dr(r+1,0):new dr(r,n));return new yr(i,er.empty(),t)}function gr(e){return new yr(e.readTime,e.key,pr)}class yr{constructor(e,t,r){this.readTime=e,this.documentKey=t,this.largestBatchId=r}static min(){return new yr(hr.min(),er.empty(),pr)}static max(){return new yr(hr.max(),er.empty(),pr)}}function _r(e,t){let r=e.readTime.compareTo(t.readTime);return 0!==r?r:(r=er.comparator(e.documentKey,t.documentKey),0!==r?r:Ht(e.largestBatchId,t.largestBatchId))}const vr="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.";class xr{constructor(){this.onCommittedListeners=[]}addOnCommittedListener(e){this.onCommittedListeners.push(e)}raiseOnCommittedEvent(){this.onCommittedListeners.forEach(e=>e())}}async function br(e){if(e.code!==Pt.FAILED_PRECONDITION||e.message!==vr)throw e;St("LocalStore","Unexpectedly lost primary lease")}class wr{constructor(e){this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,e(e=>{this.isDone=!0,this.result=e,this.nextCallback&&this.nextCallback(e)},e=>{this.isDone=!0,this.error=e,this.catchCallback&&this.catchCallback(e)})}catch(e){return this.next(void 0,e)}next(e,t){return this.callbackAttached&&Ct(59440),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(t,this.error):this.wrapSuccess(e,this.result):new wr((r,n)=>{this.nextCallback=t=>{this.wrapSuccess(e,t).next(r,n)},this.catchCallback=e=>{this.wrapFailure(t,e).next(r,n)}})}toPromise(){return new Promise((e,t)=>{this.next(e,t)})}wrapUserFunction(e){try{const t=e();return t instanceof wr?t:wr.resolve(t)}catch(e){return wr.reject(e)}}wrapSuccess(e,t){return e?this.wrapUserFunction(()=>e(t)):wr.resolve(t)}wrapFailure(e,t){return e?this.wrapUserFunction(()=>e(t)):wr.reject(t)}static resolve(e){return new wr((t,r)=>{t(e)})}static reject(e){return new wr((t,r)=>{r(e)})}static waitFor(e){return new wr((t,r)=>{let n=0,i=0,s=!1;e.forEach(e=>{++n,e.next(()=>{++i,s&&i===n&&t()},e=>r(e))}),s=!0,i===n&&t()})}static or(e){let t=wr.resolve(!1);for(const r of e)t=t.next(e=>e?wr.resolve(e):r());return t}static forEach(e,t){const r=[];return e.forEach((e,n)=>{r.push(t.call(this,e,n))}),this.waitFor(r)}static mapArray(e,t){return new wr((r,n)=>{const i=e.length,s=new Array(i);let o=0;for(let a=0;a<i;a++){const l=a;t(e[l]).next(e=>{s[l]=e,++o,o===i&&r(s)},e=>n(e))}})}static doWhile(e,t){return new wr((r,n)=>{const i=()=>{!0===e()?t().next(()=>{i()},n):r()};i()})}}function jr(e){const t=e.match(/Android ([\d.]+)/i),r=t?t[1].split(".").slice(0,2).join("."):"-1";return Number(r)}function Sr(e){return"IndexedDbTransactionError"===e.name}class Tr{constructor(e,t){this.previousValue=e,t&&(t.sequenceNumberHandler=e=>this.ae(e),this.ue=e=>t.writeSequenceNumber(e))}ae(e){return this.previousValue=Math.max(e,this.previousValue),this.previousValue}next(){const e=++this.previousValue;return this.ue&&this.ue(e),e}}Tr.ce=-1;const kr=-1;function Ar(e){return null==e}function Cr(e){return 0===e&&1/e==-1/0}function Er(e){return"number"==typeof e&&Number.isInteger(e)&&!Cr(e)&&e<=Number.MAX_SAFE_INTEGER&&e>=Number.MIN_SAFE_INTEGER}const Nr="\x01";function Ir(e){let t="";for(let r=0;r<e.length;r++)t.length>0&&(t=Mr(t)),t=Pr(e.get(r),t);return Mr(t)}function Pr(e,t){let r=t;const n=e.length;for(let i=0;i<n;i++){const t=e.charAt(i);switch(t){case"\0":r+="\x01\x10";break;case Nr:r+="\x01\x11";break;default:r+=t}}return r}function Mr(e){return e+Nr+"\x01"}const Lr="remoteDocuments",Rr="owner",Dr="mutationQueues",Fr="mutations";const Or="documentMutations",zr="remoteDocumentsV14",Br="remoteDocumentGlobal",Ur="targets",Vr="targetDocuments",qr="targetGlobal",Wr="collectionParents",Hr="clientMetadata",Gr="bundles",Zr="namedQueries",Kr="indexConfiguration",Yr="indexState",Xr="indexEntries",Jr="documentOverlays",Qr="globals",$r=[Dr,Fr,Or,Lr,Ur,Rr,qr,Vr,Hr,Br,Wr,Gr,Zr],en=[Dr,Fr,Or,zr,Ur,Rr,qr,Vr,Hr,Br,Wr,Gr,Zr,Jr],tn=en,rn=[...tn,Kr,Yr,Xr];function nn(e){let t=0;for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t++;return t}function sn(e,t){for(const r in e)Object.prototype.hasOwnProperty.call(e,r)&&t(r,e[r])}function on(e){for(const t in e)if(Object.prototype.hasOwnProperty.call(e,t))return!1;return!0}class an{constructor(e,t){this.comparator=e,this.root=t||cn.EMPTY}insert(e,t){return new an(this.comparator,this.root.insert(e,t,this.comparator).copy(null,null,cn.BLACK,null,null))}remove(e){return new an(this.comparator,this.root.remove(e,this.comparator).copy(null,null,cn.BLACK,null,null))}get(e){let t=this.root;for(;!t.isEmpty();){const r=this.comparator(e,t.key);if(0===r)return t.value;r<0?t=t.left:r>0&&(t=t.right)}return null}indexOf(e){let t=0,r=this.root;for(;!r.isEmpty();){const n=this.comparator(e,r.key);if(0===n)return t+r.left.size;n<0?r=r.left:(t+=r.left.size+1,r=r.right)}return-1}isEmpty(){return this.root.isEmpty()}get size(){return this.root.size}minKey(){return this.root.minKey()}maxKey(){return this.root.maxKey()}inorderTraversal(e){return this.root.inorderTraversal(e)}forEach(e){this.inorderTraversal((t,r)=>(e(t,r),!1))}toString(){const e=[];return this.inorderTraversal((t,r)=>(e.push("".concat(t,":").concat(r)),!1)),"{".concat(e.join(", "),"}")}reverseTraversal(e){return this.root.reverseTraversal(e)}getIterator(){return new ln(this.root,null,this.comparator,!1)}getIteratorFrom(e){return new ln(this.root,e,this.comparator,!1)}getReverseIterator(){return new ln(this.root,null,this.comparator,!0)}getReverseIteratorFrom(e){return new ln(this.root,e,this.comparator,!0)}}class ln{constructor(e,t,r,n){this.isReverse=n,this.nodeStack=[];let i=1;for(;!e.isEmpty();)if(i=t?r(e.key,t):1,t&&n&&(i*=-1),i<0)e=this.isReverse?e.left:e.right;else{if(0===i){this.nodeStack.push(e);break}this.nodeStack.push(e),e=this.isReverse?e.right:e.left}}getNext(){let e=this.nodeStack.pop();const t={key:e.key,value:e.value};if(this.isReverse)for(e=e.left;!e.isEmpty();)this.nodeStack.push(e),e=e.right;else for(e=e.right;!e.isEmpty();)this.nodeStack.push(e),e=e.left;return t}hasNext(){return this.nodeStack.length>0}peek(){if(0===this.nodeStack.length)return null;const e=this.nodeStack[this.nodeStack.length-1];return{key:e.key,value:e.value}}}class cn{constructor(e,t,r,n,i){this.key=e,this.value=t,this.color=null!=r?r:cn.RED,this.left=null!=n?n:cn.EMPTY,this.right=null!=i?i:cn.EMPTY,this.size=this.left.size+1+this.right.size}copy(e,t,r,n,i){return new cn(null!=e?e:this.key,null!=t?t:this.value,null!=r?r:this.color,null!=n?n:this.left,null!=i?i:this.right)}isEmpty(){return!1}inorderTraversal(e){return this.left.inorderTraversal(e)||e(this.key,this.value)||this.right.inorderTraversal(e)}reverseTraversal(e){return this.right.reverseTraversal(e)||e(this.key,this.value)||this.left.reverseTraversal(e)}min(){return this.left.isEmpty()?this:this.left.min()}minKey(){return this.min().key}maxKey(){return this.right.isEmpty()?this.key:this.right.maxKey()}insert(e,t,r){let n=this;const i=r(e,n.key);return n=i<0?n.copy(null,null,null,n.left.insert(e,t,r),null):0===i?n.copy(null,t,null,null,null):n.copy(null,null,null,null,n.right.insert(e,t,r)),n.fixUp()}removeMin(){if(this.left.isEmpty())return cn.EMPTY;let e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),e=e.copy(null,null,null,e.left.removeMin(),null),e.fixUp()}remove(e,t){let r,n=this;if(t(e,n.key)<0)n.left.isEmpty()||n.left.isRed()||n.left.left.isRed()||(n=n.moveRedLeft()),n=n.copy(null,null,null,n.left.remove(e,t),null);else{if(n.left.isRed()&&(n=n.rotateRight()),n.right.isEmpty()||n.right.isRed()||n.right.left.isRed()||(n=n.moveRedRight()),0===t(e,n.key)){if(n.right.isEmpty())return cn.EMPTY;r=n.right.min(),n=n.copy(r.key,r.value,null,null,n.right.removeMin())}n=n.copy(null,null,null,null,n.right.remove(e,t))}return n.fixUp()}isRed(){return this.color}fixUp(){let e=this;return e.right.isRed()&&!e.left.isRed()&&(e=e.rotateLeft()),e.left.isRed()&&e.left.left.isRed()&&(e=e.rotateRight()),e.left.isRed()&&e.right.isRed()&&(e=e.colorFlip()),e}moveRedLeft(){let e=this.colorFlip();return e.right.left.isRed()&&(e=e.copy(null,null,null,null,e.right.rotateRight()),e=e.rotateLeft(),e=e.colorFlip()),e}moveRedRight(){let e=this.colorFlip();return e.left.left.isRed()&&(e=e.rotateRight(),e=e.colorFlip()),e}rotateLeft(){const e=this.copy(null,null,cn.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)}rotateRight(){const e=this.copy(null,null,cn.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)}colorFlip(){const e=this.left.copy(null,null,!this.left.color,null,null),t=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,e,t)}checkMaxDepth(){const e=this.check();return Math.pow(2,e)<=this.size+1}check(){if(this.isRed()&&this.left.isRed())throw Ct(43730,{key:this.key,value:this.value});if(this.right.isRed())throw Ct(14113,{key:this.key,value:this.value});const e=this.left.check();if(e!==this.right.check())throw Ct(27949);return e+(this.isRed()?0:1)}}cn.EMPTY=null,cn.RED=!0,cn.BLACK=!1,cn.EMPTY=new class{constructor(){this.size=0}get key(){throw Ct(57766)}get value(){throw Ct(16141)}get color(){throw Ct(16727)}get left(){throw Ct(29726)}get right(){throw Ct(36894)}copy(e,t,r,n,i){return this}insert(e,t,r){return new cn(e,t)}remove(e,t){return this}isEmpty(){return!0}inorderTraversal(e){return!1}reverseTraversal(e){return!1}minKey(){return null}maxKey(){return null}isRed(){return!1}checkMaxDepth(){return!0}check(){return 0}};class un{constructor(e){this.comparator=e,this.data=new an(this.comparator)}has(e){return null!==this.data.get(e)}first(){return this.data.minKey()}last(){return this.data.maxKey()}get size(){return this.data.size}indexOf(e){return this.data.indexOf(e)}forEach(e){this.data.inorderTraversal((t,r)=>(e(t),!1))}forEachInRange(e,t){const r=this.data.getIteratorFrom(e[0]);for(;r.hasNext();){const n=r.getNext();if(this.comparator(n.key,e[1])>=0)return;t(n.key)}}forEachWhile(e,t){let r;for(r=void 0!==t?this.data.getIteratorFrom(t):this.data.getIterator();r.hasNext();)if(!e(r.getNext().key))return}firstAfterOrEqual(e){const t=this.data.getIteratorFrom(e);return t.hasNext()?t.getNext().key:null}getIterator(){return new dn(this.data.getIterator())}getIteratorFrom(e){return new dn(this.data.getIteratorFrom(e))}add(e){return this.copy(this.data.remove(e).insert(e,!0))}delete(e){return this.has(e)?this.copy(this.data.remove(e)):this}isEmpty(){return this.data.isEmpty()}unionWith(e){let t=this;return t.size<e.size&&(t=e,e=this),e.forEach(e=>{t=t.add(e)}),t}isEqual(e){if(!(e instanceof un))return!1;if(this.size!==e.size)return!1;const t=this.data.getIterator(),r=e.data.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(0!==this.comparator(e,n))return!1}return!0}toArray(){const e=[];return this.forEach(t=>{e.push(t)}),e}toString(){const e=[];return this.forEach(t=>e.push(t)),"SortedSet("+e.toString()+")"}copy(e){const t=new un(this.comparator);return t.data=e,t}}class dn{constructor(e){this.iter=e}getNext(){return this.iter.getNext().key}hasNext(){return this.iter.hasNext()}}class hn{constructor(e){this.fields=e,e.sort($t.comparator)}static empty(){return new hn([])}unionWith(e){let t=new un($t.comparator);for(const r of this.fields)t=t.add(r);for(const r of e)t=t.add(r);return new hn(t.toArray())}covers(e){for(const t of this.fields)if(t.isPrefixOf(e))return!0;return!1}isEqual(e){return Kt(this.fields,e.fields,(e,t)=>e.isEqual(t))}}class pn extends Error{constructor(){super(...arguments),this.name="Base64DecodeError"}}class mn{constructor(e){this.binaryString=e}static fromBase64String(e){const t=function(e){try{return atob(e)}catch(e){throw"undefined"!=typeof DOMException&&e instanceof DOMException?new pn("Invalid base64 string: "+e):e}}(e);return new mn(t)}static fromUint8Array(e){const t=function(e){let t="";for(let r=0;r<e.length;++r)t+=String.fromCharCode(e[r]);return t}(e);return new mn(t)}[Symbol.iterator](){let e=0;return{next:()=>e<this.binaryString.length?{value:this.binaryString.charCodeAt(e++),done:!1}:{value:void 0,done:!0}}}toBase64(){return e=this.binaryString,btoa(e);var e}toUint8Array(){return function(e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t}(this.binaryString)}approximateByteSize(){return 2*this.binaryString.length}compareTo(e){return Ht(this.binaryString,e.binaryString)}isEqual(e){return this.binaryString===e.binaryString}}mn.EMPTY_BYTE_STRING=new mn("");const fn=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function gn(e){if(Nt(!!e,39018),"string"==typeof e){let t=0;const r=fn.exec(e);if(Nt(!!r,46558,{timestamp:e}),r[1]){let e=r[1];e=(e+"000000000").substr(0,9),t=Number(e)}const n=new Date(e);return{seconds:Math.floor(n.getTime()/1e3),nanos:t}}return{seconds:yn(e.seconds),nanos:yn(e.nanos)}}function yn(e){return"number"==typeof e?e:"string"==typeof e?Number(e):0}function _n(e){return"string"==typeof e?mn.fromBase64String(e):mn.fromUint8Array(e)}const vn="server_timestamp",xn="__type__",bn="__previous_value__",wn="__local_write_time__";function jn(e){var t,r;return(null===(t=((null===e||void 0===e||null===(r=e.mapValue)||void 0===r?void 0:r.fields)||{})[xn])||void 0===t?void 0:t.stringValue)===vn}function Sn(e){const t=e.mapValue.fields[bn];return jn(t)?Sn(t):t}function Tn(e){const t=gn(e.mapValue.fields[wn].timestampValue);return new dr(t.seconds,t.nanos)}class kn{constructor(e,t,r,n,i,s,o,a,l,c){this.databaseId=e,this.appId=t,this.persistenceKey=r,this.host=n,this.ssl=i,this.forceLongPolling=s,this.autoDetectLongPolling=o,this.longPollingOptions=a,this.useFetchStreams=l,this.isUsingEmulator=c}}const An="(default)";class Cn{constructor(e,t){this.projectId=e,this.database=t||An}static empty(){return new Cn("","")}get isDefaultDatabase(){return this.database===An}isEqual(e){return e instanceof Cn&&e.projectId===this.projectId&&e.database===this.database}}const En="__type__",Nn="__max__",In={mapValue:{fields:{__type__:{stringValue:Nn}}}},Pn="__vector__",Mn="value";function Ln(e){return"nullValue"in e?0:"booleanValue"in e?1:"integerValue"in e||"doubleValue"in e?2:"timestampValue"in e?3:"stringValue"in e?5:"bytesValue"in e?6:"referenceValue"in e?7:"geoPointValue"in e?8:"arrayValue"in e?9:"mapValue"in e?jn(e)?4:Jn(e)?9007199254740991:Yn(e)?10:11:Ct(28295,{value:e})}function Rn(e,t){if(e===t)return!0;const r=Ln(e);if(r!==Ln(t))return!1;switch(r){case 0:case 9007199254740991:return!0;case 1:return e.booleanValue===t.booleanValue;case 4:return Tn(e).isEqual(Tn(t));case 3:return function(e,t){if("string"==typeof e.timestampValue&&"string"==typeof t.timestampValue&&e.timestampValue.length===t.timestampValue.length)return e.timestampValue===t.timestampValue;const r=gn(e.timestampValue),n=gn(t.timestampValue);return r.seconds===n.seconds&&r.nanos===n.nanos}(e,t);case 5:return e.stringValue===t.stringValue;case 6:return function(e,t){return _n(e.bytesValue).isEqual(_n(t.bytesValue))}(e,t);case 7:return e.referenceValue===t.referenceValue;case 8:return function(e,t){return yn(e.geoPointValue.latitude)===yn(t.geoPointValue.latitude)&&yn(e.geoPointValue.longitude)===yn(t.geoPointValue.longitude)}(e,t);case 2:return function(e,t){if("integerValue"in e&&"integerValue"in t)return yn(e.integerValue)===yn(t.integerValue);if("doubleValue"in e&&"doubleValue"in t){const r=yn(e.doubleValue),n=yn(t.doubleValue);return r===n?Cr(r)===Cr(n):isNaN(r)&&isNaN(n)}return!1}(e,t);case 9:return Kt(e.arrayValue.values||[],t.arrayValue.values||[],Rn);case 10:case 11:return function(e,t){const r=e.mapValue.fields||{},n=t.mapValue.fields||{};if(nn(r)!==nn(n))return!1;for(const i in r)if(r.hasOwnProperty(i)&&(void 0===n[i]||!Rn(r[i],n[i])))return!1;return!0}(e,t);default:return Ct(52216,{left:e})}}function Dn(e,t){return void 0!==(e.values||[]).find(e=>Rn(e,t))}function Fn(e,t){if(e===t)return 0;const r=Ln(e),n=Ln(t);if(r!==n)return Ht(r,n);switch(r){case 0:case 9007199254740991:return 0;case 1:return Ht(e.booleanValue,t.booleanValue);case 2:return function(e,t){const r=yn(e.integerValue||e.doubleValue),n=yn(t.integerValue||t.doubleValue);return r<n?-1:r>n?1:r===n?0:isNaN(r)?isNaN(n)?0:-1:1}(e,t);case 3:return On(e.timestampValue,t.timestampValue);case 4:return On(Tn(e),Tn(t));case 5:return Gt(e.stringValue,t.stringValue);case 6:return function(e,t){const r=_n(e),n=_n(t);return r.compareTo(n)}(e.bytesValue,t.bytesValue);case 7:return function(e,t){const r=e.split("/"),n=t.split("/");for(let i=0;i<r.length&&i<n.length;i++){const e=Ht(r[i],n[i]);if(0!==e)return e}return Ht(r.length,n.length)}(e.referenceValue,t.referenceValue);case 8:return function(e,t){const r=Ht(yn(e.latitude),yn(t.latitude));return 0!==r?r:Ht(yn(e.longitude),yn(t.longitude))}(e.geoPointValue,t.geoPointValue);case 9:return zn(e.arrayValue,t.arrayValue);case 10:return function(e,t){var r,n,i,s;const o=e.fields||{},a=t.fields||{},l=null===(r=o[Mn])||void 0===r?void 0:r.arrayValue,c=null===(n=a[Mn])||void 0===n?void 0:n.arrayValue,u=Ht((null===l||void 0===l||null===(i=l.values)||void 0===i?void 0:i.length)||0,(null===c||void 0===c||null===(s=c.values)||void 0===s?void 0:s.length)||0);return 0!==u?u:zn(l,c)}(e.mapValue,t.mapValue);case 11:return function(e,t){if(e===In.mapValue&&t===In.mapValue)return 0;if(e===In.mapValue)return 1;if(t===In.mapValue)return-1;const r=e.fields||{},n=Object.keys(r),i=t.fields||{},s=Object.keys(i);n.sort(),s.sort();for(let o=0;o<n.length&&o<s.length;++o){const e=Gt(n[o],s[o]);if(0!==e)return e;const t=Fn(r[n[o]],i[s[o]]);if(0!==t)return t}return Ht(n.length,s.length)}(e.mapValue,t.mapValue);default:throw Ct(23264,{he:r})}}function On(e,t){if("string"==typeof e&&"string"==typeof t&&e.length===t.length)return Ht(e,t);const r=gn(e),n=gn(t),i=Ht(r.seconds,n.seconds);return 0!==i?i:Ht(r.nanos,n.nanos)}function zn(e,t){const r=e.values||[],n=t.values||[];for(let i=0;i<r.length&&i<n.length;++i){const e=Fn(r[i],n[i]);if(e)return e}return Ht(r.length,n.length)}function Bn(e){return Un(e)}function Un(e){return"nullValue"in e?"null":"booleanValue"in e?""+e.booleanValue:"integerValue"in e?""+e.integerValue:"doubleValue"in e?""+e.doubleValue:"timestampValue"in e?function(e){const t=gn(e);return"time(".concat(t.seconds,",").concat(t.nanos,")")}(e.timestampValue):"stringValue"in e?e.stringValue:"bytesValue"in e?function(e){return _n(e).toBase64()}(e.bytesValue):"referenceValue"in e?function(e){return er.fromName(e).toString()}(e.referenceValue):"geoPointValue"in e?function(e){return"geo(".concat(e.latitude,",").concat(e.longitude,")")}(e.geoPointValue):"arrayValue"in e?function(e){let t="[",r=!0;for(const n of e.values||[])r?r=!1:t+=",",t+=Un(n);return t+"]"}(e.arrayValue):"mapValue"in e?function(e){const t=Object.keys(e.fields||{}).sort();let r="{",n=!0;for(const i of t)n?n=!1:r+=",",r+="".concat(i,":").concat(Un(e.fields[i]));return r+"}"}(e.mapValue):Ct(61005,{value:e})}function Vn(e){switch(Ln(e)){case 0:case 1:return 4;case 2:return 8;case 3:case 8:return 16;case 4:const t=Sn(e);return t?16+Vn(t):16;case 5:return 2*e.stringValue.length;case 6:return _n(e.bytesValue).approximateByteSize();case 7:return e.referenceValue.length;case 9:return function(e){return(e.values||[]).reduce((e,t)=>e+Vn(t),0)}(e.arrayValue);case 10:case 11:return function(e){let t=0;return sn(e.fields,(e,r)=>{t+=e.length+Vn(r)}),t}(e.mapValue);default:throw Ct(13486,{value:e})}}function qn(e,t){return{referenceValue:"projects/".concat(e.projectId,"/databases/").concat(e.database,"/documents/").concat(t.path.canonicalString())}}function Wn(e){return!!e&&"integerValue"in e}function Hn(e){return!!e&&"arrayValue"in e}function Gn(e){return!!e&&"nullValue"in e}function Zn(e){return!!e&&"doubleValue"in e&&isNaN(Number(e.doubleValue))}function Kn(e){return!!e&&"mapValue"in e}function Yn(e){var t,r;return(null===(t=((null===e||void 0===e||null===(r=e.mapValue)||void 0===r?void 0:r.fields)||{})[En])||void 0===t?void 0:t.stringValue)===Pn}function Xn(e){if(e.geoPointValue)return{geoPointValue:(0,n.A)({},e.geoPointValue)};if(e.timestampValue&&"object"==typeof e.timestampValue)return{timestampValue:(0,n.A)({},e.timestampValue)};if(e.mapValue){const t={mapValue:{fields:{}}};return sn(e.mapValue.fields,(e,r)=>t.mapValue.fields[e]=Xn(r)),t}if(e.arrayValue){const t={arrayValue:{values:[]}};for(let r=0;r<(e.arrayValue.values||[]).length;++r)t.arrayValue.values[r]=Xn(e.arrayValue.values[r]);return t}return(0,n.A)({},e)}function Jn(e){return(((e.mapValue||{}).fields||{}).__type__||{}).stringValue===Nn}class Qn{constructor(e){this.value=e}static empty(){return new Qn({mapValue:{}})}field(e){if(e.isEmpty())return this.value;{let t=this.value;for(let r=0;r<e.length-1;++r)if(t=(t.mapValue.fields||{})[e.get(r)],!Kn(t))return null;return t=(t.mapValue.fields||{})[e.lastSegment()],t||null}}set(e,t){this.getFieldsMap(e.popLast())[e.lastSegment()]=Xn(t)}setAll(e){let t=$t.emptyPath(),r={},n=[];e.forEach((e,i)=>{if(!t.isImmediateParentOf(i)){const e=this.getFieldsMap(t);this.applyChanges(e,r,n),r={},n=[],t=i.popLast()}e?r[i.lastSegment()]=Xn(e):n.push(i.lastSegment())});const i=this.getFieldsMap(t);this.applyChanges(i,r,n)}delete(e){const t=this.field(e.popLast());Kn(t)&&t.mapValue.fields&&delete t.mapValue.fields[e.lastSegment()]}isEqual(e){return Rn(this.value,e.value)}getFieldsMap(e){let t=this.value;t.mapValue.fields||(t.mapValue={fields:{}});for(let r=0;r<e.length;++r){let n=t.mapValue.fields[e.get(r)];Kn(n)&&n.mapValue.fields||(n={mapValue:{fields:{}}},t.mapValue.fields[e.get(r)]=n),t=n}return t.mapValue.fields}applyChanges(e,t,r){sn(t,(t,r)=>e[t]=r);for(const n of r)delete e[n]}clone(){return new Qn(Xn(this.value))}}function $n(e){const t=[];return sn(e.fields,(e,r)=>{const n=new $t([e]);if(Kn(r)){const e=$n(r.mapValue).fields;if(0===e.length)t.push(n);else for(const r of e)t.push(n.child(r))}else t.push(n)}),new hn(t)}class ei{constructor(e,t,r,n,i,s,o){this.key=e,this.documentType=t,this.version=r,this.readTime=n,this.createTime=i,this.data=s,this.documentState=o}static newInvalidDocument(e){return new ei(e,0,hr.min(),hr.min(),hr.min(),Qn.empty(),0)}static newFoundDocument(e,t,r,n){return new ei(e,1,t,hr.min(),r,n,0)}static newNoDocument(e,t){return new ei(e,2,t,hr.min(),hr.min(),Qn.empty(),0)}static newUnknownDocument(e,t){return new ei(e,3,t,hr.min(),hr.min(),Qn.empty(),2)}convertToFoundDocument(e,t){return!this.createTime.isEqual(hr.min())||2!==this.documentType&&0!==this.documentType||(this.createTime=e),this.version=e,this.documentType=1,this.data=t,this.documentState=0,this}convertToNoDocument(e){return this.version=e,this.documentType=2,this.data=Qn.empty(),this.documentState=0,this}convertToUnknownDocument(e){return this.version=e,this.documentType=3,this.data=Qn.empty(),this.documentState=2,this}setHasCommittedMutations(){return this.documentState=2,this}setHasLocalMutations(){return this.documentState=1,this.version=hr.min(),this}setReadTime(e){return this.readTime=e,this}get hasLocalMutations(){return 1===this.documentState}get hasCommittedMutations(){return 2===this.documentState}get hasPendingWrites(){return this.hasLocalMutations||this.hasCommittedMutations}isValidDocument(){return 0!==this.documentType}isFoundDocument(){return 1===this.documentType}isNoDocument(){return 2===this.documentType}isUnknownDocument(){return 3===this.documentType}isEqual(e){return e instanceof ei&&this.key.isEqual(e.key)&&this.version.isEqual(e.version)&&this.documentType===e.documentType&&this.documentState===e.documentState&&this.data.isEqual(e.data)}mutableCopy(){return new ei(this.key,this.documentType,this.version,this.readTime,this.createTime,this.data.clone(),this.documentState)}toString(){return"Document(".concat(this.key,", ").concat(this.version,", ").concat(JSON.stringify(this.data.value),", {createTime: ").concat(this.createTime,"}), {documentType: ").concat(this.documentType,"}), {documentState: ").concat(this.documentState,"})")}}class ti{constructor(e,t){this.position=e,this.inclusive=t}}function ri(e,t,r){let n=0;for(let i=0;i<e.position.length;i++){const s=t[i],o=e.position[i];if(n=s.field.isKeyField()?er.comparator(er.fromName(o.referenceValue),r.key):Fn(o,r.data.field(s.field)),"desc"===s.dir&&(n*=-1),0!==n)break}return n}function ni(e,t){if(null===e)return null===t;if(null===t)return!1;if(e.inclusive!==t.inclusive||e.position.length!==t.position.length)return!1;for(let r=0;r<e.position.length;r++)if(!Rn(e.position[r],t.position[r]))return!1;return!0}class ii{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc";this.field=e,this.dir=t}}function si(e,t){return e.dir===t.dir&&e.field.isEqual(t.field)}class oi{}class ai extends oi{constructor(e,t,r){super(),this.field=e,this.op=t,this.value=r}static create(e,t,r){return e.isKeyField()?"in"===t||"not-in"===t?this.createKeyFieldInFilter(e,t,r):new fi(e,t,r):"array-contains"===t?new vi(e,r):"in"===t?new xi(e,r):"not-in"===t?new bi(e,r):"array-contains-any"===t?new wi(e,r):new ai(e,t,r)}static createKeyFieldInFilter(e,t,r){return"in"===t?new gi(e,r):new yi(e,r)}matches(e){const t=e.data.field(this.field);return"!="===this.op?null!==t&&void 0===t.nullValue&&this.matchesComparison(Fn(t,this.value)):null!==t&&Ln(this.value)===Ln(t)&&this.matchesComparison(Fn(t,this.value))}matchesComparison(e){switch(this.op){case"<":return e<0;case"<=":return e<=0;case"==":return 0===e;case"!=":return 0!==e;case">":return e>0;case">=":return e>=0;default:return Ct(47266,{operator:this.op})}}isInequality(){return["<","<=",">",">=","!=","not-in"].indexOf(this.op)>=0}getFlattenedFilters(){return[this]}getFilters(){return[this]}}class li extends oi{constructor(e,t){super(),this.filters=e,this.op=t,this.Pe=null}static create(e,t){return new li(e,t)}matches(e){return ci(this)?void 0===this.filters.find(t=>!t.matches(e)):void 0!==this.filters.find(t=>t.matches(e))}getFlattenedFilters(){return null!==this.Pe||(this.Pe=this.filters.reduce((e,t)=>e.concat(t.getFlattenedFilters()),[])),this.Pe}getFilters(){return Object.assign([],this.filters)}}function ci(e){return"and"===e.op}function ui(e){return di(e)&&ci(e)}function di(e){for(const t of e.filters)if(t instanceof li)return!1;return!0}function hi(e){if(e instanceof ai)return e.field.canonicalString()+e.op.toString()+Bn(e.value);if(ui(e))return e.filters.map(e=>hi(e)).join(",");{const t=e.filters.map(e=>hi(e)).join(",");return"".concat(e.op,"(").concat(t,")")}}function pi(e,t){return e instanceof ai?function(e,t){return t instanceof ai&&e.op===t.op&&e.field.isEqual(t.field)&&Rn(e.value,t.value)}(e,t):e instanceof li?function(e,t){return t instanceof li&&e.op===t.op&&e.filters.length===t.filters.length&&e.filters.reduce((e,r,n)=>e&&pi(r,t.filters[n]),!0)}(e,t):void Ct(19439)}function mi(e){return e instanceof ai?function(e){return"".concat(e.field.canonicalString()," ").concat(e.op," ").concat(Bn(e.value))}(e):e instanceof li?function(e){return e.op.toString()+" {"+e.getFilters().map(mi).join(" ,")+"}"}(e):"Filter"}class fi extends ai{constructor(e,t,r){super(e,t,r),this.key=er.fromName(r.referenceValue)}matches(e){const t=er.comparator(e.key,this.key);return this.matchesComparison(t)}}class gi extends ai{constructor(e,t){super(e,"in",t),this.keys=_i("in",t)}matches(e){return this.keys.some(t=>t.isEqual(e.key))}}class yi extends ai{constructor(e,t){super(e,"not-in",t),this.keys=_i("not-in",t)}matches(e){return!this.keys.some(t=>t.isEqual(e.key))}}function _i(e,t){var r;return((null===(r=t.arrayValue)||void 0===r?void 0:r.values)||[]).map(e=>er.fromName(e.referenceValue))}class vi extends ai{constructor(e,t){super(e,"array-contains",t)}matches(e){const t=e.data.field(this.field);return Hn(t)&&Dn(t.arrayValue,this.value)}}class xi extends ai{constructor(e,t){super(e,"in",t)}matches(e){const t=e.data.field(this.field);return null!==t&&Dn(this.value.arrayValue,t)}}class bi extends ai{constructor(e,t){super(e,"not-in",t)}matches(e){if(Dn(this.value.arrayValue,{nullValue:"NULL_VALUE"}))return!1;const t=e.data.field(this.field);return null!==t&&void 0===t.nullValue&&!Dn(this.value.arrayValue,t)}}class wi extends ai{constructor(e,t){super(e,"array-contains-any",t)}matches(e){const t=e.data.field(this.field);return!(!Hn(t)||!t.arrayValue.values)&&t.arrayValue.values.some(e=>Dn(this.value.arrayValue,e))}}class ji{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null;this.path=e,this.collectionGroup=t,this.orderBy=r,this.filters=n,this.limit=i,this.startAt=s,this.endAt=o,this.Te=null}}function Si(e){return new ji(e,arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,arguments.length>5&&void 0!==arguments[5]?arguments[5]:null,arguments.length>6&&void 0!==arguments[6]?arguments[6]:null)}function Ti(e){const t=It(e);if(null===t.Te){let e=t.path.canonicalString();null!==t.collectionGroup&&(e+="|cg:"+t.collectionGroup),e+="|f:",e+=t.filters.map(e=>hi(e)).join(","),e+="|ob:",e+=t.orderBy.map(e=>function(e){return e.field.canonicalString()+e.dir}(e)).join(","),Ar(t.limit)||(e+="|l:",e+=t.limit),t.startAt&&(e+="|lb:",e+=t.startAt.inclusive?"b:":"a:",e+=t.startAt.position.map(e=>Bn(e)).join(",")),t.endAt&&(e+="|ub:",e+=t.endAt.inclusive?"a:":"b:",e+=t.endAt.position.map(e=>Bn(e)).join(",")),t.Te=e}return t.Te}function ki(e,t){if(e.limit!==t.limit)return!1;if(e.orderBy.length!==t.orderBy.length)return!1;for(let r=0;r<e.orderBy.length;r++)if(!si(e.orderBy[r],t.orderBy[r]))return!1;if(e.filters.length!==t.filters.length)return!1;for(let r=0;r<e.filters.length;r++)if(!pi(e.filters[r],t.filters[r]))return!1;return e.collectionGroup===t.collectionGroup&&!!e.path.isEqual(t.path)&&!!ni(e.startAt,t.startAt)&&ni(e.endAt,t.endAt)}function Ai(e){return er.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}class Ci{constructor(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:[],n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[],i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:null,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"F",o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:null,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.path=e,this.collectionGroup=t,this.explicitOrderBy=r,this.filters=n,this.limit=i,this.limitType=s,this.startAt=o,this.endAt=a,this.Ie=null,this.Ee=null,this.de=null,this.startAt,this.endAt}}function Ei(e,t,r,n,i,s,o,a){return new Ci(e,t,r,n,i,s,o,a)}function Ni(e){return new Ci(e)}function Ii(e){return 0===e.filters.length&&null===e.limit&&null==e.startAt&&null==e.endAt&&(0===e.explicitOrderBy.length||1===e.explicitOrderBy.length&&e.explicitOrderBy[0].field.isKeyField())}function Pi(e){return null!==e.collectionGroup}function Mi(e){const t=It(e);if(null===t.Ie){t.Ie=[];const e=new Set;for(const i of t.explicitOrderBy)t.Ie.push(i),e.add(i.field.canonicalString());const r=t.explicitOrderBy.length>0?t.explicitOrderBy[t.explicitOrderBy.length-1].dir:"asc",n=function(e){let t=new un($t.comparator);return e.filters.forEach(e=>{e.getFlattenedFilters().forEach(e=>{e.isInequality()&&(t=t.add(e.field))})}),t}(t);n.forEach(n=>{e.has(n.canonicalString())||n.isKeyField()||t.Ie.push(new ii(n,r))}),e.has($t.keyField().canonicalString())||t.Ie.push(new ii($t.keyField(),r))}return t.Ie}function Li(e){const t=It(e);return t.Ee||(t.Ee=Ri(t,Mi(e))),t.Ee}function Ri(e,t){if("F"===e.limitType)return Si(e.path,e.collectionGroup,t,e.filters,e.limit,e.startAt,e.endAt);{t=t.map(e=>{const t="desc"===e.dir?"asc":"desc";return new ii(e.field,t)});const r=e.endAt?new ti(e.endAt.position,e.endAt.inclusive):null,n=e.startAt?new ti(e.startAt.position,e.startAt.inclusive):null;return Si(e.path,e.collectionGroup,t,e.filters,e.limit,r,n)}}function Di(e,t){const r=e.filters.concat([t]);return new Ci(e.path,e.collectionGroup,e.explicitOrderBy.slice(),r,e.limit,e.limitType,e.startAt,e.endAt)}function Fi(e,t,r){return new Ci(e.path,e.collectionGroup,e.explicitOrderBy.slice(),e.filters.slice(),t,r,e.startAt,e.endAt)}function Oi(e,t){return ki(Li(e),Li(t))&&e.limitType===t.limitType}function zi(e){return"".concat(Ti(Li(e)),"|lt:").concat(e.limitType)}function Bi(e){return"Query(target=".concat(function(e){let t=e.path.canonicalString();return null!==e.collectionGroup&&(t+=" collectionGroup="+e.collectionGroup),e.filters.length>0&&(t+=", filters: [".concat(e.filters.map(e=>mi(e)).join(", "),"]")),Ar(e.limit)||(t+=", limit: "+e.limit),e.orderBy.length>0&&(t+=", orderBy: [".concat(e.orderBy.map(e=>function(e){return"".concat(e.field.canonicalString()," (").concat(e.dir,")")}(e)).join(", "),"]")),e.startAt&&(t+=", startAt: ",t+=e.startAt.inclusive?"b:":"a:",t+=e.startAt.position.map(e=>Bn(e)).join(",")),e.endAt&&(t+=", endAt: ",t+=e.endAt.inclusive?"a:":"b:",t+=e.endAt.position.map(e=>Bn(e)).join(",")),"Target(".concat(t,")")}(Li(e)),"; limitType=").concat(e.limitType,")")}function Ui(e,t){return t.isFoundDocument()&&function(e,t){const r=t.key.path;return null!==e.collectionGroup?t.key.hasCollectionId(e.collectionGroup)&&e.path.isPrefixOf(r):er.isDocumentKey(e.path)?e.path.isEqual(r):e.path.isImmediateParentOf(r)}(e,t)&&function(e,t){for(const r of Mi(e))if(!r.field.isKeyField()&&null===t.data.field(r.field))return!1;return!0}(e,t)&&function(e,t){for(const r of e.filters)if(!r.matches(t))return!1;return!0}(e,t)&&function(e,t){return!(e.startAt&&!function(e,t,r){const n=ri(e,t,r);return e.inclusive?n<=0:n<0}(e.startAt,Mi(e),t))&&!(e.endAt&&!function(e,t,r){const n=ri(e,t,r);return e.inclusive?n>=0:n>0}(e.endAt,Mi(e),t))}(e,t)}function Vi(e){return e.collectionGroup||(e.path.length%2==1?e.path.lastSegment():e.path.get(e.path.length-2))}function qi(e){return(t,r)=>{let n=!1;for(const i of Mi(e)){const e=Wi(i,t,r);if(0!==e)return e;n=n||i.field.isKeyField()}return 0}}function Wi(e,t,r){const n=e.field.isKeyField()?er.comparator(t.key,r.key):function(e,t,r){const n=t.data.field(e),i=r.data.field(e);return null!==n&&null!==i?Fn(n,i):Ct(42886)}(e.field,t,r);switch(e.dir){case"asc":return n;case"desc":return-1*n;default:return Ct(19790,{direction:e.dir})}}class Hi{constructor(e,t){this.mapKeyFn=e,this.equalsFn=t,this.inner={},this.innerSize=0}get(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0!==r)for(const[n,i]of r)if(this.equalsFn(n,e))return i}has(e){return void 0!==this.get(e)}set(e,t){const r=this.mapKeyFn(e),n=this.inner[r];if(void 0===n)return this.inner[r]=[[e,t]],void this.innerSize++;for(let i=0;i<n.length;i++)if(this.equalsFn(n[i][0],e))return void(n[i]=[e,t]);n.push([e,t]),this.innerSize++}delete(e){const t=this.mapKeyFn(e),r=this.inner[t];if(void 0===r)return!1;for(let n=0;n<r.length;n++)if(this.equalsFn(r[n][0],e))return 1===r.length?delete this.inner[t]:r.splice(n,1),this.innerSize--,!0;return!1}forEach(e){sn(this.inner,(t,r)=>{for(const[n,i]of r)e(n,i)})}isEmpty(){return on(this.inner)}size(){return this.innerSize}}const Gi=new an(er.comparator);function Zi(){return Gi}const Ki=new an(er.comparator);function Yi(){let e=Ki;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const i of r)e=e.insert(i.key,i);return e}function Xi(e){let t=Ki;return e.forEach((e,r)=>t=t.insert(e,r.overlayedDocument)),t}function Ji(){return $i()}function Qi(){return $i()}function $i(){return new Hi(e=>e.toString(),(e,t)=>e.isEqual(t))}const es=new an(er.comparator),ts=new un(er.comparator);function rs(){let e=ts;for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];for(const i of r)e=e.add(i);return e}const ns=new un(Ht);function is(){return ns}function ss(e,t){if(e.useProto3Json){if(isNaN(t))return{doubleValue:"NaN"};if(t===1/0)return{doubleValue:"Infinity"};if(t===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:Cr(t)?"-0":t}}function os(e){return{integerValue:""+e}}function as(e,t){return Er(t)?os(t):ss(e,t)}class ls{constructor(){this._=void 0}}function cs(e,t,r){return e instanceof hs?function(e,t){const r={fields:{[xn]:{stringValue:vn},[wn]:{timestampValue:{seconds:e.seconds,nanos:e.nanoseconds}}}};return t&&jn(t)&&(t=Sn(t)),t&&(r.fields[bn]=t),{mapValue:r}}(r,t):e instanceof ps?ms(e,t):e instanceof fs?gs(e,t):function(e,t){const r=ds(e,t),n=_s(r)+_s(e.Ae);return Wn(r)&&Wn(e.Ae)?os(n):ss(e.serializer,n)}(e,t)}function us(e,t,r){return e instanceof ps?ms(e,t):e instanceof fs?gs(e,t):r}function ds(e,t){return e instanceof ys?function(e){return Wn(e)||function(e){return!!e&&"doubleValue"in e}(e)}(t)?t:{integerValue:0}:null}class hs extends ls{}class ps extends ls{constructor(e){super(),this.elements=e}}function ms(e,t){const r=vs(t);for(const n of e.elements)r.some(e=>Rn(e,n))||r.push(n);return{arrayValue:{values:r}}}class fs extends ls{constructor(e){super(),this.elements=e}}function gs(e,t){let r=vs(t);for(const n of e.elements)r=r.filter(e=>!Rn(e,n));return{arrayValue:{values:r}}}class ys extends ls{constructor(e,t){super(),this.serializer=e,this.Ae=t}}function _s(e){return yn(e.integerValue||e.doubleValue)}function vs(e){return Hn(e)&&e.arrayValue.values?e.arrayValue.values.slice():[]}class xs{constructor(e,t){this.field=e,this.transform=t}}class bs{constructor(e,t){this.version=e,this.transformResults=t}}class ws{constructor(e,t){this.updateTime=e,this.exists=t}static none(){return new ws}static exists(e){return new ws(void 0,e)}static updateTime(e){return new ws(e)}get isNone(){return void 0===this.updateTime&&void 0===this.exists}isEqual(e){return this.exists===e.exists&&(this.updateTime?!!e.updateTime&&this.updateTime.isEqual(e.updateTime):!e.updateTime)}}function js(e,t){return void 0!==e.updateTime?t.isFoundDocument()&&t.version.isEqual(e.updateTime):void 0===e.exists||e.exists===t.isFoundDocument()}class Ss{}function Ts(e,t){if(!e.hasLocalMutations||t&&0===t.fields.length)return null;if(null===t)return e.isNoDocument()?new Rs(e.key,ws.none()):new Ns(e.key,e.data,ws.none());{const r=e.data,n=Qn.empty();let i=new un($t.comparator);for(let e of t.fields)if(!i.has(e)){let t=r.field(e);null===t&&e.length>1&&(e=e.popLast(),t=r.field(e)),null===t?n.delete(e):n.set(e,t),i=i.add(e)}return new Is(e.key,n,new hn(i.toArray()),ws.none())}}function ks(e,t,r){e instanceof Ns?function(e,t,r){const n=e.value.clone(),i=Ms(e.fieldTransforms,t,r.transformResults);n.setAll(i),t.convertToFoundDocument(r.version,n).setHasCommittedMutations()}(e,t,r):e instanceof Is?function(e,t,r){if(!js(e.precondition,t))return void t.convertToUnknownDocument(r.version);const n=Ms(e.fieldTransforms,t,r.transformResults),i=t.data;i.setAll(Ps(e)),i.setAll(n),t.convertToFoundDocument(r.version,i).setHasCommittedMutations()}(e,t,r):function(e,t,r){t.convertToNoDocument(r.version).setHasCommittedMutations()}(0,t,r)}function As(e,t,r,n){return e instanceof Ns?function(e,t,r,n){if(!js(e.precondition,t))return r;const i=e.value.clone(),s=Ls(e.fieldTransforms,n,t);return i.setAll(s),t.convertToFoundDocument(t.version,i).setHasLocalMutations(),null}(e,t,r,n):e instanceof Is?function(e,t,r,n){if(!js(e.precondition,t))return r;const i=Ls(e.fieldTransforms,n,t),s=t.data;return s.setAll(Ps(e)),s.setAll(i),t.convertToFoundDocument(t.version,s).setHasLocalMutations(),null===r?null:r.unionWith(e.fieldMask.fields).unionWith(e.fieldTransforms.map(e=>e.field))}(e,t,r,n):function(e,t,r){return js(e.precondition,t)?(t.convertToNoDocument(t.version).setHasLocalMutations(),null):r}(e,t,r)}function Cs(e,t){let r=null;for(const n of e.fieldTransforms){const e=t.data.field(n.field),i=ds(n.transform,e||null);null!=i&&(null===r&&(r=Qn.empty()),r.set(n.field,i))}return r||null}function Es(e,t){return e.type===t.type&&!!e.key.isEqual(t.key)&&!!e.precondition.isEqual(t.precondition)&&!!function(e,t){return void 0===e&&void 0===t||!(!e||!t)&&Kt(e,t,(e,t)=>function(e,t){return e.field.isEqual(t.field)&&function(e,t){return e instanceof ps&&t instanceof ps||e instanceof fs&&t instanceof fs?Kt(e.elements,t.elements,Rn):e instanceof ys&&t instanceof ys?Rn(e.Ae,t.Ae):e instanceof hs&&t instanceof hs}(e.transform,t.transform)}(e,t))}(e.fieldTransforms,t.fieldTransforms)&&(0===e.type?e.value.isEqual(t.value):1!==e.type||e.data.isEqual(t.data)&&e.fieldMask.isEqual(t.fieldMask))}class Ns extends Ss{constructor(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:[];super(),this.key=e,this.value=t,this.precondition=r,this.fieldTransforms=n,this.type=0}getFieldMask(){return null}}class Is extends Ss{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:[];super(),this.key=e,this.data=t,this.fieldMask=r,this.precondition=n,this.fieldTransforms=i,this.type=1}getFieldMask(){return this.fieldMask}}function Ps(e){const t=new Map;return e.fieldMask.fields.forEach(r=>{if(!r.isEmpty()){const n=e.data.field(r);t.set(r,n)}}),t}function Ms(e,t,r){const n=new Map;Nt(e.length===r.length,32656,{Re:r.length,Ve:e.length});for(let i=0;i<r.length;i++){const s=e[i],o=s.transform,a=t.data.field(s.field);n.set(s.field,us(o,a,r[i]))}return n}function Ls(e,t,r){const n=new Map;for(const i of e){const e=i.transform,s=r.data.field(i.field);n.set(i.field,cs(e,s,t))}return n}class Rs extends Ss{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=2,this.fieldTransforms=[]}getFieldMask(){return null}}class Ds extends Ss{constructor(e,t){super(),this.key=e,this.precondition=t,this.type=3,this.fieldTransforms=[]}getFieldMask(){return null}}class Fs{constructor(e,t,r,n){this.batchId=e,this.localWriteTime=t,this.baseMutations=r,this.mutations=n}applyToRemoteDocument(e,t){const r=t.mutationResults;for(let n=0;n<this.mutations.length;n++){const t=this.mutations[n];t.key.isEqual(e.key)&&ks(t,e,r[n])}}applyToLocalView(e,t){for(const r of this.baseMutations)r.key.isEqual(e.key)&&(t=As(r,e,t,this.localWriteTime));for(const r of this.mutations)r.key.isEqual(e.key)&&(t=As(r,e,t,this.localWriteTime));return t}applyToLocalDocumentSet(e,t){const r=Qi();return this.mutations.forEach(n=>{const i=e.get(n.key),s=i.overlayedDocument;let o=this.applyToLocalView(s,i.mutatedFields);o=t.has(n.key)?null:o;const a=Ts(s,o);null!==a&&r.set(n.key,a),s.isValidDocument()||s.convertToNoDocument(hr.min())}),r}keys(){return this.mutations.reduce((e,t)=>e.add(t.key),rs())}isEqual(e){return this.batchId===e.batchId&&Kt(this.mutations,e.mutations,(e,t)=>Es(e,t))&&Kt(this.baseMutations,e.baseMutations,(e,t)=>Es(e,t))}}class Os{constructor(e,t,r,n){this.batch=e,this.commitVersion=t,this.mutationResults=r,this.docVersions=n}static from(e,t,r){Nt(e.mutations.length===r.length,58842,{me:e.mutations.length,fe:r.length});let n=es;const i=e.mutations;for(let s=0;s<i.length;s++)n=n.insert(i[s].key,r[s].version);return new Os(e,t,r,n)}}class zs{constructor(e,t){this.largestBatchId=e,this.mutation=t}getKey(){return this.mutation.key}isEqual(e){return null!==e&&this.mutation===e.mutation}toString(){return"Overlay{\n      largestBatchId: ".concat(this.largestBatchId,",\n      mutation: ").concat(this.mutation.toString(),"\n    }")}}class Bs{constructor(e,t){this.count=e,this.unchangedNames=t}}var Us,Vs;function qs(e){switch(e){case Pt.OK:return Ct(64938);case Pt.CANCELLED:case Pt.UNKNOWN:case Pt.DEADLINE_EXCEEDED:case Pt.RESOURCE_EXHAUSTED:case Pt.INTERNAL:case Pt.UNAVAILABLE:case Pt.UNAUTHENTICATED:return!1;case Pt.INVALID_ARGUMENT:case Pt.NOT_FOUND:case Pt.ALREADY_EXISTS:case Pt.PERMISSION_DENIED:case Pt.FAILED_PRECONDITION:case Pt.ABORTED:case Pt.OUT_OF_RANGE:case Pt.UNIMPLEMENTED:case Pt.DATA_LOSS:return!0;default:return Ct(15467,{code:e})}}function Ws(e){if(void 0===e)return Tt("GRPC error has no .code"),Pt.UNKNOWN;switch(e){case Us.OK:return Pt.OK;case Us.CANCELLED:return Pt.CANCELLED;case Us.UNKNOWN:return Pt.UNKNOWN;case Us.DEADLINE_EXCEEDED:return Pt.DEADLINE_EXCEEDED;case Us.RESOURCE_EXHAUSTED:return Pt.RESOURCE_EXHAUSTED;case Us.INTERNAL:return Pt.INTERNAL;case Us.UNAVAILABLE:return Pt.UNAVAILABLE;case Us.UNAUTHENTICATED:return Pt.UNAUTHENTICATED;case Us.INVALID_ARGUMENT:return Pt.INVALID_ARGUMENT;case Us.NOT_FOUND:return Pt.NOT_FOUND;case Us.ALREADY_EXISTS:return Pt.ALREADY_EXISTS;case Us.PERMISSION_DENIED:return Pt.PERMISSION_DENIED;case Us.FAILED_PRECONDITION:return Pt.FAILED_PRECONDITION;case Us.ABORTED:return Pt.ABORTED;case Us.OUT_OF_RANGE:return Pt.OUT_OF_RANGE;case Us.UNIMPLEMENTED:return Pt.UNIMPLEMENTED;case Us.DATA_LOSS:return Pt.DATA_LOSS;default:return Ct(39323,{code:e})}}(Vs=Us||(Us={}))[Vs.OK=0]="OK",Vs[Vs.CANCELLED=1]="CANCELLED",Vs[Vs.UNKNOWN=2]="UNKNOWN",Vs[Vs.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",Vs[Vs.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",Vs[Vs.NOT_FOUND=5]="NOT_FOUND",Vs[Vs.ALREADY_EXISTS=6]="ALREADY_EXISTS",Vs[Vs.PERMISSION_DENIED=7]="PERMISSION_DENIED",Vs[Vs.UNAUTHENTICATED=16]="UNAUTHENTICATED",Vs[Vs.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",Vs[Vs.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",Vs[Vs.ABORTED=10]="ABORTED",Vs[Vs.OUT_OF_RANGE=11]="OUT_OF_RANGE",Vs[Vs.UNIMPLEMENTED=12]="UNIMPLEMENTED",Vs[Vs.INTERNAL=13]="INTERNAL",Vs[Vs.UNAVAILABLE=14]="UNAVAILABLE",Vs[Vs.DATA_LOSS=15]="DATA_LOSS";let Hs=null;function Gs(){return new TextEncoder}const Zs=new it([4294967295,4294967295],0);function Ks(e){const t=Gs().encode(e),r=new st;return r.update(t),new Uint8Array(r.digest())}function Ys(e){const t=new DataView(e.buffer),r=t.getUint32(0,!0),n=t.getUint32(4,!0),i=t.getUint32(8,!0),s=t.getUint32(12,!0);return[new it([r,n],0),new it([i,s],0)]}class Xs{constructor(e,t,r){if(this.bitmap=e,this.padding=t,this.hashCount=r,t<0||t>=8)throw new Js("Invalid padding: ".concat(t));if(r<0)throw new Js("Invalid hash count: ".concat(r));if(e.length>0&&0===this.hashCount)throw new Js("Invalid hash count: ".concat(r));if(0===e.length&&0!==t)throw new Js("Invalid padding when bitmap length is 0: ".concat(t));this.ge=8*e.length-t,this.pe=it.fromNumber(this.ge)}ye(e,t,r){let n=e.add(t.multiply(it.fromNumber(r)));return 1===n.compare(Zs)&&(n=new it([n.getBits(0),n.getBits(1)],0)),n.modulo(this.pe).toNumber()}we(e){return!!(this.bitmap[Math.floor(e/8)]&1<<e%8)}mightContain(e){if(0===this.ge)return!1;const t=Ks(e),[r,n]=Ys(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(r,n,i);if(!this.we(e))return!1}return!0}static create(e,t,r){const n=e%8==0?0:8-e%8,i=new Uint8Array(Math.ceil(e/8)),s=new Xs(i,n,t);return r.forEach(e=>s.insert(e)),s}insert(e){if(0===this.ge)return;const t=Ks(e),[r,n]=Ys(t);for(let i=0;i<this.hashCount;i++){const e=this.ye(r,n,i);this.Se(e)}}Se(e){const t=Math.floor(e/8),r=e%8;this.bitmap[t]|=1<<r}}class Js extends Error{constructor(){super(...arguments),this.name="BloomFilterError"}}class Qs{constructor(e,t,r,n,i){this.snapshotVersion=e,this.targetChanges=t,this.targetMismatches=r,this.documentUpdates=n,this.resolvedLimboDocuments=i}static createSynthesizedRemoteEventForCurrentChange(e,t,r){const n=new Map;return n.set(e,$s.createSynthesizedTargetChangeForCurrentChange(e,t,r)),new Qs(hr.min(),n,new an(Ht),Zi(),rs())}}class $s{constructor(e,t,r,n,i){this.resumeToken=e,this.current=t,this.addedDocuments=r,this.modifiedDocuments=n,this.removedDocuments=i}static createSynthesizedTargetChangeForCurrentChange(e,t,r){return new $s(r,t,rs(),rs(),rs())}}class eo{constructor(e,t,r,n){this.be=e,this.removedTargetIds=t,this.key=r,this.De=n}}class to{constructor(e,t){this.targetId=e,this.Ce=t}}class ro{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:mn.EMPTY_BYTE_STRING,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:null;this.state=e,this.targetIds=t,this.resumeToken=r,this.cause=n}}class no{constructor(){this.ve=0,this.Fe=oo(),this.Me=mn.EMPTY_BYTE_STRING,this.xe=!1,this.Oe=!0}get current(){return this.xe}get resumeToken(){return this.Me}get Ne(){return 0!==this.ve}get Be(){return this.Oe}Le(e){e.approximateByteSize()>0&&(this.Oe=!0,this.Me=e)}ke(){let e=rs(),t=rs(),r=rs();return this.Fe.forEach((n,i)=>{switch(i){case 0:e=e.add(n);break;case 2:t=t.add(n);break;case 1:r=r.add(n);break;default:Ct(38017,{changeType:i})}}),new $s(this.Me,this.xe,e,t,r)}qe(){this.Oe=!1,this.Fe=oo()}Qe(e,t){this.Oe=!0,this.Fe=this.Fe.insert(e,t)}$e(e){this.Oe=!0,this.Fe=this.Fe.remove(e)}Ue(){this.ve+=1}Ke(){this.ve-=1,Nt(this.ve>=0,3241,{ve:this.ve})}We(){this.Oe=!0,this.xe=!0}}class io{constructor(e){this.Ge=e,this.ze=new Map,this.je=Zi(),this.Je=so(),this.He=so(),this.Ye=new an(Ht)}Ze(e){for(const t of e.be)e.De&&e.De.isFoundDocument()?this.Xe(t,e.De):this.et(t,e.key,e.De);for(const t of e.removedTargetIds)this.et(t,e.key,e.De)}tt(e){this.forEachTarget(e,t=>{const r=this.nt(t);switch(e.state){case 0:this.rt(t)&&r.Le(e.resumeToken);break;case 1:r.Ke(),r.Ne||r.qe(),r.Le(e.resumeToken);break;case 2:r.Ke(),r.Ne||this.removeTarget(t);break;case 3:this.rt(t)&&(r.We(),r.Le(e.resumeToken));break;case 4:this.rt(t)&&(this.it(t),r.Le(e.resumeToken));break;default:Ct(56790,{state:e.state})}})}forEachTarget(e,t){e.targetIds.length>0?e.targetIds.forEach(t):this.ze.forEach((e,r)=>{this.rt(r)&&t(r)})}st(e){const t=e.targetId,r=e.Ce.count,n=this.ot(t);if(n){const s=n.target;if(Ai(s))if(0===r){const e=new er(s.path);this.et(t,e,ei.newNoDocument(e,hr.min()))}else Nt(1===r,20013,{expectedCount:r});else{const n=this._t(t);if(n!==r){var i;const r=this.ut(e),s=r?this.ct(r,e,n):1;if(0!==s){this.it(t);const e=2===s?"TargetPurposeExistenceFilterMismatchBloom":"TargetPurposeExistenceFilterMismatch";this.Ye=this.Ye.insert(t,e)}null===(i=Hs)||void 0===i||i.lt(function(e,t,r,n,i){var s,o,a,l,c;const u={localCacheCount:e,existenceFilterCount:t.count,databaseId:r.database,projectId:r.projectId},d=t.unchangedNames;return d&&(u.bloomFilter={applied:0===i,hashCount:null!==(s=null===d||void 0===d?void 0:d.hashCount)&&void 0!==s?s:0,bitmapLength:null!==(o=null===d||void 0===d||null===(a=d.bits)||void 0===a||null===(a=a.bitmap)||void 0===a?void 0:a.length)&&void 0!==o?o:0,padding:null!==(l=null===d||void 0===d||null===(c=d.bits)||void 0===c?void 0:c.padding)&&void 0!==l?l:0,mightContain:e=>{var t;return null!==(t=null===n||void 0===n?void 0:n.mightContain(e))&&void 0!==t&&t}}),u}(n,e.Ce,this.Ge.ht(),r,s))}}}}ut(e){const t=e.Ce.unchangedNames;if(!t||!t.bits)return null;const{bits:{bitmap:r="",padding:n=0},hashCount:i=0}=t;let s,o;try{s=_n(r).toUint8Array()}catch(e){if(e instanceof pn)return kt("Decoding the base64 bloom filter in existence filter failed ("+e.message+"); ignoring the bloom filter and falling back to full re-query."),null;throw e}try{o=new Xs(s,n,i)}catch(e){return kt(e instanceof Js?"BloomFilter error: ":"Applying bloom filter failed: ",e),null}return 0===o.ge?null:o}ct(e,t,r){return t.Ce.count===r-this.Pt(e,t.targetId)?0:2}Pt(e,t){const r=this.Ge.getRemoteKeysForTarget(t);let n=0;return r.forEach(r=>{const i=this.Ge.ht(),s="projects/".concat(i.projectId,"/databases/").concat(i.database,"/documents/").concat(r.path.canonicalString());e.mightContain(s)||(this.et(t,r,null),n++)}),n}Tt(e){const t=new Map;this.ze.forEach((r,n)=>{const i=this.ot(n);if(i){if(r.current&&Ai(i.target)){const t=new er(i.target.path);this.It(t).has(n)||this.Et(n,t)||this.et(n,t,ei.newNoDocument(t,e))}r.Be&&(t.set(n,r.ke()),r.qe())}});let r=rs();this.He.forEach((e,t)=>{let n=!0;t.forEachWhile(e=>{const t=this.ot(e);return!t||"TargetPurposeLimboResolution"===t.purpose||(n=!1,!1)}),n&&(r=r.add(e))}),this.je.forEach((t,r)=>r.setReadTime(e));const n=new Qs(e,t,this.Ye,this.je,r);return this.je=Zi(),this.Je=so(),this.He=so(),this.Ye=new an(Ht),n}Xe(e,t){if(!this.rt(e))return;const r=this.Et(e,t.key)?2:0;this.nt(e).Qe(t.key,r),this.je=this.je.insert(t.key,t),this.Je=this.Je.insert(t.key,this.It(t.key).add(e)),this.He=this.He.insert(t.key,this.dt(t.key).add(e))}et(e,t,r){if(!this.rt(e))return;const n=this.nt(e);this.Et(e,t)?n.Qe(t,1):n.$e(t),this.He=this.He.insert(t,this.dt(t).delete(e)),this.He=this.He.insert(t,this.dt(t).add(e)),r&&(this.je=this.je.insert(t,r))}removeTarget(e){this.ze.delete(e)}_t(e){const t=this.nt(e).ke();return this.Ge.getRemoteKeysForTarget(e).size+t.addedDocuments.size-t.removedDocuments.size}Ue(e){this.nt(e).Ue()}nt(e){let t=this.ze.get(e);return t||(t=new no,this.ze.set(e,t)),t}dt(e){let t=this.He.get(e);return t||(t=new un(Ht),this.He=this.He.insert(e,t)),t}It(e){let t=this.Je.get(e);return t||(t=new un(Ht),this.Je=this.Je.insert(e,t)),t}rt(e){const t=null!==this.ot(e);return t||St("WatchChangeAggregator","Detected inactive target",e),t}ot(e){const t=this.ze.get(e);return t&&t.Ne?null:this.Ge.At(e)}it(e){this.ze.set(e,new no),this.Ge.getRemoteKeysForTarget(e).forEach(t=>{this.et(e,t,null)})}Et(e,t){return this.Ge.getRemoteKeysForTarget(e).has(t)}}function so(){return new an(er.comparator)}function oo(){return new an(er.comparator)}const ao={asc:"ASCENDING",desc:"DESCENDING"},lo={"<":"LESS_THAN","<=":"LESS_THAN_OR_EQUAL",">":"GREATER_THAN",">=":"GREATER_THAN_OR_EQUAL","==":"EQUAL","!=":"NOT_EQUAL","array-contains":"ARRAY_CONTAINS",in:"IN","not-in":"NOT_IN","array-contains-any":"ARRAY_CONTAINS_ANY"},co={and:"AND",or:"OR"};class uo{constructor(e,t){this.databaseId=e,this.useProto3Json=t}}function ho(e,t){return e.useProto3Json||Ar(t)?t:{value:t}}function po(e,t){return e.useProto3Json?"".concat(new Date(1e3*t.seconds).toISOString().replace(/\.\d*/,"").replace("Z",""),".").concat(("000000000"+t.nanoseconds).slice(-9),"Z"):{seconds:""+t.seconds,nanos:t.nanoseconds}}function mo(e,t){return e.useProto3Json?t.toBase64():t.toUint8Array()}function fo(e,t){return po(e,t.toTimestamp())}function go(e){return Nt(!!e,49232),hr.fromTimestamp(function(e){const t=gn(e);return new dr(t.seconds,t.nanos)}(e))}function yo(e,t){return _o(e,t).canonicalString()}function _o(e,t){const r=function(e){return new Jt(["projects",e.projectId,"databases",e.database])}(e).child("documents");return void 0===t?r:r.child(t)}function vo(e){const t=Jt.fromString(e);return Nt(zo(t),10190,{key:t.toString()}),t}function xo(e,t){return yo(e.databaseId,t.path)}function bo(e,t){const r=vo(t);if(r.get(1)!==e.databaseId.projectId)throw new Mt(Pt.INVALID_ARGUMENT,"Tried to deserialize key from different project: "+r.get(1)+" vs "+e.databaseId.projectId);if(r.get(3)!==e.databaseId.database)throw new Mt(Pt.INVALID_ARGUMENT,"Tried to deserialize key from different database: "+r.get(3)+" vs "+e.databaseId.database);return new er(To(r))}function wo(e,t){return yo(e.databaseId,t)}function jo(e){const t=vo(e);return 4===t.length?Jt.emptyPath():To(t)}function So(e){return new Jt(["projects",e.databaseId.projectId,"databases",e.databaseId.database]).canonicalString()}function To(e){return Nt(e.length>4&&"documents"===e.get(4),29091,{key:e.toString()}),e.popFirst(5)}function ko(e,t,r){return{name:xo(e,t),fields:r.value.mapValue.fields}}function Ao(e,t){let r;if(t instanceof Ns)r={update:ko(e,t.key,t.value)};else if(t instanceof Rs)r={delete:xo(e,t.key)};else if(t instanceof Is)r={update:ko(e,t.key,t.data),updateMask:Oo(t.fieldMask)};else{if(!(t instanceof Ds))return Ct(16599,{Vt:t.type});r={verify:xo(e,t.key)}}return t.fieldTransforms.length>0&&(r.updateTransforms=t.fieldTransforms.map(e=>function(e,t){const r=t.transform;if(r instanceof hs)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(r instanceof ps)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:r.elements}};if(r instanceof fs)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:r.elements}};if(r instanceof ys)return{fieldPath:t.field.canonicalString(),increment:r.Ae};throw Ct(20930,{transform:t.transform})}(0,e))),t.precondition.isNone||(r.currentDocument=function(e,t){return void 0!==t.updateTime?{updateTime:fo(e,t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Ct(27497)}(e,t.precondition)),r}function Co(e,t){return{documents:[wo(e,t.path)]}}function Eo(e,t){const r={structuredQuery:{}},n=t.path;let i;null!==t.collectionGroup?(i=n,r.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(i=n.popLast(),r.structuredQuery.from=[{collectionId:n.lastSegment()}]),r.parent=wo(e,i);const s=function(e){if(0!==e.length)return Fo(li.create(e,"and"))}(t.filters);s&&(r.structuredQuery.where=s);const o=function(e){if(0!==e.length)return e.map(e=>function(e){return{field:Ro(e.field),direction:Po(e.dir)}}(e))}(t.orderBy);o&&(r.structuredQuery.orderBy=o);const a=ho(e,t.limit);return null!==a&&(r.structuredQuery.limit=a),t.startAt&&(r.structuredQuery.startAt=function(e){return{before:e.inclusive,values:e.position}}(t.startAt)),t.endAt&&(r.structuredQuery.endAt=function(e){return{before:!e.inclusive,values:e.position}}(t.endAt)),{ft:r,parent:i}}function No(e){let t=jo(e.parent);const r=e.structuredQuery,n=r.from?r.from.length:0;let i=null;if(n>0){Nt(1===n,65062);const e=r.from[0];e.allDescendants?i=e.collectionId:t=t.child(e.collectionId)}let s=[];r.where&&(s=function(e){const t=Io(e);return t instanceof li&&ui(t)?t.getFilters():[t]}(r.where));let o=[];r.orderBy&&(o=function(e){return e.map(e=>function(e){return new ii(Do(e.field),function(e){switch(e){case"ASCENDING":return"asc";case"DESCENDING":return"desc";default:return}}(e.direction))}(e))}(r.orderBy));let a=null;r.limit&&(a=function(e){let t;return t="object"==typeof e?e.value:e,Ar(t)?null:t}(r.limit));let l=null;r.startAt&&(l=function(e){const t=!!e.before,r=e.values||[];return new ti(r,t)}(r.startAt));let c=null;return r.endAt&&(c=function(e){const t=!e.before,r=e.values||[];return new ti(r,t)}(r.endAt)),Ei(t,i,o,s,a,"F",l,c)}function Io(e){return void 0!==e.unaryFilter?function(e){switch(e.unaryFilter.op){case"IS_NAN":const t=Do(e.unaryFilter.field);return ai.create(t,"==",{doubleValue:NaN});case"IS_NULL":const r=Do(e.unaryFilter.field);return ai.create(r,"==",{nullValue:"NULL_VALUE"});case"IS_NOT_NAN":const n=Do(e.unaryFilter.field);return ai.create(n,"!=",{doubleValue:NaN});case"IS_NOT_NULL":const i=Do(e.unaryFilter.field);return ai.create(i,"!=",{nullValue:"NULL_VALUE"});case"OPERATOR_UNSPECIFIED":return Ct(61313);default:return Ct(60726)}}(e):void 0!==e.fieldFilter?function(e){return ai.create(Do(e.fieldFilter.field),function(e){switch(e){case"EQUAL":return"==";case"NOT_EQUAL":return"!=";case"GREATER_THAN":return">";case"GREATER_THAN_OR_EQUAL":return">=";case"LESS_THAN":return"<";case"LESS_THAN_OR_EQUAL":return"<=";case"ARRAY_CONTAINS":return"array-contains";case"IN":return"in";case"NOT_IN":return"not-in";case"ARRAY_CONTAINS_ANY":return"array-contains-any";case"OPERATOR_UNSPECIFIED":return Ct(58110);default:return Ct(50506)}}(e.fieldFilter.op),e.fieldFilter.value)}(e):void 0!==e.compositeFilter?function(e){return li.create(e.compositeFilter.filters.map(e=>Io(e)),function(e){switch(e){case"AND":return"and";case"OR":return"or";default:return Ct(1026)}}(e.compositeFilter.op))}(e):Ct(30097,{filter:e})}function Po(e){return ao[e]}function Mo(e){return lo[e]}function Lo(e){return co[e]}function Ro(e){return{fieldPath:e.canonicalString()}}function Do(e){return $t.fromServerFormat(e.fieldPath)}function Fo(e){return e instanceof ai?function(e){if("=="===e.op){if(Zn(e.value))return{unaryFilter:{field:Ro(e.field),op:"IS_NAN"}};if(Gn(e.value))return{unaryFilter:{field:Ro(e.field),op:"IS_NULL"}}}else if("!="===e.op){if(Zn(e.value))return{unaryFilter:{field:Ro(e.field),op:"IS_NOT_NAN"}};if(Gn(e.value))return{unaryFilter:{field:Ro(e.field),op:"IS_NOT_NULL"}}}return{fieldFilter:{field:Ro(e.field),op:Mo(e.op),value:e.value}}}(e):e instanceof li?function(e){const t=e.getFilters().map(e=>Fo(e));return 1===t.length?t[0]:{compositeFilter:{op:Lo(e.op),filters:t}}}(e):Ct(54877,{filter:e})}function Oo(e){const t=[];return e.fields.forEach(e=>t.push(e.canonicalString())),{fieldPaths:t}}function zo(e){return e.length>=4&&"projects"===e.get(0)&&"databases"===e.get(2)}class Bo{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:hr.min(),s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:hr.min(),o=arguments.length>6&&void 0!==arguments[6]?arguments[6]:mn.EMPTY_BYTE_STRING,a=arguments.length>7&&void 0!==arguments[7]?arguments[7]:null;this.target=e,this.targetId=t,this.purpose=r,this.sequenceNumber=n,this.snapshotVersion=i,this.lastLimboFreeSnapshotVersion=s,this.resumeToken=o,this.expectedCount=a}withSequenceNumber(e){return new Bo(this.target,this.targetId,this.purpose,e,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,this.expectedCount)}withResumeToken(e,t){return new Bo(this.target,this.targetId,this.purpose,this.sequenceNumber,t,this.lastLimboFreeSnapshotVersion,e,null)}withExpectedCount(e){return new Bo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,this.lastLimboFreeSnapshotVersion,this.resumeToken,e)}withLastLimboFreeSnapshotVersion(e){return new Bo(this.target,this.targetId,this.purpose,this.sequenceNumber,this.snapshotVersion,e,this.resumeToken,this.expectedCount)}}class Uo{constructor(e){this.yt=e}}function Vo(e){const t=No({parent:e.parent,structuredQuery:e.structuredQuery});return"LAST"===e.limitType?Fi(t,t.limit,"L"):t}class qo{constructor(){}Dt(e,t){this.Ct(e,t),t.vt()}Ct(e,t){if("nullValue"in e)this.Ft(t,5);else if("booleanValue"in e)this.Ft(t,10),t.Mt(e.booleanValue?1:0);else if("integerValue"in e)this.Ft(t,15),t.Mt(yn(e.integerValue));else if("doubleValue"in e){const r=yn(e.doubleValue);isNaN(r)?this.Ft(t,13):(this.Ft(t,15),Cr(r)?t.Mt(0):t.Mt(r))}else if("timestampValue"in e){let r=e.timestampValue;this.Ft(t,20),"string"==typeof r&&(r=gn(r)),t.xt("".concat(r.seconds||"")),t.Mt(r.nanos||0)}else if("stringValue"in e)this.Ot(e.stringValue,t),this.Nt(t);else if("bytesValue"in e)this.Ft(t,30),t.Bt(_n(e.bytesValue)),this.Nt(t);else if("referenceValue"in e)this.Lt(e.referenceValue,t);else if("geoPointValue"in e){const r=e.geoPointValue;this.Ft(t,45),t.Mt(r.latitude||0),t.Mt(r.longitude||0)}else"mapValue"in e?Jn(e)?this.Ft(t,Number.MAX_SAFE_INTEGER):Yn(e)?this.kt(e.mapValue,t):(this.qt(e.mapValue,t),this.Nt(t)):"arrayValue"in e?(this.Qt(e.arrayValue,t),this.Nt(t)):Ct(19022,{$t:e})}Ot(e,t){this.Ft(t,25),this.Ut(e,t)}Ut(e,t){t.xt(e)}qt(e,t){const r=e.fields||{};this.Ft(t,55);for(const n of Object.keys(r))this.Ot(n,t),this.Ct(r[n],t)}kt(e,t){var r;const n=e.fields||{};this.Ft(t,53);const i=Mn,s=(null===(r=n[i].arrayValue)||void 0===r||null===(r=r.values)||void 0===r?void 0:r.length)||0;this.Ft(t,15),t.Mt(yn(s)),this.Ot(i,t),this.Ct(n[i],t)}Qt(e,t){const r=e.values||[];this.Ft(t,50);for(const n of r)this.Ct(n,t)}Lt(e,t){this.Ft(t,37),er.fromName(e).path.forEach(e=>{this.Ft(t,60),this.Ut(e,t)})}Ft(e,t){e.Mt(t)}Nt(e){e.Mt(2)}}qo.Kt=new qo;class Wo{constructor(){this.Cn=new Ho}addToCollectionParentIndex(e,t){return this.Cn.add(t),wr.resolve()}getCollectionParents(e,t){return wr.resolve(this.Cn.getEntries(t))}addFieldIndex(e,t){return wr.resolve()}deleteFieldIndex(e,t){return wr.resolve()}deleteAllFieldIndexes(e){return wr.resolve()}createTargetIndexes(e,t){return wr.resolve()}getDocumentsMatchingTarget(e,t){return wr.resolve(null)}getIndexType(e,t){return wr.resolve(0)}getFieldIndexes(e,t){return wr.resolve([])}getNextCollectionGroupToUpdate(e){return wr.resolve(null)}getMinOffset(e,t){return wr.resolve(yr.min())}getMinOffsetFromCollectionGroup(e,t){return wr.resolve(yr.min())}updateCollectionGroup(e,t,r){return wr.resolve()}updateIndexEntries(e,t){return wr.resolve()}}class Ho{constructor(){this.index={}}add(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t]||new un(Jt.comparator),i=!n.has(r);return this.index[t]=n.add(r),i}has(e){const t=e.lastSegment(),r=e.popLast(),n=this.index[t];return n&&n.has(r)}getEntries(e){return(this.index[e]||new un(Jt.comparator)).toArray()}}new Uint8Array(0);const Go={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Zo=41943040;class Ko{static withCacheSize(e){return new Ko(e,Ko.DEFAULT_COLLECTION_PERCENTILE,Ko.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)}constructor(e,t,r){this.cacheSizeCollectionThreshold=e,this.percentileToCollect=t,this.maximumSequenceNumbersToCollect=r}}Ko.DEFAULT_COLLECTION_PERCENTILE=10,Ko.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,Ko.DEFAULT=new Ko(Zo,Ko.DEFAULT_COLLECTION_PERCENTILE,Ko.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),Ko.DISABLED=new Ko(-1,0,0);class Yo{constructor(e){this.ar=e}next(){return this.ar+=2,this.ar}static ur(){return new Yo(0)}static cr(){return new Yo(-1)}}const Xo="LruGarbageCollector",Jo=1048576;function Qo(e,t){let[r,n]=e,[i,s]=t;const o=Ht(r,i);return 0===o?Ht(n,s):o}class $o{constructor(e){this.Ir=e,this.buffer=new un(Qo),this.Er=0}dr(){return++this.Er}Ar(e){const t=[e,this.dr()];if(this.buffer.size<this.Ir)this.buffer=this.buffer.add(t);else{const e=this.buffer.last();Qo(t,e)<0&&(this.buffer=this.buffer.delete(e).add(t))}}get maxValue(){return this.buffer.last()[0]}}class ea{constructor(e,t,r){this.garbageCollector=e,this.asyncQueue=t,this.localStore=r,this.Rr=null}start(){-1!==this.garbageCollector.params.cacheSizeCollectionThreshold&&this.Vr(6e4)}stop(){this.Rr&&(this.Rr.cancel(),this.Rr=null)}get started(){return null!==this.Rr}Vr(e){St(Xo,"Garbage collection scheduled in ".concat(e,"ms")),this.Rr=this.asyncQueue.enqueueAfterDelay("lru_garbage_collection",e,async()=>{this.Rr=null;try{await this.localStore.collectGarbage(this.garbageCollector)}catch(e){Sr(e)?St(Xo,"Ignoring IndexedDB error during garbage collection: ",e):await br(e)}await this.Vr(3e5)})}}class ta{constructor(e,t){this.mr=e,this.params=t}calculateTargetCount(e,t){return this.mr.gr(e).next(e=>Math.floor(t/100*e))}nthSequenceNumber(e,t){if(0===t)return wr.resolve(Tr.ce);const r=new $o(t);return this.mr.forEachTarget(e,e=>r.Ar(e.sequenceNumber)).next(()=>this.mr.pr(e,e=>r.Ar(e))).next(()=>r.maxValue)}removeTargets(e,t,r){return this.mr.removeTargets(e,t,r)}removeOrphanedDocuments(e,t){return this.mr.removeOrphanedDocuments(e,t)}collect(e,t){return-1===this.params.cacheSizeCollectionThreshold?(St("LruGarbageCollector","Garbage collection skipped; disabled"),wr.resolve(Go)):this.getCacheSize(e).next(r=>r<this.params.cacheSizeCollectionThreshold?(St("LruGarbageCollector","Garbage collection skipped; Cache size ".concat(r," is lower than threshold ").concat(this.params.cacheSizeCollectionThreshold)),Go):this.yr(e,t))}getCacheSize(e){return this.mr.getCacheSize(e)}yr(e,t){let r,n,i,s,o,a,l;const c=Date.now();return this.calculateTargetCount(e,this.params.percentileToCollect).next(t=>(t>this.params.maximumSequenceNumbersToCollect?(St("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of ".concat(this.params.maximumSequenceNumbersToCollect," from ").concat(t)),n=this.params.maximumSequenceNumbersToCollect):n=t,s=Date.now(),this.nthSequenceNumber(e,n))).next(n=>(r=n,o=Date.now(),this.removeTargets(e,r,t))).next(t=>(i=t,a=Date.now(),this.removeOrphanedDocuments(e,r))).next(e=>(l=Date.now(),jt()<=R.DEBUG&&St("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in ".concat(s-c,"ms\n\tDetermined least recently used ").concat(n," in ")+(o-s)+"ms\n"+"\tRemoved ".concat(i," targets in ")+(a-o)+"ms\n"+"\tRemoved ".concat(e," documents in ")+(l-a)+"ms\n"+"Total Duration: ".concat(l-c,"ms")),wr.resolve({didRun:!0,sequenceNumbersCollected:n,targetsRemoved:i,documentsRemoved:e})))}}function ra(e,t){return new ta(e,t)}class na{constructor(){this.changes=new Hi(e=>e.toString(),(e,t)=>e.isEqual(t)),this.changesApplied=!1}addEntry(e){this.assertNotApplied(),this.changes.set(e.key,e)}removeEntry(e,t){this.assertNotApplied(),this.changes.set(e,ei.newInvalidDocument(e).setReadTime(t))}getEntry(e,t){this.assertNotApplied();const r=this.changes.get(t);return void 0!==r?wr.resolve(r):this.getFromCache(e,t)}getEntries(e,t){return this.getAllFromCache(e,t)}apply(e){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(e)}assertNotApplied(){}}class ia{constructor(e,t){this.overlayedDocument=e,this.mutatedFields=t}}class sa{constructor(e,t,r,n){this.remoteDocumentCache=e,this.mutationQueue=t,this.documentOverlayCache=r,this.indexManager=n}getDocument(e,t){let r=null;return this.documentOverlayCache.getOverlay(e,t).next(n=>(r=n,this.remoteDocumentCache.getEntry(e,t))).next(e=>(null!==r&&As(r.mutation,e,hn.empty(),dr.now()),e))}getDocuments(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.getLocalViewOfDocuments(e,t,rs()).next(()=>t))}getLocalViewOfDocuments(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:rs();const n=Ji();return this.populateOverlays(e,n,t).next(()=>this.computeViews(e,t,n,r).next(e=>{let t=Yi();return e.forEach((e,r)=>{t=t.insert(e,r.overlayedDocument)}),t}))}getOverlayedDocuments(e,t){const r=Ji();return this.populateOverlays(e,r,t).next(()=>this.computeViews(e,t,r,rs()))}populateOverlays(e,t,r){const n=[];return r.forEach(e=>{t.has(e)||n.push(e)}),this.documentOverlayCache.getOverlays(e,n).next(e=>{e.forEach((e,r)=>{t.set(e,r)})})}computeViews(e,t,r,n){let i=Zi();const s=$i(),o=$i();return t.forEach((e,t)=>{const o=r.get(t.key);n.has(t.key)&&(void 0===o||o.mutation instanceof Is)?i=i.insert(t.key,t):void 0!==o?(s.set(t.key,o.mutation.getFieldMask()),As(o.mutation,t,o.mutation.getFieldMask(),dr.now())):s.set(t.key,hn.empty())}),this.recalculateAndSaveOverlays(e,i).next(e=>(e.forEach((e,t)=>s.set(e,t)),t.forEach((e,t)=>{var r;return o.set(e,new ia(t,null!==(r=s.get(e))&&void 0!==r?r:null))}),o))}recalculateAndSaveOverlays(e,t){const r=$i();let n=new an((e,t)=>e-t),i=rs();return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(e,t).next(e=>{for(const i of e)i.keys().forEach(e=>{const s=t.get(e);if(null===s)return;let o=r.get(e)||hn.empty();o=i.applyToLocalView(s,o),r.set(e,o);const a=(n.get(i.batchId)||rs()).add(e);n=n.insert(i.batchId,a)})}).next(()=>{const s=[],o=n.getReverseIterator();for(;o.hasNext();){const n=o.getNext(),a=n.key,l=n.value,c=Qi();l.forEach(e=>{if(!i.has(e)){const n=Ts(t.get(e),r.get(e));null!==n&&c.set(e,n),i=i.add(e)}}),s.push(this.documentOverlayCache.saveOverlays(e,a,c))}return wr.waitFor(s)}).next(()=>r)}recalculateAndSaveOverlaysForDocumentKeys(e,t){return this.remoteDocumentCache.getEntries(e,t).next(t=>this.recalculateAndSaveOverlays(e,t))}getDocumentsMatchingQuery(e,t,r,n){return function(e){return er.isDocumentKey(e.path)&&null===e.collectionGroup&&0===e.filters.length}(t)?this.getDocumentsMatchingDocumentQuery(e,t.path):Pi(t)?this.getDocumentsMatchingCollectionGroupQuery(e,t,r,n):this.getDocumentsMatchingCollectionQuery(e,t,r,n)}getNextDocuments(e,t,r,n){return this.remoteDocumentCache.getAllFromCollectionGroup(e,t,r,n).next(i=>{const s=n-i.size>0?this.documentOverlayCache.getOverlaysForCollectionGroup(e,t,r.largestBatchId,n-i.size):wr.resolve(Ji());let o=pr,a=i;return s.next(t=>wr.forEach(t,(t,r)=>(o<r.largestBatchId&&(o=r.largestBatchId),i.get(t)?wr.resolve():this.remoteDocumentCache.getEntry(e,t).next(e=>{a=a.insert(t,e)}))).next(()=>this.populateOverlays(e,t,i)).next(()=>this.computeViews(e,a,t,rs())).next(e=>({batchId:o,changes:Xi(e)})))})}getDocumentsMatchingDocumentQuery(e,t){return this.getDocument(e,new er(t)).next(e=>{let t=Yi();return e.isFoundDocument()&&(t=t.insert(e.key,e)),t})}getDocumentsMatchingCollectionGroupQuery(e,t,r,n){const i=t.collectionGroup;let s=Yi();return this.indexManager.getCollectionParents(e,i).next(o=>wr.forEach(o,o=>{const a=function(e,t){return new Ci(t,null,e.explicitOrderBy.slice(),e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(t,o.child(i));return this.getDocumentsMatchingCollectionQuery(e,a,r,n).next(e=>{e.forEach((e,t)=>{s=s.insert(e,t)})})}).next(()=>s))}getDocumentsMatchingCollectionQuery(e,t,r,n){let i;return this.documentOverlayCache.getOverlaysForCollection(e,t.path,r.largestBatchId).next(s=>(i=s,this.remoteDocumentCache.getDocumentsMatchingQuery(e,t,r,i,n))).next(e=>{i.forEach((t,r)=>{const n=r.getKey();null===e.get(n)&&(e=e.insert(n,ei.newInvalidDocument(n)))});let r=Yi();return e.forEach((e,n)=>{const s=i.get(e);void 0!==s&&As(s.mutation,n,hn.empty(),dr.now()),Ui(t,n)&&(r=r.insert(e,n))}),r})}}class oa{constructor(e){this.serializer=e,this.Lr=new Map,this.kr=new Map}getBundleMetadata(e,t){return wr.resolve(this.Lr.get(t))}saveBundleMetadata(e,t){return this.Lr.set(t.id,function(e){return{id:e.id,version:e.version,createTime:go(e.createTime)}}(t)),wr.resolve()}getNamedQuery(e,t){return wr.resolve(this.kr.get(t))}saveNamedQuery(e,t){return this.kr.set(t.name,function(e){return{name:e.name,query:Vo(e.bundledQuery),readTime:go(e.readTime)}}(t)),wr.resolve()}}class aa{constructor(){this.overlays=new an(er.comparator),this.qr=new Map}getOverlay(e,t){return wr.resolve(this.overlays.get(t))}getOverlays(e,t){const r=Ji();return wr.forEach(t,t=>this.getOverlay(e,t).next(e=>{null!==e&&r.set(t,e)})).next(()=>r)}saveOverlays(e,t,r){return r.forEach((r,n)=>{this.St(e,t,n)}),wr.resolve()}removeOverlaysForBatchId(e,t,r){const n=this.qr.get(r);return void 0!==n&&(n.forEach(e=>this.overlays=this.overlays.remove(e)),this.qr.delete(r)),wr.resolve()}getOverlaysForCollection(e,t,r){const n=Ji(),i=t.length+1,s=new er(t.child("")),o=this.overlays.getIteratorFrom(s);for(;o.hasNext();){const e=o.getNext().value,s=e.getKey();if(!t.isPrefixOf(s.path))break;s.path.length===i&&e.largestBatchId>r&&n.set(e.getKey(),e)}return wr.resolve(n)}getOverlaysForCollectionGroup(e,t,r,n){let i=new an((e,t)=>e-t);const s=this.overlays.getIterator();for(;s.hasNext();){const e=s.getNext().value;if(e.getKey().getCollectionGroup()===t&&e.largestBatchId>r){let t=i.get(e.largestBatchId);null===t&&(t=Ji(),i=i.insert(e.largestBatchId,t)),t.set(e.getKey(),e)}}const o=Ji(),a=i.getIterator();for(;a.hasNext()&&(a.getNext().value.forEach((e,t)=>o.set(e,t)),!(o.size()>=n)););return wr.resolve(o)}St(e,t,r){const n=this.overlays.get(r.key);if(null!==n){const e=this.qr.get(n.largestBatchId).delete(r.key);this.qr.set(n.largestBatchId,e)}this.overlays=this.overlays.insert(r.key,new zs(t,r));let i=this.qr.get(t);void 0===i&&(i=rs(),this.qr.set(t,i)),this.qr.set(t,i.add(r.key))}}class la{constructor(){this.sessionToken=mn.EMPTY_BYTE_STRING}getSessionToken(e){return wr.resolve(this.sessionToken)}setSessionToken(e,t){return this.sessionToken=t,wr.resolve()}}class ca{constructor(){this.Qr=new un(ua.$r),this.Ur=new un(ua.Kr)}isEmpty(){return this.Qr.isEmpty()}addReference(e,t){const r=new ua(e,t);this.Qr=this.Qr.add(r),this.Ur=this.Ur.add(r)}Wr(e,t){e.forEach(e=>this.addReference(e,t))}removeReference(e,t){this.Gr(new ua(e,t))}zr(e,t){e.forEach(e=>this.removeReference(e,t))}jr(e){const t=new er(new Jt([])),r=new ua(t,e),n=new ua(t,e+1),i=[];return this.Ur.forEachInRange([r,n],e=>{this.Gr(e),i.push(e.key)}),i}Jr(){this.Qr.forEach(e=>this.Gr(e))}Gr(e){this.Qr=this.Qr.delete(e),this.Ur=this.Ur.delete(e)}Hr(e){const t=new er(new Jt([])),r=new ua(t,e),n=new ua(t,e+1);let i=rs();return this.Ur.forEachInRange([r,n],e=>{i=i.add(e.key)}),i}containsKey(e){const t=new ua(e,0),r=this.Qr.firstAfterOrEqual(t);return null!==r&&e.isEqual(r.key)}}class ua{constructor(e,t){this.key=e,this.Yr=t}static $r(e,t){return er.comparator(e.key,t.key)||Ht(e.Yr,t.Yr)}static Kr(e,t){return Ht(e.Yr,t.Yr)||er.comparator(e.key,t.key)}}class da{constructor(e,t){this.indexManager=e,this.referenceDelegate=t,this.mutationQueue=[],this.tr=1,this.Zr=new un(ua.$r)}checkEmpty(e){return wr.resolve(0===this.mutationQueue.length)}addMutationBatch(e,t,r,n){const i=this.tr;this.tr++,this.mutationQueue.length>0&&this.mutationQueue[this.mutationQueue.length-1];const s=new Fs(i,t,r,n);this.mutationQueue.push(s);for(const o of n)this.Zr=this.Zr.add(new ua(o.key,i)),this.indexManager.addToCollectionParentIndex(e,o.key.path.popLast());return wr.resolve(s)}lookupMutationBatch(e,t){return wr.resolve(this.Xr(t))}getNextMutationBatchAfterBatchId(e,t){const r=t+1,n=this.ei(r),i=n<0?0:n;return wr.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)}getHighestUnacknowledgedBatchId(){return wr.resolve(0===this.mutationQueue.length?kr:this.tr-1)}getAllMutationBatches(e){return wr.resolve(this.mutationQueue.slice())}getAllMutationBatchesAffectingDocumentKey(e,t){const r=new ua(t,0),n=new ua(t,Number.POSITIVE_INFINITY),i=[];return this.Zr.forEachInRange([r,n],e=>{const t=this.Xr(e.Yr);i.push(t)}),wr.resolve(i)}getAllMutationBatchesAffectingDocumentKeys(e,t){let r=new un(Ht);return t.forEach(e=>{const t=new ua(e,0),n=new ua(e,Number.POSITIVE_INFINITY);this.Zr.forEachInRange([t,n],e=>{r=r.add(e.Yr)})}),wr.resolve(this.ti(r))}getAllMutationBatchesAffectingQuery(e,t){const r=t.path,n=r.length+1;let i=r;er.isDocumentKey(i)||(i=i.child(""));const s=new ua(new er(i),0);let o=new un(Ht);return this.Zr.forEachWhile(e=>{const t=e.key.path;return!!r.isPrefixOf(t)&&(t.length===n&&(o=o.add(e.Yr)),!0)},s),wr.resolve(this.ti(o))}ti(e){const t=[];return e.forEach(e=>{const r=this.Xr(e);null!==r&&t.push(r)}),t}removeMutationBatch(e,t){Nt(0===this.ni(t.batchId,"removed"),55003),this.mutationQueue.shift();let r=this.Zr;return wr.forEach(t.mutations,n=>{const i=new ua(n.key,t.batchId);return r=r.delete(i),this.referenceDelegate.markPotentiallyOrphaned(e,n.key)}).next(()=>{this.Zr=r})}ir(e){}containsKey(e,t){const r=new ua(t,0),n=this.Zr.firstAfterOrEqual(r);return wr.resolve(t.isEqual(n&&n.key))}performConsistencyCheck(e){return this.mutationQueue.length,wr.resolve()}ni(e,t){return this.ei(e)}ei(e){return 0===this.mutationQueue.length?0:e-this.mutationQueue[0].batchId}Xr(e){const t=this.ei(e);return t<0||t>=this.mutationQueue.length?null:this.mutationQueue[t]}}class ha{constructor(e){this.ri=e,this.docs=new an(er.comparator),this.size=0}setIndexManager(e){this.indexManager=e}addEntry(e,t){const r=t.key,n=this.docs.get(r),i=n?n.size:0,s=this.ri(t);return this.docs=this.docs.insert(r,{document:t.mutableCopy(),size:s}),this.size+=s-i,this.indexManager.addToCollectionParentIndex(e,r.path.popLast())}removeEntry(e){const t=this.docs.get(e);t&&(this.docs=this.docs.remove(e),this.size-=t.size)}getEntry(e,t){const r=this.docs.get(t);return wr.resolve(r?r.document.mutableCopy():ei.newInvalidDocument(t))}getEntries(e,t){let r=Zi();return t.forEach(e=>{const t=this.docs.get(e);r=r.insert(e,t?t.document.mutableCopy():ei.newInvalidDocument(e))}),wr.resolve(r)}getDocumentsMatchingQuery(e,t,r,n){let i=Zi();const s=t.path,o=new er(s.child("__id-9223372036854775808__")),a=this.docs.getIteratorFrom(o);for(;a.hasNext();){const{key:e,value:{document:o}}=a.getNext();if(!s.isPrefixOf(e.path))break;e.path.length>s.length+1||_r(gr(o),r)<=0||(n.has(o.key)||Ui(t,o))&&(i=i.insert(o.key,o.mutableCopy()))}return wr.resolve(i)}getAllFromCollectionGroup(e,t,r,n){Ct(9500)}ii(e,t){return wr.forEach(this.docs,e=>t(e))}newChangeBuffer(e){return new pa(this)}getSize(e){return wr.resolve(this.size)}}class pa extends na{constructor(e){super(),this.Nr=e}applyChanges(e){const t=[];return this.changes.forEach((r,n)=>{n.isValidDocument()?t.push(this.Nr.addEntry(e,n)):this.Nr.removeEntry(r)}),wr.waitFor(t)}getFromCache(e,t){return this.Nr.getEntry(e,t)}getAllFromCache(e,t){return this.Nr.getEntries(e,t)}}class ma{constructor(e){this.persistence=e,this.si=new Hi(e=>Ti(e),ki),this.lastRemoteSnapshotVersion=hr.min(),this.highestTargetId=0,this.oi=0,this._i=new ca,this.targetCount=0,this.ai=Yo.ur()}forEachTarget(e,t){return this.si.forEach((e,r)=>t(r)),wr.resolve()}getLastRemoteSnapshotVersion(e){return wr.resolve(this.lastRemoteSnapshotVersion)}getHighestSequenceNumber(e){return wr.resolve(this.oi)}allocateTargetId(e){return this.highestTargetId=this.ai.next(),wr.resolve(this.highestTargetId)}setTargetsMetadata(e,t,r){return r&&(this.lastRemoteSnapshotVersion=r),t>this.oi&&(this.oi=t),wr.resolve()}Pr(e){this.si.set(e.target,e);const t=e.targetId;t>this.highestTargetId&&(this.ai=new Yo(t),this.highestTargetId=t),e.sequenceNumber>this.oi&&(this.oi=e.sequenceNumber)}addTargetData(e,t){return this.Pr(t),this.targetCount+=1,wr.resolve()}updateTargetData(e,t){return this.Pr(t),wr.resolve()}removeTargetData(e,t){return this.si.delete(t.target),this._i.jr(t.targetId),this.targetCount-=1,wr.resolve()}removeTargets(e,t,r){let n=0;const i=[];return this.si.forEach((s,o)=>{o.sequenceNumber<=t&&null===r.get(o.targetId)&&(this.si.delete(s),i.push(this.removeMatchingKeysForTargetId(e,o.targetId)),n++)}),wr.waitFor(i).next(()=>n)}getTargetCount(e){return wr.resolve(this.targetCount)}getTargetData(e,t){const r=this.si.get(t)||null;return wr.resolve(r)}addMatchingKeys(e,t,r){return this._i.Wr(t,r),wr.resolve()}removeMatchingKeys(e,t,r){this._i.zr(t,r);const n=this.persistence.referenceDelegate,i=[];return n&&t.forEach(t=>{i.push(n.markPotentiallyOrphaned(e,t))}),wr.waitFor(i)}removeMatchingKeysForTargetId(e,t){return this._i.jr(t),wr.resolve()}getMatchingKeysForTargetId(e,t){const r=this._i.Hr(t);return wr.resolve(r)}containsKey(e,t){return wr.resolve(this._i.containsKey(t))}}class fa{constructor(e,t){this.ui={},this.overlays={},this.ci=new Tr(0),this.li=!1,this.li=!0,this.hi=new la,this.referenceDelegate=e(this),this.Pi=new ma(this),this.indexManager=new Wo,this.remoteDocumentCache=function(e){return new ha(e)}(e=>this.referenceDelegate.Ti(e)),this.serializer=new Uo(t),this.Ii=new oa(this.serializer)}start(){return Promise.resolve()}shutdown(){return this.li=!1,Promise.resolve()}get started(){return this.li}setDatabaseDeletedListener(){}setNetworkEnabled(){}getIndexManager(e){return this.indexManager}getDocumentOverlayCache(e){let t=this.overlays[e.toKey()];return t||(t=new aa,this.overlays[e.toKey()]=t),t}getMutationQueue(e,t){let r=this.ui[e.toKey()];return r||(r=new da(t,this.referenceDelegate),this.ui[e.toKey()]=r),r}getGlobalsCache(){return this.hi}getTargetCache(){return this.Pi}getRemoteDocumentCache(){return this.remoteDocumentCache}getBundleCache(){return this.Ii}runTransaction(e,t,r){St("MemoryPersistence","Starting transaction:",e);const n=new ga(this.ci.next());return this.referenceDelegate.Ei(),r(n).next(e=>this.referenceDelegate.di(n).next(()=>e)).toPromise().then(e=>(n.raiseOnCommittedEvent(),e))}Ai(e,t){return wr.or(Object.values(this.ui).map(r=>()=>r.containsKey(e,t)))}}class ga extends xr{constructor(e){super(),this.currentSequenceNumber=e}}class ya{constructor(e){this.persistence=e,this.Ri=new ca,this.Vi=null}static mi(e){return new ya(e)}get fi(){if(this.Vi)return this.Vi;throw Ct(60996)}addReference(e,t,r){return this.Ri.addReference(r,t),this.fi.delete(r.toString()),wr.resolve()}removeReference(e,t,r){return this.Ri.removeReference(r,t),this.fi.add(r.toString()),wr.resolve()}markPotentiallyOrphaned(e,t){return this.fi.add(t.toString()),wr.resolve()}removeTarget(e,t){this.Ri.jr(t.targetId).forEach(e=>this.fi.add(e.toString()));const r=this.persistence.getTargetCache();return r.getMatchingKeysForTargetId(e,t.targetId).next(e=>{e.forEach(e=>this.fi.add(e.toString()))}).next(()=>r.removeTargetData(e,t))}Ei(){this.Vi=new Set}di(e){const t=this.persistence.getRemoteDocumentCache().newChangeBuffer();return wr.forEach(this.fi,r=>{const n=er.fromPath(r);return this.gi(e,n).next(e=>{e||t.removeEntry(n,hr.min())})}).next(()=>(this.Vi=null,t.apply(e)))}updateLimboDocument(e,t){return this.gi(e,t).next(e=>{e?this.fi.delete(t.toString()):this.fi.add(t.toString())})}Ti(e){return 0}gi(e,t){return wr.or([()=>wr.resolve(this.Ri.containsKey(t)),()=>this.persistence.getTargetCache().containsKey(e,t),()=>this.persistence.Ai(e,t)])}}class _a{constructor(e,t){this.persistence=e,this.pi=new Hi(e=>Ir(e.path),(e,t)=>e.isEqual(t)),this.garbageCollector=ra(this,t)}static mi(e,t){return new _a(e,t)}Ei(){}di(e){return wr.resolve()}forEachTarget(e,t){return this.persistence.getTargetCache().forEachTarget(e,t)}gr(e){const t=this.wr(e);return this.persistence.getTargetCache().getTargetCount(e).next(e=>t.next(t=>e+t))}wr(e){let t=0;return this.pr(e,e=>{t++}).next(()=>t)}pr(e,t){return wr.forEach(this.pi,(r,n)=>this.br(e,r,n).next(e=>e?wr.resolve():t(n)))}removeTargets(e,t,r){return this.persistence.getTargetCache().removeTargets(e,t,r)}removeOrphanedDocuments(e,t){let r=0;const n=this.persistence.getRemoteDocumentCache(),i=n.newChangeBuffer();return n.ii(e,n=>this.br(e,n,t).next(e=>{e||(r++,i.removeEntry(n,hr.min()))})).next(()=>i.apply(e)).next(()=>r)}markPotentiallyOrphaned(e,t){return this.pi.set(t,e.currentSequenceNumber),wr.resolve()}removeTarget(e,t){const r=t.withSequenceNumber(e.currentSequenceNumber);return this.persistence.getTargetCache().updateTargetData(e,r)}addReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),wr.resolve()}removeReference(e,t,r){return this.pi.set(r,e.currentSequenceNumber),wr.resolve()}updateLimboDocument(e,t){return this.pi.set(t,e.currentSequenceNumber),wr.resolve()}Ti(e){let t=e.key.toString().length;return e.isFoundDocument()&&(t+=Vn(e.data.value)),t}br(e,t,r){return wr.or([()=>this.persistence.Ai(e,t),()=>this.persistence.getTargetCache().containsKey(e,t),()=>{const e=this.pi.get(t);return wr.resolve(void 0!==e&&e>r)}])}getCacheSize(e){return this.persistence.getRemoteDocumentCache().getSize(e)}}class va{constructor(e,t,r,n){this.targetId=e,this.fromCache=t,this.Es=r,this.ds=n}static As(e,t){let r=rs(),n=rs();for(const i of t.docChanges)switch(i.type){case 0:r=r.add(i.doc.key);break;case 1:n=n.add(i.doc.key)}return new va(e,t.fromCache,r,n)}}class xa{constructor(){this._documentReadCount=0}get documentReadCount(){return this._documentReadCount}incrementDocumentReadCount(e){this._documentReadCount+=e}}class ba{constructor(){this.Rs=!1,this.Vs=!1,this.fs=100,this.gs=w()?8:jr(x())>0?6:4}initialize(e,t){this.ps=e,this.indexManager=t,this.Rs=!0}getDocumentsMatchingQuery(e,t,r,n){const i={result:null};return this.ys(e,t).next(e=>{i.result=e}).next(()=>{if(!i.result)return this.ws(e,t,n,r).next(e=>{i.result=e})}).next(()=>{if(i.result)return;const r=new xa;return this.Ss(e,t,r).next(n=>{if(i.result=n,this.Vs)return this.bs(e,t,r,n.size)})}).next(()=>i.result)}bs(e,t,r,n){return r.documentReadCount<this.fs?(jt()<=R.DEBUG&&St("QueryEngine","SDK will not create cache indexes for query:",Bi(t),"since it only creates cache indexes for collection contains","more than or equal to",this.fs,"documents"),wr.resolve()):(jt()<=R.DEBUG&&St("QueryEngine","Query:",Bi(t),"scans",r.documentReadCount,"local documents and returns",n,"documents as results."),r.documentReadCount>this.gs*n?(jt()<=R.DEBUG&&St("QueryEngine","The SDK decides to create cache indexes for query:",Bi(t),"as using cache indexes may help improve performance."),this.indexManager.createTargetIndexes(e,Li(t))):wr.resolve())}ys(e,t){if(Ii(t))return wr.resolve(null);let r=Li(t);return this.indexManager.getIndexType(e,r).next(n=>0===n?null:(null!==t.limit&&1===n&&(t=Fi(t,null,"F"),r=Li(t)),this.indexManager.getDocumentsMatchingTarget(e,r).next(n=>{const i=rs(...n);return this.ps.getDocuments(e,i).next(n=>this.indexManager.getMinOffset(e,r).next(r=>{const s=this.Ds(t,n);return this.Cs(t,s,i,r.readTime)?this.ys(e,Fi(t,null,"F")):this.vs(e,s,t,r)}))})))}ws(e,t,r,n){return Ii(t)||n.isEqual(hr.min())?wr.resolve(null):this.ps.getDocuments(e,r).next(i=>{const s=this.Ds(t,i);return this.Cs(t,s,r,n)?wr.resolve(null):(jt()<=R.DEBUG&&St("QueryEngine","Re-using previous result from %s to execute query: %s",n.toString(),Bi(t)),this.vs(e,s,t,fr(n,pr)).next(e=>e))})}Ds(e,t){let r=new un(qi(e));return t.forEach((t,n)=>{Ui(e,n)&&(r=r.add(n))}),r}Cs(e,t,r,n){if(null===e.limit)return!1;if(r.size!==t.size)return!0;const i="F"===e.limitType?t.last():t.first();return!!i&&(i.hasPendingWrites||i.version.compareTo(n)>0)}Ss(e,t,r){return jt()<=R.DEBUG&&St("QueryEngine","Using full collection scan to execute query:",Bi(t)),this.ps.getDocumentsMatchingQuery(e,t,yr.min(),r)}vs(e,t,r,n){return this.ps.getDocumentsMatchingQuery(e,r,n).next(e=>(t.forEach(t=>{e=e.insert(t.key,t)}),e))}}const wa="LocalStore";class ja{constructor(e,t,r,n){this.persistence=e,this.Fs=t,this.serializer=n,this.Ms=new an(Ht),this.xs=new Hi(e=>Ti(e),ki),this.Os=new Map,this.Ns=e.getRemoteDocumentCache(),this.Pi=e.getTargetCache(),this.Ii=e.getBundleCache(),this.Bs(r)}Bs(e){this.documentOverlayCache=this.persistence.getDocumentOverlayCache(e),this.indexManager=this.persistence.getIndexManager(e),this.mutationQueue=this.persistence.getMutationQueue(e,this.indexManager),this.localDocuments=new sa(this.Ns,this.mutationQueue,this.documentOverlayCache,this.indexManager),this.Ns.setIndexManager(this.indexManager),this.Fs.initialize(this.localDocuments,this.indexManager)}collectGarbage(e){return this.persistence.runTransaction("Collect garbage","readwrite-primary",t=>e.collect(t,this.Ms))}}function Sa(e,t,r,n){return new ja(e,t,r,n)}async function Ta(e,t){const r=It(e);return await r.persistence.runTransaction("Handle user change","readonly",e=>{let n;return r.mutationQueue.getAllMutationBatches(e).next(i=>(n=i,r.Bs(t),r.mutationQueue.getAllMutationBatches(e))).next(t=>{const i=[],s=[];let o=rs();for(const e of n){i.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}for(const e of t){s.push(e.batchId);for(const t of e.mutations)o=o.add(t.key)}return r.localDocuments.getDocuments(e,o).next(e=>({Ls:e,removedBatchIds:i,addedBatchIds:s}))})})}function ka(e){const t=It(e);return t.persistence.runTransaction("Get last remote snapshot version","readonly",e=>t.Pi.getLastRemoteSnapshotVersion(e))}function Aa(e,t,r){let n=rs(),i=rs();return r.forEach(e=>n=n.add(e)),t.getEntries(e,n).next(e=>{let n=Zi();return r.forEach((r,s)=>{const o=e.get(r);s.isFoundDocument()!==o.isFoundDocument()&&(i=i.add(r)),s.isNoDocument()&&s.version.isEqual(hr.min())?(t.removeEntry(r,s.readTime),n=n.insert(r,s)):!o.isValidDocument()||s.version.compareTo(o.version)>0||0===s.version.compareTo(o.version)&&o.hasPendingWrites?(t.addEntry(s),n=n.insert(r,s)):St(wa,"Ignoring outdated watch update for ",r,". Current version:",o.version," Watch version:",s.version)}),{ks:n,qs:i}})}function Ca(e,t){const r=It(e);return r.persistence.runTransaction("Get next mutation batch","readonly",e=>(void 0===t&&(t=kr),r.mutationQueue.getNextMutationBatchAfterBatchId(e,t)))}function Ea(e,t){const r=It(e);return r.persistence.runTransaction("Allocate target","readwrite",e=>{let n;return r.Pi.getTargetData(e,t).next(i=>i?(n=i,wr.resolve(n)):r.Pi.allocateTargetId(e).next(i=>(n=new Bo(t,i,"TargetPurposeListen",e.currentSequenceNumber),r.Pi.addTargetData(e,n).next(()=>n))))}).then(e=>{const n=r.Ms.get(e.targetId);return(null===n||e.snapshotVersion.compareTo(n.snapshotVersion)>0)&&(r.Ms=r.Ms.insert(e.targetId,e),r.xs.set(t,e.targetId)),e})}async function Na(e,t,r){const n=It(e),i=n.Ms.get(t),s=r?"readwrite":"readwrite-primary";try{r||await n.persistence.runTransaction("Release target",s,e=>n.persistence.referenceDelegate.removeTarget(e,i))}catch(e){if(!Sr(e))throw e;St(wa,"Failed to update sequence numbers for target ".concat(t,": ").concat(e))}n.Ms=n.Ms.remove(t),n.xs.delete(i.target)}function Ia(e,t,r){const n=It(e);let i=hr.min(),s=rs();return n.persistence.runTransaction("Execute query","readwrite",e=>function(e,t,r){const n=It(e),i=n.xs.get(r);return void 0!==i?wr.resolve(n.Ms.get(i)):n.Pi.getTargetData(t,r)}(n,e,Li(t)).next(t=>{if(t)return i=t.lastLimboFreeSnapshotVersion,n.Pi.getMatchingKeysForTargetId(e,t.targetId).next(e=>{s=e})}).next(()=>n.Fs.getDocumentsMatchingQuery(e,t,r?i:hr.min(),r?s:rs())).next(e=>(Pa(n,Vi(t),e),{documents:e,Qs:s})))}function Pa(e,t,r){let n=e.Os.get(t)||hr.min();r.forEach((e,t)=>{t.readTime.compareTo(n)>0&&(n=t.readTime)}),e.Os.set(t,n)}class Ma{constructor(){this.activeTargetIds=is()}zs(e){this.activeTargetIds=this.activeTargetIds.add(e)}js(e){this.activeTargetIds=this.activeTargetIds.delete(e)}Gs(){const e={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(e)}}class La{constructor(){this.Mo=new Ma,this.xo={},this.onlineStateHandler=null,this.sequenceNumberHandler=null}addPendingMutation(e){}updateMutationState(e,t,r){}addLocalQueryTarget(e){return(!(arguments.length>1&&void 0!==arguments[1])||arguments[1])&&this.Mo.zs(e),this.xo[e]||"not-current"}updateQueryState(e,t,r){this.xo[e]=t}removeLocalQueryTarget(e){this.Mo.js(e)}isLocalQueryTarget(e){return this.Mo.activeTargetIds.has(e)}clearQueryState(e){delete this.xo[e]}getAllActiveQueryTargets(){return this.Mo.activeTargetIds}isActiveQueryTarget(e){return this.Mo.activeTargetIds.has(e)}start(){return this.Mo=new Ma,Promise.resolve()}handleUserChange(e,t,r){}setOnlineState(e){}shutdown(){}writeSequenceNumber(e){}notifyBundleLoaded(e){}}class Ra{Oo(e){}shutdown(){}}const Da="ConnectivityMonitor";class Fa{constructor(){this.No=()=>this.Bo(),this.Lo=()=>this.ko(),this.qo=[],this.Qo()}Oo(e){this.qo.push(e)}shutdown(){window.removeEventListener("online",this.No),window.removeEventListener("offline",this.Lo)}Qo(){window.addEventListener("online",this.No),window.addEventListener("offline",this.Lo)}Bo(){St(Da,"Network connectivity changed: AVAILABLE");for(const e of this.qo)e(0)}ko(){St(Da,"Network connectivity changed: UNAVAILABLE");for(const e of this.qo)e(1)}static v(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener}}let Oa=null;function za(){return null===Oa?Oa=268435456+Math.round(2147483648*Math.random()):Oa++,"0x"+Oa.toString(16)}const Ba="RestConnection",Ua={BatchGetDocuments:"batchGet",Commit:"commit",RunQuery:"runQuery",RunAggregationQuery:"runAggregationQuery"};class Va{get $o(){return!1}constructor(e){this.databaseInfo=e,this.databaseId=e.databaseId;const t=e.ssl?"https":"http",r=encodeURIComponent(this.databaseId.projectId),n=encodeURIComponent(this.databaseId.database);this.Uo=t+"://"+e.host,this.Ko="projects/".concat(r,"/databases/").concat(n),this.Wo=this.databaseId.database===An?"project_id=".concat(r):"project_id=".concat(r,"&database_id=").concat(n)}Go(e,t,r,n,i){const s=za(),o=this.zo(e,t.toUriEncodedString());St(Ba,"Sending RPC '".concat(e,"' ").concat(s,":"),o,r);const a={"google-cloud-resource-prefix":this.Ko,"x-goog-request-params":this.Wo};this.jo(a,n,i);const{host:l}=new URL(o),c=m(l);return this.Jo(e,o,a,r,c).then(t=>(St(Ba,"Received RPC '".concat(e,"' ").concat(s,": "),t),t),t=>{throw kt(Ba,"RPC '".concat(e,"' ").concat(s," failed with error: "),t,"url: ",o,"request:",r),t})}Ho(e,t,r,n,i,s){return this.Go(e,t,r,n,i)}jo(e,t,r){e["X-Goog-Api-Client"]="gl-js/ fire/"+bt,e["Content-Type"]="text/plain",this.databaseInfo.appId&&(e["X-Firebase-GMPID"]=this.databaseInfo.appId),t&&t.headers.forEach((t,r)=>e[r]=t),r&&r.headers.forEach((t,r)=>e[r]=t)}zo(e,t){const r=Ua[e];return"".concat(this.Uo,"/v1/").concat(t,":").concat(r)}terminate(){}}class qa{constructor(e){this.Yo=e.Yo,this.Zo=e.Zo}Xo(e){this.e_=e}t_(e){this.n_=e}r_(e){this.i_=e}onMessage(e){this.s_=e}close(){this.Zo()}send(e){this.Yo(e)}o_(){this.e_()}__(){this.n_()}a_(e){this.i_(e)}u_(e){this.s_(e)}}const Wa="WebChannelConnection";class Ha extends Va{constructor(e){super(e),this.c_=[],this.forceLongPolling=e.forceLongPolling,this.autoDetectLongPolling=e.autoDetectLongPolling,this.useFetchStreams=e.useFetchStreams,this.longPollingOptions=e.longPollingOptions}Jo(e,t,r,n,i){const s=za();return new Promise((i,o)=>{const a=new lt;a.setWithCredentials(!0),a.listenOnce(ut.COMPLETE,()=>{try{switch(a.getLastErrorCode()){case dt.NO_ERROR:const r=a.getResponseJson();St(Wa,"XHR for RPC '".concat(e,"' ").concat(s," received:"),JSON.stringify(r)),i(r);break;case dt.TIMEOUT:St(Wa,"RPC '".concat(e,"' ").concat(s," timed out")),o(new Mt(Pt.DEADLINE_EXCEEDED,"Request time out"));break;case dt.HTTP_ERROR:const n=a.getStatus();if(St(Wa,"RPC '".concat(e,"' ").concat(s," failed with status:"),n,"response text:",a.getResponseText()),n>0){var t;let e=a.getResponseJson();Array.isArray(e)&&(e=e[0]);const r=null===(t=e)||void 0===t?void 0:t.error;if(r&&r.status&&r.message){const e=function(e){const t=e.toLowerCase().replace(/_/g,"-");return Object.values(Pt).indexOf(t)>=0?t:Pt.UNKNOWN}(r.status);o(new Mt(e,r.message))}else o(new Mt(Pt.UNKNOWN,"Server responded with status "+a.getStatus()))}else o(new Mt(Pt.UNAVAILABLE,"Connection failed."));break;default:Ct(9055,{l_:e,streamId:s,h_:a.getLastErrorCode(),P_:a.getLastError()})}}finally{St(Wa,"RPC '".concat(e,"' ").concat(s," completed."))}});const l=JSON.stringify(n);St(Wa,"RPC '".concat(e,"' ").concat(s," sending request:"),n),a.send(t,"POST",l,r,15)})}T_(e,t,r){const n=za(),i=[this.Uo,"/","google.firestore.v1.Firestore","/",e,"/channel"],s=ft(),o=mt(),a={httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/".concat(this.databaseId.projectId,"/databases/").concat(this.databaseId.database)},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling,detectBufferingProxy:this.autoDetectLongPolling},l=this.longPollingOptions.timeoutSeconds;void 0!==l&&(a.longPollingTimeout=Math.round(1e3*l)),this.useFetchStreams&&(a.useFetchStreams=!0),this.jo(a.initMessageHeaders,t,r),a.encodeInitMessageHeaders=!0;const c=i.join("");St(Wa,"Creating RPC '".concat(e,"' stream ").concat(n,": ").concat(c),a);const u=s.createWebChannel(c,a);this.I_(u);let d=!1,h=!1;const p=new qa({Yo:t=>{h?St(Wa,"Not sending because RPC '".concat(e,"' stream ").concat(n," is closed:"),t):(d||(St(Wa,"Opening RPC '".concat(e,"' stream ").concat(n," transport.")),u.open(),d=!0),St(Wa,"RPC '".concat(e,"' stream ").concat(n," sending:"),t),u.send(t))},Zo:()=>u.close()}),m=(e,t,r)=>{e.listen(t,e=>{try{r(e)}catch(e){setTimeout(()=>{throw e},0)}})};return m(u,ct.EventType.OPEN,()=>{h||(St(Wa,"RPC '".concat(e,"' stream ").concat(n," transport opened.")),p.o_())}),m(u,ct.EventType.CLOSE,()=>{h||(h=!0,St(Wa,"RPC '".concat(e,"' stream ").concat(n," transport closed")),p.a_(),this.E_(u))}),m(u,ct.EventType.ERROR,t=>{h||(h=!0,kt(Wa,"RPC '".concat(e,"' stream ").concat(n," transport errored. Name:"),t.name,"Message:",t.message),p.a_(new Mt(Pt.UNAVAILABLE,"The operation could not be completed")))}),m(u,ct.EventType.MESSAGE,t=>{if(!h){var r;const i=t.data[0];Nt(!!i,16349);const s=i,o=(null===s||void 0===s?void 0:s.error)||(null===(r=s[0])||void 0===r?void 0:r.error);if(o){St(Wa,"RPC '".concat(e,"' stream ").concat(n," received error:"),o);const t=o.status;let r=function(e){const t=Us[e];if(void 0!==t)return Ws(t)}(t),i=o.message;void 0===r&&(r=Pt.INTERNAL,i="Unknown error status: "+t+" with message "+o.message),h=!0,p.a_(new Mt(r,i)),u.close()}else St(Wa,"RPC '".concat(e,"' stream ").concat(n," received:"),i),p.u_(i)}}),m(o,pt.STAT_EVENT,t=>{t.stat===ht.PROXY?St(Wa,"RPC '".concat(e,"' stream ").concat(n," detected buffering proxy")):t.stat===ht.NOPROXY&&St(Wa,"RPC '".concat(e,"' stream ").concat(n," detected no buffering proxy"))}),setTimeout(()=>{p.__()},0),p}terminate(){this.c_.forEach(e=>e.close()),this.c_=[]}I_(e){this.c_.push(e)}E_(e){this.c_=this.c_.filter(t=>t===e)}}function Ga(){return"undefined"!=typeof document?document:null}function Za(e){return new uo(e,!0)}class Ka{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e3,n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:1.5,i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:6e4;this.Mi=e,this.timerId=t,this.d_=r,this.A_=n,this.R_=i,this.V_=0,this.m_=null,this.f_=Date.now(),this.reset()}reset(){this.V_=0}g_(){this.V_=this.R_}p_(e){this.cancel();const t=Math.floor(this.V_+this.y_()),r=Math.max(0,Date.now()-this.f_),n=Math.max(0,t-r);n>0&&St("ExponentialBackoff","Backing off for ".concat(n," ms (base delay: ").concat(this.V_," ms, delay with jitter: ").concat(t," ms, last attempt: ").concat(r," ms ago)")),this.m_=this.Mi.enqueueAfterDelay(this.timerId,n,()=>(this.f_=Date.now(),e())),this.V_*=this.A_,this.V_<this.d_&&(this.V_=this.d_),this.V_>this.R_&&(this.V_=this.R_)}w_(){null!==this.m_&&(this.m_.skipDelay(),this.m_=null)}cancel(){null!==this.m_&&(this.m_.cancel(),this.m_=null)}y_(){return(Math.random()-.5)*this.V_}}const Ya="PersistentStream";class Xa{constructor(e,t,r,n,i,s,o,a){this.Mi=e,this.S_=r,this.b_=n,this.connection=i,this.authCredentialsProvider=s,this.appCheckCredentialsProvider=o,this.listener=a,this.state=0,this.D_=0,this.C_=null,this.v_=null,this.stream=null,this.F_=0,this.M_=new Ka(e,t)}x_(){return 1===this.state||5===this.state||this.O_()}O_(){return 2===this.state||3===this.state}start(){this.F_=0,4!==this.state?this.auth():this.N_()}async stop(){this.x_()&&await this.close(0)}B_(){this.state=0,this.M_.reset()}L_(){this.O_()&&null===this.C_&&(this.C_=this.Mi.enqueueAfterDelay(this.S_,6e4,()=>this.k_()))}q_(e){this.Q_(),this.stream.send(e)}async k_(){if(this.O_())return this.close(0)}Q_(){this.C_&&(this.C_.cancel(),this.C_=null)}U_(){this.v_&&(this.v_.cancel(),this.v_=null)}async close(e,t){this.Q_(),this.U_(),this.M_.cancel(),this.D_++,4!==e?this.M_.reset():t&&t.code===Pt.RESOURCE_EXHAUSTED?(Tt(t.toString()),Tt("Using maximum backoff delay to prevent overloading the backend."),this.M_.g_()):t&&t.code===Pt.UNAUTHENTICATED&&3!==this.state&&(this.authCredentialsProvider.invalidateToken(),this.appCheckCredentialsProvider.invalidateToken()),null!==this.stream&&(this.K_(),this.stream.close(),this.stream=null),this.state=e,await this.listener.r_(t)}K_(){}auth(){this.state=1;const e=this.W_(this.D_),t=this.D_;Promise.all([this.authCredentialsProvider.getToken(),this.appCheckCredentialsProvider.getToken()]).then(e=>{let[r,n]=e;this.D_===t&&this.G_(r,n)},t=>{e(()=>{const e=new Mt(Pt.UNKNOWN,"Fetching auth token failed: "+t.message);return this.z_(e)})})}G_(e,t){const r=this.W_(this.D_);this.stream=this.j_(e,t),this.stream.Xo(()=>{r(()=>this.listener.Xo())}),this.stream.t_(()=>{r(()=>(this.state=2,this.v_=this.Mi.enqueueAfterDelay(this.b_,1e4,()=>(this.O_()&&(this.state=3),Promise.resolve())),this.listener.t_()))}),this.stream.r_(e=>{r(()=>this.z_(e))}),this.stream.onMessage(e=>{r(()=>1==++this.F_?this.J_(e):this.onNext(e))})}N_(){this.state=5,this.M_.p_(async()=>{this.state=0,this.start()})}z_(e){return St(Ya,"close with error: ".concat(e)),this.stream=null,this.close(4,e)}W_(e){return t=>{this.Mi.enqueueAndForget(()=>this.D_===e?t():(St(Ya,"stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve()))}}}class Ja extends Xa{constructor(e,t,r,n,i,s){super(e,"listen_stream_connection_backoff","listen_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}j_(e,t){return this.connection.T_("Listen",e,t)}J_(e){return this.onNext(e)}onNext(e){this.M_.reset();const t=function(e,t){let r;if("targetChange"in t){t.targetChange;const n=function(e){return"NO_CHANGE"===e?0:"ADD"===e?1:"REMOVE"===e?2:"CURRENT"===e?3:"RESET"===e?4:Ct(39313,{state:e})}(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],s=function(e,t){return e.useProto3Json?(Nt(void 0===t||"string"==typeof t,58123),mn.fromBase64String(t||"")):(Nt(void 0===t||t instanceof Buffer||t instanceof Uint8Array,16193),mn.fromUint8Array(t||new Uint8Array))}(e,t.targetChange.resumeToken),o=t.targetChange.cause,a=o&&function(e){const t=void 0===e.code?Pt.UNKNOWN:Ws(e.code);return new Mt(t,e.message||"")}(o);r=new ro(n,i,s,a||null)}else if("documentChange"in t){t.documentChange;const n=t.documentChange;n.document,n.document.name,n.document.updateTime;const i=bo(e,n.document.name),s=go(n.document.updateTime),o=n.document.createTime?go(n.document.createTime):hr.min(),a=new Qn({mapValue:{fields:n.document.fields}}),l=ei.newFoundDocument(i,s,o,a),c=n.targetIds||[],u=n.removedTargetIds||[];r=new eo(c,u,l.key,l)}else if("documentDelete"in t){t.documentDelete;const n=t.documentDelete;n.document;const i=bo(e,n.document),s=n.readTime?go(n.readTime):hr.min(),o=ei.newNoDocument(i,s),a=n.removedTargetIds||[];r=new eo([],a,o.key,o)}else if("documentRemove"in t){t.documentRemove;const n=t.documentRemove;n.document;const i=bo(e,n.document),s=n.removedTargetIds||[];r=new eo([],s,i,null)}else{if(!("filter"in t))return Ct(11601,{Rt:t});{t.filter;const e=t.filter;e.targetId;const{count:n=0,unchangedNames:i}=e,s=new Bs(n,i),o=e.targetId;r=new to(o,s)}}return r}(this.serializer,e),r=function(e){if(!("targetChange"in e))return hr.min();const t=e.targetChange;return t.targetIds&&t.targetIds.length?hr.min():t.readTime?go(t.readTime):hr.min()}(e);return this.listener.H_(t,r)}Y_(e){const t={};t.database=So(this.serializer),t.addTarget=function(e,t){let r;const n=t.target;if(r=Ai(n)?{documents:Co(e,n)}:{query:Eo(e,n).ft},r.targetId=t.targetId,t.resumeToken.approximateByteSize()>0){r.resumeToken=mo(e,t.resumeToken);const n=ho(e,t.expectedCount);null!==n&&(r.expectedCount=n)}else if(t.snapshotVersion.compareTo(hr.min())>0){r.readTime=po(e,t.snapshotVersion.toTimestamp());const n=ho(e,t.expectedCount);null!==n&&(r.expectedCount=n)}return r}(this.serializer,e);const r=function(e,t){const r=function(e){switch(e){case"TargetPurposeListen":return null;case"TargetPurposeExistenceFilterMismatch":return"existence-filter-mismatch";case"TargetPurposeExistenceFilterMismatchBloom":return"existence-filter-mismatch-bloom";case"TargetPurposeLimboResolution":return"limbo-document";default:return Ct(28987,{purpose:e})}}(t.purpose);return null==r?null:{"goog-listen-tags":r}}(this.serializer,e);r&&(t.labels=r),this.q_(t)}Z_(e){const t={};t.database=So(this.serializer),t.removeTarget=e,this.q_(t)}}class Qa extends Xa{constructor(e,t,r,n,i,s){super(e,"write_stream_connection_backoff","write_stream_idle","health_check_timeout",t,r,n,s),this.serializer=i}get X_(){return this.F_>0}start(){this.lastStreamToken=void 0,super.start()}K_(){this.X_&&this.ea([])}j_(e,t){return this.connection.T_("Write",e,t)}J_(e){return Nt(!!e.streamToken,31322),this.lastStreamToken=e.streamToken,Nt(!e.writeResults||0===e.writeResults.length,55816),this.listener.ta()}onNext(e){Nt(!!e.streamToken,12678),this.lastStreamToken=e.streamToken,this.M_.reset();const t=function(e,t){return e&&e.length>0?(Nt(void 0!==t,14353),e.map(e=>function(e,t){let r=e.updateTime?go(e.updateTime):go(t);return r.isEqual(hr.min())&&(r=go(t)),new bs(r,e.transformResults||[])}(e,t))):[]}(e.writeResults,e.commitTime),r=go(e.commitTime);return this.listener.na(r,t)}ra(){const e={};e.database=So(this.serializer),this.q_(e)}ea(e){const t={streamToken:this.lastStreamToken,writes:e.map(e=>Ao(this.serializer,e))};this.q_(t)}}class $a{}class el extends $a{constructor(e,t,r,n){super(),this.authCredentials=e,this.appCheckCredentials=t,this.connection=r,this.serializer=n,this.ia=!1}sa(){if(this.ia)throw new Mt(Pt.FAILED_PRECONDITION,"The client has already been terminated.")}Go(e,t,r,n){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(i=>{let[s,o]=i;return this.connection.Go(e,_o(t,r),n,s,o)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Pt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Mt(Pt.UNKNOWN,e.toString())})}Ho(e,t,r,n,i){return this.sa(),Promise.all([this.authCredentials.getToken(),this.appCheckCredentials.getToken()]).then(s=>{let[o,a]=s;return this.connection.Ho(e,_o(t,r),n,o,a,i)}).catch(e=>{throw"FirebaseError"===e.name?(e.code===Pt.UNAUTHENTICATED&&(this.authCredentials.invalidateToken(),this.appCheckCredentials.invalidateToken()),e):new Mt(Pt.UNKNOWN,e.toString())})}terminate(){this.ia=!0,this.connection.terminate()}}class tl{constructor(e,t){this.asyncQueue=e,this.onlineStateHandler=t,this.state="Unknown",this.oa=0,this._a=null,this.aa=!0}ua(){0===this.oa&&(this.ca("Unknown"),this._a=this.asyncQueue.enqueueAfterDelay("online_state_timeout",1e4,()=>(this._a=null,this.la("Backend didn't respond within 10 seconds."),this.ca("Offline"),Promise.resolve())))}ha(e){"Online"===this.state?this.ca("Unknown"):(this.oa++,this.oa>=1&&(this.Pa(),this.la("Connection failed 1 times. Most recent error: ".concat(e.toString())),this.ca("Offline")))}set(e){this.Pa(),this.oa=0,"Online"===e&&(this.aa=!1),this.ca(e)}ca(e){e!==this.state&&(this.state=e,this.onlineStateHandler(e))}la(e){const t="Could not reach Cloud Firestore backend. ".concat(e,"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.");this.aa?(Tt(t),this.aa=!1):St("OnlineStateTracker",t)}Pa(){null!==this._a&&(this._a.cancel(),this._a=null)}}const rl="RemoteStore";class nl{constructor(e,t,r,n,i){this.localStore=e,this.datastore=t,this.asyncQueue=r,this.remoteSyncer={},this.Ta=[],this.Ia=new Map,this.Ea=new Set,this.da=[],this.Aa=i,this.Aa.Oo(e=>{r.enqueueAndForget(async()=>{hl(this)&&(St(rl,"Restarting streams for network reachability change."),await async function(e){const t=It(e);t.Ea.add(4),await sl(t),t.Ra.set("Unknown"),t.Ea.delete(4),await il(t)}(this))})}),this.Ra=new tl(r,n)}}async function il(e){if(hl(e))for(const t of e.da)await t(!0)}async function sl(e){for(const t of e.da)await t(!1)}function ol(e,t){const r=It(e);r.Ia.has(t.targetId)||(r.Ia.set(t.targetId,t),dl(r)?ul(r):Il(r).O_()&&ll(r,t))}function al(e,t){const r=It(e),n=Il(r);r.Ia.delete(t),n.O_()&&cl(r,t),0===r.Ia.size&&(n.O_()?n.L_():hl(r)&&r.Ra.set("Unknown"))}function ll(e,t){if(e.Va.Ue(t.targetId),t.resumeToken.approximateByteSize()>0||t.snapshotVersion.compareTo(hr.min())>0){const r=e.remoteSyncer.getRemoteKeysForTarget(t.targetId).size;t=t.withExpectedCount(r)}Il(e).Y_(t)}function cl(e,t){e.Va.Ue(t),Il(e).Z_(t)}function ul(e){e.Va=new io({getRemoteKeysForTarget:t=>e.remoteSyncer.getRemoteKeysForTarget(t),At:t=>e.Ia.get(t)||null,ht:()=>e.datastore.serializer.databaseId}),Il(e).start(),e.Ra.ua()}function dl(e){return hl(e)&&!Il(e).x_()&&e.Ia.size>0}function hl(e){return 0===It(e).Ea.size}function pl(e){e.Va=void 0}async function ml(e){e.Ra.set("Online")}async function fl(e){e.Ia.forEach((t,r)=>{ll(e,t)})}async function gl(e,t){pl(e),dl(e)?(e.Ra.ha(t),ul(e)):e.Ra.set("Unknown")}async function yl(e,t,r){if(e.Ra.set("Online"),t instanceof ro&&2===t.state&&t.cause)try{await async function(e,t){const r=t.cause;for(const n of t.targetIds)e.Ia.has(n)&&(await e.remoteSyncer.rejectListen(n,r),e.Ia.delete(n),e.Va.removeTarget(n))}(e,t)}catch(r){St(rl,"Failed to remove targets %s: %s ",t.targetIds.join(","),r),await _l(e,r)}else if(t instanceof eo?e.Va.Ze(t):t instanceof to?e.Va.st(t):e.Va.tt(t),!r.isEqual(hr.min()))try{const t=await ka(e.localStore);r.compareTo(t)>=0&&await function(e,t){const r=e.Va.Tt(t);return r.targetChanges.forEach((r,n)=>{if(r.resumeToken.approximateByteSize()>0){const i=e.Ia.get(n);i&&e.Ia.set(n,i.withResumeToken(r.resumeToken,t))}}),r.targetMismatches.forEach((t,r)=>{const n=e.Ia.get(t);if(!n)return;e.Ia.set(t,n.withResumeToken(mn.EMPTY_BYTE_STRING,n.snapshotVersion)),cl(e,t);const i=new Bo(n.target,t,r,n.sequenceNumber);ll(e,i)}),e.remoteSyncer.applyRemoteEvent(r)}(e,r)}catch(t){St(rl,"Failed to raise snapshot:",t),await _l(e,t)}}async function _l(e,t,r){if(!Sr(t))throw t;e.Ea.add(1),await sl(e),e.Ra.set("Offline"),r||(r=()=>ka(e.localStore)),e.asyncQueue.enqueueRetryable(async()=>{St(rl,"Retrying IndexedDB access"),await r(),e.Ea.delete(1),await il(e)})}function vl(e,t){return t().catch(r=>_l(e,r,t))}async function xl(e){const t=It(e),r=Pl(t);let n=t.Ta.length>0?t.Ta[t.Ta.length-1].batchId:kr;for(;bl(t);)try{const e=await Ca(t.localStore,n);if(null===e){0===t.Ta.length&&r.L_();break}n=e.batchId,wl(t,e)}catch(e){await _l(t,e)}jl(t)&&Sl(t)}function bl(e){return hl(e)&&e.Ta.length<10}function wl(e,t){e.Ta.push(t);const r=Pl(e);r.O_()&&r.X_&&r.ea(t.mutations)}function jl(e){return hl(e)&&!Pl(e).x_()&&e.Ta.length>0}function Sl(e){Pl(e).start()}async function Tl(e){Pl(e).ra()}async function kl(e){const t=Pl(e);for(const r of e.Ta)t.ea(r.mutations)}async function Al(e,t,r){const n=e.Ta.shift(),i=Os.from(n,t,r);await vl(e,()=>e.remoteSyncer.applySuccessfulWrite(i)),await xl(e)}async function Cl(e,t){t&&Pl(e).X_&&await async function(e,t){if(function(e){return qs(e)&&e!==Pt.ABORTED}(t.code)){const r=e.Ta.shift();Pl(e).B_(),await vl(e,()=>e.remoteSyncer.rejectFailedWrite(r.batchId,t)),await xl(e)}}(e,t),jl(e)&&Sl(e)}async function El(e,t){const r=It(e);r.asyncQueue.verifyOperationInProgress(),St(rl,"RemoteStore received new credentials");const n=hl(r);r.Ea.add(3),await sl(r),n&&r.Ra.set("Unknown"),await r.remoteSyncer.handleCredentialChange(t),r.Ea.delete(3),await il(r)}async function Nl(e,t){const r=It(e);t?(r.Ea.delete(2),await il(r)):t||(r.Ea.add(2),await sl(r),r.Ra.set("Unknown"))}function Il(e){return e.ma||(e.ma=function(e,t,r){const n=It(e);return n.sa(),new Ja(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}(e.datastore,e.asyncQueue,{Xo:ml.bind(null,e),t_:fl.bind(null,e),r_:gl.bind(null,e),H_:yl.bind(null,e)}),e.da.push(async t=>{t?(e.ma.B_(),dl(e)?ul(e):e.Ra.set("Unknown")):(await e.ma.stop(),pl(e))})),e.ma}function Pl(e){return e.fa||(e.fa=function(e,t,r){const n=It(e);return n.sa(),new Qa(t,n.connection,n.authCredentials,n.appCheckCredentials,n.serializer,r)}(e.datastore,e.asyncQueue,{Xo:()=>Promise.resolve(),t_:Tl.bind(null,e),r_:Cl.bind(null,e),ta:kl.bind(null,e),na:Al.bind(null,e)}),e.da.push(async t=>{t?(e.fa.B_(),await xl(e)):(await e.fa.stop(),e.Ta.length>0&&(St(rl,"Stopping write stream with ".concat(e.Ta.length," pending writes")),e.Ta=[]))})),e.fa}class Ml{constructor(e,t,r,n,i){this.asyncQueue=e,this.timerId=t,this.targetTimeMs=r,this.op=n,this.removalCallback=i,this.deferred=new Lt,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.deferred.promise.catch(e=>{})}get promise(){return this.deferred.promise}static createAndSchedule(e,t,r,n,i){const s=Date.now()+r,o=new Ml(e,t,s,n,i);return o.start(r),o}start(e){this.timerHandle=setTimeout(()=>this.handleDelayElapsed(),e)}skipDelay(){return this.handleDelayElapsed()}cancel(e){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Mt(Pt.CANCELLED,"Operation cancelled"+(e?": "+e:""))))}handleDelayElapsed(){this.asyncQueue.enqueueAndForget(()=>null!==this.timerHandle?(this.clearTimeout(),this.op().then(e=>this.deferred.resolve(e))):Promise.resolve())}clearTimeout(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)}}function Ll(e,t){if(Tt("AsyncQueue","".concat(t,": ").concat(e)),Sr(e))return new Mt(Pt.UNAVAILABLE,"".concat(t,": ").concat(e));throw e}class Rl{static emptySet(e){return new Rl(e.comparator)}constructor(e){this.comparator=e?(t,r)=>e(t,r)||er.comparator(t.key,r.key):(e,t)=>er.comparator(e.key,t.key),this.keyedMap=Yi(),this.sortedSet=new an(this.comparator)}has(e){return null!=this.keyedMap.get(e)}get(e){return this.keyedMap.get(e)}first(){return this.sortedSet.minKey()}last(){return this.sortedSet.maxKey()}isEmpty(){return this.sortedSet.isEmpty()}indexOf(e){const t=this.keyedMap.get(e);return t?this.sortedSet.indexOf(t):-1}get size(){return this.sortedSet.size}forEach(e){this.sortedSet.inorderTraversal((t,r)=>(e(t),!1))}add(e){const t=this.delete(e.key);return t.copy(t.keyedMap.insert(e.key,e),t.sortedSet.insert(e,null))}delete(e){const t=this.get(e);return t?this.copy(this.keyedMap.remove(e),this.sortedSet.remove(t)):this}isEqual(e){if(!(e instanceof Rl))return!1;if(this.size!==e.size)return!1;const t=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();for(;t.hasNext();){const e=t.getNext().key,n=r.getNext().key;if(!e.isEqual(n))return!1}return!0}toString(){const e=[];return this.forEach(t=>{e.push(t.toString())}),0===e.length?"DocumentSet ()":"DocumentSet (\n  "+e.join("  \n")+"\n)"}copy(e,t){const r=new Rl;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=t,r}}class Dl{constructor(){this.ga=new an(er.comparator)}track(e){const t=e.doc.key,r=this.ga.get(t);r?0!==e.type&&3===r.type?this.ga=this.ga.insert(t,e):3===e.type&&1!==r.type?this.ga=this.ga.insert(t,{type:r.type,doc:e.doc}):2===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):2===e.type&&0===r.type?this.ga=this.ga.insert(t,{type:0,doc:e.doc}):1===e.type&&0===r.type?this.ga=this.ga.remove(t):1===e.type&&2===r.type?this.ga=this.ga.insert(t,{type:1,doc:r.doc}):0===e.type&&1===r.type?this.ga=this.ga.insert(t,{type:2,doc:e.doc}):Ct(63341,{Rt:e,pa:r}):this.ga=this.ga.insert(t,e)}ya(){const e=[];return this.ga.inorderTraversal((t,r)=>{e.push(r)}),e}}class Fl{constructor(e,t,r,n,i,s,o,a,l){this.query=e,this.docs=t,this.oldDocs=r,this.docChanges=n,this.mutatedKeys=i,this.fromCache=s,this.syncStateChanged=o,this.excludesMetadataChanges=a,this.hasCachedResults=l}static fromInitialDocuments(e,t,r,n,i){const s=[];return t.forEach(e=>{s.push({type:0,doc:e})}),new Fl(e,t,Rl.emptySet(t),s,r,n,!0,!1,i)}get hasPendingWrites(){return!this.mutatedKeys.isEmpty()}isEqual(e){if(!(this.fromCache===e.fromCache&&this.hasCachedResults===e.hasCachedResults&&this.syncStateChanged===e.syncStateChanged&&this.mutatedKeys.isEqual(e.mutatedKeys)&&Oi(this.query,e.query)&&this.docs.isEqual(e.docs)&&this.oldDocs.isEqual(e.oldDocs)))return!1;const t=this.docChanges,r=e.docChanges;if(t.length!==r.length)return!1;for(let n=0;n<t.length;n++)if(t[n].type!==r[n].type||!t[n].doc.isEqual(r[n].doc))return!1;return!0}}class Ol{constructor(){this.wa=void 0,this.Sa=[]}ba(){return this.Sa.some(e=>e.Da())}}class zl{constructor(){this.queries=Bl(),this.onlineState="Unknown",this.Ca=new Set}terminate(){!function(e,t){const r=It(e),n=r.queries;r.queries=Bl(),n.forEach((e,r)=>{for(const n of r.Sa)n.onError(t)})}(this,new Mt(Pt.ABORTED,"Firestore shutting down"))}}function Bl(){return new Hi(e=>zi(e),Oi)}async function Ul(e,t){const r=It(e);let n=3;const i=t.query;let s=r.queries.get(i);s?!s.ba()&&t.Da()&&(n=2):(s=new Ol,n=t.Da()?0:1);try{switch(n){case 0:s.wa=await r.onListen(i,!0);break;case 1:s.wa=await r.onListen(i,!1);break;case 2:await r.onFirstRemoteStoreListen(i)}}catch(e){const r=Ll(e,"Initialization of query '".concat(Bi(t.query),"' failed"));return void t.onError(r)}r.queries.set(i,s),s.Sa.push(t),t.va(r.onlineState),s.wa&&t.Fa(s.wa)&&Hl(r)}async function Vl(e,t){const r=It(e),n=t.query;let i=3;const s=r.queries.get(n);if(s){const e=s.Sa.indexOf(t);e>=0&&(s.Sa.splice(e,1),0===s.Sa.length?i=t.Da()?0:1:!s.ba()&&t.Da()&&(i=2))}switch(i){case 0:return r.queries.delete(n),r.onUnlisten(n,!0);case 1:return r.queries.delete(n),r.onUnlisten(n,!1);case 2:return r.onLastRemoteStoreUnlisten(n);default:return}}function ql(e,t){const r=It(e);let n=!1;for(const i of t){const e=i.query,t=r.queries.get(e);if(t){for(const e of t.Sa)e.Fa(i)&&(n=!0);t.wa=i}}n&&Hl(r)}function Wl(e,t,r){const n=It(e),i=n.queries.get(t);if(i)for(const s of i.Sa)s.onError(r);n.queries.delete(t)}function Hl(e){e.Ca.forEach(e=>{e.next()})}var Gl,Zl;(Zl=Gl||(Gl={})).Ma="default",Zl.Cache="cache";class Kl{constructor(e,t,r){this.query=e,this.xa=t,this.Oa=!1,this.Na=null,this.onlineState="Unknown",this.options=r||{}}Fa(e){if(!this.options.includeMetadataChanges){const t=[];for(const r of e.docChanges)3!==r.type&&t.push(r);e=new Fl(e.query,e.docs,e.oldDocs,t,e.mutatedKeys,e.fromCache,e.syncStateChanged,!0,e.hasCachedResults)}let t=!1;return this.Oa?this.Ba(e)&&(this.xa.next(e),t=!0):this.La(e,this.onlineState)&&(this.ka(e),t=!0),this.Na=e,t}onError(e){this.xa.error(e)}va(e){this.onlineState=e;let t=!1;return this.Na&&!this.Oa&&this.La(this.Na,e)&&(this.ka(this.Na),t=!0),t}La(e,t){if(!e.fromCache)return!0;if(!this.Da())return!0;const r="Offline"!==t;return(!this.options.qa||!r)&&(!e.docs.isEmpty()||e.hasCachedResults||"Offline"===t)}Ba(e){if(e.docChanges.length>0)return!0;const t=this.Na&&this.Na.hasPendingWrites!==e.hasPendingWrites;return!(!e.syncStateChanged&&!t)&&!0===this.options.includeMetadataChanges}ka(e){e=Fl.fromInitialDocuments(e.query,e.docs,e.mutatedKeys,e.fromCache,e.hasCachedResults),this.Oa=!0,this.xa.next(e)}Da(){return this.options.source!==Gl.Cache}}class Yl{constructor(e){this.key=e}}class Xl{constructor(e){this.key=e}}class Jl{constructor(e,t){this.query=e,this.Ya=t,this.Za=null,this.hasCachedResults=!1,this.current=!1,this.Xa=rs(),this.mutatedKeys=rs(),this.eu=qi(e),this.tu=new Rl(this.eu)}get nu(){return this.Ya}ru(e,t){const r=t?t.iu:new Dl,n=t?t.tu:this.tu;let i=t?t.mutatedKeys:this.mutatedKeys,s=n,o=!1;const a="F"===this.query.limitType&&n.size===this.query.limit?n.last():null,l="L"===this.query.limitType&&n.size===this.query.limit?n.first():null;if(e.inorderTraversal((e,t)=>{const c=n.get(e),u=Ui(this.query,t)?t:null,d=!!c&&this.mutatedKeys.has(c.key),h=!!u&&(u.hasLocalMutations||this.mutatedKeys.has(u.key)&&u.hasCommittedMutations);let p=!1;c&&u?c.data.isEqual(u.data)?d!==h&&(r.track({type:3,doc:u}),p=!0):this.su(c,u)||(r.track({type:2,doc:u}),p=!0,(a&&this.eu(u,a)>0||l&&this.eu(u,l)<0)&&(o=!0)):!c&&u?(r.track({type:0,doc:u}),p=!0):c&&!u&&(r.track({type:1,doc:c}),p=!0,(a||l)&&(o=!0)),p&&(u?(s=s.add(u),i=h?i.add(e):i.delete(e)):(s=s.delete(e),i=i.delete(e)))}),null!==this.query.limit)for(;s.size>this.query.limit;){const e="F"===this.query.limitType?s.last():s.first();s=s.delete(e.key),i=i.delete(e.key),r.track({type:1,doc:e})}return{tu:s,iu:r,Cs:o,mutatedKeys:i}}su(e,t){return e.hasLocalMutations&&t.hasCommittedMutations&&!t.hasLocalMutations}applyChanges(e,t,r,n){const i=this.tu;this.tu=e.tu,this.mutatedKeys=e.mutatedKeys;const s=e.iu.ya();s.sort((e,t)=>function(e,t){const r=e=>{switch(e){case 0:return 1;case 2:case 3:return 2;case 1:return 0;default:return Ct(20277,{Rt:e})}};return r(e)-r(t)}(e.type,t.type)||this.eu(e.doc,t.doc)),this.ou(r),n=null!==n&&void 0!==n&&n;const o=t&&!n?this._u():[],a=0===this.Xa.size&&this.current&&!n?1:0,l=a!==this.Za;return this.Za=a,0!==s.length||l?{snapshot:new Fl(this.query,e.tu,i,s,e.mutatedKeys,0===a,l,!1,!!r&&r.resumeToken.approximateByteSize()>0),au:o}:{au:o}}va(e){return this.current&&"Offline"===e?(this.current=!1,this.applyChanges({tu:this.tu,iu:new Dl,mutatedKeys:this.mutatedKeys,Cs:!1},!1)):{au:[]}}uu(e){return!this.Ya.has(e)&&!!this.tu.has(e)&&!this.tu.get(e).hasLocalMutations}ou(e){e&&(e.addedDocuments.forEach(e=>this.Ya=this.Ya.add(e)),e.modifiedDocuments.forEach(e=>{}),e.removedDocuments.forEach(e=>this.Ya=this.Ya.delete(e)),this.current=e.current)}_u(){if(!this.current)return[];const e=this.Xa;this.Xa=rs(),this.tu.forEach(e=>{this.uu(e.key)&&(this.Xa=this.Xa.add(e.key))});const t=[];return e.forEach(e=>{this.Xa.has(e)||t.push(new Xl(e))}),this.Xa.forEach(r=>{e.has(r)||t.push(new Yl(r))}),t}cu(e){this.Ya=e.Qs,this.Xa=rs();const t=this.ru(e.documents);return this.applyChanges(t,!0)}lu(){return Fl.fromInitialDocuments(this.query,this.tu,this.mutatedKeys,0===this.Za,this.hasCachedResults)}}const Ql="SyncEngine";class $l{constructor(e,t,r){this.query=e,this.targetId=t,this.view=r}}class ec{constructor(e){this.key=e,this.hu=!1}}class tc{constructor(e,t,r,n,i,s){this.localStore=e,this.remoteStore=t,this.eventManager=r,this.sharedClientState=n,this.currentUser=i,this.maxConcurrentLimboResolutions=s,this.Pu={},this.Tu=new Hi(e=>zi(e),Oi),this.Iu=new Map,this.Eu=new Set,this.du=new an(er.comparator),this.Au=new Map,this.Ru=new ca,this.Vu={},this.mu=new Map,this.fu=Yo.cr(),this.onlineState="Unknown",this.gu=void 0}get isPrimaryClient(){return!0===this.gu}}async function rc(e,t){let r=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];const n=jc(e);let i;const s=n.Tu.get(t);return s?(n.sharedClientState.addLocalQueryTarget(s.targetId),i=s.view.lu()):i=await ic(n,t,r,!0),i}async function nc(e,t){const r=jc(e);await ic(r,t,!0,!1)}async function ic(e,t,r,n){const i=await Ea(e.localStore,Li(t)),s=i.targetId,o=e.sharedClientState.addLocalQueryTarget(s,r);let a;return n&&(a=await sc(e,t,s,"current"===o,i.resumeToken)),e.isPrimaryClient&&r&&ol(e.remoteStore,i),a}async function sc(e,t,r,n,i){e.pu=(t,r,n)=>async function(e,t,r,n){let i=t.view.ru(r);i.Cs&&(i=await Ia(e.localStore,t.query,!1).then(e=>{let{documents:r}=e;return t.view.ru(r,i)}));const s=n&&n.targetChanges.get(t.targetId),o=n&&null!=n.targetMismatches.get(t.targetId),a=t.view.applyChanges(i,e.isPrimaryClient,s,o);return yc(e,t.targetId,a.au),a.snapshot}(e,t,r,n);const s=await Ia(e.localStore,t,!0),o=new Jl(t,s.Qs),a=o.ru(s.documents),l=$s.createSynthesizedTargetChangeForCurrentChange(r,n&&"Offline"!==e.onlineState,i),c=o.applyChanges(a,e.isPrimaryClient,l);yc(e,r,c.au);const u=new $l(t,r,o);return e.Tu.set(t,u),e.Iu.has(r)?e.Iu.get(r).push(t):e.Iu.set(r,[t]),c.snapshot}async function oc(e,t,r){const n=It(e),i=n.Tu.get(t),s=n.Iu.get(i.targetId);if(s.length>1)return n.Iu.set(i.targetId,s.filter(e=>!Oi(e,t))),void n.Tu.delete(t);n.isPrimaryClient?(n.sharedClientState.removeLocalQueryTarget(i.targetId),n.sharedClientState.isActiveQueryTarget(i.targetId)||await Na(n.localStore,i.targetId,!1).then(()=>{n.sharedClientState.clearQueryState(i.targetId),r&&al(n.remoteStore,i.targetId),fc(n,i.targetId)}).catch(br)):(fc(n,i.targetId),await Na(n.localStore,i.targetId,!0))}async function ac(e,t){const r=It(e),n=r.Tu.get(t),i=r.Iu.get(n.targetId);r.isPrimaryClient&&1===i.length&&(r.sharedClientState.removeLocalQueryTarget(n.targetId),al(r.remoteStore,n.targetId))}async function lc(e,t){const r=It(e);try{const e=await function(e,t){const r=It(e),n=t.snapshotVersion;let i=r.Ms;return r.persistence.runTransaction("Apply remote event","readwrite-primary",e=>{const s=r.Ns.newChangeBuffer({trackRemovals:!0});i=r.Ms;const o=[];t.targetChanges.forEach((s,a)=>{const l=i.get(a);if(!l)return;o.push(r.Pi.removeMatchingKeys(e,s.removedDocuments,a).next(()=>r.Pi.addMatchingKeys(e,s.addedDocuments,a)));let c=l.withSequenceNumber(e.currentSequenceNumber);null!==t.targetMismatches.get(a)?c=c.withResumeToken(mn.EMPTY_BYTE_STRING,hr.min()).withLastLimboFreeSnapshotVersion(hr.min()):s.resumeToken.approximateByteSize()>0&&(c=c.withResumeToken(s.resumeToken,n)),i=i.insert(a,c),function(e,t,r){return 0===e.resumeToken.approximateByteSize()||(t.snapshotVersion.toMicroseconds()-e.snapshotVersion.toMicroseconds()>=3e8||r.addedDocuments.size+r.modifiedDocuments.size+r.removedDocuments.size>0)}(l,c,s)&&o.push(r.Pi.updateTargetData(e,c))});let a=Zi(),l=rs();if(t.documentUpdates.forEach(n=>{t.resolvedLimboDocuments.has(n)&&o.push(r.persistence.referenceDelegate.updateLimboDocument(e,n))}),o.push(Aa(e,s,t.documentUpdates).next(e=>{a=e.ks,l=e.qs})),!n.isEqual(hr.min())){const t=r.Pi.getLastRemoteSnapshotVersion(e).next(t=>r.Pi.setTargetsMetadata(e,e.currentSequenceNumber,n));o.push(t)}return wr.waitFor(o).next(()=>s.apply(e)).next(()=>r.localDocuments.getLocalViewOfDocuments(e,a,l)).next(()=>a)}).then(e=>(r.Ms=i,e))}(r.localStore,t);t.targetChanges.forEach((e,t)=>{const n=r.Au.get(t);n&&(Nt(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,22616),e.addedDocuments.size>0?n.hu=!0:e.modifiedDocuments.size>0?Nt(n.hu,14607):e.removedDocuments.size>0&&(Nt(n.hu,42227),n.hu=!1))}),await xc(r,e,t)}catch(e){await br(e)}}function cc(e,t,r){const n=It(e);if(n.isPrimaryClient&&0===r||!n.isPrimaryClient&&1===r){const e=[];n.Tu.forEach((r,n)=>{const i=n.view.va(t);i.snapshot&&e.push(i.snapshot)}),function(e,t){const r=It(e);r.onlineState=t;let n=!1;r.queries.forEach((e,r)=>{for(const i of r.Sa)i.va(t)&&(n=!0)}),n&&Hl(r)}(n.eventManager,t),e.length&&n.Pu.H_(e),n.onlineState=t,n.isPrimaryClient&&n.sharedClientState.setOnlineState(t)}}async function uc(e,t,r){const n=It(e);n.sharedClientState.updateQueryState(t,"rejected",r);const i=n.Au.get(t),s=i&&i.key;if(s){let e=new an(er.comparator);e=e.insert(s,ei.newNoDocument(s,hr.min()));const r=rs().add(s),i=new Qs(hr.min(),new Map,new an(Ht),e,r);await lc(n,i),n.du=n.du.remove(s),n.Au.delete(t),vc(n)}else await Na(n.localStore,t,!1).then(()=>fc(n,t,r)).catch(br)}async function dc(e,t){const r=It(e),n=t.batch.batchId;try{const e=await function(e,t){const r=It(e);return r.persistence.runTransaction("Acknowledge batch","readwrite-primary",e=>{const n=t.batch.keys(),i=r.Ns.newChangeBuffer({trackRemovals:!0});return function(e,t,r,n){const i=r.batch,s=i.keys();let o=wr.resolve();return s.forEach(e=>{o=o.next(()=>n.getEntry(t,e)).next(t=>{const s=r.docVersions.get(e);Nt(null!==s,48541),t.version.compareTo(s)<0&&(i.applyToRemoteDocument(t,r),t.isValidDocument()&&(t.setReadTime(r.commitVersion),n.addEntry(t)))})}),o.next(()=>e.mutationQueue.removeMutationBatch(t,i))}(r,e,t,i).next(()=>i.apply(e)).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t.batch.batchId)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,function(e){let t=rs();for(let r=0;r<e.mutationResults.length;++r)e.mutationResults[r].transformResults.length>0&&(t=t.add(e.batch.mutations[r].key));return t}(t))).next(()=>r.localDocuments.getDocuments(e,n))})}(r.localStore,t);mc(r,n,null),pc(r,n),r.sharedClientState.updateMutationState(n,"acknowledged"),await xc(r,e)}catch(e){await br(e)}}async function hc(e,t,r){const n=It(e);try{const e=await function(e,t){const r=It(e);return r.persistence.runTransaction("Reject batch","readwrite-primary",e=>{let n;return r.mutationQueue.lookupMutationBatch(e,t).next(t=>(Nt(null!==t,37113),n=t.keys(),r.mutationQueue.removeMutationBatch(e,t))).next(()=>r.mutationQueue.performConsistencyCheck(e)).next(()=>r.documentOverlayCache.removeOverlaysForBatchId(e,n,t)).next(()=>r.localDocuments.recalculateAndSaveOverlaysForDocumentKeys(e,n)).next(()=>r.localDocuments.getDocuments(e,n))})}(n.localStore,t);mc(n,t,r),pc(n,t),n.sharedClientState.updateMutationState(t,"rejected",r),await xc(n,e)}catch(r){await br(r)}}function pc(e,t){(e.mu.get(t)||[]).forEach(e=>{e.resolve()}),e.mu.delete(t)}function mc(e,t,r){const n=It(e);let i=n.Vu[n.currentUser.toKey()];if(i){const e=i.get(t);e&&(r?e.reject(r):e.resolve(),i=i.remove(t)),n.Vu[n.currentUser.toKey()]=i}}function fc(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;e.sharedClientState.removeLocalQueryTarget(t);for(const n of e.Iu.get(t))e.Tu.delete(n),r&&e.Pu.yu(n,r);e.Iu.delete(t),e.isPrimaryClient&&e.Ru.jr(t).forEach(t=>{e.Ru.containsKey(t)||gc(e,t)})}function gc(e,t){e.Eu.delete(t.path.canonicalString());const r=e.du.get(t);null!==r&&(al(e.remoteStore,r),e.du=e.du.remove(t),e.Au.delete(r),vc(e))}function yc(e,t,r){for(const n of r)n instanceof Yl?(e.Ru.addReference(n.key,t),_c(e,n)):n instanceof Xl?(St(Ql,"Document no longer in limbo: "+n.key),e.Ru.removeReference(n.key,t),e.Ru.containsKey(n.key)||gc(e,n.key)):Ct(19791,{wu:n})}function _c(e,t){const r=t.key,n=r.path.canonicalString();e.du.get(r)||e.Eu.has(n)||(St(Ql,"New document in limbo: "+r),e.Eu.add(n),vc(e))}function vc(e){for(;e.Eu.size>0&&e.du.size<e.maxConcurrentLimboResolutions;){const t=e.Eu.values().next().value;e.Eu.delete(t);const r=new er(Jt.fromString(t)),n=e.fu.next();e.Au.set(n,new ec(r)),e.du=e.du.insert(r,n),ol(e.remoteStore,new Bo(Li(Ni(r.path)),n,"TargetPurposeLimboResolution",Tr.ce))}}async function xc(e,t,r){const n=It(e),i=[],s=[],o=[];n.Tu.isEmpty()||(n.Tu.forEach((e,a)=>{o.push(n.pu(a,t,r).then(e=>{if((e||r)&&n.isPrimaryClient){var t;const i=e?!e.fromCache:null===r||void 0===r||null===(t=r.targetChanges.get(a.targetId))||void 0===t?void 0:t.current;n.sharedClientState.updateQueryState(a.targetId,i?"current":"not-current")}if(e){i.push(e);const t=va.As(a.targetId,e);s.push(t)}}))}),await Promise.all(o),n.Pu.H_(i),await async function(e,t){const r=It(e);try{await r.persistence.runTransaction("notifyLocalViewChanges","readwrite",e=>wr.forEach(t,t=>wr.forEach(t.Es,n=>r.persistence.referenceDelegate.addReference(e,t.targetId,n)).next(()=>wr.forEach(t.ds,n=>r.persistence.referenceDelegate.removeReference(e,t.targetId,n)))))}catch(e){if(!Sr(e))throw e;St(wa,"Failed to update sequence numbers: "+e)}for(const n of t){const e=n.targetId;if(!n.fromCache){const t=r.Ms.get(e),n=t.snapshotVersion,i=t.withLastLimboFreeSnapshotVersion(n);r.Ms=r.Ms.insert(e,i)}}}(n.localStore,s))}async function bc(e,t){const r=It(e);if(!r.currentUser.isEqual(t)){St(Ql,"User change. New user:",t.toKey());const e=await Ta(r.localStore,t);r.currentUser=t,function(e,t){e.mu.forEach(e=>{e.forEach(e=>{e.reject(new Mt(Pt.CANCELLED,t))})}),e.mu.clear()}(r,"'waitForPendingWrites' promise is rejected due to a user change."),r.sharedClientState.handleUserChange(t,e.removedBatchIds,e.addedBatchIds),await xc(r,e.Ls)}}function wc(e,t){const r=It(e),n=r.Au.get(t);if(n&&n.hu)return rs().add(n.key);{let e=rs();const n=r.Iu.get(t);if(!n)return e;for(const t of n){const n=r.Tu.get(t);e=e.unionWith(n.view.nu)}return e}}function jc(e){const t=It(e);return t.remoteStore.remoteSyncer.applyRemoteEvent=lc.bind(null,t),t.remoteStore.remoteSyncer.getRemoteKeysForTarget=wc.bind(null,t),t.remoteStore.remoteSyncer.rejectListen=uc.bind(null,t),t.Pu.H_=ql.bind(null,t.eventManager),t.Pu.yu=Wl.bind(null,t.eventManager),t}function Sc(e){const t=It(e);return t.remoteStore.remoteSyncer.applySuccessfulWrite=dc.bind(null,t),t.remoteStore.remoteSyncer.rejectFailedWrite=hc.bind(null,t),t}class Tc{constructor(){this.kind="memory",this.synchronizeTabs=!1}async initialize(e){this.serializer=Za(e.databaseInfo.databaseId),this.sharedClientState=this.Du(e),this.persistence=this.Cu(e),await this.persistence.start(),this.localStore=this.vu(e),this.gcScheduler=this.Fu(e,this.localStore),this.indexBackfillerScheduler=this.Mu(e,this.localStore)}Fu(e,t){return null}Mu(e,t){return null}vu(e){return Sa(this.persistence,new ba,e.initialUser,this.serializer)}Cu(e){return new fa(ya.mi,this.serializer)}Du(e){return new La}async terminate(){var e,t;null!==(e=this.gcScheduler)&&void 0!==e&&e.stop(),null!==(t=this.indexBackfillerScheduler)&&void 0!==t&&t.stop(),this.sharedClientState.shutdown(),await this.persistence.shutdown()}}Tc.provider={build:()=>new Tc};class kc extends Tc{constructor(e){super(),this.cacheSizeBytes=e}Fu(e,t){Nt(this.persistence.referenceDelegate instanceof _a,46915);const r=this.persistence.referenceDelegate.garbageCollector;return new ea(r,e.asyncQueue,t)}Cu(e){const t=void 0!==this.cacheSizeBytes?Ko.withCacheSize(this.cacheSizeBytes):Ko.DEFAULT;return new fa(e=>_a.mi(e,t),this.serializer)}}class Ac{async initialize(e,t){this.localStore||(this.localStore=e.localStore,this.sharedClientState=e.sharedClientState,this.datastore=this.createDatastore(t),this.remoteStore=this.createRemoteStore(t),this.eventManager=this.createEventManager(t),this.syncEngine=this.createSyncEngine(t,!e.synchronizeTabs),this.sharedClientState.onlineStateHandler=e=>cc(this.syncEngine,e,1),this.remoteStore.remoteSyncer.handleCredentialChange=bc.bind(null,this.syncEngine),await Nl(this.remoteStore,this.syncEngine.isPrimaryClient))}createEventManager(e){return new zl}createDatastore(e){const t=Za(e.databaseInfo.databaseId),r=function(e){return new Ha(e)}(e.databaseInfo);return function(e,t,r,n){return new el(e,t,r,n)}(e.authCredentials,e.appCheckCredentials,r,t)}createRemoteStore(e){return function(e,t,r,n,i){return new nl(e,t,r,n,i)}(this.localStore,this.datastore,e.asyncQueue,e=>cc(this.syncEngine,e,0),Fa.v()?new Fa:new Ra)}createSyncEngine(e,t){return function(e,t,r,n,i,s,o){const a=new tc(e,t,r,n,i,s);return o&&(a.gu=!0),a}(this.localStore,this.remoteStore,this.eventManager,this.sharedClientState,e.initialUser,e.maxConcurrentLimboResolutions,t)}async terminate(){var e,t;await async function(e){const t=It(e);St(rl,"RemoteStore shutting down."),t.Ea.add(5),await sl(t),t.Aa.shutdown(),t.Ra.set("Unknown")}(this.remoteStore),null!==(e=this.datastore)&&void 0!==e&&e.terminate(),null===(t=this.eventManager)||void 0===t||t.terminate()}}Ac.provider={build:()=>new Ac};class Cc{constructor(e){this.observer=e,this.muted=!1}next(e){this.muted||this.observer.next&&this.Ou(this.observer.next,e)}error(e){this.muted||(this.observer.error?this.Ou(this.observer.error,e):Tt("Uncaught Error in snapshot listener:",e.toString()))}Nu(){this.muted=!0}Ou(e,t){setTimeout(()=>{this.muted||e(t)},0)}}const Ec="FirestoreClient";class Nc{constructor(e,t,r,n,i){this.authCredentials=e,this.appCheckCredentials=t,this.asyncQueue=r,this.databaseInfo=n,this.user=xt.UNAUTHENTICATED,this.clientId=Wt.newId(),this.authCredentialListener=()=>Promise.resolve(),this.appCheckCredentialListener=()=>Promise.resolve(),this._uninitializedComponentsProvider=i,this.authCredentials.start(r,async e=>{St(Ec,"Received user=",e.uid),await this.authCredentialListener(e),this.user=e}),this.appCheckCredentials.start(r,e=>(St(Ec,"Received new app check token=",e),this.appCheckCredentialListener(e,this.user)))}get configuration(){return{asyncQueue:this.asyncQueue,databaseInfo:this.databaseInfo,clientId:this.clientId,authCredentials:this.authCredentials,appCheckCredentials:this.appCheckCredentials,initialUser:this.user,maxConcurrentLimboResolutions:100}}setCredentialChangeListener(e){this.authCredentialListener=e}setAppCheckTokenChangeListener(e){this.appCheckCredentialListener=e}terminate(){this.asyncQueue.enterRestrictedMode();const e=new Lt;return this.asyncQueue.enqueueAndForgetEvenWhileRestricted(async()=>{try{this._onlineComponents&&await this._onlineComponents.terminate(),this._offlineComponents&&await this._offlineComponents.terminate(),this.authCredentials.shutdown(),this.appCheckCredentials.shutdown(),e.resolve()}catch(t){const r=Ll(t,"Failed to shutdown persistence");e.reject(r)}}),e.promise}}async function Ic(e,t){e.asyncQueue.verifyOperationInProgress(),St(Ec,"Initializing OfflineComponentProvider");const r=e.configuration;await t.initialize(r);let n=r.initialUser;e.setCredentialChangeListener(async e=>{n.isEqual(e)||(await Ta(t.localStore,e),n=e)}),t.persistence.setDatabaseDeletedListener(()=>e.terminate()),e._offlineComponents=t}async function Pc(e,t){e.asyncQueue.verifyOperationInProgress();const r=await Mc(e);St(Ec,"Initializing OnlineComponentProvider"),await t.initialize(r,e.configuration),e.setCredentialChangeListener(e=>El(t.remoteStore,e)),e.setAppCheckTokenChangeListener((e,r)=>El(t.remoteStore,r)),e._onlineComponents=t}async function Mc(e){if(!e._offlineComponents)if(e._uninitializedComponentsProvider){St(Ec,"Using user provided OfflineComponentProvider");try{await Ic(e,e._uninitializedComponentsProvider._offline)}catch(t){const r=t;if(!function(e){return"FirebaseError"===e.name?e.code===Pt.FAILED_PRECONDITION||e.code===Pt.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&e instanceof DOMException)||22===e.code||20===e.code||11===e.code}(r))throw r;kt("Error using user provided cache. Falling back to memory cache: "+r),await Ic(e,new Tc)}}else St(Ec,"Using default OfflineComponentProvider"),await Ic(e,new kc(void 0));return e._offlineComponents}async function Lc(e){return e._onlineComponents||(e._uninitializedComponentsProvider?(St(Ec,"Using user provided OnlineComponentProvider"),await Pc(e,e._uninitializedComponentsProvider._online)):(St(Ec,"Using default OnlineComponentProvider"),await Pc(e,new Ac))),e._onlineComponents}function Rc(e){return Lc(e).then(e=>e.syncEngine)}async function Dc(e){const t=await Lc(e),r=t.eventManager;return r.onListen=rc.bind(null,t.syncEngine),r.onUnlisten=oc.bind(null,t.syncEngine),r.onFirstRemoteStoreListen=nc.bind(null,t.syncEngine),r.onLastRemoteStoreUnlisten=ac.bind(null,t.syncEngine),r}function Fc(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new Lt;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,r,n,i){const s=new Cc({next:a=>{s.Nu(),t.enqueueAndForget(()=>Vl(e,o));const l=a.docs.has(r);!l&&a.fromCache?i.reject(new Mt(Pt.UNAVAILABLE,"Failed to get document because the client is offline.")):l&&a.fromCache&&n&&"server"===n.source?i.reject(new Mt(Pt.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):i.resolve(a)},error:e=>i.reject(e)}),o=new Kl(Ni(r.path),s,{includeMetadataChanges:!0,qa:!0});return Ul(e,o)}(await Dc(e),e.asyncQueue,t,r,n)),n.promise}function Oc(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{};const n=new Lt;return e.asyncQueue.enqueueAndForget(async()=>function(e,t,r,n,i){const s=new Cc({next:r=>{s.Nu(),t.enqueueAndForget(()=>Vl(e,o)),r.fromCache&&"server"===n.source?i.reject(new Mt(Pt.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):i.resolve(r)},error:e=>i.reject(e)}),o=new Kl(r,s,{includeMetadataChanges:!0,qa:!0});return Ul(e,o)}(await Dc(e),e.asyncQueue,t,r,n)),n.promise}function zc(e){const t={};return void 0!==e.timeoutSeconds&&(t.timeoutSeconds=e.timeoutSeconds),t}const Bc=new Map,Uc="firestore.googleapis.com",Vc=!0;class qc{constructor(e){var t,r;if(void 0===e.host){if(void 0!==e.ssl)throw new Mt(Pt.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=Uc,this.ssl=Vc}else this.host=e.host,this.ssl=null!==(t=e.ssl)&&void 0!==t?t:Vc;if(this.isUsingEmulator=void 0!==e.emulatorOptions,this.credentials=e.credentials,this.ignoreUndefinedProperties=!!e.ignoreUndefinedProperties,this.localCache=e.localCache,void 0===e.cacheSizeBytes)this.cacheSizeBytes=Zo;else{if(-1!==e.cacheSizeBytes&&e.cacheSizeBytes<Jo)throw new Mt(Pt.INVALID_ARGUMENT,"cacheSizeBytes must be at least 1048576");this.cacheSizeBytes=e.cacheSizeBytes}(function(e,t,r,n){if(!0===t&&!0===n)throw new Mt(Pt.INVALID_ARGUMENT,"".concat(e," and ").concat(r," cannot be used together."))})("experimentalForceLongPolling",e.experimentalForceLongPolling,"experimentalAutoDetectLongPolling",e.experimentalAutoDetectLongPolling),this.experimentalForceLongPolling=!!e.experimentalForceLongPolling,this.experimentalForceLongPolling?this.experimentalAutoDetectLongPolling=!1:void 0===e.experimentalAutoDetectLongPolling?this.experimentalAutoDetectLongPolling=!0:this.experimentalAutoDetectLongPolling=!!e.experimentalAutoDetectLongPolling,this.experimentalLongPollingOptions=zc(null!==(r=e.experimentalLongPollingOptions)&&void 0!==r?r:{}),function(e){if(void 0!==e.timeoutSeconds){if(isNaN(e.timeoutSeconds))throw new Mt(Pt.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (must not be NaN)"));if(e.timeoutSeconds<5)throw new Mt(Pt.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (minimum allowed value is 5)"));if(e.timeoutSeconds>30)throw new Mt(Pt.INVALID_ARGUMENT,"invalid long polling timeout: ".concat(e.timeoutSeconds," (maximum allowed value is 30)"))}}(this.experimentalLongPollingOptions),this.useFetchStreams=!!e.useFetchStreams}isEqual(e){return this.host===e.host&&this.ssl===e.ssl&&this.credentials===e.credentials&&this.cacheSizeBytes===e.cacheSizeBytes&&this.experimentalForceLongPolling===e.experimentalForceLongPolling&&this.experimentalAutoDetectLongPolling===e.experimentalAutoDetectLongPolling&&function(e,t){return e.timeoutSeconds===t.timeoutSeconds}(this.experimentalLongPollingOptions,e.experimentalLongPollingOptions)&&this.ignoreUndefinedProperties===e.ignoreUndefinedProperties&&this.useFetchStreams===e.useFetchStreams}}class Wc{constructor(e,t,r,n){this._authCredentials=e,this._appCheckCredentials=t,this._databaseId=r,this._app=n,this.type="firestore-lite",this._persistenceKey="(lite)",this._settings=new qc({}),this._settingsFrozen=!1,this._emulatorOptions={},this._terminateTask="notTerminated"}get app(){if(!this._app)throw new Mt(Pt.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._app}get _initialized(){return this._settingsFrozen}get _terminated(){return"notTerminated"!==this._terminateTask}_setSettings(e){if(this._settingsFrozen)throw new Mt(Pt.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only modify settings before calling any other methods on a Firestore object.");this._settings=new qc(e),this._emulatorOptions=e.emulatorOptions||{},void 0!==e.credentials&&(this._authCredentials=function(e){if(!e)return new Dt;switch(e.type){case"firstParty":return new Bt(e.sessionIndex||"0",e.iamToken||null,e.authTokenFactory||null);case"provider":return e.client;default:throw new Mt(Pt.INVALID_ARGUMENT,"makeAuthCredentialsProvider failed due to invalid credential type")}}(e.credentials))}_getSettings(){return this._settings}_getEmulatorOptions(){return this._emulatorOptions}_freezeSettings(){return this._settingsFrozen=!0,this._settings}_delete(){return"notTerminated"===this._terminateTask&&(this._terminateTask=this._terminate()),this._terminateTask}async _restart(){"notTerminated"===this._terminateTask?await this._terminate():this._terminateTask="notTerminated"}toJSON(){return{app:this._app,databaseId:this._databaseId,settings:this._settings}}_terminate(){return function(e){const t=Bc.get(e);t&&(St("ComponentProvider","Removing Datastore"),Bc.delete(e),t.terminate())}(this),Promise.resolve()}}class Hc{constructor(e,t,r){this.converter=t,this._query=r,this.type="query",this.firestore=e}withConverter(e){return new Hc(this.firestore,e,this._query)}}class Gc{constructor(e,t,r){this.converter=t,this._key=r,this.type="document",this.firestore=e}get _path(){return this._key.path}get id(){return this._key.path.lastSegment()}get path(){return this._key.path.canonicalString()}get parent(){return new Zc(this.firestore,this.converter,this._key.path.popLast())}withConverter(e){return new Gc(this.firestore,e,this._key)}toJSON(){return{type:Gc._jsonSchemaVersion,referencePath:this._key.toString()}}static fromJSON(e,t,r){if(lr(t,Gc._jsonSchema))return new Gc(e,r||null,new er(Jt.fromString(t.referencePath)))}}Gc._jsonSchemaVersion="firestore/documentReference/1.0",Gc._jsonSchema={type:ar("string",Gc._jsonSchemaVersion),referencePath:ar("string")};class Zc extends Hc{constructor(e,t,r){super(e,t,Ni(r)),this._path=r,this.type="collection"}get id(){return this._query.path.lastSegment()}get path(){return this._query.path.canonicalString()}get parent(){const e=this._path.popLast();return e.isEmpty()?null:new Gc(this.firestore,null,new er(e))}withConverter(e){return new Zc(this.firestore,e,this._path)}}function Kc(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(e=E(e),tr("collection","path",t),e instanceof Wc){const r=Jt.fromString(t,...n);return nr(r),new Zc(e,null,r)}{if(!(e instanceof Gc||e instanceof Zc))throw new Mt(Pt.INVALID_ARGUMENT,"Expected first argument to collection() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Jt.fromString(t,...n));return nr(r),new Zc(e.firestore,null,r)}}function Yc(e,t){for(var r=arguments.length,n=new Array(r>2?r-2:0),i=2;i<r;i++)n[i-2]=arguments[i];if(e=E(e),1===arguments.length&&(t=Wt.newId()),tr("doc","path",t),e instanceof Wc){const r=Jt.fromString(t,...n);return rr(r),new Gc(e,null,new er(r))}{if(!(e instanceof Gc||e instanceof Zc))throw new Mt(Pt.INVALID_ARGUMENT,"Expected first argument to doc() to be a CollectionReference, a DocumentReference or FirebaseFirestore");const r=e._path.child(Jt.fromString(t,...n));return rr(r),new Gc(e.firestore,e instanceof Zc?e.converter:null,new er(r))}}const Xc="AsyncQueue";class Jc{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Promise.resolve();this.Xu=[],this.ec=!1,this.tc=[],this.nc=null,this.rc=!1,this.sc=!1,this.oc=[],this.M_=new Ka(this,"async_queue_retry"),this._c=()=>{const e=Ga();e&&St(Xc,"Visibility state changed to "+e.visibilityState),this.M_.w_()},this.ac=e;const t=Ga();t&&"function"==typeof t.addEventListener&&t.addEventListener("visibilitychange",this._c)}get isShuttingDown(){return this.ec}enqueueAndForget(e){this.enqueue(e)}enqueueAndForgetEvenWhileRestricted(e){this.uc(),this.cc(e)}enterRestrictedMode(e){if(!this.ec){this.ec=!0,this.sc=e||!1;const t=Ga();t&&"function"==typeof t.removeEventListener&&t.removeEventListener("visibilitychange",this._c)}}enqueue(e){if(this.uc(),this.ec)return new Promise(()=>{});const t=new Lt;return this.cc(()=>this.ec&&this.sc?Promise.resolve():(e().then(t.resolve,t.reject),t.promise)).then(()=>t.promise)}enqueueRetryable(e){this.enqueueAndForget(()=>(this.Xu.push(e),this.lc()))}async lc(){if(0!==this.Xu.length){try{await this.Xu[0](),this.Xu.shift(),this.M_.reset()}catch(e){if(!Sr(e))throw e;St(Xc,"Operation failed with retryable error: "+e)}this.Xu.length>0&&this.M_.p_(()=>this.lc())}}cc(e){const t=this.ac.then(()=>(this.rc=!0,e().catch(e=>{throw this.nc=e,this.rc=!1,Tt("INTERNAL UNHANDLED ERROR: ",Qc(e)),e}).then(e=>(this.rc=!1,e))));return this.ac=t,t}enqueueAfterDelay(e,t,r){this.uc(),this.oc.indexOf(e)>-1&&(t=0);const n=Ml.createAndSchedule(this,e,t,r,e=>this.hc(e));return this.tc.push(n),n}uc(){this.nc&&Ct(47125,{Pc:Qc(this.nc)})}verifyOperationInProgress(){}async Tc(){let e;do{e=this.ac,await e}while(e!==this.ac)}Ic(e){for(const t of this.tc)if(t.timerId===e)return!0;return!1}Ec(e){return this.Tc().then(()=>{this.tc.sort((e,t)=>e.targetTimeMs-t.targetTimeMs);for(const t of this.tc)if(t.skipDelay(),"all"!==e&&t.timerId===e)break;return this.Tc()})}dc(e){this.oc.push(e)}hc(e){const t=this.tc.indexOf(e);this.tc.splice(t,1)}}function Qc(e){let t=e.message||"";return e.stack&&(t=e.stack.includes(e.message)?e.stack:e.message+"\n"+e.stack),t}function $c(e){return function(e,t){if("object"!=typeof e||null===e)return!1;const r=e;for(const n of t)if(n in r&&"function"==typeof r[n])return!0;return!1}(e,["next","error","complete"])}class eu extends Wc{constructor(e,t,r,n){super(e,t,r,n),this.type="firestore",this._queue=new Jc,this._persistenceKey=(null===n||void 0===n?void 0:n.name)||"[DEFAULT]"}async _terminate(){if(this._firestoreClient){const e=this._firestoreClient.terminate();this._queue=new Jc(e),this._firestoreClient=void 0,await e}}}function tu(e,t){const r="object"==typeof e?e:Ge(),i="string"==typeof e?e:t||An,s=Be(r,"firestore").getImmediate({identifier:i});if(!s._initialized){const e=d("firestore");e&&function(e,t,r){let i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e=or(e,Wc);const s=m(t),o=e._getSettings(),a=(0,n.A)((0,n.A)({},o),{},{emulatorOptions:e._getEmulatorOptions()}),l="".concat(t,":").concat(r);s&&(f("https://".concat(l)),v("Firestore",!0)),o.host!==Uc&&o.host!==l&&kt("Host has been set in both settings() and connectFirestoreEmulator(), emulator host will be used.");const c=(0,n.A)((0,n.A)({},o),{},{host:l,ssl:s,emulatorOptions:i});if(!A(c,a)&&(e._setSettings(c),i.mockUserToken)){let t,r;if("string"==typeof i.mockUserToken)t=i.mockUserToken,r=xt.MOCK_USER;else{var u;t=g(i.mockUserToken,null===(u=e._app)||void 0===u?void 0:u.options.projectId);const n=i.mockUserToken.sub||i.mockUserToken.user_id;if(!n)throw new Mt(Pt.INVALID_ARGUMENT,"mockUserToken must contain 'sub' or 'user_id' field!");r=new xt(n)}e._authCredentials=new Ft(new Rt(t,r))}}(s,...e)}return s}function ru(e){if(e._terminated)throw new Mt(Pt.FAILED_PRECONDITION,"The client has already been terminated.");return e._firestoreClient||nu(e),e._firestoreClient}function nu(e){var t,r,n;const i=e._freezeSettings(),s=function(e,t,r,n){return new kn(e,t,r,n.host,n.ssl,n.experimentalForceLongPolling,n.experimentalAutoDetectLongPolling,zc(n.experimentalLongPollingOptions),n.useFetchStreams,n.isUsingEmulator)}(e._databaseId,(null===(t=e._app)||void 0===t?void 0:t.options.appId)||"",e._persistenceKey,i);e._componentsProvider||null!==(r=i.localCache)&&void 0!==r&&r._offlineComponentProvider&&null!==(n=i.localCache)&&void 0!==n&&n._onlineComponentProvider&&(e._componentsProvider={_offline:i.localCache._offlineComponentProvider,_online:i.localCache._onlineComponentProvider}),e._firestoreClient=new Nc(e._authCredentials,e._appCheckCredentials,e._queue,s,e._componentsProvider&&function(e){const t=null===e||void 0===e?void 0:e._online.build();return{_offline:null===e||void 0===e?void 0:e._offline.build(t),_online:t}}(e._componentsProvider))}class iu{constructor(e){this._byteString=e}static fromBase64String(e){try{return new iu(mn.fromBase64String(e))}catch(e){throw new Mt(Pt.INVALID_ARGUMENT,"Failed to construct data from Base64 string: "+e)}}static fromUint8Array(e){return new iu(mn.fromUint8Array(e))}toBase64(){return this._byteString.toBase64()}toUint8Array(){return this._byteString.toUint8Array()}toString(){return"Bytes(base64: "+this.toBase64()+")"}isEqual(e){return this._byteString.isEqual(e._byteString)}toJSON(){return{type:iu._jsonSchemaVersion,bytes:this.toBase64()}}static fromJSON(e){if(lr(e,iu._jsonSchema))return iu.fromBase64String(e.bytes)}}iu._jsonSchemaVersion="firestore/bytes/1.0",iu._jsonSchema={type:ar("string",iu._jsonSchemaVersion),bytes:ar("string")};class su{constructor(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];for(let n=0;n<t.length;++n)if(0===t[n].length)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new $t(t)}isEqual(e){return this._internalPath.isEqual(e._internalPath)}}class ou{constructor(e){this._methodName=e}}class au{constructor(e,t){if(!isFinite(e)||e<-90||e>90)throw new Mt(Pt.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+e);if(!isFinite(t)||t<-180||t>180)throw new Mt(Pt.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+t);this._lat=e,this._long=t}get latitude(){return this._lat}get longitude(){return this._long}isEqual(e){return this._lat===e._lat&&this._long===e._long}_compareTo(e){return Ht(this._lat,e._lat)||Ht(this._long,e._long)}toJSON(){return{latitude:this._lat,longitude:this._long,type:au._jsonSchemaVersion}}static fromJSON(e){if(lr(e,au._jsonSchema))return new au(e.latitude,e.longitude)}}au._jsonSchemaVersion="firestore/geoPoint/1.0",au._jsonSchema={type:ar("string",au._jsonSchemaVersion),latitude:ar("number"),longitude:ar("number")};class lu{constructor(e){this._values=(e||[]).map(e=>e)}toArray(){return this._values.map(e=>e)}isEqual(e){return function(e,t){if(e.length!==t.length)return!1;for(let r=0;r<e.length;++r)if(e[r]!==t[r])return!1;return!0}(this._values,e._values)}toJSON(){return{type:lu._jsonSchemaVersion,vectorValues:this._values}}static fromJSON(e){if(lr(e,lu._jsonSchema)){if(Array.isArray(e.vectorValues)&&e.vectorValues.every(e=>"number"==typeof e))return new lu(e.vectorValues);throw new Mt(Pt.INVALID_ARGUMENT,"Expected 'vectorValues' field to be a number array")}}}lu._jsonSchemaVersion="firestore/vectorValue/1.0",lu._jsonSchema={type:ar("string",lu._jsonSchemaVersion),vectorValues:ar("object")};const cu=/^__.*__$/;class uu{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return null!==this.fieldMask?new Is(e,this.data,this.fieldMask,t,this.fieldTransforms):new Ns(e,this.data,t,this.fieldTransforms)}}class du{constructor(e,t,r){this.data=e,this.fieldMask=t,this.fieldTransforms=r}toMutation(e,t){return new Is(e,this.data,this.fieldMask,t,this.fieldTransforms)}}function hu(e){switch(e){case 0:case 2:case 1:return!0;case 3:case 4:return!1;default:throw Ct(40011,{Ac:e})}}class pu{constructor(e,t,r,n,i,s){this.settings=e,this.databaseId=t,this.serializer=r,this.ignoreUndefinedProperties=n,void 0===i&&this.Rc(),this.fieldTransforms=i||[],this.fieldMask=s||[]}get path(){return this.settings.path}get Ac(){return this.settings.Ac}Vc(e){return new pu((0,n.A)((0,n.A)({},this.settings),e),this.databaseId,this.serializer,this.ignoreUndefinedProperties,this.fieldTransforms,this.fieldMask)}mc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.Vc({path:r,fc:!1});return n.gc(e),n}yc(e){var t;const r=null===(t=this.path)||void 0===t?void 0:t.child(e),n=this.Vc({path:r,fc:!1});return n.Rc(),n}wc(e){return this.Vc({path:void 0,fc:!0})}Sc(e){return Eu(e,this.settings.methodName,this.settings.bc||!1,this.path,this.settings.Dc)}contains(e){return void 0!==this.fieldMask.find(t=>e.isPrefixOf(t))||void 0!==this.fieldTransforms.find(t=>e.isPrefixOf(t.field))}Rc(){if(this.path)for(let e=0;e<this.path.length;e++)this.gc(this.path.get(e))}gc(e){if(0===e.length)throw this.Sc("Document fields must not be empty");if(hu(this.Ac)&&cu.test(e))throw this.Sc('Document fields cannot begin and end with "__"')}}class mu{constructor(e,t,r){this.databaseId=e,this.ignoreUndefinedProperties=t,this.serializer=r||Za(e)}Cc(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return new pu({Ac:e,methodName:t,Dc:r,path:$t.emptyPath(),fc:!1,bc:n},this.databaseId,this.serializer,this.ignoreUndefinedProperties)}}function fu(e){const t=e._freezeSettings(),r=Za(e._databaseId);return new mu(e._databaseId,!!t.ignoreUndefinedProperties,r)}function gu(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:{};const o=e.Cc(s.merge||s.mergeFields?2:0,t,r,i);Tu("Data must be an object, but it was:",o,n);const a=ju(n,o);let l,c;if(s.merge)l=new hn(o.fieldMask),c=o.fieldTransforms;else if(s.mergeFields){const e=[];for(const n of s.mergeFields){const i=ku(t,n,r);if(!o.contains(i))throw new Mt(Pt.INVALID_ARGUMENT,"Field '".concat(i,"' is specified in your field mask but missing from your input data."));Nu(e,i)||e.push(i)}l=new hn(e),c=o.fieldTransforms.filter(e=>l.covers(e.field))}else l=null,c=o.fieldTransforms;return new uu(new Qn(a),l,c)}class yu extends ou{_toFieldTransform(e){if(2!==e.Ac)throw 1===e.Ac?e.Sc("".concat(this._methodName,"() can only appear at the top level of your update data")):e.Sc("".concat(this._methodName,"() cannot be used with set() unless you pass {merge:true}"));return e.fieldMask.push(e.path),null}isEqual(e){return e instanceof yu}}class _u extends ou{_toFieldTransform(e){return new xs(e.path,new hs)}isEqual(e){return e instanceof _u}}function vu(e,t,r,n){const i=e.Cc(1,t,r);Tu("Data must be an object, but it was:",i,n);const s=[],o=Qn.empty();sn(n,(e,n)=>{const a=Cu(t,e,r);n=E(n);const l=i.yc(a);if(n instanceof yu)s.push(a);else{const e=wu(n,l);null!=e&&(s.push(a),o.set(a,e))}});const a=new hn(s);return new du(o,a,i.fieldTransforms)}function xu(e,t,r,n,i,s){const o=e.Cc(1,t,r),a=[ku(t,n,r)],l=[i];if(s.length%2!=0)throw new Mt(Pt.INVALID_ARGUMENT,"Function ".concat(t,"() needs to be called with an even number of arguments that alternate between field names and values."));for(let h=0;h<s.length;h+=2)a.push(ku(t,s[h])),l.push(s[h+1]);const c=[],u=Qn.empty();for(let h=a.length-1;h>=0;--h)if(!Nu(c,a[h])){const e=a[h];let t=l[h];t=E(t);const r=o.yc(e);if(t instanceof yu)c.push(e);else{const n=wu(t,r);null!=n&&(c.push(e),u.set(e,n))}}const d=new hn(c);return new du(u,d,o.fieldTransforms)}function bu(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]&&arguments[3];return wu(r,e.Cc(n?4:3,t))}function wu(e,t){if(Su(e=E(e)))return Tu("Unsupported field value:",t,e),ju(e,t);if(e instanceof ou)return function(e,t){if(!hu(t.Ac))throw t.Sc("".concat(e._methodName,"() can only be used with update() and set()"));if(!t.path)throw t.Sc("".concat(e._methodName,"() is not currently supported inside arrays"));const r=e._toFieldTransform(t);r&&t.fieldTransforms.push(r)}(e,t),null;if(void 0===e&&t.ignoreUndefinedProperties)return null;if(t.path&&t.fieldMask.push(t.path),e instanceof Array){if(t.settings.fc&&4!==t.Ac)throw t.Sc("Nested arrays are not supported");return function(e,t){const r=[];let n=0;for(const i of e){let e=wu(i,t.wc(n));null==e&&(e={nullValue:"NULL_VALUE"}),r.push(e),n++}return{arrayValue:{values:r}}}(e,t)}return function(e,t){if(null===(e=E(e)))return{nullValue:"NULL_VALUE"};if("number"==typeof e)return as(t.serializer,e);if("boolean"==typeof e)return{booleanValue:e};if("string"==typeof e)return{stringValue:e};if(e instanceof Date){const r=dr.fromDate(e);return{timestampValue:po(t.serializer,r)}}if(e instanceof dr){const r=new dr(e.seconds,1e3*Math.floor(e.nanoseconds/1e3));return{timestampValue:po(t.serializer,r)}}if(e instanceof au)return{geoPointValue:{latitude:e.latitude,longitude:e.longitude}};if(e instanceof iu)return{bytesValue:mo(t.serializer,e._byteString)};if(e instanceof Gc){const r=t.databaseId,n=e.firestore._databaseId;if(!n.isEqual(r))throw t.Sc("Document reference is for database ".concat(n.projectId,"/").concat(n.database," but should be for database ").concat(r.projectId,"/").concat(r.database));return{referenceValue:yo(e.firestore._databaseId||t.databaseId,e._key.path)}}if(e instanceof lu)return function(e,t){return{mapValue:{fields:{[En]:{stringValue:Pn},[Mn]:{arrayValue:{values:e.toArray().map(e=>{if("number"!=typeof e)throw t.Sc("VectorValues must only contain numeric values.");return ss(t.serializer,e)})}}}}}}(e,t);throw t.Sc("Unsupported field value: ".concat(sr(e)))}(e,t)}function ju(e,t){const r={};return on(e)?t.path&&t.path.length>0&&t.fieldMask.push(t.path):sn(e,(e,n)=>{const i=wu(n,t.mc(e));null!=i&&(r[e]=i)}),{mapValue:{fields:r}}}function Su(e){return!("object"!=typeof e||null===e||e instanceof Array||e instanceof Date||e instanceof dr||e instanceof au||e instanceof iu||e instanceof Gc||e instanceof ou||e instanceof lu)}function Tu(e,t,r){if(!Su(r)||!ir(r)){const n=sr(r);throw"an object"===n?t.Sc(e+" a custom object"):t.Sc(e+" "+n)}}function ku(e,t,r){if((t=E(t))instanceof su)return t._internalPath;if("string"==typeof t)return Cu(e,t);throw Eu("Field path arguments must be of type string or ",e,!1,void 0,r)}const Au=new RegExp("[~\\*/\\[\\]]");function Cu(e,t,r){if(t.search(Au)>=0)throw Eu("Invalid field path (".concat(t,"). Paths must not contain '~', '*', '/', '[', or ']'"),e,!1,void 0,r);try{return new su(...t.split("."))._internalPath}catch(n){throw Eu("Invalid field path (".concat(t,"). Paths must not be empty, begin with '.', end with '.', or contain '..'"),e,!1,void 0,r)}}function Eu(e,t,r,n,i){const s=n&&!n.isEmpty(),o=void 0!==i;let a="Function ".concat(t,"() called with invalid data");r&&(a+=" (via `toFirestore()`)"),a+=". ";let l="";return(s||o)&&(l+=" (found",s&&(l+=" in field ".concat(n)),o&&(l+=" in document ".concat(i)),l+=")"),new Mt(Pt.INVALID_ARGUMENT,a+e+l)}function Nu(e,t){return e.some(e=>e.isEqual(t))}class Iu{constructor(e,t,r,n,i){this._firestore=e,this._userDataWriter=t,this._key=r,this._document=n,this._converter=i}get id(){return this._key.path.lastSegment()}get ref(){return new Gc(this._firestore,this._converter,this._key)}exists(){return null!==this._document}data(){if(this._document){if(this._converter){const e=new Pu(this._firestore,this._userDataWriter,this._key,this._document,null);return this._converter.fromFirestore(e)}return this._userDataWriter.convertValue(this._document.data.value)}}get(e){if(this._document){const t=this._document.data.field(Mu("DocumentSnapshot.get",e));if(null!==t)return this._userDataWriter.convertValue(t)}}}class Pu extends Iu{data(){return super.data()}}function Mu(e,t){return"string"==typeof t?Cu(e,t):t instanceof su?t._internalPath:t._delegate._internalPath}function Lu(e){if("L"===e.limitType&&0===e.explicitOrderBy.length)throw new Mt(Pt.UNIMPLEMENTED,"limitToLast() queries require specifying at least one orderBy() clause")}class Ru{}class Du extends Ru{}function Fu(e,t){let r=[];for(var n=arguments.length,i=new Array(n>2?n-2:0),s=2;s<n;s++)i[s-2]=arguments[s];t instanceof Ru&&r.push(t),r=r.concat(i),function(e){const t=e.filter(e=>e instanceof zu).length,r=e.filter(e=>e instanceof Ou).length;if(t>1||t>0&&r>0)throw new Mt(Pt.INVALID_ARGUMENT,"InvalidQuery. When using composite filters, you cannot use more than one filter at the top level. Consider nesting the multiple filters within an `and(...)` statement. For example: change `query(query, where(...), or(...))` to `query(query, and(where(...), or(...)))`.")}(r);for(const o of r)e=o._apply(e);return e}class Ou extends Du{constructor(e,t,r){super(),this._field=e,this._op=t,this._value=r,this.type="where"}static _create(e,t,r){return new Ou(e,t,r)}_apply(e){const t=this._parse(e);return qu(e._query,t),new Hc(e.firestore,e.converter,Di(e._query,t))}_parse(e){const t=fu(e.firestore),r=function(e,t,r,n,i,s,o){let a;if(i.isKeyField()){if("array-contains"===s||"array-contains-any"===s)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid Query. You can't perform '".concat(s,"' queries on documentId()."));if("in"===s||"not-in"===s){Vu(o,s);const t=[];for(const r of o)t.push(Uu(n,e,r));a={arrayValue:{values:t}}}else a=Uu(n,e,o)}else"in"!==s&&"not-in"!==s&&"array-contains-any"!==s||Vu(o,s),a=bu(r,t,o,"in"===s||"not-in"===s);return ai.create(i,s,a)}(e._query,"where",t,e.firestore._databaseId,this._field,this._op,this._value);return r}}class zu extends Ru{constructor(e,t){super(),this.type=e,this._queryConstraints=t}static _create(e,t){return new zu(e,t)}_parse(e){const t=this._queryConstraints.map(t=>t._parse(e)).filter(e=>e.getFilters().length>0);return 1===t.length?t[0]:li.create(t,this._getOperator())}_apply(e){const t=this._parse(e);return 0===t.getFilters().length?e:(function(e,t){let r=e;const n=t.getFlattenedFilters();for(const i of n)qu(r,i),r=Di(r,i)}(e._query,t),new Hc(e.firestore,e.converter,Di(e._query,t)))}_getQueryConstraints(){return this._queryConstraints}_getOperator(){return"and"===this.type?"and":"or"}}class Bu extends Du{constructor(e,t){super(),this._field=e,this._direction=t,this.type="orderBy"}static _create(e,t){return new Bu(e,t)}_apply(e){const t=function(e,t,r){if(null!==e.startAt)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid query. You must not call startAt() or startAfter() before calling orderBy().");if(null!==e.endAt)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid query. You must not call endAt() or endBefore() before calling orderBy().");return new ii(t,r)}(e._query,this._field,this._direction);return new Hc(e.firestore,e.converter,function(e,t){const r=e.explicitOrderBy.concat([t]);return new Ci(e.path,e.collectionGroup,r,e.filters.slice(),e.limit,e.limitType,e.startAt,e.endAt)}(e._query,t))}}function Uu(e,t,r){if("string"==typeof(r=E(r))){if(""===r)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid document ID, but it was an empty string.");if(!Pi(t)&&-1!==r.indexOf("/"))throw new Mt(Pt.INVALID_ARGUMENT,"Invalid query. When querying a collection by documentId(), you must provide a plain document ID, but '".concat(r,"' contains a '/' character."));const n=t.path.child(Jt.fromString(r));if(!er.isDocumentKey(n))throw new Mt(Pt.INVALID_ARGUMENT,"Invalid query. When querying a collection group by documentId(), the value provided must result in a valid document path, but '".concat(n,"' is not because it has an odd number of segments (").concat(n.length,")."));return qn(e,new er(n))}if(r instanceof Gc)return qn(e,r._key);throw new Mt(Pt.INVALID_ARGUMENT,"Invalid query. When querying with documentId(), you must provide a valid string or a DocumentReference, but it was: ".concat(sr(r),"."))}function Vu(e,t){if(!Array.isArray(e)||0===e.length)throw new Mt(Pt.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '".concat(t.toString(),"' filters."))}function qu(e,t){const r=function(e,t){for(const r of e)for(const e of r.getFlattenedFilters())if(t.indexOf(e.op)>=0)return e.op;return null}(e.filters,function(e){switch(e){case"!=":return["!=","not-in"];case"array-contains-any":case"in":return["not-in"];case"not-in":return["array-contains-any","in","not-in","!="];default:return[]}}(t.op));if(null!==r)throw r===t.op?new Mt(Pt.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '".concat(t.op.toString(),"' filter.")):new Mt(Pt.INVALID_ARGUMENT,"Invalid query. You cannot use '".concat(t.op.toString(),"' filters with '").concat(r.toString(),"' filters."))}class Wu{convertValue(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";switch(Ln(e)){case 0:return null;case 1:return e.booleanValue;case 2:return yn(e.integerValue||e.doubleValue);case 3:return this.convertTimestamp(e.timestampValue);case 4:return this.convertServerTimestamp(e,t);case 5:return e.stringValue;case 6:return this.convertBytes(_n(e.bytesValue));case 7:return this.convertReference(e.referenceValue);case 8:return this.convertGeoPoint(e.geoPointValue);case 9:return this.convertArray(e.arrayValue,t);case 11:return this.convertObject(e.mapValue,t);case 10:return this.convertVectorValue(e.mapValue);default:throw Ct(62114,{value:e})}}convertObject(e,t){return this.convertObjectMap(e.fields,t)}convertObjectMap(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"none";const r={};return sn(e,(e,n)=>{r[e]=this.convertValue(n,t)}),r}convertVectorValue(e){var t;const r=null===(t=e.fields)||void 0===t||null===(t=t[Mn].arrayValue)||void 0===t||null===(t=t.values)||void 0===t?void 0:t.map(e=>yn(e.doubleValue));return new lu(r)}convertGeoPoint(e){return new au(yn(e.latitude),yn(e.longitude))}convertArray(e,t){return(e.values||[]).map(e=>this.convertValue(e,t))}convertServerTimestamp(e,t){switch(t){case"previous":const r=Sn(e);return null==r?null:this.convertValue(r,t);case"estimate":return this.convertTimestamp(Tn(e));default:return null}}convertTimestamp(e){const t=gn(e);return new dr(t.seconds,t.nanos)}convertDocumentKey(e,t){const r=Jt.fromString(e);Nt(zo(r),9688,{name:e});const n=new Cn(r.get(1),r.get(3)),i=new er(r.popFirst(5));return n.isEqual(t)||Tt("Document ".concat(i," contains a document reference within a different database (").concat(n.projectId,"/").concat(n.database,") which is not supported. It will be treated as a reference in the current database (").concat(t.projectId,"/").concat(t.database,") instead.")),i}}function Hu(e,t,r){let n;return n=e?r&&(r.merge||r.mergeFields)?e.toFirestore(t,r):e.toFirestore(t):t,n}class Gu{constructor(e,t){this.hasPendingWrites=e,this.fromCache=t}isEqual(e){return this.hasPendingWrites===e.hasPendingWrites&&this.fromCache===e.fromCache}}class Zu extends Iu{constructor(e,t,r,n,i,s){super(e,t,r,n,s),this._firestore=e,this._firestoreImpl=e,this.metadata=i}exists(){return super.exists()}data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if(this._document){if(this._converter){const t=new Ku(this._firestore,this._userDataWriter,this._key,this._document,this.metadata,null);return this._converter.fromFirestore(t,e)}return this._userDataWriter.convertValue(this._document.data.value,e.serverTimestamps)}}get(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(this._document){const r=this._document.data.field(Mu("DocumentSnapshot.get",e));if(null!==r)return this._userDataWriter.convertValue(r,t.serverTimestamps)}}toJSON(){if(this.metadata.hasPendingWrites)throw new Mt(Pt.FAILED_PRECONDITION,"DocumentSnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e=this._document,t={};return t.type=Zu._jsonSchemaVersion,t.bundle="",t.bundleSource="DocumentSnapshot",t.bundleName=this._key.toString(),e&&e.isValidDocument()&&e.isFoundDocument()?(this._userDataWriter.convertObjectMap(e.data.value.mapValue.fields,"previous"),t.bundle=(this._firestore,this.ref.path,"NOT SUPPORTED"),t):t}}Zu._jsonSchemaVersion="firestore/documentSnapshot/1.0",Zu._jsonSchema={type:ar("string",Zu._jsonSchemaVersion),bundleSource:ar("string","DocumentSnapshot"),bundleName:ar("string"),bundle:ar("string")};class Ku extends Zu{data(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return super.data(e)}}class Yu{constructor(e,t,r,n){this._firestore=e,this._userDataWriter=t,this._snapshot=n,this.metadata=new Gu(n.hasPendingWrites,n.fromCache),this.query=r}get docs(){const e=[];return this.forEach(t=>e.push(t)),e}get size(){return this._snapshot.docs.size}get empty(){return 0===this.size}forEach(e,t){this._snapshot.docs.forEach(r=>{e.call(t,new Ku(this._firestore,this._userDataWriter,r.key,r,new Gu(this._snapshot.mutatedKeys.has(r.key),this._snapshot.fromCache),this.query.converter))})}docChanges(){const e=!!(arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}).includeMetadataChanges;if(e&&this._snapshot.excludesMetadataChanges)throw new Mt(Pt.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(e,t){if(e._snapshot.oldDocs.isEmpty()){let t=0;return e._snapshot.docChanges.map(r=>{const n=new Ku(e._firestore,e._userDataWriter,r.doc.key,r.doc,new Gu(e._snapshot.mutatedKeys.has(r.doc.key),e._snapshot.fromCache),e.query.converter);return r.doc,{type:"added",doc:n,oldIndex:-1,newIndex:t++}})}{let r=e._snapshot.oldDocs;return e._snapshot.docChanges.filter(e=>t||3!==e.type).map(t=>{const n=new Ku(e._firestore,e._userDataWriter,t.doc.key,t.doc,new Gu(e._snapshot.mutatedKeys.has(t.doc.key),e._snapshot.fromCache),e.query.converter);let i=-1,s=-1;return 0!==t.type&&(i=r.indexOf(t.doc.key),r=r.delete(t.doc.key)),1!==t.type&&(r=r.add(t.doc),s=r.indexOf(t.doc.key)),{type:Xu(t.type),doc:n,oldIndex:i,newIndex:s}})}}(this,e),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges}toJSON(){if(this.metadata.hasPendingWrites)throw new Mt(Pt.FAILED_PRECONDITION,"QuerySnapshot.toJSON() attempted to serialize a document with pending writes. Await waitForPendingWrites() before invoking toJSON().");const e={};e.type=Yu._jsonSchemaVersion,e.bundleSource="QuerySnapshot",e.bundleName=Wt.newId(),this._firestore._databaseId.database,this._firestore._databaseId.projectId;const t=[],r=[],n=[];return this.docs.forEach(e=>{null!==e._document&&(t.push(e._document),r.push(this._userDataWriter.convertObjectMap(e._document.data.value.mapValue.fields,"previous")),n.push(e.ref.path))}),e.bundle=(this._firestore,this.query._query,e.bundleName,"NOT SUPPORTED"),e}}function Xu(e){switch(e){case 0:return"added";case 2:case 3:return"modified";case 1:return"removed";default:return Ct(61501,{type:e})}}function Ju(e){e=or(e,Gc);const t=or(e.firestore,eu);return Fc(ru(t),e._key).then(r=>rd(t,e,r))}Yu._jsonSchemaVersion="firestore/querySnapshot/1.0",Yu._jsonSchema={type:ar("string",Yu._jsonSchemaVersion),bundleSource:ar("string","QuerySnapshot"),bundleName:ar("string"),bundle:ar("string")};class Qu extends Wu{constructor(e){super(),this.firestore=e}convertBytes(e){return new iu(e)}convertReference(e){const t=this.convertDocumentKey(e,this.firestore._databaseId);return new Gc(this.firestore,null,t)}}function $u(e,t,r){e=or(e,Gc);const n=or(e.firestore,eu),i=fu(n);let s;for(var o=arguments.length,a=new Array(o>3?o-3:0),l=3;l<o;l++)a[l-3]=arguments[l];return s="string"==typeof(t=E(t))||t instanceof su?xu(i,"updateDoc",e._key,t,r,a):vu(i,"updateDoc",e._key,t),td(n,[s.toMutation(e._key,ws.exists(!0))])}function ed(e){for(var t=arguments.length,r=new Array(t>1?t-1:0),n=1;n<t;n++)r[n-1]=arguments[n];e=E(e);let i={includeMetadataChanges:!1,source:"default"},s=0;"object"!=typeof r[s]||$c(r[s])||(i=r[s++]);const o={includeMetadataChanges:i.includeMetadataChanges,source:i.source};if($c(r[s])){var a,l,c;const e=r[s];r[s]=null===(a=e.next)||void 0===a?void 0:a.bind(e),r[s+1]=null===(l=e.error)||void 0===l?void 0:l.bind(e),r[s+2]=null===(c=e.complete)||void 0===c?void 0:c.bind(e)}let u,d,h;if(e instanceof Gc)d=or(e.firestore,eu),h=Ni(e._key.path),u={next:t=>{r[s]&&r[s](rd(d,e,t))},error:r[s+1],complete:r[s+2]};else{const t=or(e,Hc);d=or(t.firestore,eu),h=t._query;const n=new Qu(d);u={next:e=>{r[s]&&r[s](new Yu(d,n,t,e))},error:r[s+1],complete:r[s+2]},Lu(e._query)}return function(e,t,r,n){const i=new Cc(n),s=new Kl(t,i,r);return e.asyncQueue.enqueueAndForget(async()=>Ul(await Dc(e),s)),()=>{i.Nu(),e.asyncQueue.enqueueAndForget(async()=>Vl(await Dc(e),s))}}(ru(d),h,o,u)}function td(e,t){return function(e,t){const r=new Lt;return e.asyncQueue.enqueueAndForget(async()=>async function(e,t,r){const n=Sc(e);try{const e=await function(e,t){const r=It(e),n=dr.now(),i=t.reduce((e,t)=>e.add(t.key),rs());let s,o;return r.persistence.runTransaction("Locally write mutations","readwrite",e=>{let a=Zi(),l=rs();return r.Ns.getEntries(e,i).next(e=>{a=e,a.forEach((e,t)=>{t.isValidDocument()||(l=l.add(e))})}).next(()=>r.localDocuments.getOverlayedDocuments(e,a)).next(i=>{s=i;const o=[];for(const e of t){const t=Cs(e,s.get(e.key).overlayedDocument);null!=t&&o.push(new Is(e.key,t,$n(t.value.mapValue),ws.exists(!0)))}return r.mutationQueue.addMutationBatch(e,n,o,t)}).next(t=>{o=t;const n=t.applyToLocalDocumentSet(s,l);return r.documentOverlayCache.saveOverlays(e,t.batchId,n)})}).then(()=>({batchId:o.batchId,changes:Xi(s)}))}(n.localStore,t);n.sharedClientState.addPendingMutation(e.batchId),function(e,t,r){let n=e.Vu[e.currentUser.toKey()];n||(n=new an(Ht)),n=n.insert(t,r),e.Vu[e.currentUser.toKey()]=n}(n,e.batchId,r),await xc(n,e.changes),await xl(n.remoteStore)}catch(e){const t=Ll(e,"Failed to persist write");r.reject(t)}}(await Rc(e),t,r)),r.promise}(ru(e),t)}function rd(e,t,r){const n=r.docs.get(t._key),i=new Qu(e);return new Zu(e,i,t._key,n,new Gu(r.hasPendingWrites,r.fromCache),t.converter)}function nd(){return new _u("serverTimestamp")}new WeakMap;!function(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];!function(e){bt=e}(We),ze(new N("firestore",(e,r)=>{let{instanceIdentifier:i,options:s}=r;const o=e.getProvider("app").getImmediate(),a=new eu(new Ot(e.getProvider("auth-internal")),new Vt(o,e.getProvider("app-check-internal")),function(e,t){if(!Object.prototype.hasOwnProperty.apply(e.options,["projectId"]))throw new Mt(Pt.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');return new Cn(e.options.projectId,t)}(o,i),o);return s=(0,n.A)({useFetchStreams:t},s),a._setSettings(s),a},"PUBLIC").setMultipleInstances(!0)),Ze(_t,vt,e),Ze(_t,vt,"esm2020")}();const id="firebasestorage.googleapis.com",sd="storageBucket";class od extends S{constructor(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;super(cd(e),"Firebase Storage: ".concat(t," (").concat(cd(e),")")),this.status_=r,this.customData={serverResponse:null},this._baseMessage=this.message,Object.setPrototypeOf(this,od.prototype)}get status(){return this.status_}set status(e){this.status_=e}_codeEquals(e){return cd(e)===this.code}get serverResponse(){return this.customData.serverResponse}set serverResponse(e){this.customData.serverResponse=e,this.customData.serverResponse?this.message="".concat(this._baseMessage,"\n").concat(this.customData.serverResponse):this.message=this._baseMessage}}var ad,ld;function cd(e){return"storage/"+e}function ud(){return new od(ad.UNKNOWN,"An unknown error occurred, please check the error payload for server response.")}function dd(){return new od(ad.RETRY_LIMIT_EXCEEDED,"Max retry time for operation exceeded, please try again.")}function hd(){return new od(ad.CANCELED,"User canceled the upload/download.")}function pd(){return new od(ad.CANNOT_SLICE_BLOB,"Cannot slice blob for upload. Please retry the upload.")}function md(e){return new od(ad.INVALID_ARGUMENT,e)}function fd(){return new od(ad.APP_DELETED,"The Firebase app was deleted.")}function gd(e,t){return new od(ad.INVALID_FORMAT,"String does not match format '"+e+"': "+t)}function yd(e){throw new od(ad.INTERNAL_ERROR,"Internal error: "+e)}!function(e){e.UNKNOWN="unknown",e.OBJECT_NOT_FOUND="object-not-found",e.BUCKET_NOT_FOUND="bucket-not-found",e.PROJECT_NOT_FOUND="project-not-found",e.QUOTA_EXCEEDED="quota-exceeded",e.UNAUTHENTICATED="unauthenticated",e.UNAUTHORIZED="unauthorized",e.UNAUTHORIZED_APP="unauthorized-app",e.RETRY_LIMIT_EXCEEDED="retry-limit-exceeded",e.INVALID_CHECKSUM="invalid-checksum",e.CANCELED="canceled",e.INVALID_EVENT_NAME="invalid-event-name",e.INVALID_URL="invalid-url",e.INVALID_DEFAULT_BUCKET="invalid-default-bucket",e.NO_DEFAULT_BUCKET="no-default-bucket",e.CANNOT_SLICE_BLOB="cannot-slice-blob",e.SERVER_FILE_WRONG_SIZE="server-file-wrong-size",e.NO_DOWNLOAD_URL="no-download-url",e.INVALID_ARGUMENT="invalid-argument",e.INVALID_ARGUMENT_COUNT="invalid-argument-count",e.APP_DELETED="app-deleted",e.INVALID_ROOT_OPERATION="invalid-root-operation",e.INVALID_FORMAT="invalid-format",e.INTERNAL_ERROR="internal-error",e.UNSUPPORTED_ENVIRONMENT="unsupported-environment"}(ad||(ad={}));class _d{constructor(e,t){this.bucket=e,this.path_=t}get path(){return this.path_}get isRoot(){return 0===this.path.length}fullServerUrl(){const e=encodeURIComponent;return"/b/"+e(this.bucket)+"/o/"+e(this.path)}bucketOnlyServerUrl(){return"/b/"+encodeURIComponent(this.bucket)+"/o"}static makeFromBucketSpec(e,t){let r;try{r=_d.makeFromUrl(e,t)}catch(i){return new _d(e,"")}if(""===r.path)return r;throw n=e,new od(ad.INVALID_DEFAULT_BUCKET,"Invalid default bucket '"+n+"'.");var n}static makeFromUrl(e,t){let r=null;const n="([A-Za-z0-9.\\-_]+)";const i=new RegExp("^gs://"+n+"(/(.*))?$","i");function s(e){e.path_=decodeURIComponent(e.path)}const o=t.replace(/[.]/g,"\\."),a=[{regex:i,indices:{bucket:1,path:3},postModify:function(e){"/"===e.path.charAt(e.path.length-1)&&(e.path_=e.path_.slice(0,-1))}},{regex:new RegExp("^https?://".concat(o,"/").concat("v[A-Za-z0-9_]+","/b/").concat(n,"/o").concat("(/([^?#]*).*)?$"),"i"),indices:{bucket:1,path:3},postModify:s},{regex:new RegExp("^https?://".concat(t===id?"(?:storage.googleapis.com|storage.cloud.google.com)":t,"/").concat(n,"/").concat("([^?#]*)"),"i"),indices:{bucket:1,path:2},postModify:s}];for(let l=0;l<a.length;l++){const t=a[l],n=t.regex.exec(e);if(n){const e=n[t.indices.bucket];let i=n[t.indices.path];i||(i=""),r=new _d(e,i),t.postModify(r);break}}if(null==r)throw function(e){return new od(ad.INVALID_URL,"Invalid URL '"+e+"'.")}(e);return r}}class vd{constructor(e){this.promise_=Promise.reject(e)}getPromise(){return this.promise_}cancel(){}}function xd(e){return"string"===typeof e||e instanceof String}function bd(e){return wd()&&e instanceof Blob}function wd(){return"undefined"!==typeof Blob}function jd(e,t,r,n){if(n<t)throw md("Invalid value for '".concat(e,"'. Expected ").concat(t," or greater."));if(n>r)throw md("Invalid value for '".concat(e,"'. Expected ").concat(r," or less."))}function Sd(e,t,r){let n=t;return null==r&&(n="https://".concat(t)),"".concat(r,"://").concat(n,"/v0").concat(e)}function Td(e){const t=encodeURIComponent;let r="?";for(const n in e)if(e.hasOwnProperty(n)){r=r+(t(n)+"="+t(e[n]))+"&"}return r=r.slice(0,-1),r}function kd(e,t){const r=e>=500&&e<600,n=-1!==[408,429].indexOf(e),i=-1!==t.indexOf(e);return r||n||i}!function(e){e[e.NO_ERROR=0]="NO_ERROR",e[e.NETWORK_ERROR=1]="NETWORK_ERROR",e[e.ABORT=2]="ABORT"}(ld||(ld={}));class Ad{constructor(e,t,r,n,i,s,o,a,l,c,u){let d=!(arguments.length>11&&void 0!==arguments[11])||arguments[11],h=arguments.length>12&&void 0!==arguments[12]&&arguments[12];this.url_=e,this.method_=t,this.headers_=r,this.body_=n,this.successCodes_=i,this.additionalRetryCodes_=s,this.callback_=o,this.errorCallback_=a,this.timeout_=l,this.progressCallback_=c,this.connectionFactory_=u,this.retry=d,this.isUsingEmulator=h,this.pendingConnection_=null,this.backoffId_=null,this.canceled_=!1,this.appDelete_=!1,this.promise_=new Promise((e,t)=>{this.resolve_=e,this.reject_=t,this.start_()})}start_(){const e=(e,t)=>{if(t)return void e(!1,new Cd(!1,null,!0));const r=this.connectionFactory_();this.pendingConnection_=r;const n=e=>{const t=e.loaded,r=e.lengthComputable?e.total:-1;null!==this.progressCallback_&&this.progressCallback_(t,r)};null!==this.progressCallback_&&r.addUploadProgressListener(n),r.send(this.url_,this.method_,this.isUsingEmulator,this.body_,this.headers_).then(()=>{null!==this.progressCallback_&&r.removeUploadProgressListener(n),this.pendingConnection_=null;const t=r.getErrorCode()===ld.NO_ERROR,i=r.getStatus();if(!t||kd(i,this.additionalRetryCodes_)&&this.retry){const t=r.getErrorCode()===ld.ABORT;return void e(!1,new Cd(!1,null,t))}const s=-1!==this.successCodes_.indexOf(i);e(!0,new Cd(s,r))})},t=(e,t)=>{const r=this.resolve_,n=this.reject_,i=t.connection;if(t.wasSuccessCode)try{const e=this.callback_(i,i.getResponse());void 0!==e?r(e):r()}catch(s){n(s)}else if(null!==i){const e=ud();e.serverResponse=i.getErrorText(),this.errorCallback_?n(this.errorCallback_(i,e)):n(e)}else if(t.canceled){n(this.appDelete_?fd():hd())}else{n(dd())}};this.canceled_?t(0,new Cd(!1,null,!0)):this.backoffId_=function(e,t,r){let n=1,i=null,s=null,o=!1,a=0;function l(){return 2===a}let c=!1;function u(){if(!c){c=!0;for(var e=arguments.length,r=new Array(e),n=0;n<e;n++)r[n]=arguments[n];t.apply(null,r)}}function d(t){i=setTimeout(()=>{i=null,e(p,l())},t)}function h(){s&&clearTimeout(s)}function p(e){if(c)return void h();for(var t=arguments.length,r=new Array(t>1?t-1:0),i=1;i<t;i++)r[i-1]=arguments[i];if(e)return h(),void u.call(null,e,...r);if(l()||o)return h(),void u.call(null,e,...r);let s;n<64&&(n*=2),1===a?(a=2,s=0):s=1e3*(n+Math.random()),d(s)}let m=!1;function f(e){m||(m=!0,h(),c||(null!==i?(e||(a=2),clearTimeout(i),d(0)):e||(a=1)))}return d(0),s=setTimeout(()=>{o=!0,f(!0)},r),f}(e,t,this.timeout_)}getPromise(){return this.promise_}cancel(e){this.canceled_=!0,this.appDelete_=e||!1,null!==this.backoffId_&&(0,this.backoffId_)(!1),null!==this.pendingConnection_&&this.pendingConnection_.abort()}}class Cd{constructor(e,t,r){this.wasSuccessCode=e,this.connection=t,this.canceled=!!r}}function Ed(){return"undefined"!==typeof BlobBuilder?BlobBuilder:"undefined"!==typeof WebKitBlobBuilder?WebKitBlobBuilder:void 0}function Nd(){const e=Ed();for(var t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];if(void 0!==e){const t=new e;for(let e=0;e<r.length;e++)t.append(r[e]);return t.getBlob()}if(wd())return new Blob(r);throw new od(ad.UNSUPPORTED_ENVIRONMENT,"This browser doesn't seem to support creating Blobs")}function Id(e){if("undefined"===typeof atob)throw t="base-64",new od(ad.UNSUPPORTED_ENVIRONMENT,"".concat(t," is missing. Make sure to install the required polyfills. See https://firebase.google.com/docs/web/environments-js-sdk#polyfills for more information."));var t;return atob(e)}const Pd="raw",Md="base64",Ld="base64url",Rd="data_url";class Dd{constructor(e,t){this.data=e,this.contentType=t||null}}function Fd(e,t){switch(e){case Pd:return new Dd(Od(t));case Md:case Ld:return new Dd(zd(e,t));case Rd:return new Dd(function(e){const t=new Bd(e);return t.base64?zd(Md,t.rest):function(e){let t;try{t=decodeURIComponent(e)}catch(r){throw gd(Rd,"Malformed data URL.")}return Od(t)}(t.rest)}(t),new Bd(t).contentType)}throw ud()}function Od(e){const t=[];for(let r=0;r<e.length;r++){let n=e.charCodeAt(r);if(n<=127)t.push(n);else if(n<=2047)t.push(192|n>>6,128|63&n);else if(55296===(64512&n)){if(r<e.length-1&&56320===(64512&e.charCodeAt(r+1))){n=65536|(1023&n)<<10|1023&e.charCodeAt(++r),t.push(240|n>>18,128|n>>12&63,128|n>>6&63,128|63&n)}else t.push(239,191,189)}else 56320===(64512&n)?t.push(239,191,189):t.push(224|n>>12,128|n>>6&63,128|63&n)}return new Uint8Array(t)}function zd(e,t){switch(e){case Md:{const r=-1!==t.indexOf("-"),n=-1!==t.indexOf("_");if(r||n){throw gd(e,"Invalid character '"+(r?"-":"_")+"' found: is it base64url encoded?")}break}case Ld:{const r=-1!==t.indexOf("+"),n=-1!==t.indexOf("/");if(r||n){throw gd(e,"Invalid character '"+(r?"+":"/")+"' found: is it base64 encoded?")}t=t.replace(/-/g,"+").replace(/_/g,"/");break}}let r;try{r=Id(t)}catch(i){if(i.message.includes("polyfill"))throw i;throw gd(e,"Invalid character found")}const n=new Uint8Array(r.length);for(let s=0;s<r.length;s++)n[s]=r.charCodeAt(s);return n}class Bd{constructor(e){this.base64=!1,this.contentType=null;const t=e.match(/^data:([^,]+)?,/);if(null===t)throw gd(Rd,"Must be formatted 'data:[<mediatype>][;base64],<data>");const r=t[1]||null;null!=r&&(this.base64=function(e,t){if(!(e.length>=t.length))return!1;return e.substring(e.length-t.length)===t}(r,";base64"),this.contentType=this.base64?r.substring(0,r.length-7):r),this.rest=e.substring(e.indexOf(",")+1)}}class Ud{constructor(e,t){let r=0,n="";bd(e)?(this.data_=e,r=e.size,n=e.type):e instanceof ArrayBuffer?(t?this.data_=new Uint8Array(e):(this.data_=new Uint8Array(e.byteLength),this.data_.set(new Uint8Array(e))),r=this.data_.length):e instanceof Uint8Array&&(t?this.data_=e:(this.data_=new Uint8Array(e.length),this.data_.set(e)),r=e.length),this.size_=r,this.type_=n}size(){return this.size_}type(){return this.type_}slice(e,t){if(bd(this.data_)){const r=function(e,t,r){return e.webkitSlice?e.webkitSlice(t,r):e.mozSlice?e.mozSlice(t,r):e.slice?e.slice(t,r):null}(this.data_,e,t);return null===r?null:new Ud(r)}{const r=new Uint8Array(this.data_.buffer,e,t-e);return new Ud(r,!0)}}static getBlob(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];if(wd()){const e=t.map(e=>e instanceof Ud?e.data_:e);return new Ud(Nd.apply(null,e))}{const e=t.map(e=>xd(e)?Fd(Pd,e).data:e.data_);let r=0;e.forEach(e=>{r+=e.byteLength});const n=new Uint8Array(r);let i=0;return e.forEach(e=>{for(let t=0;t<e.length;t++)n[i++]=e[t]}),new Ud(n,!0)}}uploadData(){return this.data_}}function Vd(e){let t;try{t=JSON.parse(e)}catch(n){return null}return"object"!==typeof(r=t)||Array.isArray(r)?null:t;var r}function qd(e){const t=e.lastIndexOf("/",e.length-2);return-1===t?e:e.slice(t+1)}function Wd(e,t){return t}class Hd{constructor(e,t,r,n){this.server=e,this.local=t||e,this.writable=!!r,this.xform=n||Wd}}let Gd=null;function Zd(){if(Gd)return Gd;const e=[];e.push(new Hd("bucket")),e.push(new Hd("generation")),e.push(new Hd("metageneration")),e.push(new Hd("name","fullPath",!0));const t=new Hd("name");t.xform=function(e,t){return function(e){return!xd(e)||e.length<2?e:qd(e)}(t)},e.push(t);const r=new Hd("size");return r.xform=function(e,t){return void 0!==t?Number(t):t},e.push(r),e.push(new Hd("timeCreated")),e.push(new Hd("updated")),e.push(new Hd("md5Hash",null,!0)),e.push(new Hd("cacheControl",null,!0)),e.push(new Hd("contentDisposition",null,!0)),e.push(new Hd("contentEncoding",null,!0)),e.push(new Hd("contentLanguage",null,!0)),e.push(new Hd("contentType",null,!0)),e.push(new Hd("metadata","customMetadata",!0)),Gd=e,Gd}function Kd(e,t,r){const n={type:"file"},i=r.length;for(let s=0;s<i;s++){const e=r[s];n[e.local]=e.xform(n,t[e.server])}return function(e,t){Object.defineProperty(e,"ref",{get:function(){const r=e.bucket,n=e.fullPath,i=new _d(r,n);return t._makeStorageReference(i)}})}(n,e),n}function Yd(e,t,r){const n=Vd(t);if(null===n)return null;return Kd(e,n,r)}function Xd(e,t){const r={},n=t.length;for(let i=0;i<n;i++){const n=t[i];n.writable&&(r[n.server]=e[n.local])}return JSON.stringify(r)}class Jd{constructor(e,t,r,n){this.url=e,this.method=t,this.handler=r,this.timeout=n,this.urlParams={},this.headers={},this.body=null,this.errorHandler=null,this.progressCallback=null,this.successCodes=[200],this.additionalRetryCodes=[]}}function Qd(e){if(!e)throw ud()}function $d(e,t){return function(r,n){const i=Yd(e,n,t);return Qd(null!==i),i}}function eh(e,t){return function(r,n){const i=Yd(e,n,t);return Qd(null!==i),function(e,t,r,n){const i=Vd(t);if(null===i)return null;if(!xd(i.downloadTokens))return null;const s=i.downloadTokens;if(0===s.length)return null;const o=encodeURIComponent;return s.split(",").map(t=>{const i=e.bucket,s=e.fullPath;return Sd("/b/"+o(i)+"/o/"+o(s),r,n)+Td({alt:"media",token:t})})[0]}(i,n,e.host,e._protocol)}}function th(e){return function(t,r){let n;var i,s;return 401===t.getStatus()?n=t.getErrorText().includes("Firebase App Check token is invalid")?new od(ad.UNAUTHORIZED_APP,"This app does not have permission to access Firebase Storage on this project."):new od(ad.UNAUTHENTICATED,"User is not authenticated, please authenticate using Firebase Authentication and try again."):402===t.getStatus()?(s=e.bucket,n=new od(ad.QUOTA_EXCEEDED,"Quota for bucket '"+s+"' exceeded, please view quota on https://firebase.google.com/pricing/.")):403===t.getStatus()?(i=e.path,n=new od(ad.UNAUTHORIZED,"User does not have permission to access '"+i+"'.")):n=r,n.status=t.getStatus(),n.serverResponse=r.serverResponse,n}}function rh(e){const t=th(e);return function(r,n){let i=t(r,n);var s;return 404===r.getStatus()&&(s=e.path,i=new od(ad.OBJECT_NOT_FOUND,"Object '"+s+"' does not exist.")),i.serverResponse=n.serverResponse,i}}function nh(e,t,r){const n=Object.assign({},r);return n.fullPath=e.path,n.size=t.size(),n.contentType||(n.contentType=function(e,t){return e&&e.contentType||t&&t.type()||"application/octet-stream"}(null,t)),n}function ih(e,t,r,n,i){const s=t.bucketOnlyServerUrl(),o={"X-Goog-Upload-Protocol":"multipart"};const a=function(){let e="";for(let t=0;t<2;t++)e+=Math.random().toString().slice(2);return e}();o["Content-Type"]="multipart/related; boundary="+a;const l=nh(t,n,i),c="--"+a+"\r\nContent-Type: application/json; charset=utf-8\r\n\r\n"+Xd(l,r)+"\r\n--"+a+"\r\nContent-Type: "+l.contentType+"\r\n\r\n",u="\r\n--"+a+"--",d=Ud.getBlob(c,n,u);if(null===d)throw pd();const h={name:l.fullPath},p=Sd(s,e.host,e._protocol),m=e.maxUploadRetryTime,f=new Jd(p,"POST",$d(e,r),m);return f.urlParams=h,f.headers=o,f.body=d.uploadData(),f.errorHandler=th(t),f}class sh{constructor(){this.sent_=!1,this.xhr_=new XMLHttpRequest,this.initXhr(),this.errorCode_=ld.NO_ERROR,this.sendPromise_=new Promise(e=>{this.xhr_.addEventListener("abort",()=>{this.errorCode_=ld.ABORT,e()}),this.xhr_.addEventListener("error",()=>{this.errorCode_=ld.NETWORK_ERROR,e()}),this.xhr_.addEventListener("load",()=>{e()})})}send(e,t,r,n,i){if(this.sent_)throw yd("cannot .send() more than once");if(m(e)&&r&&(this.xhr_.withCredentials=!0),this.sent_=!0,this.xhr_.open(t,e,!0),void 0!==i)for(const s in i)i.hasOwnProperty(s)&&this.xhr_.setRequestHeader(s,i[s].toString());return void 0!==n?this.xhr_.send(n):this.xhr_.send(),this.sendPromise_}getErrorCode(){if(!this.sent_)throw yd("cannot .getErrorCode() before sending");return this.errorCode_}getStatus(){if(!this.sent_)throw yd("cannot .getStatus() before sending");try{return this.xhr_.status}catch(e){return-1}}getResponse(){if(!this.sent_)throw yd("cannot .getResponse() before sending");return this.xhr_.response}getErrorText(){if(!this.sent_)throw yd("cannot .getErrorText() before sending");return this.xhr_.statusText}abort(){this.xhr_.abort()}getResponseHeader(e){return this.xhr_.getResponseHeader(e)}addUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.addEventListener("progress",e)}removeUploadProgressListener(e){null!=this.xhr_.upload&&this.xhr_.upload.removeEventListener("progress",e)}}class oh extends sh{initXhr(){this.xhr_.responseType="text"}}function ah(){return new oh}class lh{constructor(e,t){this._service=e,this._location=t instanceof _d?t:_d.makeFromUrl(t,e.host)}toString(){return"gs://"+this._location.bucket+"/"+this._location.path}_newRef(e,t){return new lh(e,t)}get root(){const e=new _d(this._location.bucket,"");return this._newRef(this._service,e)}get bucket(){return this._location.bucket}get fullPath(){return this._location.path}get name(){return qd(this._location.path)}get storage(){return this._service}get parent(){const e=function(e){if(0===e.length)return null;const t=e.lastIndexOf("/");return-1===t?"":e.slice(0,t)}(this._location.path);if(null===e)return null;const t=new _d(this._location.bucket,e);return new lh(this._service,t)}_throwIfRoot(e){if(""===this._location.path)throw function(e){return new od(ad.INVALID_ROOT_OPERATION,"The operation '"+e+"' cannot be performed on a root reference, create a non-root reference using child, such as .child('file.png').")}(e)}}function ch(e,t,r){e._throwIfRoot("uploadBytes");const n=ih(e.storage,e._location,Zd(),new Ud(t,!0),r);return e.storage.makeRequestWithTokens(n,ah).then(t=>({metadata:t,ref:e}))}function uh(e){e._throwIfRoot("getDownloadURL");const t=function(e,t,r){const n=Sd(t.fullServerUrl(),e.host,e._protocol),i=e.maxOperationRetryTime,s=new Jd(n,"GET",eh(e,r),i);return s.errorHandler=rh(t),s}(e.storage,e._location,Zd());return e.storage.makeRequestWithTokens(t,ah).then(e=>{if(null===e)throw new od(ad.NO_DOWNLOAD_URL,"The given file does not have any download URLs.");return e})}function dh(e){e._throwIfRoot("deleteObject");const t=function(e,t){const r=Sd(t.fullServerUrl(),e.host,e._protocol),n=e.maxOperationRetryTime,i=new Jd(r,"DELETE",function(e,t){},n);return i.successCodes=[200,204],i.errorHandler=rh(t),i}(e.storage,e._location);return e.storage.makeRequestWithTokens(t,ah)}function hh(e,t){const r=function(e,t){const r=t.split("/").filter(e=>e.length>0).join("/");return 0===e.length?r:e+"/"+r}(e._location.path,t),n=new _d(e._location.bucket,r);return new lh(e.storage,n)}function ph(e,t){if(e instanceof gh){const r=e;if(null==r._bucket)throw new od(ad.NO_DEFAULT_BUCKET,"No default bucket found. Did you set the '"+sd+"' property when initializing the app?");const n=new lh(r,r._bucket);return null!=t?ph(n,t):n}return void 0!==t?hh(e,t):e}function mh(e,t){if(t&&/^[A-Za-z]+:\/\//.test(t)){if(e instanceof gh)return new lh(e,t);throw md("To use ref(service, url), the first argument must be a Storage instance.")}return ph(e,t)}function fh(e,t){const r=null===t||void 0===t?void 0:t[sd];return null==r?null:_d.makeFromBucketSpec(r,e)}class gh{constructor(e,t,r,n,i){let s=arguments.length>5&&void 0!==arguments[5]&&arguments[5];this.app=e,this._authProvider=t,this._appCheckProvider=r,this._url=n,this._firebaseVersion=i,this._isUsingEmulator=s,this._bucket=null,this._host=id,this._protocol="https",this._appId=null,this._deleted=!1,this._maxOperationRetryTime=12e4,this._maxUploadRetryTime=6e5,this._requests=new Set,this._bucket=null!=n?_d.makeFromBucketSpec(n,this._host):fh(this._host,this.app.options)}get host(){return this._host}set host(e){this._host=e,null!=this._url?this._bucket=_d.makeFromBucketSpec(this._url,e):this._bucket=fh(e,this.app.options)}get maxUploadRetryTime(){return this._maxUploadRetryTime}set maxUploadRetryTime(e){jd("time",0,Number.POSITIVE_INFINITY,e),this._maxUploadRetryTime=e}get maxOperationRetryTime(){return this._maxOperationRetryTime}set maxOperationRetryTime(e){jd("time",0,Number.POSITIVE_INFINITY,e),this._maxOperationRetryTime=e}async _getAuthToken(){if(this._overrideAuthToken)return this._overrideAuthToken;const e=this._authProvider.getImmediate({optional:!0});if(e){const t=await e.getToken();if(null!==t)return t.accessToken}return null}async _getAppCheckToken(){if(Ue(this.app)&&this.app.settings.appCheckToken)return this.app.settings.appCheckToken;const e=this._appCheckProvider.getImmediate({optional:!0});if(e){return(await e.getToken()).token}return null}_delete(){return this._deleted||(this._deleted=!0,this._requests.forEach(e=>e.cancel()),this._requests.clear()),Promise.resolve()}_makeStorageReference(e){return new lh(this,e)}_makeRequest(e,t,r,n){let i=!(arguments.length>4&&void 0!==arguments[4])||arguments[4];if(this._deleted)return new vd(fd());{const s=function(e,t,r,n,i,s){let o=!(arguments.length>6&&void 0!==arguments[6])||arguments[6],a=arguments.length>7&&void 0!==arguments[7]&&arguments[7];const l=Td(e.urlParams),c=e.url+l,u=Object.assign({},e.headers);return function(e,t){t&&(e["X-Firebase-GMPID"]=t)}(u,t),function(e,t){null!==t&&t.length>0&&(e.Authorization="Firebase "+t)}(u,r),function(e,t){e["X-Firebase-Storage-Version"]="webjs/"+(null!==t&&void 0!==t?t:"AppManager")}(u,s),function(e,t){null!==t&&(e["X-Firebase-AppCheck"]=t)}(u,n),new Ad(c,e.method,u,e.body,e.successCodes,e.additionalRetryCodes,e.handler,e.errorHandler,e.timeout,e.progressCallback,i,o,a)}(e,this._appId,r,n,t,this._firebaseVersion,i,this._isUsingEmulator);return this._requests.add(s),s.getPromise().then(()=>this._requests.delete(s),()=>this._requests.delete(s)),s}}async makeRequestWithTokens(e,t){const[r,n]=await Promise.all([this._getAuthToken(),this._getAppCheckToken()]);return this._makeRequest(e,t,r,n).getPromise()}}const yh="@firebase/storage",_h="0.14.0",vh="storage";function xh(e,t,r){return ch(e=E(e),t,r)}function bh(e){return uh(e=E(e))}function wh(e,t){return mh(e=E(e),t)}function jh(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge(),t=arguments.length>1?arguments[1]:void 0;e=E(e);const r=Be(e,vh).getImmediate({identifier:t}),n=d("storage");return n&&function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};!function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};e.host="".concat(t,":").concat(r);const i=m(t);i&&(f("https://".concat(e.host,"/b")),v("Storage",!0)),e._isUsingEmulator=!0,e._protocol=i?"https":"http";const{mockUserToken:s}=n;s&&(e._overrideAuthToken="string"===typeof s?s:g(s,e.app.options.projectId))}(e,t,r,n)}(r,...n),r}function Sh(e,t){let{instanceIdentifier:r}=t;const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("app-check-internal");return new gh(n,i,s,r,We)}ze(new N(vh,Sh,"PUBLIC").setMultipleInstances(!0)),Ze(yh,_h,""),Ze(yh,_h,"esm2020");function Th(e,t){const r={};for(const n in e)e.hasOwnProperty(n)&&(r[n]=t(e[n]));return r}function kh(e){if(null==e)return null;if(e instanceof Number&&(e=e.valueOf()),"number"===typeof e&&isFinite(e))return e;if(!0===e||!1===e)return e;if("[object String]"===Object.prototype.toString.call(e))return e;if(e instanceof Date)return e.toISOString();if(Array.isArray(e))return e.map(e=>kh(e));if("function"===typeof e||"object"===typeof e)return Th(e,e=>kh(e));throw new Error("Data cannot be encoded in JSON: "+e)}function Ah(e){if(null==e)return e;if(e["@type"])switch(e["@type"]){case"type.googleapis.com/google.protobuf.Int64Value":case"type.googleapis.com/google.protobuf.UInt64Value":{const t=Number(e.value);if(isNaN(t))throw new Error("Data cannot be decoded from JSON: "+e);return t}default:throw new Error("Data cannot be decoded from JSON: "+e)}return Array.isArray(e)?e.map(e=>Ah(e)):"function"===typeof e||"object"===typeof e?Th(e,e=>Ah(e)):e}const Ch="functions",Eh={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"};class Nh extends S{constructor(e,t,r){super("".concat(Ch,"/").concat(e),t||""),this.details=r,Object.setPrototypeOf(this,Nh.prototype)}}function Ih(e,t){let r,n=function(e){if(e>=200&&e<300)return"ok";switch(e){case 0:case 500:return"internal";case 400:return"invalid-argument";case 401:return"unauthenticated";case 403:return"permission-denied";case 404:return"not-found";case 409:return"aborted";case 429:return"resource-exhausted";case 499:return"cancelled";case 501:return"unimplemented";case 503:return"unavailable";case 504:return"deadline-exceeded"}return"unknown"}(e),i=n;try{const e=t&&t.error;if(e){const t=e.status;if("string"===typeof t){if(!Eh[t])return new Nh("internal","internal");n=Eh[t],i=t}const s=e.message;"string"===typeof s&&(i=s),r=e.details,void 0!==r&&(r=Ah(r))}}catch(s){}return"ok"===n?null:new Nh(n,i,r)}class Ph{constructor(e,t,r,n){this.app=e,this.auth=null,this.messaging=null,this.appCheck=null,this.serverAppAppCheckToken=null,Ue(e)&&e.settings.appCheckToken&&(this.serverAppAppCheckToken=e.settings.appCheckToken),this.auth=t.getImmediate({optional:!0}),this.messaging=r.getImmediate({optional:!0}),this.auth||t.get().then(e=>this.auth=e,()=>{}),this.messaging||r.get().then(e=>this.messaging=e,()=>{}),this.appCheck||null===n||void 0===n||n.get().then(e=>this.appCheck=e,()=>{})}async getAuthToken(){if(this.auth)try{const e=await this.auth.getToken();return null===e||void 0===e?void 0:e.accessToken}catch(e){return}}async getMessagingToken(){if(this.messaging&&"Notification"in self&&"granted"===Notification.permission)try{return await this.messaging.getToken()}catch(e){return}}async getAppCheckToken(e){if(this.serverAppAppCheckToken)return this.serverAppAppCheckToken;if(this.appCheck){const t=e?await this.appCheck.getLimitedUseToken():await this.appCheck.getToken();return t.error?null:t.token}return null}async getContext(e){return{authToken:await this.getAuthToken(),messagingToken:await this.getMessagingToken(),appCheckToken:await this.getAppCheckToken(e)}}}const Mh="us-central1",Lh=/^data: (.*?)(?:\n|$)/;class Rh{constructor(e,t,r,n){let i=arguments.length>4&&void 0!==arguments[4]?arguments[4]:Mh,s=arguments.length>5&&void 0!==arguments[5]?arguments[5]:function(){return fetch(...arguments)};this.app=e,this.fetchImpl=s,this.emulatorOrigin=null,this.contextProvider=new Ph(e,t,r,n),this.cancelAllRequests=new Promise(e=>{this.deleteService=()=>Promise.resolve(e())});try{const e=new URL(i);this.customDomain=e.origin+("/"===e.pathname?"":e.pathname),this.region=Mh}catch(o){this.customDomain=null,this.region=i}}_delete(){return this.deleteService()}_url(e){const t=this.app.options.projectId;if(null!==this.emulatorOrigin){const r=this.emulatorOrigin;return"".concat(r,"/").concat(t,"/").concat(this.region,"/").concat(e)}return null!==this.customDomain?"".concat(this.customDomain,"/").concat(e):"https://".concat(this.region,"-").concat(t,".cloudfunctions.net/").concat(e)}}function Dh(e,t,r){const n=n=>function(e,t,r,n){const i=e._url(t);return Bh(e,i,r,n)}(e,t,n,r||{});return n.stream=(r,n)=>function(e,t,r,n){const i=e._url(t);return Uh(e,i,r,n||{})}(e,t,r,n),n}function Fh(e){return e.emulatorOrigin&&m(e.emulatorOrigin)?"include":void 0}async function Oh(e,t,r,n,i){let s;r["Content-Type"]="application/json";try{s=await n(e,{method:"POST",body:JSON.stringify(t),headers:r,credentials:Fh(i)})}catch(a){return{status:0,json:null}}let o=null;try{o=await s.json()}catch(a){}return{status:s.status,json:o}}async function zh(e,t){const r={},n=await e.contextProvider.getContext(t.limitedUseAppCheckTokens);return n.authToken&&(r.Authorization="Bearer "+n.authToken),n.messagingToken&&(r["Firebase-Instance-ID-Token"]=n.messagingToken),null!==n.appCheckToken&&(r["X-Firebase-AppCheck"]=n.appCheckToken),r}async function Bh(e,t,r,n){const i={data:r=kh(r)},s=await zh(e,n),o=function(e){let t=null;return{promise:new Promise((r,n)=>{t=setTimeout(()=>{n(new Nh("deadline-exceeded","deadline-exceeded"))},e)}),cancel:()=>{t&&clearTimeout(t)}}}(n.timeout||7e4),a=await Promise.race([Oh(t,i,s,e.fetchImpl,e),o.promise,e.cancelAllRequests]);if(o.cancel(),!a)throw new Nh("cancelled","Firebase Functions instance was deleted.");const l=Ih(a.status,a.json);if(l)throw l;if(!a.json)throw new Nh("internal","Response is not valid JSON object.");let c=a.json.data;if("undefined"===typeof c&&(c=a.json.result),"undefined"===typeof c)throw new Nh("internal","Response is missing data field.");return{data:Ah(c)}}async function Uh(e,t,r,n){var i;const s={data:r=kh(r)},o=await zh(e,n);let a,l,c;o["Content-Type"]="application/json",o.Accept="text/event-stream";try{a=await e.fetchImpl(t,{method:"POST",body:JSON.stringify(s),headers:o,signal:null===n||void 0===n?void 0:n.signal,credentials:Fh(e)})}catch(h){if(h instanceof Error&&"AbortError"===h.name){const e=new Nh("cancelled","Request was cancelled.");return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}const e=Ih(0,null);return{data:Promise.reject(e),stream:{[Symbol.asyncIterator]:()=>({next:()=>Promise.reject(e)})}}}const u=new Promise((e,t)=>{l=e,c=t});null===n||void 0===n||null===(i=n.signal)||void 0===i||i.addEventListener("abort",()=>{const e=new Nh("cancelled","Request was cancelled.");c(e)});const d=function(e,t,r,n){const i=(e,n)=>{const i=e.match(Lh);if(!i)return;const s=i[1];try{const e=JSON.parse(s);if("result"in e)return void t(Ah(e.result));if("message"in e)return void n.enqueue(Ah(e.message));if("error"in e){const t=Ih(0,e);return n.error(t),void r(t)}}catch(o){if(o instanceof Nh)return n.error(o),void r(o)}},s=new TextDecoder;return new ReadableStream({start(t){let o="";return a();async function a(){if(null!==n&&void 0!==n&&n.aborted){const e=new Nh("cancelled","Request was cancelled");return t.error(e),r(e),Promise.resolve()}try{const{value:l,done:c}=await e.read();if(c)return o.trim()&&i(o.trim(),t),void t.close();if(null!==n&&void 0!==n&&n.aborted){const n=new Nh("cancelled","Request was cancelled");return t.error(n),r(n),void await e.cancel()}o+=s.decode(l,{stream:!0});const u=o.split("\n");o=u.pop()||"";for(const e of u)e.trim()&&i(e.trim(),t);return a()}catch(l){const e=l instanceof Nh?l:Ih(0,null);t.error(e),r(e)}}},cancel:()=>e.cancel()})}(a.body.getReader(),l,c,null===n||void 0===n?void 0:n.signal);return{stream:{[Symbol.asyncIterator](){const e=d.getReader();return{async next(){const{value:t,done:r}=await e.read();return{value:t,done:r}},return:async()=>(await e.cancel(),{done:!0,value:void 0})}}},data:u}}const Vh="@firebase/functions",qh="0.13.1";function Wh(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:Ge(),t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Mh;const r=Be(E(e),Ch).getImmediate({identifier:t}),n=d("functions");return n&&function(e,t,r){!function(e,t,r){const n=m(t);e.emulatorOrigin="http".concat(n?"s":"","://").concat(t,":").concat(r),n&&(f(e.emulatorOrigin+"/backends"),v("Functions",!0))}(E(e),t,r)}(r,...n),r}!function(e){ze(new N(Ch,(e,t)=>{let{instanceIdentifier:r}=t;const n=e.getProvider("app").getImmediate(),i=e.getProvider("auth-internal"),s=e.getProvider("messaging-internal"),o=e.getProvider("app-check-internal");return new Rh(n,i,s,o,r)},"PUBLIC").setMultipleInstances(!0)),Ze(Vh,qh,e),Ze(Vh,qh,"esm2020")}();const Hh={apiKey:"AIzaSyBjD9KHuVjUNSvPpa6y-pElD7lIElCiXmE",authDomain:"my-chat-box-ec5b0.firebaseapp.com",projectId:"my-chat-box-ec5b0",storageBucket:"my-chat-box-ec5b0.firebasestorage.app",messagingSenderId:"387721645160",appId:"1:387721645160:web:64f6ec464447b49ea6bfdd",measurementId:"G-CLCBRJYNMN"};let Gh=null,Zh=null,Kh=null,Yh=null;const Xh=async()=>{try{return Zh&&Kh?(console.log("\u2705 Firebase already initialized"),{app:Gh,db:Zh,storage:Kh}):(Gh||(console.log("\ud83d\udd25 Initializing Firebase app..."),Gh=He(Hh),console.log("\u2705 Firebase app initialized")),Zh||(console.log("\ud83d\udd25 Initializing Firestore..."),Zh=tu(Gh),console.log("\u2705 Firestore initialized")),Kh||(console.log("\ud83d\udd25 Initializing Firebase Storage..."),Kh=jh(Gh),console.log("\u2705 Firebase Storage initialized")),Yh||(console.log("\ud83d\udd25 Initializing Firebase Functions..."),Yh=Wh(Gh),console.log("\u2705 Firebase Functions initialized")),{app:Gh,db:Zh,storage:Kh,functions:Yh})}catch(e){throw console.error("\u274c Firebase initialization error:",e),new Error("Failed to initialize Firebase: ".concat(e.message))}},Jh=(e,t,r)=>{const n=String(e),i=String(t),[s,o]=n<i?[n,i]:[i,n];return"".concat(s,"_").concat(o,"_").concat(r)},Qh=async(e,t,r,n)=>{const{db:i}=await Xh(),s=Jh(e,t,n),o=Yc(i,"chats",s);if((await Ju(o)).exists())return await $u(o,{updatedAt:nd()}),s;const a=String(e),l=String(t),[c,u]=a<l?[a,l]:[l,a];return await function(e,t,r){e=or(e,Gc);const n=or(e.firestore,eu),i=Hu(e.converter,t,r);return td(n,[gu(fu(n),"setDoc",e._key,i,null!==e.converter,r).toMutation(e._key,ws.none())])}(o,{buyerId:a,receiverId:l,receiverRole:r,propertyId:String(n),participants:[c,u],lastMessage:"",readStatus:{[a]:"new",[l]:"new"},readBy:{},lastReadAt:{},createdAt:nd(),updatedAt:nd()}),s},$h=async(e,t,r,n)=>{if(!e||!t||!r||!n||!n.trim())throw new Error("Missing required parameters for sendMessage");try{const{db:i}=await Xh(),s=Yc(i,"chats",e),o=await Ju(s);if(!o.exists())throw new Error("Chat room does not exist");const a=Kc(s,"messages");await function(e,t){const r=or(e.firestore,eu),n=Yc(e),i=Hu(e.converter,t);return td(r,[gu(fu(e.firestore),"addDoc",n._key,i,null!==e.converter,{}).toMutation(n._key,ws.exists(!1))]).then(()=>n)}(a,{senderId:String(t),senderRole:r,text:n.trim(),timestamp:nd()});const l=o.data(),c=String(t)===l.buyerId?l.receiverId:l.buyerId;await $u(s,{lastMessage:n.trim(),updatedAt:nd(),["readStatus.".concat(c)]:"new"})}catch(i){throw console.error("Error sending message:",i),i}},ep=(e,t)=>{if(!e)return console.error("listenToMessages: chatRoomId is required"),t([],new Error("chatRoomId is required")),()=>{};let r=()=>{},i=!0;return Xh().then(s=>{let{db:o}=s;if(!i)return;const a=Fu(Kc(Yc(o,"chats",e),"messages"),function(e){const t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"asc",r=Mu("orderBy",e);return Bu._create(r,t)}("timestamp","asc"));r=ed(a,e=>{if(i)try{const r=e.docs.map(e=>{const t=e.data();let r=new Date;return t.timestamp&&(t.timestamp.toDate&&"function"===typeof t.timestamp.toDate?r=t.timestamp.toDate():t.timestamp instanceof Date?r=t.timestamp:"string"!==typeof t.timestamp&&"number"!==typeof t.timestamp||(r=new Date(t.timestamp))),(0,n.A)((0,n.A)({id:e.id},t),{},{timestamp:r})});t(r,null)}catch(r){console.error("Error processing messages:",r),t([],r)}},e=>{i&&(console.error("Firebase listener error:",e),t([],e))})}).catch(e=>{i&&(console.error("Firebase initialization error:",e),t([],e))}),()=>{i=!1,r&&"function"===typeof r&&r()}},tp=async e=>{const{db:t}=await Xh(),r=Fu(Kc(t,"chats"),function(e,t,r){const n=t,i=Mu("where",e);return Ou._create(i,n,r)}("participants","array-contains",String(e))),i=(await function(e){e=or(e,Hc);const t=or(e.firestore,eu),r=ru(t),n=new Qu(t);return Lu(e._query),Oc(r,e._query).then(r=>new Yu(t,n,e,r))}(r)).docs.map(e=>{var t,r;return(0,n.A)((0,n.A)({id:e.id},e.data()),{},{updatedAt:(null===(t=e.data().updatedAt)||void 0===t||null===(r=t.toDate)||void 0===r?void 0:r.call(t))||new Date(0)})});return i.sort((e,t)=>t.updatedAt-e.updatedAt),i},rp=async(e,t)=>{const{db:r}=await Xh();await $u(Yc(r,"chats",e),{["readStatus.".concat(t)]:"read",["readBy.".concat(t)]:nd(),["lastReadAt.".concat(t)]:nd(),updatedAt:nd()})},np=async(e,t)=>{const{db:r}=await Xh(),n=Yc(r,"chats",e),i=await Ju(n);if(!i.exists())return{status:null};return{status:(i.data().readStatus||{})[t]||null}},ip=async(e,t,r)=>{const{db:n}=await Xh();await $u(Yc(n,"chats",e),{["readStatus.".concat(t)]:r,["readBy.".concat(t)]:nd(),["lastReadAt.".concat(t)]:nd(),updatedAt:nd()})},sp=async e=>{const{db:t}=await Xh(),r=await Ju(Yc(t,"chats",e));return r.exists()?(0,n.A)({id:r.id},r.data()):null},op=async function(e,t){let r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;try{console.log("\ud83d\udd25 Firebase Upload: Starting upload...",{fileName:e.name,fileSize:e.size,fileType:e.type,userId:t,propertyId:r});const{storage:n}=await Xh();if(!n)throw new Error("Firebase Storage not initialized");console.log("\u2705 Firebase Storage initialized");const i=Date.now(),s=Math.random().toString(36).substring(2,15),o=e.name.split(".").pop()||"jpg",a="img_".concat(i,"_").concat(s,".").concat(o);let l;l=r?"properties/".concat(r,"/").concat(a):"properties/temp/".concat(t,"/").concat(a),console.log("\ud83d\udd25 Firebase Upload: Storage path:",l);const c=wh(n,l);console.log("\u2705 Firebase Storage reference created"),console.log("\ud83d\udd25 Firebase Upload: Uploading file to Firebase...");const u=await xh(c,e);console.log("\u2705 Firebase Upload: File uploaded successfully",{bytesTransferred:u.metadata.size,contentType:u.metadata.contentType}),console.log("\ud83d\udd25 Firebase Upload: Getting download URL...");const d=await bh(u.ref);return console.log("\u2705 Firebase Upload: Download URL obtained:",d),{url:d,path:l,fileName:a}}catch(n){if(console.error("\u274c Firebase Upload Error:",{message:n.message,code:n.code,stack:n.stack,fileName:null===e||void 0===e?void 0:e.name,userId:t,propertyId:r}),"storage/unauthorized"===n.code)throw new Error("Firebase Storage: Permission denied. Check Storage rules.");if("storage/quota-exceeded"===n.code)throw new Error("Firebase Storage: Quota exceeded. Check Firebase billing.");if("storage/unauthenticated"===n.code)throw new Error("Firebase Storage: User not authenticated.");if(n.message.includes("network"))throw new Error("Firebase Storage: Network error. Check internet connection.");throw new Error("Failed to upload image to Firebase: ".concat(n.message))}},ap=async function(e,t){try{console.log("\ud83d\udd25 Firebase Profile Upload: Starting upload...",{fileName:e.name,fileSize:e.size,fileType:e.type,userId:t});const{storage:r}=await Xh();if(!r)throw new Error("Firebase Storage not initialized");console.log("\u2705 Firebase Storage initialized for profile image");const n=Date.now(),i=Math.random().toString(36).substring(2,15),s=e.name.split(".").pop()||"jpg",o="profile_".concat(t,"_").concat(n,"_").concat(i,".").concat(s),a="profiles/".concat(t,"/").concat(o);console.log("\ud83d\udd25 Firebase Profile Upload: Storage path:",a);const l=wh(r,a);console.log("\u2705 Firebase Profile Storage reference created"),console.log("\ud83d\udd25 Firebase Profile Upload: Uploading file to Firebase...");const c=await xh(l,e);console.log("\u2705 Firebase Profile Upload: File uploaded successfully",{bytesTransferred:c.metadata.size,contentType:c.metadata.contentType}),console.log("\ud83d\udd25 Firebase Profile Upload: Getting download URL...");const u=await bh(c.ref);return console.log("\u2705 Firebase Profile Upload: Download URL obtained:",u),{url:u,path:a,fileName:o}}catch(r){if(console.error("\u274c Firebase Profile Upload Error:",{message:r.message,code:r.code,stack:r.stack,fileName:null===e||void 0===e?void 0:e.name,userId:t}),"storage/unauthorized"===r.code)throw new Error("Firebase Storage: Permission denied. Check Storage rules.");if("storage/quota-exceeded"===r.code)throw new Error("Firebase Storage: Quota exceeded. Check Firebase billing.");if("storage/unauthenticated"===r.code)throw new Error("Firebase Storage: User not authenticated.");if(r.message.includes("network"))throw new Error("Firebase Storage: Network error. Check internet connection.");throw new Error("Failed to upload profile image to Firebase: ".concat(r.message))}},lp={initializeFirebase:Xh,generateChatRoomId:Jh,createOrGetChatRoom:Qh,sendMessage:$h,listenToMessages:ep,getUserChatRooms:tp,markChatAsRead:rp,getChatRoomDetails:sp,getInquiryReadStatus:np,updateInquiryReadStatus:ip,uploadPropertyImageToFirebase:op,deletePropertyImageFromFirebase:async e=>{try{const{storage:t}=await Xh(),r=wh(t,e);await function(e){return dh(e=E(e))}(r)}catch(t){console.error("Firebase delete error:",t)}},uploadProfileImageToFirebase:ap,callCloudFunction:async(e,t)=>{const{functions:r}=await Xh();var n,i;return(n=e,Dh(E(r),n,i))(t)}}},950(e,t,r){"use strict";!function e(){if("undefined"!==typeof __REACT_DEVTOOLS_GLOBAL_HOOK__&&"function"===typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE)try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(e)}catch(t){console.error(t)}}(),e.exports=r(672)},986(e,t,r){"use strict";function n(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if({}.hasOwnProperty.call(e,n)){if(-1!==t.indexOf(n))continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],-1===t.indexOf(r)&&{}.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}r.d(t,{A:()=>n})},995(e,t,r){"use strict";r.d(t,{A:()=>n});const n=(0,r(784).A)("credit-card",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]])}},t={};function r(n){var i=t[n];if(void 0!==i)return i.exports;var s=t[n]={exports:{}};return e[n].call(s.exports,s,s.exports,r),s.exports}r.m=e,r.n=e=>{var t=e&&e.__esModule?()=>e.default:()=>e;return r.d(t,{a:t}),t},(()=>{var e,t=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;r.t=function(n,i){if(1&i&&(n=this(n)),8&i)return n;if("object"===typeof n&&n){if(4&i&&n.__esModule)return n;if(16&i&&"function"===typeof n.then)return n}var s=Object.create(null);r.r(s);var o={};e=e||[null,t({}),t([]),t(t)];for(var a=2&i&&n;("object"==typeof a||"function"==typeof a)&&!~e.indexOf(a);a=t(a))Object.getOwnPropertyNames(a).forEach(e=>o[e]=()=>n[e]);return o.default=()=>n,r.d(s,o),s}})(),r.d=(e,t)=>{for(var n in t)r.o(t,n)&&!r.o(e,n)&&Object.defineProperty(e,n,{enumerable:!0,get:t[n]})},r.f={},r.e=e=>Promise.all(Object.keys(r.f).reduce((t,n)=>(r.f[n](e,t),t),[])),r.u=e=>"static/js/"+e+"."+{110:"7131be98",211:"cbb354b6",321:"9a59e0bf",352:"3bd633cb",453:"20359781",557:"9acd8978",566:"b5eebba2",676:"e2871c3b",796:"846c53e3"}[e]+".chunk.js",r.miniCssF=e=>"static/css/"+e+"."+{110:"48aa1d96",211:"9042e3a1",321:"f71bbb32",352:"0283a589",557:"1d45cfd0",566:"051cc50d",676:"f7c02766",796:"eb5cfc06"}[e]+".chunk.css",r.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}(),r.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{var e={},t="frontend:";r.l=(n,i,s,o)=>{if(e[n])e[n].push(i);else{var a,l;if(void 0!==s)for(var c=document.getElementsByTagName("script"),u=0;u<c.length;u++){var d=c[u];if(d.getAttribute("src")==n||d.getAttribute("data-webpack")==t+s){a=d;break}}a||(l=!0,(a=document.createElement("script")).charset="utf-8",r.nc&&a.setAttribute("nonce",r.nc),a.setAttribute("data-webpack",t+s),a.src=n),e[n]=[i];var h=(t,r)=>{a.onerror=a.onload=null,clearTimeout(p);var i=e[n];if(delete e[n],a.parentNode&&a.parentNode.removeChild(a),i&&i.forEach(e=>e(r)),t)return t(r)},p=setTimeout(h.bind(null,void 0,{type:"timeout",target:a}),12e4);a.onerror=h.bind(null,a.onerror),a.onload=h.bind(null,a.onload),l&&document.head.appendChild(a)}}})(),r.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.p="/",(()=>{if("undefined"!==typeof document){var e=e=>new Promise((t,n)=>{var i=r.miniCssF(e),s=r.p+i;if(((e,t)=>{for(var r=document.getElementsByTagName("link"),n=0;n<r.length;n++){var i=(o=r[n]).getAttribute("data-href")||o.getAttribute("href");if("stylesheet"===o.rel&&(i===e||i===t))return o}var s=document.getElementsByTagName("style");for(n=0;n<s.length;n++){var o;if((i=(o=s[n]).getAttribute("data-href"))===e||i===t)return o}})(i,s))return t();((e,t,n,i,s)=>{var o=document.createElement("link");o.rel="stylesheet",o.type="text/css",r.nc&&(o.nonce=r.nc),o.onerror=o.onload=r=>{if(o.onerror=o.onload=null,"load"===r.type)i();else{var n=r&&r.type,a=r&&r.target&&r.target.href||t,l=new Error("Loading CSS chunk "+e+" failed.\n("+n+": "+a+")");l.name="ChunkLoadError",l.code="CSS_CHUNK_LOAD_FAILED",l.type=n,l.request=a,o.parentNode&&o.parentNode.removeChild(o),s(l)}},o.href=t,n?n.parentNode.insertBefore(o,n.nextSibling):document.head.appendChild(o)})(e,s,null,t,n)}),t={792:0};r.f.miniCss=(r,n)=>{t[r]?n.push(t[r]):0!==t[r]&&{110:1,211:1,321:1,352:1,557:1,566:1,676:1,796:1}[r]&&n.push(t[r]=e(r).then(()=>{t[r]=0},e=>{throw delete t[r],e}))}}})(),(()=>{var e={792:0};r.f.j=(t,n)=>{var i=r.o(e,t)?e[t]:void 0;if(0!==i)if(i)n.push(i[2]);else{var s=new Promise((r,n)=>i=e[t]=[r,n]);n.push(i[2]=s);var o=r.p+r.u(t),a=new Error;r.l(o,n=>{if(r.o(e,t)&&(0!==(i=e[t])&&(e[t]=void 0),i)){var s=n&&("load"===n.type?"missing":n.type),o=n&&n.target&&n.target.src;a.message="Loading chunk "+t+" failed.\n("+s+": "+o+")",a.name="ChunkLoadError",a.type=s,a.request=o,i[1](a)}},"chunk-"+t,t)}};var t=(t,n)=>{var i,s,[o,a,l]=n,c=0;if(o.some(t=>0!==e[t])){for(i in a)r.o(a,i)&&(r.m[i]=a[i]);if(l)l(r)}for(t&&t(n);c<o.length;c++)s=o[c],r.o(e,s)&&e[s]&&e[s][0](),e[s]=0},n=self.webpackChunkfrontend=self.webpackChunkfrontend||[];n.forEach(t.bind(null,0)),n.push=t.bind(null,n.push.bind(n))})(),(()=>{"use strict";var e=r(43),t=r(391),n=r(685),i=r(376),s=r(579);const o=(0,e.createContext)(),a=t=>{let{children:r}=t;const[n,a]=(0,e.useState)(()=>{try{const e=localStorage.getItem("userData");return e?JSON.parse(e):null}catch(e){return console.error("Error parsing stored user data:",e),null}}),[l,c]=(0,e.useState)(()=>localStorage.getItem("authToken")||null),[u,d]=(0,e.useState)(!0),[h,p]=(0,e.useState)(!1),[m,f]=(0,e.useState)(null),g=(0,e.useCallback)(e=>{a(e),e?localStorage.setItem("userData",JSON.stringify(e)):localStorage.removeItem("userData")},[]),y=(0,e.useCallback)(e=>{c(e),e?localStorage.setItem("authToken",e):localStorage.removeItem("authToken")},[]),_=(0,e.useCallback)(()=>{console.log("\ud83d\udd12 Clearing auth state"),y(null),g(null),p(!1),f(null),i.R2.logout(),localStorage.removeItem("currentSession"),localStorage.removeItem("registeredUser"),console.log("\u2705 Auth state cleared")},[y,g]),v=(0,e.useCallback)(()=>{console.log("\ud83d\udd12 Logging out - clearing all auth data"),_(),console.log("\u2705 Logout complete - all auth data cleared")},[_]),x=(0,e.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0;const t=[1e3,2e3,4e3];try{const e=await i.R2.verifyToken();if(e.success&&e.data){const t=localStorage.getItem("userData"),r=localStorage.getItem("authToken"),n=e.data.user||(t?JSON.parse(t):null),s=e.data.token||r;return g(n),y(s),i.R2.setToken(s),i.R2.setUser(n),p(!0),f(null),console.log("\u2705 Session restored from persistent storage"),{success:!0}}return console.log("\u274c Token verification failed - clearing session"),_(),{success:!1}}catch(r){if(401===r.status)return console.error("\u274c Token verification failed - 401 Unauthorized, clearing session"),_(),{success:!1,error:r};if(0===r.status||!r.status){console.warn("\u26a0\ufe0f Token verification network error, keeping cached session:",r.message);const s=localStorage.getItem("authToken"),o=localStorage.getItem("userData");if(s&&o)try{const e=JSON.parse(o);g(e),y(s),i.R2.setToken(s),i.R2.setUser(e),p(!1),f(r),console.log("\u2705 Restored session from localStorage after network error")}catch(n){console.error("Error parsing stored user data:",n)}if(e<3){const r=t[e];return console.log("\u23f3 Retrying token verification in ".concat(r,"ms (attempt ").concat(e+1,"/").concat(3,")")),await new Promise(e=>setTimeout(e,r)),x(e+1)}return{success:!1,error:r}}return console.error("\u274c Token verification failed with error:",r),_(),{success:!1,error:r}}},[g,y,_]),b=(0,e.useCallback)(async()=>{f(null),d(!0);const e=await x(0);return d(!1),e},[x]);(0,e.useEffect)(()=>{(async()=>{const e=localStorage.getItem("authToken"),t=localStorage.getItem("userData");if(e){console.log("\ud83d\udd04 Verifying token on app load...");(await x(0)).success?console.log("\u2705 Session restored successfully"):console.log("\u274c Session could not be restored")}else t&&localStorage.removeItem("userData"),_();d(!1)})()},[]);const w=!(!n||!l);return(0,s.jsx)(o.Provider,{value:{user:n,token:l,loading:u,isVerified:h,verificationError:m,isAuthenticated:w,login:async(e,t,r)=>{try{console.log("AuthContext login called:",{email:e,userType:r});const n=await i.R2.login(e,t,r);if(console.log("AuthContext login response:",n),n.success&&n.data){const e=n.data.token,t=n.data.user;return e?t?(console.log("\u2705 Setting token and user in persistent storage"),y(e),g(t),p(!0),f(null),i.R2.setToken(e),i.R2.setUser(t),console.log("\u2705 Login successful - session persisted"),{success:!0,user:t,role:t.user_type}):(console.error("\u274c No user data received from login response"),{success:!1,message:"Login failed: No user data received"}):(console.error("\u274c No token received from login response"),{success:!1,message:"Login failed: No token received"})}return console.error("Login response not successful:",n),{success:!1,message:n.message||"Login failed"}}catch(s){var n;console.error("Login error in AuthContext:",s);return{success:!1,message:(null===(n=s.data)||void 0===n?void 0:n.message)||s.message||"Network error. Please check your connection and ensure the backend server is running."}}},logout:v,register:async e=>{try{const t=await i.R2.register(e);if(t.success&&t.data){const e=t.data.token,r=t.data.user;e&&r&&(y(e),g(r),p(!0),f(null),i.R2.setToken(e),i.R2.setUser(r))}return t}catch(r){var t;console.error("Register error in AuthContext:",r);return{success:!1,message:(null===(t=r.data)||void 0===t?void 0:t.message)||r.message||"Registration failed"}}},switchRole:async e=>{try{console.log("AuthContext switchRole called:",{targetRole:e});const t=await i.R2.switchRole(e);if(t.success&&t.data){const e=t.data.token,r=t.data.user;return e?r?(console.log("\u2705 Setting new token and user after role switch"),y(e),g(r),p(!0),f(null),i.R2.setToken(e),i.R2.setUser(r),console.log("\u2705 Role switch successful - session updated"),{success:!0,user:r,role:r.user_type}):(console.error("\u274c No user data received from switch role response"),{success:!1,message:"Role switch failed: No user data received"}):(console.error("\u274c No token received from switch role response"),{success:!1,message:"Role switch failed: No token received"})}return console.error("Switch role response not successful:",t),{success:!1,message:t.message||"Role switch failed"}}catch(r){var t;console.error("Switch role error in AuthContext:",r);return{success:!1,message:(null===(t=r.data)||void 0===t?void 0:t.message)||r.message||"Role switch failed. Please try again."}}},retryVerification:b,setUser:g,setToken:y},children:r})},l=()=>(0,e.useContext)(o),c=()=>{const[t,r]=(0,e.useState)(!1),[i,o]=(0,e.useState)(!1),a=(0,n.zy)();(0,e.useEffect)(()=>{const e=()=>{o(window.scrollY>10)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,e.useEffect)(()=>{r(!1)},[a]);const l=e=>"/"===e?"/"===a.pathname:a.pathname.startsWith(e),c=()=>("/buyer"===a.pathname||"/dashboard"===a.pathname)&&(a.search.includes("type=sale")||""===a.search),u=()=>"/seller"===a.pathname||"/search"===a.pathname,d="/buyer"===a.pathname||"/dashboard"===a.pathname?"buyer":"/seller"===a.pathname||"/search"===a.pathname?"seller":"/agents"===a.pathname?"agent":null,h=d?"/login?role=".concat(d):"/login",p=d?"/register?role=".concat(d):"/register";return(0,s.jsx)("nav",{className:"navbar ".concat(i?"navbar-scrolled":""),children:(0,s.jsxs)("div",{className:"navbar-container",children:[(0,s.jsxs)("div",{className:"navbar-content",children:[(0,s.jsx)(n.N_,{to:"/",className:"navbar-logo",children:(0,s.jsx)("div",{className:"logo-container",children:(0,s.jsx)("img",{src:"/finallogo.png",alt:"India Propertys",className:"logo-image"})})}),(0,s.jsxs)("div",{className:"nav-links-desktop",children:[(0,s.jsx)(n.N_,{to:"/",className:"nav-link ".concat(!l("/")||l("/buyer")||l("/seller")||l("/agents")||l("/contact")||l("/about")?"":"active"),children:(0,s.jsx)("span",{children:"Home"})}),(0,s.jsx)(n.N_,{to:"/buyer",className:"nav-link ".concat(c()?"active":""),children:(0,s.jsx)("span",{children:"Buy/Rent"})}),(0,s.jsx)(n.N_,{to:"/seller",className:"nav-link ".concat(u()?"active":""),children:(0,s.jsx)("span",{children:"Seller/Owner"})}),(0,s.jsx)(n.N_,{to:"/agents",className:"nav-link ".concat(l("/agents")?"active":""),children:(0,s.jsx)("span",{children:"Agent/Builder"})}),(0,s.jsx)(n.N_,{to:"/contact",className:"nav-link ".concat(l("/contact")?"active":""),children:(0,s.jsx)("span",{children:"Contact"})})]}),(0,s.jsxs)("div",{className:"auth-buttons-desktop",children:[(0,s.jsx)(n.N_,{to:h,className:"auth-button auth-button-secondary",children:(0,s.jsx)("span",{children:"Login"})}),(0,s.jsx)(n.N_,{to:p,className:"auth-button auth-button-primary",children:(0,s.jsx)("span",{children:"Register"})})]}),(0,s.jsxs)("button",{onClick:()=>r(!t),className:"mobile-menu-button ".concat(t?"open":""),"aria-label":"Toggle menu",children:[(0,s.jsx)("span",{className:"menu-icon-line"}),(0,s.jsx)("span",{className:"menu-icon-line"}),(0,s.jsx)("span",{className:"menu-icon-line"})]})]}),(0,s.jsx)("div",{className:"mobile-menu ".concat(t?"open":""),children:(0,s.jsxs)("div",{className:"mobile-menu-content",children:[(0,s.jsx)(n.N_,{to:"/",className:"mobile-nav-link ".concat(!l("/")||l("/buyer")||l("/seller")||l("/agents")||l("/contact")||l("/about")?"":"active"),children:(0,s.jsx)("span",{children:"Home"})}),(0,s.jsx)(n.N_,{to:"/buyer",className:"mobile-nav-link ".concat(c()?"active":""),children:(0,s.jsx)("span",{children:"Buy/Rent"})}),(0,s.jsx)(n.N_,{to:"/seller",className:"mobile-nav-link ".concat(u()?"active":""),children:(0,s.jsx)("span",{children:"Sell/Owner"})}),(0,s.jsx)(n.N_,{to:"/agents",className:"mobile-nav-link ".concat(l("/agents")?"active":""),children:(0,s.jsx)("span",{children:"Agents/Builder"})}),(0,s.jsx)(n.N_,{to:"/contact",className:"mobile-nav-link ".concat(l("/contact")?"active":""),children:(0,s.jsx)("span",{children:"Contact"})}),(0,s.jsxs)("div",{className:"mobile-auth-buttons",children:[(0,s.jsx)(n.N_,{to:h,className:"auth-button auth-button-secondary",children:(0,s.jsx)("span",{children:"Login"})}),(0,s.jsx)(n.N_,{to:p,className:"auth-button auth-button-primary",children:(0,s.jsx)("span",{children:"Register"})})]})]})})]})})},u=()=>{const e=(new Date).getFullYear(),t=()=>{window.scrollTo({top:0,behavior:"instant"})};return(0,s.jsxs)("footer",{className:"footer",children:[(0,s.jsx)("div",{className:"footer-wave",children:(0,s.jsx)("svg",{viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:(0,s.jsx)("path",{d:"M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"})})}),(0,s.jsxs)("div",{className:"footer-container",children:[(0,s.jsxs)("div",{className:"footer-main",children:[(0,s.jsxs)("div",{className:"footer-column footer-about",children:[(0,s.jsx)("div",{className:"footer-logo",children:(0,s.jsx)("img",{src:"/logoswhite.png",alt:"India Propertys",className:"footer-logo-image"})}),(0,s.jsx)("p",{className:"footer-description",children:"360Coordinates is a trusted real estate platform dedicated to helping buyers, sellers, and renters connect seamlessly. We provide verified property listings, transparent pricing, and expert support to make real estate transactions simpler, safer, and faster. Whether you're searching for your dream home or the perfect commercial space, we are here to guide you every step of the way."})]}),(0,s.jsxs)("div",{className:"footer-column",children:[(0,s.jsx)("h3",{className:"footer-heading",children:(0,s.jsx)("span",{children:"Quick Links"})}),(0,s.jsxs)("ul",{className:"footer-links",children:[(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/about",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"About Us"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/contact",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"Contact"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/privacy-policy",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"Privacy Policy"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/terms-conditions",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"Terms & Conditions"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/admin/login",className:"admin-link",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"For Admin Only"})]})})]})]}),(0,s.jsxs)("div",{className:"footer-column",children:[(0,s.jsx)("h3",{className:"footer-heading",children:(0,s.jsx)("span",{children:"Contact Info"})}),(0,s.jsxs)("ul",{className:"footer-contact",children:[(0,s.jsx)("li",{children:(0,s.jsxs)("a",{href:"mailto:info@360coordinates.com",style:{textDecoration:"none",color:"inherit",display:"flex",alignItems:"flex-start",gap:"12px"},children:[(0,s.jsx)("div",{className:"contact-icon",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,s.jsxs)("div",{className:"contact-text",children:[(0,s.jsx)("span",{className:"contact-label",children:"Email"}),(0,s.jsx)("span",{className:"contact-value",children:"info@360coordinates.com"})]})]})}),(0,s.jsxs)("li",{children:[(0,s.jsx)("div",{className:"contact-icon",children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,s.jsxs)("div",{className:"contact-text",children:[(0,s.jsx)("span",{className:"contact-label",children:"Address"}),(0,s.jsx)("span",{className:"contact-value",children:"Pune , Maharashtra, India"})]})]})]}),(0,s.jsxs)("div",{className:"footer-social",children:[(0,s.jsx)("a",{href:"https://www.facebook.com/profile.php?id=61585564109339",target:"_blank",rel:"noopener noreferrer",className:"social-link","aria-label":"Facebook",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})}),(0,s.jsx)("a",{href:"https://www.instagram.com/360coordinates_official/",target:"_blank",rel:"noopener noreferrer",className:"social-link","aria-label":"Instagram",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"})})}),(0,s.jsx)("a",{href:"https://www.youtube.com/@360coordinates",target:"_blank",rel:"noopener noreferrer",className:"social-link","aria-label":"YouTube",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})}),(0,s.jsx)("a",{href:"https://www.linkedin.com/company/110655303/admin/dashboard/",target:"_blank",rel:"noopener noreferrer",className:"social-link","aria-label":"LinkedIn",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})})}),(0,s.jsx)("a",{href:"https://x.com/360coordinates",target:"_blank",rel:"noopener noreferrer",className:"social-link","aria-label":"X (Twitter)",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})})]})]})]}),(0,s.jsx)("div",{className:"footer-bottom",children:(0,s.jsx)("div",{className:"footer-bottom-content",children:(0,s.jsxs)("p",{className:"footer-copyright",children:["\xa9 ",e," ",(0,s.jsx)("span",{className:"copyright-brand",children:"360Coordinates"}),". All rights reserved."]})})})]})]})},d=()=>{const[t,r]=(0,e.useState)(!1),[i,o]=(0,e.useState)(!1),a=(0,n.zy)(),c=(0,n.Zp)(),{isAuthenticated:u}=l(),d=(0,e.useRef)(null),h=(0,e.useRef)(null),p=()=>{o(!1),setTimeout(()=>{r(!1)},250),d.current&&(clearTimeout(d.current),d.current=null)};return(0,e.useEffect)(()=>{if((()=>{const e=a.pathname.toLowerCase();return"/login"!==e&&"/register"!==e&&!(e.startsWith("/buyer")||e.startsWith("/seller")||e.startsWith("/agent"))&&!e.includes("/details/")&&!e.includes("/viewdetails")})())return h.current&&clearTimeout(h.current),d.current&&clearTimeout(d.current),h.current=setTimeout(()=>{o(!0),r(!0),d.current=setTimeout(()=>{o(!1),setTimeout(()=>{r(!1)},250)},1e4)},300),()=>{h.current&&(clearTimeout(h.current),h.current=null),d.current&&(clearTimeout(d.current),d.current=null)}},[a.pathname]),t?(0,s.jsx)("div",{className:"promo-trial-popup-overlay ".concat(i?"promo-trial-popup-visible":"promo-trial-popup-hidden"),children:(0,s.jsxs)("div",{className:"promo-trial-popup-container",children:[(0,s.jsx)("button",{className:"promo-trial-popup-close",onClick:p,"aria-label":"Close popup",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),(0,s.jsxs)("div",{className:"promo-trial-popup-content",children:[(0,s.jsx)("div",{className:"promo-trial-popup-icon",children:"\ud83c\udf89"}),(0,s.jsx)("h2",{className:"promo-trial-popup-title",children:"90 Days Free Trial"}),(0,s.jsx)("p",{className:"promo-trial-popup-subtitle",children:"Post your property for free and reach genuine buyers & tenants."}),(0,s.jsxs)("ul",{className:"promo-trial-popup-features",children:[(0,s.jsxs)("li",{className:"promo-trial-popup-feature",children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"20 6 9 17 4 12"})}),(0,s.jsx)("span",{children:"Unlimited listing edits"})]}),(0,s.jsxs)("li",{className:"promo-trial-popup-feature",children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"20 6 9 17 4 12"})}),(0,s.jsx)("span",{children:"Verified buyer leads"})]}),(0,s.jsxs)("li",{className:"promo-trial-popup-feature",children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"20 6 9 17 4 12"})}),(0,s.jsx)("span",{children:"Chat with buyers instantly"})]})]}),(0,s.jsx)("button",{className:"promo-trial-popup-cta",onClick:()=>{c(u?"/post-property":"/register"),p()},children:"Post Property Now"}),(0,s.jsx)("p",{className:"promo-trial-popup-limited",children:"Limited time offer"})]})]})}):null},h=t=>{let{children:r}=t;const i=(0,n.zy)().pathname.toLowerCase();(0,e.useEffect)(()=>{const e=document.querySelector(".navbar");if(!e)return;const t=e=>{e.preventDefault(),window.scrollBy({top:e.deltaY,left:0,behavior:"auto"})};return e.addEventListener("wheel",t,{passive:!1}),()=>e.removeEventListener("wheel",t)},[]);const o="/login"===i||"/register"===i;return(0,s.jsxs)("div",{className:"landing-page",children:[!o&&(0,s.jsx)("div",{className:"navbar-wrapper",children:(0,s.jsx)(c,{})}),(0,s.jsx)("main",{className:"main-content",style:{},children:r}),!o&&(0,s.jsx)(u,{}),(0,s.jsx)(d,{})]})};var p=r(555);const m={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN||"pk.eyJ1Ijoic3VkaGFrYXJwb3VsIiwiYSI6ImNtaXp0ZmFrNTAxaTQzZHNiODNrYndsdTAifQ.YTMezksySLU7ZpcYkvXyqg";const f=[{id:"state-maharashtra",placeName:"Maharashtra",fullAddress:"Maharashtra, India",city:"Maharashtra",state:"Maharashtra",coordinates:{lat:19.7515,lng:75.7139}},{id:"city-mumbai",placeName:"Mumbai",fullAddress:"Mumbai, Maharashtra, India",city:"Mumbai",state:"Maharashtra",coordinates:{lat:19.076,lng:72.8777}},{id:"city-pune",placeName:"Pune",fullAddress:"Pune, Maharashtra, India",city:"Pune",state:"Maharashtra",coordinates:{lat:18.5204,lng:73.8567}},{id:"city-nagpur",placeName:"Nagpur",fullAddress:"Nagpur, Maharashtra, India",city:"Nagpur",state:"Maharashtra",coordinates:{lat:21.1458,lng:79.0882}},{id:"city-thane",placeName:"Thane",fullAddress:"Thane, Maharashtra, India",city:"Thane",state:"Maharashtra",coordinates:{lat:19.2183,lng:72.9781}},{id:"city-navi-mumbai",placeName:"Navi Mumbai",fullAddress:"Navi Mumbai, Maharashtra, India",city:"Navi Mumbai",state:"Maharashtra",coordinates:{lat:19.033,lng:73.0297}},{id:"city-kalyan",placeName:"Kalyan",fullAddress:"Kalyan, Maharashtra, India",city:"Kalyan",state:"Maharashtra",coordinates:{lat:19.2437,lng:73.1355}},{id:"city-nashik",placeName:"Nashik",fullAddress:"Nashik, Maharashtra, India",city:"Nashik",state:"Maharashtra",coordinates:{lat:20.011,lng:73.7903}},{id:"city-aurangabad",placeName:"Aurangabad",fullAddress:"Aurangabad, Maharashtra, India",city:"Aurangabad",state:"Maharashtra",coordinates:{lat:19.8762,lng:75.3433}},{id:"city-kolhapur",placeName:"Kolhapur",fullAddress:"Kolhapur, Maharashtra, India",city:"Kolhapur",state:"Maharashtra",coordinates:{lat:16.7049,lng:74.2433}},{id:"town-mahabaleshwar",placeName:"Mahabaleshwar",fullAddress:"Mahabaleshwar, Maharashtra, India",city:"Mahabaleshwar",state:"Maharashtra",coordinates:{lat:17.925,lng:73.6575}},{id:"town-lonavala",placeName:"Lonavala",fullAddress:"Lonavala, Maharashtra, India",city:"Lonavala",state:"Maharashtra",coordinates:{lat:18.752,lng:73.405}},{id:"town-khandala",placeName:"Khandala",fullAddress:"Khandala, Maharashtra, India",city:"Khandala",state:"Maharashtra",coordinates:{lat:18.758,lng:73.373}},{id:"town-ratnagiri",placeName:"Ratnagiri",fullAddress:"Ratnagiri, Maharashtra, India",city:"Ratnagiri",state:"Maharashtra",coordinates:{lat:16.9902,lng:73.312}},{id:"town-alibag",placeName:"Alibag",fullAddress:"Alibag, Maharashtra, India",city:"Alibag",state:"Maharashtra",coordinates:{lat:18.6411,lng:72.8722}},{id:"town-shirdi",placeName:"Shirdi",fullAddress:"Shirdi, Maharashtra, India",city:"Shirdi",state:"Maharashtra",coordinates:{lat:19.7668,lng:74.4774}},{id:"town-panvel",placeName:"Panvel",fullAddress:"Panvel, Maharashtra, India",city:"Panvel",state:"Maharashtra",coordinates:{lat:18.9886,lng:73.1175}},{id:"town-karjat",placeName:"Karjat",fullAddress:"Karjat, Maharashtra, India",city:"Karjat",state:"Maharashtra",coordinates:{lat:18.9107,lng:73.3236}},{id:"city-delhi",placeName:"Delhi",fullAddress:"Delhi, India",city:"Delhi",state:"Delhi",coordinates:{lat:28.7041,lng:77.1025}},{id:"city-bengaluru",placeName:"Bengaluru",fullAddress:"Bengaluru, Karnataka, India",city:"Bengaluru",state:"Karnataka",coordinates:{lat:12.9716,lng:77.5946}},{id:"city-hyderabad",placeName:"Hyderabad",fullAddress:"Hyderabad, Telangana, India",city:"Hyderabad",state:"Telangana",coordinates:{lat:17.385,lng:78.4867}},{id:"city-ahmedabad",placeName:"Ahmedabad",fullAddress:"Ahmedabad, Gujarat, India",city:"Ahmedabad",state:"Gujarat",coordinates:{lat:23.0225,lng:72.5714}},{id:"city-chennai",placeName:"Chennai",fullAddress:"Chennai, Tamil Nadu, India",city:"Chennai",state:"Tamil Nadu",coordinates:{lat:13.0827,lng:80.2707}},{id:"city-kolkata",placeName:"Kolkata",fullAddress:"Kolkata, West Bengal, India",city:"Kolkata",state:"West Bengal",coordinates:{lat:22.5726,lng:88.3639}},{id:"city-jaipur",placeName:"Jaipur",fullAddress:"Jaipur, Rajasthan, India",city:"Jaipur",state:"Rajasthan",coordinates:{lat:26.9124,lng:75.7873}},{id:"city-surat",placeName:"Surat",fullAddress:"Surat, Gujarat, India",city:"Surat",state:"Gujarat",coordinates:{lat:21.1702,lng:72.8311}}];function g(e){if(!e)return null;const[t,r]=e.center||[],n=e.text||"",i=e.place_name||n;let s="",o="";if((e.context||[]).forEach(e=>{e&&e.id&&(!s&&(e.id.startsWith("place")||e.id.startsWith("locality")||e.id.startsWith("district"))&&(s=e.text||s),!o&&e.id.startsWith("region")&&(o=e.text||o))}),!s&&i){const e=i.split(",").map(e=>e.trim());e.length>=2&&(s=e[1])}return{id:e.id,placeName:n,fullAddress:i,city:s,state:o,coordinates:{lat:"number"===typeof r?r:null,lng:"number"===typeof t?t:null}}}function y(e){if(!e)return[];const t=e.toLowerCase();return f.filter(e=>[e.placeName,e.fullAddress,e.city,e.state].filter(Boolean).some(e=>e.toLowerCase().includes(t)))}const _=t=>{let{placeholder:r="Enter location...",value:n="",onChange:i,onSearch:o,onInputChange:a,className:l="",error:c,disabled:u=!1,dropdownOpen:d,onDropdownOpenChange:h,onInputFocus:p}=t;const[f,_]=(0,e.useState)(n||""),[v,x]=(0,e.useState)([]),[b,w]=(0,e.useState)(!1),j=void 0!==d,S=j?d:b,T=(0,e.useCallback)(e=>{j?null===h||void 0===h||h(e):w(e)},[j,h]),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(-1),[N,I]=(0,e.useState)(null),[P,M]=(0,e.useState)(null),L=(0,e.useRef)(null),R=(0,e.useRef)(null),D=(0,e.useRef)(null),F=(0,e.useRef)(!1),O=(0,e.useRef)(null);(0,e.useEffect)(()=>{const e=n||"";if(_(e),null!==O.current&&e===O.current){O.current=null,F.current=!0,x([]),T(!1);const e=setTimeout(()=>{F.current=!1},400);return()=>clearTimeout(e)}},[n,T]),(0,e.useEffect)(()=>{const e=e=>{L.current&&!L.current.contains(e.target)&&(T(!1),E(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[T]);const z=(0,e.useCallback)(async e=>{if(!m||!e||e.trim().length<2)return x([]),T(!1),void M(null);D.current&&D.current.abort();const t=new AbortController;D.current=t,A(!0);try{if(!m||""===m.trim())throw new Error("Mapbox token is not configured");const r="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json?access_token=").concat(m,"&country=in&limit=30&autocomplete=true");0;const n=await fetch(r,{signal:t.signal});if(!n.ok){const e=await n.text();if(console.error("\u274c Mapbox API error:",{status:n.status,statusText:n.statusText,error:e.substring(0,200)}),401===n.status||403===n.status)throw new Error("Invalid Mapbox token. Please check your configuration.");throw new Error("Failed to fetch locations: ".concat(n.status," ").concat(n.statusText))}const i=await n.json();let s=(i.features||[]).filter(e=>null!=e).map(g).filter(Boolean);s.sort((e,t)=>0),s.length||(s=y(e)),x(s),F.current||(T(s.length>0),E(s.length>0?0:-1)),M(null)}catch(r){if("AbortError"!==r.name){console.error("\u274c Location suggestions error:",r),console.error("Error details:",{message:r.message,name:r.name,hasToken:!!m,tokenLength:m?m.length:0});const t=y(e);x(t),F.current||(T(t.length>0),E(t.length>0?0:-1)),t.length?M(null):r.message&&r.message.includes("token")?M("Mapbox token error. Please check your configuration."):r.message&&r.message.includes("network")||r.message.includes("fetch")?M("Unable to load suggestions. Please check your internet connection."):M("Unable to load suggestions: ".concat(r.message))}}finally{A(!1)}},[T]);(0,e.useEffect)(()=>{if(F.current){const e=setTimeout(()=>{F.current=!1},100);return()=>clearTimeout(e)}if(!f||f.trim().length<2)return x([]),T(!1),void M(null);const e=setTimeout(()=>{F.current||z(f.trim())},300);return()=>clearTimeout(e)},[f,z]);const B=e=>{if(u||!e)return;D.current&&D.current.abort();const t=e.fullAddress||e.placeName||"";O.current=t,F.current=!0,I(e),_(t),T(!1),x([]),E(-1),M(null),setTimeout(()=>{R.current&&R.current.blur()},0),i&&i(e),o&&o(e)};return(0,s.jsxs)("div",{className:"location-autosuggest ".concat(l),ref:L,children:[(0,s.jsxs)("div",{className:"location-input-wrapper ".concat(c?"location-input-error":""),children:[(0,s.jsx)("input",{ref:R,type:"text",value:f,placeholder:r,onChange:e=>{if(u)return;const t=e.target.value;F.current=!1,O.current=null,_(t),I(null),a&&a(t||""),t&&t.trim().length>=2?T(!0):T(!1),!t&&i&&i(null)},onFocus:()=>{null===p||void 0===p||p(),F.current||f&&f.trim().length>=2&&v.length>0&&T(!0)},onKeyDown:e=>{if(!u)if("ArrowDown"===e.key){if(e.preventDefault(),!v.length)return;T(!0),E(e=>{const t=e+1;return t>=v.length?0:t})}else if("ArrowUp"===e.key){if(e.preventDefault(),!v.length)return;T(!0),E(e=>{const t=e-1;return t<0?v.length-1:t})}else if("Enter"===e.key){e.preventDefault(),e.stopPropagation();const t=S,r=v.length>0;if(T(!1),E(-1),t&&r){B(v[C>=0?C:0])}else if(o&&N)o(N);else if(o&&f.trim()){const e={placeName:f.trim(),fullAddress:f.trim(),city:f.trim().split(",")[0].trim(),coordinates:null};I(e),i&&i(e),o(e)}}else"Escape"===e.key&&(e.preventDefault(),T(!1),E(-1))},className:"location-input",autoComplete:"off",disabled:u,readOnly:u}),k&&(0,s.jsx)("span",{className:"location-spinner","aria-label":"Loading"}),!k&&f&&!u&&(0,s.jsx)("button",{type:"button",className:"location-clear-btn",onClick:()=>{u||(F.current=!1,O.current=null,_(""),x([]),T(!1),E(-1),I(null),M(null),i&&i(null))},"aria-label":"Clear location",children:"\xd7"})]}),c&&(0,s.jsx)("div",{className:"location-error-text",children:c}),P&&!c&&(0,s.jsx)("div",{className:"location-error-text",children:P}),S&&v.length>0&&!u&&(0,s.jsx)("ul",{className:"location-dropdown",role:"listbox",children:v.map((e,t)=>(0,s.jsxs)("li",{className:"location-option ".concat(t===C?"active":""),onMouseDown:t=>{t.preventDefault(),B(e)},onMouseEnter:()=>E(t),role:"option","aria-selected":t===C,children:[(0,s.jsx)("div",{className:"location-option-primary",children:e.placeName}),(0,s.jsx)("div",{className:"location-option-secondary",children:e.fullAddress})]},e.id||"".concat(e.placeName,"-").concat(t)))})]})},v=t=>{let{heroImage:r=null}=t;const i=(0,n.Zp)(),o=null!=r?r.startsWith("http")?r:"".concat("").concat(r):null,[a,l]=(0,e.useState)({location:"",propertyType:"",budget:"",bedrooms:"",area:""}),c=["Apartment","Studio Apartment","Villa / Row House / Bungalow / Farm House","Row House","Penthouse","PG / Hostel"],u=["Plot / Land / Industrial Property","Commercial Office","Commercial Shop","Co-working Space","Warehouse / Godown"],d=["0-5K","5K-10K","10K-20K","20K-30K","30K-50K","50K-75K","75K-1L","1L-2L","2L+"],h=["0-25L","25L-50L","50L-75L","75L-1Cr","1Cr-2Cr","2Cr-5Cr","5Cr+"],m=["0-50L","50L-1Cr","1Cr-2Cr","2Cr-5Cr","5Cr-10Cr","10Cr-25Cr","25Cr+"],f=["0-10K","10K-25K","25K-50K","50K-1L","1L-2L","2L-5L","5L+"],g=(0,e.useMemo)(()=>c.includes(a.propertyType),[a.propertyType]),y=(0,e.useMemo)(()=>u.includes(a.propertyType),[a.propertyType]),v=(0,e.useMemo)(()=>a.propertyType&&{Apartment:h,"Studio Apartment":h,"Villa / Row House / Bungalow / Farm House":h,"Row House":h,Penthouse:h,"PG / Hostel":d,"Plot / Land / Industrial Property":m,"Commercial Office":m,"Commercial Shop":m,"Co-working Space":f,"Warehouse / Godown":f}[a.propertyType]||h,[a.propertyType]),x=e=>{const{name:t,value:r}=e.target;l("propertyType"===t?e=>(0,p.A)((0,p.A)({},e),{},{[t]:r,bedrooms:"",area:"",budget:""}):e=>(0,p.A)((0,p.A)({},e),{},{[t]:r}))};return(0,s.jsx)(s.Fragment,{children:(0,s.jsxs)("div",{className:"landing-search-bar-hero",children:[o&&(0,s.jsx)("img",{src:o,alt:"",className:"landing-search-bar-bg-image"}),(0,s.jsx)("div",{className:"landing-search-bar-container",children:(0,s.jsxs)("div",{className:"landing-search-bar-wrapper",children:[(0,s.jsx)("h2",{className:"search-title",children:"Find Your Dream Property"}),(0,s.jsx)("p",{className:"search-subtitle",children:"Search from thousands of verified properties across India"}),(0,s.jsxs)("div",{className:"landing-auth-buttons",children:[(0,s.jsx)("button",{type:"button",className:"landing-auth-btn landing-login-btn",onClick:()=>i("/login"),children:"Login"}),(0,s.jsx)("button",{type:"button",className:"landing-auth-btn landing-signup-btn",onClick:()=>i("/register"),children:"Sign Up"})]}),(0,s.jsxs)("form",{className:"search-form",onSubmit:e=>{e.preventDefault();const t=new URLSearchParams;a.location&&t.set("location",a.location),a.propertyType&&t.set("property_type",a.propertyType),a.budget&&t.set("budget",a.budget),a.bedrooms&&t.set("bedrooms",a.bedrooms),a.area&&t.set("area",a.area),i("/searchresults?".concat(t.toString()))},children:[(0,s.jsxs)("div",{className:"search-inputs",children:[(0,s.jsxs)("div",{className:"search-field",children:[(0,s.jsxs)("label",{htmlFor:"location",className:"search-label",children:[(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Location"]}),(0,s.jsx)(_,{placeholder:"City / Locality",value:a.location,onChange:e=>{l(e?t=>(0,p.A)((0,p.A)({},t),{},{location:e.fullAddress||e.placeName||""}):e=>(0,p.A)((0,p.A)({},e),{},{location:""}))}})]}),(0,s.jsxs)("div",{className:"search-field",children:[(0,s.jsxs)("label",{htmlFor:"propertyType",className:"search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Property Type"]}),(0,s.jsxs)("select",{id:"propertyType",name:"propertyType",value:a.propertyType,onChange:x,className:"search-select",children:[(0,s.jsx)("option",{value:"",children:"All Types"}),["Apartment","Studio Apartment","Villa / Row House / Bungalow / Farm House","Row House","Penthouse","Plot / Land / Industrial Property","Commercial Office","Commercial Shop","Co-working Space","Warehouse / Godown","PG / Hostel"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"search-field",children:[(0,s.jsxs)("label",{htmlFor:"budget",className:"search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Budget"]}),(0,s.jsxs)("select",{id:"budget",name:"budget",value:a.budget,onChange:x,className:"search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Budget"}),v.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsx)("div",{className:"search-field",children:g?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{htmlFor:"bedrooms",className:"search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Bedrooms"]}),(0,s.jsxs)("select",{id:"bedrooms",name:"bedrooms",value:a.bedrooms,onChange:x,className:"search-select",children:[(0,s.jsx)("option",{value:"",children:"Any"}),["1 BHK","2 BHK","3 BHK","4 BHK","5+ BHK"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}):y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{htmlFor:"area",className:"search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),"Area"]}),(0,s.jsxs)("select",{id:"area",name:"area",value:a.area,onChange:x,className:"search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Area"}),["0-500 sq ft","500-1000 sq ft","1000-2000 sq ft","2000-5000 sq ft","5000-10000 sq ft","10000+ sq ft"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{htmlFor:"bedrooms",className:"search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Bedroom / Area"]}),(0,s.jsx)("select",{id:"bedrooms",name:"bedrooms",value:a.bedrooms,onChange:x,className:"search-select",disabled:!0,children:(0,s.jsx)("option",{value:"",children:"Select Property Type"})})]})})]}),(0,s.jsxs)("button",{type:"submit",className:"search-button",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("span",{children:"Search Properties"})]})]})]})})]})})},x=[{name:"Mumbai",image:"/city-projects/Mumbai.jpg"},{name:"Delhi",image:"/city-projects/Delhi.jpg"},{name:"Bangalore",image:"/city-projects/Banglore.jpg"},{name:"Hyderabad",image:"/city-projects/Hydrabad.jpg"},{name:"Chennai",image:"/city-projects/Chennai.jpg"},{name:"Pune",image:"/city-projects/Pune.jpg"},{name:"Kolkata",image:"/city-projects/Kolkata.jpg"},{name:"Ahmedabad",image:"/city-projects/Ahmedabad.jpg"}],b=()=>{const e=(0,n.Zp)();return(0,s.jsxs)("div",{className:"landing-quick-search-container",children:[(0,s.jsx)("div",{className:"landing-quick-search-header",children:(0,s.jsx)("h2",{className:"landing-quick-search-title",children:"Popular Cities:"})}),(0,s.jsx)("div",{className:"landing-quick-search-grid",children:x.map(t=>(0,s.jsxs)("div",{className:"landing-quick-search-card",onClick:()=>(t=>{const r=new URLSearchParams;r.set("location",t),e("/searchresults?".concat(r.toString()))})(t.name),style:{backgroundImage:"url(".concat(t.image,")")},children:[(0,s.jsx)("div",{className:"landing-quick-search-overlay"}),(0,s.jsxs)("div",{className:"landing-quick-search-content",children:[(0,s.jsx)("h3",{className:"landing-quick-search-name",children:t.name}),(0,s.jsx)("p",{className:"landing-quick-search-subtitle",children:"Explore Projects"}),(0,s.jsx)("div",{className:"landing-quick-search-arrow",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M5 12h14"}),(0,s.jsx)("path",{d:"m12 5 7 7-7 7"})]})})]})]},t.name))})]})},w={getFavorites:()=>{try{const e=localStorage.getItem("propertyFavorites");return e?JSON.parse(e):[]}catch(e){return console.error("Error reading favorites:",e),[]}},saveFavorites:e=>{try{localStorage.setItem("propertyFavorites",JSON.stringify(e))}catch(t){console.error("Error saving favorites:",t)}},toggleFavorite:e=>{const t=w.getFavorites(),r=t.indexOf(e);return r>-1?t.splice(r,1):t.push(e),w.saveFavorites(t),t},isFavorite:e=>w.getFavorites().includes(e),getFavoriteProperties:e=>{const t=w.getFavorites();return(e||[]).filter(e=>t.includes(e.id))}},j={getHistory:async()=>{try{const t=JSON.parse(localStorage.getItem("userData")||"null");if(t&&"buyer"===t.user_type)try{const{historyAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.list();if(t.success&&t.data&&t.data.history){const e=t.data.history.map(e=>{const t=e.viewed_at||e.viewedAt;return t||console.warn("History entry missing created_at timestamp:",e),{propertyId:e.propertyId||e.id,propertyTitle:e.propertyTitle||e.title,ownerName:e.ownerName||e.seller_name||"Property Owner",ownerContactNumber:e.ownerContactNumber||e.seller_phone||"",ownerEmail:e.ownerEmail||e.seller_email||"",actionType:e.actionType||e.action_type||"viewed_owner_details",created_at:t,viewedAt:t}});return j.saveHistory(e),e}}catch(e){console.warn("Failed to load history from backend, using localStorage:",e)}const n=localStorage.getItem("propertyViewHistory");return(n?JSON.parse(n):[]).map(e=>(0,p.A)((0,p.A)({},e),{},{created_at:e.created_at||e.viewedAt||null}))}catch(e){return console.error("Error reading property history:",e),[]}},saveHistory:e=>{try{localStorage.setItem("propertyViewHistory",JSON.stringify(e))}catch(t){console.error("Error saving property history:",t)}},addToHistory:async e=>{const{propertyId:t,propertyTitle:n,ownerName:i,ownerContactNumber:s,ownerEmail:o,actionType:a="viewed_owner_details"}=e,l=JSON.parse(localStorage.getItem("userData")||"null");if(l&&"buyer"===l.user_type)try{const{historyAPI:e}=await Promise.resolve().then(r.bind(r,376));return await e.add(t,a),await j.getHistory()}catch(h){console.warn("Failed to save history to backend, using localStorage:",h)}const c=j.getHistorySync(),u=c.findIndex(e=>e.propertyId===t),d={propertyId:t,propertyTitle:n,ownerName:i,ownerContactNumber:s,ownerEmail:o,actionType:a,viewedAt:(new Date).toISOString()};if(u>-1){const e=c[u];"viewed_owner_details"===e.actionType&&"chat_with_owner"===a?c[u]=d:c[u]=(0,p.A)((0,p.A)({},e),{},{viewedAt:d.viewedAt,actionType:"chat_with_owner"===e.actionType?e.actionType:d.actionType})}else c.unshift(d);return c.length>100&&c.splice(100),j.saveHistory(c),c},getHistorySync:()=>{try{const e=localStorage.getItem("propertyViewHistory");return e?JSON.parse(e):[]}catch(e){return console.error("Error reading property history:",e),[]}},clearHistory:async()=>{j.saveHistory([])},removeFromHistory:e=>{const t=j.getHistorySync().filter(t=>t.propertyId!==e);return j.saveHistory(t),t}},S=t=>{let{property:i,onFavoriteToggle:o,onCarouselInteractionStart:a,onCarouselInteractionEnd:l,onCardMouseEnter:c,onCardMouseLeave:u}=t;(0,n.Zp)();const[d,h]=(0,e.useState)(!1),[p,m]=(0,e.useState)(!1),[f,g]=(0,e.useState)(0);(0,e.useEffect)(()=>{(async()=>{try{const e=w.isFavorite(i.id);h(e);if(localStorage.getItem("authToken")){const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.list();if(t.success&&t.data){const e=(t.data.properties||t.data.favorites||[]).map(e=>e.id||e.property_id);h(e.includes(i.id))}}}catch(e){console.error("Error checking favorite status:",e),h(w.isFavorite(i.id))}})()},[i.id]);const y=async e=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),m(!0),void setTimeout(()=>m(!1),2e3);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{if(!document.execCommand("copy"))throw new Error("execCommand failed");m(!0),setTimeout(()=>m(!1),2e3)}finally{document.body.removeChild(t)}}catch(t){console.error("Failed to copy to clipboard:",t);if(window.confirm("Share this property link:\n\n".concat(e,"\n\nClick OK to copy, then paste it manually.")))try{navigator.clipboard&&navigator.clipboard.writeText&&(await navigator.clipboard.writeText(e),m(!0),setTimeout(()=>m(!1),2e3))}catch(r){console.error("Final clipboard attempt failed:",r)}}},{id:_,image:v,images:x,title:b,price:j,location:S,bedrooms:T,bathrooms:k,area:A,status:C,available_for_bachelors:E}=i,N="For Rent"===C,I="\u20b9".concat(null===j||void 0===j?void 0:j.toLocaleString("en-IN")),P=N?"Price/Month":"Price",M="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",L=(0,e.useMemo)(()=>x&&Array.isArray(x)&&x.length>0?x.filter(e=>e&&""!==e.trim()):x&&"string"===typeof x&&""!==x.trim()?x.split(",").map(e=>e.trim()).filter(e=>""!==e):v&&""!==v.trim()?[v]:[M],[x,v,M]);(0,e.useEffect)(()=>{g(0)},[_]);const R=e=>{console.warn("Image failed to load:",e.target.src,"for property:",b),e.target.src=M,e.target.onerror=null};return(0,s.jsxs)("div",{className:"buyer-property-card",onClick:e=>{e.target.closest("button")||e.target.closest("a")||window.open("/details/".concat(_),"_blank","noopener,noreferrer")},onMouseEnter:c,onMouseLeave:u,children:[(0,s.jsxs)("div",{className:"buyer-property-image-container",children:[(0,s.jsx)("div",{className:"buyer-property-image-carousel",children:L.map((e,t)=>(0,s.jsx)("img",{src:e,alt:"".concat(b||"Property"," - Image ").concat(t+1),className:"buyer-property-image ".concat(t===f?"active":""),onError:R,loading:0===t?"eager":"lazy"},t))}),L.length>1&&(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("button",{className:"buyer-carousel-arrow buyer-carousel-arrow-prev",onClick:e=>{e.preventDefault(),e.stopPropagation(),a&&a(),g(e=>0===e?L.length-1:e-1),l&&setTimeout(()=>l(),1e4)},"aria-label":"Previous image",title:"Previous image",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"15 18 9 12 15 6"})})}),(0,s.jsx)("button",{className:"buyer-carousel-arrow buyer-carousel-arrow-next",onClick:e=>{e.preventDefault(),e.stopPropagation(),a&&a(),g(e=>e===L.length-1?0:e+1),l&&setTimeout(()=>l(),1e4)},"aria-label":"Next image",title:"Next image",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("polyline",{points:"9 18 15 12 9 6"})})})]}),L.length>1&&(0,s.jsx)("div",{className:"buyer-carousel-pagination",children:L.map((e,t)=>(0,s.jsx)("button",{className:"buyer-carousel-dot ".concat(t===f?"active":""),onClick:e=>((e,t)=>{t.preventDefault(),t.stopPropagation(),a&&a(),g(e),l&&setTimeout(()=>l(),1e4)})(t,e),"aria-label":"Go to image ".concat(t+1),title:"Image ".concat(t+1)},t))}),(0,s.jsx)("span",{className:"buyer-property-status ".concat(N?"buyer-for-rent":"buyer-for-sale"),children:C}),(0,s.jsx)("button",{className:"buyer-favourite-btn ".concat(d?"active":""),onClick:async e=>{e.preventDefault(),e.stopPropagation();try{const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.toggle(i.id);t.success?(h(void 0!==t.data.is_favorite?t.data.is_favorite:!d),w.toggleFavorite(i.id),o&&o()):console.error("Failed to toggle favorite:",t.message)}catch(t){console.error("Error toggling favorite:",t),w.toggleFavorite(i.id),h(!d)}},"aria-label":d?"Remove from favorites":"Add to favorites",title:d?"Remove from favorites":"Add to favorites",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:d?"white":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),(0,s.jsx)("button",{className:"buyer-share-btn",onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),!i||!i.id)return void console.error("Cannot share: property ID is missing");const t="".concat(window.location.origin,"/details/").concat(i.id),r={title:i.title||"Property Listing",text:"Check out this property: ".concat(i.title||"Amazing Property"),url:t};if(navigator.share)try{await navigator.share(r),console.log("Share successful")}catch(n){"AbortError"!==n.name&&(console.error("Error sharing:",n),await y(t))}else await y(t)},"aria-label":"Share property",title:"Share property",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,s.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,s.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,s.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,s.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})}),p&&(0,s.jsx)("div",{className:"buyer-share-toast",children:"Link copied!"})]}),(0,s.jsxs)("div",{className:"buyer-property-content",children:[(0,s.jsx)("h3",{className:"buyer-property-title",children:b}),(0,s.jsxs)("div",{className:"buyer-property-location",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),(0,s.jsx)("span",{children:S})]}),(0,s.jsxs)("div",{className:"buyer-property-details",children:[T&&"0"!==T&&0!==T&&(0,s.jsxs)("div",{className:"buyer-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M2 17l6-6 4 4 8-8"}),(0,s.jsx)("path",{d:"M17 2h5v5"})]}),(0,s.jsxs)("span",{children:[T," ","1"===T||1===T?"Bed":"Beds"]})]}),k&&"0"!==k&&0!==k&&(0,s.jsxs)("div",{className:"buyer-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M9 6 6.5 3.5a1.5 1.5 0 0 0-1 0l-1 1a1.5 1.5 0 0 0 0 1L7 9"}),(0,s.jsx)("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}),(0,s.jsx)("circle",{cx:"11",cy:"11",r:"2"})]}),(0,s.jsxs)("span",{children:[k," ","1"===k||1===k?"Bath":"Baths"]})]}),(0,s.jsxs)("div",{className:"buyer-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,s.jsx)("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),(0,s.jsxs)("span",{children:[A," sq.ft"]})]})]}),(0,s.jsxs)("div",{className:"buyer-property-footer",children:[(0,s.jsxs)("div",{className:"buyer-property-price",children:[(0,s.jsx)("span",{className:"buyer-price-label",children:P}),(0,s.jsx)("span",{className:"buyer-price-value",children:I})]}),(0,s.jsx)("button",{className:"buyer-view-details-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),window.open("/details/".concat(_),"_blank","noopener,noreferrer")},children:"View Details"})]})]})]})},T=t=>{let{project:r}=t;(0,n.Zp)();const[i,o]=(0,e.useState)(!1),{id:a,image:l,title:c,location:u,priceRange:d,bhkType:h,projectStatus:p}=r,m=p||"Projects",f="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",g=l&&""!==l.trim()?l:f,y=async e=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),o(!0),void setTimeout(()=>o(!1),2e3);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")&&(o(!0),setTimeout(()=>o(!1),2e3))}finally{document.body.removeChild(t)}}catch(t){console.error("Failed to copy to clipboard:",t)}},_="\u20b9".concat(d," Cr");return(0,s.jsxs)("div",{className:"upcoming-project-card",onClick:e=>{e.target.closest("button")||e.target.closest("a")||window.open("/upcoming-project/".concat(a),"_blank","noopener,noreferrer")},children:[(0,s.jsxs)("div",{className:"upcoming-project-image-container",children:[(0,s.jsx)("img",{src:g,alt:c||"Project image",className:"upcoming-project-image",onError:e=>{console.warn("Image failed to load:",g,"for project:",c),e.target.src=f,e.target.onerror=null},loading:"lazy"}),(0,s.jsx)("span",{className:"upcoming-project-status",children:m}),(0,s.jsx)("button",{className:"upcoming-share-btn",onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),!r||!r.id)return void console.error("Cannot share: project ID is missing");const t="".concat(window.location.origin,"/upcoming-project/").concat(r.id),n={title:r.title||"Upcoming Project",text:"Check out this upcoming project: ".concat(r.title||"Amazing Project"),url:t};if(navigator.share)try{await navigator.share(n),console.log("Share successful")}catch(i){"AbortError"!==i.name&&(console.error("Error sharing:",i),await y(t))}else await y(t)},"aria-label":"Share project",title:"Share project",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,s.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,s.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,s.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,s.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})}),i&&(0,s.jsx)("div",{className:"upcoming-share-toast",children:"Link copied!"})]}),(0,s.jsxs)("div",{className:"upcoming-project-content",children:[(0,s.jsx)("h3",{className:"upcoming-project-title",children:c}),(0,s.jsxs)("div",{className:"upcoming-project-location",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),(0,s.jsx)("span",{children:u})]}),(0,s.jsxs)("div",{className:"upcoming-project-details",children:[h&&"N/A"!==h&&(0,s.jsxs)("div",{className:"upcoming-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M2 17l6-6 4 4 8-8"}),(0,s.jsx)("path",{d:"M17 2h5v5"})]}),(0,s.jsx)("span",{children:h})]}),(0,s.jsxs)("div",{className:"upcoming-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,s.jsx)("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),(0,s.jsx)("span",{children:"Upcoming"})]})]}),(0,s.jsxs)("div",{className:"upcoming-project-footer",children:[(0,s.jsxs)("div",{className:"upcoming-project-price",children:[(0,s.jsx)("span",{className:"upcoming-price-label",children:"Price Range"}),(0,s.jsx)("span",{className:"upcoming-price-value",children:_})]}),(0,s.jsx)("button",{className:"upcoming-view-details-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),window.open("/upcoming-project/".concat(a),"_blank","noopener,noreferrer")},children:"View Details"})]})]})]})},k=()=>{const t=(0,n.Zp)(),[r,o]=(0,e.useState)([]),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(null);(0,e.useEffect)(()=>{(async()=>{try{l(!0),u(null);const e=await i.propertiesAPI.list({limit:50,project_type:"upcoming"});if(e.success&&e.data&&e.data.properties){const t=e.data.properties.map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500");let r={};try{"string"===typeof e.upcoming_project_data?r=JSON.parse(e.upcoming_project_data):"object"===typeof e.upcoming_project_data&&(r=e.upcoming_project_data)}catch(a){console.warn("Failed to parse upcoming_project_data:",a)}const n=(e=>{if(!e)return"Unknown";const t=["Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Pune","Kolkata","Ahmedabad","Jaipur","Surat"],r=e.toUpperCase();for(const i of t)if(r.includes(i.toUpperCase()))return i;const n=e.split(",");return n.length>1?n[n.length-1].trim():e.split(" ")[0]})(e.location),i=(e=>{if(!e||!Array.isArray(e)||0===e.length)return"N/A";const t=e.filter(e=>e&&(e.includes("BHK")||e.includes("bhk"))).map(e=>{const t=e.match(/(\d+)\s*BHK/i);return t?"".concat(t[1]," BHK"):e}).filter((e,t,r)=>r.indexOf(e)===t).sort((e,t)=>{var r,n;return parseInt((null===(r=e.match(/\d+/))||void 0===r?void 0:r[0])||"0")-parseInt((null===(n=t.match(/\d+/))||void 0===n?void 0:n[0])||"0")});return 0===t.length?e.some(e=>e.toLowerCase().includes("villa"))?"Villa":e.some(e=>e.toLowerCase().includes("plot"))?"Plot":e.join(", "):t.join(", ")})(r.configurations),s=(o=e.price)?(o/1e7).toFixed(1):"0";var o;return{id:e.id,image:t,title:e.title,location:e.location,city:n,bhkType:i,priceRange:s,projectStatus:r.projectStatus,builder:r.builderName||e.seller_name||"Builder",builderLink:"#builder-".concat(e.id),upcomingData:r,propertyData:e}});o(t),console.log("\u2705 Loaded",t.length,"upcoming projects from API")}else o([])}catch(e){console.error("Error fetching upcoming projects:",e),u("Failed to load upcoming projects"),o([])}finally{l(!1)}})()},[]);const d=(0,s.jsx)("div",{className:"upcoming-section-header",children:(0,s.jsxs)("div",{className:"buyer-section-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"upcoming-section-title",children:"Explore Projects"}),(0,s.jsx)("p",{className:"upcoming-section-subtitle",children:"Visit these projects and get benefits before the official launch!"})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),t("/buyer-dashboard/search?searchMode=upcoming-projects&project_type=upcoming")},"aria-label":"View all upcoming projects",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})});return a?(0,s.jsxs)("div",{className:"upcoming-projects-section",children:[d,(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading  projects..."})})]}):c?(0,s.jsxs)("div",{className:"upcoming-projects-section",children:[d,(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#c33"},children:(0,s.jsx)("p",{children:c})})]}):0===r.length?null:(0,s.jsxs)("div",{className:"upcoming-projects-section",children:[d,(0,s.jsx)("div",{className:"upcoming-horizontal-scroll-container",children:(0,s.jsx)("div",{className:"upcoming-projects-wrapper",children:r.map(e=>(0,s.jsx)(T,{project:e},e.id))})})]})},A=()=>{const t=(0,n.Zp)(),[r,o]=(0,e.useState)([]);(0,e.useEffect)(()=>{window.scrollTo(0,0)},[]);const[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(!1),d=(0,e.useRef)(null),h=(0,e.useRef)(null),p=(0,e.useRef)(null),m=(0,e.useRef)(null),f=(0,e.useRef)(!1),g=(0,e.useRef)(!1),y=(0,e.useRef)(null),_=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(c)return;if(window.matchMedia("(prefers-reduced-motion: reduce)").matches)return;const e=d.current,t=h.current;if(!e||!t)return;const r=t.scrollWidth/2,n=r/120,i=t=>{var s;_.current=null!==(s=_.current)&&void 0!==s?s:t;const o=Math.min((t-_.current)/1e3,.2);_.current=t;const a=e.scrollLeft+n*o;g.current=!0,e.scrollLeft=a>=r?a-r:a,requestAnimationFrame(()=>{g.current=!1}),y.current=requestAnimationFrame(i)};return y.current=requestAnimationFrame(i),()=>{y.current&&cancelAnimationFrame(y.current),_.current=null}},[c]),(0,e.useEffect)(()=>{(async()=>{try{l(!0);const e=await i.propertiesAPI.list({limit:50});if(e.success&&e.data&&e.data.properties){const t=e.data.properties.map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}return t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"),{id:e.id,image:t,title:e.title,price:parseFloat(e.price),location:e.location,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area),type:e.property_type,status:"sale"===e.status?"For Sale":"rent"===e.status?"For Rent":e.status,propertyType:e.property_type,projectType:e.project_type||null,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?[e.amenities]:[],images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone}}).filter(e=>!e.projectType||"upcoming"!==e.projectType);o(t)}else o([])}catch(e){console.error("Error fetching properties:",e),o([])}finally{l(!1)}})()},[]);const x=(0,e.useCallback)(()=>{p.current&&clearTimeout(p.current),u(!0)},[]),w=(0,e.useCallback)(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>{u(!1)},500)},[]),j=(0,e.useCallback)(()=>{u(!0)},[]),T=(0,e.useCallback)(()=>{f.current||u(!1)},[]),A=(0,e.useCallback)(()=>{u(!0)},[]),C=(0,e.useCallback)(()=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{u(!1)},2e3)},[]),E=(0,e.useCallback)(()=>{g.current||(f.current=!0,u(!0),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{f.current=!1,u(!1)},3e3))},[]);(0,e.useEffect)(()=>()=>{p.current&&clearTimeout(p.current),m.current&&clearTimeout(m.current)},[]);return(0,s.jsxs)("div",{children:[(0,s.jsx)(v,{heroImage:"/Homeeuserr.jpeg"}),(0,s.jsx)(k,{}),(0,s.jsxs)("div",{className:"buyer-home-properties-section",children:[(0,s.jsx)("div",{className:"buyer-section-header",children:(0,s.jsxs)("div",{className:"buyer-section-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:"Explore Properties"}),(0,s.jsx)("p",{children:"Buy or Rent \u2014 All in One Place"})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),t("/buyer-dashboard/search")},"aria-label":"View all properties",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),a?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading properties..."})}):0===r.length?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"No properties available at the moment."})}):(0,s.jsx)("div",{className:"buyer-horizontal-scroll-container buyer-auto-scroll-container ".concat(c?"paused":""),ref:d,onMouseEnter:j,onMouseLeave:T,onTouchStart:A,onTouchEnd:C,onScroll:E,children:(0,s.jsxs)("div",{className:"buyer-property-cards-wrapper buyer-auto-scroll-wrapper",ref:h,children:[r.map(e=>(0,s.jsx)(S,{property:e,onCarouselInteractionStart:x,onCarouselInteractionEnd:w},"original-".concat(e.id))),r.map(e=>(0,s.jsx)(S,{property:e,onCarouselInteractionStart:x,onCarouselInteractionEnd:w},"duplicate-".concat(e.id)))]})})]}),(0,s.jsx)(b,{})]})},C=()=>{const t=(0,n.Zp)(),[r,i]=(0,e.useState)(null),{user:o}=l(),a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/seller-dashboard";t(o?e:"/login?role=seller&returnUrl=".concat(encodeURIComponent(e)))};return(0,s.jsxs)("div",{className:"seller-landing-page",children:[(0,s.jsxs)("div",{className:"seller-hero-sections",style:{backgroundImage:"url(".concat("","/LoginSellerr.jpg)")},children:[(0,s.jsx)("h1",{className:"seller-hero-title",children:"Your Property, Your Price - Sell Directly to Real Buyers"}),(0,s.jsx)("p",{className:"seller-hero-subtitle",children:"List your home in minutes, connect with genuine buyers and sell faster."}),(0,s.jsxs)("div",{className:"seller-cta-buttons",children:[(0,s.jsx)("button",{className:"seller-btn seller-btn-primary",onClick:()=>t("/login?role=seller"),children:"Login"}),(0,s.jsx)("button",{className:"seller-btn seller-btn-secondary",onClick:()=>t("/register?role=seller"),children:"Register Free"})]})]}),(0,s.jsxs)("section",{className:"dashboard-preview",children:[(0,s.jsx)("h2",{children:"Your Seller Dashboard Awaits"}),(0,s.jsxs)("div",{className:"preview-card",onMouseEnter:()=>i("dashboard"),onMouseLeave:()=>i(null),onClick:()=>a("/seller-dashboard"),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:"blur-content",children:[(0,s.jsx)("div",{className:"blur-item",children:"Property Analytics: \u2588\u2588\u2588\u2588"}),(0,s.jsx)("div",{className:"blur-item",children:"Enquiry Messages: \u2588\u2588\u2588\u2588"}),(0,s.jsx)("div",{className:"blur-item",children:"Property Views: \u2588\u2588\u2588\u2588"})]}),"dashboard"===r&&!o&&(0,s.jsx)("div",{className:"hover-message",children:"\ud83d\udd12 Login to unlock your seller dashboard"})]})]}),(0,s.jsxs)("section",{className:"benefits-section",children:[(0,s.jsx)("h2",{children:"Why List With Us?"}),(0,s.jsx)("div",{className:"benefits-grid",children:[{icon:"\u2714",title:"Zero Brokerage",desc:"List and sell without any commission"},{icon:"\u2714",title:"Verified Buyers & Tenants",desc:"Connect only with verified users"},{icon:"\u2714",title:"High Visibility",desc:"Reach thousands of active seekers"},{icon:"\u2714",title:"Smart Matching",desc:"AI-powered buyer recommendations"},{icon:"\u2714",title:"Instant Notifications",desc:"Get alerts for new leads immediately"},{icon:"\u2714",title:"Easy Document Upload",desc:"Secure and simple process"}].map((e,t)=>(0,s.jsxs)("div",{className:"benefit-card",children:[(0,s.jsx)("span",{className:"benefit-icon",children:e.icon}),(0,s.jsx)("h3",{children:e.title}),(0,s.jsx)("p",{children:e.desc})]},t))})]}),(0,s.jsxs)("section",{className:"how-it-works",children:[(0,s.jsx)("h2",{children:"How It Works"}),(0,s.jsx)("div",{className:"steps-container",children:[{num:"1",title:"Create FREE Account",desc:"Sign up in less than 60 seconds"},{num:"2",title:"Upload Property Details",desc:"Add photos, price, and features"},{num:"3",title:"Get Leads & Close Deal",desc:"Connect with serious buyers directly"}].map((e,t)=>(0,s.jsxs)("div",{className:"step-card",children:[(0,s.jsx)("div",{className:"step-number",children:e.num}),(0,s.jsx)("h3",{children:e.title}),(0,s.jsx)("p",{children:e.desc})]},t))}),(0,s.jsx)("p",{className:"section-cta",children:"Start now \u2014 It's 100% free for owners."})]}),(0,s.jsxs)("section",{className:"success-stories",children:[(0,s.jsx)("h2",{children:"Success Stories"}),(0,s.jsx)("div",{className:"reviews-container",children:[{text:"Got 14 enquiries in 48 hours. Sold within a week!",author:"Amit",role:"Owner"},{text:"Very smooth process and verified tenants only.",author:"Nisha",role:"Landlord"}].map((e,t)=>(0,s.jsxs)("div",{className:"review-card",children:[(0,s.jsxs)("p",{className:"review-text",children:['"',e.text,'"']}),(0,s.jsxs)("p",{className:"review-author",children:["\u2014 ",e.author,", ",e.role]})]},t))})]}),(0,s.jsxs)("section",{className:"locked-features",children:[(0,s.jsx)("h2",{children:"What You'll Get After Login"}),(0,s.jsx)("div",{className:"features-grid",children:["Dashboard with leads","Daily enquiries","Property visibility stats","Promote listing options","Chat with buyers/tenants","Priority listing upgrade"].map((e,t)=>(0,s.jsxs)("div",{className:"feature-item",children:[(0,s.jsx)("span",{className:"lock-icon",children:"\ud83d\udd12"}),(0,s.jsx)("span",{children:e})]},t))}),(0,s.jsx)("p",{className:"section-cta",children:"Login to explore your full tools."})]}),(0,s.jsxs)("section",{className:"seller-trust-stats",children:[(0,s.jsx)("h2",{children:"Already 5,200+ Owners Trust Us"}),(0,s.jsx)("div",{className:"seller-stats-grid",children:[{icon:"\ud83c\udfe0",number:"35,000+",label:"Active property seekers"},{icon:"\ud83e\uddfe",number:"16,000+",label:"Listings closed"},{icon:"\u2b50",number:"4.8/5",label:"Seller satisfaction"},{icon:"\ud83d\udd10",number:"100%",label:"Verified & safe leads"}].map((e,t)=>(0,s.jsxs)("div",{className:"seller-stat-card",children:[(0,s.jsx)("span",{className:"seller-stat-icon",children:e.icon}),(0,s.jsx)("h3",{children:e.number}),(0,s.jsx)("p",{children:e.label})]},t))})]}),(0,s.jsxs)("section",{className:"right-people",children:[(0,s.jsx)("h2",{children:"Show Your Property to the Right People"}),(0,s.jsxs)("ul",{className:"features-list",children:[(0,s.jsx)("li",{children:"Your property is shown to matched buyers/tenants."}),(0,s.jsx)("li",{children:"We reduce spam calls using smart filtering."}),(0,s.jsx)("li",{children:"Serious seekers only \u2192 saves time."})]}),(0,s.jsx)("button",{className:"seller-btn seller-btn-primary",onClick:()=>a("/seller-dashboard"),children:"Register & Start Listing \u2192"})]}),(0,s.jsxs)("section",{className:"final-cta",children:[(0,s.jsx)("h2",{children:"\ud83d\ude80 Ready to Sell or Rent Your Property Faster?"}),(0,s.jsx)("p",{children:"Join thousands of owners using our platform."}),(0,s.jsx)("button",{className:"seller-btn seller-btn-large",onClick:()=>a("/seller-dashboard"),children:"Create your free account \u2192"})]})]})};function E(){const[t,r]=(0,e.useState)(null),i=(0,n.Zp)(),{user:o}=l(),a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/buyer-dashboard";i(o?e:"/login?role=buyer&returnUrl=".concat(encodeURIComponent(e)))};return(0,s.jsxs)("div",{className:"buyer-landing-page",children:[(0,s.jsxs)("div",{className:"buy-hero-sections",style:{backgroundImage:"url(".concat("","/LoginBuy.jpg)")},children:[(0,s.jsx)("h1",{className:"buy-hero-title",children:"Your Next Home Is Just a Click Away"}),(0,s.jsx)("p",{className:"buy-hero-subtitle",children:"Browse 35,000+ verified properties. Connect directly with owners. Move in faster."}),(0,s.jsxs)("div",{className:"buy-cta-buttons",children:[(0,s.jsx)("button",{className:"buy-btn buy-btn-primary",onClick:()=>i("/login?role=buyer"),children:"Login"}),(0,s.jsx)("button",{className:"buy-btn buy-btn-secondary",onClick:()=>i("/register?role=buyer"),children:"Register Free"})]})]}),(0,s.jsxs)("section",{className:"property-types",children:[(0,s.jsx)("h2",{children:"What Are You Looking For?"}),(0,s.jsx)("div",{className:"types-grid",children:[{image:"/property-images/Apartment.jpg",title:"Apartment",count:"15,000+"},{image:"/property-images/Villa.jpg",title:"Villa",count:"3,200+"},{image:"/property-images/Rowhouse.jpg",title:"Row House",count:"2,800+"},{image:"/property-images/Banglow.jpg",title:"Bungalow",count:"1,900+"},{image:"/property-images/StudioApartment.jpg",title:"Studio Apartment",count:"4,200+"},{image:"/property-images/PlotLand.jpg",title:"Plot / Land",count:"4,300+"},{image:"/property-images/CommercialOffice.jpg",title:"Commercial Office",count:"3,500+"},{image:"/property-images/Hostel.jpg",title:"PG / Hostel",count:"3,400+"}].map((e,t)=>(0,s.jsx)("div",{className:"type-card",onClick:()=>a("/buyer-dashboard"),style:{cursor:"pointer",backgroundImage:"url(".concat(e.image,")")},children:(0,s.jsxs)("div",{className:"type-card-overlay",children:[(0,s.jsx)("h3",{children:e.title}),(0,s.jsxs)("p",{children:[e.count," listings"]})]})},t))})]}),(0,s.jsxs)("section",{className:"benefits-section",children:[(0,s.jsx)("h2",{children:"Why Choose Our Platform?"}),(0,s.jsx)("div",{className:"benefits-grid",children:[{icon:"\u2705",title:"Verified Properties Only",desc:"Browse through authenticated listings"},{icon:"\ud83d\udd0d",title:"Advanced Search Filters",desc:"Find exactly what you need"},{icon:"\ud83d\udcb0",title:"Zero Brokerage",desc:"Connect directly with owners"},{icon:"\u2713",title:"Verified Owners",desc:"Deal with authenticated sellers only"},{icon:"\ud83d\udd14",title:"Instant Notifications",desc:"Get alerts for new properties"},{icon:"\ud83d\udccd",title:"Location Insights",desc:"Detailed area information"}].map((e,t)=>(0,s.jsxs)("div",{className:"benefit-card",children:[(0,s.jsx)("span",{className:"benefit-icon",children:e.icon}),(0,s.jsx)("h3",{children:e.title}),(0,s.jsx)("p",{children:e.desc})]},t))})]}),(0,s.jsxs)("section",{className:"dashboard-preview",children:[(0,s.jsx)("h2",{children:"Your Personal Property Dashboard"}),(0,s.jsxs)("div",{className:"preview-card",onMouseEnter:()=>r("dashboard"),onMouseLeave:()=>r(null),onClick:()=>a("/buyer-dashboard"),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:"blur-content",children:[(0,s.jsx)("div",{className:"blur-item",children:"Saved Properties: 7e97e97e97e9"}),(0,s.jsx)("div",{className:"blur-item",children:"New Matches: 7e97e97e9"}),(0,s.jsx)("div",{className:"blur-item",children:"Messages: 7e97e9"})]}),"dashboard"===t&&!o&&(0,s.jsx)("div",{className:"hover-message",children:"\ud83d\udd12 Login to unlock your dashboard"})]})]}),(0,s.jsxs)("section",{className:"reviews-section",children:[(0,s.jsx)("h2",{children:"What Our Users Say"}),(0,s.jsx)("div",{className:"reviews-grid",children:[{text:"Found my dream apartment in just 3 days. No broker hassle!",author:"Priya Sharma",role:"Tenant"},{text:"Amazing platform! Directly connected with owner and saved lakhs in brokerage.",author:"Rahul Verma",role:"Buyer"},{text:"Best property search experience. Filters are so helpful!",author:"Anjali Mehta",role:"Tenant"}].map((e,t)=>(0,s.jsxs)("div",{className:"review-card",children:[(0,s.jsxs)("p",{className:"review-text",children:['"',e.text,'"']}),(0,s.jsxs)("p",{className:"review-author",children:["\u2014 ",e.author,", ",e.role]})]},t))})]}),(0,s.jsxs)("section",{className:"stats-section",children:[(0,s.jsx)("h2",{children:"Trusted by Thousands"}),(0,s.jsx)("div",{className:"stats-grid",children:[{icon:"\ud83c\udfe0",number:"35,000+",label:"Active properties"},{icon:"\u2705",number:"100%",label:"Verified listings"},{icon:"\ud83d\udc65",number:"50,000+",label:"Happy users"},{icon:"\u2b50",number:"4.9/5",label:"User satisfaction"}].map((e,t)=>(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("p",{children:e.label}),(0,s.jsx)("span",{className:"stat-icon",children:e.icon}),(0,s.jsx)("h3",{children:e.number})]},t))})]}),(0,s.jsxs)("section",{className:"search-tips-section",children:[(0,s.jsx)("h2",{children:"Pro Tips for Property Search"}),(0,s.jsx)("div",{className:"tips-container",children:["Use location filters to narrow down your search","Set price range to see properties within budget","Save your favorite properties for later","Enable notifications for instant updates","Contact multiple owners to compare options"].map((e,t)=>(0,s.jsxs)("div",{className:"tip-item",children:[(0,s.jsx)("span",{className:"tip-number",children:t+1}),(0,s.jsx)("p",{children:e})]},t))})]}),(0,s.jsxs)("section",{className:"cta-section",children:[(0,s.jsx)("h2",{children:"Ready to Find Your New Home?"}),(0,s.jsx)("p",{children:"Sign up now and get access to the best property deals in your city."}),(0,s.jsx)("button",{className:"cta-btn",onClick:()=>a("/buyer-dashboard"),children:"Start Your Search Now"})]})]})}function N(){const[t,r]=(0,e.useState)(null),i=(0,n.Zp)(),{user:o}=l(),a=function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"/agent-dashboard";i(o?e:"/login?role=agent&returnUrl=".concat(encodeURIComponent(e)))};return(0,s.jsxs)("div",{className:"agent-landing-page",children:[(0,s.jsxs)("div",{className:"agent-hero-sections",style:{backgroundImage:"url(".concat("","/landingpageagent.jpeg)")},children:[(0,s.jsx)("h1",{className:"agent-hero-title",children:"Where Agents & Builders Meet Real Buyers"}),(0,s.jsx)("p",{className:"agent-hero-subtitle",children:"Promote your listings, generate trusted leads, and scale your real estate business effortlessly."}),(0,s.jsxs)("div",{className:"agent-cta-buttons",children:[(0,s.jsx)("button",{className:"agent-btn agent-btn-primary",onClick:()=>i("/login?role=agent"),children:"Login"}),(0,s.jsx)("button",{className:"agent-btn agent-btn-secondary",onClick:()=>i("/register?role=agent"),children:"Register Free"})]})]}),(0,s.jsxs)("section",{className:"benefits-section",children:[(0,s.jsx)("h2",{children:"For Agents & Builders"}),(0,s.jsx)("div",{className:"benefits-grid",children:[{icon:"\u2714",title:"Daily Qualified Leads",desc:"Get genuine buyer and tenant enquiries"},{icon:"\u2714",title:"Project Listing Tools",desc:"Showcase your projects professionally"},{icon:"\u2714",title:"Lead Management Dashboard",desc:"Track and manage all enquiries"},{icon:"\u2714",title:"Verified Buyer/Tenant Profiles",desc:"Connect with serious clients only"},{icon:"\u2714",title:"Promotional Boosts",desc:"Increase visibility for your listings"},{icon:"\u2714",title:"Multi-Property Handling",desc:"Manage unlimited properties easily"}].map((e,t)=>(0,s.jsxs)("div",{className:"benefit-card",children:[(0,s.jsx)("span",{className:"benefit-icon",children:e.icon}),(0,s.jsx)("h3",{children:e.title}),(0,s.jsx)("p",{children:e.desc})]},t))})]}),(0,s.jsxs)("section",{className:"dashboard-preview",children:[(0,s.jsx)("h2",{children:"Your Agent Dashboard Awaits"}),(0,s.jsxs)("div",{className:"preview-card",onMouseEnter:()=>r("dashboard"),onMouseLeave:()=>r(null),onClick:()=>a("/agent-dashboard"),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:"blur-content",children:[(0,s.jsx)("div",{className:"blur-item",children:"Lead Messages: \u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"}),(0,s.jsx)("div",{className:"blur-item",children:"Project View Count: \u2588\u2588\u2588\u2588"}),(0,s.jsx)("div",{className:"blur-item",children:"Enquiry Notifications: \u2588\u2588\u2588\u2588"})]}),"dashboard"===t&&!o&&(0,s.jsx)("div",{className:"hover-message",children:"\ud83d\udd12 Login to unlock your agent dashboard"})]})]}),(0,s.jsxs)("section",{className:"why-choose",children:[(0,s.jsx)("h2",{children:"Why Agents & Builders Choose Us?"}),(0,s.jsx)("div",{className:"why-grid",children:[{icon:"\ud83d\udcc8",text:"Sell inventory 3x faster"},{icon:"\ud83c\udfaf",text:"Filtered, serious enquiries only"},{icon:"\ud83d\udcde",text:"Direct contact with buyers"},{icon:"\ud83d\udcbc",text:"Manage all listings in one place"},{icon:"\u270d\ufe0f",text:"Custom builder profiles & branding"}].map((e,t)=>(0,s.jsxs)("div",{className:"why-card",children:[(0,s.jsx)("span",{className:"why-icon",children:e.icon}),(0,s.jsx)("p",{children:e.text})]},t))})]}),(0,s.jsxs)("section",{className:"how-it-works",children:[(0,s.jsx)("h2",{children:"How It Works"}),(0,s.jsx)("div",{className:"steps-container",children:[{num:"1",title:"Create Business Account",desc:"Sign up as agent or builder"},{num:"2",title:"Add Listings / Projects",desc:"Upload your properties and projects"},{num:"3",title:"Receive Direct Enquiries",desc:"Get notifications for every lead"},{num:"4",title:"Convert Leads \u2192 Close Deals",desc:"Turn enquiries into sales"}].map((e,t)=>(0,s.jsxs)("div",{className:"step-card",children:[(0,s.jsx)("div",{className:"step-number",children:e.num}),(0,s.jsx)("h3",{children:e.title}),(0,s.jsx)("p",{children:e.desc})]},t))}),(0,s.jsx)("p",{className:"section-cta",onClick:()=>a("/agent-dashboard"),style:{cursor:"pointer"},children:"Start Now \u2014 Free to Join"})]}),(0,s.jsxs)("section",{className:"project-teasers",children:[(0,s.jsx)("h2",{children:"Showcase Your Projects"}),(0,s.jsx)("div",{className:"projects-grid",children:[{title:"Luxury 2 & 3 BHK Towers",type:"Premium Apartments"},{title:"Affordable Housing Project",type:"Budget Homes"},{title:"Premium Villas by XYZ Builder",type:"Luxury Villas"}].map((e,n)=>(0,s.jsxs)("div",{className:"project-card",onMouseEnter:()=>r("project-".concat(n)),onMouseLeave:()=>r(null),onClick:()=>a("/agent-dashboard"),style:{cursor:"pointer"},children:[(0,s.jsxs)("div",{className:"blur-content",children:[(0,s.jsx)("h3",{children:e.title}),(0,s.jsx)("p",{children:e.type}),(0,s.jsx)("div",{className:"blur-details",children:"\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588\u2588"})]}),t==="project-".concat(n)&&!o&&(0,s.jsx)("div",{className:"hover-message-small",children:"\ud83d\udd12 Login to list your projects"})]},n))})]}),(0,s.jsxs)("section",{className:"agent-trust-stats",children:[(0,s.jsx)("h2",{children:"Trusted by Real Estate Professionals"}),(0,s.jsx)("div",{className:"agent-stats-grid",children:[{icon:"\ud83e\uddd1\u200d\ud83d\udcbc",number:"3,500+",label:"Active Agents"},{icon:"\ud83c\udfd7",number:"250+",label:"Builders Onboarded"},{icon:"\ud83c\udfd8",number:"12,000+",label:"Projects Managed"},{icon:"\ud83d\udcca",number:"96%",label:"Lead Satisfaction Score"}].map((e,t)=>(0,s.jsxs)("div",{className:"agent-stat-card",children:[(0,s.jsx)("span",{className:"agent-stat-icon",children:e.icon}),(0,s.jsx)("h3",{children:e.number}),(0,s.jsx)("p",{children:e.label})]},t))})]}),(0,s.jsxs)("section",{className:"reviews-section",children:[(0,s.jsx)("h2",{children:"What Professionals Say"}),(0,s.jsx)("div",{className:"reviews-container",children:[{text:"Huge boost in quality leads. Closed 7 deals this month.",author:"A. Sharma",role:"Agent"},{text:"Our new township project got 120+ enquiries in 2 weeks!",author:"Sunrise Builders",role:"Builder"}].map((e,t)=>(0,s.jsxs)("div",{className:"review-card",children:[(0,s.jsxs)("p",{className:"review-text",children:['"',e.text,'"']}),(0,s.jsxs)("p",{className:"review-author",children:["\u2014 ",e.author,", ",e.role]})]},t))})]}),(0,s.jsxs)("section",{className:"final-cta",children:[(0,s.jsx)("h2",{children:"\ud83d\ude80 Join the Fastest Growing Network of Agents & Builders"}),(0,s.jsx)("p",{children:"Start managing projects, properties, and leads \u2014 all in one dashboard."}),(0,s.jsxs)("div",{className:"agent-cta-buttons",children:[(0,s.jsx)("button",{className:"agent-btn agent-btn-large agent-btn-light",onClick:()=>{i("/login?role=agent")},children:"Login"}),(0,s.jsx)("button",{className:"agent-btn agent-btn-large agent-btn-outline",onClick:()=>{i("/register?role=agent")},children:"Register"})]})]})]})}var I=r(784);const P=(0,I.A)("chevron-down",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);var M=r(935);function L(){(0,e.useEffect)(()=>{window.scrollTo({top:0,behavior:"auto"})},[]);const t=(0,e.useRef)(null),[r,n]=(0,e.useState)({name:"",email:"",phone:"",message:""}),[i,o]=(0,e.useState)(!1),[a,l]=(0,e.useState)(!1),[c,u]=(0,e.useState)(null),[d,h]=(0,e.useState)({}),m=(0,e.useCallback)(e=>{const{name:t,value:r}=e.target;n(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r})),d[t]&&h(e=>(0,p.A)((0,p.A)({},e),{},{[t]:""}))},[d]);return(0,s.jsx)("div",{className:"contact-main",children:(0,s.jsxs)("div",{className:"contact-container",children:[(0,s.jsxs)("div",{className:"contact-header",children:[(0,s.jsx)("h1",{className:"contact-title",children:"Get In Touch"}),(0,s.jsx)("p",{className:"header-text",children:"Contact us for a free quote or emergency service"})]}),(0,s.jsxs)("div",{className:"contact-two-column",children:[(0,s.jsxs)("div",{className:"contact-info-card",children:[(0,s.jsx)("h2",{className:"contact-info-title",children:"Contact Information"}),(0,s.jsxs)("div",{className:"contact-info-item",children:[(0,s.jsx)("div",{className:"contact-info-label",children:"Phone"}),(0,s.jsx)("a",{href:"tel:+919371316019",className:"contact-info-link",children:"+919371316019"})]}),(0,s.jsxs)("div",{className:"contact-info-item",children:[(0,s.jsx)("div",{className:"contact-info-label",children:"Email"}),(0,s.jsx)("a",{href:"mailto:info@360Coordinates.com",className:"contact-info-link",children:"info@360Coordinates.com"})]}),(0,s.jsxs)("div",{className:"contact-info-item",children:[(0,s.jsx)("div",{className:"contact-info-label",children:"Address"}),(0,s.jsxs)("a",{href:"https://www.google.com/maps/search/?api=1&query=Office+No.21+%26+22,+3rd+Floor,+S%2FNo.+56,+Aston+Plaza,+Ambegaon+Bk.,+Pune,+Maharashtra+411046",target:"_blank",rel:"noopener noreferrer",className:"contact-info-address",children:["Office No.21 & 22, 3rd Floor, S/No. 56",(0,s.jsx)("br",{}),"Aston Plaza, Ambegaon Bk.",(0,s.jsx)("br",{}),"Pune, Maharashtra\u2013 411046"]})]})]}),(0,s.jsxs)("div",{className:"form-card",children:[(0,s.jsx)("h2",{className:"form-title",children:"Send Us a Message"}),a&&(0,s.jsx)("div",{className:"success-box",children:"Message sent successfully!"}),d.submit&&(0,s.jsx)("div",{className:"error-box",children:d.submit}),(0,s.jsxs)("form",{ref:t,className:"form-inputs",onSubmit:e=>{var t,i,s,a;e&&(e.preventDefault(),e.stopPropagation());const c=window.pageYOffset||document.documentElement.scrollTop,u={},d=null===(t=r.name)||void 0===t?void 0:t.trim(),p=null===(i=r.email)||void 0===i?void 0:i.trim(),m=null===(s=r.phone)||void 0===s?void 0:s.trim(),f=null===(a=r.message)||void 0===a?void 0:a.trim();var g;if((!d||d.length<2)&&(u.name="Name must be at least 2 characters"),p?/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(p)||(u.email="Please enter a valid email address"):u.email="Email is required",m?(g=m).replace(/\D/g,"").length>=10&&/^[\+]?[(]?[0-9]{1,4}[)]?[-\s\.]?[(]?[0-9]{1,4}[)]?[-\s\.]?[0-9]{1,9}$/.test(g)||(u.phone="Please enter a valid phone number"):u.phone="Phone number is required",(!f||f.length<10)&&(u.message="Message must be at least 10 characters"),Object.keys(u).length>0)return h(u),void window.scrollTo({top:c,behavior:"auto"});h({}),o(!0);const y={name:d,email:p,phone:m,message:f};M.Ay.callCloudFunction("sendContactEmail",y).then(e=>{o(!1),l(!0),n({name:"",email:"",phone:"",message:""}),requestAnimationFrame(()=>{window.scrollTo({top:c,behavior:"auto"})}),setTimeout(()=>l(!1),2500)}).catch(e=>{o(!1),h({submit:e.message||"Failed to send message. Please try again later."}),console.error("Firebase Functions Error:",e),window.scrollTo({top:0,behavior:"auto"})})},onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[(0,s.jsx)("input",{type:"text",name:"name",value:r.name,onChange:m,placeholder:"Your Name",className:d.name?"error":""}),d.name&&(0,s.jsx)("span",{className:"error-message",children:d.name}),(0,s.jsx)("input",{type:"email",name:"email",value:r.email,onChange:m,placeholder:"Your Email",className:d.email?"error":""}),d.email&&(0,s.jsx)("span",{className:"error-message",children:d.email}),(0,s.jsx)("input",{type:"text",name:"phone",value:r.phone,onChange:m,placeholder:"Phone Number",className:d.phone?"error":""}),d.phone&&(0,s.jsx)("span",{className:"error-message",children:d.phone}),(0,s.jsx)("textarea",{name:"message",rows:"4",value:r.message,onChange:m,placeholder:"Message",className:d.message?"error":""}),d.message&&(0,s.jsx)("span",{className:"error-message",children:d.message}),(0,s.jsx)("button",{type:"submit",disabled:i,children:i?"Sending...":"Send Message"})]})]})]}),(0,s.jsxs)("div",{className:"faq-section",children:[(0,s.jsx)("h2",{className:"faq-title",children:"Frequently Asked Questions"}),(0,s.jsx)("div",{className:"faq-list",children:[{question:"How do I list a property?",answer:"To list your property, log in to your seller dashboard and click on 'My Properties'. Then click the 'Add Property' button and fill in all the required details including property type, location, price, and images. Once submitted, your property will be reviewed and published."},{question:"How can I contact the property owner?",answer:"You can contact property owners directly through our chat feature. Simply click on the 'Chat' button on any property listing page, or use the ChatUs page in your dashboard. Property owners will receive your message and can respond to your inquiries."},{question:"Is my data secure?",answer:"Yes, we take data security seriously. All your personal information, including contact details and property data, is encrypted and stored securely. We follow industry-standard security practices and never share your information with third parties without your consent."},{question:"How do I edit my profile?",answer:"To edit your profile, go to your dashboard and click on 'Profile' in the navigation menu. From there, you can update your personal information, contact details, profile picture, and other settings. Remember to save your changes before leaving the page."},{question:"How can I get support?",answer:"You can get support by filling out the contact form on this page, or by emailing us directly at info@360Coordinates.com. Our support team typically responds within 24 hours. You can also call us at +919371316019 during business hours."}].map((e,t)=>(0,s.jsxs)("div",{className:"faq-item ".concat(c===t?"open":""),children:[(0,s.jsxs)("button",{className:"faq-question",onClick:()=>u(c===t?null:t),children:[(0,s.jsx)("span",{children:e.question}),(0,s.jsx)(P,{size:20,className:"faq-icon ".concat(c===t?"open":"")})]}),c===t&&(0,s.jsx)("div",{className:"faq-answer",children:(0,s.jsx)("p",{children:e.answer})})]},t))})]})]})})}const R=(0,I.A)("user",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]),D=(0,I.A)("house",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-6a2 2 0 0 1 2.582 0l7 6A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"r6nss1"}]]);var F=r(639);const O=(0,I.A)("eye-off",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);var z=r(87),B=r(614),U=r(819),V=r(54),q=r(375);const W=t=>{let{isOpen:r,onClose:n}=t;const[i,o]=(0,e.useState)(1),[a,l]=(0,e.useState)(""),[c,u]=(0,e.useState)(""),[d,h]=(0,e.useState)(""),[p,m]=(0,e.useState)(""),[f,g]=(0,e.useState)(!1),[y,_]=(0,e.useState)(!1),[v,x]=(0,e.useState)(""),[b,w]=(0,e.useState)(!1),[j,S]=(0,e.useState)(null),T=(0,e.useRef)(!1);(0,e.useEffect)(()=>{r&&(o(1),l(""),u(""),h(""),m(""),x(""),S(null),w(!1),T.current=!1)},[r]);const k=async e=>{if(T.current)return;try{await new Promise((e,t)=>{if(window.initSendOTP&&"function"===typeof window.initSendOTP)return void e();const r=document.querySelector('script[src*="otp-provider.js"]');if(r)return r.addEventListener("load",()=>e()),void r.addEventListener("error",()=>t(new Error("Failed to load MSG91 script")));const n=document.createElement("script");n.type="text/javascript",n.src="https://verify.msg91.com/otp-provider.js",n.async=!0,n.onload=()=>{setTimeout(()=>{window.initSendOTP&&"function"===typeof window.initSendOTP?e():t(new Error("MSG91 script loaded but initSendOTP function not available"))},100)},n.onerror=()=>t(new Error("Failed to load MSG91 script")),document.head.appendChild(n)})}catch(r){try{await function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise((r,n)=>{let i=0;const s=()=>{window.initSendOTP&&"function"===typeof window.initSendOTP?r():i<e?(i++,setTimeout(s,t)):n(new Error("MSG91 script timeout"))};s()})}(20,200)}catch(n){return x("MSG91 widget is not loaded. Please refresh the page and try again."),void(T.current=!1)}}if(!window.initSendOTP||"function"!==typeof window.initSendOTP)return x("MSG91 widget is not loaded. Please refresh the page and try again."),void(T.current=!1);T.current=!0;let t=e;if(e.includes("@"))t=e;else{const r=e.replace(/[^0-9]/g,"");t=r.startsWith("91")?r:"91"+r.slice(-10)}try{const e={widgetId:"356c686b6c57353338333631",tokenAuth:"481618TsNUr9hYEGR694e174cP1",identifier:t,success:async e=>{var t;console.log("MSG91 Widget Success:",e);let r=null;r="string"===typeof e?e:null!==e&&void 0!==e&&e.token?e.token:null!==e&&void 0!==e&&e.verificationToken?e.verificationToken:null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.token?e.data.token:JSON.stringify(e),r&&r.length>=10?(S(r),o(3),x("")):x("Invalid token received from OTP verification. Please try again.")},failure:e=>{console.error("MSG91 Widget Failure:",e),x("OTP verification failed. Please try again."),T.current=!1}};window.initSendOTP(e)}catch(v){console.error("Error initializing MSG91 widget:",v),x("Failed to initialize OTP widget. Please try again."),T.current=!1}};return r?(0,s.jsx)("div",{className:"forgot-password-overlay",onClick:n,children:(0,s.jsxs)("div",{className:"forgot-password-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{className:"forgot-password-close",onClick:n,children:(0,s.jsx)(B.A,{size:24})}),(0,s.jsxs)("div",{className:"forgot-password-content",children:[(0,s.jsx)("h2",{children:"Reset Password"}),v&&(0,s.jsxs)("div",{className:"forgot-password-error",children:[(0,s.jsx)(U.A,{size:20}),(0,s.jsx)("span",{children:v})]}),1===i&&(0,s.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x(""),a&&a.trim())if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(a)){w(!0);try{const e=await fetch("".concat(q.JR).concat(q.Sn.FORGOT_PASSWORD_INIT),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.trim()})}),r=await e.json();var t;if(r.success)u((null===(t=r.data)||void 0===t?void 0:t.phone)||""),o(2),x(""),setTimeout(()=>{k(a.trim())},500);else x(r.message||"Email not found. Please check your email address.")}catch(v){console.error("Error:",v),x("An error occurred. Please try again.")}finally{w(!1)}}else x("Please enter a valid email address");else x("Please enter your email address")},className:"forgot-password-form",children:[(0,s.jsx)("p",{className:"forgot-password-description",children:"Enter your email address and we'll send you an OTP to reset your password."}),(0,s.jsxs)("div",{className:"forgot-password-field",children:[(0,s.jsx)("label",{children:"Email Address"}),(0,s.jsx)("input",{type:"email",value:a,onChange:e=>l(e.target.value),placeholder:"john@example.com",required:!0,disabled:b})]}),(0,s.jsx)("button",{type:"submit",className:"forgot-password-btn",disabled:b,children:b?"Checking...":"Continue"})]}),2===i&&(0,s.jsxs)("div",{className:"forgot-password-otp-step",children:[(0,s.jsx)("p",{className:"forgot-password-description",children:c?"We've sent an OTP to your registered phone number ending in ".concat(c.slice(-4),". You can also verify via email."):"Please verify your identity using the OTP widget below. You can choose SMS or Email verification."}),(0,s.jsx)("div",{id:"msg91-otp-widget-container",className:"msg91-widget-container"}),(0,s.jsx)("button",{type:"button",onClick:()=>{2===i&&(o(1),x(""),T.current=!1)},className:"forgot-password-back-btn",disabled:b,children:"\u2190 Back to Email"})]}),3===i&&(0,s.jsxs)("form",{onSubmit:async e=>{if(e.preventDefault(),x(""),!d||d.length<6)x("Password must be at least 6 characters long");else if(d===p)if(!j||j.length<10)x("OTP verification token is missing. Please complete OTP verification first.");else{w(!0);try{const e=await fetch("".concat(q.JR).concat(q.Sn.RESET_PASSWORD),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:a.trim(),widgetToken:j,newPassword:d})}),t=await e.json();t.success?(o(4),x(""),setTimeout(()=>{n()},3e3)):x(t.message||"Failed to reset password. Please try again.")}catch(v){console.error("Error:",v),x("An error occurred. Please try again.")}finally{w(!1)}}else x("Passwords do not match")},className:"forgot-password-form",children:[(0,s.jsx)("p",{className:"forgot-password-description",children:"Enter your new password below."}),(0,s.jsxs)("div",{className:"forgot-password-field",children:[(0,s.jsx)("label",{children:"New Password"}),(0,s.jsxs)("div",{className:"password-input-wrapper",children:[(0,s.jsx)("input",{type:f?"text":"password",value:d,onChange:e=>h(e.target.value),placeholder:"Enter new password (min 6 characters)",required:!0,disabled:b,minLength:6}),(0,s.jsx)("button",{type:"button",onClick:()=>g(!f),className:"password-toggle-btn",children:f?(0,s.jsx)(O,{size:20}):(0,s.jsx)(z.A,{size:20})})]})]}),(0,s.jsxs)("div",{className:"forgot-password-field",children:[(0,s.jsx)("label",{children:"Confirm Password"}),(0,s.jsxs)("div",{className:"password-input-wrapper",children:[(0,s.jsx)("input",{type:y?"text":"password",value:p,onChange:e=>m(e.target.value),placeholder:"Confirm new password",required:!0,disabled:b,minLength:6}),(0,s.jsx)("button",{type:"button",onClick:()=>_(!y),className:"password-toggle-btn",children:y?(0,s.jsx)(O,{size:20}):(0,s.jsx)(z.A,{size:20})})]})]}),(0,s.jsx)("button",{type:"submit",className:"forgot-password-btn",disabled:b,children:b?"Resetting Password...":"Reset Password"})]}),4===i&&(0,s.jsxs)("div",{className:"forgot-password-success",children:[(0,s.jsx)(V.A,{size:64,className:"success-icon"}),(0,s.jsx)("h3",{children:"Password Reset Successful!"}),(0,s.jsx)("p",{children:"Your password has been reset successfully. You can now login with your new password."}),(0,s.jsx)("p",{className:"forgot-password-auto-close",children:"This window will close automatically in 3 seconds..."})]})]})]})}):null},H=()=>{const t=(0,n.Zp)(),[r]=(0,n.ok)(),{login:i}=l();(0,e.useEffect)(()=>(document.body.classList.add("auth-page"),()=>{document.body.classList.remove("auth-page")}),[]);const o=r.get("role"),a=o&&["buyer","seller","agent"].includes(o)?o:"buyer",c=r.get("returnUrl"),[u,d]=(0,e.useState)(a),[h,m]=(0,e.useState)(c),[f,g]=(0,e.useState)(!1),[y,_]=(0,e.useState)(""),[v,x]=(0,e.useState)(!1),[b,w]=(0,e.useState)(!1),[j,S]=(0,e.useState)({email:"",password:"",rememberMe:!1});(0,e.useEffect)(()=>{const e=r.get("role"),t=r.get("returnUrl");e&&["buyer","seller","agent"].includes(e)&&d(e),t?(m(t),localStorage.setItem("returnUrl",t),console.log("Return URL detected and stored:",t)):localStorage.removeItem("returnUrl")},[r]);const T=async e=>{if(e&&e.preventDefault(),!v)if(_(""),j.email&&j.password){x(!0);try{console.log("Login attempt:",{email:j.email,userType:u});const e=await i(j.email,j.password,u);if(console.log("Login result:",e),e.success){console.log("Login successful, navigating to dashboard..."),console.log("Current returnUrl state:",h),console.log("Current returnUrl from searchParams:",r.get("returnUrl")),localStorage.setItem("currentSession",JSON.stringify({email:j.email,loginType:u,loginTime:(new Date).toISOString()}));const e=h||r.get("returnUrl")||localStorage.getItem("returnUrl");setTimeout(()=>{if(e)try{const r=decodeURIComponent(e);r.startsWith("/")?(console.log("Redirecting back to property page:",r),localStorage.removeItem("returnUrl"),t(r,{replace:!1})):(console.warn("Invalid returnUrl format, using role-based navigation:",r),"buyer"===u?t("/buyer-dashboard"):"seller"===u?t("/seller-dashboard"):"agent"===u&&t("/agent-dashboard"))}catch(r){console.error("Error decoding returnUrl:",r),"buyer"===u?t("/buyer-dashboard"):"seller"===u?t("/seller-dashboard"):"agent"===u&&t("/agent-dashboard")}else console.log("No returnUrl found, using role-based navigation"),"buyer"===u?t("/buyer-dashboard"):"seller"===u?t("/seller-dashboard"):"agent"===u&&t("/agent-dashboard")},100)}else{const t=e.message||"Login failed. Please check your credentials.";console.error("Login failed:",t),_(t)}}catch(s){var n;console.error("Login error caught:",s);const e=s.message||(null===(n=s.data)||void 0===n?void 0:n.message)||"An error occurred. Please try again.";_(e)}finally{x(!1)}}else _("Please enter both email and password")},k=e=>{const{name:t,value:r,type:n,checked:i}=e.target;S(e=>(0,p.A)((0,p.A)({},e),{},{[t]:"checkbox"===n?i:r})),y&&_("")},A=e=>{d(e),y&&_("")},C=(e,t)=>{if("Enter"===e.key){e.preventDefault();const r=["email","password"],n=r.indexOf(t);if(n<r.length-1){const e=r[n+1],t=document.querySelector('input[name="'.concat(e,'"]'));t&&t.focus()}else T(e)}};return(0,s.jsxs)("div",{className:"login-container",children:[(0,s.jsx)("div",{className:"background-image",style:{backgroundImage:"url(".concat({buyer:"/LoginBuy.jpg",seller:"/LoginSellerr.jpg",agent:"/landingpageagent.jpeg"}[u],")")}}),(0,s.jsxs)("div",{className:"login-card",children:[(0,s.jsxs)("div",{className:"login-header",children:[(0,s.jsx)("h1",{children:"Welcome Back"}),(0,s.jsx)("p",{children:"Sign in to continue to your account"})]}),(0,s.jsxs)("div",{className:"user-type-toggle",children:[(0,s.jsxs)("button",{onClick:()=>A("buyer"),className:"buyer"===u?"active":"",children:[(0,s.jsx)(R,{size:20})," Buyer/Tenant"]}),(0,s.jsxs)("button",{onClick:()=>A("seller"),className:"seller"===u?"active":"",children:[(0,s.jsx)(D,{size:20})," Seller/Owner"]}),(0,s.jsxs)("button",{onClick:()=>A("agent"),className:"agent"===u?"active":"",children:[(0,s.jsx)(F.A,{size:20})," Agent/Builder"]})]}),(0,s.jsxs)("div",{className:"role-access-hint",children:["agent"===u&&(0,s.jsx)("p",{className:"hint-text hint-warning",children:"Only registered Agents/Builders can access this dashboard"}),("buyer"===u||"seller"===u)&&(0,s.jsx)("p",{className:"hint-text",children:"Buyers and Sellers can switch between these two dashboards"})]}),y&&(0,s.jsxs)("div",{className:"error-message",children:[(0,s.jsx)("span",{className:"error-icon",children:"\u2715"}),y]}),(0,s.jsxs)("form",{className:"login-form",onSubmit:T,children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Email Address"}),(0,s.jsx)("input",{type:"email",name:"email",value:j.email,onChange:k,onKeyDown:e=>C(e,"email"),placeholder:"john@example.com"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Password"}),(0,s.jsxs)("div",{className:"password-wrapper",children:[(0,s.jsx)("input",{type:f?"text":"password",name:"password",value:j.password,onChange:k,onKeyDown:e=>C(e,"password"),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022"}),(0,s.jsx)("button",{type:"button",onClick:()=>g(!f),className:"password-toggle",children:f?(0,s.jsx)(O,{size:20}):(0,s.jsx)(z.A,{size:20})})]})]}),(0,s.jsxs)("div",{className:"options-row",children:[(0,s.jsxs)("label",{children:[(0,s.jsx)("input",{type:"checkbox",name:"rememberMe",checked:j.rememberMe,onChange:k}),"Remember me"]}),(0,s.jsx)("button",{type:"button",onClick:()=>w(!0),className:"forgot-password-link",children:"Forgot Password?"})]}),(0,s.jsx)("button",{type:"submit",className:"login-btn",disabled:v,children:v?"Signing In...":"Sign In as ".concat("buyer"===u?"Buyer/Tenant":"seller"===u?"Seller/Owner":"Agent/Builder")}),(0,s.jsxs)("div",{className:"signup-link",children:["Don't have an account?"," ",(0,s.jsx)("button",{type:"button",onClick:()=>{const e=h?"/register?role=".concat(u,"&returnUrl=").concat(encodeURIComponent(h)):"/register?role=".concat(u);t(e)},children:"Register now"})]})]})]},u),(0,s.jsx)(W,{isOpen:b,onClose:()=>w(!1)})]})},G=()=>{const t=(0,n.Zp)(),[r]=(0,n.ok)(),{register:o}=l(),a=r.get("role"),c=a&&["buyer","seller","agent"].includes(a)?a:"buyer",u=r.get("returnUrl"),[d,h]=(0,e.useState)(c),[m,f]=(0,e.useState)(u);(0,e.useEffect)(()=>{const e=r.get("role"),t=r.get("returnUrl");e&&["buyer","seller","agent"].includes(e)&&h(e),t?(f(t),localStorage.setItem("returnUrl",t),console.log("Return URL detected and stored:",t)):localStorage.removeItem("returnUrl")},[r]),(0,e.useEffect)(()=>(document.body.classList.add("auth-page"),()=>{document.body.classList.remove("auth-page")}),[]),(0,e.useEffect)(()=>{const e=document.body.style.overflow,t=document.documentElement.style.overflow;return document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow=e,document.documentElement.style.overflow=t}},[]);const[g,y]=(0,e.useState)({fullName:"",email:"",emailOtp:"",phone:"",phoneOtp:"",password:"",confirmPassword:"",agreeTerms:!1}),[_,v]=(0,e.useState)(!1),[x,b]=(0,e.useState)(!1),[w,j]=(0,e.useState)(!1),[S,T]=(0,e.useState)(!1),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(!1),[N,I]=(0,e.useState)(null),[P,M]=(0,e.useState)(null),[L,O]=(0,e.useState)(!1),[z,B]=(0,e.useState)(""),[U,V]=(0,e.useState)(""),[q,W]=(0,e.useState)(!1);(0,e.useEffect)(()=>{(async()=>{try{const e=await i.IA.getConfig();if(console.log("Config API response:",e),e&&e.success&&e.data){const t=!0===e.data.enableEmailOtp;W(t),t||(A(!0),j(!0),console.log("Email OTP is disabled - auto-verifying email"))}else console.warn("Config API response format unexpected:",e),W(!1),A(!0),j(!0)}catch(z){console.error("Failed to fetch email OTP config:",z),W(!1),A(!0),j(!0)}})()},[]);const H=e=>{const{name:t,value:r,type:n,checked:i}=e.target,s="fullName"===t&&"checkbox"!==n?r.toUpperCase():"checkbox"===n?i:r;y(e=>(0,p.A)((0,p.A)({},e),{},{[t]:s}))},G=()=>{const e=g.email.trim();if(/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e))if(B(""),V(""),window.initSendOTP)try{const t={widgetId:"356c6c657650333535343933",tokenAuth:"481618TX6cdMp7Eg69414e7eP1",identifier:e,success:e=>{var t;console.log("MSG91 Email Verification Success:",e);let r=null;r="string"===typeof e?e:null!==e&&void 0!==e&&e.token?e.token:null!==e&&void 0!==e&&e.verificationToken?e.verificationToken:null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.token?e.data.token:JSON.stringify(e),console.log("Stored email verification token:",r),I(r),A(!0),j(!0),V("Email verified successfully!")},failure:e=>{console.error("MSG91 Email Verification Error:",e);const t=(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.error)||(null===e||void 0===e?void 0:e.toString())||"Email verification failed. Please try again.";B(t),A(!1),I(null)}};window.initSendOTP(t)}catch(z){console.error("Error opening MSG91 email widget:",z),B("Failed to open verification widget. Please try again.")}else setTimeout(()=>{window.initSendOTP?G():B("MSG91 widget is not loaded. Please refresh the page and try again.")},500);else B("Please enter a valid email address.")},Z=()=>{const e=g.phone.replace(/\D/g,"");let t=!1,r="";if(10===e.length&&/^[6-9]\d{9}$/.test(e))t=!0,r="91"+e;else if(12===e.length&&e.startsWith("91")){const n=e.slice(2);/^[6-9]\d{9}$/.test(n)&&(t=!0,r=e)}else if(13===e.length&&e.startsWith("91")){const n=e.slice(2);/^[6-9]\d{9}$/.test(n)&&(t=!0,r="91"+n)}if(t)if(B(""),V(""),window.initSendOTP)try{const e={widgetId:"356c7067734f373437333438",tokenAuth:"481618TcNAx989nvQ69410832P1",identifier:r,success:e=>{var t;console.log("MSG91 Verification Success:",e);let r=null;r="string"===typeof e?e:null!==e&&void 0!==e&&e.token?e.token:null!==e&&void 0!==e&&e.verificationToken?e.verificationToken:null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.token?e.data.token:JSON.stringify(e),console.log("Stored verification token:",r),M(r),E(!0),T(!0),V("Phone verified successfully!")},failure:e=>{console.error("MSG91 Verification Error:",e);const t=(null===e||void 0===e?void 0:e.message)||(null===e||void 0===e?void 0:e.error)||(null===e||void 0===e?void 0:e.toString())||"Phone verification failed. Please try again.";B(t),E(!1),M(null)}};window.initSendOTP(e)}catch(z){console.error("Error opening MSG91 widget:",z),B("Failed to open verification widget. Please try again.")}else setTimeout(()=>{window.initSendOTP?Z():B("MSG91 widget is not loaded. Please refresh the page and try again.")},500);else B("Enter a valid Indian mobile number (10 digits, starts from 6-9).")},K=async e=>{if(e&&e.preventDefault(),!L)if(B(""),V(""),g.agreeTerms)if(g.password===g.confirmPassword)if(g.password.length<6)B("Password must be at least 6 characters");else if(!q||k)if(C){O(!0);try{const n=g.phone.replace(/\D/g,"");let i="";10===n.length?i="+91"+n:12===n.length&&n.startsWith("91")&&(i="+"+n);let s=P;if(P)try{const e="string"===typeof P?JSON.parse(P):P;null!==e&&void 0!==e&&e.message?s=e.message:null!==e&&void 0!==e&&e.token?s=e.token:null!==e&&void 0!==e&&e.verificationToken&&(s=e.verificationToken)}catch(e){s=P}let a=N;if(N)try{const e="string"===typeof N?JSON.parse(N):N;null!==e&&void 0!==e&&e.message?a=e.message:null!==e&&void 0!==e&&e.token?a=e.token:null!==e&&void 0!==e&&e.verificationToken&&(a=e.verificationToken)}catch(e){a=N}const l={fullName:g.fullName,email:g.email.trim(),emailVerificationToken:a,phone:i,phoneVerificationToken:s,password:g.password,userType:d};console.log("Registration data being sent:",(0,p.A)((0,p.A)({},l),{},{emailVerificationToken:N?"".concat(N.substring(0,20),"..."):null,phoneVerificationToken:P?"".concat(P.substring(0,20),"..."):null}));const c=await o(l);if(c.success)V("Registration successful! Welcome, ".concat(g.fullName,"!")),localStorage.setItem("currentSession",JSON.stringify({email:g.email,loginType:d,loginTime:(new Date).toISOString()})),console.log("\u2705 Registration successful - Auto-logged in!"),console.log("Current returnUrl state:",m),console.log("Current returnUrl from searchParams:",r.get("returnUrl")),setTimeout(()=>{const e=m||r.get("returnUrl")||localStorage.getItem("returnUrl");if(e)try{const r=decodeURIComponent(e);r.startsWith("/")?(console.log("Redirecting back to property page:",r),localStorage.removeItem("returnUrl"),t(r,{replace:!1})):(console.warn("Invalid returnUrl format, using role-based navigation:",r),"buyer"===d?t("/buyer-dashboard"):"seller"===d?t("/seller-dashboard"):"agent"===d&&t("/agent-dashboard"))}catch(z){console.error("Error decoding returnUrl:",z),"buyer"===d?t("/buyer-dashboard"):"seller"===d?t("/seller-dashboard"):"agent"===d&&t("/agent-dashboard")}else console.log("No returnUrl found, using role-based navigation"),"buyer"===d?t("/buyer-dashboard"):"seller"===d?t("/seller-dashboard"):"agent"===d&&t("/agent-dashboard")},1500);else{const e=c.message||c.errors||"Registration failed. Please try again.";B("string"===typeof e?e:JSON.stringify(e)),console.error("Registration failed:",c)}}catch(z){var n,i,s;console.error("Registration error:",z),console.error("Registration error details:",{message:z.message,data:z.data,errors:z.errors,response:z.response,fullError:z});const t=(null===(n=z.data)||void 0===n?void 0:n.message)||z.message||z.errors||(null===(i=z.response)||void 0===i||null===(s=i.data)||void 0===s?void 0:s.message)||"Registration failed. Please try again.";B("string"===typeof t?t:JSON.stringify(t))}finally{O(!1)}}else B("Please verify your phone number");else B("Please verify your email address");else B("Passwords do not match!");else B("Please agree to Terms & Privacy Policy")},Y=e=>{h(e)},X=(e,t)=>{if("Enter"===e.key){e.preventDefault();const r=["fullName","email","phone","password","confirmPassword"],n=r.indexOf(t);if(n<r.length-1){const e=r[n+1],t=document.querySelector('input[name="'.concat(e,'"]'));if(t&&!t.disabled)t.focus();else for(let i=n+1;i<r.length;i++){const e=r[i],t=document.querySelector('input[name="'.concat(e,'"]'));if(t&&!t.disabled){t.focus();break}}}else K(e)}};return(0,s.jsxs)("div",{className:"container",children:[(0,s.jsx)("div",{className:"background-image",style:{backgroundImage:"url(".concat({buyer:"/LoginBuy.jpg",seller:"/LoginSellerr.jpg",agent:"/landingpageagent.jpeg"}[d],")")}}),(0,s.jsxs)("div",{className:"card",children:[(0,s.jsxs)("div",{className:"header",children:[(0,s.jsx)("h1",{className:"title",children:"Create Account"}),(0,s.jsx)("p",{className:"subtitle",children:"Fill in your details to get started"})]}),(0,s.jsxs)("form",{className:"form",onSubmit:K,children:[z&&(0,s.jsxs)("div",{className:"error-message",children:[(0,s.jsx)("span",{className:"error-icon",children:"\u2715"}),z]}),U&&(0,s.jsxs)("div",{className:"success-message",children:[(0,s.jsx)("span",{className:"success-icon",children:"\u2713"}),U]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"label",children:"Register As"}),(0,s.jsxs)("div",{className:"user-type-toggle",children:[(0,s.jsxs)("button",{type:"button",onClick:()=>Y("buyer"),className:"type-btn ".concat("buyer"===d?"active":""),children:[(0,s.jsx)(R,{size:18})," Buyer/Tenant"]}),(0,s.jsxs)("button",{type:"button",onClick:()=>Y("seller"),className:"type-btn ".concat("seller"===d?"active":""),children:[(0,s.jsx)(D,{size:18})," Seller/Owner"]}),(0,s.jsxs)("button",{type:"button",onClick:()=>Y("agent"),className:"type-btn ".concat("agent"===d?"active":""),children:[(0,s.jsx)(F.A,{size:18})," Agent/Builder"]})]}),(0,s.jsxs)("div",{className:"role-info",children:["buyer"===d&&(0,s.jsx)("p",{className:"role-hint",children:"As a Buyer/Tenant, you can access Buyer and Seller dashboards"}),"seller"===d&&(0,s.jsx)("p",{className:"role-hint",children:"As a Seller/Owner, you can access Buyer and Seller dashboards"}),"agent"===d&&(0,s.jsx)("p",{className:"role-hint role-hint-agent",children:"As an Agent/Builder, you can only access the Agent dashboard"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"label",children:"Full Name *"}),(0,s.jsx)("input",{type:"text",name:"fullName",value:g.fullName,onChange:H,onKeyDown:e=>X(e,"fullName"),placeholder:"John Doe",className:"input"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"label",children:"Email Address *"}),(0,s.jsxs)("div",{className:"input-wrapper",children:[(0,s.jsx)("input",{type:"email",name:"email",value:g.email,onChange:H,onKeyDown:e=>{if("Enter"===e.key&&q&&!k){e.preventDefault();const t=document.querySelector('input[name="phone"]');if(t&&!t.disabled)t.focus();else{const e=document.querySelector('input[name="password"]');e&&e.focus()}}else"Enter"===e.key&&X(e,"email")},placeholder:"john@example.com",className:"input",required:!0}),q&&(0,s.jsx)("button",{type:"button",className:"inline-btn",onClick:G,disabled:L||k,children:k?"Verified \u2713":"Verify Email"})]}),q&&k&&(0,s.jsx)("p",{style:{fontSize:"12px",color:"#48bb78",marginTop:"4px"},children:"\u2713 Email address verified via MSG91"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"label",children:"Phone Number *"}),(0,s.jsxs)("div",{className:"input-wrapper",children:[(0,s.jsx)("input",{type:"tel",name:"phone",value:g.phone,onChange:H,onKeyDown:e=>{if("Enter"!==e.key||C)"Enter"===e.key&&X(e,"phone");else{e.preventDefault();const t=document.querySelector('input[name="password"]');t&&t.focus()}},placeholder:"+917276*****",className:"input input-pr",disabled:C}),(0,s.jsx)("button",{type:"button",className:"inline-btn",onClick:Z,disabled:L||C,children:C?"Verified \u2713":"Verify Phone"})]}),C&&(0,s.jsx)("p",{style:{fontSize:"12px",color:"#48bb78",marginTop:"4px"},children:"\u2713 Phone number verified via MSG91"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"label",children:"Password *"}),(0,s.jsxs)("div",{className:"input-wrapper",children:[(0,s.jsx)("input",{type:_?"text":"password",name:"password",value:g.password,onChange:H,onKeyDown:e=>X(e,"password"),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"input input-small-pr"}),(0,s.jsx)("button",{type:"button",className:"icon-btn",onClick:()=>v(!_),children:_?"\ud83d\ude48":"\ud83d\udc41"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{className:"label",children:"Confirm Password *"}),(0,s.jsxs)("div",{className:"input-wrapper",children:[(0,s.jsx)("input",{type:x?"text":"password",name:"confirmPassword",value:g.confirmPassword,onChange:H,onKeyDown:e=>X(e,"confirmPassword"),placeholder:"\u2022\u2022\u2022\u2022\u2022\u2022\u2022\u2022",className:"input input-small-pr"}),(0,s.jsx)("button",{type:"button",className:"icon-btn",onClick:()=>b(!x),children:x?"\ud83d\ude48":"\ud83d\udc41"})]})]}),(0,s.jsxs)("div",{className:"checkbox-group",children:[(0,s.jsx)("input",{type:"checkbox",id:"agreeTerms",name:"agreeTerms",checked:g.agreeTerms,onChange:H,className:"checkbox"}),(0,s.jsxs)("label",{htmlFor:"agreeTerms",className:"checkbox-label",children:["I agree to the"," ",(0,s.jsx)("a",{href:"terms-conditions",className:"link",children:"Terms"})," ","&"," ",(0,s.jsx)("a",{href:"./privacy-policy",className:"link",children:"Privacy Policy"})]})]}),(0,s.jsx)("button",{type:"submit",className:"register-btn",disabled:L,children:L?"Registering...":"Register as ".concat((e=>{switch(e){case"buyer":return"Buyer/Tenant";case"seller":return"Seller/Owner";case"agent":return"Agent/Builder";default:return e}})(d))}),(0,s.jsxs)("p",{className:"login-link",children:["Already have an account?"," ",(0,s.jsx)("button",{type:"button",className:"link-btn",onClick:()=>{const e=m?"/login?role=".concat(d,"&returnUrl=").concat(encodeURIComponent(m)):"/login?role=".concat(d);t(e)},children:"Sign In"})]})]})]},d)]})},Z=e=>{let{property:t}=e;(0,n.Zp)();const{user:r}=l(),{image:i,title:o,price:a,location:c,bedrooms:u,bathrooms:d,area:h,status:p}=t;return(0,s.jsxs)("div",{className:"property-card",children:[(0,s.jsxs)("div",{className:"property-image-container",children:[(0,s.jsx)("img",{src:i||"/placeholder-property.jpg",alt:o,className:"property-image"}),(0,s.jsx)("span",{className:"property-status ".concat(null===p||void 0===p?void 0:p.toLowerCase().replace(" ","-")),children:p||"For Sale"})]}),(0,s.jsxs)("div",{className:"property-content",children:[(0,s.jsx)("h3",{className:"property-title",children:o}),(0,s.jsxs)("div",{className:"property-location",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),(0,s.jsx)("span",{children:c})]}),(0,s.jsxs)("div",{className:"property-details",children:[(0,s.jsxs)("div",{className:"detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,s.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),(0,s.jsxs)("span",{children:[u," Beds"]})]}),(0,s.jsxs)("div",{className:"detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M9 6 6.5 3.5a1.5 1.5 0 0 0-1 0l-1 1a1.5 1.5 0 0 0 0 1L7 9"}),(0,s.jsx)("path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21"}),(0,s.jsx)("circle",{cx:"11",cy:"11",r:"2"})]}),(0,s.jsxs)("span",{children:[d," Baths"]})]}),(0,s.jsxs)("div",{className:"detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,s.jsx)("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),(0,s.jsxs)("span",{children:[h," sq.ft"]})]})]}),(0,s.jsxs)("div",{className:"property-footer",children:[(0,s.jsxs)("div",{className:"property-price",children:[(0,s.jsx)("span",{className:"price-label",children:"Price"}),(0,s.jsxs)("span",{className:"price-value",children:["\u20b9",null===a||void 0===a?void 0:a.toLocaleString("en-IN")]})]}),(0,s.jsx)("button",{className:"view-details-btn",onClick:()=>{null!==t&&void 0!==t&&t.id&&window.open("/details/".concat(t.id),"_blank","noopener,noreferrer")},children:"View Details"})]})]})]})},K=()=>((0,e.useEffect)(()=>{window.scrollTo(0,0)},[]),(0,s.jsx)("div",{className:"privacy-container",children:(0,s.jsxs)("div",{className:"privacy-content",children:[(0,s.jsxs)("header",{className:"privacy-header",children:[(0,s.jsx)("h1",{children:"Privacy Policy"}),(0,s.jsx)("p",{className:"last-updated",children:"Last Updated: 26 Nov 2025"})]}),(0,s.jsxs)("div",{className:"privacy-body",children:[(0,s.jsxs)("p",{className:"intro-text",children:["Welcome to ",(0,s.jsx)("strong",{children:"360Coordinates"}),", owned and operated by Mr. Sudhakar Poul & Company, located in Ambegaon BK, Pune, India. By accessing or using our website"," ",(0,s.jsx)("a",{href:"http://www.360Coordinates.com",target:"_blank",rel:"noopener noreferrer",children:"www.360Coordinates.com"})," ","and services, you agree to this Privacy Policy. Please read it carefully before proceeding."]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"1. Introduction"}),(0,s.jsx)("p",{children:"At 360Coordinates, we are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, store, and protect your data when you use our real estate platform. By using our services, you consent to the practices described in this policy."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"2. Information We Collect"}),(0,s.jsx)("p",{children:"We collect various types of information to provide and improve our services:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Personal Information:"})," Name, email address, phone number, postal address"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Property Information:"})," Property details, location, pricing, images, documents"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Account Information:"})," Username, password, profile details"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Financial Information:"})," Payment details for premium services (processed securely)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Technical Information:"})," IP address, browser type, device information, cookies"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Usage Data:"})," Pages visited, search queries, interaction with listings"]})]})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"3. How We Use Your Information"}),(0,s.jsx)("p",{children:"Your personal information is used only for the following purposes:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"To provide and deliver our real estate services"}),(0,s.jsx)("li",{children:"To connect buyers, sellers, homeowners, and real estate agents"}),(0,s.jsx)("li",{children:"To process property listings and inquiries"}),(0,s.jsx)("li",{children:"To communicate with you about services, updates, and support"}),(0,s.jsx)("li",{children:"To improve website functionality and user experience"}),(0,s.jsx)("li",{children:"To send promotional offers and marketing communications (with your consent)"}),(0,s.jsx)("li",{children:"To prevent fraud and ensure platform security"}),(0,s.jsx)("li",{children:"To comply with legal obligations and resolve disputes"})]})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"4. How We Share Your Information"}),(0,s.jsx)("p",{children:"We respect your privacy and do not sell your personal information to third parties. However, we may share your information in the following circumstances:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"With Other Users:"})," Property listings and contact details shared to facilitate transactions"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"With Service Providers:"})," Third-party vendors who help us operate the platform (payment processors, hosting services)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"With Real Estate Agents:"})," When you request to connect with agents for property services"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Legal Requirements:"})," When required by law, court order, or government regulations"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Business Transfers:"})," In case of merger, acquisition, or sale of company assets"]})]}),(0,s.jsx)("p",{children:"We ensure that all third parties maintain strict confidentiality and security standards."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"5. Data Security"}),(0,s.jsx)("p",{children:"We take data security seriously and implement industry-standard measures to protect your information:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Secure SSL encryption for data transmission"}),(0,s.jsx)("li",{children:"Password-protected user accounts"}),(0,s.jsx)("li",{children:"Regular security audits and updates"}),(0,s.jsx)("li",{children:"Restricted access to personal data by authorized personnel only"}),(0,s.jsx)("li",{children:"Secure payment processing through trusted gateways"})]}),(0,s.jsx)("p",{children:"However, no method of transmission over the internet is 100% secure. While we strive to protect your data, we cannot guarantee absolute security."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"6. Cookies and Tracking Technologies"}),(0,s.jsx)("p",{children:"360Coordinates uses cookies and similar tracking technologies to enhance your browsing experience:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Essential Cookies:"})," Required for website functionality"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Performance Cookies:"})," Help us understand how users interact with the site"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Functional Cookies:"})," Remember your preferences and settings"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Marketing Cookies:"})," Track your activity to display relevant advertisements"]})]}),(0,s.jsx)("p",{children:"You can manage or disable cookies through your browser settings. Note that disabling cookies may affect website functionality."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"7. Your Rights and Choices"}),(0,s.jsx)("p",{children:"You have the following rights regarding your personal information:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Access:"})," Request a copy of the personal data we hold about you"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Correction:"})," Update or correct inaccurate information"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Deletion:"})," Request deletion of your account and personal data"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Opt-Out:"})," Unsubscribe from marketing emails at any time"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Data Portability:"})," Request your data in a portable format"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Withdraw Consent:"})," Revoke consent for data processing where applicable"]})]}),(0,s.jsx)("p",{children:"To exercise these rights, please contact us using the information provided in Section 12."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"8. Data Retention"}),(0,s.jsx)("p",{children:"We retain your personal information only for as long as necessary to fulfill the purposes outlined in this Privacy Policy, unless a longer retention period is required by law. When data is no longer needed, we will securely delete or anonymize it."}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Active user accounts: Data retained while account is active"}),(0,s.jsx)("li",{children:"Inactive accounts: Data may be deleted after prolonged inactivity"}),(0,s.jsx)("li",{children:"Transaction records: Retained for legal and accounting purposes"}),(0,s.jsx)("li",{children:"Marketing data: Retained until you opt-out or unsubscribe"})]})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"9. Third-Party Links"}),(0,s.jsx)("p",{children:"Our website may contain links to third-party websites, services, or advertisements. We are not responsible for the privacy practices or content of these external sites. We encourage you to review the privacy policies of any third-party sites you visit."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"10. Children's Privacy"}),(0,s.jsx)("p",{children:"360Coordinates is not intended for use by individuals under the age of 18. We do not knowingly collect personal information from children. If we discover that we have inadvertently collected data from a minor, we will promptly delete it. If you believe a child has provided us with personal information, please contact us immediately."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"11. Changes to This Privacy Policy"}),(0,s.jsx)("p",{children:'We reserve the right to update or modify this Privacy Policy at any time to reflect changes in our practices or legal requirements. The "Last Updated" date at the top of this page will indicate when the policy was last revised. Continued use of our services after changes are posted constitutes your acceptance of the updated policy.'})]}),(0,s.jsxs)("section",{className:"privacy-section contact-section",children:[(0,s.jsx)("h2",{children:"12. Contact Information"}),(0,s.jsx)("p",{children:"If you have any questions, concerns, or requests regarding this Privacy Policy or how we handle your personal information, please contact us:"}),(0,s.jsxs)("div",{className:"contact-details",children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:"360Coordinates \u2013 Mr. Sudhakar Poul & Company"})}),(0,s.jsx)("p",{children:"Ambegaon BK, Pune, Maharashtra, India"}),(0,s.jsxs)("p",{children:["Email: ",(0,s.jsx)("a",{href:"mailto:info@360Coordinates.com",children:"info@360Coordinates.com"})]}),(0,s.jsxs)("p",{children:["Phone: ",(0,s.jsx)("a",{href:"tel:+919860638920",children:"+91 98606 38920"})]})]})]})]}),(0,s.jsx)("footer",{className:"privacy-footer",children:(0,s.jsx)("p",{children:"By continuing to use 360Coordinates, you acknowledge that you have read, understood, and agree to be bound by this Privacy Policy."})})]})})),Y=()=>((0,e.useEffect)(()=>{window.scrollTo(0,0)},[]),(0,s.jsx)("div",{className:"terms-container",children:(0,s.jsxs)("div",{className:"terms-content",children:[(0,s.jsxs)("header",{className:"terms-header",children:[(0,s.jsx)("h1",{children:"Terms & Conditions"}),(0,s.jsx)("p",{className:"last-updated",children:"Last Updated: 26 Nov 2025"})]}),(0,s.jsxs)("div",{className:"terms-body",children:[(0,s.jsxs)("p",{className:"intro-text",children:["Welcome to ",(0,s.jsx)("strong",{children:"360Coordinates"}),", owned and operated by Mr. Sudhakar Poul & Company, located in Ambegaon BK, Pune, India. By accessing or using our website"," ",(0,s.jsx)("a",{href:"http://www.360Coordinates.com",target:"_blank",rel:"noopener noreferrer",children:"www.360Coordinates.com"})," ","and services, you agree to comply with these Terms & Conditions. Please read them carefully before proceeding."]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"1. Introduction"}),(0,s.jsx)("p",{children:"360Coordinates is a real estate service platform designed to connect buyers, sellers, homeowners, and real estate agents across India. By using our services, you accept these terms and confirm that you are legally capable of entering into a binding agreement."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"2. Services Provided"}),(0,s.jsx)("p",{children:"360Coordinates offers a wide range of real estate-related services, including:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Property listing for buyers and sellers"}),(0,s.jsx)("li",{children:"Lead generation for real estate agents"}),(0,s.jsx)("li",{children:"Property marketing and promotion"}),(0,s.jsx)("li",{children:"Homeowner property management support"}),(0,s.jsx)("li",{children:"Real estate consultation and guidance"})]}),(0,s.jsx)("p",{children:"We reserve the right to add, modify, or discontinue services at any time."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"3. User Responsibilities"}),(0,s.jsx)("p",{children:"By using 360Coordinates, you agree that:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"All information you submit (property details, contact info, documents, etc.) is accurate and genuine."}),(0,s.jsx)("li",{children:"You will not upload any misleading, fraudulent, abusive, or illegal content."}),(0,s.jsx)("li",{children:"You will use the platform only for lawful real estate dealings."}),(0,s.jsx)("li",{children:"You will not attempt to copy, hack, or misuse the platform or its resources."})]})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"4. Property Listings & Accuracy"}),(0,s.jsx)("p",{children:"360Coordinates does not guarantee the accuracy, legality, or authenticity of property listings shared by users. All users (buyer, seller, agent, homeowner) are responsible for verifying:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Ownership documents"}),(0,s.jsx)("li",{children:"Property conditions"}),(0,s.jsx)("li",{children:"Legal permissions"}),(0,s.jsx)("li",{children:"Pricing & availability"})]}),(0,s.jsx)("p",{children:"360Coordinates is not liable for disputes between users."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"5. Payments & Fees"}),(0,s.jsx)("p",{children:"Some services provided by 360Coordinates may require payment. You agree that:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"All payments are non-refundable unless stated otherwise."}),(0,s.jsx)("li",{children:"Prices may change based on service updates."}),(0,s.jsx)("li",{children:"Payment details provided must be valid and authorized."})]})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"6. Third-Party Services"}),(0,s.jsx)("p",{children:"360Coordinates may link you to third-party websites, agents, or service vendors. We are not responsible for:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"External site content"}),(0,s.jsx)("li",{children:"Vendor service quality"}),(0,s.jsx)("li",{children:"Third-party policies"})]}),(0,s.jsx)("p",{children:"Users must verify independently before proceeding."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"7. Intellectual Property Rights"}),(0,s.jsx)("p",{children:"All content on 360Coordinates\u2014including logos, text, graphics, data, and website design\u2014belongs to Mr. Sudhakar Poul & Company. Users may not copy, reproduce, modify, or distribute any content without written permission."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"8. Privacy & Data Protection"}),(0,s.jsx)("p",{children:"Your personal information is used only to:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Deliver services"}),(0,s.jsx)("li",{children:"Connect buyers, sellers, and agents"}),(0,s.jsx)("li",{children:"Provide support"}),(0,s.jsx)("li",{children:"Improve website experience"})]}),(0,s.jsx)("p",{children:"We never sell or misuse user data. Please read our Privacy Policy for detailed information."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"9. Limitation of Liability"}),(0,s.jsx)("p",{children:"360Coordinates is not responsible for:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Property disputes"}),(0,s.jsx)("li",{children:"Fraudulent user activities"}),(0,s.jsx)("li",{children:"Incorrect or outdated listings"}),(0,s.jsx)("li",{children:"Losses arising from user decisions"}),(0,s.jsx)("li",{children:"Service interruption or technical errors"})]}),(0,s.jsx)("p",{children:"Users are advised to conduct proper due diligence before finalizing any deal."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"10. Account Termination"}),(0,s.jsx)("p",{children:"We may suspend or terminate access to 360Coordinates if:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"User violates terms"}),(0,s.jsx)("li",{children:"Fraudulent or illegal activity is detected"}),(0,s.jsx)("li",{children:"Misuse of platform is identified"})]}),(0,s.jsx)("p",{children:"No refunds will be provided for terminated accounts."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"11. Changes to Terms"}),(0,s.jsx)("p",{children:"360Coordinates reserves the right to update or change these Terms & Conditions at any time. Continued use of the site means you agree to the updated terms."})]}),(0,s.jsxs)("section",{className:"terms-section contact-section",children:[(0,s.jsx)("h2",{children:"12. Contact Information"}),(0,s.jsx)("p",{children:"For any queries or support, contact:"}),(0,s.jsxs)("div",{className:"contact-details",children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:"360Coordinates \u2013 Mr. Sudhakar Poul & Company"})}),(0,s.jsx)("p",{children:"Ambegaon BK, Pune, Maharashtra, India"}),(0,s.jsxs)("p",{children:["Email: ",(0,s.jsx)("a",{href:"mailto:info@360Coordinates.com",children:"info@360Coordinates.com"})]}),(0,s.jsxs)("p",{children:["Phone: ",(0,s.jsx)("a",{href:"tel:+919860638920",children:"+91 98606 38920"})]})]})]})]}),(0,s.jsx)("footer",{className:"terms-footer",children:(0,s.jsx)("p",{children:"By continuing to use 360Coordinates, you acknowledge that you have read, understood, and agree to be bound by these Terms & Conditions."})})]})})),X=()=>{const[t,r]=(0,e.useState)([]),[i,o]=(0,e.useState)({}),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(!1);(0,e.useEffect)(()=>{window.scrollTo(0,0),d()},[]),(0,e.useEffect)(()=>{!a&&!c&&t.length>0&&(h(),u(!0))},[a,t]);const d=async()=>{try{const e=await fetch("".concat(q.JR).concat(q.Sn.PUBLIC_STATS)),t=await e.json();if(t.success&&t.data)if(t.data.stats&&Array.isArray(t.data.stats)){r(t.data.stats);const e={};t.data.stats.forEach(t=>{e[t.key]=0}),o(e)}else{const e=[{key:"properties",value:t.data.total_properties||0,label:"Properties Listed",order:1},{key:"cities",value:t.data.total_cities||0,label:"Cities Covered",order:2},{key:"users",value:t.data.total_users||0,label:"Happy Customers",order:3},{key:"agents",value:t.data.total_agents||0,label:"Verified Agents",order:4}];r(e),o({properties:0,cities:0,users:0,agents:0})}}catch(e){console.error("Error fetching stats:",e),r([])}finally{l(!1)}},h=()=>{const e=2e3/60;t.forEach(t=>{((t,r,n)=>{let i=t;const s=(r-t)/60,a=setInterval(()=>{i+=s,(s>0&&i>=r||s<0&&i<=r)&&(i=r,clearInterval(a)),o(e=>(0,p.A)((0,p.A)({},e),{},{[n]:Math.floor(i)}))},e)})(0,t.value,t.key)})};return(0,s.jsxs)("div",{className:"about-us-page",children:[(0,s.jsxs)("section",{className:"about-hero",style:{backgroundImage:"url(".concat("","/AboutUs.jpg)")},children:[(0,s.jsx)("div",{className:"about-hero-overlay"}),(0,s.jsxs)("div",{className:"about-hero-content",children:[(0,s.jsx)("h1",{className:"about-hero-title",children:"About 360Coordinates"}),(0,s.jsx)("p",{className:"about-hero-subtitle",children:"Your Trusted Partner in Real Estate - Connecting Dreams to Reality"})]})]}),(0,s.jsx)("section",{className:"about-section about-story",children:(0,s.jsxs)("div",{className:"about-container",children:[(0,s.jsxs)("div",{className:"about-section-header",children:[(0,s.jsx)("h2",{className:"about-section-title",children:"Our Story"}),(0,s.jsx)("div",{className:"about-title-underline"})]}),(0,s.jsxs)("div",{className:"about-story-content",children:[(0,s.jsxs)("div",{className:"about-story-text",children:[(0,s.jsx)("p",{className:"about-paragraph",children:"Founded with a vision to revolutionize the real estate industry in India, 360Coordinates emerged as a trusted platform dedicated to simplifying property transactions. We recognized the challenges faced by buyers, sellers, and renters in navigating the complex real estate market and set out to create a seamless, transparent, and user-friendly solution."}),(0,s.jsx)("p",{className:"about-paragraph",children:"Since our inception, we have been committed to providing verified property listings, transparent pricing, and expert support to make real estate transactions simpler, safer, and faster. Our platform serves as a bridge connecting property seekers with their dream homes and commercial spaces across India."}),(0,s.jsx)("p",{className:"about-paragraph",children:"Today, 360Coordinates stands as one of the leading real estate platforms, helping thousands of users find their perfect property match. We continue to innovate and expand our services to serve the evolving needs of the Indian real estate market."})]}),(0,s.jsx)("div",{className:"about-story-image",children:(0,s.jsx)("div",{className:"about-image-placeholder",children:(0,s.jsxs)("svg",{viewBox:"0 0 400 300",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{width:"400",height:"300",fill:"#f3f4f6"}),(0,s.jsx)("path",{d:"M200 100L250 150L200 200L150 150L200 100Z",fill:"#764ba2",opacity:"0.3"}),(0,s.jsx)("circle",{cx:"200",cy:"150",r:"40",fill:"#003B73",opacity:"0.2"})]})})})]})]})}),(0,s.jsx)("section",{className:"about-section about-mission-vision",children:(0,s.jsx)("div",{className:"about-container",children:(0,s.jsxs)("div",{className:"mission-vision-grid",children:[(0,s.jsxs)("div",{className:"mission-vision-card",children:[(0,s.jsx)("div",{className:"mission-vision-icon",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}),(0,s.jsx)("h3",{className:"mission-vision-title",children:"Our Mission"}),(0,s.jsx)("p",{className:"mission-vision-text",children:"To empower every Indian with seamless access to verified properties, transparent transactions, and expert guidance, making real estate dreams achievable for everyone."})]}),(0,s.jsxs)("div",{className:"mission-vision-card",children:[(0,s.jsx)("div",{className:"mission-vision-icon",children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,s.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,s.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),(0,s.jsx)("h3",{className:"mission-vision-title",children:"Our Vision"}),(0,s.jsx)("p",{className:"mission-vision-text",children:"To become India's most trusted and innovative real estate platform, transforming how people buy, sell, and rent properties through technology, transparency, and exceptional service."})]})]})})}),(0,s.jsx)("section",{className:"about-section about-why-choose",children:(0,s.jsxs)("div",{className:"about-container",children:[(0,s.jsxs)("div",{className:"about-section-header",children:[(0,s.jsx)("h2",{className:"about-section-title",children:"Why Choose 360Coordinates?"}),(0,s.jsx)("div",{className:"about-title-underline"})]}),(0,s.jsxs)("div",{className:"why-choose-grid",children:[(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"01"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Verified Listings"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Every property on our platform is verified for authenticity, ensuring you get accurate information and genuine listings."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"02"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Transparent Pricing"}),(0,s.jsx)("p",{className:"why-choose-text",children:"No hidden costs or surprises. We provide clear, upfront pricing information for all properties and services."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"03"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Expert Support"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Our team of real estate experts is always ready to assist you with property search, negotiations, and transaction support."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"04"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Wide Selection"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Browse through thousands of properties across India - from apartments and villas to commercial spaces and plots."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"05"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Advanced Search"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Use our powerful search filters to find properties that match your exact requirements - location, price, size, and more."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"06"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Secure Transactions"}),(0,s.jsx)("p",{className:"why-choose-text",children:"We prioritize your security and privacy, ensuring safe and secure property transactions with proper documentation support."})]})]})]})}),(0,s.jsx)("section",{className:"about-section about-stats",children:(0,s.jsxs)("div",{className:"about-container",children:[(0,s.jsxs)("div",{className:"about-section-header",children:[(0,s.jsx)("h2",{className:"about-section-title",children:"Our Achievements"}),(0,s.jsx)("div",{className:"about-title-underline"})]}),(0,s.jsx)("div",{className:"stats-grid",children:a?(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-number",children:"..."}),(0,s.jsx)("div",{className:"stat-label",children:"Loading..."})]}):t.length>0?t.map(e=>{return(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsxs)("div",{className:"stat-number","data-animate":"true",children:[(t=i[e.key]||0,t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),"+"]}),(0,s.jsx)("div",{className:"stat-label",children:e.label})]},e.key);var t}):(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-number",children:"0+"}),(0,s.jsx)("div",{className:"stat-label",children:"No data available"})]})})]})}),(0,s.jsx)("section",{className:"about-section about-cta",children:(0,s.jsx)("div",{className:"about-container",children:(0,s.jsxs)("div",{className:"cta-content",children:[(0,s.jsx)("h2",{className:"cta-title",children:"Ready to Find Your Dream Property?"}),(0,s.jsx)("p",{className:"cta-subtitle",children:"Join thousands of satisfied customers who found their perfect property through 360Coordinates"}),(0,s.jsxs)("div",{className:"cta-buttons",children:[(0,s.jsx)(n.N_,{to:"/login",className:"cta-button cta-primary",children:"Start Searching"}),(0,s.jsx)(n.N_,{to:"/login",className:"cta-button cta-secondary",children:"Contact Us"})]})]})})})]})};const J=function(){return(0,s.jsx)(h,{children:(0,s.jsxs)(n.BV,{children:[(0,s.jsx)(n.qh,{path:"/",element:(0,s.jsx)(A,{})}),(0,s.jsx)(n.qh,{path:"/seller",element:(0,s.jsx)(C,{})}),(0,s.jsx)(n.qh,{path:"/buyer",element:(0,s.jsx)(E,{})}),(0,s.jsx)(n.qh,{path:"/search",element:(0,s.jsx)(C,{})}),(0,s.jsx)(n.qh,{path:"/dashboard",element:(0,s.jsx)(E,{})}),(0,s.jsx)(n.qh,{path:"/agents",element:(0,s.jsx)(N,{})}),(0,s.jsx)(n.qh,{path:"/contact",element:(0,s.jsx)(L,{})}),(0,s.jsx)(n.qh,{path:"/login",element:(0,s.jsx)(H,{})}),(0,s.jsx)(n.qh,{path:"/register",element:(0,s.jsx)(G,{})}),(0,s.jsx)(n.qh,{path:"/post-property",element:(0,s.jsx)(Z,{})}),(0,s.jsx)(n.qh,{path:"/privacy-policy",element:(0,s.jsx)(K,{})}),(0,s.jsx)(n.qh,{path:"/terms-conditions",element:(0,s.jsx)(Y,{})}),(0,s.jsx)(n.qh,{path:"/about",element:(0,s.jsx)(X,{})})]})})},Q=e=>{let{isOpen:t,onClose:r}=e;const i=(0,n.Zp)();return t?(0,s.jsx)("div",{className:"buyer-profile-overlay",onClick:r,children:(0,s.jsxs)("div",{className:"buyer-profile-overlay-content",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{className:"buyer-profile-overlay-close",onClick:r,"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"buyer-profile-overlay-header",children:[(0,s.jsx)("div",{className:"buyer-profile-overlay-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("h2",{className:"buyer-profile-overlay-title",children:"Create Your Profile"}),(0,s.jsx)("p",{className:"buyer-profile-overlay-subtitle",children:"Sign up to access your profile, save favorite properties, and get personalized recommendations"})]}),(0,s.jsxs)("div",{className:"buyer-profile-overlay-features",children:[(0,s.jsxs)("div",{className:"buyer-profile-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Save your favorite properties"})]}),(0,s.jsxs)("div",{className:"buyer-profile-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Get personalized property recommendations"})]}),(0,s.jsxs)("div",{className:"buyer-profile-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Contact sellers directly"})]}),(0,s.jsxs)("div",{className:"buyer-profile-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Track your property search history"})]})]}),(0,s.jsxs)("div",{className:"buyer-profile-overlay-actions",children:[(0,s.jsxs)("button",{className:"buyer-profile-signup-btn",onClick:()=>{r(),i("/register")},children:[(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Sign Up Now"]}),(0,s.jsx)("button",{className:"buyer-profile-cancel-btn",onClick:r,children:"Maybe Later"})]})]})}):null},$=()=>{var t,r,i,o,a,c,u,d,h;const{user:p,logout:m,switchRole:f,token:g}=l(),[y,_]=(0,e.useState)(!1),[v,x]=(0,e.useState)(!1),[b,w]=(0,e.useState)(!1),[j,S]=(0,e.useState)(!1),[T,k]=(0,e.useState)(!1),A=(0,n.zy)(),C=(0,n.Zp)(),E=(0,e.useRef)(null),N="/searchresults"===A.pathname||A.pathname.startsWith("/searchresults"),I=(A.pathname.startsWith("/buyer-dashboard")||A.pathname.startsWith("/buy")||A.pathname.startsWith("/rent")||A.pathname.startsWith("/pghostel")||A.pathname.startsWith("/BuyerProfile")||A.pathname.startsWith("/ChatUs")||A.pathname.startsWith("/chatus")||A.pathname.startsWith("/BuyerContactPage")||A.pathname,!1),P=()=>{m(),C("/",{replace:!0})};(0,e.useEffect)(()=>{let e=!1,t=0;const r=()=>{e||(window.requestAnimationFrame(()=>{const r=window.scrollY;Math.abs(r-t)>5&&(x(r>10),t=r),e=!1}),e=!0)};return window.addEventListener("scroll",r,{passive:!0}),()=>window.removeEventListener("scroll",r)},[]);const M=(0,e.useMemo)(()=>"buyer-navbar ".concat(v?"buyer-navbar-scrolled":""),[v]);(0,e.useEffect)(()=>{_(!1)},[A]),(0,e.useEffect)(()=>{S(!1)},[null===p||void 0===p?void 0:p.profile_image]),(0,e.useEffect)(()=>{const e=e=>{E.current&&!E.current.contains(e.target)&&w(!1)};return b&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[b]);const L=e=>"/"===e?"/"===A.pathname:"/BuyerHome"===e?"/buyer-dashboard"===A.pathname||"/BuyerHome"===A.pathname||A.pathname.startsWith("/BuyerHome/"):A.pathname===e||A.pathname.startsWith(e+"/"),R=e=>{I},D=e=>{I},F=(()=>{if("/buyer"===A.pathname||"/dashboard"===A.pathname)return"buyer";if("/seller"===A.pathname||"/search"===A.pathname)return"seller";if("/agents"===A.pathname)return"agent";if("/searchresults"===A.pathname||A.pathname.startsWith("/searchresults")){const e=new URLSearchParams(A.search).get("type");return"rent"===e?"seller":"buyer"}return null})(),O=F?"/login?role=".concat(F):"/login",z=F?"/register?role=".concat(F):"/register",B=e=>{e.preventDefault(),w(!1),C(O)},U=e=>{e.preventDefault(),w(!1),C(z)},V=async()=>{if(console.log("\ud83d\udd04 Switch to Seller button clicked"),!p||!g)return console.log("\u274c No token or user - redirecting to login"),void C("/login");try{console.log("\ud83d\udd04 Calling switchRole API to switch to seller...");const e=await f("seller");e.success?(console.log("\u2705 Role switched to seller successfully"),C("/seller-dashboard",{replace:!1})):(console.error("\u274c Role switch failed:",e.message),C("/seller-dashboard",{replace:!1}))}catch(e){console.error("\u274c Error switching role:",e),C("/seller-dashboard",{replace:!1})}};return(0,s.jsxs)("nav",{className:M,children:[(0,s.jsxs)("div",{className:"buyer-navbar-container",children:[(0,s.jsxs)("div",{className:"buyer-navbar-content",children:[(0,s.jsx)(n.N_,{to:"/buyer-dashboard",className:"navbar-logo",children:(0,s.jsx)("div",{className:"logo-container",children:(0,s.jsx)("img",{src:"/finallogo.png",alt:"India Propertys",className:"logo-image"})})}),(0,s.jsxs)("div",{className:"buyer-nav-links-desktop",children:[(0,s.jsx)(n.N_,{to:"/buyer-dashboard",className:"buyer-nav-link ".concat(L("/buyer-dashboard")||L("/BuyerHome")?"active":""),children:(0,s.jsx)("span",{children:"Home"})}),(0,s.jsx)(n.N_,{to:"/buy",className:"buyer-nav-link ".concat(L("/buy")?"active":""),children:(0,s.jsx)("span",{children:"Buy"})}),(0,s.jsx)(n.N_,{to:"/rent",className:"buyer-nav-link ".concat(L("/rent")?"active":""),children:(0,s.jsx)("span",{children:"Rent"})}),(0,s.jsx)(n.N_,{to:"/pghostel",className:"buyer-nav-link ".concat(L("/pghostel")?"active":""),children:(0,s.jsx)("span",{children:"PG / Hostel"})}),(0,s.jsx)(n.N_,{to:"/BuyerProfile",className:"buyer-nav-link ".concat(L("/BuyerProfile")?"active":""),onClick:R,children:(0,s.jsx)("span",{children:"Profile"})}),(0,s.jsx)(n.N_,{to:"/ChatUs",className:"buyer-nav-link ".concat(L("/ChatUs")?"active":""),onClick:D,children:(0,s.jsx)("span",{children:"Chats"})}),(0,s.jsx)(n.N_,{to:"/BuyerContactPage",className:"buyer-nav-link ".concat(L("/BuyerContactPage")?"active":""),children:(0,s.jsx)("span",{children:"Contact"})}),(0,s.jsxs)("button",{className:"buyer-switch-seller-btn",title:"Switch to Seller Dashboard",onClick:V,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",style:{marginRight:"6px"},children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,s.jsx)("span",{children:"Sell Property"})]}),(0,s.jsxs)("div",{className:"buyer-user-header",ref:E,onClick:()=>{w(!b)},children:[(0,s.jsx)("div",{className:"buyer-user-avatar",children:null!==p&&void 0!==p&&p.profile_image&&!j?(0,s.jsx)("img",{src:p.profile_image,alt:p.full_name||"User",onError:()=>S(!0)}):(0,s.jsx)("span",{children:(null===p||void 0===p||null===(t=p.full_name)||void 0===t||null===(r=t.charAt(0))||void 0===r?void 0:r.toUpperCase())||(null===p||void 0===p||null===(i=p.email)||void 0===i||null===(o=i.charAt(0))||void 0===o?void 0:o.toUpperCase())||"U"})}),b&&(0,s.jsx)("div",{className:"buyer-user-dropdown",children:p?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"buyer-user-dropdown-greeting",children:[(0,s.jsxs)("span",{className:"buyer-greeting-text",children:["Hello, ",(null===p||void 0===p?void 0:p.first_name)||(null!==p&&void 0!==p&&p.full_name?p.full_name.split(" ")[0]:"User")]}),(0,s.jsx)("svg",{className:"buyer-heart-icon",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z",strokeWidth:"0.5"})})]}),(0,s.jsx)("div",{className:"buyer-dropdown-divider"}),(0,s.jsxs)(n.N_,{to:"/BuyerProfile",onClick:e=>{w(!1)},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),"My Profile"]}),(0,s.jsxs)("button",{onClick:P,children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Logout"]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{onClick:B,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M7 11V7a5 5 0 0110 0v4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Login"]}),(0,s.jsxs)("button",{onClick:U,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Sign Up"]})]})})]})]}),(0,s.jsxs)("button",{onClick:()=>_(!y),className:"buyer-mobile-menu-button ".concat(y?"open":""),"aria-label":"Toggle menu",children:[(0,s.jsx)("span",{className:"buyer-menu-icon-line"}),(0,s.jsx)("span",{className:"buyer-menu-icon-line"}),(0,s.jsx)("span",{className:"buyer-menu-icon-line"})]})]}),(0,s.jsx)("div",{className:"buyer-mobile-menu ".concat(y?"open":""),children:(0,s.jsxs)("div",{className:"buyer-mobile-menu-content",children:[(0,s.jsxs)("div",{className:"buyer-mobile-user-info",children:[(0,s.jsx)("div",{className:"buyer-mobile-user-avatar",children:null!==p&&void 0!==p&&p.profile_image&&!j?(0,s.jsx)("img",{src:p.profile_image,alt:p.full_name||"User",onError:()=>S(!0)}):(0,s.jsx)("span",{children:(null===p||void 0===p||null===(a=p.full_name)||void 0===a||null===(c=a.charAt(0))||void 0===c?void 0:c.toUpperCase())||(null===p||void 0===p||null===(u=p.email)||void 0===u||null===(d=u.charAt(0))||void 0===d?void 0:d.toUpperCase())||"U"})}),(0,s.jsxs)("div",{className:"buyer-mobile-user-details",children:[(0,s.jsx)("span",{className:"buyer-mobile-user-name",children:(null===p||void 0===p?void 0:p.full_name)||(null===p||void 0===p||null===(h=p.email)||void 0===h?void 0:h.split("@")[0])||"User"}),(0,s.jsx)("span",{className:"buyer-mobile-user-email",children:(null===p||void 0===p?void 0:p.email)||""})]})]}),(0,s.jsx)(n.N_,{to:"/buyer-dashboard",className:"buyer-mobile-nav-link ".concat(L("/buyer-dashboard")||L("/BuyerHome")?"active":""),children:(0,s.jsx)("span",{children:"Home"})}),(0,s.jsx)(n.N_,{to:"/buy",className:"buyer-mobile-nav-link ".concat(L("/buy")?"active":""),children:(0,s.jsx)("span",{children:"Buy"})}),(0,s.jsx)(n.N_,{to:"/rent",className:"buyer-mobile-nav-link ".concat(L("/rent")?"active":""),children:(0,s.jsx)("span",{children:"Rent"})}),(0,s.jsx)(n.N_,{to:"/pghostel",className:"buyer-mobile-nav-link ".concat(L("/pghostel")?"active":""),children:(0,s.jsx)("span",{children:"PG / Hostel"})}),(0,s.jsx)(n.N_,{to:"/BuyerProfile",className:"buyer-mobile-nav-link ".concat(L("/BuyerProfile")?"active":""),onClick:R,children:(0,s.jsx)("span",{children:"Profile"})}),(0,s.jsx)(n.N_,{to:"/chatus",className:"buyer-mobile-nav-link ".concat(L("/chatus")?"active":""),onClick:D,children:(0,s.jsx)("span",{children:"Chats"})}),(0,s.jsx)(n.N_,{to:"/BuyerContactPage",className:"buyer-mobile-nav-link ".concat(L("/BuyerContactPage")?"active":""),children:(0,s.jsx)("span",{children:"Contact"})}),(0,s.jsxs)("button",{className:"buyer-mobile-switch-btn",title:"Switch to Seller Dashboard",onClick:V,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,s.jsx)("span",{children:"Sell Property"})]}),N?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)(n.N_,{to:O,className:"buyer-mobile-logout-btn",style:{background:"rgba(59, 130, 246, 0.1)",borderColor:"rgba(59, 130, 246, 0.3)",color:"#3b82f6"},onClick:B,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"11",width:"18",height:"11",rx:"2",ry:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M7 11V7a5 5 0 0110 0v4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,s.jsx)("span",{children:"Login"})]}),(0,s.jsxs)(n.N_,{to:z,className:"buyer-mobile-logout-btn",style:{background:"rgba(199, 238, 255, 0.5)",borderColor:"rgba(0, 119, 192, 0.3)",color:"#0077C0",marginTop:"10px"},onClick:U,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,s.jsx)("span",{children:"Sign Up"})]})]}):(0,s.jsxs)("button",{onClick:P,className:"buyer-mobile-logout-btn",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Logout"})]})]})})]}),(0,s.jsx)(Q,{isOpen:I,onClose:()=>k(!1)})]})},ee=()=>{const e=(new Date).getFullYear(),t=()=>{window.scrollTo({top:0,behavior:"instant"})};return(0,s.jsxs)("footer",{className:"buyer-footer",children:[(0,s.jsx)("div",{className:"buyer-footer-wave",children:(0,s.jsx)("svg",{viewBox:"0 0 1200 120",preserveAspectRatio:"none",children:(0,s.jsx)("path",{d:"M321.39,56.44c58-10.79,114.16-30.13,172-41.86,82.39-16.72,168.19-17.73,250.45-.39C823.78,31,906.67,72,985.66,92.83c70.05,18.48,146.53,26.09,214.34,3V0H0V27.35A600.21,600.21,0,0,0,321.39,56.44Z"})})}),(0,s.jsxs)("div",{className:"buyer-footer-container",children:[(0,s.jsxs)("div",{className:"buyer-footer-main",children:[(0,s.jsxs)("div",{className:"buyer-footer-column buyer-footer-about",children:[(0,s.jsx)("div",{className:"buyer-footer-logo",children:(0,s.jsx)("img",{src:"/logoswhite.png",alt:"India Propertys",className:"buyer-footer-logo-image"})}),(0,s.jsx)("p",{className:"buyer-footer-description",children:"360Coordinates is a trusted real estate platform dedicated to helping buyers, sellers, and renters connect seamlessly. We provide verified property listings, transparent pricing, and expert support to make real estate transactions simpler, safer, and faster. Whether you're searching for your dream home or the perfect commercial space, we are here to guide you every step of the way."})]}),(0,s.jsxs)("div",{className:"buyer-footer-column",children:[(0,s.jsx)("h3",{className:"buyer-footer-heading",children:(0,s.jsx)("span",{children:"Quick Links"})}),(0,s.jsxs)("ul",{className:"buyer-footer-links",children:[(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/buyer-about",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"About Us"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/BuyerContactPage",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"Contact"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/buyer-privacy-policy",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"Privacy Policy"})]})}),(0,s.jsx)("li",{children:(0,s.jsxs)(n.N_,{to:"/buyer-terms-conditions",onClick:t,children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M9 5l7 7-7 7"})}),(0,s.jsx)("span",{children:"Terms & Conditions"})]})})]})]}),(0,s.jsxs)("div",{className:"buyer-footer-column",children:[(0,s.jsx)("h3",{className:"buyer-footer-heading",children:(0,s.jsx)("span",{children:"Contact Info"})}),(0,s.jsxs)("ul",{className:"buyer-footer-contact",children:[(0,s.jsx)("li",{children:(0,s.jsxs)("a",{href:"mailto:info@360coordinates.com",style:{textDecoration:"none",color:"inherit",display:"flex",alignItems:"flex-start",gap:"12px"},children:[(0,s.jsx)("div",{className:"buyer-contact-icon",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"})})}),(0,s.jsxs)("div",{className:"buyer-contact-text",children:[(0,s.jsx)("span",{className:"buyer-contact-label",children:"Email"}),(0,s.jsx)("span",{className:"buyer-contact-value",children:"info@360coordinates.com"})]})]})}),(0,s.jsxs)("li",{children:[(0,s.jsx)("div",{className:"buyer-contact-icon",children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]})}),(0,s.jsxs)("div",{className:"buyer-contact-text",children:[(0,s.jsx)("span",{className:"buyer-contact-label",children:"Address"}),(0,s.jsx)("span",{className:"buyer-contact-value",children:"Pune , Maharashtra, India"})]})]})]}),(0,s.jsxs)("div",{className:"buyer-footer-social",children:[(0,s.jsx)("a",{href:"https://www.facebook.com/profile.php?id=61585564109339",target:"_blank",rel:"noopener noreferrer",className:"buyer-social-link","aria-label":"Facebook",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})})}),(0,s.jsx)("a",{href:"https://www.instagram.com/360coordinates_official/",target:"_blank",rel:"noopener noreferrer",className:"buyer-social-link","aria-label":"Instagram",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 0C8.74 0 8.333.015 7.053.072 5.775.132 4.905.333 4.14.63c-.789.306-1.459.717-2.126 1.384S.935 3.35.63 4.14C.333 4.905.131 5.775.072 7.053.012 8.333 0 8.74 0 12s.015 3.667.072 4.947c.06 1.277.261 2.148.558 2.913.306.788.717 1.459 1.384 2.126.667.666 1.336 1.079 2.126 1.384.766.296 1.636.499 2.913.558C8.333 23.988 8.74 24 12 24s3.667-.015 4.947-.072c1.277-.06 2.148-.262 2.913-.558.788-.306 1.459-.718 2.126-1.384.666-.667 1.079-1.335 1.384-2.126.296-.765.499-1.636.558-2.913.06-1.28.072-1.687.072-4.947s-.015-3.667-.072-4.947c-.06-1.277-.262-2.149-.558-2.913-.306-.789-.718-1.459-1.384-2.126C21.319 1.347 20.651.935 19.86.63c-.765-.297-1.636-.499-2.913-.558C15.667.012 15.26 0 12 0zm0 2.16c3.203 0 3.585.016 4.85.071 1.17.055 1.805.249 2.227.415.562.217.96.477 1.382.896.419.42.679.819.896 1.381.164.422.36 1.057.413 2.227.057 1.266.07 1.646.07 4.85s-.015 3.585-.074 4.85c-.061 1.17-.256 1.805-.421 2.227-.224.562-.479.96-.899 1.382-.419.419-.824.679-1.38.896-.42.164-1.065.36-2.235.413-1.274.057-1.649.07-4.859.07-3.211 0-3.586-.015-4.859-.074-1.171-.061-1.816-.256-2.236-.421-.569-.224-.96-.479-1.379-.899-.421-.419-.69-.824-.9-1.38-.165-.42-.359-1.065-.42-2.235-.045-1.26-.061-1.649-.061-4.844 0-3.196.016-3.586.061-4.861.061-1.17.255-1.814.42-2.234.21-.57.479-.96.9-1.381.419-.419.81-.689 1.379-.898.42-.166 1.051-.361 2.221-.421 1.275-.045 1.65-.06 4.859-.06l.045.03zm0 3.678c-3.405 0-6.162 2.76-6.162 6.162 0 3.405 2.76 6.162 6.162 6.162 3.405 0 6.162-2.76 6.162-6.162 0-3.405-2.76-6.162-6.162-6.162zM12 16c-2.21 0-4-1.79-4-4s1.79-4 4-4 4 1.79 4 4-1.79 4-4 4zm7.846-10.405c0 .795-.646 1.44-1.44 1.44-.795 0-1.44-.646-1.44-1.44 0-.794.646-1.439 1.44-1.439.793-.001 1.44.645 1.44 1.439z"})})}),(0,s.jsx)("a",{href:"https://www.youtube.com/@360coordinates",target:"_blank",rel:"noopener noreferrer",className:"buyer-social-link","aria-label":"YouTube",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M23.498 6.186a3.016 3.016 0 0 0-2.122-2.136C19.505 3.545 12 3.545 12 3.545s-7.505 0-9.377.505A3.017 3.017 0 0 0 .502 6.186C0 8.07 0 12 0 12s0 3.93.502 5.814a3.016 3.016 0 0 0 2.122 2.136c1.871.505 9.376.505 9.376.505s7.505 0 9.377-.505a3.015 3.015 0 0 0 2.122-2.136C24 15.93 24 12 24 12s0-3.93-.502-5.814zM9.545 15.568V8.432L15.818 12l-6.273 3.568z"})})}),(0,s.jsx)("a",{href:"https://www.linkedin.com/company/110655303/admin/dashboard/",target:"_blank",rel:"noopener noreferrer",className:"buyer-social-link","aria-label":"LinkedIn",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M20.447 20.452h-3.554v-5.569c0-1.328-.027-3.037-1.852-3.037-1.853 0-2.136 1.445-2.136 2.939v5.667H9.351V9h3.414v1.561h.046c.477-.9 1.637-1.85 3.37-1.85 3.601 0 4.267 2.37 4.267 5.455v6.286zM5.337 7.433c-1.144 0-2.063-.926-2.063-2.065 0-1.138.92-2.063 2.063-2.063 1.14 0 2.064.925 2.064 2.063 0 1.139-.925 2.065-2.064 2.065zm1.782 13.019H3.555V9h3.564v11.452zM22.225 0H1.771C.792 0 0 .774 0 1.729v20.542C0 23.227.792 24 1.771 24h20.451C23.2 24 24 23.227 24 22.271V1.729C24 .774 23.2 0 22.222 0h.003z"})})}),(0,s.jsx)("a",{href:"https://x.com/360coordinates",target:"_blank",rel:"noopener noreferrer",className:"buyer-social-link","aria-label":"X (Twitter)",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"})})})]})]})]}),(0,s.jsx)("div",{className:"buyer-footer-bottom",children:(0,s.jsx)("div",{className:"buyer-footer-bottom-content",children:(0,s.jsxs)("p",{className:"buyer-footer-copyright",children:["\xa9 ",e," ",(0,s.jsx)("span",{className:"buyer-copyright-brand",children:"360Coordinates"}),". All rights reserved."]})})})]})]})},te=t=>{let{status:r=null,title:i="Find Your Dream Property",subtitle:o="Search from thousands of verified properties across India",backgroundImage:a="/Homeeuserr.jpeg",defaultPropertyType:l=null}=t;const c=(0,n.Zp)(),[u,d]=(0,e.useState)({location:"",propertyType:"",budget:"",bedrooms:"",area:""}),[h,m]=(0,e.useState)(null),f=["Apartment","Studio Apartment","Villa / Row House / Bungalow / Farm House","Penthouse","PG / Hostel"],g=["Plot / Land / Industrial Property","Commercial Office","Commercial Shop","Co-working Space","Warehouse / Godown"],y=["0K-5K","5K-10K","10K-20K","20K-30K","30K-50K","50K-75K","75K-1L","1L-2L","2L+"],v=["0-25L","25L-50L","50L-75L","75L-1Cr","1Cr-2Cr","2Cr-5Cr","5Cr+"],x=["0-50L","50L-1Cr","1Cr-2Cr","2Cr-5Cr","5Cr-10Cr","10Cr-25Cr","25Cr+"],b=["0-10K","10K-25K","25K-50K","50K-1L","1L-2L","2L-5L","5L+"],w=(0,e.useMemo)(()=>f.includes(u.propertyType),[u.propertyType]),j=(0,e.useMemo)(()=>g.includes(u.propertyType),[u.propertyType]),S=(0,e.useMemo)(()=>(()=>{if("For Sale"===r)return u.propertyType&&{Apartment:v,"Studio Apartment":v,"Villa / Row House / Bungalow / Farm House":v,Penthouse:v,"PG / Hostel":v,"Plot / Land / Industrial Property":x,"Commercial Office":x,"Commercial Shop":x,"Co-working Space":x,"Warehouse / Godown":x}[u.propertyType]||v;if("For Rent"===r)return u.propertyType&&{Apartment:y,"Studio Apartment":y,"Villa / Row House / Bungalow / Farm House":y,Penthouse:y,"PG / Hostel":y,"Plot / Land / Industrial Property":b,"Commercial Office":b,"Commercial Shop":b,"Co-working Space":b,"Warehouse / Godown":b}[u.propertyType]||y;return u.propertyType&&{Apartment:v,"Studio Apartment":v,"Villa / Row House / Bungalow / Farm House":v,Penthouse:v,"PG / Hostel":y,"Plot / Land / Industrial Property":x,"Commercial Office":x,"Commercial Shop":x,"Co-working Space":b,"Warehouse / Godown":b}[u.propertyType]||v})(),[u.propertyType,r]),T=e=>{const{name:t,value:r}=e.target;d("propertyType"===t?e=>(0,p.A)((0,p.A)({},e),{},{propertyType:r,bedrooms:"",area:"",budget:""}):"location"===t?e=>(0,p.A)((0,p.A)({},e),{},{location:r}):e=>(0,p.A)((0,p.A)({},e),{},{[t]:r}))},k=a?"".concat("").concat(a):null;return(0,s.jsxs)("div",{className:"buyer-search-bar-hero",children:[k&&(0,s.jsx)("img",{src:k,alt:"",className:"buyer-search-bar-bg-image"}),(0,s.jsx)("div",{className:"buyer-search-bar-container",children:(0,s.jsxs)("div",{className:"buyer-search-bar-wrapper",children:[(0,s.jsx)("h2",{className:"buyer-search-title",children:i}),(0,s.jsx)("p",{className:"buyer-search-subtitle",children:o}),(0,s.jsxs)("form",{className:"buyer-search-form",onSubmit:e=>{console.log("\ud83d\udcdd Form submitted"),(e=>{e&&(e.preventDefault(),e.stopPropagation()),console.log("\ud83d\udd0d Search initiated with data:",u),console.log("\ud83d\udccd Selected location:",h);const t=new URLSearchParams,n=h;let i=null;if(n&&n.city)i=n.city;else if(u.location&&""!==u.location.trim()){const e=u.location.split(",").map(e=>e.trim());e.length>=2?i=e[e.length-2]:1===e.length&&(i=e[0])}else n&&(i=n.city_name||n.cityName||n.locality||n.administrative_area_level_2);i&&i.length>1&&i.length<50?(t.append("city",i),console.log("\u2705 Added city:",i)):console.log("\u26a0\ufe0f No city found to add"),n&&n.placeName?(t.append("location",n.placeName),console.log("\u2705 Added location (placeName):",n.placeName)):u.location&&""!==u.location.trim()&&(t.append("location",u.location.trim()),console.log("\u2705 Added location (searchData):",u.location)),n&&n.coordinates&&n.coordinates.lat&&n.coordinates.lng&&(t.append("lat",String(n.coordinates.lat)),t.append("lng",String(n.coordinates.lng)),t.append("radius","10"),console.log("\u2705 Added coordinates:",n.coordinates));const s=u.propertyType&&""!==u.propertyType.trim()?u.propertyType:l||"";s&&""!==s.trim()&&(t.append("property_type",s),console.log("\u2705 Added property_type:",s,l?"(default from page)":"")),u.budget&&""!==u.budget.trim()&&(t.append("budget",u.budget),console.log("\u2705 Added budget:",u.budget)),w&&u.bedrooms&&""!==u.bedrooms.trim()?(t.append("bedrooms",u.bedrooms),console.log("\u2705 Added bedrooms:",u.bedrooms)):j&&u.area&&""!==u.area.trim()&&(t.append("area",u.area),console.log("\u2705 Added area:",u.area)),r&&(t.append("status",r),console.log("\u2705 Added status:",r));const o=t.toString(),a=o?"/buyer-dashboard/search?".concat(o):"/buyer-dashboard/search";console.log("\ud83d\ude80 Navigating to:",a),console.log("\ud83d\udccb Query params:",o),c(a),setTimeout(()=>{window.scrollTo({top:0,behavior:"smooth"})},100)})(e)},noValidate:!0,children:[(0,s.jsxs)("div",{className:"buyer-search-inputs",children:[(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"location",className:"buyer-search-label",children:[(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Location"]}),(0,s.jsx)(_,{placeholder:"City / Locality",value:u.location,onChange:e=>{if(!e)return m(null),void d(e=>(0,p.A)((0,p.A)({},e),{},{location:""}));let t=e.city||"";if(!t&&(e.fullAddress||e.placeName)){const r=(e.fullAddress||e.placeName||"").trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);r.length>=2?t=r[1]:1===r.length&&(t=r[0])}m((0,p.A)((0,p.A)({},e),{},{city:t})),d(t=>(0,p.A)((0,p.A)({},t),{},{location:e.fullAddress||e.placeName||""}))}})]}),(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"propertyType",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Property Type"]}),(0,s.jsxs)("select",{id:"propertyType",name:"propertyType",value:u.propertyType,onChange:T,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"All Types"}),["Apartment","Studio Apartment","Villa / Row House / Bungalow / Farm House","Penthouse","Plot / Land / Industrial Property","Commercial Office","Commercial Shop","Co-working Space","Warehouse / Godown","PG / Hostel"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"budget",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Budget"]}),(0,s.jsxs)("select",{id:"budget",name:"budget",value:u.budget,onChange:T,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Budget"}),S.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsx)("div",{className:"buyer-search-field",children:w?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{htmlFor:"bedrooms",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Bedrooms"]}),(0,s.jsxs)("select",{id:"bedrooms",name:"bedrooms",value:u.bedrooms,onChange:T,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any"}),["1 BHK","2 BHK","3 BHK","4 BHK","5+ BHK"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}):j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{htmlFor:"area",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4"})}),"Area"]}),(0,s.jsxs)("select",{id:"area",name:"area",value:u.area,onChange:T,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Area"}),["0-500 sq ft","500-1000 sq ft","1000-2000 sq ft","2000-5000 sq ft","5000-10000 sq ft","10000+ sq ft"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("label",{htmlFor:"bedrooms",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Bedroom / Area"]}),(0,s.jsx)("select",{id:"bedrooms",name:"bedrooms",value:u.bedrooms,onChange:T,className:"buyer-search-select",disabled:!0,children:(0,s.jsx)("option",{value:"",children:"Select Property Type"})})]})})]}),(0,s.jsxs)("button",{type:"submit",className:"buyer-search-button",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("span",{children:"Search Properties"})]})]}),(0,s.jsxs)("div",{className:"buyer-quick-search",children:[(0,s.jsx)("span",{className:"buyer-quick-search-label",children:"Popular Cities:"}),(0,s.jsx)("div",{className:"buyer-quick-search-buttons",children:["Mumbai","Delhi","Bangalore","Hyderabad","Ahmedabad","Chennai","Kolkata","Pune","Jaipur","Surat"].map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>(e=>{const t=new URLSearchParams;t.append("city",e),t.append("location",e),r&&t.append("status",r),c("/buyer-dashboard/search?".concat(t.toString()))})(e),className:"buyer-quick-search-btn",children:e},e))})]})]})})]})},re={getFavorites:()=>{try{const e=localStorage.getItem("upcomingProjectFavorites");return e?JSON.parse(e):[]}catch(e){return console.error("Error reading upcoming project favorites:",e),[]}},saveFavorites:e=>{try{localStorage.setItem("upcomingProjectFavorites",JSON.stringify(e))}catch(t){console.error("Error saving upcoming project favorites:",t)}},toggleFavorite:e=>{const t=re.getFavorites(),r=t.indexOf(e);return r>-1?t.splice(r,1):t.push(e),re.saveFavorites(t),t},isFavorite:e=>re.getFavorites().includes(e),getFavoriteProjects:e=>{const t=re.getFavorites();return(e||[]).filter(e=>t.includes(e.id))}},ne=t=>{let{project:i,onFavoriteToggle:o}=t;(0,n.Zp)();const[a,l]=(0,e.useState)(!1),[c,u]=(0,e.useState)(!1);(0,e.useEffect)(()=>{(async()=>{try{const e=re.isFavorite(i.id);u(e);if(localStorage.getItem("authToken")){const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.list();if(t.success&&t.data){const e=(t.data.properties||t.data.favorites||[]).map(e=>e.id||e.property_id);u(e.includes(i.id))}}}catch(e){console.error("Error checking favorite status:",e),u(re.isFavorite(i.id))}})()},[i.id]);const{id:d,image:h,title:p,location:m,priceRange:f,bhkType:g,projectStatus:y}=i,_=y||"Upcoming",v="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",x=h&&""!==h.trim()?h:v,b=async e=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),l(!0),void setTimeout(()=>l(!1),2e3);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")&&(l(!0),setTimeout(()=>l(!1),2e3))}finally{document.body.removeChild(t)}}catch(t){console.error("Failed to copy to clipboard:",t)}},w="\u20b9".concat(f," Cr");return(0,s.jsxs)("div",{className:"upcoming-project-card",onClick:e=>{e.target.closest("button")||e.target.closest("a")||window.open("/upcoming-project/".concat(d),"_blank","noopener,noreferrer")},children:[(0,s.jsxs)("div",{className:"upcoming-project-image-container",children:[(0,s.jsx)("img",{src:x,alt:p||"Project image",className:"upcoming-project-image",onError:e=>{console.warn("Image failed to load:",x,"for project:",p),e.target.src=v,e.target.onerror=null},loading:"lazy"}),(0,s.jsx)("span",{className:"upcoming-project-status",children:_}),(0,s.jsx)("button",{className:"upcoming-favourite-btn ".concat(c?"active":""),onClick:async e=>{e.preventDefault(),e.stopPropagation();try{const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.toggle(i.id);t.success?(u(void 0!==t.data.is_favorite?t.data.is_favorite:!c),re.toggleFavorite(i.id),o&&o()):console.error("Failed to toggle favorite:",t.message)}catch(t){console.error("Error toggling favorite:",t),re.toggleFavorite(i.id),u(!c)}},"aria-label":c?"Remove from favorites":"Add to favorites",title:c?"Remove from favorites":"Add to favorites",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:c?"white":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),(0,s.jsx)("button",{className:"upcoming-share-btn",onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),!i||!i.id)return void console.error("Cannot share: project ID is missing");const t="".concat(window.location.origin,"/upcoming-project/").concat(i.id),r={title:i.title||"Upcoming Project",text:"Check out this upcoming project: ".concat(i.title||"Amazing Project"),url:t};if(navigator.share)try{await navigator.share(r),console.log("Share successful")}catch(n){"AbortError"!==n.name&&(console.error("Error sharing:",n),await b(t))}else await b(t)},"aria-label":"Share project",title:"Share project",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,s.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,s.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,s.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,s.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})}),a&&(0,s.jsx)("div",{className:"upcoming-share-toast",children:"Link copied!"})]}),(0,s.jsxs)("div",{className:"upcoming-project-content",children:[(0,s.jsx)("h3",{className:"upcoming-project-title",children:p}),(0,s.jsxs)("div",{className:"upcoming-project-location",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),(0,s.jsx)("span",{children:m})]}),(0,s.jsxs)("div",{className:"upcoming-project-details",children:[g&&"N/A"!==g&&(0,s.jsxs)("div",{className:"upcoming-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M2 17l6-6 4 4 8-8"}),(0,s.jsx)("path",{d:"M17 2h5v5"})]}),(0,s.jsx)("span",{children:g})]}),(0,s.jsxs)("div",{className:"upcoming-detail-item",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",ry:"2"}),(0,s.jsx)("line",{x1:"9",y1:"3",x2:"9",y2:"21"})]}),(0,s.jsx)("span",{children:_})]})]}),(0,s.jsxs)("div",{className:"upcoming-project-footer",children:[(0,s.jsxs)("div",{className:"upcoming-project-price",children:[(0,s.jsx)("span",{className:"upcoming-price-label",children:"Price Range"}),(0,s.jsx)("span",{className:"upcoming-price-value",children:w})]}),(0,s.jsx)("button",{className:"upcoming-view-details-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),window.open("/upcoming-project/".concat(d),"_blank","noopener,noreferrer")},children:"View Details"})]})]})]})},ie=()=>{const t=(0,n.Zp)(),[r,o]=(0,e.useState)([]),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(null),d=e=>{e.preventDefault(),e.stopPropagation(),t("/buyer-dashboard/search?searchMode=upcoming-projects&project_type=upcoming")};return(0,e.useEffect)(()=>{(async()=>{try{l(!0),u(null);const e=await i.propertiesAPI.list({limit:50,project_type:"upcoming"});if(e.success&&e.data&&e.data.properties){const t=e.data.properties.map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500");let r={};try{"string"===typeof e.upcoming_project_data?r=JSON.parse(e.upcoming_project_data):"object"===typeof e.upcoming_project_data&&(r=e.upcoming_project_data)}catch(a){console.warn("Failed to parse upcoming_project_data:",a)}const n=(e=>{if(!e)return"Unknown";const t=["Mumbai","Delhi","Bangalore","Hyderabad","Chennai","Pune","Kolkata","Ahmedabad","Jaipur","Surat"],r=e.toUpperCase();for(const i of t)if(r.includes(i.toUpperCase()))return i;const n=e.split(",");return n.length>1?n[n.length-1].trim():e.split(" ")[0]})(e.location),i=(e=>{if(!e||!Array.isArray(e)||0===e.length)return"N/A";const t=e.filter(e=>e&&(e.includes("BHK")||e.includes("bhk"))).map(e=>{const t=e.match(/(\d+)\s*BHK/i);return t?"".concat(t[1]," BHK"):e}).filter((e,t,r)=>r.indexOf(e)===t).sort((e,t)=>{var r,n;return parseInt((null===(r=e.match(/\d+/))||void 0===r?void 0:r[0])||"0")-parseInt((null===(n=t.match(/\d+/))||void 0===n?void 0:n[0])||"0")});return 0===t.length?e.some(e=>e.toLowerCase().includes("villa"))?"Villa":e.some(e=>e.toLowerCase().includes("plot"))?"Plot":e.join(", "):t.join(", ")})(r.configurations),s=(o=e.price)?(o/1e7).toFixed(1):"0";var o;return{id:e.id,image:t,title:e.title,location:e.location,city:n,bhkType:i,priceRange:s,projectStatus:r.projectStatus,builder:r.builderName||e.seller_name||"Builder",builderLink:"#builder-".concat(e.id),upcomingData:r,propertyData:e}});o(t),console.log("\u2705 Loaded",t.length,"upcoming projects from API")}else o([])}catch(e){console.error("Error fetching upcoming projects:",e),u("Failed to load upcoming projects"),o([])}finally{l(!1)}})()},[]),a?(0,s.jsxs)("div",{className:"upcoming-projects-section",children:[(0,s.jsx)("div",{className:"upcoming-section-header",children:(0,s.jsxs)("div",{className:"buyer-section-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"upcoming-section-title",children:"Explore Projects"}),(0,s.jsx)("p",{className:"upcoming-section-subtitle",children:"Visit these projects and get benefits before the official launch!"})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:d,"aria-label":"View all upcoming projects",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading upcoming projects..."})})]}):c?(0,s.jsxs)("div",{className:"upcoming-projects-section",children:[(0,s.jsx)("div",{className:"upcoming-section-header",children:(0,s.jsxs)("div",{className:"buyer-section-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"upcoming-section-title",children:" Explore Projects"}),(0,s.jsx)("p",{className:"upcoming-section-subtitle",children:"Visit these projects and get benefits before the official launch!"})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:d,"aria-label":"View all upcoming projects",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem",color:"#c33"},children:(0,s.jsx)("p",{children:c})})]}):0===r.length?null:(0,s.jsxs)("div",{className:"upcoming-projects-section",children:[(0,s.jsx)("div",{className:"upcoming-section-header",children:(0,s.jsxs)("div",{className:"buyer-section-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h2",{className:"upcoming-section-title",children:"Explore Projects"}),(0,s.jsx)("p",{className:"upcoming-section-subtitle",children:"Visit these projects and get benefits before the official launch!"})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:d,"aria-label":"View all upcoming projects",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),(0,s.jsx)("div",{className:"upcoming-horizontal-scroll-container",children:(0,s.jsx)("div",{className:"upcoming-projects-wrapper",children:r.map(e=>(0,s.jsx)(ne,{project:e},e.id))})})]})},se=()=>{const t=(0,n.Zp)(),[r,o]=(0,e.useState)([]),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(""),[d,h]=(0,e.useState)(!1),p=(0,e.useRef)(null),m=(0,e.useRef)(null),f=(0,e.useRef)(null),g=(0,e.useRef)(null),y=(0,e.useRef)(!1),_=(0,e.useRef)(!1);(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),(0,e.useLayoutEffect)(()=>{const e=!_.current&&d;if(_.current=d,!e||!p.current||!m.current)return;const t=p.current,r=m.current,n=window.getComputedStyle(r).transform;let i=0;if(n&&"none"!==n){const e=n.match(/matrix\((.+)\)/);if(e){const t=e[1].split(",").map(e=>parseFloat(e.trim()));t.length>=6&&(i=t[4])}}t.scrollLeft=Math.max(0,-i),r.style.transform="translateX(0)"},[d]),(0,e.useLayoutEffect)(()=>{const e=_.current&&!d;if(_.current=d,!e||!p.current||!m.current)return;const t=p.current,r=m.current,n=t.scrollLeft,i=r.scrollWidth;if(t.scrollLeft=0,r.style.transform="",i>0&&n>0){const e=800*n/i;r.style.animation="buyer-auto-scroll 400s linear infinite",r.style.animationDelay="-".concat(e,"s")}else r.style.animation="",r.style.animationDelay=""},[d]),(0,e.useEffect)(()=>{(async()=>{try{l(!0),u("");const e=await i.propertiesAPI.list({limit:50});if(e.success&&e.data&&e.data.properties){const t=e.data.properties.map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}return t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"),{id:e.id,image:t,title:e.title,price:parseFloat(e.price),location:e.location,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area),type:e.property_type,status:"sale"===e.status?"For Sale":"rent"===e.status?"For Rent":e.status,propertyType:e.property_type,projectType:e.project_type||null,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?[e.amenities]:[],images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone}}).filter(e=>!e.projectType||"upcoming"!==e.projectType);o(t),console.log("\u2705 Loaded",t.length,"regular properties from backend (upcoming projects excluded)")}else o([]),u("No properties available")}catch(e){o([]),u("Failed to load properties. Please try again later."),console.error("Error fetching properties:",e)}finally{l(!1)}})()},[]);const v=(0,e.useCallback)(()=>{f.current&&clearTimeout(f.current),h(!0)},[]),x=(0,e.useCallback)(()=>{f.current&&clearTimeout(f.current),f.current=setTimeout(()=>{h(!1)},500)},[]),b=(0,e.useCallback)(()=>{h(!0)},[]),w=(0,e.useCallback)(()=>{y.current||h(!1)},[]),j=(0,e.useCallback)(()=>{h(!0)},[]),T=(0,e.useCallback)(()=>{g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{h(!1)},2e3)},[]),k=(0,e.useCallback)(()=>{y.current=!0,h(!0),g.current&&clearTimeout(g.current),g.current=setTimeout(()=>{y.current=!1,h(!1)},3e3)},[]);(0,e.useEffect)(()=>()=>{f.current&&clearTimeout(f.current),g.current&&clearTimeout(g.current)},[]);const A=e=>{t("/buyer-dashboard/search?city=".concat(encodeURIComponent(e)))};return(0,s.jsxs)("div",{className:"buyer-page-wrapper home-page",children:[(0,s.jsx)(te,{}),(0,s.jsx)(ie,{}),(0,s.jsxs)("div",{className:"buyer-home-properties-section",children:[(0,s.jsx)("div",{className:"buyer-section-header",children:(0,s.jsxs)("div",{className:"buyer-section-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:"Explore Properties"}),(0,s.jsx)("p",{children:"Buy or Rent \u2014 All in One Place"})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),t("/buyer-dashboard/search")},"aria-label":"View all properties",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),a?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading properties..."})}):c?(0,s.jsxs)("div",{style:{textAlign:"center",padding:"2rem",color:"#c33"},children:[(0,s.jsx)("p",{children:c}),(0,s.jsx)("button",{onClick:()=>window.location.reload(),style:{marginTop:"1rem",padding:"0.5rem 1rem",cursor:"pointer"},children:"Retry"})]}):0===r.length?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"No properties available at the moment."})}):(0,s.jsx)("div",{className:"buyer-horizontal-scroll-container buyer-auto-scroll-container ".concat(d?"paused":""),ref:p,onMouseEnter:b,onMouseLeave:w,onTouchStart:j,onTouchEnd:T,onScroll:k,children:(0,s.jsxs)("div",{className:"buyer-property-cards-wrapper buyer-auto-scroll-wrapper",ref:m,children:[r.map(e=>(0,s.jsx)(S,{property:e,onCarouselInteractionStart:v,onCarouselInteractionEnd:x,onCardMouseEnter:b,onCardMouseLeave:w},"original-".concat(e.id))),r.map(e=>(0,s.jsx)(S,{property:e,onCarouselInteractionStart:v,onCarouselInteractionEnd:x,onCardMouseEnter:b,onCardMouseLeave:w},"duplicate-".concat(e.id)))]})})]}),(0,s.jsxs)("div",{className:"buyer-city-projects-section",children:[(0,s.jsxs)("div",{className:"buyer-section-header",children:[(0,s.jsx)("h2",{children:"Browse Residential Projects in Top Cities"}),(0,s.jsx)("p",{children:"Explore premium residential projects across India"})]}),(0,s.jsx)("div",{className:"buyer-city-projects-grid",children:[{name:"Mumbai",image:"/city-projects/Mumbai.jpg"},{name:"Delhi",image:"/city-projects/Delhi.jpg"},{name:"Bangalore",image:"/city-projects/Banglore.jpg"},{name:"Hyderabad",image:"/city-projects/Hydrabad.jpg"},{name:"Chennai",image:"/city-projects/Chennai.jpg"},{name:"Pune",image:"/city-projects/Pune.jpg"},{name:"Kolkata",image:"/city-projects/Kolkata.jpg"},{name:"Ahmedabad",image:"/city-projects/Ahmedabad.jpg"}].map(e=>(0,s.jsxs)("div",{className:"buyer-city-project-card",onClick:()=>A(e.name),onKeyDown:t=>((e,t)=>{"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),A(t))})(t,e.name),tabIndex:0,role:"button","aria-label":"Explore projects in ".concat(e.name),style:{backgroundImage:"url(".concat(e.image,")")},children:[(0,s.jsx)("div",{className:"buyer-city-project-overlay"}),(0,s.jsxs)("div",{className:"buyer-city-project-content",children:[(0,s.jsx)("h3",{className:"buyer-city-project-name",children:e.name}),(0,s.jsx)("p",{className:"buyer-city-project-subtitle",children:"Explore Projects"}),(0,s.jsx)("div",{className:"buyer-city-project-arrow",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M5 12h14"}),(0,s.jsx)("path",{d:"m12 5 7 7-7 7"})]})})]})]},e.name))})]})]})},oe=()=>{var t,o;const{user:a,login:c}=l(),u=(0,n.Zp)(),d=(0,e.useRef)(null),h=(0,e.useRef)(null),m=(0,e.useRef)(null),f=(0,e.useRef)(null);(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const[g,y]=(0,e.useState)(!1),[_,v]=(0,e.useState)(!1),[x,b]=(0,e.useState)(!1),[T,k]=(0,e.useState)(null),[A,C]=(0,e.useState)(null!==a&&void 0!==a&&a.profile_image&&""!==a.profile_image.trim()?a.profile_image:null),[E,N]=(0,e.useState)({firstName:(null===a||void 0===a||null===(t=a.full_name)||void 0===t?void 0:t.split(" ")[0])||(null===a||void 0===a?void 0:a.first_name)||"",lastName:(null===a||void 0===a||null===(o=a.full_name)||void 0===o?void 0:o.split(" ").slice(1).join(" "))||(null===a||void 0===a?void 0:a.last_name)||"",email:(null===a||void 0===a?void 0:a.email)||"",phone:(null===a||void 0===a?void 0:a.phone)||"",whatsappNumber:"",alternateMobile:"",address:""}),[I,P]=(0,e.useState)(!1);(0,e.useEffect)(()=>{(async()=>{if(a)try{const r=await i.Hs.get();if(r.success&&r.data&&r.data.profile){var e;const t=r.data.profile,n=(null===(e=t.full_name)||void 0===e?void 0:e.split(" "))||[];N({firstName:n[0]||t.first_name||"",lastName:n.slice(1).join(" ")||t.last_name||"",email:t.email||"",phone:t.phone||"",whatsappNumber:t.whatsapp_number||"",alternateMobile:t.alternate_mobile||"",address:t.address||""}),C(t.profile_image&&""!==t.profile_image.trim()?t.profile_image:null)}else{var t;const e=(null===(t=a.full_name)||void 0===t?void 0:t.split(" "))||[];N({firstName:e[0]||a.first_name||"",lastName:e.slice(1).join(" ")||a.last_name||"",email:a.email||"",phone:a.phone||"",whatsappNumber:"",alternateMobile:"",address:""}),C(a.profile_image&&""!==a.profile_image.trim()?a.profile_image:null)}}catch(n){var r;console.error("Error loading profile:",n);const e=(null===(r=a.full_name)||void 0===r?void 0:r.split(" "))||[];N({firstName:e[0]||a.first_name||"",lastName:e.slice(1).join(" ")||a.last_name||"",email:a.email||"",phone:a.phone||"",address:""}),C(a.profile_image||null)}})()},[a]);const M=()=>{f.current&&(f.current.getTracks().forEach(e=>e.stop()),f.current=null),m.current&&(m.current.srcObject=null),b(!1),k(null)},L=async e=>{if(!e)return;if(!["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type))return void alert("Please select a valid image file (JPEG, PNG, or WebP)");if(e.size>5242880)alert("Image size should be less than 5MB");else{y(!0),v(!1);try{const r=await i.v5.uploadProfileImage(e);if(!(r.success&&r.data&&r.data.url))throw new Error(r.message||"Upload failed");{const e=r.data.url.trim();if(C(""!==e?e:null),a){const e=(0,p.A)((0,p.A)({},a),{},{profile_image:r.data.url});localStorage.setItem("userData",JSON.stringify(e))}try{const e=await i.R2.verifyToken();e.success&&e.data}catch(t){console.error("Error refreshing user data:",t)}alert("Profile image uploaded successfully!")}}catch(t){console.error("Error uploading image:",t),alert(t.message||"Failed to upload image. Please try again.")}finally{y(!1),d.current&&(d.current.value=""),h.current&&(h.current.value="")}}},[R,D]=(0,e.useState)([]),[F,O]=(0,e.useState)(!1),[z,B]=(0,e.useState)([]),[U,V]=(0,e.useState)(new Date),[q,W]=(0,e.useState)("profile");(0,e.useEffect)(()=>{"favorites"===q&&Z()},[q,a]),(0,e.useEffect)(()=>{H()},[a]),(0,e.useEffect)(()=>{"history"===q&&H()},[q]),(0,e.useEffect)(()=>{if("history"===q&&z.length>0){const e=setInterval(()=>{V(new Date)},6e4);return()=>clearInterval(e)}},[q,z.length]);const H=async()=>{try{const e=[...await j.getHistory()].sort((e,t)=>{const r=new Date(e.created_at||0);return new Date(t.created_at||0)-r});B(e)}catch(e){console.error("Error loading history:",e),B([])}},G=e=>{try{if(!e)return console.warn("Missing created_at timestamp in history entry"),"Recently";const t=new Date(e);if(isNaN(t.getTime()))return console.warn("Invalid created_at timestamp:",e),"Recently";const r=U,n=r-t,i=Math.floor(n/6e4),s=Math.floor(n/36e5),o=Math.floor(n/864e5),a=new Date(r);a.setHours(0,0,0,0);const l=new Date(t);l.setHours(0,0,0,0);const c=l.getTime()===a.getTime(),u=new Date(a);u.setDate(u.getDate()-1);const d=l.getTime()===u.getTime();if(i<1)return"Just now";if(i<60)return"".concat(i," minute").concat(1!==i?"s":""," ago");if(s<24&&c)return"".concat(s," hour").concat(1!==s?"s":""," ago");if(d)return"Yesterday";if(o<7)return"".concat(o," day").concat(1!==o?"s":""," ago");{const e=t.getDate(),r=t.toLocaleDateString("en-US",{month:"short"}),n=t.getFullYear();return"".concat(e," ").concat(r," ").concat(n)}}catch(t){return console.error("Error formatting history date:",t),"Recently"}},Z=async()=>{if(a){O(!0);try{const{favoritesAPI:t}=await Promise.resolve().then(r.bind(r,376)),n=await t.list();if(n.success&&n.data){const e=(n.data.properties||n.data.favorites||[]).map(e=>({id:e.id||e.property_id,title:e.title,location:e.location,price:parseFloat(e.price)||0,image:e.cover_image||(e.images&&Array.isArray(e.images)&&e.images.length>0?e.images[0]:"string"===typeof e.images?e.images:null),images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],bedrooms:e.bedrooms,bathrooms:e.bathrooms,area:parseFloat(e.area)||0,status:"sale"===e.status?"For Sale":"rent"===e.status?"For Rent":e.status||"For Sale"}));D(e)}else{const t=w.getFavorites();if(t.length>0)try{const{propertiesAPI:e}=await Promise.resolve().then(r.bind(r,376)),n=t.map(t=>e.getDetails(t).catch(()=>null)),i=(await Promise.all(n)).filter(e=>e&&e.success&&e.data&&e.data.property).map(e=>{const t=e.data.property;return{id:t.id,title:t.title,location:t.location,price:parseFloat(t.price)||0,image:t.cover_image||(t.images&&Array.isArray(t.images)&&t.images.length>0?t.images[0]:null),images:Array.isArray(t.images)?t.images:[],bedrooms:t.bedrooms,bathrooms:t.bathrooms,area:parseFloat(t.area)||0,status:"sale"===t.status?"For Sale":"rent"===t.status?"For Rent":"For Sale"}});D(i)}catch(e){console.error("Error fetching favorite properties:",e),D([])}else D([])}}catch(e){console.error("Error loading favorites:",e),D([])}finally{O(!1)}}else D([])},K=()=>{Z()},Y=e=>{const{name:t,value:r}=e.target,n="firstName"===t||"lastName"===t?r.toUpperCase():r;N((0,p.A)((0,p.A)({},E),{},{[t]:n}))};(0,e.useEffect)(()=>{const e=e=>{_&&!e.target.closest(".buyer-avatar-upload-wrapper")&&v(!1)};return document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[_]),(0,e.useEffect)(()=>()=>{f.current&&(f.current.getTracks().forEach(e=>e.stop()),f.current=null),m.current&&(m.current.srcObject=null)},[]);const X=!!a;return(0,s.jsxs)("div",{className:"buyer-seller-profile",children:[(0,s.jsxs)("div",{className:"buyer-profile-wrapper ".concat(X?"":"buyer-profile-blurred"),children:[(0,s.jsxs)("div",{className:"buyer-profile-header",children:[(0,s.jsx)("h1",{children:"Profile Settings"}),(0,s.jsxs)("div",{className:"buyer-profile-section-toggle",children:[(0,s.jsxs)("button",{className:"buyer-section-btn ".concat("profile"===q?"active":""),onClick:()=>W("profile"),children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z"})}),"Profile Info"]}),(0,s.jsxs)("button",{className:"buyer-section-btn ".concat("favorites"===q?"active":""),onClick:()=>W("favorites"),children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),"My Favorites (",R.length,")"]}),(0,s.jsxs)("button",{className:"buyer-section-btn ".concat("history"===q?"active":""),onClick:()=>W("history"),children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,s.jsx)("path",{d:"M12 6v6l4 2"})]}),"History (",z.length,")"]})]})]}),"profile"===q?(0,s.jsxs)("div",{className:"buyer-profile-content",children:[(0,s.jsxs)("div",{className:"buyer-profile-card",children:[(0,s.jsxs)("div",{className:"buyer-profile-avatar-section",children:[(0,s.jsxs)("div",{className:"buyer-avatar-container",children:[(0,s.jsx)("input",{type:"file",ref:d,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&L(r)},style:{display:"none"}}),(0,s.jsx)("input",{type:"file",ref:h,accept:"image/*",capture:"environment",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&L(r)},style:{display:"none"}}),(0,s.jsx)("img",{src:A&&""!==A.trim()?A:"https://ui-avatars.com/api/?name=".concat(encodeURIComponent((null===a||void 0===a?void 0:a.full_name)||(null===a||void 0===a?void 0:a.first_name)||"User"),"&background=886ace&color=fff&size=200"),alt:"Profile",className:"buyer-profile-avatar",onError:e=>{e.target.src="https://ui-avatars.com/api/?name=".concat(encodeURIComponent((null===a||void 0===a?void 0:a.full_name)||(null===a||void 0===a?void 0:a.first_name)||"User"),"&background=886ace&color=fff&size=200")}}),(0,s.jsxs)("div",{className:"buyer-avatar-upload-wrapper",children:[(0,s.jsx)("button",{className:"buyer-avatar-upload-btn",onClick:()=>v(!_),disabled:g,title:"Change profile photo",children:g?(0,s.jsx)("div",{className:"buyer-upload-spinner"}):(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"white",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"white",strokeWidth:"2"})]})}),_&&!g&&(0,s.jsxs)("div",{className:"buyer-image-upload-menu",children:[(0,s.jsxs)("button",{onClick:()=>{var e;null===(e=d.current)||void 0===e||e.click()},className:"buyer-upload-menu-item",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Upload from Device"})]}),(0,s.jsxs)("button",{onClick:async()=>{v(!1);try{const e=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment"}});f.current=e,b(!0),setTimeout(()=>{m.current&&e&&(m.current.srcObject=e)},100)}catch(e){console.error("Error accessing camera:",e),"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?alert("Camera access denied. Please allow camera permission in your browser settings."):"NotFoundError"===e.name||"DevicesNotFoundError"===e.name?alert("No camera found on this device."):alert('Unable to access camera. Please try using "Upload from Device" instead.')}},className:"buyer-upload-menu-item",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Take Photo"})]})]})]})]}),(0,s.jsxs)("div",{className:"buyer-profile-name-section",children:[(0,s.jsx)("h2",{children:(null===a||void 0===a?void 0:a.full_name)||(null===a||void 0===a?void 0:a.first_name)+" "+(null===a||void 0===a?void 0:a.last_name)||"User"}),(0,s.jsx)("p",{className:"buyer-profile-role",children:"buyer"===(null===a||void 0===a?void 0:a.user_type)?"Buyer":"seller"===(null===a||void 0===a?void 0:a.user_type)?"Seller":"agent"===(null===a||void 0===a?void 0:a.user_type)?"Agent":"User"}),(0,s.jsxs)("div",{className:"buyer-profile-badges",children:[(null===a||void 0===a?void 0:a.email_verified)&&(0,s.jsx)("span",{className:"buyer-badge buyer-verified",children:"Verified"}),"agent"===(null===a||void 0===a?void 0:a.user_type)&&(0,s.jsx)("span",{className:"buyer-badge buyer-pro-agent",children:"Pro Agent"})]})]})]}),(0,s.jsxs)("div",{className:"buyer-profile-member-since",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(e=>{try{const t=e?new Date(e):new Date;if(isNaN(t.getTime())){const e=new Date,t=e.toLocaleDateString("en-US",{month:"long"}),r=e.getFullYear();return"Member since ".concat(t," ").concat(r)}const r=t.toLocaleDateString("en-US",{month:"long"}),n=t.getFullYear();return"Member since ".concat(r," ").concat(n)}catch(t){const e=new Date,r=e.toLocaleDateString("en-US",{month:"long"}),n=e.getFullYear();return"Member since ".concat(r," ").concat(n)}})(null===a||void 0===a?void 0:a.created_at)]})]}),(0,s.jsxs)("div",{className:"buyer-profile-form-card",children:[(0,s.jsx)("h3",{children:"Personal Information"}),(0,s.jsxs)("div",{className:"buyer-form-row",children:[(0,s.jsxs)("div",{className:"buyer-form-group",children:[(0,s.jsx)("label",{children:"First Name"}),(0,s.jsxs)("div",{className:"buyer-input-wrapper",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"text",name:"firstName",value:E.firstName,onChange:Y})]})]}),(0,s.jsxs)("div",{className:"buyer-form-group",children:[(0,s.jsx)("label",{children:"Last Name"}),(0,s.jsxs)("div",{className:"buyer-input-wrapper",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"text",name:"lastName",value:E.lastName,onChange:Y})]})]})]}),(0,s.jsxs)("div",{className:"buyer-form-row",children:[(0,s.jsxs)("div",{className:"buyer-form-group",children:[(0,s.jsx)("label",{children:"Email Address"}),(0,s.jsxs)("div",{className:"buyer-input-wrapper buyer-disabled-wrapper",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M22 6l-10 7L2 6",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("input",{type:"email",name:"email",value:E.email,readOnly:!0,disabled:!0,className:"buyer-disabled-input"})]})]}),(0,s.jsxs)("div",{className:"buyer-form-group",children:[(0,s.jsx)("label",{children:"Phone Number"}),(0,s.jsxs)("div",{className:"buyer-input-wrapper buyer-disabled-wrapper",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"phone",value:E.phone,readOnly:!0,disabled:!0,className:"buyer-disabled-input"})]}),(0,s.jsx)("small",{style:{color:"#6b7280",fontSize:"0.75rem",marginTop:"0.25rem",display:"block"},children:"Login mobile number (cannot be changed)"})]}),(0,s.jsxs)("div",{className:"buyer-form-group",children:[(0,s.jsxs)("label",{children:["WhatsApp Number ",(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"normal"},children:"(Optional)"})]}),(0,s.jsxs)("div",{className:"buyer-input-wrapper",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"whatsappNumber",value:E.whatsappNumber,onChange:Y,placeholder:"+917276*****"})]})]}),(0,s.jsxs)("div",{className:"buyer-form-group",children:[(0,s.jsxs)("label",{children:["Alternate Mobile Number ",(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"normal"},children:"(Optional)"})]}),(0,s.jsxs)("div",{className:"buyer-input-wrapper",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"alternateMobile",value:E.alternateMobile,onChange:Y,placeholder:"+917276*****"})]})]})]}),(0,s.jsxs)("div",{className:"buyer-form-group buyer-full-width",children:[(0,s.jsx)("label",{children:"Address"}),(0,s.jsxs)("div",{className:"buyer-input-wrapper",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("input",{type:"text",name:"address",value:E.address,onChange:Y,placeholder:"Enter your address"})]})]}),(0,s.jsxs)("div",{className:"buyer-form-actions",children:[(0,s.jsx)("button",{className:"buyer-cancel-btn",onClick:()=>{var e;const t=(null===a||void 0===a||null===(e=a.full_name)||void 0===e?void 0:e.split(" "))||[];N({firstName:t[0]||(null===a||void 0===a?void 0:a.first_name)||"",lastName:t.slice(1).join(" ")||(null===a||void 0===a?void 0:a.last_name)||"",email:(null===a||void 0===a?void 0:a.email)||"",phone:(null===a||void 0===a?void 0:a.phone)||"",whatsappNumber:"",alternateMobile:"",address:""})},children:"Cancel"}),(0,s.jsx)("button",{className:"buyer-save-btn",onClick:async()=>{P(!0);try{const t={full_name:"".concat(E.firstName," ").concat(E.lastName).trim(),address:E.address,whatsapp_number:E.whatsappNumber.trim()||"",alternate_mobile:E.alternateMobile.trim()||""},r=await i.Hs.update(t);if(!r.success)throw new Error(r.message||"Failed to update profile");if(a){const e=(0,p.A)((0,p.A)({},a),{},{full_name:t.full_name});localStorage.setItem("userData",JSON.stringify(e))}try{const e=await i.R2.verifyToken();e.success&&e.data}catch(e){console.error("Error refreshing user data:",e)}alert("Profile updated successfully!")}catch(e){console.error("Error updating profile:",e),alert(e.message||"Failed to update profile. Please try again.")}finally{P(!1)}},disabled:I,children:I?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"buyer-upload-spinner",style:{width:"16px",height:"16px",borderWidth:"2px"}}),"Saving..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z",stroke:"white",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M17 21v-8H7v8M7 3v5h8",stroke:"white",strokeWidth:"2"})]}),"Save Changes"]})})]})]})]}):"favorites"===q?(0,s.jsx)("div",{className:"buyer-favorites-section",children:F?(0,s.jsxs)("div",{className:"buyer-empty-favorites",children:[(0,s.jsx)("div",{className:"buyer-upload-spinner",style:{width:"40px",height:"40px",borderWidth:"4px",margin:"0 auto 1rem"}}),(0,s.jsx)("p",{children:"Loading favorites..."})]}):0===R.length?(0,s.jsxs)("div",{className:"buyer-empty-favorites",children:[(0,s.jsx)("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"#cbd5e0",strokeWidth:"1.5",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})}),(0,s.jsx)("h3",{children:"No Favorites Yet"}),(0,s.jsx)("p",{children:"Start exploring properties and add them to your favorites by clicking the heart icon"})]}):(0,s.jsx)("div",{className:"buyer-favorites-grid",children:R.map(e=>(0,s.jsx)(S,{property:e,onFavoriteToggle:K},e.id))})}):(0,s.jsx)("div",{className:"buyer-history-section",children:0===z.length?(0,s.jsxs)("div",{className:"buyer-empty-history",children:[(0,s.jsxs)("svg",{width:"80",height:"80",viewBox:"0 0 24 24",fill:"none",stroke:"#cbd5e0",strokeWidth:"1.5",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10"}),(0,s.jsx)("path",{d:"M12 6v6l4 2"})]}),(0,s.jsx)("h3",{children:"No Property History Yet"}),(0,s.jsx)("p",{children:"You have not contacted any property owners yet."})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("h2",{className:"buyer-history-heading",children:"Contacted Properties History"}),(0,s.jsx)("ol",{className:"buyer-history-list",children:z.map((e,t)=>(0,s.jsx)("li",{className:"buyer-history-item",children:(0,s.jsxs)("div",{className:"buyer-history-grid",children:[(0,s.jsx)("span",{className:"buyer-history-property-title",children:e.propertyTitle}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-owner-name",children:e.ownerName||"Not available"}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-owner-phone",children:e.ownerContactNumber?(0,s.jsx)("a",{href:"tel:".concat(e.ownerContactNumber),className:"buyer-history-link",children:e.ownerContactNumber}):(0,s.jsx)("span",{className:"buyer-history-empty",children:"\u2014"})}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-owner-email",children:e.ownerEmail?(0,s.jsx)("a",{href:"mailto:".concat(e.ownerEmail),className:"buyer-history-link",children:e.ownerEmail}):(0,s.jsx)("span",{className:"buyer-history-empty",children:"\u2014"})}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-timestamp",children:G(e.created_at)}),(0,s.jsx)("button",{className:"buyer-history-view-btn",onClick:()=>{return t=e.propertyId,void window.open("/details/".concat(t),"_blank","noopener,noreferrer");var t},children:"View Details"})]})},"".concat(e.propertyId,"-").concat(t)))})]})}),x&&(0,s.jsx)("div",{className:"buyer-camera-modal-overlay",onClick:M,children:(0,s.jsxs)("div",{className:"buyer-camera-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"buyer-camera-modal-header",children:[(0,s.jsx)("h3",{children:"Take Photo"}),(0,s.jsx)("button",{className:"buyer-camera-close-btn",onClick:M,"aria-label":"Close camera",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"buyer-camera-content",children:T?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:URL.createObjectURL(T),alt:"Captured",className:"buyer-camera-preview"}),(0,s.jsxs)("div",{className:"buyer-camera-preview-controls",children:[(0,s.jsxs)("button",{className:"buyer-camera-retake-btn",onClick:()=>{k(null)},children:[(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Retake"]}),(0,s.jsx)("button",{className:"buyer-camera-use-btn",onClick:()=>{T&&(L(T),M())},disabled:g,children:g?(0,s.jsx)("div",{className:"buyer-upload-spinner"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Use Photo"]})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("video",{ref:m,autoPlay:!0,playsInline:!0,className:"buyer-camera-video"}),(0,s.jsx)("div",{className:"buyer-camera-controls",children:(0,s.jsx)("button",{className:"buyer-camera-capture-btn",onClick:()=>{if(m.current){const e=m.current,t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t.getContext("2d").drawImage(e,0,0),t.toBlob(e=>{if(e){const t=new File([e],"camera-photo.jpg",{type:"image/jpeg"});k(t)}},"image/jpeg",.9)}},"aria-label":"Capture photo",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"white",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"4",fill:"white"})]})})})]})})]})}),!X&&(0,s.jsx)("div",{className:"buyer-profile-blur-overlay"})]}),!X&&(0,s.jsx)(Q,{isOpen:!0,onClose:()=>u("/buyer-dashboard")})]})};function ae(){const{user:t}=l(),r=(0,e.useRef)(null),[n,i]=(0,e.useState)(()=>{const e=function(e){return e?{name:e.full_name||e.name||"",email:e.email||"",phone:e.phone||e.mobile||"",message:""}:{name:"",email:"",phone:"",message:""}}(function(){try{const e=localStorage.getItem("userData");return e?JSON.parse(e):null}catch(e){return null}}());return(0,p.A)((0,p.A)({},e),{},{message:""})});(0,e.useEffect)(()=>{i(t?e=>(0,p.A)((0,p.A)({},e),{},{name:t.full_name||t.name||"",email:t.email||"",phone:t.phone||t.mobile||""}):e=>(0,p.A)((0,p.A)({},e),{},{name:"",email:"",phone:""}))},[t]),(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const[o,a]=(0,e.useState)(!1),[c,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)(null),m=(0,e.useCallback)(e=>{const{name:t,value:r}=e.target;i(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r}))},[]);return(0,s.jsx)("div",{className:"buyer-contact-main",children:(0,s.jsxs)("div",{className:"buyer-contact-container",children:[(0,s.jsxs)("div",{className:"buyer-contact-header",children:[(0,s.jsx)("h1",{className:"buyer-contact-title",children:"Get In Touch"}),(0,s.jsx)("p",{className:"buyer-header-text",children:"Contact us for a free quote or emergency service"})]}),(0,s.jsxs)("div",{className:"buyer-contact-two-column",children:[(0,s.jsxs)("div",{className:"buyer-contact-info-card",children:[(0,s.jsx)("h2",{className:"buyer-contact-info-title",children:"Contact Information"}),(0,s.jsxs)("div",{className:"buyer-contact-info-item",children:[(0,s.jsx)("div",{className:"buyer-contact-info-label",children:"Phone"}),(0,s.jsx)("a",{href:"tel:+919371316019",className:"buyer-contact-info-link",children:"+919371316019"})]}),(0,s.jsxs)("div",{className:"buyer-contact-info-item",children:[(0,s.jsx)("div",{className:"buyer-contact-info-label",children:"Email"}),(0,s.jsx)("a",{href:"mailto:info@360coordinates.com",className:"buyer-contact-info-link",children:"info@360coordinates.com"})]}),(0,s.jsxs)("div",{className:"buyer-contact-info-item",children:[(0,s.jsx)("div",{className:"buyer-contact-info-label",children:"Address"}),(0,s.jsxs)("a",{href:"https://www.google.com/maps/search/?api=1&query=Office+No.21+%26+22,+3rd+Floor,+S%2FNo.+56,+Aston+Plaza,+Ambegaon+Bk.,+Pune,+Maharashtra+411046",target:"_blank",rel:"noopener noreferrer",className:"buyer-contact-info-address",children:["Office No.21 & 22, 3rd Floor, S/No. 56",(0,s.jsx)("br",{}),"Aston Plaza, Ambegaon Bk.",(0,s.jsx)("br",{}),"Pune, Maharashtra\u2013 411046"]})]})]}),(0,s.jsxs)("div",{className:"buyer-form-card",children:[(0,s.jsx)("h2",{className:"buyer-form-title",children:"Send Us a Message"}),c&&(0,s.jsx)("div",{className:"buyer-success-box",children:"Message sent successfully!"}),(0,s.jsxs)("form",{ref:r,className:"buyer-form-inputs",onSubmit:e=>{e&&(e.preventDefault(),e.stopPropagation());const t=window.pageYOffset||document.documentElement.scrollTop;if(!n.name||!n.email||!n.phone||!n.message)return alert("Please fill all fields"),void window.scrollTo({top:t,behavior:"auto"});a(!0),setTimeout(()=>{a(!1),u(!0),i(e=>(0,p.A)((0,p.A)({},e),{},{message:""})),requestAnimationFrame(()=>{window.scrollTo({top:t,behavior:"auto"})}),setTimeout(()=>u(!1),2500)},1500)},onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[(0,s.jsx)("input",{type:"text",name:"name",value:n.name,onChange:m,placeholder:"Your Name"}),(0,s.jsx)("input",{type:"email",name:"email",value:n.email,onChange:m,placeholder:"Your Email"}),(0,s.jsx)("input",{type:"text",name:"phone",value:n.phone,onChange:m,placeholder:"Phone Number"}),(0,s.jsx)("textarea",{name:"message",rows:"4",value:n.message,onChange:m,placeholder:"Message"}),(0,s.jsx)("button",{type:"submit",disabled:o,children:o?"Sending...":"Send Message"})]})]})]}),(0,s.jsxs)("div",{className:"buyer-faq-section",children:[(0,s.jsx)("h2",{className:"buyer-faq-title",children:"Frequently Asked Questions"}),(0,s.jsx)("div",{className:"buyer-faq-list",children:[{question:"How do I list a property?",answer:"To list your property, log in to your seller dashboard and click on 'My Properties'. Then click the 'Add Property' button and fill in all the required details including property type, location, price, and images. Once submitted, your property will be reviewed and published."},{question:"How can I contact the property owner?",answer:"You can contact property owners directly through our chat feature. Simply click on the 'Chat' button on any property listing page, or use the ChatUs page in your dashboard. Property owners will receive your message and can respond to your inquiries."},{question:"Is my data secure?",answer:"Yes, we take data security seriously. All your personal information, including contact details and property data, is encrypted and stored securely. We follow industry-standard security practices and never share your information with third parties without your consent."},{question:"How do I edit my profile?",answer:"To edit your profile, go to your dashboard and click on 'Profile' in the navigation menu. From there, you can update your personal information, contact details, profile picture, and other settings. Remember to save your changes before leaving the page."},{question:"How can I get support?",answer:"You can get support by filling out the contact form on this page, or by emailing us directly at info@360coordinates.com. Our support team typically responds within 24 hours. You can also call us at +919371316019 during business hours."}].map((e,t)=>(0,s.jsxs)("div",{className:"buyer-faq-item ".concat(d===t?"open":""),children:[(0,s.jsxs)("button",{className:"buyer-faq-question",onClick:()=>h(d===t?null:t),children:[(0,s.jsx)("span",{children:e.question}),(0,s.jsx)(P,{size:20,className:"buyer-faq-icon ".concat(d===t?"open":"")})]}),d===t&&(0,s.jsx)("div",{className:"buyer-faq-answer",children:(0,s.jsx)("p",{children:e.answer})})]},t))})]})]})})}var le={color:void 0,size:void 0,className:void 0,style:void 0,attr:void 0},ce=e.createContext&&e.createContext(le),ue=["attr","size","title"];function de(e,t){if(null==e)return{};var r,n,i=function(e,t){if(null==e)return{};var r={};for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){if(t.indexOf(n)>=0)continue;r[n]=e[n]}return r}(e,t);if(Object.getOwnPropertySymbols){var s=Object.getOwnPropertySymbols(e);for(n=0;n<s.length;n++)r=s[n],t.indexOf(r)>=0||Object.prototype.propertyIsEnumerable.call(e,r)&&(i[r]=e[r])}return i}function he(){return he=Object.assign?Object.assign.bind():function(e){for(var t=1;t<arguments.length;t++){var r=arguments[t];for(var n in r)Object.prototype.hasOwnProperty.call(r,n)&&(e[n]=r[n])}return e},he.apply(this,arguments)}function pe(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),r.push.apply(r,n)}return r}function me(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?pe(Object(r),!0).forEach(function(t){fe(e,t,r[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):pe(Object(r)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))})}return e}function fe(e,t,r){return(t=function(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t||"default");if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return("string"===t?String:Number)(e)}(e,"string");return"symbol"==typeof t?t:t+""}(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function ge(t){return t&&t.map((t,r)=>e.createElement(t.tag,me({key:r},t.attr),ge(t.child)))}function ye(t){return r=>e.createElement(_e,he({attr:me({},t.attr)},r),ge(t.child))}function _e(t){var r=r=>{var n,{attr:i,size:s,title:o}=t,a=de(t,ue),l=s||r.size||"1em";return r.className&&(n=r.className),t.className&&(n=(n?n+" ":"")+t.className),e.createElement("svg",he({stroke:"currentColor",fill:"currentColor",strokeWidth:"0"},r.attr,i,a,{className:n,style:me(me({color:t.color||r.color},r.style),t.style),height:l,width:l,xmlns:"http://www.w3.org/2000/svg"}),o&&e.createElement("title",null,o),t.children)};return void 0!==ce?e.createElement(ce.Consumer,null,e=>r(e)):r(le)}function ve(e){return ye({tag:"svg",attr:{viewBox:"0 0 256 512"},child:[{tag:"path",attr:{d:"M31.7 239l136-136c9.4-9.4 24.6-9.4 33.9 0l22.6 22.6c9.4 9.4 9.4 24.6 0 33.9L127.9 256l96.4 96.4c9.4 9.4 9.4 24.6 0 33.9L201.7 409c-9.4 9.4-24.6 9.4-33.9 0l-136-136c-9.5-9.4-9.5-24.6-.1-34z"},child:[]}]})(e)}function xe(e){return ye({tag:"svg",attr:{viewBox:"0 0 256 512"},child:[{tag:"path",attr:{d:"M224.3 273l-136 136c-9.4 9.4-24.6 9.4-33.9 0l-22.6-22.6c-9.4-9.4-9.4-24.6 0-33.9l96.4-96.4-96.4-96.4c-9.4-9.4-9.4-24.6 0-33.9L54.3 103c9.4-9.4 24.6-9.4 33.9 0l136 136c9.5 9.4 9.5 24.6.1 34z"},child:[]}]})(e)}function be(e){return ye({tag:"svg",attr:{viewBox:"0 0 640 512"},child:[{tag:"path",attr:{d:"M176 256c44.11 0 80-35.89 80-80s-35.89-80-80-80-80 35.89-80 80 35.89 80 80 80zm352-128H304c-8.84 0-16 7.16-16 16v144H64V80c0-8.84-7.16-16-16-16H16C7.16 64 0 71.16 0 80v352c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16v-48h512v48c0 8.84 7.16 16 16 16h32c8.84 0 16-7.16 16-16V240c0-61.86-50.14-112-112-112z"},child:[]}]})(e)}function we(e){return ye({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M0 464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V192H0v272zm320-196c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM192 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12h-40c-6.6 0-12-5.4-12-12v-40zM64 268c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zm0 128c0-6.6 5.4-12 12-12h40c6.6 0 12 5.4 12 12v40c0 6.6-5.4 12-12 12H76c-6.6 0-12-5.4-12-12v-40zM400 64h-48V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H160V16c0-8.8-7.2-16-16-16h-32c-8.8 0-16 7.2-16 16v48H48C21.5 64 0 85.5 0 112v48h448v-48c0-26.5-21.5-48-48-48z"},child:[]}]})(e)}function je(e){return ye({tag:"svg",attr:{viewBox:"0 0 576 512"},child:[{tag:"path",attr:{d:"M416 192c0-88.4-93.1-160-208-160S0 103.6 0 192c0 34.3 14.1 65.9 38 92-13.4 30.2-35.5 54.2-35.8 54.5-2.2 2.3-2.8 5.7-1.5 8.7S4.8 352 8 352c36.6 0 66.9-12.3 88.7-25 32.2 15.7 70.3 25 111.3 25 114.9 0 208-71.6 208-160zm122 220c23.9-26 38-57.7 38-92 0-66.9-53.5-124.2-129.3-148.1.9 6.6 1.3 13.3 1.3 20.1 0 105.9-107.7 192-240 192-10.8 0-21.3-.8-31.7-1.9C207.8 439.6 281.8 480 368 480c41 0 79.1-9.2 111.3-25 21.8 12.7 52.1 25 88.7 25 3.2 0 6.1-1.9 7.3-4.8 1.3-2.9.7-6.3-1.5-8.7-.3-.3-22.4-24.2-35.8-54.5z"},child:[]}]})(e)}function Se(e){return ye({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M160 288h-56c-4.42 0-8-3.58-8-8v-16c0-4.42 3.58-8 8-8h56v-64h-56c-4.42 0-8-3.58-8-8v-16c0-4.42 3.58-8 8-8h56V96h-56c-4.42 0-8-3.58-8-8V72c0-4.42 3.58-8 8-8h56V32c0-17.67-14.33-32-32-32H32C14.33 0 0 14.33 0 32v448c0 2.77.91 5.24 1.57 7.8L160 329.38V288zm320 64h-32v56c0 4.42-3.58 8-8 8h-16c-4.42 0-8-3.58-8-8v-56h-64v56c0 4.42-3.58 8-8 8h-16c-4.42 0-8-3.58-8-8v-56h-64v56c0 4.42-3.58 8-8 8h-16c-4.42 0-8-3.58-8-8v-56h-41.37L24.2 510.43c2.56.66 5.04 1.57 7.8 1.57h448c17.67 0 32-14.33 32-32v-96c0-17.67-14.33-32-32-32z"},child:[]}]})(e)}function Te(e){return ye({tag:"svg",attr:{viewBox:"0 0 512 512"},child:[{tag:"path",attr:{d:"M304,320a16,16,0,1,0,16,16A16,16,0,0,0,304,320Zm32-96a16,16,0,1,0,16,16A16,16,0,0,0,336,224Zm32,64a16,16,0,1,0-16-16A16,16,0,0,0,368,288Zm-32,32a16,16,0,1,0-16-16A16,16,0,0,0,336,320Zm-32-64a16,16,0,1,0,16,16A16,16,0,0,0,304,256Zm128-32a16,16,0,1,0-16-16A16,16,0,0,0,432,224Zm-48,16a16,16,0,1,0,16-16A16,16,0,0,0,384,240Zm-16-48a16,16,0,1,0,16,16A16,16,0,0,0,368,192Zm96,32a16,16,0,1,0,16,16A16,16,0,0,0,464,224Zm32-32a16,16,0,1,0,16,16A16,16,0,0,0,496,192Zm-64,64a16,16,0,1,0,16,16A16,16,0,0,0,432,256Zm-32,32a16,16,0,1,0,16,16A16,16,0,0,0,400,288Zm-64,64a16,16,0,1,0,16,16A16,16,0,0,0,336,352Zm-32,32a16,16,0,1,0,16,16A16,16,0,0,0,304,384Zm64-64a16,16,0,1,0,16,16A16,16,0,0,0,368,320Zm21.65-218.35-11.3-11.31a16,16,0,0,0-22.63,0L350.05,96A111.19,111.19,0,0,0,272,64c-19.24,0-37.08,5.3-52.9,13.85l-10-10A121.72,121.72,0,0,0,123.44,32C55.49,31.5,0,92.91,0,160.85V464a16,16,0,0,0,16,16H48a16,16,0,0,0,16-16V158.4c0-30.15,21-58.2,51-61.93a58.38,58.38,0,0,1,48.93,16.67l10,10C165.3,138.92,160,156.76,160,176a111.23,111.23,0,0,0,32,78.05l-5.66,5.67a16,16,0,0,0,0,22.62l11.3,11.31a16,16,0,0,0,22.63,0L389.65,124.28A16,16,0,0,0,389.65,101.65Z"},child:[]}]})(e)}function ke(e){return ye({tag:"svg",attr:{viewBox:"0 0 352 512"},child:[{tag:"path",attr:{d:"M242.72 256l100.07-100.07c12.28-12.28 12.28-32.19 0-44.48l-22.24-22.24c-12.28-12.28-32.19-12.28-44.48 0L176 189.28 75.93 89.21c-12.28-12.28-32.19-12.28-44.48 0L9.21 111.45c-12.28 12.28-12.28 32.19 0 44.48L109.28 256 9.21 356.07c-12.28 12.28-12.28 32.19 0 44.48l22.24 22.24c12.28 12.28 32.2 12.28 44.48 0L176 322.72l100.07 100.07c12.28 12.28 32.2 12.28 44.48 0l22.24-22.24c12.28-12.28 12.28-32.19 0-44.48L242.72 256z"},child:[]}]})(e)}function Ae(e){return ye({tag:"svg",attr:{viewBox:"0 0 448 512"},child:[{tag:"path",attr:{d:"M224 256c70.7 0 128-57.3 128-128S294.7 0 224 0 96 57.3 96 128s57.3 128 128 128zm89.6 32h-16.7c-22.2 10.2-46.9 16-72.9 16s-50.6-5.8-72.9-16h-16.7C60.2 288 0 348.2 0 422.4V464c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48v-41.6c0-74.2-60.2-134.4-134.4-134.4z"},child:[]}]})(e)}var Ce=r(879),Ee=r.n(Ce);const Ne={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN||"pk.eyJ1Ijoic3VkaGFrYXJwb3VsIiwiYSI6ImNtaXp0ZmFrNTAxaTQzZHNiODNrYndsdTAifQ.YTMezksySLU7ZpcYkvXyqg";Ee().accessToken=Ne;const Ie=t=>{let{properties:i=[],center:o=[73.8567,18.5204],zoom:a=5,onPropertyClick:c,onMapClick:u,showControls:d=!0,interactive:h=!0,currentPropertyId:p=null,fullscreenSearchBar:m=null}=t;const f=(0,n.Zp)(),{user:g}=l(),y=(0,e.useRef)(null),_=(0,e.useRef)(null),v=(0,e.useRef)(null),[x,b]=(0,e.useState)(!1),j=(0,e.useRef)([]),S=(0,e.useRef)(new Map),[T,k]=(0,e.useState)(!1),[A,C]=(0,e.useState)(null),E=(0,e.useRef)(null),N=(0,e.useRef)(!1),I=(0,e.useRef)(new Map),P=(0,e.useRef)(null),M=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(v.current)return;if(!_.current)return void console.error("Map container ref is null");let e=null,t=null,r=null;const n=_.current,i=n.offsetWidth>0&&n.offsetHeight>0,s=()=>{if(!v.current)try{if(v.current=new(Ee().Map)({container:_.current,style:"mapbox://styles/mapbox/streets-v12",center:o,zoom:a,interactive:h}),d){v.current.addControl(new(Ee().NavigationControl),"top-right");const e=y.current||_.current;v.current.addControl(new(Ee().FullscreenControl)({container:e}),"top-right"),v.current.addControl(new(Ee().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0}),"top-right")}v.current.on("load",()=>{k(!0),setTimeout(()=>{v.current&&v.current.resize()},100)});const r=()=>{j.current.forEach(e=>{e.getPopup()&&e.getPopup().isOpen()&&e.getPopup().remove()}),E.current=null};v.current.on("dragstart",r),v.current.on("movestart",r),v.current.on("zoomstart",r),v.current.on("movestart",()=>{M.current&&(clearTimeout(M.current),M.current=null)}),v.current.on("moveend",()=>{if(P.current){const e=P.current,t=S.current.get(e);t&&!t.getPopup().isOpen()&&(t.togglePopup(),E.current=e),P.current=null}M.current&&(clearTimeout(M.current),M.current=null)}),u&&v.current.on("click",e=>{const t=e.originalEvent.target;t&&(t.closest(".price-tag-marker")||t.closest(".mapboxgl-marker"))||(r(),u({lng:e.lngLat.lng,lat:e.lngLat.lat}))}),t=()=>{v.current&&T&&v.current.resize()},window.addEventListener("resize",t),e=new ResizeObserver(()=>{v.current&&T&&v.current.resize()}),_.current&&e.observe(_.current)}catch(r){console.error("Error creating Mapbox map:",r)}};return i?s():(r=setInterval(()=>{n.offsetWidth>0&&n.offsetHeight>0&&(clearInterval(r),s())},100),setTimeout(()=>{r&&clearInterval(r),v.current||(console.warn("Map container did not get dimensions, initializing anyway"),s())},5e3)),()=>{r&&clearInterval(r),t&&window.removeEventListener("resize",t),e&&e.disconnect(),v.current&&(v.current.remove(),v.current=null)}},[]),(0,e.useEffect)(()=>{const e=()=>{const e=!!y.current&&document.fullscreenElement===y.current;b(e),v.current&&setTimeout(()=>v.current.resize(),150)};return document.addEventListener("fullscreenchange",e),()=>document.removeEventListener("fullscreenchange",e)},[]),(0,e.useEffect)(()=>{v.current&&T&&v.current.flyTo({center:o,zoom:a,essential:!0})},[o,a,T]),(0,e.useEffect)(()=>{if(!v.current||!T||!p)return;const e=i.find(e=>e.id===p);e&&e.longitude&&e.latitude&&v.current.flyTo({center:[e.longitude,e.latitude],zoom:14,essential:!0})},[p,i,T]);(0,e.useCallback)((e,t,r,n)=>{const i=(r-e)*Math.PI/180,s=(n-t)*Math.PI/180,o=Math.sin(i/2)*Math.sin(i/2)+Math.cos(e*Math.PI/180)*Math.cos(r*Math.PI/180)*Math.sin(s/2)*Math.sin(s/2);return 6371*(2*Math.atan2(Math.sqrt(o),Math.sqrt(1-o)))/111},[]);const L=(0,e.useCallback)(e=>{if(e)try{window.open("/buyer-dashboard/details/".concat(e),"_blank","noopener,noreferrer")}catch(t){console.error("Error navigating to property details:",t),window.open("/buyer-dashboard/details/".concat(e),"_blank","noopener,noreferrer")}else console.error("Invalid property ID for navigation:",e)},[]),R=(0,e.useCallback)(e=>{if(!e)return"Price on Request";const t="string"===typeof e?parseFloat(e):e;if(isNaN(t))return"Price on Request";if(t>=1e7){const e=t/1e7;return"".concat(e%1===0?e:e.toFixed(1),"Cr")}if(t>=1e5){const e=t/1e5;return"".concat(e%1===0?e:e.toFixed(1),"L")}if(t>=1e3){const e=t/1e3;return"".concat(e%1===0?e:e.toFixed(1),"K")}return t.toString()},[]),D=(0,e.useCallback)(e=>{if(null!=e.priceRange&&""!==e.priceRange)return"\u20b9".concat(e.priceRange," Cr");const t=R(e.price);return"Price on Request"===t?t:"\u20b9".concat(t)},[R]),F=(0,e.useCallback)(async e=>{if(!e)return!1;try{const t=w.isFavorite(e);if(I.current.set(e,t),g){const{favoritesAPI:t}=await Promise.resolve().then(r.bind(r,376)),n=await t.list();if(n.success){const t=n.data.properties||n.data.favorites||[],r=t.map(e=>e.id||e.property_id).includes(e);return I.current.set(e,r),r}}return t}catch(t){console.error("Error checking favorite status:",t);const r=w.isFavorite(e);return I.current.set(e,r),r}},[g]),O=(0,e.useCallback)(async(e,t)=>{if(!g)return alert("Please login to add properties to favorites"),void f("/login");try{const{favoritesAPI:n}=await Promise.resolve().then(r.bind(r,376)),i=await n.toggle(e);if(i.success){const r=void 0!==i.data.is_favorite?i.data.is_favorite:!I.current.get(e);I.current.set(e,r);const n=t.querySelector("svg");n&&(r?(n.setAttribute("fill","red"),n.setAttribute("stroke","red"),t.classList.add("active")):(n.setAttribute("fill","none"),n.setAttribute("stroke","white"),t.classList.remove("active"))),w.toggleFavorite(e)}else console.error("Failed to toggle favorite:",i.message),alert(i.message||"Failed to update favorite")}catch(n){console.error("Error toggling favorite:",n);const r=!I.current.get(e);I.current.set(e,r),w.toggleFavorite(e);const i=t.querySelector("svg");i&&(r?(i.setAttribute("fill","red"),i.setAttribute("stroke","red"),t.classList.add("active")):(i.setAttribute("fill","none"),i.setAttribute("stroke","white"),t.classList.remove("active")))}},[g,f]),z=(0,e.useCallback)(async e=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),!0;const r=document.createElement("textarea");r.value=e,r.style.position="fixed",r.style.left="-999999px",r.style.top="-999999px",document.body.appendChild(r),r.focus(),r.select();try{return document.execCommand("copy"),document.body.removeChild(r),!0}catch(t){return document.body.removeChild(r),!1}}catch(r){return console.error("Error copying to clipboard:",r),!1}},[]),B=(0,e.useCallback)(async e=>{if(!e||!e.id)return void console.error("Cannot share: property ID is missing");const t="".concat(window.location.origin,"/details/").concat(e.id),r={title:e.title||"Property Listing",text:"Check out this property: ".concat(e.title||"Amazing Property"),url:t};if(navigator.share)try{await navigator.share(r),console.log("Share successful")}catch(n){if("AbortError"!==n.name){console.error("Error sharing:",n);await z(t)?alert("Link copied to clipboard!"):alert("Unable to share. Please copy the link manually: "+t)}}else{await z(t)?alert("Link copied to clipboard!"):alert("Please copy this link: "+t)}},[z]),U=((0,e.useCallback)((e,t,r)=>{if(!e||!t)return{anchor:"bottom",offset:[0,25]};const n=e.getContainer();if(!n)return{anchor:"bottom",offset:[0,25]};const i=n.getBoundingClientRect(),s=i.width,o=i.height,a=e.project(t),l=a.x,c=a.y;let u=350,d=400;if(r){const e=r.getBoundingClientRect();u=e.width||u,d=e.height||d}const h=15,p=25,m=c,f=o-c,g=m>=d+p+h,y=f>=d+p+h;let _="bottom",v=0;if(g){const e=Math.min(m,d)*Math.min(u,s);e>v&&(v=e,_="bottom")}if(y){const e=Math.min(f,d)*Math.min(u,s);e>v&&(v=e,_="top")}g||y||(_=m>f?"bottom":"top");let x=0;const b=l-u/2,w=l+u/2;return x=b>=h&&w<=s-h?0:b<h?h-b:s-h-w,{anchor:_,offset:[x,"bottom"===_?p:-25]}},[]),(0,e.useCallback)((e,t)=>{const r=e.latitude,n=e.longitude,i=t.filter(e=>e.latitude===r&&e.longitude===n);if(i.length<=1)return{lat:r,lng:n};const s=i.findIndex(t=>t.id===e.id),o=5e-4,a=2*Math.PI*s/i.length;return{lat:r+o*Math.cos(a),lng:n+o*Math.sin(a)}},[]));(0,e.useEffect)(()=>{if(!v.current||!T)return;j.current.forEach(e=>e.remove()),j.current=[],S.current.clear(),E.current=null,console.log("\ud83d\uddfa\ufe0f MapView: Adding markers for",i.length,"properties");const e=i.filter(e=>e.longitude&&e.latitude),t=i.filter(e=>!e.longitude||!e.latitude);t.length>0&&(console.warn("\u26a0\ufe0f MapView: ".concat(t.length," out of ").concat(i.length," properties are missing coordinates and will not appear on the map.")),console.warn("\u26a0\ufe0f Properties without coordinates:",t.map(e=>({id:e.id,title:e.title,location:e.location})))),0===e.length&&(console.error("\u274c MapView: No properties have valid coordinates. Map will be empty."),console.error("\ud83d\udca1 Solution: Ensure properties have latitude/longitude values. Use LocationPicker when adding/editing properties.")),i.forEach((e,t)=>{if(!e.longitude||!e.latitude)return;const{lat:r,lng:n}=U(e,i);r===e.latitude&&n===e.longitude||console.log("\ud83d\udccd MapView: Applied offset for property ".concat(e.id," (").concat(e.title,") - Original: ").concat(e.latitude,", ").concat(e.longitude," \u2192 Offset: ").concat(r,", ").concat(n)),console.log("\ud83d\udccd MapView: Creating marker for property:",e.id,e.title,"lat:",r,"lng:",n);const s=e.thumbnail||(e.images&&e.images.length>0?"string"===typeof e.images[0]?e.images[0]:e.images[0].url:null)||e.cover_image||"/placeholder-property.jpg",o=D(e),a=document.createElement("div");a.className="price-tag-marker",a.setAttribute("data-property-id",e.id),a.innerHTML='\n        <div class="price-tag">\n          '.concat(o,"\n        </div>\n      ");const l=e.images&&Array.isArray(e.images)&&e.images.length>0?e.images.map(e=>"string"===typeof e?e:e.url):e.cover_image?[e.cover_image]:[s],u=l.length,d=e.description||e.location||"Property description",h=d.length>60?d.substring(0,60)+"...":d,p=(e.check_in_date,e.check_out_date,e.nights,new(Ee().Popup)({offset:25,closeButton:!1,closeOnClick:!1,anchor:"bottom",className:"map-card-container"}).setHTML('\n          <div class="property-popup-card" data-property-id="'.concat(e.id,'">\n            <div class="popup-card-image-container">\n              <img src="').concat(l[0],'" alt="').concat(e.title||"Property",'" class="popup-card-image" onerror="this.src=\'/placeholder-property.jpg\';" />\n              <div class="popup-card-image-overlay">\n                <div class="popup-card-action-buttons">\n                  <button class="popup-card-heart-btn" data-property-id="').concat(e.id,'" title="Save to favorites">\n                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                      <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path>\n                    </svg>\n                  </button>\n                  <button class="popup-card-share-btn" data-property-id="').concat(e.id,'" title="Share property">\n                    <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">\n                      <circle cx="18" cy="5" r="3"></circle>\n                      <circle cx="6" cy="12" r="3"></circle>\n                      <circle cx="18" cy="19" r="3"></circle>\n                      <line x1="8.59" y1="13.51" x2="15.42" y2="17.49"></line>\n                      <line x1="15.41" y1="6.51" x2="8.59" y2="10.49"></line>\n                    </svg>\n                  </button>\n                </div>\n                <button class="popup-card-close-btn" title="Close">\n                  <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2.5" stroke-linecap="round" stroke-linejoin="round">\n                    <line x1="18" y1="6" x2="6" y2="18"></line>\n                    <line x1="6" y1="6" x2="18" y2="18"></line>\n                  </svg>\n                </button>\n              </div>\n              ').concat(u>1?'\n                <div class="popup-card-pagination">\n                  '.concat(Array.from({length:u},(e,t)=>'\n                    <span class="pagination-dot '.concat(0===t?"active":"",'" data-image-index="').concat(t,'"></span>\n                  ')).join(""),"\n                </div>\n              "):"",'\n            </div>\n            <div class="popup-card-content">\n              <div class="popup-card-header">\n                <h3 class="popup-card-title">').concat(e.title||"Property",'</h3>\n              </div>\n              <p class="popup-card-description">').concat(h,'</p>\n              <div class="popup-card-price-section">\n                <span class="popup-card-price">').concat(D(e),"</span>\n              </div>\n            </div>\n          </div>\n        "))),m=new(Ee().Marker)(a).setLngLat([n,r]).setPopup(p).addTo(v.current),f=m.getElement();f.style.cursor="pointer",f.style.pointerEvents="auto";const g=t=>{N.current=!0,c&&c(e)};f.addEventListener("pointerdown",g,!0);const y=t=>{t.stopPropagation(),t.preventDefault(),j.current.forEach(e=>{e!==m&&e.getPopup().isOpen()&&e.getPopup().remove()}),C(e),P.current=e.id,M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{if(P.current===e.id){const t=S.current.get(e.id);t&&!t.getPopup().isOpen()&&(t.togglePopup(),E.current=e.id),P.current=null,M.current=null}},250),N.current=!0,c&&c(e)};f.addEventListener("mousedown",y);const _=t=>{t.stopPropagation(),j.current.forEach(e=>{e!==m&&e.getPopup().isOpen()&&e.getPopup().remove()}),C(e),P.current=e.id,M.current&&clearTimeout(M.current),M.current=setTimeout(()=>{if(P.current===e.id){const t=S.current.get(e.id);t&&!t.getPopup().isOpen()&&(t.togglePopup(),E.current=e.id),P.current=null,M.current=null}},250),c&&c(e)};f.addEventListener("click",_);const x=f.querySelector(".price-tag");x&&(x.style.pointerEvents="auto",x.style.cursor="pointer",x.addEventListener("pointerdown",g,!0),x.addEventListener("mousedown",y),x.addEventListener("click",e=>{e.stopPropagation(),_(e)})),p.on("open",()=>{setTimeout(async()=>{const t=p.getElement();if(!t)return;const r=()=>{const e=m.getLngLat(),r=t.closest(".mapboxgl-popup");if(!r)return;const n=t.getBoundingClientRect(),i=n.width||350,s=n.height||400,o=v.current.getContainer();if(!o)return;const a=o.getBoundingClientRect(),l=v.current.project(e),c=15,u=l.y,d=a.height-l.y;let h="bottom";const p=s+25+c;h=u>=p?"bottom":d>=p?"top":u>d?"bottom":"top",r.classList.remove("mapboxgl-popup-anchor-top","mapboxgl-popup-anchor-bottom","mapboxgl-popup-anchor-left","mapboxgl-popup-anchor-right","mapboxgl-popup-anchor-center"),r.classList.add("mapboxgl-popup-anchor-".concat(h));const f=l.x-i/2,g=l.x+i/2;let y=0;f<c?y=c-f:g>a.width-c&&(y=a.width-c-g);let _,x=l.x+y-i/2;"bottom"===h?(_=l.y-s-25,_<c&&(_=c)):(_=l.y+25,_+s>a.height-c&&(_=a.height-s-c)),x=Math.max(c,Math.min(x,a.width-i-c));const b=r.getBoundingClientRect(),w=o.getBoundingClientRect(),j=x-(b.left-w.left),S=_-(b.top-w.top),T=window.getComputedStyle(r).transform;let k=0,A=0;if(T&&"none"!==T)try{const e=new DOMMatrix(T);k=e.e,A=e.f}catch(C){}r.style.transform="translate(".concat(k+j,"px, ").concat(A+S,"px)")};setTimeout(()=>{requestAnimationFrame(()=>{requestAnimationFrame(r)})},100);const n=()=>{p.isOpen()&&setTimeout(()=>{requestAnimationFrame(r)},100)};v.current.on("move",n),v.current.on("zoom",n),v.current.on("resize",n),p.on("close",()=>{v.current.off("move",n),v.current.off("zoom",n),v.current.off("resize",n)});const i=t.querySelector(".popup-card-close-btn");i&&i.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),m.getPopup().remove(),E.current=null,C(null)});const s=t.querySelector(".popup-card-heart-btn");if(s){const t=await F(e.id),r=s.querySelector("svg");r&&(t?(r.setAttribute("fill","red"),r.setAttribute("stroke","red"),s.classList.add("active")):(r.setAttribute("fill","none"),r.setAttribute("stroke","white"),s.classList.remove("active"))),s.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),O(e.id,s)})}const o=t.querySelector(".popup-card-share-btn");o&&o.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),B(e)});const a=t.querySelectorAll(".pagination-dot");a.forEach((e,r)=>{e.addEventListener("click",n=>{n.preventDefault(),n.stopPropagation();const i=parseInt(e.getAttribute("data-image-index")||r),s=t.querySelector(".popup-card-image-container"),o=null===s||void 0===s?void 0:s.querySelector(".popup-card-image");o&&l[i]&&(o.src=l[i],a.forEach((e,t)=>{t===i?e.classList.add("active"):e.classList.remove("active")}))})})},100)});const b=async()=>{const t=p.getElement();if(!t)return;const r=t.querySelector(".popup-card-close-btn");r&&!r.hasAttribute("data-listener-attached")&&(r.setAttribute("data-listener-attached","true"),r.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),m.getPopup().remove(),E.current=null,C(null)}));const n=t.querySelector(".popup-card-heart-btn");if(n&&!n.hasAttribute("data-listener-attached")){n.setAttribute("data-listener-attached","true");const t=await F(e.id),r=n.querySelector("svg");r&&(t?(r.setAttribute("fill","red"),r.setAttribute("stroke","red"),n.classList.add("active")):(r.setAttribute("fill","none"),r.setAttribute("stroke","white"),n.classList.remove("active"))),n.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),O(e.id,n)})}const i=t.querySelector(".popup-card-share-btn");i&&!i.hasAttribute("data-listener-attached")&&(i.setAttribute("data-listener-attached","true"),i.addEventListener("click",t=>{t.preventDefault(),t.stopPropagation(),B(e)}));const s=t.querySelector(".property-popup-card");s&&!s.hasAttribute("data-listener-attached")&&(s.setAttribute("data-listener-attached","true"),s.addEventListener("click",t=>{t.target.closest(".popup-card-heart-btn, .popup-card-share-btn, .popup-card-close-btn, .popup-card-action-buttons, .popup-card-pagination, .pagination-dot")||(t.preventDefault(),t.stopPropagation(),L(e.id))}))};p.on("open",()=>{b(),setTimeout(b,50),setTimeout(b,150)}),p.on("close",()=>{E.current===e.id&&(E.current=null,C(null))}),j.current.push(m),S.current.set(e.id,m),console.log("\u2705 MapView: Marker created successfully for property:",e.id,e.title)}),console.log("\ud83d\uddfa\ufe0f MapView: Total markers created:",j.current.length)},[i,T,c,L,U,R,D,F,O,B]),(0,e.useEffect)(()=>{if(v.current&&T&&(j.current.forEach(e=>{const t=e.getElement();if(!t)return;const r=t.getAttribute("data-property-id");if(r){null!==p&&String(r)===String(p)?t.classList.add("selected"):t.classList.remove("selected")}}),p)){const e=i.find(e=>e.id===p);e&&e.longitude&&e.latitude&&v.current.flyTo({center:[e.longitude,e.latitude],zoom:14,essential:!0})}},[p,i,T]);(0,e.useCallback)(()=>v.current,[]);return(0,s.jsxs)("div",{ref:y,className:"map-view-fullscreen-wrapper ".concat(x?"fullscreen-active":""),children:[(0,s.jsx)("div",{className:"map-view-fullscreen-search",children:m}),(0,s.jsxs)("div",{className:"map-wrapper",children:[(0,s.jsx)("div",{ref:_,className:"map-container"}),!T&&(0,s.jsxs)("div",{className:"map-loading",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("p",{children:"Loading map..."})]})]})]})},Pe=[{id:"parking",label:"Parking",icon:"\ud83d\ude97"},{id:"lift",label:"Lift",icon:"\ud83d\uded7"},{id:"security",label:"24x7 Security",icon:"\ud83d\udc6e"},{id:"24/7 Security",label:"24/7 Security",icon:"\ud83d\udc6e"},{id:"power_backup",label:"Power Backup",icon:"\u26a1"},{id:"gym",label:"Gym",icon:"\ud83c\udfcb\ufe0f"},{id:"Gymnasium",label:"Gymnasium",icon:"\ud83c\udfcb\ufe0f"},{id:"swimming_pool",label:"Swimming Pool",icon:"\ud83c\udfca"},{id:"garden",label:"Garden",icon:"\ud83c\udf33"},{id:"clubhouse",label:"Club House",icon:"\ud83c\udfdb\ufe0f"},{id:"Clubhouse",label:"Clubhouse",icon:"\ud83c\udfdb\ufe0f"},{id:"playground",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"Children's Play Area",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"cctv",label:"CCTV",icon:"\ud83d\udcf9"},{id:"intercom",label:"Intercom",icon:"\ud83d\udcde"},{id:"fire_safety",label:"Fire Safety",icon:"\ud83d\udd25"},{id:"water_supply",label:"24x7 Water",icon:"\ud83d\udca7"},{id:"gas_pipeline",label:"Gas Pipeline",icon:"\ud83d\udd25"},{id:"wifi",label:"WiFi",icon:"\ud83d\udcf6"},{id:"ac",label:"Air Conditioning",icon:"\u2744\ufe0f"},{id:"Covered Parking",label:"Covered Parking",icon:"\ud83d\ude97"}],Me=e=>{if(!e)return"\u2713";const t=Pe.find(t=>t.label.toLowerCase()===e.toLowerCase()||t.id.toLowerCase()===e.toLowerCase().replace(/\s+/g,"_"));return t?t.icon:"\u2713"},Le=e=>{if(!e)return"";const t=Pe.find(t=>t.label.toLowerCase()===e.toLowerCase()||t.id.toLowerCase()===e.toLowerCase().replace(/\s+/g,"_")||t.label.toLowerCase()===e.toLowerCase().replace(/\s+/g," "));return t?t.label:e.split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")},Re=e=>{if(!e||"string"!==typeof e)return null;const t=e.trim();if(0===t.length)return null;if(t.includes("placeholder-property.jpg")||t.includes("placeholder")||"/placeholder-property.jpg"===t)return console.warn("Rejected placeholder image as video URL:",t),null;const r=t.toLowerCase();if([".jpg",".jpeg",".png",".gif",".webp",".svg",".bmp"].some(e=>r.includes(e)))return console.warn("Rejected image file as video URL:",t),null;const n=[".mp4",".webm",".ogg",".mov",".avi",".m4v",".quicktime"].some(e=>r.includes(e)),i=r.includes("/properties/videos/")||r.includes("/videos/");return n||i?t:(console.warn("Rejected non-video URL:",t),null)},De={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN||"pk.eyJ1Ijoic3VkaGFrYXJwb3VsIiwiYSI6ImNtaXp0ZmFrNTAxaTQzZHNiODNrYndsdTAifQ.YTMezksySLU7ZpcYkvXyqg",Fe=e=>{let{images:t,currentIndex:r,onClose:n,onNext:i,onPrev:o}=e;const a=null!==r;if(!t||0===t.length)return null;const l=a?t[r]:null,c=t.length>1;return(0,s.jsx)("div",{className:"image-slider-modal-overlay ".concat(a?"open":""),children:l&&(0,s.jsxs)("div",{className:"image-slider-modal-content",children:[(0,s.jsx)("button",{className:"slider-close-btn",onClick:n,"aria-label":"Close Slider",children:(0,s.jsx)(ke,{})}),(0,s.jsxs)("div",{className:"slider-controls",children:[c&&(0,s.jsx)("button",{className:"slider-prev-btn",onClick:o,"aria-label":"Previous Image",children:(0,s.jsx)(ve,{})}),(0,s.jsx)("img",{src:l.url,alt:l.alt,className:"slider-main-image"}),c&&(0,s.jsx)("button",{className:"slider-next-btn",onClick:i,"aria-label":"Next Image",children:(0,s.jsx)(xe,{})})]})]})})},Oe=(e,t)=>{if(!e)return!0;const r=e.toLowerCase(),n=["plot / land","plot / land / indusrtial property","plot / land / industrial property","commercial shop","warehouse / godown","warehouse","godown","land","plot"],i=["commercial office","commercial"];return"bedrooms"===t?!n.some(e=>r.includes(e))&&!i.some(e=>r.includes(e)):"bathrooms"!==t||!n.some(e=>r.includes(e))},ze=e=>{if(!e)return"Recently";try{const t=new Date(e);if(isNaN(t.getTime()))return"Recently";const r=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()],n=t.getFullYear();return"".concat(r," ").concat(n)}catch(t){return console.error("Error formatting date:",t),"Recently"}},Be=t=>{let{currentProperty:r}=t;const[n,o]=(0,e.useState)([]),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(!1),d=(0,e.useRef)(null),h=(0,e.useRef)(null),p=(0,e.useRef)(null),m=(0,e.useRef)(null),f=(0,e.useRef)(!1),g=(0,e.useRef)(!1);(0,e.useEffect)(()=>{if(!r)return;(async()=>{try{var e;l(!0);const t=(e=>{if(!e||"string"!==typeof e)return null;const t=e.split(",").map(e=>e.trim()).filter(Boolean);return t.length>0?t[t.length-1]:e})(r.location),n=(e=>{if(!e)return null;const t=String(e).toLowerCase();return t.includes("rent")?"rent":t.includes("sale")?"sale":null})(r.status),s=r.type||r.property_type,a={limit:50};t&&(a.city=t),n&&(a.status=n),s&&(a.property_type=s);const c=await i.propertiesAPI.list(a);if(c.success&&null!==(e=c.data)&&void 0!==e&&e.properties){const e="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",t=c.data.properties.filter(e=>e.id!==r.id).slice(0,12).map(t=>{var r;let n=t.cover_image||Array.isArray(t.images)&&t.images[0]||("string"===typeof t.images?null===(r=t.images.split(",")[0])||void 0===r?void 0:r.trim():null)||null;n&&("string"!==typeof n||n.trim())||(n=e);const i=Array.isArray(t.images)||"string"===typeof t.images?t.images:[n];return{id:t.id,image:n,images:i,title:t.title,price:parseFloat(t.price),location:t.location,bedrooms:t.bedrooms||"0",bathrooms:t.bathrooms||"0",area:parseFloat(t.area)||0,type:t.property_type,status:"sale"===t.status?"For Sale":"rent"===t.status?"For Rent":t.status||"For Sale",available_for_bachelors:t.available_for_bachelors}});o(t)}else o([])}catch(t){console.error("Error fetching related properties:",t),o([])}finally{l(!1)}})()},[null===r||void 0===r?void 0:r.id,null===r||void 0===r?void 0:r.location,null===r||void 0===r?void 0:r.status,null===r||void 0===r?void 0:r.type,null===r||void 0===r?void 0:r.property_type]),(0,e.useLayoutEffect)(()=>{const e=!g.current&&c;if(g.current=c,!e||!d.current||!h.current)return;const t=d.current,r=h.current,n=window.getComputedStyle(r).transform;let i=0;if(n&&"none"!==n){const e=n.match(/matrix\((.+)\)/);if(e){const t=e[1].split(",").map(e=>parseFloat(e.trim()));t.length>=6&&(i=t[4])}}t.scrollLeft=Math.max(0,-i),r.style.transform="translateX(0)"},[c]),(0,e.useLayoutEffect)(()=>{const e=g.current&&!c;if(g.current=c,!e||!d.current||!h.current)return;const t=d.current,r=h.current,n=t.scrollLeft,i=r.scrollWidth;if(t.scrollLeft=0,r.style.transform="",i>0&&n>0){const e=100*n/i;r.style.animation="related-properties-auto-scroll 120s linear infinite",r.style.animationDelay="-".concat(e,"s")}else r.style.animation="",r.style.animationDelay=""},[c]);const y=(0,e.useCallback)(()=>{p.current&&clearTimeout(p.current),u(!0)},[]),_=(0,e.useCallback)(()=>{p.current&&clearTimeout(p.current),p.current=setTimeout(()=>u(!1),500)},[]),v=(0,e.useCallback)(()=>u(!0),[]),x=(0,e.useCallback)(()=>{f.current||u(!1)},[]),b=(0,e.useCallback)(()=>u(!0),[]),w=(0,e.useCallback)(()=>{m.current&&clearTimeout(m.current),m.current=setTimeout(()=>u(!1),2e3)},[]),j=(0,e.useCallback)(()=>{f.current=!0,u(!0),m.current&&clearTimeout(m.current),m.current=setTimeout(()=>{f.current=!1,u(!1)},3e3)},[]);(0,e.useEffect)(()=>()=>{p.current&&clearTimeout(p.current),m.current&&clearTimeout(m.current)},[]);const T=e=>{d.current&&d.current.scrollBy({left:e,behavior:"smooth"})};return a||0===n.length?null:(0,s.jsxs)("div",{className:"related-properties-section",children:[(0,s.jsxs)("div",{className:"related-properties-header",children:[(0,s.jsx)("h2",{children:"Related Properties"}),(0,s.jsxs)("div",{className:"related-properties-arrows",children:[(0,s.jsx)("button",{type:"button",className:"related-properties-arrow related-properties-arrow-left",onClick:()=>T(-400),"aria-label":"Scroll left",children:(0,s.jsx)(ve,{})}),(0,s.jsx)("button",{type:"button",className:"related-properties-arrow related-properties-arrow-right",onClick:()=>T(400),"aria-label":"Scroll right",children:(0,s.jsx)(xe,{})})]})]}),(0,s.jsx)("div",{className:"related-properties-horizontal-scroll buyer-auto-scroll-container ".concat(c?"paused":""),ref:d,onMouseEnter:v,onMouseLeave:x,onTouchStart:b,onTouchEnd:w,onScroll:j,children:(0,s.jsxs)("div",{className:"related-properties-wrapper buyer-property-cards-wrapper buyer-auto-scroll-wrapper",ref:h,children:[n.map(e=>(0,s.jsx)(S,{property:e,onCarouselInteractionStart:y,onCarouselInteractionEnd:_,onCardMouseEnter:v,onCardMouseLeave:x},"original-".concat(e.id))),n.map(e=>(0,s.jsx)(S,{property:e,onCarouselInteractionStart:y,onCarouselInteractionEnd:_,onCardMouseEnter:v,onCardMouseLeave:x},"duplicate-".concat(e.id)))]})})]})},Ue=t=>{var r,n;let{property:o}=t;const[a,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0),[d,h]=(0,e.useState)(null),p=e=>{if(!e)return null;if("number"===typeof e)return e;if("string"===typeof e){const t=e.replace(/[\u20b9,\s]/g,""),r=parseFloat(t);return isNaN(r)?null:r}return null},m=e=>{if(null===e||void 0===e||""===e)return null;const t="string"===typeof e?parseFloat(e):e;return isNaN(t)?null:t},f=(e,t)=>null!==e&&null!==t&&(e>=-90&&e<=90&&t>=-180&&t<=180);(0,e.useEffect)(()=>{if(!o)return void h(null);const e=m(null===o||void 0===o?void 0:o.latitude),t=m(null===o||void 0===o?void 0:o.longitude);if(f(e,t))return void h({lat:e,lng:t});const r=null===o||void 0===o?void 0:o.location;if(!r||!De)return void h(null);let n=!1;return(async()=>{try{const e="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(r),".json?access_token=").concat(De,"&country=in&limit=1"),t=await fetch(e);if(!t.ok)return;const i=await t.json(),s=i.features&&i.features[0];if(!s||!Array.isArray(s.center)||s.center.length<2)return;const[o,a]=s.center;if(n)return;f(a,o)?h({lat:a,lng:o}):h(null)}catch(e){n||(console.error("Error geocoding property location:",e),h(null))}})(),()=>{n=!0}},[o]),(0,e.useEffect)(()=>{(async()=>{if(!o||!d)return void u(!1);d.lat,d.lng;try{u(!0);const e=await i.propertiesAPI.list({limit:100});if(e.success&&e.data&&e.data.properties){console.log("\ud83d\udcca Total properties fetched:",e.data.properties.length);const t=e.data.properties.filter(e=>{if(e.id===o.id)return console.log("\u23ed\ufe0f Skipping current property:",e.id),!1;const t=m(e.latitude),r=m(e.longitude);return f(t,r)?(console.log("\u2705 Property with valid coordinates:",e.id,e.title),!0):(console.log("\u274c Property missing coordinates:",e.id,e.title,"lat:",e.latitude,"lng:",e.longitude),!1)}).map(e=>{const t=m(e.latitude),r=m(e.longitude);let n="sale";if(e.status){const t=e.status.toLowerCase();t.includes("rent")?n="rent":t.includes("sale")&&(n="sale")}let i=null,s=[];return e.images&&Array.isArray(e.images)&&e.images.length>0?"string"===typeof e.images[0]?(i=e.images[0],s=e.images.map(t=>({url:t,alt:e.title}))):e.images[0].url&&(i=e.images[0].url,s=e.images):e.cover_image&&(i=e.cover_image,s=[{url:e.cover_image,alt:e.title}]),{id:e.id,title:e.title,location:e.location,price:p(e.price),area:e.area,bedrooms:e.bedrooms,bathrooms:e.bathrooms,listing_type:n,property_type:e.property_type,latitude:t,longitude:r,thumbnail:i,images:s,cover_image:i,seller_id:e.user_id||e.seller_id}});console.log("\ud83d\uddfa\ufe0f Nearby properties to display on map:",t.length),console.log("\ud83d\udccd Nearby properties details:",t.map(e=>({id:e.id,title:e.title,lat:e.latitude,lng:e.longitude}))),l(t)}else console.log("\u26a0\ufe0f No properties in response:",e)}catch(e){console.error("Error fetching nearby properties:",e)}finally{u(!1)}})()},[o,d]);const g=null!==(r=null===d||void 0===d?void 0:d.lat)&&void 0!==r?r:null,y=null!==(n=null===d||void 0===d?void 0:d.lng)&&void 0!==n?n:null,_=f(g,y),v=o&&_?{id:o.id,title:o.title,location:o.location,price:p(o.price),area:o.area,bedrooms:o.bedrooms,bathrooms:o.bathrooms,listing_type:"For Rent"===o.status?"rent":"sale",property_type:o.type,latitude:g,longitude:y,thumbnail:o.images&&o.images.length>0?o.images[0].url:null,images:o.images,cover_image:o.images&&o.images.length>0?o.images[0].url:null,seller_id:o.seller_id}:null,x=v?[v,...a]:a;console.log("\ud83d\uddfa\ufe0f Final mapProperties to display:",x.length),console.log("\ud83d\udccd Map properties details:",x.map(e=>({id:e.id,title:e.title,lat:e.latitude,lng:e.longitude,isCurrent:e.id===(null===o||void 0===o?void 0:o.id)})));const b=_?[y,g]:[78.9629,20.5937],w=_?14:5;return(0,s.jsxs)("div",{className:"map-card-container",children:[(0,s.jsx)("h3",{children:"Property Location"}),(0,s.jsx)("div",{className:"map-embed-area","aria-label":"Map for ".concat((null===o||void 0===o?void 0:o.location)||"Property"),children:o&&_?(0,s.jsx)(Ie,{properties:x,center:b,zoom:w,showControls:!0,interactive:!0,currentPropertyId:o.id,onPropertyClick:e=>{console.log("Property clicked:",e)}}):(0,s.jsxs)("p",{className:"map-placeholder-text",children:["Map Feature Placeholder: Location for ",(0,s.jsx)("strong",{children:(null===o||void 0===o?void 0:o.location)||"this property"})]})})]})},Ve=()=>{var t,o,a;const c=(0,n.Zp)(),{user:u}=l(),d=(0,n.zy)(),{id:h}=(0,n.g)();let p;if(h)p=parseInt(h,10);else{const e=d.pathname.match(/\/details\/(\d+)/);p=e?parseInt(e[1],10):null}const[m,f]=(0,e.useState)(null),[g,y]=(0,e.useState)(!0),[_,v]=(0,e.useState)(null);(0,e.useEffect)(()=>{p?(async()=>{try{y(!0);const l=await i.propertiesAPI.getDetails(p);if(l.success&&l.data&&l.data.property){var e,t,r,n,s;const i=l.data.property;let c,u;const d=i.user_type||(null===(e=i.seller)||void 0===e?void 0:e.user_type);var o,a;"agent"===d?(c=i.user_id||(null===(o=i.seller)||void 0===o?void 0:o.id),u="agent"):(c=i.user_id||(null===(a=i.seller)||void 0===a?void 0:a.id),u="seller"),c||console.error("Cannot determine receiver from property data:",i);const h={id:i.id,title:i.title,location:i.location,price:parseFloat(i.price),area:parseFloat(i.area),bedrooms:i.bedrooms,bathrooms:i.bathrooms,status:"sale"===i.status?"For Sale":"For Rent",type:i.property_type,property_type:i.property_type,description:i.description||"",amenities:Array.isArray(i.amenities)?i.amenities:i.amenities?i.amenities.split(","):[],images:Array.isArray(i.images)&&i.images.length>0?i.images.map((e,t)=>({id:t+1,url:e,alt:i.title})):i.cover_image?[{id:1,url:i.cover_image,alt:i.title}]:[],latitude:i.latitude,longitude:i.longitude,created_at:i.created_at||i.createdAt||null,price_negotiable:i.price_negotiable||i.priceNegotiable||!1,maintenance_charges:i.maintenance_charges||i.maintenanceCharges||null,deposit_amount:i.deposit_amount||i.depositAmount||null,balconies:i.balconies||null,floor:0===i.floor||"0"===i.floor?i.floor:i.floor||null,total_floors:i.total_floors||null,totalFloors:i.total_floors||null,facing:i.facing||null,age:i.age||null,furnishing:i.furnishing||null,carpet_area:i.carpet_area||null,carpetArea:i.carpet_area||null,state:i.state||null,additional_address:i.additional_address||null,additionalAddress:i.additional_address||null,available_for_bachelors:1===i.available_for_bachelors||!0===i.available_for_bachelors,video_url:(console.log("ViewDetailsPage: Property video_url from API:",i.video_url),Re(i.video_url)),videoUrl:Re(i.video_url),seller_id:c,agent_id:"agent"===d?c:null,user_type:d,receiverId:c,receiverRole:u,seller_name:(null===(t=i.seller)||void 0===t?void 0:t.full_name)||(null===(r=i.seller)||void 0===r?void 0:r.name)||"Property Owner",seller_email:(null===(n=i.seller)||void 0===n?void 0:n.email)||"",seller_phone:(null===(s=i.seller)||void 0===s?void 0:s.phone)||""};f(h)}else console.error("Property not found or invalid response:",l),v("Property not found")}catch(l){console.error("Error fetching property:",l),v(l.message||"Failed to load property details")}finally{y(!1)}})():(v("Invalid property ID"),y(!1))},[p]),(0,e.useEffect)(()=>{p&&window.scrollTo(0,0)},[p]);const x=m?(e=>{var t;if(!e)return null;const r=e.images&&e.images.length>0?e.images:[{id:1,url:"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",alt:e.title}],n=e.amenities&&e.amenities.length>0?e.amenities:["Swimming Pool","Gymnasium","24/7 Security","Covered Parking","Clubhouse","Children's Play Area"],i=(e=>{if(!e||"string"!==typeof e)return"";let t=e.replace(/\r\n/g,"\n").replace(/\r/g,"\n");return t=t.replace(/\n{3,}/g,"\n\n"),t=t.replace(/[ \t]{2,}/g," "),t=t.split("\n").map(e=>e.trim()).join("\n"),t=t.trim(),t=t.replace(/^\n+|\n+$/g,""),t})(e.description||"Discover unparalleled living in this magnificent ".concat(e.type||"property",". Featuring modern amenities, panoramic city views, and spacious interiors. Perfect blend of comfort and luxury."));return{title:e.title,location:e.location,price:"For Rent"===e.status?"\u20b9 ".concat(e.price.toLocaleString("en-IN"),"/Month"):"\u20b9 ".concat(e.price.toLocaleString("en-IN")),area:"".concat(null===(t=e.area)||void 0===t?void 0:t.toLocaleString("en-IN")," sq.ft."),bedrooms:e.bedrooms,bathrooms:e.bathrooms,status:e.status,type:e.type,description:i,amenities:n,images:r,listedSince:ze(e.created_at),priceNegotiable:e.price_negotiable||e.priceNegotiable||!1,maintenanceCharges:e.maintenance_charges||e.maintenanceCharges||null,depositAmount:e.deposit_amount||e.depositAmount||null,balconies:e.balconies||null,floor:0===e.floor||"0"===e.floor?0:void 0!==e.floor&&null!==e.floor&&""!==e.floor?e.floor:null,totalFloors:e.total_floors||e.totalFloors||null,facing:e.facing||null,age:e.age||null,furnishing:e.furnishing||null,carpetArea:e.carpet_area||e.carpetArea?"".concat((e.carpet_area||e.carpetArea).toLocaleString("en-IN")," sq.ft"):null,state:e.state||null,additionalAddress:e.additional_address||e.additionalAddress||null,propertyType:e.property_type||e.propertyType||e.type||null,videoUrl:Re(e.video_url||e.videoUrl),availableForBachelors:1===e.available_for_bachelors||!0===e.available_for_bachelors||!1}})(m):null,b=(null===x||void 0===x||null===(t=x.images)||void 0===t?void 0:t.length)||0,[S,T]=(0,e.useState)(null),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(!1),[N,I]=(0,e.useState)(!1),[P,M]=(0,e.useState)(()=>{try{const e=localStorage.getItem("buyer_interacted_properties");if(e){const t=JSON.parse(e);return new Set(t.map(String))}}catch(_){console.error("Error loading interacted properties from localStorage:",_)}return new Set}),[L,R]=(0,e.useState)({remaining:5,max:5,used:0,canPerform:!0,resetTime:null,resetTimeSeconds:null}),[D,F]=(0,e.useState)(!1),O=(0,e.useCallback)(e=>{b>0&&T(e)},[b]),z=(0,e.useCallback)(()=>{T(null)},[]),B=(0,e.useCallback)(()=>{0!==b&&T(e=>(e+1)%b)},[b]),U=(0,e.useCallback)(()=>{0!==b&&T(e=>(e-1+b)%b)},[b]),V=((0,e.useCallback)(()=>{window.history.back()},[]),(0,e.useCallback)(async()=>{if(u&&"buyer"===u.user_type&&p)try{F(!0);const e=await i.Vp.checkLimit(p,"view_owner");e.success&&R({remaining:e.data.remaining_attempts,max:e.data.max_attempts,used:e.data.used_attempts,canPerform:e.data.can_perform_action,resetTime:e.data.reset_time,resetTimeSeconds:e.data.reset_time_seconds})}catch(_){console.error("Error fetching interaction limits:",_)}finally{F(!1)}},[u,p]));(0,e.useEffect)(()=>{m&&u&&"buyer"===u.user_type&&V()},[m,u,V]),(0,e.useEffect)(()=>{p&&P.has(String(p))&&!N&&I(!0)},[p,P,N]);const q=(0,e.useCallback)(e=>{if(u&&"buyer"===u.user_type&&m)try{j.addToHistory({propertyId:m.id,propertyTitle:m.title,ownerName:m.seller_name||"Property Owner",ownerContactNumber:m.seller_phone||"",ownerEmail:m.seller_email||"",actionType:e})}catch(_){console.error("Error storing buyer history:",_)}},[u,m]),W=(0,e.useCallback)(async(e,t)=>{if(!u||"buyer"!==u.user_type||!p)return!1;if(P.has(String(p)))return t&&t(),!0;if(!L.canPerform)return alert("Daily interaction limit reached. Try again after 12 hours."),!1;try{const r=await i.Vp.recordInteraction(p,e);return r.success?(M(e=>{const t=new Set([...e,String(p)]);try{localStorage.setItem("buyer_interacted_properties",JSON.stringify([...t]))}catch(_){console.error("Error saving interacted properties to localStorage:",_)}return t}),R({remaining:r.data.remaining_attempts,max:r.data.max_attempts,used:r.data.used_attempts,canPerform:r.data.remaining_attempts>0,resetTime:r.data.reset_time,resetTimeSeconds:r.data.reset_time_seconds}),q("view_owner"===e?"viewed_owner_details":"chat_with_owner"),t&&t(),!0):(console.error("Failed to record interaction:",r),alert(r.message||"Failed to record interaction"),!1)}catch(_){if(console.error("Error recording interaction:",_),429===_.status&&_.data)R({remaining:_.data.remaining_attempts||0,max:_.data.max_attempts||5,used:_.data.used_attempts||5,canPerform:!1,resetTime:_.data.reset_time,resetTimeSeconds:_.data.reset_time_seconds}),alert(_.data.message||"Daily interaction limit reached. Try again after 12 hours.");else{var r;const t=_.message||(null===(r=_.data)||void 0===r?void 0:r.message)||"Failed to record interaction. Please try again.";console.error("Full error details:",_),alert(t)}return!1}},[u,p,P,L,q]),H=(0,e.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),!u){alert("Please login to view owner details");const e=p?"/details/".concat(p):"/";return void c("/login?returnUrl=".concat(encodeURIComponent(e)))}"buyer"===u.user_type?N||await W("view_owner",()=>{I(!0)}):alert("Only buyers can view owner details")},[u,p,N,c,W]),G=(0,e.useCallback)(async()=>{var e;if(!u){alert("Please login to chat with the owner");const e=p?"/details/".concat(p):"/";return void c("/login?returnUrl=".concat(encodeURIComponent(e)))}if("buyer"!==u.user_type)return void alert("Only buyers can chat with property owners");let t,n;if("agent"===(m.user_type||(null===(e=m.seller)||void 0===e?void 0:e.user_type))?(t=m.user_id||m.receiverId||m.seller_id,n="agent"):(t=m.user_id||m.receiverId||m.seller_id,n="seller"),!m||!t)return void alert("Property owner information not available");if(Number(u.id)===Number(t))return void alert("You cannot chat with yourself. This is your property.");await W("chat_owner",async()=>{var e,n;const{generateChatRoomId:i}=await Promise.resolve().then(r.bind(r,935)),s=i(u.id,t,p),o=(null===m||void 0===m?void 0:m.seller_name)||(null===m||void 0===m||null===(e=m.seller)||void 0===e?void 0:e.name)||(null===m||void 0===m||null===(n=m.seller)||void 0===n?void 0:n.full_name)||"Property Owner",a=encodeURIComponent(o);c("/ChatUs?chatId=".concat(s,"&ownerName=").concat(a,"&propertyId=").concat(p))})},[u,m,p,c,W]),Z=async e=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),E(!0),void setTimeout(()=>E(!1),2e3);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();try{if(!document.execCommand("copy"))throw new Error("execCommand failed");E(!0),setTimeout(()=>E(!1),2e3)}finally{document.body.removeChild(t)}}catch(_){console.error("Failed to copy to clipboard:",_);if(window.confirm("Share this property link:\n\n".concat(e,"\n\nClick OK to copy, then paste it manually.")))try{navigator.clipboard&&navigator.clipboard.writeText&&(await navigator.clipboard.writeText(e),E(!0),setTimeout(()=>E(!1),2e3))}catch(t){console.error("Final clipboard attempt failed:",t)}}};if((0,e.useEffect)(()=>{(async()=>{if(p)try{const e=w.isFavorite(p);A(e);if(localStorage.getItem("authToken")&&u){const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.list();if(t.success&&t.data){const e=(t.data.properties||t.data.favorites||[]).map(e=>e.id||e.property_id);A(e.includes(p))}}}catch(_){console.error("Error checking favorite status:",_),A(w.isFavorite(p))}})()},[p,u]),(0,e.useEffect)(()=>{const e=e=>{null!==S&&("Escape"===e.key?z():"ArrowLeft"===e.key?U():"ArrowRight"===e.key&&B())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[S,z,B,U]),g)return(0,s.jsx)("div",{className:"details-wrapper",children:(0,s.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:(0,s.jsx)("p",{children:"Loading property details..."})})});if(_)return(0,s.jsx)("div",{className:"details-wrapper",children:(0,s.jsxs)("div",{style:{padding:"2rem",textAlign:"center"},children:[(0,s.jsxs)("p",{style:{color:"#c33",marginBottom:"1rem"},children:["Error: ",_]}),(0,s.jsx)("button",{onClick:()=>window.history.back(),style:{padding:"0.5rem 1rem",cursor:"pointer"},children:"Go Back"})]})});if(!m||!x)return(0,s.jsx)("div",{className:"details-wrapper",children:(0,s.jsxs)("div",{style:{padding:"2rem",textAlign:"center"},children:[(0,s.jsx)("p",{style:{color:"#c33",marginBottom:"1rem"},children:"Property not found"}),(0,s.jsx)("button",{onClick:()=>window.history.back(),style:{padding:"0.5rem 1rem",cursor:"pointer"},children:"Go Back"})]})});const K=x.images.slice(1,5),Y=x.images.length-5;return(0,s.jsxs)("div",{className:"details-wrapper",children:[(0,s.jsxs)("main",{className:"view-details-page",children:[(0,s.jsx)("div",{className:"title-location-container",children:(0,s.jsxs)("div",{className:"details-container",children:[(0,s.jsxs)("div",{className:"details-container-actions",children:[(0,s.jsx)("button",{className:"buyer-favourite-btn ".concat(k?"active":""),onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),!u)return alert("Please login to add properties to favorites"),void c("/login");try{const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.toggle(p);t.success?(A(void 0!==t.data.is_favorite?t.data.is_favorite:!k),w.toggleFavorite(p)):(console.error("Failed to toggle favorite:",t.message),alert(t.message||"Failed to update favorite"))}catch(_){console.error("Error toggling favorite:",_),w.toggleFavorite(p),A(!k)}},"aria-label":k?"Remove from favorites":"Add to favorites",title:k?"Remove from favorites":"Add to favorites",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:k?"white":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),(0,s.jsx)("button",{className:"buyer-share-btn",onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),!m||!m.id)return void console.error("Cannot share: property ID is missing");const t="".concat(window.location.origin,"/details/").concat(m.id),r={title:m.title||"Property Listing",text:"Check out this property: ".concat(m.title||"Amazing Property"),url:t};if(navigator.share)try{await navigator.share(r),console.log("Share successful")}catch(_){"AbortError"!==_.name&&(console.error("Error sharing:",_),await Z(t))}else await Z(t)},"aria-label":"Share",title:"Share",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,s.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,s.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,s.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,s.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})})]}),(0,s.jsx)("header",{className:"property-header",children:(0,s.jsxs)("div",{className:"header-top-row",children:[(0,s.jsxs)("div",{className:"header-status-left",children:[(0,s.jsx)("span",{className:"property-status-text ".concat("For Sale"===x.status?"property-for-sale":"For Rent"===x.status?"property-for-rent":""),children:x.status}),(0,s.jsxs)("span",{className:"listed-since-text",children:["Listed since ",x.listedSince||"Recently"]})]}),(0,s.jsxs)("div",{className:"header-center",children:[(0,s.jsx)("h1",{children:x.title}),(0,s.jsx)("div",{className:"property-location-row",children:(0,s.jsx)("p",{className:"property-location",children:x.location})})]})]})})]})}),(0,s.jsxs)("div",{className:"image-gallery-container",children:[(0,s.jsxs)("div",{className:"mobile-image-slider",children:[(0,s.jsx)("div",{className:"mobile-slider-track",children:x.images.map((e,t)=>(0,s.jsx)("div",{className:"mobile-slide",onClick:()=>O(t),children:(0,s.jsx)("img",{src:e.url,alt:e.alt})},e.id))}),(0,s.jsx)("div",{className:"mobile-slider-dots",children:x.images.map((e,t)=>(0,s.jsx)("span",{className:"dot"},t))})]}),(0,s.jsxs)("div",{className:"image-gallery desktop-only",children:[(0,s.jsx)("div",{className:"main-image",onClick:()=>O(0),children:(0,s.jsx)("img",{src:(null===(o=x.images[0])||void 0===o?void 0:o.url)||"",alt:(null===(a=x.images[0])||void 0===a?void 0:a.alt)||x.title})}),(0,s.jsx)("div",{className:"thumbnail-gallery",children:K.map((e,t)=>(0,s.jsxs)("div",{className:"thumbnail",onClick:()=>O(t+1),children:[(0,s.jsx)("img",{src:e.url,alt:e.alt}),3===t&&Y>=0&&(0,s.jsx)("div",{className:"view-more-overlay",children:(0,s.jsxs)("span",{children:["Show all ",x.images.length," photos"]})})]},e.id))})]})]}),console.log("ViewDetailsPage: Checking videoUrl for display:",{propertyData:x,videoUrl:null===x||void 0===x?void 0:x.videoUrl,video_url:null===x||void 0===x?void 0:x.video_url,hasVideoUrl:!(null===x||void 0===x||!x.videoUrl)}),(null===x||void 0===x?void 0:x.videoUrl)&&Re(x.videoUrl)&&(0,s.jsx)("div",{className:"property-video-container",children:(0,s.jsxs)("div",{className:"details-container",children:[(0,s.jsx)("h2",{className:"property-video-heading",children:"Property Video"}),(0,s.jsx)("div",{className:"property-video-wrapper",children:(0,s.jsxs)("video",{controls:!0,preload:"metadata",className:"property-video-player",style:{width:"100%",maxWidth:"100%",height:"auto",borderRadius:"8px",backgroundColor:"#000"},onError:e=>{console.error("Video load error:",e),console.error("Video URL:",x.videoUrl)},children:[(0,s.jsx)("source",{src:x.videoUrl,type:"video/mp4"}),(0,s.jsx)("source",{src:x.videoUrl,type:"video/webm"}),(0,s.jsx)("source",{src:x.videoUrl,type:"video/quicktime"}),"Your browser does not support the video tag."]})})]})}),(0,s.jsxs)("div",{className:"details-container",children:[(0,s.jsxs)("div",{className:"main-content-area",children:[(0,s.jsxs)("div",{className:"property-price-section",children:[(0,s.jsx)("h2",{className:"price-section-heading",children:"Price"}),(0,s.jsxs)("div",{className:"property-price-display",children:[(0,s.jsx)("span",{className:"price-amount",children:x.price}),"For Rent"===x.status&&(0,s.jsx)("span",{className:"price-period",children:"per month"})]})]}),(0,s.jsxs)("div",{className:"highlights-contact-wrapper",children:[(0,s.jsx)("div",{className:"property-highlights",children:(()=>{const e=Oe(x.type,"bedrooms"),t=Oe(x.type,"bathrooms");return(0,s.jsxs)(s.Fragment,{children:[e&&x.bedrooms&&(0,s.jsxs)("div",{className:"highlight-item",children:[(0,s.jsx)(be,{className:"highlight-icon"}),(0,s.jsxs)("div",{className:"highlight-content",children:[(0,s.jsx)("span",{className:"highlight-value",children:x.bedrooms}),(0,s.jsxs)("span",{className:"highlight-label",children:["bedroom",1!==x.bedrooms?"s":""]})]})]}),t&&x.bathrooms&&(0,s.jsxs)("div",{className:"highlight-item",children:[(0,s.jsx)(Te,{className:"highlight-icon"}),(0,s.jsxs)("div",{className:"highlight-content",children:[(0,s.jsx)("span",{className:"highlight-value",children:x.bathrooms}),(0,s.jsxs)("span",{className:"highlight-label",children:["bathroom",1!==x.bathrooms?"s":""]})]})]}),(0,s.jsxs)("div",{className:"highlight-item",children:[(0,s.jsx)(Se,{className:"highlight-icon"}),(0,s.jsxs)("div",{className:"highlight-content",children:[(0,s.jsx)("span",{className:"highlight-value",children:x.area}),(0,s.jsx)("span",{className:"highlight-label",children:"area"})]})]})]})})()}),(0,s.jsx)("aside",{className:"agent-sidebar",children:(0,s.jsxs)("div",{className:"detail-contact-card",children:[m&&m.seller_id&&(0,s.jsxs)(s.Fragment,{children:[!N&&(0,s.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,s.jsxs)("button",{type:"button",onClick:H,className:"contact-send-button",disabled:!P.has(String(p))&&!L.canPerform||D,title:P.has(String(p))||L.canPerform?"":"Daily interaction limit reached. Try again after 12 hours.",style:{marginTop:"0",marginBottom:"0.5rem",opacity:!P.has(String(p))&&!L.canPerform||D?.6:1,cursor:!P.has(String(p))&&!L.canPerform||D?"not-allowed":"pointer"},children:[(0,s.jsx)(Ae,{style:{marginRight:"8px"}}),"Show Owner Details"]}),u&&"buyer"===u.user_type&&(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:L.canPerform?"#666":"#ef4444",marginTop:"0.25rem",padding:"0.25rem 0.5rem",backgroundColor:L.canPerform?"#f3f4f6":"#fee2e2",borderRadius:"4px"},children:[L.remaining," / ",L.max," interactions remaining",L.used>0&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontSize:"0.7rem"},children:"Resets in 12 hours"}),!L.canPerform&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontWeight:"bold",fontSize:"0.7rem"},children:"Daily interaction limit reached. Try again after 12 hours."})]})]}),N&&(0,s.jsxs)("div",{className:"owner-details-section",style:{marginBottom:"1rem"},children:[m.seller_name?(0,s.jsxs)("div",{className:"owner-detail-item",children:[(0,s.jsx)("span",{className:"owner-detail-label",children:"Name:"}),(0,s.jsx)("span",{className:"owner-detail-value",children:m.seller_name})]}):(0,s.jsxs)("div",{className:"owner-detail-item",children:[(0,s.jsx)("span",{className:"owner-detail-label",children:"Name:"}),(0,s.jsx)("span",{className:"owner-detail-value",children:"Not available"})]}),m.seller_phone?(0,s.jsxs)("div",{className:"owner-detail-item",children:[(0,s.jsx)("span",{className:"owner-detail-label",children:"Phone:"}),(0,s.jsx)("a",{href:"tel:".concat(m.seller_phone),className:"owner-detail-value owner-detail-link",children:m.seller_phone})]}):(0,s.jsxs)("div",{className:"owner-detail-item",children:[(0,s.jsx)("span",{className:"owner-detail-label",children:"Phone:"}),(0,s.jsx)("span",{className:"owner-detail-value",children:"Not available"})]}),m.seller_email?(0,s.jsxs)("div",{className:"owner-detail-item",children:[(0,s.jsx)("span",{className:"owner-detail-label",children:"Email:"}),(0,s.jsx)("a",{href:"mailto:".concat(m.seller_email),className:"owner-detail-value owner-detail-link",children:m.seller_email})]}):(0,s.jsxs)("div",{className:"owner-detail-item",children:[(0,s.jsx)("span",{className:"owner-detail-label",children:"Email:"}),(0,s.jsx)("span",{className:"owner-detail-value",children:"Not available"})]})]})]}),u&&"buyer"===u.user_type&&m&&m.seller_id&&Number(u.id)!==Number(m.seller_id)&&(0,s.jsxs)("div",{style:{marginTop:N?"1rem":"0"},children:[(0,s.jsxs)("button",{type:"button",onClick:G,className:"contact-send-button",disabled:!P.has(String(p))&&!L.canPerform||D,title:P.has(String(p))||L.canPerform?"":"Daily interaction limit reached. Try again after 12 hours.",style:{opacity:!P.has(String(p))&&!L.canPerform||D?.6:1,cursor:!P.has(String(p))&&!L.canPerform||D?"not-allowed":"pointer"},children:[(0,s.jsx)(je,{style:{marginRight:"8px"}}),"Chat with Owner"]}),(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:L.canPerform?"#666":"#ef4444",marginTop:"0.25rem",padding:"0.25rem 0.5rem",backgroundColor:L.canPerform?"#f3f4f6":"#fee2e2",borderRadius:"4px"},children:[L.remaining," / ",L.max," interactions remaining",L.used>0&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontSize:"0.7rem"},children:"Resets in 12 hours"}),!L.canPerform&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontWeight:"bold",fontSize:"0.7rem"},children:"Daily interaction limit reached. Try again after 12 hours."})]})]})]})})]}),(0,s.jsxs)("div",{className:"property-details-full-section",children:[(0,s.jsx)("h2",{children:"Property Details"}),(0,s.jsxs)("div",{className:"property-details-grid",children:[x.propertyType&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Property Type"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.propertyType})]}),x.bedrooms&&Oe(x.type,"bedrooms")&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Bedrooms"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.bedrooms})]}),x.bathrooms&&Oe(x.type,"bathrooms")&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Bathrooms"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.bathrooms})]}),x.balconies&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Balconies"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.balconies})]}),x.area&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Built-up Area"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.area})]}),x.carpetArea&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Carpet Area"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.carpetArea})]}),null!==x.floor&&void 0!==x.floor&&""!==x.floor&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Floor"}),(0,s.jsx)("span",{className:"property-detail-value",children:0===x.floor||"0"===x.floor?"Ground floor":x.floor})]}),x.totalFloors&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Total Floors"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.totalFloors})]}),x.facing&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Facing"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.facing})]}),x.age&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Age"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.age})]}),x.furnishing&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Furnishing"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.furnishing})]}),x.state&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"State"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.state})]}),x.additionalAddress&&(0,s.jsxs)("div",{className:"property-detail-item property-detail-item-full",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Additional Address"}),(0,s.jsx)("span",{className:"property-detail-value",children:x.additionalAddress})]}),void 0!==x.availableForBachelors&&"For Rent"===x.status&&(0,s.jsxs)("div",{className:"property-detail-item",children:[(0,s.jsx)("span",{className:"property-detail-label",children:"Available for Bachelors"}),(0,s.jsx)("span",{className:"property-detail-value ".concat(x.availableForBachelors?"available-yes":"available-no"),children:x.availableForBachelors?"Yes":"No"})]})]})]}),(0,s.jsxs)("div",{className:"amenities-section",children:[(0,s.jsx)("h2",{children:"What this place offers"}),(0,s.jsx)("div",{className:"amenities-grid",children:x.amenities.map((e,t)=>(0,s.jsxs)("div",{className:"amenity-item",children:[(0,s.jsx)("span",{className:"amenity-icon",children:Me(e)}),(0,s.jsx)("span",{children:Le(e)})]},t))})]}),(0,s.jsxs)("div",{className:"pricing-details-section",children:[(0,s.jsx)("h2",{children:"Pricing Details"}),(0,s.jsxs)("div",{className:"pricing-details-grid",children:[(0,s.jsxs)("div",{className:"pricing-detail-item",children:[(0,s.jsx)("span",{className:"pricing-label",children:"Price Negotiable"}),(0,s.jsx)("span",{className:"pricing-value ".concat(x.priceNegotiable?"negotiable-yes":"negotiable-no"),children:x.priceNegotiable?"Yes":"No"})]}),x.maintenanceCharges&&(0,s.jsxs)("div",{className:"pricing-detail-item",children:[(0,s.jsx)("span",{className:"pricing-label",children:"Maintenance Charge"}),(0,s.jsxs)("span",{className:"pricing-value",children:["\u20b9 ",x.maintenanceCharges.toLocaleString("en-IN"),"/Month"]})]}),x.depositAmount&&(0,s.jsxs)("div",{className:"pricing-detail-item",children:[(0,s.jsx)("span",{className:"pricing-label",children:"Deposit Amount"}),(0,s.jsxs)("span",{className:"pricing-value",children:["\u20b9 ",x.depositAmount.toLocaleString("en-IN")]})]})]})]}),(0,s.jsxs)("div",{className:"description-section",children:[(0,s.jsx)("h2",{children:"About this place"}),(0,s.jsx)("p",{children:x.description})]})]}),(0,s.jsx)(Ue,{property:m}),(0,s.jsx)(Be,{currentProperty:m})]})]}),C&&(0,s.jsx)("div",{style:{position:"fixed",bottom:"30px",right:"30px",background:"#1e3a8a",color:"white",padding:"12px 24px",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)",zIndex:1e4,fontSize:"14px",fontWeight:"500"},children:"Link copied!"}),null!==S&&(0,s.jsx)(Fe,{images:x.images,currentIndex:S,onClose:z,onNext:B,onPrev:U})]})},qe={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN||"pk.eyJ1Ijoic3VkaGFrYXJwb3VsIiwiYSI6ImNtaXp0ZmFrNTAxaTQzZHNiODNrYndsdTAifQ.YTMezksySLU7ZpcYkvXyqg",We=[{id:"parking",label:"Parking",icon:"\ud83d\ude97"},{id:"lift",label:"Lift",icon:"\ud83d\uded7"},{id:"security",label:"24x7 Security",icon:"\ud83d\udc6e"},{id:"24/7 Security",label:"24/7 Security",icon:"\ud83d\udc6e"},{id:"power_backup",label:"Power Backup",icon:"\u26a1"},{id:"gym",label:"Gym",icon:"\ud83c\udfcb\ufe0f"},{id:"Gymnasium",label:"Gymnasium",icon:"\ud83c\udfcb\ufe0f"},{id:"swimming_pool",label:"Swimming Pool",icon:"\ud83c\udfca"},{id:"garden",label:"Garden",icon:"\ud83c\udf33"},{id:"clubhouse",label:"Club House",icon:"\ud83c\udfdb\ufe0f"},{id:"Clubhouse",label:"Clubhouse",icon:"\ud83c\udfdb\ufe0f"},{id:"playground",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"Children's Play Area",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"cctv",label:"CCTV",icon:"\ud83d\udcf9"},{id:"intercom",label:"Intercom",icon:"\ud83d\udcde"},{id:"fire_safety",label:"Fire Safety",icon:"\ud83d\udd25"},{id:"water_supply",label:"24x7 Water",icon:"\ud83d\udca7"},{id:"gas_pipeline",label:"Gas Pipeline",icon:"\ud83d\udd25"},{id:"wifi",label:"WiFi",icon:"\ud83d\udcf6"},{id:"ac",label:"Air Conditioning",icon:"\u2744\ufe0f"},{id:"Covered Parking",label:"Covered Parking",icon:"\ud83d\ude97"}],He=e=>{if(!e)return"\u2713";const t=We.find(t=>t.label.toLowerCase()===e.toLowerCase()||t.id.toLowerCase()===e.toLowerCase().replace(/\s+/g,"_"));return t?t.icon:"\u2713"},Ge=e=>{if(!e)return"";const t=We.find(t=>t.label.toLowerCase()===e.toLowerCase()||t.id.toLowerCase()===e.toLowerCase().replace(/\s+/g,"_")||t.label.toLowerCase()===e.toLowerCase().replace(/\s+/g," "));return t?t.label:e.split(/\s+/).map(e=>e.charAt(0).toUpperCase()+e.slice(1).toLowerCase()).join(" ")},Ze=e=>{let{images:t,currentIndex:r,onClose:n,onNext:i,onPrev:o}=e;const a=null!==r;if(!t||0===t.length)return null;const l=a?t[r]:null,c=t.length>1;return(0,s.jsx)("div",{className:"upcoming-image-slider-modal-overlay ".concat(a?"open":""),children:l&&(0,s.jsxs)("div",{className:"upcoming-image-slider-modal-content",children:[(0,s.jsx)("button",{className:"upcoming-slider-close-btn",onClick:n,"aria-label":"Close Slider",children:(0,s.jsx)(ke,{})}),(0,s.jsxs)("div",{className:"upcoming-slider-controls",children:[c&&(0,s.jsx)("button",{className:"upcoming-slider-prev-btn",onClick:o,"aria-label":"Previous Image",children:(0,s.jsx)(ve,{})}),(0,s.jsx)("img",{src:l.url,alt:l.alt,className:"upcoming-slider-main-image"}),c&&(0,s.jsx)("button",{className:"upcoming-slider-next-btn",onClick:i,"aria-label":"Next Image",children:(0,s.jsx)(xe,{})})]})]})})},Ke=t=>{var r,n,i,o,a,l,c,u;let{project:d}=t;const[h,p]=(0,e.useState)(null),m=e=>{if(null===e||void 0===e||""===e)return null;const t="string"===typeof e?parseFloat(e):e;return isNaN(t)?null:t},f=(e,t)=>null!==e&&null!==t&&(e>=-90&&e<=90&&t>=-180&&t<=180);(0,e.useEffect)(()=>{if(!d)return void p(null);const e=m(d.latitude),t=m(d.longitude);if(f(e,t))return void p({lat:e,lng:t});const r=d.location||d.fullAddress;if(!r||!qe)return void p(null);let n=!1;return(async()=>{try{const e="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(r),".json?access_token=").concat(qe,"&country=in&limit=1"),t=await fetch(e);if(!t.ok)return;const i=await t.json(),s=i.features&&i.features[0];if(!s||!Array.isArray(s.center)||s.center.length<2)return;const[o,a]=s.center;if(n)return;p(f(a,o)?{lat:a,lng:o}:null)}catch(e){n||(console.error("Error geocoding upcoming project location:",e),p(null))}})(),()=>{n=!0}},[d]);const g=null!==(r=null===h||void 0===h?void 0:h.lat)&&void 0!==r?r:null,y=null!==(n=null===h||void 0===h?void 0:h.lng)&&void 0!==n?n:null,_=f(g,y),v=d&&_?[{id:d.id,title:d.title,location:d.location,latitude:g,longitude:y,thumbnail:null!==(i=null===(o=d.images)||void 0===o||null===(a=o[0])||void 0===a?void 0:a.url)&&void 0!==i?i:null,images:d.images,cover_image:null!==(l=null===(c=d.images)||void 0===c||null===(u=c[0])||void 0===u?void 0:u.url)&&void 0!==l?l:null,seller_id:d.seller_id,priceRange:d.priceRange,isUpcomingProject:!0}]:[],x=_?[y,g]:[78.9629,20.5937],b=_?14:5;return(0,s.jsxs)("div",{className:"map-card-container",children:[(0,s.jsx)("h3",{children:"Project Location"}),(0,s.jsx)("div",{className:"map-embed-area","aria-label":"Map for ".concat((null===d||void 0===d?void 0:d.location)||"Project"),children:d&&_?(0,s.jsx)(Ie,{properties:v,center:x,zoom:b,showControls:!0,interactive:!0,currentPropertyId:d.id}):(0,s.jsxs)("p",{className:"map-placeholder-text",children:["Location for ",(0,s.jsx)("strong",{children:(null===d||void 0===d?void 0:d.location)||(null===d||void 0===d?void 0:d.fullAddress)||"this project"}),(null===d||void 0===d?void 0:d.mapLink)&&(0,s.jsxs)(s.Fragment,{children:[" \u2014 ",(0,s.jsx)("a",{href:d.mapLink,target:"_blank",rel:"noopener noreferrer",style:{color:"#0066cc",textDecoration:"underline"},children:"View on Map"})]})]})})]})},Ye=()=>{var t,o,a;const c=(0,n.Zp)(),u=(0,n.zy)(),{id:d}=(0,n.g)();let h;if(d)h=parseInt(d,10);else{const e=u.pathname.match(/\/upcoming-project\/(\d+)/);h=e?parseInt(e[1],10):null}const{user:p}=l(),[m,f]=(0,e.useState)(null),[g,y]=(0,e.useState)(!0),[_,v]=(0,e.useState)(null),[x,b]=(0,e.useState)(null),[j,S]=(0,e.useState)(!1),[T,k]=(0,e.useState)(!1),[A,C]=(0,e.useState)(!1),[E,N]=(0,e.useState)(()=>{try{const e=localStorage.getItem("buyer_interacted_properties");if(e){const t=JSON.parse(e);return new Set(t.map(String))}}catch(_){console.error("Error loading interacted properties from localStorage:",_)}return new Set}),[I,P]=(0,e.useState)({remaining:5,max:5,used:0,canPerform:!0,resetTime:null,resetTimeSeconds:null}),[M,L]=(0,e.useState)(!1);(0,e.useEffect)(()=>{h?(async()=>{try{y(!0);const n=await i.propertiesAPI.getDetails(h);if(n.success&&n.data&&n.data.property){const i=n.data.property;let s={};try{"string"===typeof i.upcoming_project_data?s=JSON.parse(i.upcoming_project_data):"object"===typeof i.upcoming_project_data&&(s=i.upcoming_project_data)}catch(r){console.warn("Failed to parse upcoming_project_data:",r)}let o=[];Array.isArray(i.images)&&i.images.length>0?o=i.images.map((e,t)=>({id:t+1,url:e,alt:i.title})):i.cover_image&&(o=[{id:1,url:i.cover_image,alt:i.title}]),0===o.length&&(o=[{id:1,url:"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",alt:i.title}]);const a=(t=s.configurations)&&Array.isArray(t)&&0!==t.length?t.filter(e=>e).map(e=>{const t=e.match(/(\d+)\s*BHK/i);return t?"".concat(t[1]," BHK"):e}).filter((e,t,r)=>r.indexOf(e)===t).sort((e,t)=>{const r=/^\d+\s*BHK$/.test(e),n=/^\d+\s*BHK$/.test(t);var i,s;return r&&n?parseInt((null===(i=e.match(/\d+/))||void 0===i?void 0:i[0])||"0")-parseInt((null===(s=t.match(/\d+/))||void 0===s?void 0:s[0])||"0"):r?-1:n?1:e.localeCompare(t)}).join(", "):null,l=s.startingPrice||((e=i.price)?(e/1e7).toFixed(1):"0"),c={id:i.id,title:i.title,location:i.location,priceRange:l,bhkType:a,builder:s.builderName||i.seller_name||"Builder",builderLink:s.builderLink||"#builder-".concat(i.id),description:i.description||"",configurations:s.configurations||[],amenities:Array.isArray(i.amenities)?i.amenities:i.amenities?i.amenities.split(","):[],images:o,latitude:i.latitude,longitude:i.longitude,seller_id:i.seller_id||i.user_id||null,user_id:i.user_id||i.seller_id||null,seller_name:i.seller_name||"Builder",seller_email:i.seller_email||"",seller_phone:i.seller_phone||"",upcomingData:s,projectType:i.property_type||s.projectType||"",projectStatus:s.projectStatus||"UNDER CONSTRUCTION",reraNumber:s.reraNumber||null,city:s.city||i.city||null,area:s.area||null,fullAddress:i.additional_address||s.fullAddress||null,state:i.state||s.state||null,pincode:s.pincode||null,mapLink:s.mapLink||null,carpetAreaRange:s.carpetAreaRange||null,numberOfTowers:s.numberOfTowers||null,totalUnits:s.totalUnits||null,floorsCount:s.floorsCount||null,unitsPerFloor:s.unitsPerFloor||null,numberOfVillas:s.numberOfVillas||null,numberOfPlots:s.numberOfPlots||null,bedCapacity:s.bedCapacity||null,loadingDocks:s.loadingDocks||null,startingPrice:s.startingPrice||null,pricePerSqft:s.pricePerSqft||null,bookingAmount:s.bookingAmount||null,expectedLaunchDate:s.expectedLaunchDate||null,expectedPossessionDate:s.expectedPossessionDate||null,reraStatus:s.reraStatus||null,landOwnershipType:s.landOwnershipType||null,bankApproved:s.bankApproved||null,approvedBanks:s.approvedBanks||[],salesPersons:Array.isArray(s.salesPersons)&&s.salesPersons.length>0?s.salesPersons:[{name:s.salesName||null,number:s.salesNumber||null,email:s.emailId||null,mobileNumber:s.mobileNumber||null,whatsappNumber:s.whatsappNumber||null,alternativeNumber:s.alternativeNumber||null}].filter(e=>e.name||e.number||e.email||e.mobileNumber),salesName:s.salesName||null,salesNumber:s.salesNumber||null,emailId:s.emailId||null,mobileNumber:s.mobileNumber||null,whatsappNumber:s.whatsappNumber||null,alternativeNumber:s.alternativeNumber||null,projectHighlights:s.projectHighlights||null,usp:s.usp||null,brochure:i.brochure_url||s.brochure||null};f(c)}else v("Project not found")}catch(n){console.error("Error fetching project:",n),v(n.message||"Failed to load project details")}finally{y(!1)}var e,t})():(v("Invalid project ID"),y(!1))},[h]),(0,e.useEffect)(()=>{h&&window.scrollTo(0,0)},[h]),(0,e.useEffect)(()=>{(async()=>{if(h)try{const e=w.isFavorite(h);C(e);if(localStorage.getItem("authToken")&&p){const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.list();if(t.success&&t.data){const e=(t.data.properties||t.data.favorites||[]).map(e=>e.id||e.property_id);C(e.includes(h))}}}catch(_){console.error("Error checking favorite status:",_),C(w.isFavorite(h))}})()},[h,p]);const R=(null===m||void 0===m||null===(t=m.images)||void 0===t?void 0:t.length)||0,D=(0,e.useCallback)(e=>{R>0&&b(e)},[R]),F=(0,e.useCallback)(()=>{b(null)},[]),O=(0,e.useCallback)(()=>{0!==R&&b(e=>(e+1)%R)},[R]),z=(0,e.useCallback)(()=>{0!==R&&b(e=>(e-1+R)%R)},[R]),B=(0,e.useCallback)(()=>{window.history.back()},[]),U=async e=>{try{if(navigator.clipboard&&navigator.clipboard.writeText)return await navigator.clipboard.writeText(e),S(!0),void setTimeout(()=>S(!1),2e3);const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",document.body.appendChild(t),t.focus(),t.select();try{document.execCommand("copy")&&(S(!0),setTimeout(()=>S(!1),2e3))}finally{document.body.removeChild(t)}}catch(_){console.error("Failed to copy to clipboard:",_)}},V=(0,e.useCallback)(async()=>{if(p&&"buyer"===p.user_type&&h)try{L(!0);const e=await i.Vp.checkLimit(h,"view_owner");e.success&&P({remaining:e.data.remaining_attempts,max:e.data.max_attempts,used:e.data.used_attempts,canPerform:e.data.can_perform_action,resetTime:e.data.reset_time,resetTimeSeconds:e.data.reset_time_seconds})}catch(_){console.error("Error fetching interaction limits:",_)}finally{L(!1)}},[p,h]);(0,e.useEffect)(()=>{m&&p&&"buyer"===p.user_type&&V()},[m,p,V]),(0,e.useEffect)(()=>{h&&E.has(String(h))&&!T&&k(!0)},[h,E,T]);const q=(0,e.useCallback)(async(e,t)=>{if(!p||"buyer"!==p.user_type||!h)return!1;if(E.has(String(h)))return t&&t(),!0;if(!I.canPerform)return alert("Daily interaction limit reached. Try again after 12 hours."),!1;try{const r=await i.Vp.recordInteraction(h,e);return r.success?(N(e=>{const t=new Set([...e,String(h)]);try{localStorage.setItem("buyer_interacted_properties",JSON.stringify([...t]))}catch(_){console.error("Error saving interacted properties to localStorage:",_)}return t}),P({remaining:r.data.remaining_attempts,max:r.data.max_attempts,used:r.data.used_attempts,canPerform:r.data.remaining_attempts>0,resetTime:r.data.reset_time,resetTimeSeconds:r.data.reset_time_seconds}),t&&t(),!0):(console.error("Failed to record interaction:",r),alert(r.message||"Failed to record interaction"),!1)}catch(_){if(console.error("Error recording interaction:",_),429===_.status&&_.data)P({remaining:_.data.remaining_attempts||0,max:_.data.max_attempts||5,used:_.data.used_attempts||5,canPerform:!1,resetTime:_.data.reset_time,resetTimeSeconds:_.data.reset_time_seconds}),alert(_.data.message||"Daily interaction limit reached. Try again after 12 hours.");else{var r;const t=_.message||(null===(r=_.data)||void 0===r?void 0:r.message)||"Failed to record interaction. Please try again.";console.error("Full error details:",_),alert(t)}return!1}},[p,h,E,I]),W=(0,e.useCallback)(async e=>{if(e.preventDefault(),e.stopPropagation(),!p){alert("Please login to view details");const e=h?"/upcoming-project/".concat(h):"/";return void c("/login?returnUrl=".concat(encodeURIComponent(e)))}"buyer"===p.user_type?T||await q("view_owner",()=>{k(!0)}):alert("Only buyers can view details")},[p,h,T,c,q]),H=(0,e.useCallback)(async()=>{if(!p){alert("Please login to chat with the builder");const e=h?"/upcoming-project/".concat(h):"/";return void c("/login?returnUrl=".concat(encodeURIComponent(e)))}if("buyer"!==p.user_type)return void alert("Only buyers can chat with builders");if(!m)return void alert("Project information not available");const e=m.seller_id||m.user_id;if(!e)return void alert("Builder information not available");if(Number(p.id)===Number(e))return void alert("You cannot chat with yourself. This is your project.");await q("chat_owner",async()=>{const{generateChatRoomId:t}=await Promise.resolve().then(r.bind(r,935)),n=t(p.id,e,h),i=m.builder||m.seller_name||"Builder",s=encodeURIComponent(i);c("/ChatUs?chatId=".concat(n,"&ownerName=").concat(s,"&propertyId=").concat(h))})},[p,m,h,c,q]);if((0,e.useEffect)(()=>{const e=e=>{null!==x&&("Escape"===e.key?F():"ArrowLeft"===e.key?z():"ArrowRight"===e.key&&O())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[x,F,O,z]),g)return(0,s.jsx)("div",{className:"upcoming-details-wrapper",children:(0,s.jsx)("div",{style:{padding:"2rem",textAlign:"center"},children:(0,s.jsx)("p",{children:"Loading project details..."})})});if(_)return(0,s.jsx)("div",{className:"upcoming-details-wrapper",children:(0,s.jsxs)("div",{style:{padding:"2rem",textAlign:"center"},children:[(0,s.jsxs)("p",{style:{color:"#c33",marginBottom:"1rem"},children:["Error: ",_]}),(0,s.jsx)("button",{onClick:B,style:{padding:"0.5rem 1rem",cursor:"pointer"},children:"Go Back"})]})});if(!m)return(0,s.jsx)("div",{className:"upcoming-details-wrapper",children:(0,s.jsxs)("div",{style:{padding:"2rem",textAlign:"center"},children:[(0,s.jsx)("p",{style:{color:"#c33",marginBottom:"1rem"},children:"Project not found"}),(0,s.jsx)("button",{onClick:B,style:{padding:"0.5rem 1rem",cursor:"pointer"},children:"Go Back"})]})});const G=m.images.slice(1,5),Z=m.images.length-5;return(0,s.jsxs)("div",{className:"upcoming-details-wrapper",children:[(0,s.jsxs)("main",{className:"upcoming-view-details-page",children:[(0,s.jsx)("div",{className:"upcoming-title-location-container",children:(0,s.jsxs)("div",{className:"upcoming-details-container",children:[(0,s.jsxs)("div",{className:"upcoming-details-container-actions",children:[(0,s.jsx)("button",{className:"upcoming-title-favourite-btn ".concat(A?"active":""),onClick:async e=>{if(e.preventDefault(),e.stopPropagation(),!p)return alert("Please login to add properties to favorites"),void c("/login");try{const{favoritesAPI:e}=await Promise.resolve().then(r.bind(r,376)),t=await e.toggle(h);t.success?(C(void 0!==t.data.is_favorite?t.data.is_favorite:!A),w.toggleFavorite(h)):(console.error("Failed to toggle favorite:",t.message),alert(t.message||"Failed to update favorite"))}catch(_){console.error("Error toggling favorite:",_),w.toggleFavorite(h),C(!A)}},"aria-label":A?"Remove from favorites":"Add to favorites",title:A?"Remove from favorites":"Add to favorites",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:A?"white":"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:(0,s.jsx)("path",{d:"M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"})})}),(0,s.jsx)("button",{className:"upcoming-share-btn-details",onClick:async()=>{if(!m)return;const e="".concat(window.location.origin,"/upcoming-project/").concat(m.id),t={title:m.title||"Upcoming Project",text:"Check out this upcoming project: ".concat(m.title),url:e};if(navigator.share)try{await navigator.share(t)}catch(_){"AbortError"!==_.name&&await U(e)}else await U(e)},"aria-label":"Share",title:"Share",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("circle",{cx:"18",cy:"5",r:"3"}),(0,s.jsx)("circle",{cx:"6",cy:"12",r:"3"}),(0,s.jsx)("circle",{cx:"18",cy:"19",r:"3"}),(0,s.jsx)("line",{x1:"8.59",y1:"13.51",x2:"15.42",y2:"17.49"}),(0,s.jsx)("line",{x1:"15.41",y1:"6.51",x2:"8.59",y2:"10.49"})]})})]}),(0,s.jsx)("header",{className:"upcoming-project-header",children:(0,s.jsxs)("div",{className:"upcoming-header-top-row",children:[(0,s.jsx)("div",{className:"upcoming-header-status-left",children:(0,s.jsx)("span",{className:"upcoming-project-status-text",children:"Upcoming Project"})}),(0,s.jsxs)("div",{className:"upcoming-header-center",children:[(0,s.jsx)("h1",{children:m.title}),(0,s.jsx)("div",{className:"upcoming-project-location-row",children:(0,s.jsx)("p",{className:"upcoming-project-location",children:m.location})})]})]})})]})}),(0,s.jsxs)("div",{className:"upcoming-image-gallery-container",children:[(0,s.jsxs)("div",{className:"upcoming-mobile-image-slider",children:[(0,s.jsx)("div",{className:"upcoming-mobile-slider-track",children:m.images.map((e,t)=>(0,s.jsx)("div",{className:"upcoming-mobile-slide",onClick:()=>D(t),children:(0,s.jsx)("img",{src:e.url,alt:e.alt})},e.id))}),(0,s.jsx)("div",{className:"upcoming-mobile-slider-dots",children:m.images.map((e,t)=>(0,s.jsx)("span",{className:"dot"},t))})]}),(0,s.jsxs)("div",{className:"upcoming-image-gallery upcoming-desktop-only",children:[(0,s.jsx)("div",{className:"upcoming-main-image",onClick:()=>D(0),children:(0,s.jsx)("img",{src:(null===(o=m.images[0])||void 0===o?void 0:o.url)||"",alt:(null===(a=m.images[0])||void 0===a?void 0:a.alt)||m.title})}),(0,s.jsx)("div",{className:"upcoming-thumbnail-gallery",children:G.map((e,t)=>(0,s.jsxs)("div",{className:"upcoming-thumbnail",onClick:()=>D(t+1),children:[(0,s.jsx)("img",{src:e.url,alt:e.alt}),3===t&&Z>=0&&(0,s.jsx)("div",{className:"upcoming-view-more-overlay",children:(0,s.jsxs)("span",{children:["Show all ",m.images.length," photos"]})})]},e.id))})]})]}),(0,s.jsx)("div",{className:"upcoming-details-container",children:(0,s.jsxs)("div",{className:"upcoming-main-content-area",children:[(0,s.jsxs)("div",{className:"upcoming-project-price-section",children:[(0,s.jsx)("h2",{className:"upcoming-price-section-heading",children:"Price Range"}),(0,s.jsx)("div",{className:"upcoming-project-price-display",children:(0,s.jsxs)("span",{className:"upcoming-price-amount",children:["\u20b9",m.priceRange," Cr"]})})]}),(0,s.jsxs)("div",{className:"upcoming-highlights-contact-wrapper",children:[(0,s.jsxs)("div",{className:"upcoming-project-highlights",children:[m.bhkType&&(0,s.jsxs)("div",{className:"upcoming-highlight-item",children:[(0,s.jsx)(be,{className:"upcoming-highlight-icon"}),(0,s.jsxs)("div",{className:"upcoming-highlight-content",children:[(0,s.jsx)("span",{className:"upcoming-highlight-value",children:m.bhkType}),(0,s.jsx)("span",{className:"upcoming-highlight-label",children:"Configuration"})]})]}),(0,s.jsxs)("div",{className:"upcoming-highlight-item",children:[(0,s.jsx)(we,{className:"upcoming-highlight-icon"}),(0,s.jsxs)("div",{className:"upcoming-highlight-content",children:[(0,s.jsx)("span",{className:"upcoming-highlight-value",children:"Upcoming"}),(0,s.jsx)("span",{className:"upcoming-highlight-label",children:"Status"})]})]}),m.area&&(0,s.jsxs)("div",{className:"upcoming-highlight-item",children:[(0,s.jsx)(Se,{className:"upcoming-highlight-icon"}),(0,s.jsxs)("div",{className:"upcoming-highlight-content",children:[(0,s.jsx)("span",{className:"upcoming-highlight-value",children:m.area}),(0,s.jsx)("span",{className:"upcoming-highlight-label",children:"area"})]})]})]}),(0,s.jsx)("aside",{className:"upcoming-agent-sidebar",children:(0,s.jsxs)("div",{className:"upcoming-detail-contact-card",children:[m&&(0,s.jsxs)(s.Fragment,{children:[!T&&(0,s.jsxs)("div",{style:{marginBottom:"1rem"},children:[(0,s.jsxs)("button",{type:"button",onClick:W,className:"upcoming-contact-send-button",disabled:!E.has(String(h))&&!I.canPerform||M,title:E.has(String(h))||I.canPerform?"":"Daily interaction limit reached. Try again after 12 hours.",style:{marginTop:"0",marginBottom:"0.5rem",opacity:!E.has(String(h))&&!I.canPerform||M?.6:1,cursor:!E.has(String(h))&&!I.canPerform||M?"not-allowed":"pointer"},children:[(0,s.jsx)(Ae,{style:{marginRight:"8px"}}),"Show Details"]}),p&&"buyer"===p.user_type&&(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:I.canPerform?"#666":"#ef4444",marginTop:"0.25rem",padding:"0.25rem 0.5rem",backgroundColor:I.canPerform?"#f3f4f6":"#fee2e2",borderRadius:"4px"},children:[I.remaining," / ",I.max," interactions remaining",I.used>0&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontSize:"0.7rem"},children:"Resets in 12 hours"}),!I.canPerform&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontWeight:"bold",fontSize:"0.7rem"},children:"Daily interaction limit reached. Try again after 12 hours."})]})]}),T&&(0,s.jsxs)("div",{className:"upcoming-builder-details-section",style:{marginBottom:"1rem"},children:[m.salesPersons&&m.salesPersons.length>0?(0,s.jsx)("div",{className:"upcoming-sales-persons-list",children:m.salesPersons.map((e,t)=>(0,s.jsxs)("div",{className:"upcoming-sales-person-card",style:{marginBottom:t<m.salesPersons.length-1?"1rem":"0",paddingBottom:t<m.salesPersons.length-1?"1rem":"0",borderBottom:t<m.salesPersons.length-1?"1px solid #eee":"none"},children:[m.salesPersons.length>1&&(0,s.jsxs)("h4",{style:{margin:"0 0 0.5rem 0",fontSize:"0.95rem",color:"#333"},children:["Sales Person ",t+1]}),e.name&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"Name:"}),(0,s.jsx)("span",{className:"upcoming-builder-detail-value",children:e.name})]}),e.number&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"Sales Phone:"}),(0,s.jsx)("a",{href:"tel:".concat(e.number),className:"upcoming-builder-detail-value upcoming-builder-detail-link",children:e.number})]}),(e.mobileNumber||e.landlineNumber)&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"Mobile/Landline:"}),(0,s.jsx)("a",{href:"tel:".concat(e.mobileNumber||e.landlineNumber),className:"upcoming-builder-detail-value upcoming-builder-detail-link",children:e.mobileNumber||e.landlineNumber})]}),e.email&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"Email:"}),(0,s.jsx)("a",{href:"mailto:".concat(e.email),className:"upcoming-builder-detail-value upcoming-builder-detail-link",children:e.email})]}),e.whatsappNumber&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"WhatsApp:"}),(0,s.jsx)("a",{href:"https://wa.me/".concat(e.whatsappNumber.replace(/\D/g,"")),target:"_blank",rel:"noopener noreferrer",className:"upcoming-builder-detail-value upcoming-builder-detail-link",children:e.whatsappNumber})]}),e.alternativeNumber&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"Alternative:"}),(0,s.jsx)("a",{href:"tel:".concat(e.alternativeNumber),className:"upcoming-builder-detail-value upcoming-builder-detail-link",children:e.alternativeNumber})]})]},t))}):(0,s.jsx)("div",{className:"upcoming-builder-detail-item",children:(0,s.jsx)("span",{className:"upcoming-builder-detail-value",children:"No specific sales contact details available."})}),m.fullAddress&&(0,s.jsxs)("div",{className:"upcoming-builder-detail-item",style:{marginTop:"1rem",paddingTop:"1rem",borderTop:"1px solid #eee"},children:[(0,s.jsx)("span",{className:"upcoming-builder-detail-label",children:"Office Address:"}),(0,s.jsx)("span",{className:"upcoming-builder-detail-value",children:m.fullAddress})]}),(0,s.jsx)("div",{style:{marginTop:"1rem"},children:(0,s.jsx)("button",{type:"button",className:"upcoming-contact-send-button",disabled:!0,style:{opacity:.6,cursor:"not-allowed"},children:"Details Unlocked"})})]})]}),p&&"buyer"===p.user_type&&m&&(!m.seller_id||Number(p.id)!==Number(m.seller_id))&&(!m.user_id||Number(p.id)!==Number(m.user_id))&&(0,s.jsxs)("div",{style:{marginTop:T?"1rem":"0"},children:[(0,s.jsxs)("button",{type:"button",onClick:H,className:"upcoming-contact-send-button",disabled:!E.has(String(h))&&!I.canPerform||M,title:E.has(String(h))||I.canPerform?"":"Daily interaction limit reached. Try again after 12 hours.",style:{opacity:!E.has(String(h))&&!I.canPerform||M?.6:1,cursor:!E.has(String(h))&&!I.canPerform||M?"not-allowed":"pointer"},children:[(0,s.jsx)(je,{style:{marginRight:"8px"}}),"Chat with Builder"]}),(0,s.jsxs)("div",{style:{fontSize:"0.75rem",color:I.canPerform?"#666":"#ef4444",marginTop:"0.25rem",padding:"0.25rem 0.5rem",backgroundColor:I.canPerform?"#f3f4f6":"#fee2e2",borderRadius:"4px"},children:[I.remaining," / ",I.max," interactions remaining",I.used>0&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontSize:"0.7rem"},children:"Resets in 12 hours"}),!I.canPerform&&(0,s.jsx)("span",{style:{display:"block",marginTop:"0.125rem",fontWeight:"bold",fontSize:"0.7rem"},children:"Daily interaction limit reached. Try again after 12 hours."})]})]})]})})]}),(0,s.jsxs)("div",{className:"upcoming-project-details-full-section",children:[(0,s.jsx)("h2",{children:"Project Details"}),(0,s.jsxs)("div",{className:"upcoming-project-details-grid",children:[m.builder&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Builder / Developer"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.builder})]}),m.projectType&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Project Type"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.projectType})]}),m.projectStatus&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Project Status"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.projectStatus})]}),m.reraNumber&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"RERA Number"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.reraNumber})]}),m.bhkType&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Configuration"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.bhkType})]}),m.carpetAreaRange&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Carpet Area Range"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.carpetAreaRange})]}),m.numberOfTowers&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Number of Towers / Buildings"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.numberOfTowers})]}),m.totalUnits&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Total Units"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.totalUnits})]}),m.floorsCount&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Floors"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.floorsCount})]}),m.unitsPerFloor&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Units Per Floor"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.unitsPerFloor})]}),m.numberOfVillas&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Number of Villas"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.numberOfVillas})]}),m.numberOfPlots&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Number of Plots"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.numberOfPlots})]}),m.bedCapacity&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Bed Capacity"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.bedCapacity})]}),m.loadingDocks&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Loading Docks"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.loadingDocks})]}),m.location&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Location"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.location})]}),m.city&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"City"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.city})]}),m.state&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"State"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.state})]}),m.fullAddress&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Address"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.fullAddress})]}),m.pincode&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Pincode"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.pincode})]}),m.startingPrice&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Starting Price"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.startingPrice})]}),m.pricePerSqft&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Price per Sqft"}),(0,s.jsxs)("span",{className:"upcoming-project-detail-value",children:["\u20b9",m.pricePerSqft]})]}),m.bookingAmount&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Booking Amount"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.bookingAmount})]}),m.expectedLaunchDate&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Expected Launch Date"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:(()=>{try{const e=new Date(m.expectedLaunchDate);return isNaN(e.getTime())?m.expectedLaunchDate:e.toLocaleDateString()}catch(e){return m.expectedLaunchDate}})()})]}),m.expectedPossessionDate&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Expected Possession Date"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:(()=>{try{const e=new Date(m.expectedPossessionDate);return isNaN(e.getTime())?m.expectedPossessionDate:e.toLocaleDateString()}catch(e){return m.expectedPossessionDate}})()})]}),m.reraStatus&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"RERA Status"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.reraStatus})]}),m.landOwnershipType&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Land Ownership"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.landOwnershipType})]}),m.bankApproved&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Bank Approved"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.bankApproved})]}),m.approvedBanks&&m.approvedBanks.length>0&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Approved Banks"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:m.approvedBanks.join(", ")})]}),m.mapLink&&(0,s.jsxs)("div",{className:"upcoming-project-detail-item",children:[(0,s.jsx)("span",{className:"upcoming-project-detail-label",children:"Map Link"}),(0,s.jsx)("span",{className:"upcoming-project-detail-value",children:(0,s.jsx)("a",{href:m.mapLink,target:"_blank",rel:"noopener noreferrer",style:{color:"#0066cc",textDecoration:"underline"},children:"View on Map"})})]})]})]}),m.amenities&&m.amenities.length>0&&(0,s.jsxs)("div",{className:"upcoming-amenities-section",children:[(0,s.jsx)("h2",{children:"What this place offers"}),(0,s.jsx)("div",{className:"upcoming-amenities-grid",children:m.amenities.map((e,t)=>(0,s.jsxs)("div",{className:"upcoming-amenity-item",children:[(0,s.jsx)("span",{className:"upcoming-amenity-icon",children:He(e)}),(0,s.jsx)("span",{children:Ge(e)})]},t))})]}),m.description&&(0,s.jsxs)("div",{className:"upcoming-description-section",children:[(0,s.jsx)("h2",{children:"About this place"}),(0,s.jsx)("p",{children:m.description})]}),m.projectHighlights&&(0,s.jsxs)("div",{className:"upcoming-description-section",children:[(0,s.jsx)("h2",{children:"Project Highlights"}),(0,s.jsx)("p",{children:m.projectHighlights})]}),m.usp&&(0,s.jsxs)("div",{className:"upcoming-description-section",children:[(0,s.jsx)("h2",{children:"Unique Selling Points"}),(0,s.jsx)("p",{children:m.usp})]}),m.brochure&&(0,s.jsxs)("div",{className:"upcoming-description-section",children:[(0,s.jsx)("h2",{children:"Project Brochure"}),(0,s.jsx)("div",{style:{marginTop:"1rem"},children:(0,s.jsx)("a",{href:"string"===typeof m.brochure?m.brochure:m.brochure.url||m.brochure.file||m.brochure,target:"_blank",rel:"noopener noreferrer",style:{display:"inline-block",padding:"0.75rem 1.5rem",backgroundColor:"#0066cc",color:"white",textDecoration:"none",borderRadius:"8px",fontWeight:"500"},children:"Download Brochure"})})]}),(0,s.jsx)(Ke,{project:m})]})})]}),(0,s.jsx)(Ze,{images:m.images,currentIndex:x,onClose:F,onNext:O,onPrev:z}),j&&(0,s.jsx)("div",{className:"upcoming-share-toast-details",children:"Link copied!"})]})};var Xe=r(580);const Je=()=>{const t=(0,n.Zp)(),[r]=(0,n.ok)(),i=(0,n.zy)(),[o,a]=(0,e.useState)({location:r.get("location")||"",propertyType:r.get("type")||r.get("property_type")||"",budget:r.get("budget")||"",bedrooms:r.get("bedrooms")||"",area:r.get("area")||"",uploadTime:r.get("upload_time")||"",listingType:(()=>{const e=r.get("status");return"For Sale"===e?"Buy":"For Rent"===e?"Rent":"All"})(),expectedPossession:r.get("expected_possession")||"",projectStatus:r.get("project_status")||""}),[l,c]=(0,e.useState)(null),[u,d]=(0,e.useState)(!1),[h,m]=(0,e.useState)(()=>!(!r.get("location")&&!r.get("city"))),[f,g]=(0,e.useState)(!1),[y,v]=(0,e.useState)(!1);(0,e.useEffect)(()=>{const e=()=>{g(window.innerWidth<=767)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]),(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&y&&v(!1)};return y&&(document.addEventListener("keydown",e),document.body.style.overflow="hidden"),()=>{document.removeEventListener("keydown",e),document.body.style.overflow=""}},[y]),(0,e.useEffect)(()=>{const e=r.get("city"),t=r.get("location"),n=r.get("lat"),i=r.get("lng");if(e||t){let r=e||"";if(!r&&t){const e=t.trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);e.length>=3?r=e[1]:(2===e.length||1===e.length)&&(r=e[0])}c({city:r,placeName:t||"",fullAddress:t||"",coordinates:n&&i?{lat:parseFloat(n),lng:parseFloat(i)}:null}),m(!0),d(!1)}},[]);const x=(0,e.useMemo)(()=>(()=>{const e=i.pathname.toLowerCase();return e.includes("/buyer-dashboard/search")||e.includes("/searchresults")?"home":e.includes("/buy")?"buy":e.includes("/rent")?"rent":e.includes("/pghostel")?"pg":"home"})(),[i.pathname,r]),b=(0,e.useMemo)(()=>{const e=r.get("searchMode"),t=r.get("project_type");return"upcoming-projects"===e||"upcoming"===t?"upcoming-projects":"properties"},[r]);(0,e.useEffect)(()=>{const e=r.get("status");"For Sale"===e?a(e=>(0,p.A)((0,p.A)({},e),{},{listingType:"Buy"})):"For Rent"===e?a(e=>(0,p.A)((0,p.A)({},e),{},{listingType:"Rent"})):e||a(e=>(0,p.A)((0,p.A)({},e),{},{listingType:"All"}));const t=r.get("upload_time")||"";a(e=>e.uploadTime!==t?(0,p.A)((0,p.A)({},e),{},{uploadTime:t}):e);const n=r.get("type")||r.get("property_type")||"",i=r.get("budget")||"",s=r.get("bedrooms")||"",o=r.get("area")||"",l=r.get("expected_possession")||"",u=r.get("project_status")||"";a(e=>e.propertyType===n&&e.budget===i&&e.bedrooms===s&&e.area===o&&e.expectedPossession===l&&e.projectStatus===u?e:(0,p.A)((0,p.A)({},e),{},{propertyType:n,budget:i,bedrooms:s,area:o,expectedPossession:l,projectStatus:u}));const h=r.get("city"),f=r.get("location"),g=r.get("lat"),y=r.get("lng");if(h||f){let e=h||"";if(!e&&f){const t=f.trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);t.length>=3?e=t[1]:(2===t.length||1===t.length)&&(e=t[0])}const t={city:e,placeName:f||"",fullAddress:f||"",coordinates:g&&y?{lat:parseFloat(g),lng:parseFloat(y)}:null};c(e=>e&&e.city===t.city&&e.placeName===t.placeName?e:t),a(e=>{const t=f||"";return e.location!==t?(0,p.A)((0,p.A)({},e),{},{location:t}):e}),m(!0),d(!1)}else c(null),a(e=>e.location?(0,p.A)((0,p.A)({},e),{},{location:""}):e),m(!1)},[r]);const w=["0K-5K","5K-10K","10K-20K","20K-30K","30K-50K","50K-75K","75K-1L","1L-2L","2L+"],j=["5K-10K","10K-20K","20K-30K","30K-50K","50K-75K","75K-1L","1L-2L","2L+"],S=["0-25L","25L-50L","50L-75L","75L-1Cr","1Cr-2Cr","2Cr-5Cr","5Cr+"],T=["0-50L","50L-1Cr","1Cr-2Cr","2Cr-5Cr","5Cr-10Cr","10Cr-25Cr","25Cr+"],k=["0-10K","10K-25K","25K-50K","50K-1L","1L-2L","2L-5L","5L+"],A=["10K-25K","25K-50K","50K-1L","1L-2L","2L-5L","5L+"],C=(0,e.useMemo)(()=>["Apartment","Studio Apartment","Villa / Row House / Bungalow / Farm House","Penthouse","Plot / Land / Industrial Property","Commercial Office","Commercial Shop","Co-working Space","Warehouse / Godown","PG / Hostel"],[x]),E=[{value:"6",label:"6 Months"},{value:"12",label:"12 Months"},{value:"18",label:"18 Months"},{value:"24",label:"24 Months+"}],N=[{value:"Pre-Launch",label:"Pre-Launch"},{value:"Under Construction",label:"Under Construction"},{value:"Completed",label:"Completed"}],I=e=>"pg"!==x||["Apartment","PG / Hostel"].includes(e),P=["Apartment","Studio Apartment","Villa / Row House / Bungalow / Farm House","Penthouse","PG / Hostel"],M=["Plot / Land / Industrial Property","Commercial Office","Commercial Shop","Co-working Space","Warehouse / Godown"],L=(0,e.useMemo)(()=>"pg"===x?["1RK","1 BHK","2 BHK","3 BHK","4 BHK","5+ BHK"]:["1 BHK","2 BHK","3 BHK","4 BHK","5+ BHK"],[x]),R=["0-500 sq ft","500-1000 sq ft","1000-2000 sq ft","2000-5000 sq ft","5000-10000 sq ft","10000+ sq ft"],D=(0,e.useMemo)(()=>P.includes(o.propertyType),[o.propertyType]),F=(0,e.useMemo)(()=>M.includes(o.propertyType),[o.propertyType]),O=(0,e.useMemo)(()=>(()=>{const e="buy"===x||"Buy"===o.listingType,t="rent"===x||"pg"===x||"Rent"===o.listingType;if(e&&"Rent"!==o.listingType)return o.propertyType&&{Apartment:S,"Studio Apartment":S,"Villa / Row House / Bungalow / Farm House":S,Penthouse:S,"PG / Hostel":w,"Plot / Land / Industrial Property":T,"Commercial Office":T,"Commercial Shop":T,"Co-working Space":k,"Warehouse / Godown":k}[o.propertyType]||S;if(t&&"Buy"!==o.listingType){if(!o.propertyType)return"rent"===x?j:w;const e="rent"===x?j:w,t="rent"===x?A:k;return{Apartment:e,"Studio Apartment":e,"Villa / Row House / Bungalow / Farm House":e,Penthouse:e,"PG / Hostel":e,"Plot / Land / Industrial Property":t,"Commercial Office":t,"Commercial Shop":t,"Co-working Space":t,"Warehouse / Godown":t}[o.propertyType]||e}if("pg"===x)return o.propertyType&&{Apartment:w,"PG / Hostel":w}[o.propertyType]||w;return o.propertyType&&{Apartment:S,"Studio Apartment":S,"Villa / Row House / Bungalow / Farm House":S,Penthouse:S,"PG / Hostel":w,"Plot / Land / Industrial Property":T,"Commercial Office":T,"Commercial Shop":T,"Co-working Space":k,"Warehouse / Godown":k}[o.propertyType]||S})(),[o.propertyType,o.listingType,x]),z=e=>{const{name:t,value:r}=e.target;"propertyType"===t&&r&&!I(r)||("propertyType"===t?a(e=>(0,p.A)((0,p.A)({},e),{},{propertyType:r,bedrooms:"",area:"",budget:""})):"listingType"===t?a(e=>(0,p.A)((0,p.A)({},e),{},{listingType:r,budget:""})):"location"===t?a(e=>(0,p.A)((0,p.A)({},e),{},{location:r})):"uploadTime"===t?(a(e=>(0,p.A)((0,p.A)({},e),{},{uploadTime:r})),(i.pathname.includes("/buyer-dashboard/search")||i.pathname.includes("/searchresults"))&&setTimeout(()=>{U({preventDefault:()=>{},stopPropagation:()=>{}})},0)):"expectedPossession"===t||"projectStatus"===t?(a(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r})),(i.pathname.includes("/buyer-dashboard/search")||i.pathname.includes("/searchresults"))&&setTimeout(()=>{U({preventDefault:()=>{},stopPropagation:()=>{}})},0)):a(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r})))},U=(e,n)=>{var i;if(e&&(e.preventDefault(),e.stopPropagation()),"upcoming-projects"!==b&&o.propertyType&&!I(o.propertyType))return;const s=new URLSearchParams;"upcoming-projects"===b&&(s.set("searchMode","upcoming-projects"),s.set("project_type","upcoming"));const a=null!==(i=null===n||void 0===n?void 0:n.selectedLocationOverride)&&void 0!==i?i:l;let c=null;if(null!==a&&void 0!==a&&a.city&&""!==a.city.trim())c=a.city.trim();else if(null!==n&&void 0!==n&&n.selectedLocationOverride&&(null!==a&&void 0!==a&&a.placeName||null!==a&&void 0!==a&&a.fullAddress)){const e=(a.placeName||a.fullAddress||"").trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);e.length>=2?c=e[1]:1===e.length&&(c=e[0])}else if(null!==n&&void 0!==n&&n.selectedLocationOverride||!o.location||""===o.location.trim()){const e=r.get("city");e&&""!==e.trim()&&(c=e.trim())}else{const e=o.location.trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);e.length>=3?c=e[1]:(2===e.length||1===e.length)&&(c=e[0])}if(c&&""!==c.trim()&&s.set("city",c.trim()),a&&(a.placeName||a.fullAddress))s.append("location",a.placeName||a.fullAddress);else if(null!==n&&void 0!==n&&n.selectedLocationOverride||!o.location||""===o.location.trim()){const e=r.get("location");e&&s.append("location",e)}else s.append("location",o.location.trim());if(a&&a.coordinates&&a.coordinates.lat&&a.coordinates.lng)s.append("lat",String(a.coordinates.lat)),s.append("lng",String(a.coordinates.lng)),s.append("radius","10");else{const e=r.get("lat"),t=r.get("lng");e&&t&&(s.append("lat",e),s.append("lng",t),s.append("radius",r.get("radius")||"10"))}"upcoming-projects"===b?(o.propertyType&&""!==o.propertyType.trim()&&s.append("property_type",o.propertyType),o.expectedPossession&&""!==o.expectedPossession.trim()&&s.append("expected_possession",o.expectedPossession),o.projectStatus&&""!==o.projectStatus.trim()&&s.append("project_status",o.projectStatus)):(o.propertyType&&""!==o.propertyType.trim()?"pg"===x&&I(o.propertyType)?s.append("type",o.propertyType):"pg"===x?s.append("type","Apartment / PG / Hostel"):"home"===x?s.append("property_type",o.propertyType):s.append("type",o.propertyType):"pg"===x&&s.append("type","Apartment / PG / Hostel"),o.budget&&""!==o.budget.trim()&&s.append("budget",o.budget),D&&o.bedrooms&&""!==o.bedrooms.trim()?s.append("bedrooms",o.bedrooms):F&&o.area&&""!==o.area.trim()&&s.append("area",o.area),o.uploadTime&&""!==o.uploadTime.trim()&&s.append("upload_time",o.uploadTime),"buy"===x?s.append("status","For Sale"):"rent"===x||"pg"===x?s.append("status","For Rent"):"Buy"===o.listingType?s.append("status","For Sale"):"Rent"===o.listingType&&s.append("status","For Rent"));const u=s.toString(),d=u?"/buyer-dashboard/search?".concat(u):"/buyer-dashboard/search";t(d)},V=(0,e.useMemo)(()=>{let e=0;return"upcoming-projects"===b?(o.propertyType&&""!==o.propertyType.trim()&&e++,o.expectedPossession&&""!==o.expectedPossession.trim()&&e++,o.projectStatus&&""!==o.projectStatus.trim()&&e++,e):(o.propertyType&&""!==o.propertyType.trim()&&e++,o.budget&&""!==o.budget.trim()&&e++,(o.bedrooms&&""!==o.bedrooms.trim()||o.area&&""!==o.area.trim())&&e++,o.uploadTime&&""!==o.uploadTime.trim()&&e++,o.listingType&&"All"!==o.listingType&&e++,e)},[b,o.propertyType,o.budget,o.bedrooms,o.area,o.uploadTime,o.listingType,o.expectedPossession,o.projectStatus]),q=()=>"upcoming-projects"===b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"propertyType",className:"compact-search-label",children:"Property Type"}),(0,s.jsxs)("select",{id:"propertyType",name:"propertyType",value:o.propertyType,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"All Types"}),C.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"expectedPossession",className:"compact-search-label",children:"Expected Possession Date"}),(0,s.jsxs)("select",{id:"expectedPossession",name:"expectedPossession",value:o.expectedPossession,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any"}),E.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"projectStatus",className:"compact-search-label",children:"Project Status"}),(0,s.jsxs)("select",{id:"projectStatus",name:"projectStatus",value:o.projectStatus,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any"}),N.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))]})]})]}):(0,s.jsxs)(s.Fragment,{children:["home"===x&&(i.pathname.includes("/buyer-dashboard/search")||i.pathname.includes("/searchresults"))&&(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"listingType",className:"compact-search-label",children:"Listing Type"}),(0,s.jsxs)("select",{id:"listingType",name:"listingType",value:o.listingType,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"All",children:"All"}),(0,s.jsx)("option",{value:"Buy",children:"Buy"}),(0,s.jsx)("option",{value:"Rent",children:"Rent"})]})]}),(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"propertyType",className:"compact-search-label",children:"Property Type"}),(0,s.jsxs)("select",{id:"propertyType",name:"propertyType",value:o.propertyType,onChange:z,className:"compact-search-select",title:o.propertyType&&!I(o.propertyType)?"Available only for Rent properties":"",children:[(0,s.jsx)("option",{value:"",children:"All Types"}),C.map(e=>{const t=I(e);return(0,s.jsx)("option",{value:e,disabled:!t,className:t?"":"buyer-disabled-option",children:e},e)})]}),"pg"===x&&(0,s.jsx)("small",{style:{fontSize:"0.75rem",color:"#94a3b8",marginTop:"0.25rem",display:"block"},children:"Only Apartment and PG / Hostel are available. Other types are available on the Rent page."})]}),(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"budget",className:"compact-search-label",children:"Budget"}),(0,s.jsxs)("select",{id:"budget",name:"budget",value:o.budget,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Budget"}),O.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsx)("div",{className:"compact-search-field",children:D?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{htmlFor:"bedrooms",className:"compact-search-label",children:"pg"===x?"Bedroom / Room Type":"Bedrooms"}),(0,s.jsxs)("select",{id:"bedrooms",name:"bedrooms",value:o.bedrooms,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any"}),L.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}):F?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{htmlFor:"area",className:"compact-search-label",children:"Area"}),(0,s.jsxs)("select",{id:"area",name:"area",value:o.area,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Area"}),R.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("label",{htmlFor:"bedrooms",className:"compact-search-label",children:"pg"===x?"Bedroom / Room Type":"Bedroom / Area"}),(0,s.jsxs)("select",{id:"bedrooms",name:"bedrooms",value:o.bedrooms,onChange:z,className:"compact-search-select",disabled:!o.propertyType||!D,children:[(0,s.jsx)("option",{value:"",children:"Select Property Type"}),o.propertyType&&D&&L.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]})}),(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"StoredBy",className:"compact-search-label",children:"Stored By"}),(0,s.jsxs)("select",{id:"uploadTime",name:"uploadTime",value:o.uploadTime,onChange:z,className:"compact-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Time"}),(0,s.jsx)("option",{value:"7",children:"Within 7 days"}),(0,s.jsx)("option",{value:"14",children:"Within 2 weeks"}),(0,s.jsx)("option",{value:"30",children:"Within 1 month"})]})]})]});return(0,s.jsxs)("div",{className:"compact-search-bar",children:[(0,s.jsx)("form",{className:"compact-search-form",onSubmit:U,noValidate:!0,children:(0,s.jsxs)("div",{className:"compact-search-filters",children:[(0,s.jsxs)("div",{className:"compact-search-field",children:[(0,s.jsx)("label",{htmlFor:"location",className:"compact-search-label",children:"Location"}),(0,s.jsx)(_,{placeholder:"City / Locality",value:o.location,dropdownOpen:!h&&u,onDropdownOpenChange:e=>{h&&e||d(e)},onInputFocus:()=>m(!1),onInputChange:e=>{a(t=>(0,p.A)((0,p.A)({},t),{},{location:e||""})),c(null),e&&""!==e.trim()||m(!1)},onChange:e=>{if(!e)return c(null),a(e=>(0,p.A)((0,p.A)({},e),{},{location:""})),void m(!1);let t=e.city||"";if(!t&&(e.fullAddress||e.placeName)){const r=(e.fullAddress||e.placeName||"").trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);r.length>=2?t=r[1]:1===r.length&&(t=r[0])}c((0,p.A)((0,p.A)({},e),{},{city:t})),a(t=>(0,p.A)((0,p.A)({},t),{},{location:e.fullAddress||e.placeName||""})),m(!0),d(!1)},onSearch:e=>{if(e){let t=e.city||"";if(!t&&(e.fullAddress||e.placeName)){const r=(e.fullAddress||e.placeName||"").trim().split(",").map(e=>e.trim()).filter(e=>e.length>0);r.length>=2?t=r[1]:1===r.length&&(t=r[0])}c((0,p.A)((0,p.A)({},e),{},{city:t})),a(t=>(0,p.A)((0,p.A)({},t),{},{location:e.fullAddress||e.placeName||""})),m(!0),d(!1)}U(null,{selectedLocationOverride:e||void 0})},className:"compact-search-input"})]}),f&&(0,s.jsxs)("button",{type:"button",className:"compact-filters-button",onClick:()=>v(!0),children:[(0,s.jsx)(Xe.A,{size:18}),(0,s.jsx)("span",{children:"Filters"}),V>0&&(0,s.jsx)("span",{className:"compact-filters-badge",children:V})]}),!f&&q(),(0,s.jsxs)("button",{type:"submit",className:"compact-search-button",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("span",{children:"Search"})]})]})}),f&&y&&(0,s.jsx)("div",{className:"compact-filters-modal-overlay",onClick:()=>v(!1),children:(0,s.jsxs)("div",{className:"compact-filters-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"compact-filters-modal-header",children:[(0,s.jsx)("h2",{children:"Filters"}),(0,s.jsx)("button",{type:"button",className:"compact-filters-modal-close",onClick:()=>v(!1),"aria-label":"Close filters",children:(0,s.jsx)(B.A,{size:20})})]}),(0,s.jsx)("div",{className:"compact-filters-modal-content",children:q()}),(0,s.jsx)("div",{className:"compact-filters-modal-footer",children:(0,s.jsx)("button",{type:"button",className:"compact-filters-modal-apply",onClick:()=>{v(!1),U(null)},children:"Apply Filters"})})]})})]})},Qe=()=>(0,s.jsx)("div",{className:"map-fullscreen-compact-search",children:(0,s.jsx)(Je,{})}),$e=()=>{const[t]=(0,n.ok)(),r=(0,n.Zp)(),o=(0,n.zy)(),[a,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0),[d,h]=(0,e.useState)(null),[m,f]=(0,e.useState)(!1),[g,y]=(0,e.useState)(!1),_=(0,e.useRef)(null),v=(0,e.useRef)({}),x=(0,e.useRef)(null);(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),(0,e.useEffect)(()=>{const e=()=>{y(window.innerWidth<=767)};return e(),window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[]);const[b,w]=(0,e.useState)({city:"",location:"",type:"",budget:"",bedrooms:"",area:"",status:"",upload_time:"",expected_possession:"",project_status:""}),j=(0,e.useMemo)(()=>{const e=t.get("searchMode"),r=t.get("project_type");return"upcoming-projects"===e||"upcoming"===r},[t]),T=e=>{if(!e)return"Unknown";const t=e.split(",");return t.length>1?t[t.length-1].trim():e.split(" ")[0]},k=e=>{if(!e||!Array.isArray(e)||0===e.length)return"N/A";const t=(e||[]).filter(e=>e&&(String(e).includes("BHK")||String(e).includes("bhk"))).map(e=>{const t=String(e).match(/(\d+)\s*BHK/i);return t?"".concat(t[1]," BHK"):e}).filter((e,t,r)=>r.indexOf(e)===t).sort((e,t)=>{var r,n;return parseInt((null===(r=e.match(/\d+/))||void 0===r?void 0:r[0])||"0")-parseInt((null===(n=t.match(/\d+/))||void 0===n?void 0:n[0])||"0")});return t.length>0?t.join(", "):e.join(", ")};(0,e.useEffect)(()=>{(async()=>{try{u(!0);const e=t.get("city")||"",r=t.get("location")||"";let n=t.get("type")||t.get("property_type")||"";const s=t.get("budget")||"",o=t.get("bedrooms")||"",a=t.get("area")||"";let c=t.get("status")||"";const d=t.get("upload_time")||"",h=t.get("expected_possession")||"",m=t.get("project_status")||"";if("upcoming-projects"===t.get("searchMode")||"upcoming"===t.get("project_type")){const t={limit:1e3,project_type:"upcoming"};e&&(t.city=e),r&&(t.location=r),n&&(t.property_type=n);const s=await i.propertiesAPI.list(t);if(!s.success||!s.data)return l([]),void u(!1);let o=s.data.properties||s.data.property||[];Array.isArray(o)||(o=[]);const a=e=>(e||"").toString().toLowerCase().replace(/\s+/g,"").replace(/-/g,""),c=o.map(e=>{let t=e.cover_image&&""!==e.cover_image.trim()?e.cover_image:(Array.isArray(e.images)&&e.images.length>0?e.images.find(e=>e&&""!==e.trim()):null)||null;t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500");let r={};try{"string"===typeof e.upcoming_project_data?r=JSON.parse(e.upcoming_project_data)||{}:"object"===typeof e.upcoming_project_data&&(r=e.upcoming_project_data||{})}catch(s){}if(m){const e=a(r.projectStatus||""),t=a(m);if(!e||!t||e!==t&&!e.includes(t))return null}const n=r.expectedPossessionDate||r.expected_possession||"";if(h&&n){const e=new Date(n);if(isNaN(e.getTime()))return null;{const t=new Date,r=12*(e.getFullYear()-t.getFullYear())+(e.getMonth()-t.getMonth()),n=parseInt(h,10);if(24===n){if(r<24)return null}else if(!isNaN(n)&&(r>n||r<0))return null}}else if(h)return null;return{id:e.id,image:t,title:e.title,location:e.location,city:T(e.location),bhkType:k(r.configurations),priceRange:(i=e.price,i?(i/1e7).toFixed(1):"0"),projectStatus:r.projectStatus,price:parseFloat(e.price)||0,builder:r.builderName||e.seller_name||"Builder",builderLink:"#builder-".concat(e.id),upcomingData:r,propertyData:e,latitude:e.latitude,longitude:e.longitude};var i}).filter(Boolean);return l(c),void u(!1)}const f=(t.get("propertyType")||"").toLowerCase();"buy"===f?c=c||"sale":"rent"===f?c=c||"rent":"pg"===f&&(n=n||"PG / Hostel");const g="PG / Hostel"===n||n.toLowerCase().includes("pg")||n.toLowerCase().includes("hostel"),y={limit:1e3};let _;e&&(y.city=e),r&&(y.location=r),s&&(y.budget=s),o&&(y.bedrooms=o),a&&(y.area=a),c&&(y.status=c.toLowerCase().replace("for ","")),d&&(y.upload_time=d),console.log("\ud83d\udd0d Search parameters from URL:",{city:e,location:r,type:n,budget:s,bedrooms:o,area:a,status:c});let v=[];const x=new Set;if(g){console.log("\ud83d\udce1 PG/Hostel search detected - fetching both PG/Hostel and available_for_bachelors properties");const e=await i.propertiesAPI.list((0,p.A)((0,p.A)({},y),{},{property_type:"PG / Hostel"})),t=await i.propertiesAPI.list((0,p.A)((0,p.A)({},y),{},{available_for_bachelors:!0}));if(e.success&&e.data){(e.data.properties||e.data.property||[]).forEach(e=>{x.has(e.id)||(x.add(e.id),v.push(e))})}if(t.success&&t.data){(t.data.properties||t.data.property||[]).forEach(e=>{x.has(e.id)||(x.add(e.id),v.push(e))})}_={success:!0,data:{properties:v}}}else n&&(y.property_type=n),console.log("\ud83d\udce1 API params being sent:",y),_=await i.propertiesAPI.list(y);if(console.log("\u2705 API response received:",_),console.log("\ud83d\udcca Response success:",_.success),console.log("\ud83d\udce6 Response data:",_.data),_.success&&_.data){let t=[];if(Array.isArray(_.data.properties)?t=_.data.properties:Array.isArray(_.data.property)?t=_.data.property:Array.isArray(_.data)?t=_.data:_.data.properties&&"object"===typeof _.data.properties&&(t=Object.values(_.data.properties)),console.log("\ud83d\udccb Found ".concat(t.length," properties")),Array.isArray(t)&&t.length>0){const i=t.filter(e=>{if(e.project_type&&"upcoming"===e.project_type)return!1;if(g){const t="PG / Hostel"===(e.property_type||e.type||""),r=1===e.available_for_bachelors||!0===e.available_for_bachelors;return t||r}return!0}).map(e=>{let t=e.cover_image||(Array.isArray(e.images)&&e.images.length>0?e.images[0]:null)||"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500";return{id:e.id,image:t,title:e.title||"Untitled Property",price:parseFloat(e.price)||0,location:e.location||"Location not specified",bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area)||0,type:e.property_type||e.type||"Unknown",status:"sale"===e.status?"For Sale":"rent"===e.status?"For Rent":e.status||"For Sale",propertyType:e.property_type||e.type||"Unknown",projectType:e.project_type||null,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?[e.amenities]:[],images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone,available_for_bachelors:e.available_for_bachelors||0}}),u=A(r||e||"",n,s,o,a,"sale"===c?"For Sale":"rent"===c?"For Rent":c||"",i);console.log("\u2705 Setting ".concat(u.length," properties to state (upcoming projects excluded)")),l(u)}else console.log("\u26a0\ufe0f No properties found in response array"),l([])}else console.warn("\u26a0\ufe0f API response not successful:",_),l([])}catch(e){console.error("\u274c Error fetching properties:",e),console.error("Error details:",{message:e.message,status:e.status,errors:e.errors});try{console.log("\ud83d\udd04 Attempting fallback: fetching all properties");const e=t.get("location")||"",r=t.get("city")||"",n=t.get("budget")||"",s=t.get("bedrooms")||"",o=t.get("area")||"",a=await i.propertiesAPI.list({limit:100});if(a.success&&a.data){const i=a.data.properties||a.data.property||[];if(Array.isArray(i)&&i.length>0){const a=(t.get("propertyType")||"").toLowerCase();let c=t.get("type")||t.get("property_type")||"",u=t.get("status")||"";"pg"===a&&(c=c||"PG / Hostel"),"buy"===a&&(u=u||"sale"),"rent"===a&&(u=u||"rent");const d="PG / Hostel"===c||c.toLowerCase().includes("pg")||c.toLowerCase().includes("hostel"),h=i.filter(e=>{if(e.project_type&&"upcoming"===e.project_type)return!1;if("sale"===u&&"sale"!==e.status&&"For Sale"!==e.status)return!1;if("rent"===u&&"rent"!==e.status&&"For Rent"!==e.status)return!1;if(d){const t="PG / Hostel"===(e.property_type||e.type||""),r=1===e.available_for_bachelors||!0===e.available_for_bachelors;return t||r}return!0}).map(e=>({id:e.id,image:e.cover_image||Array.isArray(e.images)&&e.images[0]||"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500",title:e.title||"Untitled Property",price:parseFloat(e.price)||0,location:e.location||"Location not specified",bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area)||0,type:e.property_type||e.type||"Unknown",status:"sale"===e.status?"For Sale":"rent"===e.status?"For Rent":e.status||"For Sale",propertyType:e.property_type||e.type||"Unknown",projectType:e.project_type||null,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:[],images:Array.isArray(e.images)?e.images:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone,available_for_bachelors:e.available_for_bachelors||0})),p=A(e||r,c,n,s,o,"sale"===u?"For Sale":"rent"===u?"For Rent":u||"",h);console.log("\u2705 Fallback: Setting ".concat(p.length," properties (upcoming projects excluded)")),l(p)}else l([])}else l([])}catch(r){console.error("\u274c Fallback fetch also failed:",r),l([])}}finally{u(!1)}})()},[t]);const A=(0,e.useCallback)((e,t,r,n,i,s,o)=>{let a=[...o||[]];if(s&&(a=a.filter(e=>e.status===s)),e&&(a=a.filter(t=>t.location.toLowerCase().includes(e.toLowerCase()))),t){const e=t.split(" / ").map(e=>e.trim().toLowerCase());a=a.filter(t=>{const r=t.type.toLowerCase().trim();return e.some(e=>r===e||r.includes(e)||e.includes(r))})}if(r&&(a=a.filter(e=>((e,t,r)=>{const n=("For Rent"===r?{"0K-5K":{min:0,max:5e3},"5K-10K":{min:5e3,max:1e4},"10K-20K":{min:1e4,max:2e4},"20K-30K":{min:2e4,max:3e4},"30K-50K":{min:3e4,max:5e4},"50K-75K":{min:5e4,max:75e3},"75K-1L":{min:75e3,max:1e5},"1L-2L":{min:1e5,max:2e5},"2L+":{min:2e5,max:1/0}}:{"0-25L":{min:0,max:25e5},"25L-50L":{min:25e5,max:5e6},"50L-75L":{min:5e6,max:75e5},"75L-1Cr":{min:75e5,max:1e7},"1Cr-2Cr":{min:1e7,max:2e7},"2Cr+":{min:2e7,max:1/0}})[t];if(!n)return!0;const i=e;return i>=n.min&&i<=n.max})(e.price,r,e.status))),n){const e=n.toString(),t=e.match(/(\d+)/),r=t?parseInt(t[1]):null,i=e.includes("+");null!==r&&(a=a.filter(e=>{const t="string"===typeof e.bedrooms?parseInt(e.bedrooms.replace(/\D/g,""))||0:e.bedrooms||0;return i?t>=r:t===r}))}if(i){const e=i.match(/(\d+)-(\d+)/);if(e){const t=parseInt(e[1]),r=parseInt(e[2]);a=a.filter(e=>{const n="string"===typeof e.area?parseFloat(e.area):e.area;return n>=t&&n<=r})}else if(i.includes("+")){const e=parseInt(i.replace(/\D/g,""));a=a.filter(t=>("string"===typeof t.area?parseFloat(t.area):t.area)>=e)}}return a},[]);(0,e.useEffect)(()=>{let e=t.get("city")||"";const r=t.get("location")||"";let n=t.get("type")||t.get("property_type")||"";const i=t.get("budget")||"",s=t.get("bedrooms")||"",o=t.get("area")||"";let a=t.get("status")||"";const l=t.get("upload_time")||"",c=t.get("expected_possession")||"",u=t.get("project_status")||"",d=(t.get("propertyType")||"").toLowerCase();"buy"===d?a=a||"For Sale":"rent"===d?a=a||"For Rent":"pg"===d?n=n||"PG / Hostel":"sale"===a?a="For Sale":"rent"===a&&(a="For Rent"),w({city:e,location:r,type:n,budget:i,bedrooms:s,area:o,status:a,upload_time:l,expected_possession:c,project_status:u})},[t]);const C=()=>{const e=o.pathname.includes("/buyer-dashboard/search")?"/buyer-dashboard/search":"/searchresults";r(j?"".concat(e,"?searchMode=upcoming-projects&project_type=upcoming"):e),w({city:"",location:"",type:"",budget:"",bedrooms:"",area:"",status:"",upload_time:"",expected_possession:"",project_status:""})},E=e=>{const n=new URLSearchParams(t);n.delete(e),"type"===e&&(n.delete("property_type"),n.delete("propertyType")),"status"===e&&n.delete("propertyType"),j&&(n.has("searchMode")||n.set("searchMode","upcoming-projects"),n.has("project_type")||n.set("project_type","upcoming"));const i=n.toString(),s=o.pathname.includes("/buyer-dashboard/search")?"/buyer-dashboard/search":"/searchresults";r(i?"".concat(s,"?").concat(i):s)},N=j?b.city||b.location||b.type||b.expected_possession||b.project_status:Object.values(b).some(e=>""!==e),I=(0,e.useCallback)(e=>{x.current&&clearTimeout(x.current),x.current=setTimeout(()=>{h(e.id)},300)},[]),P=(0,e.useCallback)(()=>{x.current&&(clearTimeout(x.current),x.current=null)},[]),M=(0,e.useCallback)(e=>{h(e.id),v.current[e.id]&&v.current[e.id].scrollIntoView({behavior:"smooth",block:"center"})},[]),L=(0,e.useCallback)((e,t)=>{if(null===e||null===t||void 0===e||void 0===t)return!1;const r="string"===typeof e?parseFloat(e):e,n="string"===typeof t?parseFloat(t):t;return!isNaN(r)&&!isNaN(n)&&(r>=-90&&r<=90&&n>=-180&&n<=180)},[]),R=(0,e.useMemo)(()=>{if(0===a.length)return[73.8567,18.5204];const e=a.filter(e=>L(e.latitude,e.longitude));if(0===e.length)return[73.8567,18.5204];return[e.reduce((e,t)=>e+("string"===typeof t.longitude?parseFloat(t.longitude):t.longitude),0)/e.length,e.reduce((e,t)=>e+("string"===typeof t.latitude?parseFloat(t.latitude):t.latitude),0)/e.length]},[a,L]),D=(0,e.useMemo)(()=>a.filter(e=>L(e.latitude,e.longitude)).map(e=>{const t="string"===typeof e.latitude?parseFloat(e.latitude):e.latitude,r="string"===typeof e.longitude?parseFloat(e.longitude):e.longitude;let n=null,i=[];return e.image?(n=e.image,i=[e.image]):e.images&&Array.isArray(e.images)&&e.images.length>0?"string"===typeof e.images[0]?(n=e.images[0],i=e.images):e.images[0].url&&(n=e.images[0].url,i=e.images.map(e=>"string"===typeof e?e:e.url)):e.cover_image&&(n=e.cover_image,i=[e.cover_image]),{id:e.id,title:e.title||"Untitled Property",location:e.location||"Location not specified",price:"string"===typeof e.price?parseFloat(e.price):e.price||0,area:"string"===typeof e.area?parseFloat(e.area):e.area||0,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",listing_type:"For Rent"===e.status?"rent":"sale",property_type:e.type||e.propertyType||"Unknown",latitude:t,longitude:r,thumbnail:n,images:i,cover_image:n,seller_id:e.seller_id}}),[a,L]);return(0,s.jsxs)("div",{className:"buyer-search-results-page",children:[(0,s.jsx)(Je,{}),(0,s.jsxs)("div",{className:"search-results-split-layout",children:[(0,s.jsxs)("div",{className:"search-results-listings",children:[(0,s.jsxs)("div",{className:"search-results-header",ref:_,children:[(0,s.jsxs)("div",{className:"search-results-header-top",children:[(0,s.jsxs)("h2",{className:"search-results-title",children:[a.length," ",j?1===a.length?"project":"projects":1===a.length?"property":"properties"," found"]}),g&&(0,s.jsxs)("button",{onClick:()=>f(!m),className:"mobile-map-toggle",children:[(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3"})]}),m?"Hide Map":"Show Map"]})]}),N&&(0,s.jsxs)("div",{className:"search-results-filters",children:[(0,s.jsx)("span",{className:"filters-label",children:"Active Filters:"}),(0,s.jsxs)("div",{className:"filter-tags",children:[b.city&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-city",children:[(0,s.jsxs)("span",{children:["City: ",b.city]}),(0,s.jsx)("button",{onClick:()=>E("city"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.location&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-location",children:[(0,s.jsxs)("span",{children:["Location: ",b.location]}),(0,s.jsx)("button",{onClick:()=>E("location"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.type&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-type ".concat(b.type.toLowerCase().includes("pg")||b.type.toLowerCase().includes("hostel")?"filter-tag-pghostel":""),children:[(0,s.jsxs)("span",{children:["Type: ",b.type]}),(0,s.jsx)("button",{onClick:()=>E("type"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.budget&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-budget",children:[(0,s.jsxs)("span",{children:["Budget: ",b.budget]}),(0,s.jsx)("button",{onClick:()=>E("budget"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.bedrooms&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-bedrooms",children:[(0,s.jsxs)("span",{children:["Bedrooms: ",b.bedrooms]}),(0,s.jsx)("button",{onClick:()=>E("bedrooms"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.area&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-area",children:[(0,s.jsxs)("span",{children:["Area: ",b.area]}),(0,s.jsx)("button",{onClick:()=>E("area"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.status&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-status filter-tag-".concat(b.status.toLowerCase().replace(/\s+/g,"-")),children:[(0,s.jsxs)("span",{children:["Status: ",b.status]}),(0,s.jsx)("button",{onClick:()=>E("status"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),b.upload_time&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-upload-time",children:[(0,s.jsxs)("span",{children:["Upload Time: ","7"===b.upload_time?"Within 7 days":"14"===b.upload_time?"Within 2 weeks":"30"===b.upload_time?"Within 1 month":b.upload_time]}),(0,s.jsx)("button",{onClick:()=>E("upload_time"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),j&&b.expected_possession&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-expected-possession",children:[(0,s.jsxs)("span",{children:["Possession: ","6"===b.expected_possession?"6 Months":"12"===b.expected_possession?"12 Months":"18"===b.expected_possession?"18 Months":"24"===b.expected_possession?"24 Months+":b.expected_possession]}),(0,s.jsx)("button",{onClick:()=>E("expected_possession"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),j&&b.project_status&&(0,s.jsxs)("div",{className:"filter-tag filter-tag-project-status",children:[(0,s.jsxs)("span",{children:["Status: ",b.project_status]}),(0,s.jsx)("button",{onClick:()=>E("project_status"),className:"remove-filter",children:(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})})]}),(0,s.jsx)("button",{onClick:C,className:"clear-all-btn",children:"Clear All"})]})]})]}),(0,s.jsx)("div",{className:"search-results-content",children:c?(0,s.jsxs)("div",{className:"search-loading-results",children:[(0,s.jsx)("div",{className:"search-loading-spinner"}),(0,s.jsx)("p",{children:"Searching properties..."})]}):a.length>0?(0,s.jsx)("div",{className:"search-results-grid",children:j?a.map(e=>(0,s.jsx)("div",{ref:t=>v.current[e.id]=t,className:"property-card-wrapper ".concat(d===e.id?"selected":""),onMouseEnter:()=>I(e),onMouseLeave:P,children:(0,s.jsx)(ne,{project:e})},e.id)):a.map(e=>(0,s.jsx)("div",{ref:t=>v.current[e.id]=t,className:"property-card-wrapper ".concat(d===e.id?"selected":""),onMouseEnter:()=>I(e),onMouseLeave:P,children:(0,s.jsx)(S,{property:e})},e.id))}):(0,s.jsxs)("div",{className:"search-no-results",children:[(0,s.jsxs)("svg",{width:"100",height:"100",viewBox:"0 0 24 24",fill:"none",stroke:"#cbd5e0",strokeWidth:"1.5",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8"}),(0,s.jsx)("path",{d:"m21 21-4.35-4.35"})]}),(0,s.jsx)("h3",{children:j?"No Projects Found":"No Properties Found"}),(0,s.jsx)("p",{children:j?"We couldn't find any upcoming projects matching your search criteria.":"We couldn't find any properties matching your search criteria."}),(0,s.jsxs)("div",{className:"search-no-results-actions",children:[(0,s.jsx)("button",{onClick:C,className:"search-try-again-btn",children:"Clear Filters & Try Again"}),(0,s.jsx)("button",{onClick:()=>r("/buyer-dashboard"),className:"search-go-home-btn",children:"Go to Dashboard"})]})]})})]}),!g&&(0,s.jsx)("div",{className:"search-results-map",children:(0,s.jsx)(Ie,{properties:D,center:R,zoom:D.length>0?12:5,showControls:!0,interactive:!0,currentPropertyId:d,onPropertyClick:M,fullscreenSearchBar:(0,s.jsx)(Qe,{})})})]}),g&&m&&(0,s.jsx)("div",{className:"mobile-map-overlay",onClick:()=>f(!1),children:(0,s.jsxs)("div",{className:"mobile-map-container",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{className:"mobile-map-close",onClick:()=>f(!1),children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),(0,s.jsx)("line",{x1:"6",y1:"6",x2:"18",y2:"18"})]})}),(0,s.jsx)(Ie,{properties:D,center:R,zoom:D.length>0?12:5,showControls:!0,interactive:!0,currentPropertyId:d,onPropertyClick:M,fullscreenSearchBar:(0,s.jsx)(Qe,{})})]})})]})},et=()=>{const[t]=(0,n.ok)(),r=(0,n.Zp)(),o=t.get("city"),[a,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0),[d,h]=(0,e.useState)("grid");(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),(0,e.useEffect)(()=>{(async()=>{try{u(!0);const e={status:"sale",limit:100};o&&(e.location=o);const t=await i.propertiesAPI.list(e);if(t.success&&t.data&&t.data.properties){const e=t.data.properties.filter(e=>{const t="sale"===e.status||"For Sale"===e.status,r=!e.project_type||"upcoming"!==e.project_type;return t&&r}).map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}return t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"),{id:e.id,image:t,title:e.title,price:parseFloat(e.price),location:e.location,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area),type:e.property_type,status:"For Sale",propertyType:e.property_type,projectType:e.project_type||null,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?[e.amenities]:[],images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone}});l(e)}else l([])}catch(e){console.error("Error fetching properties:",e),l([])}finally{u(!1)}})()},[o]);return(0,s.jsxs)("div",{className:"buyer-filtered-properties-page",children:[(0,s.jsx)(te,{status:"For Sale",title:"Discover Properties Ready to Buy",subtitle:"Search from thousands of verified properties across India",backgroundImage:"/buyeee.jpeg"}),(0,s.jsx)("div",{className:"buyer-filtered-header",children:(0,s.jsxs)("div",{className:"buyer-filtered-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:o?"Properties for Sale in ".concat(o):"All Properties for Sale"}),(0,s.jsxs)("p",{className:"buyer-filtered-count",children:[a.length," ",1===a.length?"property":"properties"," found"]})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),r("/buyer-dashboard/search?propertyType=buy")},"aria-label":"View all properties for sale",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),c?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading properties..."})}):a.length>0?(0,s.jsx)("div",{className:"buyer-filtered-properties-grid",children:a.map(e=>(0,s.jsx)(S,{property:e},e.id))}):(0,s.jsxs)("div",{className:"buyer-no-properties",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"}),(0,s.jsx)("polyline",{points:"9 22 9 12 15 12 15 22"})]}),(0,s.jsx)("h2",{children:"No Properties Found"}),(0,s.jsx)("p",{children:o?"We couldn't find any properties for sale in ".concat(o," at the moment."):"No properties available for sale."})]})]})},tt=()=>{const[t]=(0,n.ok)(),r=(0,n.Zp)(),o=t.get("city"),[a,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0);return(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),(0,e.useEffect)(()=>{(async()=>{try{u(!0);const e={status:"rent",limit:100};o&&(e.location=o);const t=await i.propertiesAPI.list(e);if(t.success&&t.data&&t.data.properties){const e=t.data.properties.filter(e=>{const t="rent"===e.status||"For Rent"===e.status,r=!e.project_type||"upcoming"!==e.project_type;return t&&r}).map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}return t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"),{id:e.id,image:t,title:e.title,price:parseFloat(e.price),location:e.location,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area),type:e.property_type,status:"For Rent",propertyType:e.property_type,projectType:e.project_type||null,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?[e.amenities]:[],images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone}});l(e)}else l([])}catch(e){console.error("Error fetching properties:",e),l([])}finally{u(!1)}})()},[o]),(0,s.jsxs)("div",{className:"buyer-filtered-properties-page",children:[(0,s.jsx)(te,{status:"For Rent",title:"Explore the Best Rentals in Your City",subtitle:"Search from thousands of verified properties across India",backgroundImage:"/Renthome1.jpg"}),(0,s.jsx)("div",{className:"buyer-filtered-header",children:(0,s.jsxs)("div",{className:"buyer-filtered-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:o?"Properties for Rent in ".concat(o):"All Properties for Rent"}),(0,s.jsxs)("p",{className:"buyer-filtered-count",children:[a.length," ",1===a.length?"property":"properties"," found"]})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),r("/buyer-dashboard/search?propertyType=rent")},"aria-label":"View all properties for rent",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),c?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading properties..."})}):a.length>0?(0,s.jsx)("div",{className:"buyer-filtered-properties-grid",children:a.map(e=>(0,s.jsx)(S,{property:e},e.id))}):(0,s.jsxs)("div",{className:"buyer-no-properties",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),(0,s.jsx)("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),(0,s.jsx)("path",{d:"M10 9H8"}),(0,s.jsx)("path",{d:"M16 13H8"}),(0,s.jsx)("path",{d:"M16 17H8"})]}),(0,s.jsx)("h2",{children:"No Properties Found"}),(0,s.jsx)("p",{children:o?"We couldn't find any properties for rent in ".concat(o," at the moment."):"No properties available for rent."})]})]})},rt=()=>{const[t]=(0,n.ok)(),r=(0,n.Zp)(),o=t.get("city"),[a,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0);return(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]),(0,e.useEffect)(()=>{(async()=>{try{u(!0);const e={limit:1e3};o&&(e.location=o);const t=await i.propertiesAPI.list((0,p.A)((0,p.A)({},e),{},{property_type:"PG / Hostel"})),r=await i.propertiesAPI.list((0,p.A)((0,p.A)({},e),{},{available_for_bachelors:!0})),n=[],s=new Set;if(t.success&&t.data&&t.data.properties&&t.data.properties.forEach(e=>{s.has(e.id)||(s.add(e.id),n.push(e))}),r.success&&r.data&&r.data.properties&&r.data.properties.forEach(e=>{s.has(e.id)||(s.add(e.id),n.push(e))}),n.length>0){const e=n.filter(e=>{const t="PG / Hostel"===(e.property_type||""),r=1===e.available_for_bachelors||!0===e.available_for_bachelors;return t||r}).map(e=>{let t=null;if(e.cover_image&&""!==e.cover_image.trim())t=e.cover_image;else if(Array.isArray(e.images)&&e.images.length>0){t=e.images.find(e=>e&&""!==e.trim())||null}return t&&""!==t.trim()||(t="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"),{id:e.id,image:t,title:e.title,price:parseFloat(e.price),location:e.location,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area),type:e.property_type,status:"rent"===e.status?"For Rent":"sale"===e.status?"For Sale":e.status||"For Rent",propertyType:e.property_type,description:e.description||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?[e.amenities]:[],images:Array.isArray(e.images)?e.images:e.images?[e.images]:[],latitude:e.latitude,longitude:e.longitude,createdAt:e.created_at,seller_name:e.seller_name,seller_phone:e.seller_phone,available_for_bachelors:e.available_for_bachelors||0}});l(e)}else l([])}catch(e){console.error("Error fetching properties:",e),l([])}finally{u(!1)}})()},[o]),(0,s.jsxs)("div",{className:"buyer-filtered-properties-page",children:[(0,s.jsx)(te,{title:"Explore PG & Hostel Options",subtitle:"Search from thousands of verified PG and Hostel properties across India",backgroundImage:"/pghostel.jpg",defaultPropertyType:"PG / Hostel"}),(0,s.jsx)("div",{className:"buyer-filtered-header",children:(0,s.jsxs)("div",{className:"buyer-filtered-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:o?"PG & Hostel Properties and Properties for Bachelors in ".concat(o):"All PG & Hostel Properties and Properties for Bachelors"}),(0,s.jsxs)("p",{className:"buyer-filtered-count",children:[a.length," ",1===a.length?"property":"properties"," found"]})]}),(0,s.jsxs)("button",{className:"buyer-view-all-btn",onClick:e=>{e.preventDefault(),e.stopPropagation(),r("/buyer-dashboard/search?propertyType=pg")},"aria-label":"View all PG and hostel properties",children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})]})]})}),c?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading properties..."})}):a.length>0?(0,s.jsx)("div",{className:"buyer-filtered-properties-grid",children:a.map(e=>(0,s.jsx)(S,{property:e},e.id))}):(0,s.jsxs)("div",{className:"buyer-no-properties",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z"}),(0,s.jsx)("path",{d:"M14 2v4a2 2 0 0 0 2 2h4"}),(0,s.jsx)("path",{d:"M10 9H8"}),(0,s.jsx)("path",{d:"M16 13H8"}),(0,s.jsx)("path",{d:"M16 17H8"})]}),(0,s.jsx)("h2",{children:"No Properties Found"}),(0,s.jsx)("p",{children:o?"We couldn't find any PG/Hostel properties or properties available for bachelors in ".concat(o," at the moment."):"No PG/Hostel properties or properties available for bachelors found."})]})]})},nt=()=>{const[t]=(0,n.ok)(),r=(0,n.Zp)(),o=t.get("city"),[a,l]=(0,e.useState)([]),[c,u]=(0,e.useState)(!0);(0,e.useEffect)(()=>{window.scrollTo({top:0,left:0,behavior:"auto"})},[]);const[d,h]=(0,e.useState)({location:"",propertyType:"",budget:"",bedrooms:""}),m=e=>{const{name:t,value:r}=e.target;h(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r}))};return(0,e.useEffect)(()=>{(async()=>{try{u(!0);const e={limit:100};o&&(e.location=o);const t=await i.propertiesAPI.list(e);if(t.success&&t.data&&t.data.properties){const e=t.data.properties.map(e=>{let t=e.cover_image||(Array.isArray(e.images)&&e.images.length>0?e.images[0]:null)||"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500";return{id:e.id,image:t,title:e.title,price:parseFloat(e.price),location:e.location,bedrooms:e.bedrooms||"0",bathrooms:e.bathrooms||"0",area:parseFloat(e.area),type:e.property_type,status:"sale"===e.status?"For Sale":"rent"===e.status?"For Rent":e.status}});l(e)}else l([])}catch(e){console.error("Error fetching properties:",e),l([])}finally{u(!1)}})()},[o]),(0,s.jsxs)("div",{className:"buyer-filtered-properties-page",children:[(0,s.jsx)("div",{className:"buyer-search-bar-container",children:(0,s.jsxs)("div",{className:"buyer-search-bar-wrapper",children:[(0,s.jsx)("button",{onClick:()=>{r("/")},className:"buyer-search-back-button",children:(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("path",{d:"M19 12H5"}),(0,s.jsx)("path",{d:"M12 19l-7-7 7-7"})]})}),(0,s.jsx)("h2",{className:"buyer-search-title",children:"Find Your Dream Property"}),(0,s.jsx)("p",{className:"buyer-search-subtitle",children:"Search from thousands of verified properties across India"}),(0,s.jsxs)("form",{className:"buyer-search-form",onSubmit:e=>{e.preventDefault();const t=new URLSearchParams;d.location&&t.append("location",d.location),d.propertyType&&t.append("type",d.propertyType),d.budget&&t.append("budget",d.budget),d.bedrooms&&t.append("bedrooms",d.bedrooms),r("/searchresults?".concat(t.toString()))},children:[(0,s.jsxs)("div",{className:"buyer-search-inputs",children:[(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"location",className:"buyer-search-label",children:[(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:[(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z"}),(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M15 11a3 3 0 11-6 0 3 3 0 016 0z"})]}),"Location"]}),(0,s.jsx)(_,{placeholder:"City / Locality",value:d.location,onChange:e=>{h(e?t=>(0,p.A)((0,p.A)({},t),{},{location:e.fullAddress||e.placeName||""}):e=>(0,p.A)((0,p.A)({},e),{},{location:""}))}})]}),(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"propertyType",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Property Type"]}),(0,s.jsxs)("select",{id:"propertyType",name:"propertyType",value:d.propertyType,onChange:m,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"All Types"}),["Apartment","Villa","Plot","Commercial","PG / Hostel","Independent House","Row House","Bungalow","Studio Apartment","Penthouse","Farm House","Industrial N/A Land ","Plot / Land","Commercial Office","Commercial Shop","Retail Space","Co-working Space","Warehouse / Godown","Industrial Property","Hotel / Guest House"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"budget",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M12 8c-1.657 0-3 .895-3 2s1.343 2 3 2 3 .895 3 2-1.343 2-3 2m0-8c1.11 0 2.08.402 2.599 1M12 8V7m0 1v8m0 0v1m0-1c-1.11 0-2.08-.402-2.599-1M21 12a9 9 0 11-18 0 9 9 0 0118 0z"})}),"Budget"]}),(0,s.jsxs)("select",{id:"budget",name:"budget",value:d.budget,onChange:m,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any Budget"}),["0-25L","25L-50L","50L-75L","75L-1Cr","1Cr-2Cr","2Cr+"].map(e=>(0,s.jsx)("option",{value:e,children:e},e))]})]}),(0,s.jsxs)("div",{className:"buyer-search-field",children:[(0,s.jsxs)("label",{htmlFor:"bedrooms",className:"buyer-search-label",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})}),"Bedrooms"]}),(0,s.jsxs)("select",{id:"bedrooms",name:"bedrooms",value:d.bedrooms,onChange:m,className:"buyer-search-select",children:[(0,s.jsx)("option",{value:"",children:"Any"}),["1","2","3","4","5+"].map(e=>(0,s.jsxs)("option",{value:e,children:[e," BHK"]},e))]})]})]}),(0,s.jsxs)("button",{type:"submit",className:"buyer-search-button",children:[(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",children:(0,s.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:"2",d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"})}),(0,s.jsx)("span",{children:"Search Properties"})]})]}),(0,s.jsxs)("div",{className:"buyer-quick-search",children:[(0,s.jsx)("span",{className:"buyer-quick-search-label",children:"Popular Cities:"}),(0,s.jsx)("div",{className:"buyer-quick-search-buttons",children:["Mumbai","Delhi","Bangalore","Hyderabad","Ahmedabad","Chennai","Kolkata","Pune","Jaipur","Surat"].map(e=>(0,s.jsx)("button",{type:"button",onClick:()=>(e=>{r("/searchresults?location=".concat(e))})(e),className:"buyer-quick-search-btn",children:e},e))})]})]})}),(0,s.jsxs)("div",{className:"buyer-filtered-header",children:[(0,s.jsx)("h1",{children:o?"Residential Projects in ".concat(o):"All Residential Projects"}),(0,s.jsxs)("p",{className:"buyer-filtered-count",children:[a.length," ",1===a.length?"project":"projects"," found"]})]}),c?(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading properties..."})}):a.length>0?(0,s.jsx)("div",{className:"buyer-filtered-properties-grid",children:a.map(e=>(0,s.jsx)(S,{property:e},e.id))}):(0,s.jsxs)("div",{className:"buyer-no-properties",children:[(0,s.jsxs)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"7",height:"7"}),(0,s.jsx)("rect",{x:"14",y:"3",width:"7",height:"7"}),(0,s.jsx)("rect",{x:"14",y:"14",width:"7",height:"7"}),(0,s.jsx)("rect",{x:"3",y:"14",width:"7",height:"7"})]}),(0,s.jsx)("h2",{children:"No Projects Found"}),(0,s.jsx)("p",{children:o?"We couldn't find any residential projects in ".concat(o," at the moment."):"No projects available."})]})]})},it=e=>{let{isOpen:t,onClose:r,propertyOwners:n=[],selectedOwner:i,onOwnerSelect:o,loading:a=!1}=e;const l=(Array.isArray(n)?n:[]).filter(e=>e&&e.id),c=e=>{o&&e&&o(e)};return(0,s.jsxs)("div",{className:"mychatbox-sidebar ".concat(t?"open":""),children:[(0,s.jsxs)("div",{className:"mychatbox-sidebar-header",children:[(0,s.jsx)("h2",{children:"Conversations"}),(0,s.jsx)("button",{className:"mychatbox-sidebar-close-btn",onClick:r,"aria-label":"Close sidebar",type:"button",children:"\xd7"})]}),(0,s.jsx)("div",{className:"mychatbox-owners-list",children:a?(0,s.jsx)("div",{className:"mychatbox-loading",children:"Loading conversations..."}):0===l.length?(0,s.jsx)("div",{className:"mychatbox-empty",children:"No conversations yet"}):l.map(e=>{const t=(e=>e&&(e.profileImage||e.avatar||e.profile_photo||e.image_url||e.image)||null)(e),r=(e=>{if(!e)return"U";const t=e.name||e.full_name||"";return t.trim()&&t.trim().split(" ").filter(Boolean).slice(0,2).map(e=>e[0].toUpperCase()).join("")||"U"})(e);return(0,s.jsxs)("div",{className:"mychatbox-owner-card ".concat((null===i||void 0===i?void 0:i.id)===e.id?"active":""),onClick:()=>c(e),role:"button",tabIndex:0,onKeyDown:t=>{"Enter"!==t.key&&" "!==t.key||(t.preventDefault(),c(e))},children:[(0,s.jsxs)("div",{className:"mychatbox-owner-avatar",children:[(0,s.jsx)("div",{className:"mychatbox-owner-avatar-initials",children:r}),t&&(0,s.jsx)("img",{src:t,alt:e.name||"Owner",onError:e=>{e.target.style.display="none"}})]}),(0,s.jsxs)("div",{className:"mychatbox-owner-info",children:[(0,s.jsxs)("div",{className:"mychatbox-owner-header",children:[(0,s.jsx)("h3",{children:e.name||"Unknown"}),(0,s.jsx)("span",{className:"mychatbox-message-time",children:e.lastMessageTime||""})]}),(0,s.jsxs)("div",{className:"mychatbox-property-info",children:[(0,s.jsx)("p",{className:"mychatbox-property-title",children:e.propertyTitle||"Property"}),e.location&&(0,s.jsxs)("p",{className:"mychatbox-property-location",children:[(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M12 2C8.13 2 5 5.13 5 9c0 5.25 7 13 7 13s7-7.75 7-13c0-3.87-3.13-7-7-7zm0 9.5c-1.38 0-2.5-1.12-2.5-2.5s1.12-2.5 2.5-2.5 2.5 1.12 2.5 2.5-1.12 2.5-2.5 2.5z"})}),e.location]})]}),(0,s.jsxs)("div",{className:"mychatbox-owner-footer",children:[(0,s.jsx)("p",{className:"mychatbox-last-message",children:e.lastMessage||""}),e.unread>0&&(0,s.jsx)("span",{className:"mychatbox-unread-badge",children:e.unread})]})]})]},e.id)})})]})},st=t=>{let{selectedOwner:r,onToggleSidebar:n,onHeaderClick:i}=t;const o=(0,e.useMemo)(()=>r&&(r.profileImage||r.avatar||r.profile_photo||r.image_url||r.image)||null,[r]),a=()=>{i&&r&&i()};return(0,s.jsxs)("div",{className:"mychatbox-chat-header",children:[(0,s.jsx)("button",{className:"mychatbox-sidebar-toggle-btn",onClick:()=>{n&&n()},"aria-label":"Toggle sidebar",type:"button",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",width:"24",height:"24",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"})})}),(0,s.jsxs)("div",{className:"mychatbox-chat-header-content",onClick:a,role:r?"button":void 0,tabIndex:r?0:-1,onKeyDown:e=>{r&&("Enter"!==e.key&&" "!==e.key||(e.preventDefault(),a()))},children:[(0,s.jsx)("div",{className:"mychatbox-chat-header-avatar",children:o?(0,s.jsx)("img",{src:o,alt:(null===r||void 0===r?void 0:r.name)||"Owner",onError:e=>{e.target.style.display="none"}}):(0,s.jsx)("svg",{width:"26",height:"26",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor",strokeWidth:"2"})})}),(0,s.jsxs)("div",{className:"mychatbox-chat-header-info",children:[(0,s.jsx)("h1",{children:(null===r||void 0===r?void 0:r.name)||"Select a conversation"}),(null===r||void 0===r?void 0:r.propertyTitle)&&(0,s.jsx)("p",{className:"mychatbox-chat-header-subtitle",children:r.propertyTitle})]})]})]})},ot=t=>{let{messages:r,isTyping:n,selectedOwner:i}=t;const o=(0,e.useRef)(null),a=(0,e.useRef)(null);(0,e.useEffect)(()=>{a.current&&requestAnimationFrame(()=>{a.current&&(a.current.scrollTop=a.current.scrollHeight)})},[r,n,i]);const l=Array.isArray(r)?r:[];return(0,s.jsx)("div",{className:"mychatbox-chat-messages",ref:a,children:(0,s.jsxs)("div",{className:"mychatbox-chat-messages-container",children:[i?0===l.length?(0,s.jsx)("div",{className:"mychatbox-no-messages",children:"No messages yet. Start the conversation!"}):l.map(e=>(0,s.jsx)("div",{className:"mychatbox-message ".concat("user"===e.sender?"mychatbox-message-user":"mychatbox-message-owner"),children:(0,s.jsxs)("div",{className:"mychatbox-message-content",children:[(0,s.jsx)("p",{children:e.text||""}),(0,s.jsx)("span",{className:"mychatbox-message-timestamp",children:e.timestamp||""})]})},e.id||"msg-".concat(Math.random()))):(0,s.jsx)("div",{className:"mychatbox-no-selection",children:"Select a conversation to start chatting"}),n&&(0,s.jsx)("div",{className:"mychatbox-message mychatbox-message-owner",children:(0,s.jsxs)("div",{className:"mychatbox-message-content mychatbox-typing-indicator",children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{}),(0,s.jsx)("span",{})]})}),(0,s.jsx)("div",{ref:o})]})})},at=e=>{let{inputMessage:t="",onInputChange:r,onSendMessage:n,quickReplies:i=[],showQuickReplies:o=!1,onQuickReply:a}=e;const l=Array.isArray(i)?i:[],c=t||"";return(0,s.jsxs)(s.Fragment,{children:[o&&l.length>0&&(0,s.jsxs)("div",{className:"mychatbox-quick-replies",children:[(0,s.jsx)("p",{className:"mychatbox-quick-replies-label",children:"Quick replies:"}),(0,s.jsx)("div",{className:"mychatbox-quick-replies-buttons",children:l.map((e,t)=>(0,s.jsx)("button",{className:"mychatbox-quick-reply-btn",onClick:()=>(e=>{a&&e&&a(e)})(e),type:"button",children:e},t))})]}),(0,s.jsx)("div",{className:"mychatbox-chat-input-wrapper",children:(0,s.jsxs)("form",{onSubmit:e=>{e.preventDefault();""!==(t||"").trim()&&n&&n(e)},className:"mychatbox-chat-input-form",children:[(0,s.jsx)("input",{type:"text",value:c,onChange:e=>r&&r(e.target.value),placeholder:"Type your message here...",className:"mychatbox-chat-input"}),(0,s.jsx)("button",{type:"submit",className:"mychatbox-chat-send-btn",disabled:""===c.trim(),"aria-label":"Send message",children:(0,s.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",children:(0,s.jsx)("path",{d:"M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"})})})]})})]})},lt=e=>{let{isSidebarOpen:t,onToggleSidebar:r,onCloseSidebar:n,propertyOwners:i,selectedOwner:o,onOwnerSelect:a,loading:l,messages:c,isTyping:u,inputMessage:d,onInputChange:h,onSendMessage:p,quickReplies:m,showQuickReplies:f,onQuickReply:g,onHeaderClick:y}=e;return(0,s.jsx)("div",{className:"mychatbox-container",children:(0,s.jsxs)("div",{className:"mychatbox-wrapper",children:[(0,s.jsx)(it,{isOpen:t,onClose:n,propertyOwners:i,selectedOwner:o,onOwnerSelect:a,loading:l}),(0,s.jsxs)("div",{className:"mychatbox-chat-main",children:[(0,s.jsx)(st,{selectedOwner:o,onToggleSidebar:r,onHeaderClick:y}),(0,s.jsx)(ot,{messages:c,isTyping:u,selectedOwner:o}),(0,s.jsx)(at,{inputMessage:d,onInputChange:h,onSendMessage:p,quickReplies:m,showQuickReplies:f,onQuickReply:g})]})]})})},ct=e=>{let{isOpen:t,onClose:r}=e;const i=(0,n.Zp)();return t?(0,s.jsx)("div",{className:"buyer-chatus-overlay",onClick:r,children:(0,s.jsxs)("div",{className:"buyer-chatus-overlay-content",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{className:"buyer-chatus-overlay-close",onClick:r,"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"buyer-chatus-overlay-header",children:[(0,s.jsx)("div",{className:"buyer-chatus-overlay-icon",children:(0,s.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("h2",{className:"buyer-chatus-overlay-title",children:"Start Chatting with Property Owners"}),(0,s.jsx)("p",{className:"buyer-chatus-overlay-subtitle",children:"Sign up to connect with sellers and agents, ask questions about properties, and get instant responses"})]}),(0,s.jsxs)("div",{className:"buyer-chatus-overlay-features",children:[(0,s.jsxs)("div",{className:"buyer-chatus-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Chat directly with property owners"})]}),(0,s.jsxs)("div",{className:"buyer-chatus-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Get instant answers to your questions"})]}),(0,s.jsxs)("div",{className:"buyer-chatus-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Schedule property visits and negotiations"})]}),(0,s.jsxs)("div",{className:"buyer-chatus-feature",children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2.5",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Save your conversation history"})]})]}),(0,s.jsxs)("div",{className:"buyer-chatus-overlay-actions",children:[(0,s.jsxs)("button",{className:"buyer-chatus-signup-btn",onClick:()=>{r(),i("/register")},children:[(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),"Sign Up Now"]}),(0,s.jsx)("button",{className:"buyer-chatus-cancel-btn",onClick:r,children:"Maybe Later"})]})]})}):null},ut=()=>{const{user:t}=l(),o=(0,n.Zp)(),[a]=(0,n.ok)(),c=a.get("chatId"),u=a.get("ownerName"),d=a.get("propertyId"),[h,m]=(0,e.useState)([]),[f,g]=(0,e.useState)(null),[y,_]=(0,e.useState)(null),[v,x]=(0,e.useState)(!1),[b,w]=(0,e.useState)(!0),[j,S]=(0,e.useState)(!1),[T,k]=(0,e.useState)([]),[A,C]=(0,e.useState)({}),[E,N]=(0,e.useState)({}),[I,P]=(0,e.useState)(""),[L,R]=(0,e.useState)(!1),D=(0,e.useRef)(null),F=(0,e.useRef)({}),[O,z]=(0,e.useState)({}),B=e=>{if(!e)return"Just now";const t=new Date,r=e instanceof Date?e:new Date(e),n=t-r,i=Math.floor(n/6e4),s=Math.floor(n/36e5),o=Math.floor(n/864e5);return i<1?"Just now":i<60?"".concat(i,"m ago"):s<24?"".concat(s,"h ago"):o<7?"".concat(o,"d ago"):r.toLocaleDateString("en-IN",{day:"numeric",month:"short"})};(0,e.useEffect)(()=>{(async()=>{if(t&&"buyer"===t.user_type)try{w(!0);const b=await(0,M.ix)(t.id);if(c&&!b.find(e=>e.id===c))try{const e=await(0,M.getChatRoomDetails)(c);e&&b.push(e)}catch(x){console.error("Error fetching chat room details from URL:",x)}const j=(await Promise.all(b.map(async e=>{try{var t,r,n,s,o,a,l,c,u,d,h,m,f,g,y,_,v,b,w,j,S;let x,P,M=O[e.propertyId];if(!M){var T;const t=await i.propertiesAPI.getDetails(e.propertyId);t.success&&null!==(T=t.data)&&void 0!==T&&T.property&&(M=t.data.property,z(t=>(0,p.A)((0,p.A)({},t),{},{[e.propertyId]:M})))}var k,A,C,E,N,I;if("agent"===((null===(t=M)||void 0===t?void 0:t.user_type)||(null===(r=M)||void 0===r||null===(n=r.seller)||void 0===n?void 0:n.user_type)))x=(null===(k=M)||void 0===k?void 0:k.user_id)||(null===(A=M)||void 0===A||null===(C=A.seller)||void 0===C?void 0:C.id),P="agent";else x=(null===(E=M)||void 0===E?void 0:E.user_id)||(null===(N=M)||void 0===N||null===(I=N.seller)||void 0===I?void 0:I.id),P="seller";return x?{id:e.id,chatRoomId:e.id,receiverId:x,receiverRole:P,propertyId:e.propertyId,name:(null===(s=M)||void 0===s||null===(o=s.seller)||void 0===o?void 0:o.name)||(null===(a=M)||void 0===a||null===(l=a.seller)||void 0===l?void 0:l.full_name)||"Property Owner",propertyTitle:(null===(c=M)||void 0===c?void 0:c.title)||"Property",propertyType:(null===(u=M)||void 0===u?void 0:u.property_type)||"",location:(null===(d=M)||void 0===d?void 0:d.location)||"",price:null!==(h=M)&&void 0!==h&&h.price?"\u20b9".concat(parseFloat(M.price).toLocaleString("en-IN")).concat("rent"===M.status?"/Month":""):"",image:(null===(m=M)||void 0===m||null===(f=m.seller)||void 0===f?void 0:f.profile_image)||(null===(g=M)||void 0===g?void 0:g.cover_image)||"https://via.placeholder.com/60",lastMessage:e.lastMessage||"",lastMessageTime:B(e.updatedAt),unread:0,status:"offline",ownerMemberSince:(null===(y=M)||void 0===y||null===(_=y.seller)||void 0===_?void 0:_.created_at)||(null===(v=M)||void 0===v?void 0:v.created_at)||null,ownerEmail:(null===(b=M)||void 0===b||null===(w=b.seller)||void 0===w?void 0:w.email)||"",ownerPhone:(null===(j=M)||void 0===j||null===(S=j.seller)||void 0===S?void 0:S.phone)||""}:(console.error("Cannot determine receiver from property data:",M),null)}catch(x){return console.error("Error loading property for chat room:",x),null}}))).filter(e=>null!==e&&e.id);if(m(j),c){const t=j.find(e=>e.chatRoomId===c);if(t)console.log("\u2705 Found chat room from URL:",c),g(t),_(t.chatRoomId);else{console.log("\u26a0\ufe0f Chat room from URL not in list, fetching details...",c),_(c);let t=null;const p=d||null;u&&(t={id:c,chatRoomId:c,receiverId:null,receiverRole:"seller",propertyId:p,name:decodeURIComponent(u),propertyTitle:"Property",propertyType:"",location:"",price:"",image:"https://via.placeholder.com/60",lastMessage:"",lastMessageTime:"Just now",unread:0,status:"offline",ownerEmail:"",ownerPhone:""},g(t),m(e=>e.find(e=>e.chatRoomId===c)?e:[t,...e]));try{const d=await(0,M.getChatRoomDetails)(c);if(d){const f=d.propertyId||p;if(f){var e;const p=await i.propertiesAPI.getDetails(f);if(p.success&&null!==(e=p.data)&&void 0!==e&&e.property){var r,n,s,o,a,l,h;const e=p.data.property;let t,i;var y,v;if("agent"===(e.user_type||(null===(r=e.seller)||void 0===r?void 0:r.user_type)))t=e.user_id||(null===(y=e.seller)||void 0===y?void 0:y.id),i="agent";else t=e.user_id||(null===(v=e.seller)||void 0===v?void 0:v.id),i="seller";if(!t)return void console.error("Cannot determine receiver from property data:",e);const f={id:d.id,chatRoomId:d.id,receiverId:t,receiverRole:i,propertyId:d.propertyId,name:(null===e||void 0===e||null===(n=e.seller)||void 0===n?void 0:n.name)||(null===e||void 0===e||null===(s=e.seller)||void 0===s?void 0:s.full_name)||u||"Property Owner",propertyTitle:(null===e||void 0===e?void 0:e.title)||"Property",propertyType:(null===e||void 0===e?void 0:e.property_type)||"",location:(null===e||void 0===e?void 0:e.location)||"",price:null!==e&&void 0!==e&&e.price?"\u20b9".concat(parseFloat(e.price).toLocaleString("en-IN")).concat("rent"===e.status?"/Month":""):"",image:(null===e||void 0===e||null===(o=e.seller)||void 0===o?void 0:o.profile_image)||(null===e||void 0===e?void 0:e.cover_image)||"https://via.placeholder.com/60",lastMessage:d.lastMessage||"",lastMessageTime:B(d.updatedAt),unread:0,status:"offline",ownerMemberSince:(null===e||void 0===e||null===(a=e.seller)||void 0===a?void 0:a.created_at)||(null===e||void 0===e?void 0:e.created_at)||null,ownerEmail:(null===e||void 0===e||null===(l=e.seller)||void 0===l?void 0:l.email)||"",ownerPhone:(null===e||void 0===e||null===(h=e.seller)||void 0===h?void 0:h.phone)||""};g(f),_(c),m(e=>e.find(e=>e.chatRoomId===c)?e.map(e=>e.chatRoomId===c?f:e):[f,...e])}else t&&(t.receiverId=d.receiverId,t.receiverRole=d.receiverRole||"seller",t.propertyId=d.propertyId,t.lastMessage=d.lastMessage||"",t.lastMessageTime=B(d.updatedAt),g(t),m(e=>e.find(e=>e.chatRoomId===c)?e.map(e=>e.chatRoomId===c?t:e):[t,...e]))}else t&&(t.receiverId=d.receiverId,t.receiverRole=d.receiverRole||"seller",t.propertyId=d.propertyId,t.lastMessage=d.lastMessage||"",t.lastMessageTime=B(d.updatedAt),g(t),m(e=>e.find(e=>e.chatRoomId===c)?e.map(e=>e.chatRoomId===c?t:e):[t,...e]))}else t&&console.log("Chat room not found in Firebase yet, using temp owner from URL")}catch(x){if(console.error("Error fetching chat room details from URL:",x),!t&&u){const e={id:c,chatRoomId:c,receiverId:null,receiverRole:null,propertyId:p,name:decodeURIComponent(u),propertyTitle:"Property",propertyType:"",location:"",price:"",image:"https://via.placeholder.com/60",lastMessage:"",lastMessageTime:"Just now",unread:0,status:"offline",ownerEmail:"",ownerPhone:""};g(e)}}}}else j.length>0&&!f&&(g(j[0]),_(j[0].chatRoomId))}catch(x){console.error("Error loading chat rooms:",x)}finally{w(!1)}else w(!1)})()},[t,c]),(0,e.useEffect)(()=>{if(!t||"buyer"!==t.user_type||0===h.length)return;(async()=>{const e={};for(const i of h)if(i.chatRoomId)try{var r;const n=await(0,M.getChatRoomDetails)(i.chatRoomId);null!==n&&void 0!==n&&null!==(r=n.lastReadAt)&&void 0!==r&&r[String(t.id)]&&(e[i.chatRoomId]=n.lastReadAt[String(t.id)])}catch(n){console.warn("Failed to load lastReadAt for chat room ".concat(i.chatRoomId,":"),n)}N(t=>(0,p.A)((0,p.A)({},t),e))})()},[t,h]);const U=(0,e.useMemo)(()=>{if(!t)return 0;let e=0;return Object.keys(A).forEach(t=>{const r=A[t]||[];if(!Array.isArray(r)||0===r.length)return;if(y===t)return;const n=E[t];if(n){const t=n.toDate?n.toDate():new Date(n),i=r.filter(e=>{if("owner"!==e.sender)return!1;return new Date(e.timestamp)>t}).length;e+=i}else{const t=r.filter(e=>"owner"===e.sender);e+=t.length}}),e},[A,E,y,t]);(0,e.useEffect)(()=>{const e=new CustomEvent("buyerUnreadCountChange",{detail:U});window.dispatchEvent(e)},[U]),(0,e.useEffect)(()=>{if(t&&"buyer"===t.user_type&&0!==h.length)return h.forEach(e=>{const r=e.chatRoomId;if(!r)return;if(F.current[r])return;const n=(0,M.dP)(r,(e,n)=>{if(n)return void console.error("Error in buyer chat listener for room:",r,n);if(!e||!Array.isArray(e))return void console.error("Invalid messages received for room:",r);const i=e.map(e=>{let n;return n=e.timestamp instanceof Date?e.timestamp:e.timestamp?new Date(e.timestamp):new Date,{id:e.id||"".concat(r,"-").concat(n.getTime(),"-").concat(Math.random()),text:e.text||"",sender:e.senderId===String(t.id)?"user":"owner",timestamp:n.toISOString()}});C(e=>(0,p.A)((0,p.A)({},e),{},{[r]:i}))});F.current[r]=n}),()=>{Object.keys(F.current).forEach(e=>{h.find(t=>t.chatRoomId===e)||F.current[e]&&(F.current[e](),delete F.current[e])})}},[t,h]),(0,e.useEffect)(()=>{if(y&&t){const e=A[y]||[];if(Array.isArray(e)&&e.length>0){const e=new Date;N(t=>(0,p.A)((0,p.A)({},t),{},{[y]:e})),(0,M.uF)(y,t.id).catch(e=>{console.warn("Failed to update Firebase lastReadAt:",e)})}}},[y,A,t]),(0,e.useEffect)(()=>{if(!t||"buyer"!==t.user_type)return;const e=setInterval(async()=>{try{const e=await(0,M.ix)(t.id);m(t=>t.map(t=>{const r=e.find(e=>e.id===t.chatRoomId);return r?(0,p.A)((0,p.A)({},t),{},{lastMessage:r.lastMessage||t.lastMessage,lastMessageTime:B(r.updatedAt)}):t}))}catch(e){console.error("Error refreshing chat rooms:",e)}},1e4);return()=>clearInterval(e)},[t]),(0,e.useEffect)(()=>(window.scrollTo(0,0),document.body.style.overflow="hidden",document.documentElement.style.overflow="hidden",()=>{document.body.style.overflow="",document.documentElement.style.overflow="",D.current&&D.current()}),[]);(0,e.useEffect)(()=>{const e=y||c;if(e&&t)return console.log("Setting up message listener for chat room:",e),D.current&&(D.current(),D.current=null),D.current=(0,M.dP)(e,(r,n)=>{if(n)return void console.error("Error in message listener:",n);if(!r||!Array.isArray(r))return void console.error("Invalid messages received");console.log("Received messages:",r.length);const i=r.map((r,n)=>{let i="Just now";if(r.timestamp)try{i=(r.timestamp instanceof Date?r.timestamp:new Date(r.timestamp)).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}catch(s){console.error("Error parsing timestamp:",s)}return{id:r.id||"".concat(e,"-").concat(n,"-").concat(Date.now()),text:r.text||"",sender:r.senderId===String(t.id)?"user":"owner",timestamp:i}});if(k(i),r.length>0){const t=r[r.length-1],n=t.text||"";let i=new Date;t.timestamp&&(i=t.timestamp instanceof Date?t.timestamp:new Date(t.timestamp)),m(t=>{const r=t.map(t=>t.chatRoomId===e?(0,p.A)((0,p.A)({},t),{},{lastMessage:n,lastMessageTime:B(i)}):t);return!r.find(t=>t.chatRoomId===e)&&f&&r.unshift((0,p.A)((0,p.A)({},f),{},{lastMessage:n,lastMessageTime:B(i)})),r})}}),()=>{D.current&&(D.current(),D.current=null)};console.log("Message listener skipped:",{selectedChatRoomId:y,chatIdFromUrl:c,hasUser:!!t})},[y,c,t,f]);const V=async e=>{if(!e||!e.trim()||!t)return void console.error("Cannot send message - missing data:",{user:!!t,message:null===e||void 0===e?void 0:e.trim()});const n=e.trim();try{let e,u,h;if(f&&f.receiverId&&f.propertyId)e=f.receiverId,u=f.receiverRole,h=f.propertyId;else{if(!d)throw new Error("Property information is missing. Cannot determine receiver.");{var s,o;const t=await i.propertiesAPI.getDetails(d);if(!t.success||null===(s=t.data)||void 0===s||!s.property)throw new Error("Property not found");const r=t.data.property;var a,l;if("agent"===(r.user_type||(null===(o=r.seller)||void 0===o?void 0:o.user_type)))e=r.user_id||(null===(a=r.seller)||void 0===a?void 0:a.id),u="agent";else e=r.user_id||(null===(l=r.seller)||void 0===l?void 0:l.id),u="seller";if(!e)throw new Error("Could not determine receiver from property data. Property owner user_type is required.");h=d}}const{generateChatRoomId:y,createOrGetChatRoom:v,getChatRoomDetails:x}=await Promise.resolve().then(r.bind(r,935)),b=y(t.id,e,h);let w=!1;try{w=!await x(b)}catch(c){w=!0}if(w)try{console.log("\ud83d\udcde First message - Validating chat room setup via backend API...");const t=await i.h2.createRoom(e,h);t.success&&console.log("\u2705 Chat room validated successfully:",t.data)}catch(c){console.warn("\u26a0\ufe0f Failed to validate chat room via backend API, continuing with Firebase chat room creation:",c)}const j=await v(t.id,e,u,h);_(j),f&&g((0,p.A)((0,p.A)({},f),{},{chatRoomId:j,receiverId:e,receiverRole:u,propertyId:h})),await(0,M._z)(j,t.id,t.user_type,n),console.log("\u2705 Message sent successfully");const S=new Date;m(e=>{const t=e.map(e=>e.chatRoomId===j?(0,p.A)((0,p.A)({},e),{},{lastMessage:n,lastMessageTime:B(S)}):e);if(!t.find(e=>e.chatRoomId===j)&&f){const e=(0,p.A)((0,p.A)({},f),{},{chatRoomId:j,lastMessage:n,lastMessageTime:B(S)});t.unshift(e)}return t})}catch(c){console.error("Error sending message:",c);const e=c.message||"Failed to send message. Please try again.";throw alert(e),c}},q=!!t;return(0,s.jsxs)("div",{className:"buyer-chatus-page",children:[(0,s.jsx)("div",{className:"buyer-chatus-wrapper ".concat(q?"":"buyer-chatus-blurred"),children:(0,s.jsx)(lt,{isSidebarOpen:v,onToggleSidebar:()=>x(!v),onCloseSidebar:()=>x(!1),propertyOwners:h,selectedOwner:f,onOwnerSelect:e=>{g(e),_(e.chatRoomId),x(!1),k([]),S(!1)},loading:b,messages:T,isTyping:L,inputMessage:I,onInputChange:e=>P(e),onSendMessage:async e=>{if(e.preventDefault(),""===I.trim()||!t)return void console.error("Cannot send message - missing data:",{user:!!t,message:I.trim()});const r=I.trim();P("");try{await V(r)}catch(n){P(r)}},quickReplies:["When can I visit?","Is it still available?","Tell me about amenities","Can we negotiate price?","How do we proceed further?","I need more information"],showQuickReplies:T.length<=3,onQuickReply:async e=>{if(e&&e.trim())try{await V(e.trim())}catch(t){console.error("Error sending quick reply:",t)}},onHeaderClick:()=>{f&&S(!0)}})}),!q&&(0,s.jsx)("div",{className:"buyer-chatus-blur-overlay"}),!q&&(0,s.jsx)(ct,{isOpen:!0,onClose:()=>o("/BuyerHome")}),q&&j&&f&&(0,s.jsx)("div",{className:"buyer-chatus-profile-overlay",onClick:()=>S(!1),children:(0,s.jsxs)("div",{className:"buyer-chatus-profile-card",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("button",{type:"button",className:"buyer-chatus-profile-close","aria-label":"Close owner profile",onClick:()=>S(!1),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"buyer-chatus-profile-header",children:[(0,s.jsx)("div",{className:"buyer-chatus-profile-avatar",children:(0,s.jsx)("img",{src:f.image&&""!==f.image.trim()?f.image:"https://ui-avatars.com/api/?name=".concat(encodeURIComponent(f.name||"Owner"),"&background=886ace&color=fff&size=200"),alt:f.name||"Owner",onError:e=>{const t="https://ui-avatars.com/api/?name=".concat(encodeURIComponent(f.name||"Owner"),"&background=886ace&color=fff&size=200");e.target.src!==t&&(e.target.src=t)}})}),(0,s.jsxs)("div",{className:"buyer-chatus-profile-title-block",children:[(0,s.jsx)("h2",{children:f.name||"Property Owner"}),(0,s.jsx)("p",{className:"buyer-chatus-profile-role",children:"agent"===f.receiverRole?"Agent":"Seller / Owner"})]})]}),(0,s.jsxs)("div",{className:"buyer-chatus-profile-body",children:[f.ownerEmail&&(0,s.jsxs)("div",{className:"buyer-chatus-profile-row",children:[(0,s.jsx)("span",{className:"buyer-chatus-profile-label",children:"Email"}),(0,s.jsx)("span",{className:"buyer-chatus-profile-value",children:(0,s.jsx)("a",{href:"mailto:".concat(f.ownerEmail),className:"buyer-chatus-profile-link",children:f.ownerEmail})})]}),f.ownerPhone&&(0,s.jsxs)("div",{className:"buyer-chatus-profile-row",children:[(0,s.jsx)("span",{className:"buyer-chatus-profile-label",children:"Phone"}),(0,s.jsx)("span",{className:"buyer-chatus-profile-value",children:(0,s.jsx)("a",{href:"tel:".concat(f.ownerPhone),className:"buyer-chatus-profile-link",children:f.ownerPhone})})]}),(0,s.jsxs)("div",{className:"buyer-chatus-profile-row",children:[(0,s.jsx)("span",{className:"buyer-chatus-profile-label",children:"Member since"}),(0,s.jsx)("span",{className:"buyer-chatus-profile-value",children:(e=>{if(!e)return"Recently";try{const t=new Date(e);if(Number.isNaN(t.getTime()))return"Recently";const r=t.toLocaleDateString("en-IN",{month:"long"}),n=t.getFullYear();return"".concat(r," ").concat(n)}catch(t){return"Recently"}})(f.ownerMemberSince)})]})]})]})})]})},dt=()=>{const[t,r]=(0,e.useState)([]),[i,o]=(0,e.useState)({}),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)(!1);(0,e.useEffect)(()=>{window.scrollTo(0,0),d()},[]),(0,e.useEffect)(()=>{!a&&!c&&t.length>0&&(h(),u(!0))},[a,t]);const d=async()=>{try{const e=await fetch("".concat(q.JR).concat(q.Sn.PUBLIC_STATS)),t=await e.json();if(t.success&&t.data)if(t.data.stats&&Array.isArray(t.data.stats)){r(t.data.stats);const e={};t.data.stats.forEach(t=>{e[t.key]=0}),o(e)}else{const e=[{key:"properties",value:t.data.total_properties||0,label:"Properties Listed",order:1},{key:"cities",value:t.data.total_cities||0,label:"Cities Covered",order:2},{key:"users",value:t.data.total_users||0,label:"Happy Customers",order:3},{key:"agents",value:t.data.total_agents||0,label:"Verified Agents",order:4}];r(e),o({properties:0,cities:0,users:0,agents:0})}}catch(e){console.error("Error fetching stats:",e),r([])}finally{l(!1)}},h=()=>{const e=2e3/60;t.forEach(t=>{((t,r,n)=>{let i=t;const s=(r-t)/60,a=setInterval(()=>{i+=s,(s>0&&i>=r||s<0&&i<=r)&&(i=r,clearInterval(a)),o(e=>(0,p.A)((0,p.A)({},e),{},{[n]:Math.floor(i)}))},e)})(0,t.value,t.key)})};return(0,s.jsxs)("div",{className:"about-us-page",children:[(0,s.jsxs)("section",{className:"about-hero",style:{backgroundImage:"url(".concat("","/AboutUs.jpg)")},children:[(0,s.jsx)("div",{className:"about-hero-overlay"}),(0,s.jsxs)("div",{className:"about-hero-content",children:[(0,s.jsx)("h1",{className:"about-hero-title",children:"About 360Coordinates"}),(0,s.jsx)("p",{className:"about-hero-subtitle",children:"Your Trusted Partner in Real Estate - Connecting Dreams to Reality"})]})]}),(0,s.jsx)("section",{className:"about-section about-story",children:(0,s.jsxs)("div",{className:"about-container",children:[(0,s.jsxs)("div",{className:"about-section-header",children:[(0,s.jsx)("h2",{className:"about-section-title",children:"Our Story"}),(0,s.jsx)("div",{className:"about-title-underline"})]}),(0,s.jsxs)("div",{className:"about-story-content",children:[(0,s.jsxs)("div",{className:"about-story-text",children:[(0,s.jsx)("p",{className:"about-paragraph",children:"Founded with a vision to revolutionize the real estate industry in India, 360Coordinates emerged as a trusted platform dedicated to simplifying property transactions. We recognized the challenges faced by buyers, sellers, and renters in navigating the complex real estate market and set out to create a seamless, transparent, and user-friendly solution."}),(0,s.jsx)("p",{className:"about-paragraph",children:"Since our inception, we have been committed to providing verified property listings, transparent pricing, and expert support to make real estate transactions simpler, safer, and faster. Our platform serves as a bridge connecting property seekers with their dream homes and commercial spaces across India."}),(0,s.jsx)("p",{className:"about-paragraph",children:"Today, 360Coordinates stands as one of the leading real estate platforms, helping thousands of users find their perfect property match. We continue to innovate and expand our services to serve the evolving needs of the Indian real estate market."})]}),(0,s.jsx)("div",{className:"about-story-image",children:(0,s.jsx)("div",{className:"about-image-placeholder",children:(0,s.jsxs)("svg",{viewBox:"0 0 400 300",fill:"none",xmlns:"http://www.w3.org/2000/svg",children:[(0,s.jsx)("rect",{width:"400",height:"300",fill:"#f3f4f6"}),(0,s.jsx)("path",{d:"M200 100L250 150L200 200L150 150L200 100Z",fill:"#764ba2",opacity:"0.3"}),(0,s.jsx)("circle",{cx:"200",cy:"150",r:"40",fill:"#003B73",opacity:"0.2"})]})})})]})]})}),(0,s.jsx)("section",{className:"about-section about-mission-vision",children:(0,s.jsx)("div",{className:"about-container",children:(0,s.jsxs)("div",{className:"mission-vision-grid",children:[(0,s.jsxs)("div",{className:"mission-vision-card",children:[(0,s.jsx)("div",{className:"mission-vision-icon",children:(0,s.jsx)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:(0,s.jsx)("path",{d:"M12 2L2 7l10 5 10-5-10-5zM2 17l10 5 10-5M2 12l10 5 10-5"})})}),(0,s.jsx)("h3",{className:"mission-vision-title",children:"Our Mission"}),(0,s.jsx)("p",{className:"mission-vision-text",children:"To empower every Indian with seamless access to verified properties, transparent transactions, and expert guidance, making real estate dreams achievable for everyone."})]}),(0,s.jsxs)("div",{className:"mission-vision-card",children:[(0,s.jsx)("div",{className:"mission-vision-icon",children:(0,s.jsxs)("svg",{viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",children:[(0,s.jsx)("path",{d:"M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"}),(0,s.jsx)("polyline",{points:"3.27 6.96 12 12.01 20.73 6.96"}),(0,s.jsx)("line",{x1:"12",y1:"22.08",x2:"12",y2:"12"})]})}),(0,s.jsx)("h3",{className:"mission-vision-title",children:"Our Vision"}),(0,s.jsx)("p",{className:"mission-vision-text",children:"To become India's most trusted and innovative real estate platform, transforming how people buy, sell, and rent properties through technology, transparency, and exceptional service."})]})]})})}),(0,s.jsx)("section",{className:"about-section about-why-choose",children:(0,s.jsxs)("div",{className:"about-container",children:[(0,s.jsxs)("div",{className:"about-section-header",children:[(0,s.jsx)("h2",{className:"about-section-title",children:"Why Choose 360Coordinates?"}),(0,s.jsx)("div",{className:"about-title-underline"})]}),(0,s.jsxs)("div",{className:"why-choose-grid",children:[(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"01"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Verified Listings"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Every property on our platform is verified for authenticity, ensuring you get accurate information and genuine listings."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"02"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Transparent Pricing"}),(0,s.jsx)("p",{className:"why-choose-text",children:"No hidden costs or surprises. We provide clear, upfront pricing information for all properties and services."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"03"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Expert Support"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Our team of real estate experts is always ready to assist you with property search, negotiations, and transaction support."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"04"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Wide Selection"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Browse through thousands of properties across India - from apartments and villas to commercial spaces and plots."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"05"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Advanced Search"}),(0,s.jsx)("p",{className:"why-choose-text",children:"Use our powerful search filters to find properties that match your exact requirements - location, price, size, and more."})]}),(0,s.jsxs)("div",{className:"why-choose-item",children:[(0,s.jsx)("div",{className:"why-choose-number",children:"06"}),(0,s.jsx)("h3",{className:"why-choose-title",children:"Secure Transactions"}),(0,s.jsx)("p",{className:"why-choose-text",children:"We prioritize your security and privacy, ensuring safe and secure property transactions with proper documentation support."})]})]})]})}),(0,s.jsx)("section",{className:"about-section about-stats",children:(0,s.jsxs)("div",{className:"about-container",children:[(0,s.jsxs)("div",{className:"about-section-header",children:[(0,s.jsx)("h2",{className:"about-section-title",children:"Our Achievements"}),(0,s.jsx)("div",{className:"about-title-underline"})]}),(0,s.jsx)("div",{className:"stats-grid",children:a?(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-number",children:"..."}),(0,s.jsx)("div",{className:"stat-label",children:"Loading..."})]}):t.length>0?t.map(e=>{return(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsxs)("div",{className:"stat-number","data-animate":"true",children:[(t=i[e.key]||0,t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")),"+"]}),(0,s.jsx)("div",{className:"stat-label",children:e.label})]},e.key);var t}):(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-number",children:"0+"}),(0,s.jsx)("div",{className:"stat-label",children:"No data available"})]})})]})}),(0,s.jsx)("section",{className:"about-section about-cta",children:(0,s.jsx)("div",{className:"about-container",children:(0,s.jsxs)("div",{className:"cta-content",children:[(0,s.jsx)("h2",{className:"cta-title",children:"Ready to Find Your Dream Property?"}),(0,s.jsx)("p",{className:"cta-subtitle",children:"Join thousands of satisfied customers who found their perfect property through 360Coordinates"}),(0,s.jsxs)("div",{className:"cta-buttons",children:[(0,s.jsx)(n.N_,{to:"/buy",className:"cta-button cta-primary",children:"Start Searching"}),(0,s.jsx)(n.N_,{to:"/BuyerContactPage",className:"cta-button cta-secondary",children:"Contact Us"})]})]})})})]})},ht=()=>((0,e.useEffect)(()=>{window.scrollTo(0,0)},[]),(0,s.jsx)("div",{className:"privacy-container",children:(0,s.jsxs)("div",{className:"privacy-content",children:[(0,s.jsxs)("header",{className:"privacy-header",children:[(0,s.jsx)("h1",{children:"Privacy Policy"}),(0,s.jsx)("p",{className:"last-updated",children:"Last Updated: 26 Nov 2025"})]}),(0,s.jsxs)("div",{className:"privacy-body",children:[(0,s.jsxs)("p",{className:"intro-text",children:["Welcome to ",(0,s.jsx)("strong",{children:"360Coordinates"}),", owned and operated by Mr. Sudhakar Poul & Company, located in Ambegaon BK, Pune, India. By accessing or using our website"," ",(0,s.jsx)("a",{href:"http://www.360coordinates.com",target:"_blank",rel:"noopener noreferrer",children:"www.360coordinates.com"})," ","and services, you agree to this Privacy Policy. Please read it carefully before proceeding."]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"1. Introduction"}),(0,s.jsx)("p",{children:"At 360Coordinates, we are committed to protecting your privacy and ensuring the security of your personal information. This Privacy Policy explains how we collect, use, store, and protect your data when you use our real estate platform. By using our services, you consent to the practices described in this policy."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"2. Information We Collect"}),(0,s.jsx)("p",{children:"We collect various types of information to provide and improve our services:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Personal Information:"})," Name, email address, phone number, postal address"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Property Information:"})," Property details, location, pricing, images, documents"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Account Information:"})," Username, password, profile details"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Financial Information:"})," Payment details for premium services (processed securely)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Technical Information:"})," IP address, browser type, device information, cookies"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Usage Data:"})," Pages visited, search queries, interaction with listings"]})]})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"3. How We Use Your Information"}),(0,s.jsx)("p",{children:"Your personal information is used only for the following purposes:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"To provide and deliver our real estate services"}),(0,s.jsx)("li",{children:"To connect buyers, sellers, homeowners, and real estate agents"}),(0,s.jsx)("li",{children:"To process property listings and inquiries"}),(0,s.jsx)("li",{children:"To communicate with you about services, updates, and support"}),(0,s.jsx)("li",{children:"To improve website functionality and user experience"}),(0,s.jsx)("li",{children:"To send promotional offers and marketing communications (with your consent)"}),(0,s.jsx)("li",{children:"To prevent fraud and ensure platform security"}),(0,s.jsx)("li",{children:"To comply with legal obligations and resolve disputes"})]})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"4. How We Share Your Information"}),(0,s.jsx)("p",{children:"We respect your privacy and do not sell your personal information to third parties. However, we may share your information in the following circumstances:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"With Other Users:"})," Property listings and contact details shared to facilitate transactions"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"With Service Providers:"})," Third-party vendors who help us operate the platform (payment processors, hosting services)"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"With Real Estate Agents:"})," When you request to connect with agents for property services"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Legal Requirements:"})," When required by law, court order, or government regulations"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Business Transfers:"})," In case of merger, acquisition, or sale of company assets"]})]}),(0,s.jsx)("p",{children:"We ensure that all third parties maintain strict confidentiality and security standards."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"5. Data Security"}),(0,s.jsx)("p",{children:"We take data security seriously and implement industry-standard measures to protect your information:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Secure SSL encryption for data transmission"}),(0,s.jsx)("li",{children:"Password-protected user accounts"}),(0,s.jsx)("li",{children:"Regular security audits and updates"}),(0,s.jsx)("li",{children:"Restricted access to personal data by authorized personnel only"}),(0,s.jsx)("li",{children:"Secure payment processing through trusted gateways"})]}),(0,s.jsx)("p",{children:"However, no method of transmission over the internet is 100% secure. While we strive to protect your data, we cannot guarantee absolute security."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"6. Cookies and Tracking Technologies"}),(0,s.jsx)("p",{children:"360Coordinates uses cookies and similar tracking technologies to enhance your browsing experience:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Essential Cookies:"})," Required for website functionality"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Performance Cookies:"})," Help us understand how users interact with the site"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Functional Cookies:"})," Remember your preferences and settings"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Marketing Cookies:"})," Track your activity to display relevant advertisements"]})]}),(0,s.jsx)("p",{children:"You can manage or disable cookies through your browser settings. Note that disabling cookies may affect website functionality."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"7. Your Rights and Choices"}),(0,s.jsx)("p",{children:"You have the following rights regarding your personal information:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Access:"})," Request a copy of the personal data we hold about you"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Correction:"})," Update or correct inaccurate information"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Deletion:"})," Request deletion of your account and personal data"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Opt-Out:"})," Unsubscribe from marketing emails at any time"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Data Portability:"})," Request your data in a portable format"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("strong",{children:"Withdraw Consent:"})," Revoke consent for data processing where applicable"]})]}),(0,s.jsx)("p",{children:"To exercise these rights, please contact us using the information provided in Section 12."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"8. Data Retention"}),(0,s.jsx)("p",{children:"We retain your personal information only for as long as necessary to fulfill the purposes outlined in this Privacy Policy, unless a longer retention period is required by law. When data is no longer needed, we will securely delete or anonymize it."}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Active user accounts: Data retained while account is active"}),(0,s.jsx)("li",{children:"Inactive accounts: Data may be deleted after prolonged inactivity"}),(0,s.jsx)("li",{children:"Transaction records: Retained for legal and accounting purposes"}),(0,s.jsx)("li",{children:"Marketing data: Retained until you opt-out or unsubscribe"})]})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"9. Third-Party Links"}),(0,s.jsx)("p",{children:"Our website may contain links to third-party websites, services, or advertisements. We are not responsible for the privacy practices or content of these external sites. We encourage you to review the privacy policies of any third-party sites you visit."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"10. Children's Privacy"}),(0,s.jsx)("p",{children:"360Coordinates is not intended for use by individuals under the age of 18. We do not knowingly collect personal information from children. If we discover that we have inadvertently collected data from a minor, we will promptly delete it. If you believe a child has provided us with personal information, please contact us immediately."})]}),(0,s.jsxs)("section",{className:"privacy-section",children:[(0,s.jsx)("h2",{children:"11. Changes to This Privacy Policy"}),(0,s.jsx)("p",{children:'We reserve the right to update or modify this Privacy Policy at any time to reflect changes in our practices or legal requirements. The "Last Updated" date at the top of this page will indicate when the policy was last revised. Continued use of our services after changes are posted constitutes your acceptance of the updated policy.'})]}),(0,s.jsxs)("section",{className:"privacy-section contact-section",children:[(0,s.jsx)("h2",{children:"12. Contact Information"}),(0,s.jsx)("p",{children:"If you have any questions, concerns, or requests regarding this Privacy Policy or how we handle your personal information, please contact us:"}),(0,s.jsxs)("div",{className:"contact-details",children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:"360Coordinates \u2013 Mr. Sudhakar Poul & Company"})}),(0,s.jsx)("p",{children:"Ambegaon BK, Pune, Maharashtra, India"}),(0,s.jsxs)("p",{children:["Email: ",(0,s.jsx)("a",{href:"mailto:info@360coordinates.com",children:"info@360coordinates.com"})]}),(0,s.jsxs)("p",{children:["Phone: ",(0,s.jsx)("a",{href:"tel:+919860638920",children:"+91 98606 38920"})]})]})]})]}),(0,s.jsx)("footer",{className:"privacy-footer",children:(0,s.jsx)("p",{children:"By continuing to use 360Coordinates, you acknowledge that you have read, understood, and agree to be bound by this Privacy Policy."})})]})})),pt=()=>((0,e.useEffect)(()=>{window.scrollTo(0,0)},[]),(0,s.jsx)("div",{className:"terms-container",children:(0,s.jsxs)("div",{className:"terms-content",children:[(0,s.jsxs)("header",{className:"terms-header",children:[(0,s.jsx)("h1",{children:"Terms & Conditions"}),(0,s.jsx)("p",{className:"last-updated",children:"Last Updated: 26 Nov 2025"})]}),(0,s.jsxs)("div",{className:"terms-body",children:[(0,s.jsxs)("p",{className:"intro-text",children:["Welcome to ",(0,s.jsx)("strong",{children:"360Coordinates"}),", owned and operated by Mr. Sudhakar Poul & Company, located in Ambegaon BK, Pune, India. By accessing or using our website"," ",(0,s.jsx)("a",{href:"http://www.360coordinates.com",target:"_blank",rel:"noopener noreferrer",children:"www.360coordinates.com"})," ","and services, you agree to comply with these Terms & Conditions. Please read them carefully before proceeding."]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"1. Introduction"}),(0,s.jsx)("p",{children:"360Coordinates is a real estate service platform designed to connect buyers, sellers, homeowners, and real estate agents across India. By using our services, you accept these terms and confirm that you are legally capable of entering into a binding agreement."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"2. Services Provided"}),(0,s.jsx)("p",{children:"360Coordinates offers a wide range of real estate-related services, including:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Property listing for buyers and sellers"}),(0,s.jsx)("li",{children:"Lead generation for real estate agents"}),(0,s.jsx)("li",{children:"Property marketing and promotion"}),(0,s.jsx)("li",{children:"Homeowner property management support"}),(0,s.jsx)("li",{children:"Real estate consultation and guidance"})]}),(0,s.jsx)("p",{children:"We reserve the right to add, modify, or discontinue services at any time."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"3. User Responsibilities"}),(0,s.jsx)("p",{children:"By using 360Coordinates, you agree that:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"All information you submit (property details, contact info, documents, etc.) is accurate and genuine."}),(0,s.jsx)("li",{children:"You will not upload any misleading, fraudulent, abusive, or illegal content."}),(0,s.jsx)("li",{children:"You will use the platform only for lawful real estate dealings."}),(0,s.jsx)("li",{children:"You will not attempt to copy, hack, or misuse the platform or its resources."})]})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"4. Property Listings & Accuracy"}),(0,s.jsx)("p",{children:"360Coordinates does not guarantee the accuracy, legality, or authenticity of property listings shared by users. All users (buyer, seller, agent, homeowner) are responsible for verifying:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Ownership documents"}),(0,s.jsx)("li",{children:"Property conditions"}),(0,s.jsx)("li",{children:"Legal permissions"}),(0,s.jsx)("li",{children:"Pricing & availability"})]}),(0,s.jsx)("p",{children:"360Coordinates is not liable for disputes between users."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"5. Payments & Fees"}),(0,s.jsx)("p",{children:"Some services provided by 360Coordinates may require payment. You agree that:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"All payments are non-refundable unless stated otherwise."}),(0,s.jsx)("li",{children:"Prices may change based on service updates."}),(0,s.jsx)("li",{children:"Payment details provided must be valid and authorized."})]})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"6. Third-Party Services"}),(0,s.jsx)("p",{children:"360Coordinates may link you to third-party websites, agents, or service vendors. We are not responsible for:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"External site content"}),(0,s.jsx)("li",{children:"Vendor service quality"}),(0,s.jsx)("li",{children:"Third-party policies"})]}),(0,s.jsx)("p",{children:"Users must verify independently before proceeding."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"7. Intellectual Property Rights"}),(0,s.jsx)("p",{children:"All content on 360Coordinates\u2014including logos, text, graphics, data, and website design\u2014belongs to Mr. Sudhakar Poul & Company. Users may not copy, reproduce, modify, or distribute any content without written permission."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"8. Privacy & Data Protection"}),(0,s.jsx)("p",{children:"Your personal information is used only to:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Deliver services"}),(0,s.jsx)("li",{children:"Connect buyers, sellers, and agents"}),(0,s.jsx)("li",{children:"Provide support"}),(0,s.jsx)("li",{children:"Improve website experience"})]}),(0,s.jsx)("p",{children:"We never sell or misuse user data. Please read our Privacy Policy for detailed information."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"9. Limitation of Liability"}),(0,s.jsx)("p",{children:"360Coordinates is not responsible for:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"Property disputes"}),(0,s.jsx)("li",{children:"Fraudulent user activities"}),(0,s.jsx)("li",{children:"Incorrect or outdated listings"}),(0,s.jsx)("li",{children:"Losses arising from user decisions"}),(0,s.jsx)("li",{children:"Service interruption or technical errors"})]}),(0,s.jsx)("p",{children:"Users are advised to conduct proper due diligence before finalizing any deal."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"10. Account Termination"}),(0,s.jsx)("p",{children:"We may suspend or terminate access to 360Coordinates if:"}),(0,s.jsxs)("ul",{children:[(0,s.jsx)("li",{children:"User violates terms"}),(0,s.jsx)("li",{children:"Fraudulent or illegal activity is detected"}),(0,s.jsx)("li",{children:"Misuse of platform is identified"})]}),(0,s.jsx)("p",{children:"No refunds will be provided for terminated accounts."})]}),(0,s.jsxs)("section",{className:"terms-section",children:[(0,s.jsx)("h2",{children:"11. Changes to Terms"}),(0,s.jsx)("p",{children:"360Coordinates reserves the right to update or change these Terms & Conditions at any time. Continued use of the site means you agree to the updated terms."})]}),(0,s.jsxs)("section",{className:"terms-section contact-section",children:[(0,s.jsx)("h2",{children:"12. Contact Information"}),(0,s.jsx)("p",{children:"For any queries or support, contact:"}),(0,s.jsxs)("div",{className:"contact-details",children:[(0,s.jsx)("p",{children:(0,s.jsx)("strong",{children:"360Coordinates \u2013 Mr. Sudhakar Poul & Company"})}),(0,s.jsx)("p",{children:"Ambegaon BK, Pune, Maharashtra, India"}),(0,s.jsxs)("p",{children:["Email: ",(0,s.jsx)("a",{href:"mailto:info@360coordinates.com",children:"info@360coordinates.com"})]}),(0,s.jsxs)("p",{children:["Phone: ",(0,s.jsx)("a",{href:"tel:+919860638920",children:"+91 98606 38920"})]})]})]})]}),(0,s.jsx)("footer",{className:"terms-footer",children:(0,s.jsx)("p",{children:"By continuing to use 360Coordinates, you acknowledge that you have read, understood, and agree to be bound by these Terms & Conditions."})})]})})),mt=(0,e.createContext)(),ft=t=>{let{children:r}=t;const[n,o]=(0,e.useState)([]),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)([]);(0,e.useEffect)(()=>{(async()=>{try{l(!0);const e=await i.NY.list();if(e.success&&e.data&&e.data.properties){const t=e.data.properties.map(e=>{var t,r,n;return{id:e.id,title:e.title,location:e.location,price:e.price.toString(),bedrooms:e.bedrooms,bathrooms:e.bathrooms,area:e.area.toString(),status:e.status,propertyType:e.property_type,furnishing:e.furnishing||"",facing:e.facing||"",floor:e.floor||"",totalFloors:e.total_floors||"",age:e.age||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?e.amenities.split(","):[],description:e.description||"",images:Array.isArray(e.images)&&e.images.length>0?e.images:e.cover_image?[e.cover_image]:[],createdAt:e.created_at,views:e.views_count||0,inquiries:e.inquiry_count||0,featured:!1,latitude:e.latitude,longitude:e.longitude,carpetArea:(null===(t=e.carpet_area)||void 0===t?void 0:t.toString())||"",balconies:e.balconies||"",priceNegotiable:e.price_negotiable||!1,maintenanceCharges:(null===(r=e.maintenance_charges)||void 0===r?void 0:r.toString())||"",depositAmount:(null===(n=e.deposit_amount)||void 0===n?void 0:n.toString())||"",videoUrl:e.video_url,brochureUrl:e.brochure_url}});o(t)}else o([]),console.log("No properties found or API error")}catch(e){console.error("Error fetching properties:",e),o([])}finally{l(!1)}})()},[]);const d=async()=>{try{const e=await i.r7.list();if(e.success&&e.data&&e.data.inquiries){const t=e.data.inquiries.map(e=>{var t,r,n,i,s,o,a,l,c;return{id:e.id,propertyId:(null===(t=e.property)||void 0===t?void 0:t.id)||e.property_id||null,buyerId:(null===(r=e.buyer)||void 0===r?void 0:r.id)||e.buyer_id||null,propertyTitle:(null===(n=e.property)||void 0===n?void 0:n.title)||e.property_title||"",buyerName:(null===(i=e.buyer)||void 0===i?void 0:i.name)||e.name||"",buyerEmail:(null===(s=e.buyer)||void 0===s?void 0:s.email)||e.email||"",buyerPhone:(null===(o=e.buyer)||void 0===o?void 0:o.phone)||e.mobile||"",buyerProfileImage:(null===(a=e.buyer)||void 0===a?void 0:a.profile_image)||null,message:e.message||"",status:e.status||"new",createdAt:e.created_at,avatar:(null===(l=e.buyer)||void 0===l?void 0:l.profile_image)||((null===(c=e.buyer)||void 0===c?void 0:c.name)||e.name||"U")[0].toUpperCase()}}),r=new Map;t.forEach(e=>{const t="".concat(e.buyerId||"guest","_").concat(e.propertyId);if(r.has(t)){const n=r.get(t),i=new Date(n.createdAt);new Date(e.createdAt)>i?r.set(t,(0,p.A)((0,p.A)({},e),{},{conversationKey:t,inquiryIds:[...n.inquiryIds,e.id]})):n.inquiryIds.push(e.id)}else r.set(t,(0,p.A)((0,p.A)({},e),{},{conversationKey:t,inquiryIds:[e.id]}))});const n=Array.from(r.values());n.sort((e,t)=>{const r=new Date(e.createdAt);return new Date(t.createdAt)-r}),console.log("[PropertyContext] Grouped inquiries into unique conversations:",n.length,"conversations from",t.length,"inquiries"),u(n)}else u([])}catch(e){console.error("[PropertyContext] Error fetching inquiries:",e),u([])}};(0,e.useEffect)(()=>{d();const e=setInterval(()=>{d()},3e4);return()=>{clearInterval(e)}},[]);return(0,s.jsx)(mt.Provider,{value:{properties:n,setProperties:o,inquiries:c,setInquiries:u,addProperty:async e=>{try{const t={title:e.title,status:e.status,property_type:e.propertyType,location:e.location,latitude:e.latitude||null,longitude:e.longitude||null,state:e.state||null,additional_address:e.additionalAddress||null,bedrooms:e.bedrooms,bathrooms:e.bathrooms,balconies:e.balconies||"",area:parseFloat(e.area),carpet_area:e.carpetArea?parseFloat(e.carpetArea):null,floor:e.floor||"",total_floors:e.totalFloors?parseInt(e.totalFloors):null,facing:e.facing||"",age:e.age||"",furnishing:e.furnishing||"",description:e.description,price:parseFloat(e.price),price_negotiable:e.priceNegotiable||!1,maintenance_charges:e.maintenanceCharges?parseFloat(e.maintenanceCharges):null,deposit_amount:e.depositAmount?parseFloat(e.depositAmount):null,images:e.images||[],video_url:e.videoUrl||null,brochure_url:e.brochureUrl||null,amenities:e.amenities||[],available_for_bachelors:e.availableForBachelors||!1},r=await i.NY.add(t);if(r.success&&r.data&&r.data.property){const e=r.data.property,t={id:e.id,title:e.title,location:e.location,price:e.price.toString(),bedrooms:e.bedrooms,bathrooms:e.bathrooms,area:e.area.toString(),status:e.status,propertyType:e.property_type,furnishing:e.furnishing||"",facing:e.facing||"",floor:e.floor||"",totalFloors:e.total_floors||"",age:e.age||"",amenities:e.amenities||[],description:e.description||"",images:e.images||[],createdAt:e.created_at,views:0,inquiries:0,featured:!1},n=await i.NY.list();if(n.success&&n.data&&n.data.properties){const e=n.data.properties.map(e=>{var t,r,n;return{id:e.id,title:e.title,location:e.location,price:e.price.toString(),bedrooms:e.bedrooms,bathrooms:e.bathrooms,area:e.area.toString(),status:e.status,propertyType:e.property_type,furnishing:e.furnishing||"",facing:e.facing||"",floor:e.floor||"",totalFloors:e.total_floors||"",age:e.age||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?e.amenities.split(","):[],description:e.description||"",images:Array.isArray(e.images)&&e.images.length>0?e.images:e.cover_image?[e.cover_image]:[],createdAt:e.created_at,views:e.views_count||0,inquiries:e.inquiry_count||0,featured:!1,latitude:e.latitude,longitude:e.longitude,carpetArea:(null===(t=e.carpet_area)||void 0===t?void 0:t.toString())||"",balconies:e.balconies||"",priceNegotiable:e.price_negotiable||!1,maintenanceCharges:(null===(r=e.maintenance_charges)||void 0===r?void 0:r.toString())||"",depositAmount:(null===(n=e.deposit_amount)||void 0===n?void 0:n.toString())||"",videoUrl:e.video_url,brochureUrl:e.brochure_url}});o(e)}else o(e=>[t,...e]);return t}throw new Error(r.message||"Failed to add property")}catch(t){console.error("Error adding property:",t);const e=t.message||"Failed to save property to database. Please check your connection and try again.";throw alert(e),t}},updateProperty:async(e,t)=>{try{if(!0){const r={title:t.title,status:t.status,property_type:t.propertyType,location:t.location,latitude:t.latitude||null,longitude:t.longitude||null,state:t.state||null,additional_address:t.additionalAddress||null,bedrooms:t.bedrooms,bathrooms:t.bathrooms,balconies:t.balconies||"",area:t.area?parseFloat(t.area):null,carpet_area:t.carpetArea?parseFloat(t.carpetArea):null,floor:t.floor||"",total_floors:t.totalFloors?parseInt(t.totalFloors):null,facing:t.facing||"",age:t.age||"",furnishing:t.furnishing||"",description:t.description,price:t.price?parseFloat(t.price):null,price_negotiable:t.priceNegotiable,maintenance_charges:t.maintenanceCharges?parseFloat(t.maintenanceCharges):null,deposit_amount:t.depositAmount?parseFloat(t.depositAmount):null,images:t.images||[],video_url:t.videoUrl||null,brochure_url:t.brochureUrl||null,amenities:t.amenities||[],available_for_bachelors:t.availableForBachelors||!1};await i.NY.update(e,r)}o(r=>r.map(r=>r.id===e?(0,p.A)((0,p.A)({},r),t):r))}catch(r){throw console.error("Error updating property:",r),o(r=>r.map(r=>r.id===e?(0,p.A)((0,p.A)({},r),t):r)),r}},deleteProperty:async e=>{try{!0&&await i.NY.delete(e),o(t=>t.filter(t=>t.id!==e)),u(t=>t.filter(t=>t.propertyId!==e))}catch(t){throw console.error("Error deleting property:",t),o(t=>t.filter(t=>t.id!==e)),u(t=>t.filter(t=>t.propertyId!==e)),t}},updateInquiryStatus:async(e,t)=>{let r=null;u(n=>{const i=n.find(t=>t.id===e);return i&&(r=i.status),n.map(r=>r.id===e?(0,p.A)((0,p.A)({},r),{},{status:t}):r)});try{if(!0){console.log("[PropertyContext] Updating inquiry ".concat(e," status to: ").concat(t));const n=await i.r7.updateStatus(e,t);if(!n.success)throw console.error("[PropertyContext] Failed to update inquiry status:",n.message),console.error("[PropertyContext] Full response:",n),null!==r&&u(t=>t.map(t=>t.id===e?(0,p.A)((0,p.A)({},t),{},{status:r}):t)),new Error(n.message||"Failed to update status");if(n.data&&n.data.inquiry){const t=n.data.inquiry.status;console.log("[PropertyContext] Status updated successfully. Confirmed status from DB: ".concat(t)),u(r=>r.map(r=>r.id===e?(0,p.A)((0,p.A)({},r),{},{status:t}):r))}else console.warn("[PropertyContext] API response missing inquiry data:",n)}}catch(n){throw console.error("[PropertyContext] Error updating inquiry status:",n),console.error("[PropertyContext] Error details:",{message:n.message,status:n.status,data:n.data,fullError:n}),n.message&&(n.message.includes("database schema")||n.message.includes("ENUM")||n.message.includes("migration"))&&(console.error("[PropertyContext] \u26a0\ufe0f DATABASE MIGRATION REQUIRED!"),console.error("[PropertyContext] Please run: backend/database/run_inquiry_status_migration.php"),alert("Database migration required! Please contact administrator to run the migration script.")),null!==r&&u(t=>t.map(t=>t.id===e?(0,p.A)((0,p.A)({},t),{},{status:r}):t)),n}},syncInquiryStatusFromFirebase:(e,t)=>{u(r=>{const n=r.find(t=>t.id===e);return n&&n.status!==t?(console.log("[PropertyContext] Syncing inquiry ".concat(e," status from Firebase: ").concat(n.status," -> ").concat(t)),r.map(r=>r.id===e?(0,p.A)((0,p.A)({},r),{},{status:t}):r)):r})},deleteInquiry:e=>{u(t=>t.filter(t=>t.id!==e))},getStats:()=>({totalProperties:n.length,forSale:n.filter(e=>"sale"===e.status).length,forRent:n.filter(e=>"rent"===e.status).length,totalViews:n.reduce((e,t)=>e+(t.views||0),0),totalInquiries:c.length,newInquiries:c.filter(e=>"new"===e.status).length}),refreshProperties:async()=>{try{const e=await i.NY.list();if(e.success&&e.data&&e.data.properties){const t=e.data.properties.map(e=>{var t,r,n;return{id:e.id,title:e.title,location:e.location,price:e.price.toString(),bedrooms:e.bedrooms,bathrooms:e.bathrooms,area:e.area.toString(),status:e.status,propertyType:e.property_type,furnishing:e.furnishing||"",facing:e.facing||"",floor:e.floor||"",totalFloors:e.total_floors||"",age:e.age||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?e.amenities.split(","):[],description:e.description||"",images:Array.isArray(e.images)&&e.images.length>0?e.images:e.cover_image?[e.cover_image]:[],createdAt:e.created_at,views:e.views_count||0,inquiries:e.inquiry_count||0,featured:!1,latitude:e.latitude,longitude:e.longitude,carpetArea:(null===(t=e.carpet_area)||void 0===t?void 0:t.toString())||"",balconies:e.balconies||"",priceNegotiable:e.price_negotiable||!1,maintenanceCharges:(null===(r=e.maintenance_charges)||void 0===r?void 0:r.toString())||"",depositAmount:(null===(n=e.deposit_amount)||void 0===n?void 0:n.toString())||"",videoUrl:e.video_url,brochureUrl:e.brochure_url}});o(t)}}catch(e){console.error("Error refreshing properties:",e)}},refreshInquiries:d,loading:a},children:r})},gt=()=>{const t=(0,e.useContext)(mt);if(!t)throw new Error("useProperty must be used within a PropertyProvider");return t},yt=e=>"string"!==typeof e?e:e.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#x27;").replace(/\//g,"&#x2F;"),_t=e=>{if(!e)return{valid:!1,message:"Phone number is required"};const t=e.replace(/\D/g,""),r=/^[6-9]\d{9}$/.test(t);return{valid:r,message:r?"":"Invalid Indian phone number (must be 10 digits starting with 6-9)",cleaned:t}},vt=e=>{if(!e)return{valid:!0,message:""};try{let t=e;return e.startsWith("http://")||e.startsWith("https://")||(t="https://"+e),new URL(t),{valid:!0,message:""}}catch(t){return{valid:!1,message:"Invalid URL format"}}},xt=5e5,bt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:100,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:1e5;if(!e)return{valid:!1,message:"Area is required"};const n=parseFloat(e);return isNaN(n)||n<=0?{valid:!1,message:"Area must be a positive number"}:n<t?{valid:!1,message:"Area must be at least ".concat(t," sq.ft")}:n>r?{valid:!1,message:"Area cannot exceed ".concat(r," sq.ft")}:{valid:!0,message:""}},wt=function(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"sale";if(!e)return{valid:!1,message:"Price is required"};const r=parseFloat(e);return isNaN(r)||r<=0?{valid:!1,message:"Price must be greater than 0"}:"sale"===t&&r<1e5?{valid:!1,message:"Sale price must be at least \u20b91,00,000"}:"rent"===t&&r<5e3?{valid:!1,message:"Rent must be at least \u20b95,000/month"}:{valid:!0,message:""}},jt=function(e,t,r){let n=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"Field";if(!e||!e.trim())return{valid:!1,message:"".concat(n," is required")};const i=e.trim().length;return t&&i<t?{valid:!1,message:"".concat(n," must be at least ").concat(t," characters")}:r&&i>r?{valid:!1,message:"".concat(n," cannot exceed ").concat(r," characters")}:{valid:!0,message:""}},St=e=>e?["image/jpeg","image/jpg","image/png","image/webp"].includes(e.type)?e.size>5242880?{valid:!1,message:"File size exceeds 5MB. Current size: ".concat((e.size/1024/1024).toFixed(2),"MB")}:{valid:!0,message:""}:{valid:!1,message:"Invalid file type. Only JPG, PNG, and WEBP are allowed"}:{valid:!1,message:"Please select an image file"},Tt=(e,t)=>{if(!e)return{valid:!0,message:""};const r=parseFloat(e),n=parseFloat(t);return isNaN(r)||r<=0?{valid:!1,message:"Deposit must be a positive number"}:!isNaN(n)&&r>12*n?{valid:!1,message:"Deposit cannot exceed 12 months rent"}:{valid:!0,message:""}},kt=(e,t)=>{if(!e)return{valid:!0,message:""};const r=parseFloat(e),n=parseFloat(t);return isNaN(r)||r<=0?{valid:!1,message:"Carpet area must be a positive number"}:!isNaN(n)&&r>n?{valid:!1,message:"Carpet area cannot exceed built-up area"}:{valid:!0,message:""}},At=(e,t)=>{if(!e||!t)return{valid:!0,message:""};const r=parseInt(e,10),n=parseInt(t,10);return isNaN(r)||!/^\d+$/.test(String(e).trim())?{valid:!1,message:"Floor must be a number"}:isNaN(n)?{valid:!0,message:""}:r>n?{valid:!1,message:"Floor number cannot exceed total floors"}:r<0?{valid:!1,message:"Floor number cannot be negative"}:{valid:!0,message:""}},Ct={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN||"pk.eyJ1Ijoic3VkaGFrYXJwb3VsIiwiYSI6ImNtaXp0ZmFrNTAxaTQzZHNiODNrYndsdTAifQ.YTMezksySLU7ZpcYkvXyqg";Ee().accessToken=Ct;const Et=t=>{let{initialLocation:r=null,onLocationChange:n,onClose:i,defaultCenter:o=[78.9629,20.5937],defaultZoom:a=5}=t;const l=(0,e.useRef)(null),c=(0,e.useRef)(null),u=(0,e.useRef)(null),[d,h]=(0,e.useState)(r),[p,m]=(0,e.useState)((null===r||void 0===r?void 0:r.fullAddress)||""),[f,g]=(0,e.useState)(!1),[y,_]=(0,e.useState)(""),[v,x]=(0,e.useState)(r?{lng:r.longitude,lat:r.latitude}:null),[b,w]=(0,e.useState)(!1);(0,e.useEffect)(()=>{if(c.current)return;c.current=new(Ee().Map)({container:l.current,style:"mapbox://styles/mapbox/streets-v12",center:r?[r.longitude,r.latitude]:o,zoom:r?14:a}),c.current.addControl(new(Ee().NavigationControl),"top-right"),c.current.addControl(new(Ee().GeolocateControl)({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!1}),"top-right");const e=document.createElement("div");return e.className="location-picker-marker",e.innerHTML='\n      <div class="marker-pin">\n        <span>\ud83d\udccd</span>\n      </div>\n      <div class="marker-pulse"></div>\n    ',u.current=new(Ee().Marker)({element:e,draggable:!0}).setLngLat(r?[r.longitude,r.latitude]:o).addTo(c.current),u.current.on("dragend",()=>{const e=u.current.getLngLat();x({lng:e.lng,lat:e.lat}),S(e.lng,e.lat)}),c.current.on("click",e=>{const t={lng:e.lngLat.lng,lat:e.lngLat.lat};u.current.setLngLat([t.lng,t.lat]),x(t),S(t.lng,t.lat)}),r&&(x({lng:r.longitude,lat:r.latitude}),j(r.longitude,r.latitude)),()=>{c.current&&(c.current.remove(),c.current=null)}},[]);const j=(0,e.useCallback)(async(e,t)=>{g(!0);try{const r=await fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(e,",").concat(t,".json?access_token=").concat(Ct,"&country=IN&types=address,locality,place,region&language=en")),n=await r.json();if(n.features&&n.features.length>0){const r=n.features[0],i=r.place_name;m(i);const s=r.context||[],o={longitude:e,latitude:t,fullAddress:i,address:r.text||"",locality:"",city:"",state:"",pincode:"",country:""};if(s.forEach(e=>{e.id.startsWith("locality")&&(o.locality=e.text),e.id.startsWith("place")&&(o.city=e.text),e.id.startsWith("region")&&(o.state=e.text),e.id.startsWith("postcode")&&(o.pincode=e.text),e.id.startsWith("country")&&(o.country=e.text)}),!o.state)for(const e of n.features){if(e.place_type&&e.place_type.includes("region")){o.state=e.text;break}const t=e.context||[];for(const e of t)if(e.id.startsWith("region")){o.state=e.text;break}if(o.state)break}h(o)}}catch(r){console.error("Reverse geocoding error:",r)}finally{g(!1)}},[]),S=(0,e.useCallback)(async(e,t)=>{await j(e,t)},[j]),T=async e=>{if(e&&!(e.length<3))try{const t=await fetch("https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json?access_token=").concat(Ct,"&country=IN&types=place,locality,address&limit=1")),r=await t.json();if(r.features&&r.features.length>0){const[e,t]=r.features[0].center;x({lng:e,lat:t}),u.current.setLngLat([e,t]),c.current.flyTo({center:[e,t],zoom:15,essential:!0}),S(e,t),_("")}}catch(t){console.error("Search error:",t)}};return(0,s.jsxs)("div",{className:"location-picker-modal-content",children:[(0,s.jsxs)("div",{className:"location-picker-header",children:[(0,s.jsx)("h3",{children:"Select Property Location"}),(0,s.jsx)("button",{className:"location-picker-close-btn",onClick:i,"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsxs)("div",{className:"location-picker-search-section",children:[(0,s.jsxs)("div",{className:"search-box",children:[(0,s.jsx)("input",{type:"text",placeholder:"Search location in India...",value:y,onChange:e=>_(e.target.value),onKeyDown:e=>{"Enter"===e.key&&T(y)}}),(0,s.jsx)("button",{type:"button",onClick:()=>T(y),className:"search-btn",title:"Search",children:(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"m21 21-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("button",{type:"button",onClick:()=>{navigator.geolocation?navigator.geolocation.getCurrentPosition(e=>{const{longitude:t,latitude:r}=e.coords;x({lng:t,lat:r}),u.current.setLngLat([t,r]),c.current.flyTo({center:[t,r],zoom:16,essential:!0}),S(t,r)},e=>{console.error("Geolocation error:",e),alert("Unable to get your location. Please enable location services.")}):alert("Geolocation is not supported by your browser.")},className:"current-location-btn",title:"Use current location",children:"\ud83d\udccd"})]}),(0,s.jsxs)("div",{className:"location-picker-actions",children:[(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:i,disabled:b,children:"Cancel"}),(0,s.jsx)("button",{type:"button",className:"save-btn ".concat(v?"save-btn-active":""),onClick:()=>{if(v){w(!0);const e=d||{longitude:v.lng,latitude:v.lat,fullAddress:p||"Location at ".concat(v.lat.toFixed(6),", ").concat(v.lng.toFixed(6))};n&&n(e),setTimeout(()=>{w(!1),i&&i()},1500)}},disabled:!v||f||b,children:b?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"saving-spinner"}),"Saving..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",style:{marginRight:"6px"},children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Save Location"]})})]})]}),(0,s.jsx)("div",{ref:l,className:"location-picker-map"}),(0,s.jsx)("div",{className:"location-picker-footer",children:(0,s.jsx)("div",{className:"selected-location-info",children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"location-icon",children:"\ud83d\udccd"}),(0,s.jsxs)("div",{className:"location-details",children:[(0,s.jsx)("span",{className:"loading",children:"Getting address..."}),v&&(0,s.jsxs)("small",{className:"coordinates",children:["Lat: ",v.lat.toFixed(6),", Lng: ",v.lng.toFixed(6)]})]})]}):v?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"location-icon",children:"\ud83d\udccd"}),(0,s.jsxs)("div",{className:"location-details",children:[(0,s.jsx)("span",{className:"location-text",children:p||"Location selected at ".concat(v.lat.toFixed(6),", ").concat(v.lng.toFixed(6))}),(0,s.jsxs)("small",{className:"coordinates",children:["Lat: ",v.lat.toFixed(6),", Lng: ",v.lng.toFixed(6)]})]}),b&&(0,s.jsx)("span",{className:"save-success-indicator",children:"\u2713 Saved!"})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"location-icon",children:"\ud83d\udccd"}),(0,s.jsx)("div",{className:"location-details",children:(0,s.jsx)("span",{className:"location-text",children:"Click on map or drag marker to select location"})})]})})}),(0,s.jsx)("p",{className:"location-picker-hint",children:"\ud83d\udca1 Tip: Click on the map or drag the marker to set exact property location"})]})},Nt={NODE_ENV:"production",PUBLIC_URL:"",WDS_SOCKET_HOST:void 0,WDS_SOCKET_PATH:void 0,WDS_SOCKET_PORT:void 0,FAST_REFRESH:!0}.REACT_APP_MAPBOX_ACCESS_TOKEN||"pk.eyJ1Ijoic3VkaGFrYXJwb3VsIiwiYSI6ImNtaXp0ZmFrNTAxaTQzZHNiODNrYndsdTAifQ.YTMezksySLU7ZpcYkvXyqg",It=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"],Pt=t=>{let{placeholder:r="Enter state...",value:n="",onChange:i,className:o="",error:a,disabled:l=!1,readOnly:c=!1}=t;const[u,d]=(0,e.useState)(n||""),[h,p]=(0,e.useState)([]),[m,f]=(0,e.useState)(!1),[g,y]=(0,e.useState)(!1),[_,v]=(0,e.useState)(-1),[x,b]=(0,e.useState)(null),[w,j]=(0,e.useState)(null),S=(0,e.useRef)(null),T=(0,e.useRef)(null);(0,e.useEffect)(()=>{d(n||"")},[n]),(0,e.useEffect)(()=>{const e=e=>{S.current&&!S.current.contains(e.target)&&(f(!1),v(-1))};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]);const k=e=>{if(!e||!e.properties)return null;const t=e.properties,r=e.context||[],n=e.place_type||[];let i=null;if(n.includes("region"))i=t.name||t.text||t.short_code;else{const e=r.find(e=>{const t=e.id||"";return t.includes("region")||t.includes("state")});e?i=e.text||e.name:t.region?i=t.region:t.address&&t.address.state&&(i=t.address.state)}if(!i)return null;i=i.trim();const s=It.find(e=>{const t=e.toLowerCase(),r=i.toLowerCase();return t===r||t.includes(r)||r.includes(t)||t.replace(/\s+/g,"")===r.replace(/\s+/g,"")});return s?{id:e.id,stateName:s,fullName:"".concat(s,", India"),coordinates:e.center?{lng:e.center[0],lat:e.center[1]}:null}:null},A=(0,e.useCallback)(async e=>{if(!Nt||!e||e.trim().length<2)return p([]),f(!1),void j(null);T.current&&T.current.abort();const t=new AbortController;T.current=t,y(!0);try{const r="https://api.mapbox.com/geocoding/v5/mapbox.places/".concat(encodeURIComponent(e),".json?access_token=").concat(Nt,"&country=in&types=region&limit=30&autocomplete=true"),n=await fetch(r,{signal:t.signal});if(!n.ok)throw new Error("Failed to fetch states: ".concat(n.status));const i=await n.json();let s=(i.features||[]).map(k).filter(Boolean).filter((e,t,r)=>t===r.findIndex(t=>t.stateName.toLowerCase()===e.stateName.toLowerCase()));if(0===s.length){const t=e.toLowerCase();s=It.filter(e=>e.toLowerCase().includes(t)).map(e=>({id:"state-".concat(e.toLowerCase().replace(/\s+/g,"-")),stateName:e,fullName:"".concat(e,", India"),coordinates:null})).slice(0,10)}if(t.signal.aborted)return;p(s),f(s.length>0),j(null)}catch(r){if("AbortError"===r.name)return;console.error("Error fetching state suggestions:",r),j(null);const t=e.toLowerCase(),n=It.filter(e=>e.toLowerCase().includes(t)).map(e=>({id:"state-".concat(e.toLowerCase().replace(/\s+/g,"-")),stateName:e,fullName:"".concat(e,", India"),coordinates:null})).slice(0,10);p(n),f(n.length>0)}finally{y(!1)}},[]);(0,e.useEffect)(()=>{if(!u||u.trim().length<2)return p([]),f(!1),void j(null);const e=setTimeout(()=>{A(u.trim())},300);return()=>clearTimeout(e)},[u,A]);const C=e=>{l||c||!e||(b(e),d(e.stateName),f(!1),p([]),v(-1),i&&i(e.stateName))};return(0,s.jsxs)("div",{className:"state-autosuggest ".concat(o),ref:S,children:[(0,s.jsxs)("div",{className:"state-input-wrapper ".concat(a?"state-input-error":""),children:[(0,s.jsx)("input",{type:"text",value:u,placeholder:r,onChange:e=>{if(l||c)return;const t=e.target.value;d(t),b(null),f(!0),!t&&i&&i("")},onKeyDown:e=>{if(!l&&!c)if("ArrowDown"===e.key){if(e.preventDefault(),!h.length)return;f(!0),v(e=>{const t=e+1;return t>=h.length?0:t})}else if("ArrowUp"===e.key){if(e.preventDefault(),!h.length)return;f(!0),v(e=>{const t=e-1;return t<0?h.length-1:t})}else if("Enter"===e.key){if(e.preventDefault(),e.stopPropagation(),m&&h.length>0){C(h[_>=0?_:0])}}else"Escape"===e.key&&(e.preventDefault(),f(!1),v(-1))},className:"state-input",autoComplete:"off",disabled:l,readOnly:c||l}),g&&(0,s.jsx)("span",{className:"state-spinner","aria-label":"Loading"}),!g&&u&&!l&&!c&&(0,s.jsx)("button",{type:"button",className:"state-clear-btn",onClick:()=>{l||c||(d(""),p([]),f(!1),v(-1),b(null),j(null),i&&i(""))},"aria-label":"Clear state",children:"\xd7"})]}),a&&(0,s.jsx)("div",{className:"state-error-text",children:a}),w&&!a&&(0,s.jsx)("div",{className:"state-error-text",children:w}),m&&h.length>0&&!l&&!c&&(0,s.jsx)("ul",{className:"state-dropdown",role:"listbox",children:h.map((e,t)=>(0,s.jsx)("li",{className:"state-option ".concat(t===_?"active":""),onMouseDown:t=>{t.preventDefault(),C(e)},onMouseEnter:()=>v(t),role:"option","aria-selected":t===_,children:(0,s.jsx)("div",{className:"state-option-primary",children:e.stateName})},e.id||"".concat(e.stateName,"-").concat(t)))})]})},Mt=t=>{let{isOpen:r,onClose:i,redirectPath:o="/agent-dashboard/properties"}=t;const a=(0,n.Zp)(),l=(0,e.useCallback)(()=>{i(),a(o)},[i,a,o]);return(0,e.useEffect)(()=>{if(!r)return;const e=e=>{"Escape"===e.key&&l()};return document.addEventListener("keydown",e),()=>{document.removeEventListener("keydown",e)}},[r,l]),r?(0,s.jsx)("div",{className:"property-upload-success-modal-overlay",onClick:l,children:(0,s.jsxs)("div",{className:"property-upload-success-modal-content",onClick:e=>e.stopPropagation(),children:[(0,s.jsx)("div",{className:"property-upload-success-modal-header",children:(0,s.jsxs)("h3",{children:[(0,s.jsx)("span",{className:"success-icon",children:"\u2713"}),"Property Uploaded Successfully"]})}),(0,s.jsx)("div",{className:"property-upload-success-modal-body",children:(0,s.jsx)("p",{className:"property-upload-success-description",children:"You can edit this property only within 24 hours after upload."})}),(0,s.jsx)("div",{className:"property-upload-success-modal-footer",children:(0,s.jsx)("button",{className:"property-upload-success-ok-btn",onClick:l,children:"OK"})})]})}):null},Lt=t=>{let{formData:r,errors:n,validateField:i,fieldOrder:s,formRef:o,enabled:a=!0,scrollOffset:l=100,scrollDelay:c=300}=t;const u=(0,e.useRef)(new Set),d=(0,e.useRef)(null),h=(0,e.useRef)(!1),p=(0,e.useRef)(null),m=(0,e.useRef)(null),f=(0,e.useCallback)(()=>"undefined"!==typeof window&&window.matchMedia("(prefers-reduced-motion: reduce)").matches,[]),g=(0,e.useCallback)(()=>{if("undefined"===typeof window)return!1;if(f())return!0;return!!(document.querySelector('[role="application"]')||document.querySelector("[aria-live]")||navigator.userAgent.match(/NVDA|JAWS|VoiceOver|TalkBack/i))},[f]),y=(0,e.useRef)(!1),_=(0,e.useRef)(0);(0,e.useEffect)(()=>{if(!a)return;const e=e=>{(e.clientX>window.innerWidth-20||e.clientY>window.innerHeight-20)&&(h.current=!0,y.current=!1)},t=()=>{const e=Date.now(),t=e-_.current;y.current&&t<150||(h.current=!0,y.current=!1,_.current=e,clearTimeout(p.current),p.current=setTimeout(()=>{h.current=!1},500))},r=()=>{h.current=!0,y.current=!1,clearTimeout(p.current),p.current=setTimeout(()=>{h.current=!1},500)},n=()=>{h.current=!0,y.current=!1,clearTimeout(p.current),p.current=setTimeout(()=>{h.current=!1},500)},i=e=>{["ArrowUp","ArrowDown","PageUp","PageDown","Home","End"].includes(e.key)&&(h.current=!0,y.current=!1,clearTimeout(p.current),p.current=setTimeout(()=>{h.current=!1},500))};return window.addEventListener("mousedown",e),window.addEventListener("scroll",t,{passive:!0}),window.addEventListener("wheel",r,{passive:!0}),window.addEventListener("touchmove",n,{passive:!0}),window.addEventListener("keydown",i),()=>{window.removeEventListener("mousedown",e),window.removeEventListener("scroll",t),window.removeEventListener("wheel",r),window.removeEventListener("touchmove",n),window.removeEventListener("keydown",i),clearTimeout(p.current)}},[a]);const v=(0,e.useCallback)(e=>{if(!a||f()||g())return;if(h.current)return;if(m.current===e)return;const t=(null===o||void 0===o?void 0:o.current)||document,r=t.querySelector('[name="'.concat(e,'"]'))||t.querySelector("#".concat(e))||t.querySelector('[data-field="'.concat(e,'"]'));r&&(clearTimeout(d.current),d.current=setTimeout(()=>{if(h.current)return;const t=r.getBoundingClientRect(),n=t.top+window.pageYOffset-l;t.top>=l&&t.bottom<=(window.innerHeight||document.documentElement.clientHeight)||(y.current=!0,_.current=Date.now(),requestAnimationFrame(()=>{window.scrollTo({top:n,behavior:"smooth"})}),m.current=e,setTimeout(()=>{y.current=!1},1200),setTimeout(()=>{m.current=null},2e3))},c))},[a,o,l,c,f,g]);return(0,e.useEffect)(()=>{if(!a||!s||0===s.length)return;const e=new Set;s.forEach(t=>{const s=r[t],o=n[t];void 0!==s&&null!==s&&""!==s&&!o&&(!i||i(t,s))&&e.add(t)});let t=null;for(const r of s)if(e.has(r)&&!u.current.has(r)){t=r;break}if(t){const e=s.indexOf(t)+1;if(e<s.length){const t=s[e],o=r[t],a=n[t];void 0!==o&&null!==o&&""!==o&&!a&&(!i||i(t,o))||v(t)}}u.current=e},[r,n,s,i,a,v]),(0,e.useEffect)(()=>()=>{clearTimeout(d.current),clearTimeout(p.current)},[]),{scrollToField:v}},Rt=[{id:1,title:"Basic Info",icon:"\ud83d\udcdd"},{id:2,title:"Property Details",icon:"\ud83c\udfe0"},{id:3,title:"Amenities",icon:"\u2728"},{id:4,title:"Photos",icon:"\ud83d\udcf7"},{id:5,title:"Pricing",icon:"\ud83d\udcb0"}],Dt=[{value:"Apartment",icon:"\ud83c\udfe2",category:"residential",subCategory:"standard"},{value:"Villa / Banglow",icon:"\ud83c\udfe1",category:"residential",subCategory:"independent"},{value:"Independent House",icon:"\ud83c\udfd8\ufe0f",category:"residential",subCategory:"independent"},{value:"Row House/ Farm House",icon:"\ud83c\udfd8\ufe0f",category:"residential",subCategory:"standard"},{value:"Penthouse",icon:"\ud83c\udf06",category:"residential",subCategory:"luxury"},{value:"Studio Apartment",icon:"\ud83d\udecf\ufe0f",category:"residential",subCategory:"studio"},{value:"Plot / Land / Indusrtial Property",icon:"\ud83d\udcd0",category:"land",subCategory:"plot"},{value:"Commercial Office",icon:"\ud83c\udfe2",category:"commercial",subCategory:"office"},{value:"Commercial Shop",icon:"\ud83c\udfea",category:"commercial",subCategory:"shop"},{value:"PG / Hostel",icon:"\ud83d\udecf\ufe0f",category:"pg",subCategory:"accommodation"},{value:"Warehouse / Godown",icon:"\ud83c\udfea",category:"commercial",subCategory:"shop"}],Ft=["Villa / Banglow","Independent House","Row House/ Farm House"],Ot={residential_standard:{showBedrooms:!0,showBathrooms:!0,showBalconies:!0,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0},residential_independent:{showBedrooms:!0,showBathrooms:!0,showBalconies:!0,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0},residential_studio:{showBedrooms:!1,showBathrooms:!0,showBalconies:!0,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!1,bathroomsRequired:!0},residential_farmhouse:{showBedrooms:!0,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0},commercial_office:{showBedrooms:!1,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!1,bathroomsRequired:!1},commercial_shop:{showBedrooms:!1,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!1,showAge:!0,showCarpetArea:!0,bedroomsRequired:!1,bathroomsRequired:!1},land_plot:{showBedrooms:!1,showBathrooms:!1,showBalconies:!1,showFloor:!1,showTotalFloors:!1,showFacing:!0,showFurnishing:!1,showAge:!1,showCarpetArea:!1,bedroomsRequired:!1,bathroomsRequired:!1},pg_accommodation:{showBedrooms:!0,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0}},zt=[{id:"parking",label:"Parking",icon:"\ud83d\ude97"},{id:"lift",label:"Lift",icon:"\ud83d\uded7"},{id:"security",label:"24x7 Security",icon:"\ud83d\udc6e"},{id:"power_backup",label:"Power Backup",icon:"\u26a1"},{id:"gym",label:"Gym",icon:"\ud83c\udfcb\ufe0f"},{id:"swimming_pool",label:"Swimming Pool",icon:"\ud83c\udfca"},{id:"garden",label:"Garden",icon:"\ud83c\udf33"},{id:"clubhouse",label:"Club House",icon:"\ud83c\udfdb\ufe0f"},{id:"playground",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"cctv",label:"CCTV",icon:"\ud83d\udcf9"},{id:"intercom",label:"Intercom",icon:"\ud83d\udcde"},{id:"fire_safety",label:"Fire Safety",icon:"\ud83d\udd25"},{id:"water_supply",label:"24x7 Water",icon:"\ud83d\udca7"},{id:"gas_pipeline",label:"Gas Pipeline",icon:"\ud83d\udd25"},{id:"wifi",label:"WiFi",icon:"\ud83d\udcf6"},{id:"electricity",label:"Electricity",icon:"\u26a1"}],Bt={residential:["parking","lift","security","power_backup","gym","swimming_pool","garden","clubhouse","playground","cctv","intercom","fire_safety","water_supply","gas_pipeline","wifi"],residential_farmhouse:["parking","security","power_backup","gym","swimming_pool","garden","clubhouse","playground","cctv","fire_safety","water_supply","gas_pipeline","wifi"],commercial_office:["parking","lift","security","power_backup","cctv","fire_safety","water_supply","wifi","intercom"],commercial_shop:["parking","security","power_backup","cctv","fire_safety","water_supply","wifi"],land_plot:["security","water_supply","cctv","electricity"],pg_accommodation:["parking","security","power_backup","cctv","fire_safety","water_supply","wifi","intercom"]},Ut=["Unfurnished","Semi-Furnished","Fully-Furnished"],Vt=["North","South","East","West","North-East","North-West","South-East","South-West"],qt=["New Construction","Less than 1 Year","1-5 Years","5-10 Years","10+ Years"];function Wt(t){let{onClose:r,editIndex:n=null,initialData:o=null}=t;const{addProperty:a,updateProperty:l,properties:c}=gt(),[u,d]=(0,e.useState)(1),[h,m]=(0,e.useState)(!1),[f,g]=(0,e.useState)({}),[y,v]=(0,e.useState)(null),[x,b]=(0,e.useState)(!1),[w,j]=(0,e.useState)(!1),[S,T]=(0,e.useState)(!1),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(!1),[N,I]=(0,e.useState)(!1),[P,M]=(0,e.useState)([]),[L,R]=(0,e.useState)([]),[D,F]=(0,e.useState)(!1),[O,z]=(0,e.useState)(!1),[B,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1),[H,G]=(0,e.useState)(!1),[Z,K]=(0,e.useState)(null),[Y,X]=(0,e.useState)("environment"),J=(0,e.useRef)(),Q=(0,e.useRef)(null),$=(0,e.useRef)(null),ee=(0,e.useRef)(null),te=(0,e.useRef)(null),re=(null===c||void 0===c?void 0:c.length)||0,ne=null===n&&re>=3,ie=(()=>{if(null===n||null===o||void 0===o||!o.createdAt)return!1;const e=new Date(o.createdAt);return((new Date).getTime()-e.getTime())/36e5>=24})();(0,e.useEffect)(()=>{ne&&b(!0)},[ne]),(0,e.useEffect)(()=>{ee.current&&(ee.current.scrollTop=0),v(null)},[u]);const[se,oe]=(0,e.useState)(o||{title:"",status:"sale",propertyType:"",location:"",latitude:"",longitude:"",state:"",additionalAddress:"",bedrooms:"",bathrooms:"",balconies:"",area:"",carpetArea:"",floor:"",totalFloors:"",facing:"",age:"",furnishing:"",amenities:[],description:"",images:[],price:"",priceNegotiable:!1,maintenanceCharges:"",depositAmount:"",availableForBachelors:!1}),ae=(0,e.useCallback)(()=>{oe(o||{title:"",status:"sale",propertyType:"",location:"",latitude:"",longitude:"",state:"",additionalAddress:"",bedrooms:"",bathrooms:"",balconies:"",area:"",carpetArea:"",floor:"",totalFloors:"",facing:"",age:"",furnishing:"",amenities:[],description:"",images:[],price:"",priceNegotiable:!1,maintenanceCharges:"",depositAmount:"",availableForBachelors:!1}),d(1),g({}),v(null),M([]),R([]),F(!1),U(!1),m(!1),T(!1),A(!1)},[o]),le=((0,e.useCallback)(()=>{I(!0),ae(),E(!1),r()},[ae,r]),(0,e.useCallback)(()=>{u===Rt.length&&!k?E(!0):r()},[u,k,r]));(0,e.useEffect)(()=>{if(w||C)return;const e=e=>{"Escape"===e.key&&le()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[le,w,C]),(0,e.useEffect)(()=>{if(!w)return;const e=e=>{"Escape"===e.key&&(j(!1),r())};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[w,r]),(0,e.useEffect)(()=>{const e=te.current;if(!e)return;const t=t=>{"number"===t.target.type&&e.contains(t.target)&&document.activeElement===t.target&&t.preventDefault()},r=t=>{"ArrowUp"!==t.key&&"ArrowDown"!==t.key||"number"!==t.target.type||!e.contains(t.target)||t.preventDefault()};return e.addEventListener("wheel",t,{passive:!1}),e.addEventListener("keydown",r),()=>{e.removeEventListener("wheel",t),e.removeEventListener("keydown",r)}},[]);const ce=(e,t)=>{let r=t;"string"===typeof t&&["title","location","description"].includes(e)&&(r=yt(t)),oe(n=>{const i=(0,p.A)((0,p.A)({},n),{},{[e]:r});if("propertyType"===e&&"Studio Apartment"===t&&(i.bedrooms="0"),"propertyType"===e&&"Studio Apartment"!==t&&"0"===n.bedrooms&&(i.bedrooms=""),"propertyType"===e){const e=Dt.find(e=>e.value===t);let r=[];if(e)if("Row House/ Farm House"===t)r=Bt.residential_farmhouse;else if("Plot / Land / Indusrtial Property"===t)r=Bt.land_plot;else if("residential"===e.category)r=Bt.residential;else if("commercial"===e.category){const t="".concat(e.category,"_").concat(e.subCategory);r=Bt[t]||Bt.commercial_office}else"pg"===e.category?r=Bt.pg_accommodation:"land"===e.category&&(r=Bt.land_plot);r.length>0&&n.amenities&&(i.amenities=n.amenities.filter(e=>r.includes(e)))}return i}),f[e]&&g(t=>(0,p.A)((0,p.A)({},t),{},{[e]:null})),y&&v(null)},ue=async e=>{var t;W(!1);const r=Array.from(e.target.files||[]),n=(null===(t=se.images)||void 0===t?void 0:t.length)||0;if(n+r.length>10)return void g(e=>(0,p.A)((0,p.A)({},e),{},{images:"Maximum 10 photos allowed. You have ".concat(n," and trying to add ").concat(r.length)}));const i=[];for(const c of r){const e=St(c);e.valid?i.push(c):g(t=>(0,p.A)((0,p.A)({},t),{},{images:e.message}))}if(0===i.length)return;const s=i.map(e=>({file:e,preview:URL.createObjectURL(e),status:"pending",errorMessage:"",imageId:null,imageUrl:null}));M(e=>[...e,...i].slice(0,10)),R(e=>[...e,...s].slice(0,10));const o=i.map(e=>URL.createObjectURL(e));oe(e=>(0,p.A)((0,p.A)({},e),{},{images:[...e.images||[],...o].slice(0,10)})),f.images&&g(e=>(0,p.A)((0,p.A)({},e),{},{images:null})),F(!0);const a=L.length,l=s.map((e,t)=>de(e,a+t));await Promise.all(l),F(!1)},de=async(e,t)=>{R(e=>{const r=[...e];return r[t]&&(r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"checking"})),r});try{var r,i;const o=null!==n?null===(r=c[n])||void 0===r?void 0:r.id:0,a=o<=0,l=new FormData;l.append("image",e.file),l.append("property_id",o),a&&l.append("validate_only","true");const u=localStorage.getItem("authToken");console.log("[Image ".concat(t+1,"] Starting validation..."));const d=await fetch("".concat(q.JR).concat(q.Sn.MODERATE_AND_UPLOAD),{method:"POST",headers:{Authorization:"Bearer ".concat(u)},body:l});if(console.log("[Image ".concat(t+1,"] Response status:"),d.status),!d.ok){const e=await d.text();let r;console.error("[Image ".concat(t+1,"] HTTP Error ").concat(d.status,":"),e);try{r=JSON.parse(e)}catch(s){r={message:e||"HTTP ".concat(d.status," Error")}}return void R(e=>{const n=[...e];return n[t]&&(n[t]=(0,p.A)((0,p.A)({},n[t]),{},{status:"rejected",errorMessage:r.message||"Validation failed",fullErrorMessage:r.message||"HTTP ".concat(d.status," Error")})),n})}const h=await d.json();console.log("[Image ".concat(t+1,"] API Response:"),h);const m=null===(i=h.data)||void 0===i?void 0:i.moderation_status;R(e=>{const r=[...e];var n,i,s;if(r[t])if("success"===h.status&&null!==(n=h.data)&&void 0!==n&&n.image_url)console.log("[Image ".concat(t+1,"] \u2705 Auto-approved for Seller (moderation_status: ").concat(m||"N/A",")")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(i=h.data)||void 0===i?void 0:i.image_id,imageUrl:null===(s=h.data)||void 0===s?void 0:s.image_url,moderationStatus:m||"SAFE"});else if("SAFE"===m){var o,a;console.log("[Image ".concat(t+1,"] \u2705 Approved (SAFE)")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(o=h.data)||void 0===o?void 0:o.image_id,imageUrl:null===(a=h.data)||void 0===a?void 0:a.image_url,moderationStatus:"SAFE"})}else if("error"===h.status||"REJECTED"===m||"UNSAFE"===m){let e=h.message||"Image was rejected";if(console.log("[Image ".concat(t+1,"] \u274c Rejected:"),e),e.includes("animal appearance")){const t=e.match(/\(([^)]+)\)/);e=t?"".concat(t[1]," detected"):"Animal detected"}else e.includes("human appearance")?e="Human detected":e.includes("blurry")?e="Image is too blurry":e.includes("low quality")&&(e="Image quality too low");r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"rejected",errorMessage:e,fullErrorMessage:h.message||"Image was rejected"})}else if("success"===h.status){var l;console.log("[Image ".concat(t+1,"] \u2705 Auto-approved (response missing moderation_status)")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",moderationStatus:"SAFE",imageUrl:(null===(l=h.data)||void 0===l?void 0:l.image_url)||null})}return r}),setTimeout(()=>{he()},500)}catch(o){console.error("[Image ".concat(t+1,"] \u274c Validation error:"),o),console.error("[Image ".concat(t+1,"] Error details:"),{name:o.name,message:o.message,stack:o.stack}),R(e=>{const r=[...e];return r[t]&&(r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"rejected",errorMessage:o.message||"Validation failed. Please check console for details.",fullErrorMessage:o.message||"Failed to validate image. Please try again."})),r})}},he=()=>{if(4===u&&L.length>0){const e=L.every(e=>"approved"===e.status),t=!L.some(e=>"checking"===e.status),r=!L.some(e=>"rejected"===e.status);e&&t&&r&&L.length>0&&setTimeout(()=>{ve()},1e3)}},pe=()=>{ie||W(!0)},me=e=>{var t;(W(!1),"gallery"===e)?null===(t=J.current)||void 0===t||t.click():"camera"===e&&fe()},fe=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void alert("Camera is not supported on this device. Please use gallery upload instead.");const e={video:{facingMode:Y,width:{ideal:1920},height:{ideal:1080}}},t=await navigator.mediaDevices.getUserMedia(e);K(t),G(!0),Q.current&&(Q.current.srcObject=t,Q.current.play())}catch(e){console.error("Error accessing camera:",e),"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?alert("Camera permission denied. Please allow camera access and try again."):"NotFoundError"===e.name||"DevicesNotFoundError"===e.name?alert("No camera found on this device. Please use gallery upload instead."):alert("Failed to access camera. Please try again or use gallery upload.")}},ge=()=>{Z&&(Z.getTracks().forEach(e=>e.stop()),K(null)),Q.current&&(Q.current.srcObject=null),G(!1)};(0,e.useEffect)(()=>()=>{Z&&Z.getTracks().forEach(e=>e.stop())},[Z]);const ye=e=>{var t;se.images&&se.images[e]&&se.images[e].startsWith("blob:")&&URL.revokeObjectURL(se.images[e]),null!==(t=L[e])&&void 0!==t&&t.preview&&L[e].preview.startsWith("blob:")&&URL.revokeObjectURL(L[e].preview),oe(t=>(0,p.A)((0,p.A)({},t),{},{images:t.images.filter((t,r)=>r!==e)})),M(t=>t.filter((t,r)=>r!==e)),R(t=>t.filter((t,r)=>r!==e))},_e=async e=>{var t,r,n,i,s,o,a;const l={};let c=null;switch(e){case 1:if(null!==(t=se.title)&&void 0!==t&&t.trim()){const e=jt(se.title,1,200,"Property title");e.valid||(l.title=e.message)}else l.title="Property name is required";se.status||(l.status="Sell / Rent / PG-Hostel not selected"),se.propertyType||(l.propertyType="Property type not selected"),Object.keys(l).length>0&&(c="Please complete all required fields before proceeding");break;case 2:if(null!==(r=se.location)&&void 0!==r&&r.trim()?se.location.trim().length<5&&(l.location="Location must be at least 5 characters"):l.location="Location is required",se.area){const e="Plot / Land / Indusrtial Property"===se.propertyType?xt:void 0,t=bt(se.area,100,e);t.valid||(l.area=t.message)}else l.area=(se.propertyType,"Area / Carpet area missing");if(se.latitude){const e=(e=>{if(!e)return{valid:!0,message:""};const t=parseFloat(e),r=!isNaN(t)&&t>=-90&&t<=90;return{valid:r,message:r?"":"Latitude must be between -90 and 90"}})(se.latitude);e.valid||(l.latitude=e.message)}if(se.longitude){const e=(e=>{if(!e)return{valid:!0,message:""};const t=parseFloat(e),r=!isNaN(t)&&t>=-180&&t<=180;return{valid:r,message:r?"":"Longitude must be between -180 and 180"}})(se.longitude);e.valid||(l.longitude=e.message)}if(se.carpetArea&&se.area){const e=kt(se.carpetArea,se.area);e.valid||(l.carpetArea=e.message)}if(se.floor&&se.totalFloors){const e=At(se.floor,se.totalFloors);e.valid||(l.floor=e.message)}const e=be();if(e.bedroomsRequired&&!se.bedrooms)l.bedrooms="Bedroom / Bathroom not selected";else if(se.bedrooms){const e=parseInt(se.bedrooms);(isNaN(e)||e<0||e>10)&&(l.bedrooms="Invalid bedroom count")}if(e.bathroomsRequired&&!se.bathrooms)l.bathrooms="Bedroom / Bathroom not selected";else if(se.bathrooms&&"4+"!==se.bathrooms){const t=parseInt(se.bathrooms,10),r=e.bathroomsRequired?1:0;(isNaN(t)||t<r||t>10)&&(l.bathrooms="Invalid bathroom count")}e.showBalconies&&!se.balconies&&(l.balconies="Balconies is required");e.showFloor&&!Ft.includes(se.propertyType)&&!se.floor&&(l.floor="Floor number is required"),e.showTotalFloors&&!se.totalFloors&&(l.totalFloors="Total floors is required"),null!==(n=se.state)&&void 0!==n&&n.trim()||(l.state="State is required"),!e.showFacing||null!==(i=se.facing)&&void 0!==i&&i.trim()||(l.facing="Facing is required"),!e.showAge||null!==(s=se.age)&&void 0!==s&&s.trim()||(l.age="Property age is required"),!e.showFurnishing||null!==(o=se.furnishing)&&void 0!==o&&o.trim()||(l.furnishing="Furnishing status missing"),Object.keys(l).length>0&&(c=l.floor?l.floor:l.carpetArea?l.carpetArea:l.area?l.area:"Please complete all required fields before proceeding");break;case 3:if(se.description&&se.description.trim()){const e=se.description.trim().length;e<100&&(l.description="Description must contain at least 100 characters. Currently: ".concat(e," characters."));/(\+91[\s-]?)?[6-9]\d{9}/g.test(se.description)&&(l.description="Description cannot contain mobile numbers. Please remove any phone numbers.");/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g.test(se.description)&&(l.description="Description cannot contain email addresses. Please remove any email addresses."),se.description.length>1e3&&(l.description="Description cannot exceed 1000 characters.")}else l.description="Description is required";(!se.amenities||se.amenities.length<2)&&(l.amenities="Select at least 2 amenities"),Object.keys(l).length>0&&(c=l.amenities?l.amenities:"Please complete the description with valid content before proceeding");break;case 4:const u=Math.max(L.length,(null===(a=se.images)||void 0===a?void 0:a.length)||0);if(0===u)l.images="Upload at least 3 property images (minimum 3 required)",c="Upload at least 3 property images (minimum 3 required)";else if(u<3)l.images="Upload at least 3 property images (".concat(u,"/3 uploaded)"),c="Upload at least 3 property images (".concat(u,"/3 uploaded)");else if(D)l.images="Please wait while images are being validated",c="Please wait while images are being validated";else if(L.some(e=>"rejected"===e.status)){const e=L.filter(e=>"rejected"===e.status).length;l.images="Please remove ".concat(e," rejected image(s) and upload valid property images only"),c="Please remove ".concat(e," rejected image(s) and upload valid property images only")}else if(L.some(e=>"pending"===e.status||"checking"===e.status))l.images="Please wait for all images to be validated",c="Please wait for all images to be validated";else{const e=L.filter(e=>"approved"===e.status).length;e<3&&(l.images="At least 3 images must be approved (".concat(e,"/").concat(u," approved)"),c="At least 3 images must be approved (".concat(e,"/").concat(u," approved)"))}break;case 5:if(se.price){const e=wt(se.price,se.status);e.valid||(l.price=e.message,c=e.message)}else l.price=(se.status,"Price / Rent / Budget missing"),c="Price / Rent / Budget missing";if("rent"===se.status&&se.depositAmount&&se.price){const e=Tt(se.depositAmount,se.price);e.valid||(l.depositAmount=e.message,c||(c=e.message))}if(se.maintenanceCharges){const e=parseFloat(se.maintenanceCharges);(isNaN(e)||e<0)&&(l.maintenanceCharges="Maintenance charges must be a positive number")}}return g(l),v(c),0===Object.keys(l).length},ve=async()=>{await _e(u)?(v(null),d(e=>Math.min(e+1,5))):setTimeout(()=>{if(ee.current){const e=ee.current.querySelector(".error, .seller-popup-error-text");e?e.scrollIntoView({behavior:"smooth",block:"center"}):ee.current.scrollTop=0}},100)},xe=()=>(0,s.jsxs)("div",{className:"seller-popup-step-content",children:[ie&&(0,s.jsxs)("div",{className:"restricted-edit-warning",style:{padding:"12px 16px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",color:"#856404",fontSize:"14px",lineHeight:"1.5"},children:["\u26a0\ufe0f This property was created more than 24 hours ago. You can only edit the ",(0,s.jsx)("strong",{children:"Title"})," and ",(0,s.jsx)("strong",{children:"Price-related fields"})," (price, price negotiable, maintenance charges, deposit amount). Location-related fields (location, state, additional address) and all other fields are locked."]}),(0,s.jsx)("h3",{className:"step-heading",children:"Basic Information"}),(0,s.jsx)("p",{className:"step-subheading",children:"Let's start with the basic details of your property"}),y&&(0,s.jsx)("span",{className:"seller-popup-error-text seller-popup-step-error",children:y}),(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsxs)("label",{children:["Property Title ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"text",name:"title",placeholder:"e.g., Spacious 3BHK Apartment with Sea View",value:se.title,onChange:e=>ce("title",e.target.value),className:f.title?"error":"",disabled:!1}),f.title&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.title})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"status",children:[(0,s.jsx)("label",{children:"I want to"}),(0,s.jsxs)("div",{className:"toggle-buttons ".concat(f.status?"error":""),children:[(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat("sale"===se.status?"active":""),onClick:()=>!ie&&ce("status","sale"),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\ud83c\udff7\ufe0f"}),"Sell"]}),(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat("rent"===se.status?"active":""),onClick:()=>!ie&&ce("status","rent"),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\ud83d\udd11"}),"Rent / Lease"]})]}),f.status&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.status})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"propertyType",children:[(0,s.jsxs)("label",{children:["Property Type ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"seller-popup-property-type-grid ".concat(f.propertyType?"error":""),children:Dt.map(e=>(0,s.jsxs)("button",{type:"button",className:"property-type-btn ".concat(se.propertyType===e.value?"active":""),onClick:()=>!ie&&ce("propertyType",e.value),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("span",{className:"seller-popup-type-icon",children:e.icon}),(0,s.jsx)("span",{className:"seller-popup-type-label",children:e.value})]},e.value))}),f.propertyType&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.propertyType})]}),"rent"===se.status&&["Apartment","Independent House","Penthouse","Villa / Banglow","Row House/ Farm House","Studio Apartment"].includes(se.propertyType)&&(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsx)("label",{children:"Available for Bachelors"}),(0,s.jsxs)("div",{className:"toggle-buttons",children:[(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat(se.availableForBachelors?"active":""),onClick:()=>!ie&&ce("availableForBachelors",!0),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\u2713"}),"Yes"]}),(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat(se.availableForBachelors?"":"active"),onClick:()=>!ie&&ce("availableForBachelors",!1),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\u2717"}),"No"]})]})]})]}),be=()=>{if(!se.propertyType)return Ot.residential_standard;const e=Dt.find(e=>e.value===se.propertyType);if(!e)return Ot.residential_standard;const t="".concat(e.category,"_").concat(e.subCategory);return Ot[t]||Ot.residential_standard},we=(0,e.useCallback)((e,t)=>{const r="string"===typeof t?t.trim():t,n=be();switch(e){case"title":case"location":return r&&r.length>=3;case"status":return"sale"===t||"rent"===t||"pg-hostel"===t;case"propertyType":return!!t&&Dt.some(e=>e.value===t);case"state":return r&&r.length>=2;case"area":if(!t)return!1;const e="Plot / Land / Indusrtial Property"===se.propertyType;return bt(t,100,e?xt:void 0).valid;case"carpetArea":if(!t)return!0;if(!se.area)return!0;return kt(t,se.area).valid;case"bedrooms":return!n.showBedrooms||!n.bedroomsRequired||!!t;case"bathrooms":return!n.showBathrooms||!n.bathroomsRequired||!!t;case"floor":if(!t||!se.totalFloors)return!0;return At(t,se.totalFloors).valid;case"facing":return!n.showFacing||r&&r.length>=2;case"furnishing":return!n.showFurnishing||r&&r.length>=2;case"description":return!!r&&(r.length>=100&&r.length<=1e3);case"price":if(!t)return!1;return wt(t,se.status).valid;case"depositAmount":if(!t||"rent"!==se.status)return!0;if(!se.price)return!0;return Tt(t,se.price).valid;default:return!1}},[se.area,se.totalFloors,se.status,se.price]),je=(0,e.useCallback)(e=>{const t=be();switch(e){case 1:return["title","status","propertyType"];case 2:const e=["location","state"];t.showBedrooms&&t.bedroomsRequired&&e.push("bedrooms"),t.showBathrooms&&t.bathroomsRequired&&e.push("bathrooms"),e.push("area"),t.showCarpetArea&&e.push("carpetArea");return t.showFloor&&!Ft.includes(se.propertyType)&&e.push("floor"),t.showTotalFloors&&e.push("totalFloors"),t.showFacing&&e.push("facing"),t.showFurnishing&&e.push("furnishing"),e;case 3:return["description"];case 4:default:return[];case 5:const r=["price"];return"rent"===se.status&&r.push("depositAmount"),r}},[se.propertyType,se.status]),Se=je(u);Lt({formData:se,errors:f,validateField:we,fieldOrder:Se,formRef:ee,enabled:u<=3,scrollOffset:50,scrollDelay:400});const Te=be(),ke=()=>{const e=(()=>{if(!se.propertyType)return zt;const e=Dt.find(e=>e.value===se.propertyType);if(!e)return zt;if("Row House/ Farm House"===se.propertyType){const e=Bt.residential_farmhouse;return zt.filter(t=>e.includes(t.id))}if("Plot / Land / Indusrtial Property"===se.propertyType){const e=Bt.land_plot;return zt.filter(t=>e.includes(t.id))}if("residential"===e.category){const e=Bt.residential;return zt.filter(t=>e.includes(t.id))}if("commercial"===e.category){const t="".concat(e.category,"_").concat(e.subCategory),r=Bt[t]||Bt.commercial_office;return zt.filter(e=>r.includes(e.id))}if("pg"===e.category){const e=Bt.pg_accommodation;return zt.filter(t=>e.includes(t.id))}if("land"===e.category){const e=Bt.land_plot;return zt.filter(t=>e.includes(t.id))}return zt})();return(0,s.jsxs)("div",{className:"seller-popup-step-content",children:[ie&&(0,s.jsxs)("div",{className:"restricted-edit-warning",style:{padding:"12px 16px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",color:"#856404",fontSize:"14px",lineHeight:"1.5"},children:["\u26a0\ufe0f This property was created more than 24 hours ago. You can only edit the ",(0,s.jsx)("strong",{children:"Title"})," and ",(0,s.jsx)("strong",{children:"Price-related fields"}),". Location-related fields (location, state, additional address) and all other fields are locked."]}),(0,s.jsx)("h3",{className:"step-heading",children:"Amenities & Description"}),(0,s.jsx)("p",{className:"step-subheading",children:"Select the amenities available and describe your property"}),y&&(0,s.jsx)("span",{className:"seller-popup-error-text seller-popup-step-error",children:y}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"amenities",children:[(0,s.jsxs)("label",{children:["Select Amenities ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"seller-popup-amenities-grid ".concat(f.amenities?"error":""),children:e.map(e=>(0,s.jsxs)("button",{type:"button",className:"amenity-btn ".concat(se.amenities.includes(e.id)?"active":""),onClick:()=>{return!ie&&(t=e.id,oe(e=>(0,p.A)((0,p.A)({},e),{},{amenities:e.amenities.includes(t)?e.amenities.filter(e=>e!==t):[...e.amenities,t]})),f.amenities&&g(e=>(0,p.A)((0,p.A)({},e),{},{amenities:null})),void(y&&v(null)));var t},disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("span",{className:"seller-popup-amenity-icon",children:e.icon}),(0,s.jsx)("span",{className:"seller-popup-amenity-label",children:e.label}),se.amenities.includes(e.id)&&(0,s.jsx)("span",{className:"check-icon",children:"\u2713"})]},e.id))}),f.amenities&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.amenities})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"description",children:[(0,s.jsxs)("label",{children:["Property Description ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("textarea",{name:"description",placeholder:"Describe your property in detail (minimum 100 characters required). Mention unique features, nearby landmarks, connectivity, etc. Note: Mobile numbers and email addresses are not allowed.",value:se.description,onChange:e=>!ie&&ce("description",e.target.value),rows:5,className:f.description?"error":"",disabled:ie}),(0,s.jsxs)("span",{className:"char-count",children:["Characters: ",(se.description||"").length,"/1000 (min: 100)"]}),f.description&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.description})]})]})},Ae=e=>{const t=parseFloat(e);return isNaN(t)?"":t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Crore"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lakh"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(2)," Thousand"):"\u20b9".concat(t)};return(0,s.jsxs)("div",{className:"seller-popup-overlay",children:[x&&(0,s.jsx)("div",{className:"seller-popup-limit-warning-overlay",children:(0,s.jsxs)("div",{className:"seller-popup-limit-warning-modal",children:[(0,s.jsx)("div",{className:"seller-popup-limit-warning-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"seller-popup-limit-warning-content",children:[(0,s.jsx)("h3",{children:"Property Limit Reached"}),(0,s.jsxs)("p",{children:["You've uploaded ",(0,s.jsx)("strong",{children:re})," out of ",(0,s.jsx)("strong",{children:3})," properties allowed in your free plan."]}),(0,s.jsxs)("div",{className:"seller-popup-limit-progress",children:[(0,s.jsx)("div",{className:"seller-popup-limit-progress-bar",children:(0,s.jsx)("div",{className:"seller-popup-limit-progress-fill",style:{width:"".concat(re/3*100,"%")}})}),(0,s.jsxs)("span",{className:"seller-popup-limit-progress-text",children:[re,"/",3," Properties Used"]})]}),(0,s.jsxs)("div",{className:"seller-popup-limit-warning-features",children:[(0,s.jsx)("p",{className:"seller-popup-features-title",children:"Upgrade to Pro to unlock:"}),(0,s.jsxs)("ul",{children:[(0,s.jsxs)("li",{children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"More property listings"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Priority placement in search"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Advanced analytics & insights"]}),(0,s.jsxs)("li",{children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Dedicated support"]})]})]})]}),(0,s.jsxs)("div",{className:"seller-popup-limit-warning-actions",children:[(0,s.jsx)("button",{className:"seller-popup-limit-btn-secondary",onClick:r,children:"Maybe Later"}),(0,s.jsxs)("button",{className:"seller-popup-limit-btn-primary",onClick:()=>{r(),window.location.href="/subscription"},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 2L15.09 8.26L22 9.27L17 14.14L18.18 21.02L12 17.77L5.82 21.02L7 14.14L2 9.27L8.91 8.26L12 2Z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",fill:"currentColor"})}),"Upgrade to Pro"]})]}),(0,s.jsx)("button",{className:"seller-popup-limit-warning-close",onClick:r,"aria-label":"Close",children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})}),(0,s.jsx)(Mt,{isOpen:w,redirectPath:"/seller-dashboard/properties",onClose:()=>{j(!1),r()}}),C&&(0,s.jsx)("div",{className:"seller-popup-overlay",style:{zIndex:1e4},children:(0,s.jsxs)("div",{className:"seller-popup-container",style:{maxWidth:"500px"},children:[(0,s.jsxs)("div",{className:"seller-popup-header",children:[(0,s.jsx)("h2",{children:"Publishing Not Completed"}),(0,s.jsx)("button",{className:"seller-popup-close-btn",onClick:()=>E(!1),"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"seller-popup-body",style:{padding:"2rem"},children:(0,s.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",style:{margin:"0 auto 1rem",color:"var(--warning-color, #f59e0b)"},children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsxs)("p",{style:{fontSize:"1rem",lineHeight:"1.6",color:"var(--text-color, #333)"},children:["You haven't published this property yet.",(0,s.jsx)("br",{}),"Please publish before closing, or your data will be lost."]})]})}),(0,s.jsx)("div",{className:"seller-popup-footer",style:{justifyContent:"center",gap:"1rem"},children:(0,s.jsx)("button",{type:"button",className:"seller-popup-cancel-btn",onClick:()=>E(!1),children:"Continue Editing"})})]})}),!x&&!w&&!C&&(0,s.jsxs)("div",{className:"seller-popup-container",ref:te,role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"seller-popup-header",children:[(0,s.jsx)("h2",{children:null!==n?"Edit Property":"List Your Property"}),(0,s.jsx)("button",{className:"seller-popup-close-btn",onClick:le,"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"seller-popup-step-indicator",children:Rt.map((e,t)=>{const r=(n=e.id,u>n);var n;const i=r||e.id===u;return(0,s.jsxs)("div",{className:"seller-popup-step-item ".concat(u===e.id?"active":""," ").concat(r?"completed":""," ").concat(i?"clickable":""),children:[(0,s.jsx)("div",{className:"seller-popup-step-circle",onClick:()=>i&&(async e=>{e!==u&&e<u&&d(e)})(e.id),style:{cursor:i?"pointer":"default"},title:!i&&e.id>u?"Complete current step first":i&&r?"Click to go back to this step":"",children:r?(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,s.jsx)("span",{children:e.icon})}),(0,s.jsx)("span",{className:"seller-popup-step-title",children:e.title}),t<Rt.length-1&&(0,s.jsx)("div",{className:"step-line"})]},e.id)})}),(0,s.jsx)("div",{className:"seller-popup-body",ref:ee,children:(()=>{switch(u){case 1:default:return xe();case 2:return(0,s.jsxs)("div",{className:"seller-popup-step-content",children:[ie&&(0,s.jsxs)("div",{className:"restricted-edit-warning",style:{padding:"12px 16px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",color:"#856404",fontSize:"14px",lineHeight:"1.5"},children:["\u26a0\ufe0f This property was created more than 24 hours ago. You can only edit the ",(0,s.jsx)("strong",{children:"Title"})," and ",(0,s.jsx)("strong",{children:"Price-related fields"}),". Location-related fields (location, state, additional address) and all other fields are locked."]}),(0,s.jsx)("h3",{className:"step-heading",children:"Property Details"}),(0,s.jsx)("p",{className:"step-subheading",children:"Tell us more about your property specifications"}),y&&(0,s.jsx)("span",{className:"seller-popup-error-text seller-popup-step-error",children:y}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"location",children:[(0,s.jsxs)("label",{children:["Location ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)(_,{placeholder:"Enter locality, area or landmark",value:se.location,onChange:e=>{if(ie)return;if(!e)return oe(e=>(0,p.A)((0,p.A)({},e),{},{location:"",latitude:"",longitude:""})),void U(!1);const t=e.state||"",r=!!t;oe(r=>{var n,i,s,o;return(0,p.A)((0,p.A)({},r),{},{location:e.fullAddress||e.placeName||"",latitude:null!==(n=null===(i=e.coordinates)||void 0===i?void 0:i.lat)&&void 0!==n?n:"",longitude:null!==(s=null===(o=e.coordinates)||void 0===o?void 0:o.lng)&&void 0!==s?s:"",state:t})}),U(r),(f.location||f.state)&&g(e=>(0,p.A)((0,p.A)({},e),{},{location:null,state:null})),y&&v(null)},className:f.location?"seller-location-error":"",error:f.location,disabled:ie})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsx)("label",{children:"Property Location on Map (Optional)"}),se.latitude&&se.longitude?(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,s.jsx)("span",{className:"location-icon",style:{fontSize:"18px"},children:"\ud83d\udccd"}),(0,s.jsx)("div",{style:{flex:1},children:(0,s.jsx)("span",{style:{fontSize:"0.875rem",color:"#059669",fontWeight:"500"},children:"Location set on map"})})]}),(0,s.jsxs)("small",{className:"location-picker-coordinates",style:{marginLeft:"26px",fontSize:"0.75rem",color:"#059669",fontFamily:"monospace"},children:["Coordinates: ",parseFloat(se.latitude).toFixed(6),", ",parseFloat(se.longitude).toFixed(6)]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,s.jsx)("button",{type:"button",className:"location-picker-change-btn",onClick:()=>!ie&&z(!0),disabled:ie,title:ie?"Location cannot be changed after 24 hours":"Change location",style:{padding:"6px 12px",fontSize:"0.875rem",backgroundColor:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"6px",cursor:ie?"not-allowed":"pointer",color:ie?"#9ca3af":"#374151",fontWeight:"500",opacity:ie?.5:1},children:"Change Location"}),(0,s.jsx)("button",{type:"button",onClick:()=>{ie||oe(e=>(0,p.A)((0,p.A)({},e),{},{latitude:"",longitude:""}))},disabled:ie,title:ie?"Location cannot be removed after 24 hours":"Remove location",style:{padding:"6px 12px",fontSize:"0.875rem",backgroundColor:"#fee2e2",border:"1px solid #fecaca",borderRadius:"6px",cursor:ie?"not-allowed":"pointer",color:ie?"#d1d5db":"#991b1b",fontWeight:"500",opacity:ie?.5:1},children:"Remove"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{type:"button",className:"location-picker-btn",onClick:()=>!ie&&z(!0),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",style:{marginRight:"8px"},children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Add Location on Map"})]}),(0,s.jsx)("span",{className:"seller-popup-hint",children:"Select exact location on map for better visibility"})]})]}),(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"state",children:[(0,s.jsxs)("label",{children:["State ",(0,s.jsx)("span",{className:"required",children:"*"}),B&&!ie&&(0,s.jsx)("span",{style:{fontSize:"0.75rem",color:"#059669",marginLeft:"8px",fontWeight:"normal"},children:"(Auto-filled from map)"})]}),(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsx)(Pt,{placeholder:"Enter state",value:se.state||"",onChange:e=>{ie||(ce("state",e),B&&e!==se.state&&U(!1))},className:f.state?"seller-state-error":"",error:f.state,disabled:ie,readOnly:B&&!ie}),B&&!ie&&(0,s.jsx)("button",{type:"button",onClick:()=>{U(!1)},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"#7c3aed",cursor:"pointer",fontSize:"0.75rem",fontWeight:"600",padding:"4px 8px",borderRadius:"4px",zIndex:10},title:"Edit state manually",children:"Edit"})]})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsx)("label",{children:"Additional Address (Optional)"}),(0,s.jsx)("input",{type:"text",placeholder:"Enter additional address details",value:se.additionalAddress||"",onChange:e=>!ie&&ce("additionalAddress",e.target.value),disabled:ie})]})]}),(Te.showBedrooms||Te.showBathrooms||Te.showBalconies)&&(0,s.jsxs)("div",{className:"form-row three-cols",children:[Te.showBedrooms&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"bedrooms",children:[(0,s.jsxs)("label",{children:["Studio Apartment"===se.propertyType?"Studio":"Bedrooms",Te.bedroomsRequired&&(0,s.jsx)("span",{className:"required",children:"*"})]}),"Studio Apartment"===se.propertyType?(0,s.jsx)("div",{className:"number-selector",children:(0,s.jsx)("button",{type:"button",className:"num-btn active",disabled:!0,style:{cursor:"not-allowed",opacity:.7},children:"Studio"})}):(0,s.jsx)("div",{className:"number-selector ".concat(f.bedrooms?"error":""),children:["1","2","3","4","5","5+"].map(e=>(0,s.jsx)("button",{type:"button",className:"num-btn ".concat(se.bedrooms===e?"active":""),onClick:()=>!ie&&ce("bedrooms",e),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:e},e))}),f.bedrooms&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.bedrooms})]}),Te.showBathrooms&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"bathrooms",children:[(0,s.jsxs)("label",{children:["Bathrooms ",Te.bathroomsRequired&&(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"number-selector ".concat(f.bathrooms?"error":""),children:(Te.bathroomsRequired?["1","2","3","4","4+"]:["0","1","2","3","4","4+"]).map(e=>(0,s.jsx)("button",{type:"button",className:"num-btn ".concat(se.bathrooms===e?"active":""),onClick:()=>!ie&&ce("bathrooms",e),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:e},e))}),f.bathrooms&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.bathrooms})]}),Te.showBalconies&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"balconies",children:[(0,s.jsxs)("label",{children:["Balconies ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"number-selector ".concat(f.balconies?"error":""),children:["0","1","2","3","3+"].map(e=>(0,s.jsx)("button",{type:"button",className:"num-btn ".concat(se.balconies===e?"active":""),onClick:()=>!ie&&ce("balconies",e),disabled:ie,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:e},e))}),f.balconies&&(0,s.jsx)("span",{className:"seller-popup-error-text error-message",children:f.balconies})]})]}),(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"area",children:[(0,s.jsxs)("label",{children:["Plot / Land / Indusrtial Property"===se.propertyType?"Plot Area":"Built-up Area",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("div",{className:"input-with-suffix",children:[(0,s.jsx)("input",{type:"number",name:"area",placeholder:"Plot / Land / Indusrtial Property"===se.propertyType?"Enter plot area":"Enter area",value:se.area,onChange:e=>!ie&&ce("area",e.target.value),className:f.area?"error":"",disabled:ie}),(0,s.jsx)("span",{className:"suffix",children:"sq.ft"})]}),f.area&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.area})]}),Te.showCarpetArea&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"carpetArea",children:[(0,s.jsx)("label",{children:"Carpet Area"}),(0,s.jsxs)("div",{className:"input-with-suffix",children:[(0,s.jsx)("input",{type:"number",name:"carpetArea",placeholder:"Enter area",value:se.carpetArea,onChange:e=>!ie&&ce("carpetArea",e.target.value),disabled:ie}),(0,s.jsx)("span",{className:"suffix",children:"sq.ft"})]})]})]}),(Te.showFloor||Te.showTotalFloors)&&(0,s.jsxs)("div",{className:"form-row two-cols",children:[Te.showFloor&&!Ft.includes(se.propertyType)&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"floor",children:[(0,s.jsxs)("label",{children:["Floor Number ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"number",name:"floor",min:0,step:1,placeholder:"e.g., 5",value:se.floor,onChange:e=>{if(ie)return;const t=e.target.value;(""===t||/^\d+$/.test(t))&&ce("floor",t)},disabled:ie}),f.floor&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.floor})]}),Te.showTotalFloors&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"totalFloors",children:[(0,s.jsxs)("label",{children:["Total Floors ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"number",placeholder:"Total floors in building",value:se.totalFloors,onChange:e=>!ie&&ce("totalFloors",e.target.value),disabled:ie}),f.totalFloors&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.totalFloors})]})]}),(Te.showFacing||Te.showAge||Te.showFurnishing)&&(0,s.jsxs)("div",{className:"form-row three-cols",children:[Te.showFacing&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"facing",children:[(0,s.jsxs)("label",{children:["Facing ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("select",{name:"facing",value:se.facing,onChange:e=>!ie&&ce("facing",e.target.value),disabled:ie,className:f.facing?"error":"",children:[(0,s.jsx)("option",{value:"",children:"Select"}),Vt.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),f.facing&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.facing})]}),Te.showAge&&(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"age",children:[(0,s.jsxs)("label",{children:["Property Age ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("select",{value:se.age,onChange:e=>!ie&&ce("age",e.target.value),disabled:ie,children:[(0,s.jsx)("option",{value:"",children:"Select"}),qt.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),f.age&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.age})]}),Te.showFurnishing&&(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsxs)("label",{children:["Furnishing ",Te.showFurnishing&&(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("select",{value:se.furnishing,onChange:e=>!ie&&ce("furnishing",e.target.value),disabled:ie,className:f.furnishing?"error":"",children:[(0,s.jsx)("option",{value:"",children:"Select"}),Ut.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),f.furnishing&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.furnishing})]})]})]});case 3:return ke();case 4:return(()=>{var e;return(0,s.jsxs)("div",{className:"seller-popup-step-content",children:[ie&&(0,s.jsxs)("div",{className:"restricted-edit-warning",style:{padding:"12px 16px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",color:"#856404",fontSize:"14px",lineHeight:"1.5"},children:["\u26a0\ufe0f This property was created more than 24 hours ago. You can only edit the ",(0,s.jsx)("strong",{children:"Title"})," and ",(0,s.jsx)("strong",{children:"Price-related fields"}),". Location-related fields (location, state, additional address) and all other fields are locked."]}),(0,s.jsx)("h3",{className:"step-heading",children:"Upload Photos"}),(0,s.jsx)("p",{className:"step-subheading",children:"Add up to 10 high-quality photos of your property (minimum 3 required)"}),y&&(0,s.jsx)("span",{className:"seller-popup-error-text seller-popup-step-error",children:y}),(0,s.jsxs)("div",{className:"upload-zone ".concat(f.images?"error":""),onClick:pe,style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer"},children:[(0,s.jsx)("input",{ref:J,type:"file",accept:"image/*",multiple:!0,onChange:ue,style:{display:"none"}}),(0,s.jsx)("canvas",{ref:$,style:{display:"none"}}),(0,s.jsxs)("div",{className:"upload-content",children:[(0,s.jsx)("div",{className:"seller-popup-upload-icon",children:(0,s.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("h4",{children:"Drag & drop your photos here"}),(0,s.jsx)("p",{children:"or click to browse from your device"}),(0,s.jsx)("span",{className:"seller-popup-upload-hint",children:"Supports: JPG, PNG, WEBP (Max 5MB each)"})]})]}),f.images&&(0,s.jsx)("span",{className:"seller-popup-error-text center",children:f.images}),(null===(e=se.images)||void 0===e?void 0:e.length)>0&&(0,s.jsxs)("div",{className:"image-preview-section",children:[(0,s.jsxs)("div",{className:"preview-header",children:[(0,s.jsxs)("span",{children:["Uploaded Photos (",se.images.length,"/10)"]}),(0,s.jsx)("button",{type:"button",className:"add-more-btn",onClick:()=>{var e;return!ie&&(null===(e=J.current)||void 0===e?void 0:e.click())},disabled:ie||D,style:{opacity:ie||D?.5:1,cursor:ie||D?"not-allowed":"pointer"},children:"+ Add More"})]}),(0,s.jsx)("div",{className:"image-preview-grid",children:se.images.map((e,t)=>{const r=L[t]||{status:"pending",errorMessage:""};return(0,s.jsxs)("div",{className:"preview-item image-validation-item ".concat(r.status),children:[(0,s.jsx)("img",{src:e,alt:"Preview ".concat(t+1)}),0===t&&(0,s.jsx)("span",{className:"cover-badge",children:"Cover"}),"checking"===r.status&&(0,s.jsx)("div",{className:"validation-overlay checking-overlay",children:(0,s.jsx)("div",{className:"overlay-content",children:(0,s.jsx)("p",{className:"status-message-text",children:"Checking..."})})}),"approved"===r.status&&(0,s.jsx)("div",{className:"validation-overlay approved-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("svg",{className:"checkmark",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("p",{className:"approved-text",children:"Approved"})]})}),"rejected"===r.status&&(0,s.jsx)("div",{className:"validation-overlay rejected-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("svg",{className:"x-icon",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})}),(0,s.jsx)("p",{className:"rejected-title",children:"REJECTED"}),(0,s.jsx)("p",{className:"rejected-message",children:r.errorMessage||"Image rejected"}),(0,s.jsx)("button",{type:"button",className:"remove-rejected-btn",onClick:()=>!ie&&ye(t),disabled:ie,children:"Remove & Try Again"})]})}),"approved"===r.status&&(0,s.jsx)("div",{className:"status-badge approved-badge",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),"rejected"===r.status&&(0,s.jsx)("div",{className:"status-badge rejected-badge",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),"checking"!==r.status&&(0,s.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>!ie&&ye(t),disabled:ie,title:"Remove image",style:{opacity:ie?.5:1,cursor:ie?"not-allowed":"pointer",zIndex:20},children:"\u2715"})]},t)})}),L.some(e=>"rejected"===e.status)&&(0,s.jsxs)("div",{className:"image-validation-warning",children:[(0,s.jsx)("strong",{children:"\u26a0\ufe0f Remove rejected images to continue"}),(0,s.jsxs)("p",{style:{margin:"4px 0 0 0",fontSize:"13px"},children:[L.filter(e=>"rejected"===e.status).length," image(s) were rejected. Please remove them and upload valid property images only."]})]}),L.length>0&&L.every(e=>"approved"===e.status)&&!D&&(0,s.jsxs)("div",{className:"image-validation-success",style:{background:"#e8f5e9",color:"#2e7d32",padding:"12px",borderRadius:"4px",marginTop:"16px",fontSize:"14px",border:"1px solid #4CAF50",display:"flex",alignItems:"center",gap:"8px"},children:[(0,s.jsx)("span",{children:"\u2705"}),(0,s.jsx)("span",{children:"All images approved! Proceeding to next step..."})]})]})]})})();case 5:return(()=>{var e;return(0,s.jsxs)("div",{className:"seller-popup-step-content",children:[ie&&(0,s.jsxs)("div",{className:"restricted-edit-warning",style:{padding:"12px 16px",backgroundColor:"#fff3cd",border:"1px solid #ffc107",borderRadius:"8px",marginBottom:"20px",color:"#856404",fontSize:"14px",lineHeight:"1.5"},children:["\u26a0\ufe0f This property was created more than 24 hours ago. You can only edit the ",(0,s.jsx)("strong",{children:"Title"})," and ",(0,s.jsx)("strong",{children:"Price-related fields"})," (price, price negotiable, maintenance charges, deposit amount). Location-related fields (location, state, additional address) and all other fields are locked."]}),(0,s.jsx)("h3",{className:"step-heading",children:"Pricing Details"}),(0,s.jsx)("p",{className:"step-subheading",children:"Set the right price for your property"}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"price",children:[(0,s.jsxs)("label",{children:["sale"===se.status?"Expected Price":"Monthly Rent",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",name:"price",placeholder:"sale"===se.status?"Enter expected price":"Enter monthly rent",value:se.price,onChange:e=>ce("price",e.target.value),className:f.price?"error":""})]}),se.price&&(0,s.jsx)("span",{className:"price-words",children:Ae(se.price)}),f.price&&(0,s.jsx)("span",{className:"seller-popup-error-text",children:f.price})]}),(0,s.jsx)("div",{className:"seller-popup-form-group",children:(0,s.jsxs)("label",{className:"checkbox-label",children:[(0,s.jsx)("input",{type:"checkbox",checked:se.priceNegotiable,onChange:e=>ce("priceNegotiable",e.target.checked)}),(0,s.jsx)("span",{className:"checkmark"}),"Price is negotiable"]})}),"rent"===se.status&&(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"depositAmount",children:[(0,s.jsx)("label",{children:"Security Deposit"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",name:"depositAmount",placeholder:"Enter deposit amount",value:se.depositAmount,onChange:e=>ce("depositAmount",e.target.value)})]}),se.depositAmount&&(0,s.jsx)("span",{className:"price-words",children:Ae(se.depositAmount)})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsx)("label",{children:"Maintenance (per month)"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",placeholder:"Enter maintenance",value:se.maintenanceCharges,onChange:e=>ce("maintenanceCharges",e.target.value)})]}),se.maintenanceCharges&&(0,s.jsx)("span",{className:"price-words",children:Ae(se.maintenanceCharges)})]})]}),"sale"===se.status&&(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsx)("label",{children:"Maintenance (per month)"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",placeholder:"Enter monthly maintenance",value:se.maintenanceCharges,onChange:e=>ce("maintenanceCharges",e.target.value)})]}),se.maintenanceCharges&&(0,s.jsx)("span",{className:"price-words",children:Ae(se.maintenanceCharges)})]}),(0,s.jsxs)("div",{className:"seller-popup-listing-summary",children:[(0,s.jsx)("h4",{children:"Listing Summary"}),(0,s.jsxs)("div",{className:"seller-popup-summary-grid",children:[(0,s.jsxs)("div",{className:"seller-popup-summary-item",children:[(0,s.jsx)("span",{className:"seller-popup-summary-label",children:"Property"}),(0,s.jsx)("span",{className:"seller-popup-summary-value",children:se.title||"-"})]}),(0,s.jsxs)("div",{className:"seller-popup-summary-item",children:[(0,s.jsx)("span",{className:"seller-popup-summary-label",children:"Type"}),(0,s.jsx)("span",{className:"seller-popup-summary-value",children:se.propertyType||"-"})]}),(0,s.jsxs)("div",{className:"seller-popup-summary-item",children:[(0,s.jsx)("span",{className:"seller-popup-summary-label",children:"Location"}),(0,s.jsx)("span",{className:"seller-popup-summary-value",children:se.location||"-"})]}),(0,s.jsxs)("div",{className:"seller-popup-summary-item",children:[(0,s.jsx)("span",{className:"seller-popup-summary-label",children:"Configuration"}),(0,s.jsx)("span",{className:"seller-popup-summary-value",children:se.bedrooms?"".concat(se.bedrooms," BHK"):"-"})]}),(0,s.jsxs)("div",{className:"seller-popup-summary-item",children:[(0,s.jsx)("span",{className:"seller-popup-summary-label",children:"Area"}),(0,s.jsx)("span",{className:"seller-popup-summary-value",children:se.area?"".concat(se.area," sq.ft"):"-"})]}),(0,s.jsxs)("div",{className:"seller-popup-summary-item",children:[(0,s.jsx)("span",{className:"seller-popup-summary-label",children:"Photos"}),(0,s.jsxs)("span",{className:"seller-popup-summary-value",children:[(null===(e=se.images)||void 0===e?void 0:e.length)||0," uploaded"]})]})]})]})]})})()}})()}),(0,s.jsxs)("div",{className:"seller-popup-footer",children:[u>1&&(0,s.jsxs)("button",{type:"button",className:"seller-popup-back-btn",onClick:()=>{d(e=>Math.max(e-1,1))},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Back"]}),(0,s.jsxs)("div",{className:"seller-popup-footer-right",children:[(0,s.jsx)("button",{type:"button",className:"seller-popup-cancel-btn",onClick:le,children:"Cancel"}),u<5?(0,s.jsxs)("button",{type:"button",className:"seller-popup-next-btn ".concat(D||L.some(e=>"rejected"===e.status)?"disabled":""),onClick:ve,disabled:D||L.some(e=>"rejected"===e.status),children:["Next",(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}):(0,s.jsx)("button",{type:"button",className:"seller-popup-submit-btn",onClick:async()=>{if(N)return void console.log("Publishing blocked: Form was discarded");if(await _e(u)){m(!0),T(!0);try{let u=[],y=null;var e;if(null!==n)y=null===(e=c[n])||void 0===e?void 0:e.id;if(null!==n&&P.length>0)try{const e=P.map(async(e,t)=>{try{const n=await i.NY.uploadImage(e,y);if(n.success&&n.data&&n.data.url){const e=n.data.moderation_status;return"UNSAFE"===e?{success:!1,index:t,error:n.data.moderation_reason||"Image rejected by moderation system"}:("NEEDS_REVIEW"===e&&console.log("Image ".concat(t+1," is under review:"),n.data.moderation_reason),{success:!0,url:n.data.url,index:t,moderationStatus:e})}{var r;const e=n.data||{},i=e.moderation_status;let s=n.message||(null===(r=e.errors)||void 0===r?void 0:r[0])||"Upload failed";return"UNSAFE"===i&&e.moderation_reason&&(s=e.moderation_reason),console.error("Image ".concat(t+1," upload failed:"),s),{success:!1,index:t,error:s}}}catch(n){return console.error("Image ".concat(t+1," upload error:"),n),{success:!1,index:t,error:n.message||"Upload failed"}}}),t=await Promise.all(e),r=t.filter(e=>e.success),n=t.filter(e=>!e.success);if(n.length>0){const e=n.map(e=>e.error).filter(Boolean),t=[...new Set(e)],r=n.length===P.length?"Failed to upload all images. ".concat(t[0]||"Please check server permissions and try again."):"Failed to upload ".concat(n.length," of ").concat(P.length," images. ").concat(t.join("; "));return alert(r),T(!1),void m(!1)}u=r.map(e=>e.url),u.length>0&&(se.images=[...(se.images||[]).filter(e=>"string"===typeof e&&!e.startsWith("blob:")),...u])}catch(d){return console.error("Image upload error:",d),alert("Failed to upload images: ".concat(d.message||"Please check server permissions and try again.")),T(!1),void m(!1)}else null!==n&&se.images&&se.images.length>0&&(u=se.images.filter(e=>"string"===typeof e&&!e.startsWith("blob:")),se.images=u);if(T(!1),null===n){const e=(0,p.A)((0,p.A)({},se),{},{images:[]});let r;try{r=await a(e)}catch(h){throw console.error("Property creation failed:",h),new Error("Failed to create property. Please try again.")}if(!r||!r.id)throw new Error("Failed to get property ID after creation. Please refresh and try again.");if(y=r.id,P.length>0){T(!0);try{const e=P.map(async(e,t)=>{try{const r=await i.NY.uploadImage(e,y);if(r.success&&r.data&&r.data.url){const e=r.data.moderation_status;return"SAFE"===e?{success:!0,url:r.data.url,index:t,moderationStatus:"SAFE"}:"PENDING"===e||"NEEDS_REVIEW"===e||r.pending?(console.log("Image ".concat(t+1," is under review:"),r.data.moderation_reason||r.message),{success:!0,url:r.data.url,index:t,moderationStatus:e||"PENDING",pending:!0}):(console.warn("Image ".concat(t+1," response missing moderation_status, treating as pending review")),{success:!0,url:r.data.url,index:t,moderationStatus:"PENDING",pending:!0})}return{success:!1,index:t,error:r.message||"Upload failed"}}catch(h){console.error("Image ".concat(t+1," upload error:"),h);let r="Upload failed";return h.message?r=h.message:h.details&&h.details.detected_issue&&(r=h.details.detected_issue),{success:!1,index:t,error:r,error_code:h.error_code,rejected:h.rejected||!1}}}),r=await Promise.all(e),n=r.filter(e=>e.success);if(r.filter(e=>!e.success).length>0)return n.length>0&&(u=n.map(e=>e.url),await i.NY.update(y,{images:u})),T(!1),m(!1),A(!0),void j(!0);if(u=n.map(e=>e.url),u.length>0)try{await i.NY.update(y,{images:u})}catch(f){console.error("Failed to update property with images:",f)}if(se.video&&se.video.file&&y)try{var t;console.log("Uploading video for property ID:",y);const e=await i.NY.uploadVideo(se.video.file,y);e.success&&null!==(t=e.data)&&void 0!==t&&t.url&&console.log("Video uploaded successfully:",e.data.url)}catch(g){console.error("Video upload error:",g)}T(!1),m(!1),A(!0),j(!0)}catch(d){console.error("Image upload error:",d),T(!1),m(!1),A(!0),j(!0)}}else A(!0),j(!0)}else{var r;const e=null===(r=c[n])||void 0===r?void 0:r.id;if(e){var s;if(se.video&&se.video.file)try{var o;console.log("Uploading video for property ID:",e);const t=await i.NY.uploadVideo(se.video.file,e);t.success&&null!==(o=t.data)&&void 0!==o&&o.url&&(se.videoUrl=t.data.url,console.log("Video uploaded successfully:",t.data.url))}catch(g){console.error("Video upload error:",g)}const t=(0,p.A)({},se);return t.images&&Array.isArray(t.images)&&(t.images=t.images.filter(e=>"string"===typeof e&&!e.startsWith("blob:")).map(e=>(e.startsWith("http://")||e.startsWith("https://")||e.startsWith("/"),e))),console.log("Updating property with data:",{propertyId:e,images:t.images,imageCount:(null===(s=t.images)||void 0===s?void 0:s.length)||0}),await l(e,t),T(!1),m(!1),A(!0),void j(!0)}}}catch(h){T(!1);const e=h.message||401===h.status?"Authentication required. Please log in to add properties.":403===h.status?"Access denied. Please check your permissions.":"Failed to save property. Please check your connection and try again.";alert(e),console.error("Property save error:",h)}finally{m(!1)}}},disabled:h||S||N,children:S?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"seller-popup-spinner"}),"Uploading Images..."]}):h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"seller-popup-spinner"}),"Publishing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),null!==n?"Update Property":"Publish Listing"]})})]})]})]}),V&&(0,s.jsx)("div",{className:"camera-action-selector-overlay",onClick:e=>{e.target.classList.contains("camera-action-selector-overlay")&&W(!1)},children:(0,s.jsxs)("div",{className:"camera-action-selector-modal",children:[(0,s.jsx)("h3",{children:"Choose Upload Method"}),(0,s.jsxs)("div",{className:"camera-action-buttons",children:[(0,s.jsxs)("button",{type:"button",className:"camera-action-btn gallery-btn",onClick:()=>me("gallery"),children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 19V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Upload from Gallery"})]}),(0,s.jsxs)("button",{type:"button",className:"camera-action-btn camera-btn",onClick:()=>me("camera"),children:[(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Use Camera"})]})]}),(0,s.jsx)("button",{type:"button",className:"camera-action-close-btn",onClick:()=>W(!1),children:"Cancel"})]})}),H&&(0,s.jsx)("div",{className:"camera-capture-overlay",children:(0,s.jsxs)("div",{className:"camera-capture-modal",children:[(0,s.jsxs)("div",{className:"camera-capture-header",children:[(0,s.jsx)("h3",{children:"Take Photo"}),(0,s.jsx)("button",{type:"button",className:"camera-close-btn",onClick:ge,"aria-label":"Close camera",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"camera-preview-container",children:(0,s.jsx)("video",{ref:Q,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-preview-video"})}),(0,s.jsxs)("div",{className:"camera-controls",children:[(0,s.jsx)("button",{type:"button",className:"camera-flip-btn",onClick:async()=>{const e="environment"===Y?"user":"environment";X(e),Z&&Z.getTracks().forEach(e=>e.stop());try{const t={video:{facingMode:e,width:{ideal:1920},height:{ideal:1080}}},r=await navigator.mediaDevices.getUserMedia(t);K(r),Q.current&&(Q.current.srcObject=r,Q.current.play())}catch(t){console.error("Error flipping camera:",t),alert("Failed to switch camera. Please try again.")}},"aria-label":"Flip camera",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M17 1l4 4-4 4M21 5H11M7 23l-4-4 4-4M3 19h10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 12a3 3 0 11-6 0 3 3 0 016 0z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{type:"button",className:"camera-capture-btn",onClick:()=>{if(!Q.current||!$.current)return;const e=Q.current,t=$.current,r=t.getContext("2d");t.width=e.videoWidth,t.height=e.videoHeight,r.drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{if(!e)return void alert("Failed to capture image. Please try again.");const t={target:{files:[new File([e],"camera-capture-".concat(Date.now(),".jpg"),{type:"image/jpeg",lastModified:Date.now()})]}};ge(),ue(t)},"image/jpeg",.95)},"aria-label":"Capture photo",children:(0,s.jsx)("div",{className:"camera-capture-circle",children:(0,s.jsx)("div",{className:"camera-capture-inner"})})}),(0,s.jsx)("button",{type:"button",className:"camera-cancel-btn",onClick:ge,"aria-label":"Cancel",children:"Cancel"})]})]})}),O&&(0,s.jsx)("div",{className:"location-picker-modal-overlay",onClick:e=>{e.target.classList.contains("location-picker-modal-overlay")&&z(!1)},children:(0,s.jsx)(Et,{initialLocation:se.latitude&&se.longitude?{latitude:parseFloat(se.latitude),longitude:parseFloat(se.longitude),fullAddress:se.location}:null,onLocationChange:e=>{if(ie)return;const t=e.state||"",r=!!t;oe(r=>(0,p.A)((0,p.A)({},r),{},{latitude:e.latitude.toString(),longitude:e.longitude.toString(),location:e.fullAddress||r.location,state:t})),U(r),z(!1),(f.location||f.state)&&g(e=>(0,p.A)((0,p.A)({},e),{},{location:null,state:null})),y&&v(null)},onClose:()=>z(!1)})})]})}const Ht=t=>{var r;let{onNavigate:i}=t;const{user:o}=l(),a=(0,n.Zp)(),{properties:c,inquiries:u,getStats:d,refreshProperties:h}=gt(),[p,m]=(0,e.useState)(!1),f=d();(0,e.useEffect)(()=>{const e=()=>{h&&h()};h&&h(),window.addEventListener("focus",e);const t=setInterval(()=>{h&&h()},3e4);return()=>{window.removeEventListener("focus",e),clearInterval(t)}},[h]);const g=()=>{c.length>=10?alert("You can add maximum ".concat(10," properties.")):m(!0)},y=e=>{const t=parseFloat(e);return t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Cr"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lac"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(1),"K"):"\u20b9".concat(t)},_=e=>{const t=new Date(e),r=new Date-t,n=Math.floor(r/6e4),i=Math.floor(r/36e5),s=Math.floor(r/864e5);return n<60?"".concat(n,"m ago"):i<24?"".concat(i,"h ago"):s<7?"".concat(s,"d ago"):t.toLocaleDateString("en-IN",{day:"numeric",month:"short"})},v=u.filter(e=>"new"===e.status).slice(0,4);return(0,s.jsxs)("div",{className:"seller-overview",children:[(0,s.jsx)("div",{className:"seller-overview-header",children:(0,s.jsxs)("div",{className:"seller-overview-header-content",children:[(0,s.jsxs)("div",{className:"seller-overview-greeting",children:[(0,s.jsxs)("h1",{children:["Welcome Back, ",(null===o||void 0===o||null===(r=o.full_name)||void 0===r?void 0:r.split(" ")[0])||(null===o||void 0===o?void 0:o.first_name)||"User"," ",(0,s.jsx)("span",{style:{color:"red"},children:"\u2764\ufe0f"})]}),(0,s.jsx)("p",{className:"seller-overview-subtitle",children:"Here's what's happening with your properties today"})]}),(0,s.jsxs)("button",{className:"seller-overview-add-btn",onClick:g,children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),(0,s.jsx)("span",{children:"Add New Property"})]})]})}),(0,s.jsxs)("div",{className:"seller-overview-stats-grid",children:[(0,s.jsxs)("div",{className:"seller-overview-stat-card seller-overview-stat-primary",onClick:()=>i&&i("properties"),style:{cursor:"pointer"},children:[(0,s.jsx)("div",{className:"seller-overview-stat-icon-wrapper",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsxs)("div",{className:"seller-overview-stat-content",children:[(0,s.jsx)("span",{className:"seller-overview-stat-label",children:"Total Properties"}),(0,s.jsxs)("div",{className:"seller-overview-stat-value-row",children:[(0,s.jsx)("span",{className:"seller-overview-stat-value",children:f.totalProperties}),(0,s.jsx)("span",{className:"seller-overview-stat-badge seller-overview-badge-success",children:"Active"})]})]})]}),(0,s.jsxs)("div",{className:"seller-overview-stat-card",children:[(0,s.jsx)("div",{className:"seller-overview-stat-icon-wrapper seller-overview-icon-blue",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsxs)("div",{className:"seller-overview-stat-content",children:[(0,s.jsx)("span",{className:"seller-overview-stat-label",children:"People Showed Interest"}),(0,s.jsxs)("div",{className:"seller-overview-stat-value-row",children:[(0,s.jsx)("span",{className:"seller-overview-stat-value",children:(x=f.totalViews,x>=1e3?"".concat((x/1e3).toFixed(1),"K"):x)}),(0,s.jsxs)("span",{className:"seller-overview-stat-change seller-overview-change-positive",children:[(0,s.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 15l-6-6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),f.totalViews>0?"Active":"No views yet"]})]}),(0,s.jsx)("p",{className:"seller-overview-stat-hint",style:{fontSize:"0.75rem",color:"#64748b",marginTop:"4px"},children:f.totalViews>0?"".concat(f.totalViews," ").concat(1===f.totalViews?"person has":"people have"," viewed your properties"):"Share your properties to get more views"})]})]}),(0,s.jsxs)("div",{className:"seller-overview-stat-card",onClick:()=>i&&i("inquiries"),style:{cursor:"pointer"},children:[(0,s.jsx)("div",{className:"seller-overview-stat-icon-wrapper seller-overview-icon-green",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})})}),(0,s.jsxs)("div",{className:"seller-overview-stat-content",children:[(0,s.jsx)("span",{className:"seller-overview-stat-label",children:"Total Inquiries"}),(0,s.jsxs)("div",{className:"seller-overview-stat-value-row",children:[(0,s.jsx)("span",{className:"seller-overview-stat-value",children:f.totalInquiries}),f.newInquiries>0&&(0,s.jsxs)("span",{className:"seller-overview-stat-badge seller-overview-badge-warning",children:[f.newInquiries," New"]})]})]})]}),(0,s.jsxs)("div",{className:"seller-overview-stat-card",children:[(0,s.jsx)("div",{className:"seller-overview-stat-icon-wrapper seller-overview-icon-orange",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"seller-overview-stat-content",children:[(0,s.jsx)("span",{className:"seller-overview-stat-label",children:"Listing Status"}),(0,s.jsxs)("div",{className:"seller-overview-status-pills",children:[(0,s.jsxs)("span",{className:"seller-overview-status-pill seller-overview-pill-sale",children:[f.forSale," Sale"]}),(0,s.jsxs)("span",{className:"seller-overview-status-pill seller-overview-pill-rent",children:[f.forRent," Rent"]})]})]})]})]}),(0,s.jsxs)("div",{className:"seller-overview-quick-actions",children:[(0,s.jsx)("h2",{className:"seller-overview-section-title",children:"Quick Actions"}),(0,s.jsxs)("div",{className:"seller-overview-actions-grid",children:[(0,s.jsxs)("button",{className:"seller-overview-action-card",onClick:g,children:[(0,s.jsx)("div",{className:"seller-overview-action-icon seller-overview-action-add",children:(0,s.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsx)("span",{className:"seller-overview-action-title",children:"Add New Property"}),(0,s.jsx)("span",{className:"seller-overview-action-desc",children:"List a new property for sale or rent"})]}),(0,s.jsxs)("button",{className:"seller-overview-action-card",onClick:()=>i&&i("properties"),children:[(0,s.jsx)("div",{className:"seller-overview-action-icon seller-overview-action-manage",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"seller-overview-action-title",children:"Manage Properties"}),(0,s.jsx)("span",{className:"seller-overview-action-desc",children:"Edit, update or remove listings"})]}),(0,s.jsxs)("button",{className:"seller-overview-action-card",onClick:()=>i&&i("inquiries"),children:[(0,s.jsx)("div",{className:"seller-overview-action-icon seller-overview-action-inquiries",children:(0,s.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsx)("span",{className:"seller-overview-action-title",children:"View Inquiries"}),(0,s.jsx)("span",{className:"seller-overview-action-desc",children:"Respond to buyer inquiries"})]}),(0,s.jsxs)("button",{type:"button",className:"seller-overview-action-card seller-leads-stat-btn",onClick:()=>a("/seller-dashboard/inquiries"),title:"View leads from buyers who viewed your contact details",children:[(0,s.jsx)("div",{className:"seller-overview-action-icon seller-overview-action-leads",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"seller-overview-action-title",children:"Leads"}),(0,s.jsx)("span",{className:"seller-overview-action-desc",children:"View leads from buyers who viewed your contact details"})]}),(0,s.jsxs)("button",{className:"seller-overview-action-card",onClick:()=>i&&i("profile"),children:[(0,s.jsx)("div",{className:"seller-overview-action-icon seller-overview-action-profile",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"seller-overview-action-title",children:"Update Profile"}),(0,s.jsx)("span",{className:"seller-overview-action-desc",children:"Manage your account settings"})]})]})]}),(0,s.jsxs)("div",{className:"seller-overview-content-grid",children:[(0,s.jsxs)("div",{className:"seller-overview-properties-section",children:[(0,s.jsxs)("div",{className:"seller-overview-section-header",children:[(0,s.jsx)("h2",{className:"seller-overview-section-title",children:"Your Properties"}),(0,s.jsxs)("button",{className:"seller-overview-view-all-btn",onClick:()=>i&&i("properties"),children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]})]}),(0,s.jsx)("div",{className:"seller-overview-properties-list",children:0===c.length?(0,s.jsxs)("div",{className:"seller-overview-empty-state",children:[(0,s.jsx)("div",{className:"seller-overview-empty-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M9 22V12h6v10",stroke:"currentColor",strokeWidth:"1.5"})]})}),(0,s.jsx)("h3",{children:"No Properties Listed"}),(0,s.jsx)("p",{children:"Start by adding your first property"}),(0,s.jsx)("button",{className:"seller-overview-empty-action-btn",onClick:g,children:"Add Property"})]}):c.slice(0,3).map((e,t)=>{var r;return(0,s.jsxs)("div",{className:"seller-overview-property-item",style:{animationDelay:"".concat(.1*t,"s"),cursor:"pointer"},onClick:()=>window.open("/seller-dashboard/details/".concat(e.id),"_blank","noopener,noreferrer"),children:[(0,s.jsxs)("div",{className:"seller-overview-property-thumbnail",children:[(0,s.jsx)("img",{src:null===(r=e.images)||void 0===r?void 0:r[0],alt:e.title}),(0,s.jsx)("span",{className:"seller-overview-property-badge ".concat("sale"===e.status?"seller-overview-badge-sale":"seller-overview-badge-rent"),children:"sale"===e.status?"For Sale":"For Rent"})]}),(0,s.jsxs)("div",{className:"seller-overview-property-info",children:[(0,s.jsx)("h4",{className:"seller-overview-property-title",children:e.title}),(0,s.jsxs)("p",{className:"seller-overview-property-location",children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.location]}),(0,s.jsxs)("div",{className:"seller-overview-property-stats",children:[(0,s.jsxs)("span",{className:"seller-overview-property-stat-item",title:"".concat(e.views||0," people showed interest"),children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.views||0," ",1===e.views?"person":"people"," interested"]}),(0,s.jsxs)("span",{className:"seller-overview-property-stat-item",children:[(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),e.inquiries||0," inquiries"]})]})]}),(0,s.jsxs)("div",{className:"seller-overview-property-price",children:[(0,s.jsx)("span",{className:"seller-overview-price",children:y(e.price)}),"rent"===e.status&&(0,s.jsx)("span",{className:"seller-overview-per-month",children:"/month"})]})]},e.id)})})]}),(0,s.jsxs)("div",{className:"seller-overview-inquiries-section",children:[(0,s.jsxs)("div",{className:"seller-overview-section-header",children:[(0,s.jsxs)("h2",{className:"seller-overview-section-title",children:["Recent Inquiries",f.newInquiries>0&&(0,s.jsx)("span",{className:"seller-overview-title-badge",children:f.newInquiries})]}),(0,s.jsxs)("button",{className:"seller-overview-view-all-btn",onClick:()=>i&&i("inquiries"),children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]})]}),(0,s.jsx)("div",{className:"seller-overview-inquiries-list",children:0===v.length?(0,s.jsx)("div",{className:"seller-overview-empty-state seller-overview-empty-small",children:(0,s.jsx)("p",{children:"No new inquiries"})}):v.map((e,t)=>(0,s.jsxs)("div",{className:"seller-overview-inquiry-item",style:{animationDelay:"".concat(.1*t,"s"),cursor:"pointer"},onClick:()=>{a("/seller-dashboard/inquiries?inquiryId=".concat(e.id))},children:[(0,s.jsx)("div",{className:"seller-overview-inquiry-avatar",children:e.buyerProfileImage?(0,s.jsx)("img",{src:e.buyerProfileImage,alt:e.buyerName}):e.avatar&&(e.avatar.startsWith("http://")||e.avatar.startsWith("https://"))?(0,s.jsx)("img",{src:e.avatar,alt:e.buyerName}):e.avatar||(e.buyerName?e.buyerName.charAt(0).toUpperCase():"U")}),(0,s.jsxs)("div",{className:"seller-overview-inquiry-content",children:[(0,s.jsxs)("div",{className:"seller-overview-inquiry-header",children:[(0,s.jsx)("span",{className:"seller-overview-inquiry-name",children:e.buyerName}),(0,s.jsx)("span",{className:"seller-overview-inquiry-time",children:_(e.createdAt)})]}),(0,s.jsx)("p",{className:"seller-overview-inquiry-property",children:e.propertyTitle}),(0,s.jsx)("p",{className:"seller-overview-inquiry-message",children:e.message})]})]},e.id))})]})]}),p&&(0,s.jsx)(Wt,{onClose:()=>m(!1)})]});var x};var Gt=r(295);const Zt=()=>{(0,n.Zp)();const{properties:t,deleteProperty:r}=gt(),[i,o]=(0,e.useState)(!1),[a,l]=(0,e.useState)(null),[c,u]=(0,e.useState)("grid"),[d,h]=(0,e.useState)("all"),[p,m]=(0,e.useState)("newest"),[f,g]=(0,e.useState)(""),[y,_]=(0,e.useState)(!1),[v,x]=(0,e.useState)(null),b=(0,e.useMemo)(()=>t.filter(e=>{const t="all"===d||e.status===d,r=e.title.toLowerCase().includes(f.toLowerCase())||e.location.toLowerCase().includes(f.toLowerCase());return t&&r}).sort((e,t)=>{switch(p){case"newest":return new Date(t.createdAt)-new Date(e.createdAt);case"oldest":return new Date(e.createdAt)-new Date(t.createdAt);case"price-high":return parseFloat(t.price)-parseFloat(e.price);case"price-low":return parseFloat(e.price)-parseFloat(t.price);default:return 0}}),[t,d,f,p]),w=(0,e.useCallback)(()=>{t.length>=3?alert("You can add maximum ".concat(3," properties.")):(l(null),o(!0))},[t.length]),j=(0,e.useCallback)(e=>{l(e),o(!0)},[]),S=(0,e.useCallback)(e=>{x(e),_(!0)},[]),T=(0,e.useCallback)(async()=>{if(v)try{await r(v),x(null)}catch(e){console.error("Error deleting property:",e),alert("Failed to delete property. Please try again.")}},[v,r]),k=(0,e.useCallback)(e=>{console.log("Navigating to property:",e);const t="/seller-dashboard/details/".concat(e);console.log("Navigation path:",t),window.open(t,"_blank","noopener,noreferrer")},[]),A=((0,e.useCallback)(e=>{if(!e||!e.createdAt)return!1;const t=new Date(e.createdAt);return((new Date).getTime()-t.getTime())/36e5>=24},[]),(0,e.useCallback)(e=>{const t=parseFloat(e);return t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Cr"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lac"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(1),"K"):"\u20b9".concat(t)},[])),C=(0,e.useCallback)(e=>t.findIndex(t=>t.id===e),[t]);return(0,s.jsxs)("div",{className:"seller-properties",children:[(0,s.jsx)("div",{className:"seller-props-header",children:(0,s.jsxs)("div",{className:"seller-props-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:"My Properties"}),(0,s.jsxs)("p",{className:"seller-props-subtitle",children:[t.length," of ",3," properties listed"]})]}),(0,s.jsxs)("button",{className:"seller-props-add-btn",onClick:w,children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Add Property"]})]})}),(0,s.jsxs)("div",{className:"seller-props-toolbar",children:[(0,s.jsxs)("div",{className:"seller-props-search-box",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Search properties...",value:f,onChange:e=>g(e.target.value)})]}),(0,s.jsxs)("div",{className:"seller-props-toolbar-actions",children:[(0,s.jsxs)("div",{className:"seller-props-filter-group",children:[(0,s.jsxs)("select",{value:d,onChange:e=>h(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Status"}),(0,s.jsx)("option",{value:"sale",children:"For Sale"}),(0,s.jsx)("option",{value:"rent",children:"For Rent"})]}),(0,s.jsxs)("select",{value:p,onChange:e=>m(e.target.value),children:[(0,s.jsx)("option",{value:"newest",children:"Newest First"}),(0,s.jsx)("option",{value:"oldest",children:"Oldest First"}),(0,s.jsx)("option",{value:"price-high",children:"Price: High to Low"}),(0,s.jsx)("option",{value:"price-low",children:"Price: Low to High"})]})]}),(0,s.jsxs)("div",{className:"seller-props-view-toggle",children:[(0,s.jsx)("button",{className:"seller-props-view-btn ".concat("grid"===c?"active":""),onClick:()=>u("grid"),children:(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{className:"seller-props-view-btn ".concat("list"===c?"active":""),onClick:()=>u("list"),children:(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M8 6h13M8 12h13M8 18h13M3 6h.01M3 12h.01M3 18h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})]})]}),0===b.length?(0,s.jsxs)("div",{className:"seller-props-empty-state",children:[(0,s.jsx)("div",{className:"seller-props-empty-icon",children:(0,s.jsxs)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M9 22V12h6v10",stroke:"currentColor",strokeWidth:"1.5"})]})}),(0,s.jsx)("h3",{children:"No Properties Found"}),(0,s.jsx)("p",{children:f||"all"!==d?"Try adjusting your filters":"Start by adding your first property listing"}),!f&&"all"===d&&(0,s.jsxs)("button",{className:"seller-props-empty-action-btn",onClick:w,children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Add Your First Property"]})]}):(0,s.jsxs)("div",{className:"seller-props-container ".concat(c),children:[b.map((e,t)=>(0,s.jsxs)("div",{className:"seller-props-card ".concat(c),style:{animationDelay:"".concat(.05*t,"s"),cursor:"pointer"},onClick:()=>k(e.id),children:[(0,s.jsxs)("div",{className:"seller-props-image",children:[(0,s.jsx)("img",{src:(t=>{const r=e.display_image||(null===(t=e.images)||void 0===t?void 0:t[0])||e.cover_image;return r?r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?"".concat(q.JR.replace("/api","")).concat(r):"".concat(q.JR.replace("/api",""),"/uploads/").concat(r):"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"})(),alt:e.title,onError:t=>{console.error("Image load failed for property:",e.id,"URL:",t.target.src),t.target.src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"}}),(0,s.jsxs)("div",{className:"seller-props-image-overlay",children:[(0,s.jsx)("button",{className:"seller-props-overlay-btn",onClick:t=>{t.stopPropagation(),j(C(e.id))},children:(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{className:"seller-props-overlay-btn delete",onClick:t=>{t.stopPropagation(),S(e.id)},children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6",stroke:"currentColor",strokeWidth:"2"})})})]}),(0,s.jsx)("span",{className:"seller-props-badge ".concat(e.status),children:"sale"===e.status?"For Sale":"For Rent"}),e.featured&&(0,s.jsx)("span",{className:"seller-props-featured-badge",children:"Featured"})]}),(0,s.jsxs)("div",{className:"seller-props-content",children:[(0,s.jsx)("h3",{className:"seller-props-title",children:e.title}),(0,s.jsxs)("p",{className:"seller-props-location",children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.location]}),(0,s.jsxs)("div",{className:"seller-props-features",children:[(0,s.jsxs)("span",{className:"seller-props-feature",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 22V8l9-6 9 6v14H3z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M9 22v-6h6v6",stroke:"currentColor",strokeWidth:"2"})]}),e.bedrooms," Beds"]}),(0,s.jsxs)("span",{className:"seller-props-feature",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 12h16v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M6 12V5a2 2 0 012-2h2v9",stroke:"currentColor",strokeWidth:"2"})]}),e.bathrooms," Baths"]}),(0,s.jsxs)("span",{className:"seller-props-feature",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M3 9h18M9 21V9",stroke:"currentColor",strokeWidth:"2"})]}),e.area," sqft"]})]}),(0,s.jsxs)("div",{className:"seller-props-stats",children:[(0,s.jsxs)("div",{className:"seller-props-stat-item",title:"".concat(e.views||0," people showed interest in this property"),children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsxs)("span",{children:[e.views||0," ",1===e.views?"person":"people"," interested"]})]}),(0,s.jsxs)("div",{className:"seller-props-stat-item",children:[(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsxs)("span",{children:[e.inquiries||0," inquiries"]})]})]}),(0,s.jsxs)("div",{className:"seller-props-footer",children:[(0,s.jsxs)("div",{className:"seller-props-price-section",children:[(0,s.jsx)("span",{className:"seller-props-price",children:A(e.price)}),"rent"===e.status&&(0,s.jsx)("span",{className:"seller-props-per-month",children:"/month"})]}),(0,s.jsxs)("div",{className:"seller-props-action-btns",children:[(0,s.jsxs)("button",{className:"seller-props-view-details-btn",onClick:t=>{t.stopPropagation(),k(e.id)},title:"View Details",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),"View"]}),(0,s.jsxs)("button",{className:"seller-props-edit-btn",onClick:t=>{t.stopPropagation(),j(C(e.id))},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]}),"Edit"]}),(0,s.jsxs)("button",{className:"seller-props-delete-btn",onClick:t=>{t.stopPropagation(),S(e.id)},children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6",stroke:"currentColor",strokeWidth:"2"})}),"Delete"]})]})]})]})]},e.id)),t.length<3&&"grid"===c&&(0,s.jsx)("div",{className:"seller-props-card seller-props-add-card",onClick:w,children:(0,s.jsxs)("div",{className:"seller-props-add-card-content",children:[(0,s.jsx)("div",{className:"seller-props-add-icon",children:(0,s.jsx)("svg",{width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsx)("h3",{children:"Add New Property"}),(0,s.jsx)("p",{children:"List a new property for sale or rent"})]})})]}),i&&(0,s.jsx)(Wt,{onClose:()=>o(!1),editIndex:a,initialData:null!==a?t[a]:null}),(0,s.jsx)(Gt.A,{isOpen:y,onClose:()=>{_(!1),x(null)},onConfirm:T})]})},Kt=t=>{let{onUnreadCountChange:r}=t;const o=(0,n.zy)(),a=(0,n.Zp)(),{inquiries:c,properties:u,updateInquiryStatus:d,syncInquiryStatusFromFirebase:h}=gt(),{user:m}=l(),[f,g]=(0,e.useState)(null),[y,_]=(0,e.useState)("all"),[v,x]=(0,e.useState)("all"),[b,w]=(0,e.useState)(""),[j,S]=(0,e.useState)(""),[T,k]=(0,e.useState)(!1),[A,C]=(0,e.useState)(""),[E,N]=(0,e.useState)({}),[I,P]=(0,e.useState)({}),[L,R]=(0,e.useState)("details"),[D,F]=(0,e.useState)(null),[O,z]=(0,e.useState)([]),[B,U]=(0,e.useState)([]),[V,q]=(0,e.useState)(!1),W=(0,e.useRef)(null),H=(0,e.useRef)(null),G=(0,e.useRef)(null),Z=(0,e.useMemo)(()=>{if(!m)return 0;let e=0;return Object.keys(E).forEach(t=>{const r=E[t]||[];if(!Array.isArray(r)||0===r.length)return;if((null===f||void 0===f?void 0:f.id)===t&&"chat"===L)return;const n=I[t];if(n){const t=n.toDate?n.toDate():new Date(n),i=r.filter(e=>{if("buyer"!==e.sender)return!1;return new Date(e.timestamp)>t}).length;e+=i}else{const t=r.filter(e=>"buyer"===e.sender);e+=t.length}}),e},[E,I,f,L,m]);(0,e.useEffect)(()=>{r&&r(Z)},[Z,r]),(0,e.useEffect)(()=>{var e;null===(e=W.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[E,f,L]);const K=(0,e.useRef)(new Set);(0,e.useEffect)(()=>{if(!c.length||!m)return;let e=!0;return(async()=>{const t=[];for(const e of c)if(!K.current.has(e.id))if(e.buyerId&&e.propertyId&&m.id)try{const r=(0,M.generateChatRoomId)(e.buyerId,m.id,e.propertyId),n=await(0,M.Wj)(r,m.id);n.status&&n.status!==e.status&&t.push({id:e.id,status:n.status}),K.current.add(e.id)}catch(r){console.warn("Failed to sync Firebase status for inquiry ".concat(e.id,":"),r),K.current.add(e.id)}else K.current.add(e.id);e&&t.length>0&&(console.log("[SellerInquiries] Syncing Firebase read status for inquiries:",t),t.forEach(e=>{let{id:t,status:r}=e;h(t,r)}))})(),()=>{e=!1}},[c.length,null===m||void 0===m?void 0:m.id,h]),(0,e.useEffect)(()=>{const e=new Set(c.map(e=>e.id));K.current.forEach(t=>{e.has(t)||K.current.delete(t)})},[c.length]),(0,e.useEffect)(()=>{if(!m||!O.length)return;(async()=>{const e={};for(const n of O)if(n.chatRoomId)try{var t;const r=await(0,M.getChatRoomDetails)(n.chatRoomId);null!==r&&void 0!==r&&null!==(t=r.lastReadAt)&&void 0!==t&&t[String(m.id)]&&(e[n.id]=r.lastReadAt[String(m.id)])}catch(r){console.warn("Failed to load lastReadAt for inquiry ".concat(n.id,":"),r)}P(t=>(0,p.A)((0,p.A)({},t),e))})()},[m,O]),(0,e.useEffect)(()=>{if(!m)return void z(c);(async()=>{try{const e=await(0,M.ix)(m.id);console.log("[SellerInquiries] Loaded",e.length,"Firebase chat rooms");const t=new Map;c.forEach(e=>{const r=e.conversationKey||"".concat(e.buyerId||"guest","_").concat(e.propertyId);t.set(r,e)});const r=new Map;c.forEach(e=>{e.buyerId&&(r.has(e.buyerId)||r.set(e.buyerId,{buyerName:e.buyerName,buyerEmail:e.buyerEmail,buyerPhone:e.buyerPhone,buyerProfileImage:e.buyerProfileImage,avatar:e.avatar}))});const n=new Map;e.forEach(e=>{const t="".concat(e.buyerId,"_").concat(e.propertyId);n.set(t,e)});const s=new Map;O.forEach(e=>{const t=e.conversationKey||"".concat(e.buyerId||"guest","_").concat(e.propertyId);s.set(t,e)});const o=c.map(e=>{const t=e.conversationKey||"".concat(e.buyerId||"guest","_").concat(e.propertyId),r=n.get(t),i=s.get(t);if(r){let t=e.status;if(r.readStatus&&"object"===typeof r.readStatus&&m){const e=r.readStatus[String(m.id)];e&&(t=e)}return i&&"replied"===i.status&&"replied"!==t&&(t="replied"),(0,p.A)((0,p.A)({},e),{},{lastMessage:r.lastMessage||e.message,lastActivity:r.updatedAt?new Date(r.updatedAt):new Date(e.createdAt),chatRoomId:r.id,firebaseReadStatus:t,status:t})}const o=i&&"replied"===i.status?"replied":e.status;return(0,p.A)((0,p.A)({},e),{},{lastMessage:e.message,lastActivity:new Date(e.createdAt),status:o,firebaseReadStatus:o})}),a=[],l=[];e.forEach(e=>{const n="".concat(e.buyerId,"_").concat(e.propertyId);if(t.has(n)){const r=t.get(n),i=o.findIndex(t=>t.conversationKey===n||t.buyerId===e.buyerId&&t.propertyId===e.propertyId);i>=0&&r&&(o[i]=(0,p.A)((0,p.A)({},o[i]),{},{buyerName:r.buyerName||o[i].buyerName,buyerEmail:r.buyerEmail||o[i].buyerEmail,buyerPhone:r.buyerPhone||o[i].buyerPhone,buyerProfileImage:r.buyerProfileImage||o[i].buyerProfileImage,avatar:r.buyerProfileImage||r.avatar||o[i].avatar}))}else{const t=u.find(t=>t.id===parseInt(e.propertyId));e.receiverId===String(m.id)||e.receiverId===m.id?(l.push({room:e,conversationKey:n,property:t}),!r.has(e.buyerId)&&e.buyerId&&a.push(i.r7.getBuyer(e.buyerId).then(t=>{var n;if(t.success&&null!==(n=t.data)&&void 0!==n&&n.buyer){var i,s;const n=t.data.buyer;r.set(e.buyerId,{buyerName:n.name||"Buyer",buyerEmail:n.email||"",buyerPhone:n.phone||"",buyerProfileImage:n.profile_image||null,avatar:n.profile_image||(null===(i=n.name)||void 0===i||null===(s=i[0])||void 0===s?void 0:s.toUpperCase())||"B"})}}).catch(t=>{console.warn("Failed to fetch buyer info for buyerId ".concat(e.buyerId,":"),t)}))):console.warn("[SellerInquiries] Chat room receiverId mismatch:",{roomId:e.id,roomReceiverId:e.receiverId,currentUserId:m.id,roomBuyerId:e.buyerId,roomPropertyId:e.propertyId})}}),await Promise.all(a),l.forEach(e=>{var t;let{room:n,conversationKey:i,property:a}=e,l="new";if(n.readStatus&&"object"===typeof n.readStatus&&m){const e=n.readStatus[String(m.id)];e&&(l=e)}const c=s.get(i);c&&"replied"===c.status&&"replied"!==l&&(l="replied");const u=r.get(n.buyerId),d=(null===u||void 0===u?void 0:u.buyerName)||"Buyer",h=(null===u||void 0===u?void 0:u.buyerEmail)||"",p=(null===u||void 0===u?void 0:u.buyerPhone)||"",f=(null===u||void 0===u?void 0:u.buyerProfileImage)||null,g=f||(null===u||void 0===u?void 0:u.avatar)||(null===(t=d[0])||void 0===t?void 0:t.toUpperCase())||"B";o.push({id:"chat_".concat(n.id),conversationKey:i,propertyId:n.propertyId,buyerId:n.buyerId,propertyTitle:(null===a||void 0===a?void 0:a.title)||"Property",buyerName:d,buyerEmail:h,buyerPhone:p,buyerProfileImage:f,message:n.lastMessage||"",status:l,createdAt:n.createdAt?n.createdAt instanceof Date?n.createdAt:new Date(n.createdAt):new Date,avatar:g,lastMessage:n.lastMessage||"",lastActivity:n.updatedAt?n.updatedAt instanceof Date?n.updatedAt:new Date(n.updatedAt):new Date,chatRoomId:n.id,firebaseReadStatus:l,isChatOnly:!0})}),o.forEach((e,t)=>{if(e.isChatOnly&&e.buyerId){const i=r.get(e.buyerId);var n;if(i&&"Buyer"!==i.buyerName)o[t]=(0,p.A)((0,p.A)({},e),{},{buyerName:i.buyerName,buyerEmail:i.buyerEmail,buyerPhone:i.buyerPhone,buyerProfileImage:i.buyerProfileImage,avatar:i.buyerProfileImage||i.avatar||(null===(n=i.buyerName[0])||void 0===n?void 0:n.toUpperCase())||"B"})}}),o.sort((e,t)=>{const r=e.lastActivity instanceof Date?e.lastActivity:new Date(e.lastActivity);return(t.lastActivity instanceof Date?t.lastActivity:new Date(t.lastActivity))-r}),console.log("[SellerInquiries] Enriched inquiries:",o.length,"total conversations"),z(o)}catch(e){console.error("Error enriching inquiries with Firebase data:",e),z(c)}})()},[c,m,u]),(0,e.useEffect)(()=>{if(!m)return;(async()=>{q(!0);try{var e;const t=await i.BZ.list();t.success&&null!==(e=t.data)&&void 0!==e&&e.leads?U(t.data.leads):U([])}catch(t){console.warn("Failed to fetch leads:",t),U([])}finally{q(!1)}})()},[m]);const Y=()=>{var e;null===(e=G.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})};(0,e.useEffect)(()=>{if("leads"===new URLSearchParams(o.search).get("section")){const e=setTimeout(()=>Y(),300);return()=>clearTimeout(e)}},[o.search]),(0,e.useEffect)(()=>{if(f){const e=O.find(e=>e.id===f.id||e.conversationKey===f.conversationKey||e.buyerId===f.buyerId&&e.propertyId===f.propertyId);e&&(e.status===f.status&&e.lastMessage===f.lastMessage&&e.buyerName===f.buyerName&&e.buyerProfileImage===f.buyerProfileImage||g(e))}},[O,null===f||void 0===f?void 0:f.id,null===f||void 0===f?void 0:f.conversationKey]),(0,e.useEffect)(()=>{if(!f||!m||!D)return;if("new"===f.status&&("chat"===L||E[f.id]&&E[f.id].length>0)){(async()=>{try{await(0,M.BR)(D,m.id,"read"),g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null);try{await d(f.id,"read")}catch(e){console.warn("Failed to update MySQL status, but Firebase status updated:",e)}}catch(t){console.error("Failed to mark inquiry as read:",t)}})()}},[f,L,E,m,D,d]);const X=O.filter(e=>{const t="all"===y||e.status===y,r="all"===v||e.propertyId===parseInt(v),n=e.buyerName.toLowerCase().includes(b.toLowerCase())||(e.lastMessage||e.message||"").toLowerCase().includes(b.toLowerCase())||e.propertyTitle.toLowerCase().includes(b.toLowerCase());return t&&r&&n}),J=(0,e.useMemo)(()=>({total:O.length,new:O.filter(e=>"new"===e.status||"new"===e.firebaseReadStatus).length,read:O.filter(e=>"read"===e.status||"read"===e.firebaseReadStatus).length,replied:O.filter(e=>"replied"===e.status||"replied"===e.firebaseReadStatus).length}),[O]),Q=e=>{const t=new Date(e),r=new Date-t,n=Math.floor(r/6e4),i=Math.floor(r/36e5),s=Math.floor(r/864e5);return n<1?"Just now":n<60?"".concat(n," min ago"):i<24?"".concat(i," hours ago"):s<7?"".concat(s," days ago"):t.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})},$=async e=>{let t=e.chatRoomId||null;if(!t&&m&&e.buyerId&&e.propertyId&&(t=(0,M.generateChatRoomId)(e.buyerId,m.id,e.propertyId)),F(t),t&&m)try{const r=await(0,M.Wj)(t,m.id);r.status&&r.status!==e.status&&(e=(0,p.A)((0,p.A)({},e),{},{status:r.status}))}catch(r){console.warn("Failed to get Firebase status, using inquiry status:",r)}if(g(e),R("details"),"new"===e.status&&t&&m)try{g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null),await(0,M.BR)(t,m.id,"read");try{await d(e.id,"read")}catch(n){console.warn("Failed to update MySQL status, but Firebase status updated:",n)}g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null)}catch(r){console.error("Failed to mark inquiry as read in Firebase:",r),g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"new"}):null)}};(0,e.useEffect)(()=>{const e=new URLSearchParams(o.search).get("inquiryId");if(e&&O.length>0&&!f){const t=parseInt(e,10),r=O.find(e=>e.id===t);if(r){$(r);const e=new URLSearchParams(o.search);e.delete("inquiryId");const t=e.toString();a(o.pathname+(t?"?".concat(t):""),{replace:!0})}}},[O.length,o.search]);const ee=async()=>{if(!A.trim()||!f||!m)return;if(!f.buyerId||!f.propertyId)return void alert("Buyer or property information not available for chat.");const e=A.trim();C("");try{const n=await(0,M.createOrGetChatRoom)(f.buyerId,m.id,m.user_type||"seller",f.propertyId);F(n),await(0,M._z)(n,m.id,m.user_type||"seller",e);try{await(0,M.BR)(n,m.id,"replied");const e=await(0,M.getChatRoomDetails)(n);let r="replied";if(e&&e.readStatus&&"object"===typeof e.readStatus&&m){const t=e.readStatus[String(m.id)];t&&(r=t)}g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:r}):null),z(e=>e.map(e=>e.id===f.id||e.conversationKey===f.conversationKey||e.buyerId===f.buyerId&&e.propertyId===f.propertyId?(0,p.A)((0,p.A)({},e),{},{status:r,firebaseReadStatus:r}):e));try{await d(f.id,"replied")}catch(t){console.warn("Failed to update MySQL status, but Firebase status updated:",t)}}catch(r){console.error("Failed to mark inquiry as replied:",r)}N(t=>{const r=t[f.id]||[],n=new Date,i={id:n.getTime(),text:e,sender:"seller",timestamp:n.toISOString()};return(0,p.A)((0,p.A)({},t),{},{[f.id]:[...r,i]})})}catch(r){console.error("Error sending chat message as seller:",r),C(e),alert(r.message||"Failed to send message. Please try again.")}};(0,e.useEffect)(()=>{if(f&&"chat"===L&&D&&m){const e=f.id,t=E[e]||[];if(Array.isArray(t)&&t.length>0){const t=new Date;P(r=>(0,p.A)((0,p.A)({},r),{},{[e]:t})),(0,M.BR)(D,m.id,"read").catch(e=>{console.warn("Failed to update Firebase lastReadAt:",e)})}}},[f,L,E,D,m,M.BR]);const te=async e=>{if(R(e),"chat"===e&&f&&"new"===f.status&&D&&m)try{await(0,M.BR)(D,m.id,"read"),g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null);try{await d(f.id,"read")}catch(t){console.warn("Failed to update MySQL status, but Firebase status updated:",t)}}catch(r){console.error("Failed to mark inquiry as read on tab switch:",r)}};(0,e.useEffect)(()=>{if(!f||!D||!m)return;const e=(0,M.dP)(D,(e,t)=>{if(t)return void console.error("Error in seller chat listener:",t);if(!e||!Array.isArray(e))return void console.error("Error in seller chat listener: Invalid messages received");const r=e.map((e,t)=>{let r;return r=e.timestamp instanceof Date?e.timestamp:e.timestamp?new Date(e.timestamp):new Date,{id:e.id||"".concat(f.id,"-").concat(r.getTime(),"-").concat(t,"-").concat(Math.random()),text:e.text||"",sender:e.senderId===String(m.id)?"seller":"buyer",timestamp:r.toISOString()}});N(e=>(0,p.A)((0,p.A)({},e),{},{[f.id]:r}))});return()=>{e&&"function"===typeof e&&e()}},[f,D,m,d]);const re=e=>{let t=e.status||"new";if(e.firebaseReadStatus&&"string"===typeof e.firebaseReadStatus)t=e.firebaseReadStatus;else if(e.firebaseReadStatus&&"object"===typeof e.firebaseReadStatus&&m){const r=e.firebaseReadStatus[String(m.id)];r&&(t=r)}const r={new:{label:"New",class:"seller-new"},read:{label:"Read",class:"seller-read"},replied:{label:"Replied",class:"seller-replied"},contacted:{label:"Contacted",class:"seller-replied"},interested:{label:"Interested",class:"seller-replied"},not_interested:{label:"Not Interested",class:"seller-read"},closed:{label:"Closed",class:"seller-read"}};return r[t]||r.new};return(0,s.jsxs)("div",{className:"seller-inquiries",children:[(0,s.jsx)("div",{className:"seller-inquiries-header",children:(0,s.jsxs)("div",{className:"seller-header-content",children:[(0,s.jsx)("h1",{children:"Property Inquiries"}),(0,s.jsx)("p",{className:"seller-subtitle",children:"Manage and respond to buyer inquiries"})]})}),(0,s.jsxs)("div",{className:"seller-inquiry-stats",children:[(0,s.jsxs)("div",{className:"seller-stat-card",children:[(0,s.jsx)("div",{className:"seller-stat-icon seller-total",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})})}),(0,s.jsxs)("div",{className:"seller-stat-info",children:[(0,s.jsx)("span",{className:"seller-stat-value",children:J.total}),(0,s.jsx)("span",{className:"seller-stat-label",children:"Total Inquiries"})]})]}),(0,s.jsxs)("div",{className:"seller-stat-card",children:[(0,s.jsx)("div",{className:"seller-stat-icon seller-new",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"seller-stat-info",children:[(0,s.jsx)("span",{className:"seller-stat-value",children:J.new}),(0,s.jsx)("span",{className:"seller-stat-label",children:"New / Pending"})]})]}),(0,s.jsxs)("div",{className:"seller-stat-card",children:[(0,s.jsx)("div",{className:"seller-stat-icon seller-read",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsxs)("div",{className:"seller-stat-info",children:[(0,s.jsx)("span",{className:"seller-stat-value",children:J.read}),(0,s.jsx)("span",{className:"seller-stat-label",children:"Read"})]})]}),(0,s.jsxs)("div",{className:"seller-stat-card",children:[(0,s.jsx)("div",{className:"seller-stat-icon seller-replied",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M9 10l-5 5 5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M20 4v7a4 4 0 01-4 4H4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"seller-stat-info",children:[(0,s.jsx)("span",{className:"seller-stat-value",children:J.replied}),(0,s.jsx)("span",{className:"seller-stat-label",children:"Replied"})]})]}),(0,s.jsxs)("button",{type:"button",className:"seller-stat-card seller-leads-stat-btn",onClick:Y,title:"View leads from buyers who viewed your contact details",children:[(0,s.jsx)("div",{className:"seller-stat-icon seller-leads",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"seller-stat-info",children:[(0,s.jsx)("span",{className:"seller-stat-value",children:V?"\u2014":B.length}),(0,s.jsx)("span",{className:"seller-stat-label",children:"Leads"})]})]})]}),(0,s.jsxs)("div",{ref:G,className:"seller-leads-section",children:[(0,s.jsx)("h2",{className:"seller-leads-heading",children:"Leads"}),V?(0,s.jsx)("div",{className:"seller-leads-loading",children:"Loading leads..."}):0===B.length?(0,s.jsx)("div",{className:"seller-leads-empty",children:(0,s.jsx)("p",{children:"No leads yet. Leads will appear when buyers view your contact details."})}):(0,s.jsx)("ol",{className:"seller-leads-list buyer-history-list",children:B.map((e,t)=>(0,s.jsx)("li",{className:"seller-lead-item buyer-history-item",children:(0,s.jsxs)("div",{className:"buyer-history-grid",children:[(0,s.jsx)("span",{className:"buyer-history-property-title",children:e.property_title||"Property"}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-owner-name",children:e.buyer_name||"Buyer"}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-owner-phone",children:e.buyer_phone?(0,s.jsx)("a",{href:"tel:".concat(e.buyer_phone),className:"buyer-history-link",children:e.buyer_phone}):(0,s.jsx)("span",{className:"buyer-history-empty",children:"\u2014"})}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-owner-email",children:e.buyer_email?(0,s.jsx)("a",{href:"mailto:".concat(e.buyer_email),className:"buyer-history-link",children:e.buyer_email}):(0,s.jsx)("span",{className:"buyer-history-empty",children:"\u2014"})}),(0,s.jsx)("span",{className:"buyer-history-separator",children:"|"}),(0,s.jsx)("span",{className:"buyer-history-timestamp",children:e.created_at?Q(e.created_at):"\u2014"})]})},"".concat(e.buyer_id,"-").concat(e.property_id,"-").concat(t)))})]}),(0,s.jsxs)("div",{className:"seller-filters-section",children:[(0,s.jsxs)("div",{className:"seller-search-box",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Search inquiries...",value:b,onChange:e=>w(e.target.value)})]}),(0,s.jsxs)("div",{className:"seller-filter-group",children:[(0,s.jsxs)("select",{value:y,onChange:e=>_(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Status"}),(0,s.jsx)("option",{value:"new",children:"New"}),(0,s.jsx)("option",{value:"read",children:"Read"}),(0,s.jsx)("option",{value:"replied",children:"Replied"})]}),(0,s.jsxs)("select",{value:v,onChange:e=>x(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Properties"}),u.map(e=>(0,s.jsx)("option",{value:e.id,children:(e.title||"").toUpperCase()},e.id))]})]})]}),(0,s.jsxs)("div",{className:"seller-inquiries-container",children:[(0,s.jsx)("div",{className:"seller-inquiries-list",children:0===X.length?(0,s.jsxs)("div",{className:"seller-empty-state",children:[(0,s.jsx)("div",{className:"seller-empty-icon",children:(0,s.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"1.5"})})}),(0,s.jsx)("h3",{children:"No Inquiries Found"}),(0,s.jsx)("p",{children:b||"all"!==y||"all"!==v?"Try adjusting your filters":"You haven't received any inquiries yet"})]}):X.map((e,t)=>(0,s.jsxs)("div",{className:"seller-inquiry-card ".concat((null===f||void 0===f?void 0:f.id)===e.id||(null===f||void 0===f?void 0:f.conversationKey)===e.conversationKey?"seller-selected":""," ").concat("new"===e.status||"new"===e.firebaseReadStatus?"seller-unread":""),onClick:()=>$(e),style:{animationDelay:"".concat(.05*t,"s")},children:[(0,s.jsx)("div",{className:"seller-inquiry-avatar",children:e.buyerProfileImage?(0,s.jsx)("img",{src:e.buyerProfileImage,alt:e.buyerName}):e.avatar}),(0,s.jsxs)("div",{className:"seller-inquiry-content",children:[(0,s.jsxs)("div",{className:"seller-inquiry-header",children:[(0,s.jsx)("span",{className:"seller-inquiry-name",children:e.buyerName}),(0,s.jsx)("span",{className:"seller-inquiry-time",children:Q(e.lastActivity||e.createdAt)})]}),(0,s.jsx)("p",{className:"seller-inquiry-property",children:e.propertyTitle}),(0,s.jsx)("p",{className:"seller-inquiry-preview",children:e.lastMessage||e.message})]}),(0,s.jsx)("div",{className:"seller-inquiry-status",children:(0,s.jsx)("span",{className:"seller-status-badge ".concat(re(e).class),children:re(e).label})})]},e.conversationKey||e.id))}),(0,s.jsx)("div",{className:"seller-inquiry-detail ".concat(f?"seller-active":""),children:f?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"seller-detail-header",children:[(0,s.jsx)("button",{className:"seller-back-btn-mobile",onClick:()=>g(null),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"seller-detail-user",children:[(0,s.jsx)("div",{className:"seller-detail-avatar",children:f.buyerProfileImage?(0,s.jsx)("img",{src:f.buyerProfileImage,alt:f.buyerName}):f.avatar}),(0,s.jsxs)("div",{className:"seller-detail-user-info",children:[(0,s.jsx)("h3",{children:f.buyerName}),(0,s.jsx)("span",{className:"seller-status-badge ".concat(re(f).class),children:re(f).label})]})]})]}),(0,s.jsxs)("div",{className:"seller-detail-body",children:[(0,s.jsxs)("div",{className:"seller-detail-tabs",children:[(0,s.jsxs)("button",{className:"seller-tab-btn ".concat("details"===L?"seller-active":""),onClick:()=>te("details"),children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8",stroke:"currentColor",strokeWidth:"2"})]}),"Details"]}),(0,s.jsxs)("button",{className:"seller-tab-btn ".concat("chat"===L?"seller-active":""),onClick:()=>te("chat"),children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),"Live Chat",(()=>{const e=null===f||void 0===f?void 0:f.id;if(!e)return null;if("chat"===L)return null;const t=E[e]||[],r=I[e];let n=0;if(r){const e=r.toDate?r.toDate():new Date(r);n=t.filter(t=>{if("buyer"!==t.sender)return!1;return new Date(t.timestamp)>e}).length}else n=t.filter(e=>"buyer"===e.sender).length;return n>0?(0,s.jsx)("span",{className:"seller-chat-badge",children:n}):null})()]})]}),"details"===L?(0,s.jsxs)("div",{className:"seller-details-content",children:[(0,s.jsxs)("div",{className:"seller-property-info-card",children:[(0,s.jsx)("h4",{children:"Property Inquiry"}),(0,s.jsx)("p",{className:"seller-property-name",children:f.propertyTitle})]}),(0,s.jsxs)("div",{className:"seller-contact-info-card",children:[(0,s.jsx)("h4",{children:"Contact Information"}),(0,s.jsxs)("div",{className:"seller-contact-item",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M22 6l-10 7L2 6",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("a",{href:"mailto:".concat(f.buyerEmail),children:f.buyerEmail})]}),(0,s.jsxs)("div",{className:"seller-contact-item",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("a",{href:"tel:".concat(f.buyerPhone),children:f.buyerPhone})]})]}),(0,s.jsxs)("div",{className:"seller-message-card",children:[(0,s.jsx)("h4",{children:"Message"}),(0,s.jsxs)("div",{className:"seller-message-content",children:[(0,s.jsx)("p",{children:f.message}),(0,s.jsx)("span",{className:"seller-message-time",children:Q(f.createdAt)})]})]})]}):(0,s.jsxs)("div",{className:"seller-chat-container",children:[(0,s.jsxs)("div",{className:"seller-chat-messages",children:[(!E[f.id]||0===E[f.id].length)&&(0,s.jsxs)("div",{className:"seller-chat-message seller-buyer",children:[(0,s.jsx)("div",{className:"seller-message-avatar",children:f.buyerProfileImage?(0,s.jsx)("img",{src:f.buyerProfileImage,alt:f.buyerName}):f.avatar}),(0,s.jsxs)("div",{className:"seller-message-bubble",children:[(0,s.jsxs)("div",{className:"seller-message-header",children:[(0,s.jsx)("span",{className:"seller-message-sender",children:f.buyerName}),(0,s.jsx)("span",{className:"seller-message-timestamp",children:Q(f.createdAt)})]}),(0,s.jsx)("p",{children:f.message})]})]}),(E[f.id]||[]).map(e=>(0,s.jsxs)("div",{className:"seller-chat-message ".concat("seller"===e.sender?"seller-seller":"seller-buyer"),children:["buyer"===e.sender&&(0,s.jsx)("div",{className:"seller-message-avatar",children:f.buyerProfileImage?(0,s.jsx)("img",{src:f.buyerProfileImage,alt:f.buyerName}):f.avatar}),(0,s.jsxs)("div",{className:"seller-message-bubble",children:[(0,s.jsxs)("div",{className:"seller-message-header",children:[(0,s.jsx)("span",{className:"seller-message-sender",children:"seller"===e.sender?"You":f.buyerName}),(0,s.jsx)("span",{className:"seller-message-timestamp",children:Q(e.timestamp)})]}),(0,s.jsx)("p",{children:e.text})]}),"seller"===e.sender&&(0,s.jsx)("div",{className:"seller-message-avatar seller-seller-avatar",children:null!==m&&void 0!==m&&m.full_name?m.full_name.charAt(0).toUpperCase():null!==m&&void 0!==m&&m.name?m.name.charAt(0).toUpperCase():null!==m&&void 0!==m&&m.email?m.email.charAt(0).toUpperCase():"S"})]},e.id)),(!E[f.id]||0===E[f.id].length)&&(0,s.jsxs)("div",{className:"seller-chat-empty",children:[(0,s.jsx)("div",{className:"seller-chat-empty-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"1",fill:"currentColor"}),(0,s.jsx)("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor"})]})}),(0,s.jsx)("h4",{children:"Continue the conversation"}),(0,s.jsxs)("p",{children:["Reply to ",f.buyerName,"'s inquiry above or send a new message"]})]}),(0,s.jsx)("div",{ref:W})]}),(0,s.jsx)("div",{className:"seller-chat-input-wrapper",children:(0,s.jsxs)("div",{className:"seller-chat-input-container",children:[(0,s.jsx)("input",{type:"file",ref:H,onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){console.log("File selected:",r.name);const t={id:Date.now(),text:"\ud83d\udcce ".concat(r.name),sender:"seller",timestamp:(new Date).toISOString(),type:"file"};N(e=>(0,p.A)((0,p.A)({},e),{},{[f.id]:[...e[f.id]||[],t]}));try{if(D&&m){await(0,M.BR)(D,m.id,"replied");const e=await(0,M.getChatRoomDetails)(D);let t="replied";if(e&&e.readStatus&&"object"===typeof e.readStatus&&m){const r=e.readStatus[String(m.id)];r&&(t=r)}g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:t}):null),z(e=>e.map(e=>e.id===f.id||e.conversationKey===f.conversationKey||e.buyerId===f.buyerId&&e.propertyId===f.propertyId?(0,p.A)((0,p.A)({},e),{},{status:t,firebaseReadStatus:t}):e))}else g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"replied"}):null);try{await d(f.id,"replied")}catch(n){console.warn("Failed to update MySQL status, but Firebase status updated:",n)}}catch(i){console.error("Failed to mark inquiry as replied:",i)}e.target.value=""}},style:{display:"none"},accept:"image/*,.pdf,.doc,.docx"}),(0,s.jsx)("button",{className:"seller-attach-btn",title:"Attach file",onClick:()=>{var e;null===(e=H.current)||void 0===e||e.click()},children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("input",{type:"text",className:"seller-chat-input",placeholder:"Type your message...",value:A,onChange:e=>C(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ee())}}),(0,s.jsx)("button",{className:"seller-send-message-btn",onClick:ee,disabled:!A.trim(),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})})]})]}),"details"===L&&(0,s.jsxs)("div",{className:"seller-detail-footer",children:[(0,s.jsxs)("button",{className:"seller-reply-btn seller-primary",onClick:()=>k(!0),children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M9 10l-5 5 5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M20 4v7a4 4 0 01-4 4H4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Reply via Email"]}),(0,s.jsxs)("a",{href:"tel:".concat(f.buyerPhone),className:"seller-call-btn",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),"Call Now"]})]})]}):(0,s.jsxs)("div",{className:"seller-no-selection",children:[(0,s.jsx)("div",{className:"seller-no-selection-icon",children:(0,s.jsx)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"1.5"})})}),(0,s.jsx)("h3",{children:"Select an Inquiry"}),(0,s.jsx)("p",{children:"Choose an inquiry from the list to view details and respond"})]})})]}),T&&(0,s.jsx)("div",{className:"seller-modal-overlay",onClick:()=>k(!1),children:(0,s.jsxs)("div",{className:"seller-reply-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"seller-modal-header",children:[(0,s.jsxs)("h3",{children:["Reply to ",null===f||void 0===f?void 0:f.buyerName]}),(0,s.jsx)("button",{className:"seller-close-btn",onClick:()=>k(!1),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsxs)("div",{className:"seller-modal-body",children:[(0,s.jsxs)("div",{className:"seller-reply-to-info",children:[(0,s.jsxs)("span",{children:["To: ",null===f||void 0===f?void 0:f.buyerEmail]}),(0,s.jsxs)("span",{children:["RE: ",null===f||void 0===f?void 0:f.propertyTitle]})]}),(0,s.jsx)("textarea",{placeholder:"Type your reply here...",value:j,onChange:e=>S(e.target.value),rows:6})]}),(0,s.jsxs)("div",{className:"seller-modal-footer",children:[(0,s.jsx)("button",{className:"seller-cancel-btn",onClick:()=>k(!1),children:"Cancel"}),(0,s.jsxs)("button",{className:"seller-send-btn",onClick:async()=>{if(j.trim()&&f)try{await d(f.id,"replied"),g(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"replied"}):null),S(""),k(!1)}catch(e){console.error("Failed to mark inquiry as replied:",e),alert("Failed to update inquiry status. Please try again.")}},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Send Reply"]})]})]})})]})},Yt=()=>{const{getStats:t}=gt(),{user:r}=l(),n=t(),[o,a]=(0,e.useState)("personal"),[c,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)(!1),[m,f]=(0,e.useState)({}),[g,y]=(0,e.useState)(!0),[_,v]=(0,e.useState)(""),[x,b]=(0,e.useState)(!1),[w,j]=(0,e.useState)(null),[S,T]=(0,e.useState)(!1),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(!1),[N,I]=(0,e.useState)(!1),[P,M]=(0,e.useState)(null),[L,R]=(0,e.useState)("environment"),D=(0,e.useRef)(null),F=(0,e.useRef)(null),O=(0,e.useRef)(null),z=(0,e.useRef)(null),B=(0,e.useRef)(null),[U,V]=(0,e.useState)({firstName:"",lastName:"",email:"",phone:"",whatsappNumber:"",alternateMobile:"",agencyName:"",agencyAddress:"",gstNumber:"",reraNumber:"",address:"",website:"",facebook:"",instagram:"",linkedin:""});(0,e.useEffect)(()=>{console.log("isEditing state changed to:",c)},[c]),(0,e.useEffect)(()=>{(async()=>{try{y(!0);const t=await i.v5.get();if(t.success&&t.data&&t.data.profile){const r=t.data.profile,n=(r.full_name||"").split(" "),i=n[0]||"",s=n.slice(1).join(" ")||"";let o=r.social_links||{};if("string"===typeof o)try{o=JSON.parse(o)}catch(e){o={}}v(r.profile_image||""),r.created_at&&j(r.created_at),T(1===r.agent_verified||!0===r.agent_verified),console.log("Initial profile load - WhatsApp number:",r.whatsapp_number),console.log("Initial profile load - Alternate mobile:",r.alternate_mobile),V({firstName:i,lastName:s,email:r.email||"",phone:r.phone||"",whatsappNumber:r.whatsapp_number||"",alternateMobile:r.alternate_mobile||"",agencyName:r.company_name||"",agencyAddress:r.address||"",gstNumber:r.gst_number||"",reraNumber:r.license_number||"",address:r.address||"",website:r.website||"",facebook:o.facebook||"",instagram:o.instagram||"",linkedin:o.linkedin||""}),console.log("Initial formData set with profile values")}else if(r){console.log("\u26a0\ufe0f No seller profile found, using auth context user data");const e=(r.full_name||r.name||"").split(" "),t=e[0]||"",n=e.slice(1).join(" ")||"";V({firstName:t,lastName:n,email:r.email||"",phone:r.phone||"",whatsappNumber:"",alternateMobile:"",agencyName:"",agencyAddress:"",gstNumber:"",reraNumber:"",address:"",website:"",facebook:"",instagram:"",linkedin:""}),v(r.profile_image||""),r.created_at&&j(r.created_at)}else v("")}catch(t){if(console.error("Error fetching profile:",t),r){console.log("\u26a0\ufe0f Profile API failed, using auth context user data as fallback");const e=(r.full_name||r.name||"").split(" "),t=e[0]||"",n=e.slice(1).join(" ")||"";V({firstName:t,lastName:n,email:r.email||"",phone:r.phone||"",whatsappNumber:"",alternateMobile:"",agencyName:"",agencyAddress:"",gstNumber:"",reraNumber:"",address:"",website:"",facebook:"",instagram:"",linkedin:""}),v(r.profile_image||""),r.created_at&&j(r.created_at)}else v("")}finally{y(!1)}})()},[]);const q=e=>{const{name:t,value:r}=e.target;let n=r;"whatsappNumber"!==t&&"alternateMobile"!==t||console.log("Field ".concat(t," changed:"),r),"firstName"===t||"lastName"===t?n=yt(r.toUpperCase()):["address","agencyName","agencyAddress"].includes(t)&&(n=yt(r)),V((0,p.A)((0,p.A)({},U),{},{[t]:n})),m[t]&&f(e=>(0,p.A)((0,p.A)({},e),{},{[t]:null}))},W=()=>{z.current&&(z.current.getTracks().forEach(e=>e.stop()),z.current=null),O.current&&(O.current.srcObject=null),I(!1),M(null)},H=async e=>{if(!e)return;const t=St(e);if(t.valid){b(!0),A(!1);try{const t=await i.v5.uploadProfileImage(e);t.success&&t.data&&t.data.url?(v(t.data.url),h(!0),setTimeout(()=>h(!1),3e3)):alert(t.message||"Failed to upload image")}catch(r){console.error("Error uploading image:",r),alert(r.message||"Failed to upload image. Please try again.")}finally{b(!1),D.current&&(D.current.value=""),F.current&&(F.current.value="")}}else alert(t.message)};(0,e.useEffect)(()=>{const e=e=>{C&&B.current&&!B.current.contains(e.target)&&E(!1)};return document.addEventListener("mousedown",e),document.addEventListener("click",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("click",e)}},[C]),(0,e.useEffect)(()=>()=>{z.current&&(z.current.getTracks().forEach(e=>e.stop()),z.current=null),O.current&&(O.current.srcObject=null)},[]);const G=async()=>{console.log("=== handleSave function called ==="),console.log("Current formData:",U),console.log("Current isEditing state:",c),C&&(console.log("Closing image menu"),E(!1)),console.log("Validating profile...");const e=(()=>{console.log("=== validateProfile called ==="),console.log("Current formData for validation:",U);const e={},t=jt(U.firstName,2,50,"First name");console.log("First name validation:",t),t.valid?/^[a-zA-Z\s]+$/.test(U.firstName)||(e.firstName="First name should contain only letters"):e.firstName=t.message;const r=jt(U.lastName,2,50,"Last name");r.valid?/^[a-zA-Z\s]+$/.test(U.lastName)||(e.lastName="Last name should contain only letters"):e.lastName=r.message;const n=(e=>{if(!e)return{valid:!1,message:"Email is required"};const t=/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(e);return{valid:t,message:t?"":"Invalid email format"}})(U.email);if(n.valid||(e.email=n.message),console.log("Validating WhatsApp number:",U.whatsappNumber),U.whatsappNumber){const t=_t(U.whatsappNumber);console.log("WhatsApp validation result:",t),t.valid||(e.whatsappNumber=t.message)}else console.log("WhatsApp number is empty/undefined - skipping validation (optional field)");if(console.log("Validating Alternate mobile:",U.alternateMobile),U.alternateMobile){const t=_t(U.alternateMobile);console.log("Alternate mobile validation result:",t),t.valid||(e.alternateMobile=t.message)}else console.log("Alternate mobile is empty/undefined - skipping validation (optional field)");if(U.agencyName){const t=jt(U.agencyName,2,100,"Agency name");t.valid||(e.agencyName=t.message)}if(U.gstNumber){const t=(e=>{if(!e)return{valid:!0,message:""};const t=/^[0-9]{2}[A-Z]{5}[0-9]{4}[A-Z]{1}[1-9A-Z]{1}Z[0-9A-Z]{1}$/.test(e.toUpperCase());return{valid:t,message:t?"":"Invalid GST number format (15 alphanumeric characters)"}})(U.gstNumber);t.valid||(e.gstNumber=t.message)}if(U.website){const t=vt(U.website);t.valid||(e.website=t.message)}U.facebook&&(vt(U.facebook).valid||(e.facebook="Invalid Facebook URL"));U.instagram&&(vt(U.instagram).valid||(e.instagram="Invalid Instagram URL"));U.linkedin&&(vt(U.linkedin).valid||(e.linkedin="Invalid LinkedIn URL"));if(U.address){const t=jt(U.address,0,500,"Address");t.valid||(e.address=t.message)}console.log("Validation errors found:",e),console.log("Validation passed:",0===Object.keys(e).length),f(e);const i=0===Object.keys(e).length;return console.log("=== validateProfile completed, returning:",i,"==="),i})();if(console.log("Validation result:",e),console.log("Validation errors:",m),e){try{console.log("Setting isEditing to false"),u(!1);const e="".concat(U.firstName," ").concat(U.lastName).trim();console.log("Full name prepared:",e);const n=(U.address||U.agencyAddress||"").trim();console.log("Address prepared:",n);const s=U.whatsappNumber?U.whatsappNumber.trim():"",o=U.alternateMobile?U.alternateMobile.trim():"";console.log("WhatsApp number raw:",U.whatsappNumber),console.log("WhatsApp number prepared:",s),console.log("Alternate mobile raw:",U.alternateMobile),console.log("Alternate mobile prepared:",o);const a={full_name:e,address:n,whatsapp_number:s,alternate_mobile:o};console.log("=== Sending update data to API ==="),console.log("Update data:",a),console.log("API endpoint: sellerProfileAPI.update");const l=await i.v5.update(a);if(console.log("=== API Response received ==="),console.log("Update response:",l),console.log("Response success:",null===l||void 0===l?void 0:l.success),l.success){console.log("Update successful! Showing success message"),h(!0),setTimeout(()=>{h(!1)},3e3),console.log("Refetching profile to get latest data...");try{const e=await i.v5.get();if(console.log("Profile refetch response:",e),e.success&&e.data&&e.data.profile){const r=e.data.profile;console.log("Refetched profile data:",r);const n=(r.full_name||"").split(" "),i=n[0]||"",s=n.slice(1).join(" ")||"";let o=r.social_links||{};if("string"===typeof o)try{o=JSON.parse(o)}catch(t){o={}}console.log("Updating formData with refetched profile"),console.log("Refetched WhatsApp number:",r.whatsapp_number),console.log("Refetched Alternate mobile:",r.alternate_mobile),V(e=>(0,p.A)((0,p.A)({},e),{},{firstName:i,lastName:s,address:r.address||"",email:r.email||e.email,phone:r.phone||e.phone,whatsappNumber:r.whatsapp_number||"",alternateMobile:r.alternate_mobile||"",agencyName:r.company_name||"",agencyAddress:r.address||"",gstNumber:r.gst_number||"",reraNumber:r.license_number||"",website:r.website||"",facebook:o.facebook||"",instagram:o.instagram||"",linkedin:o.linkedin||""})),console.log("FormData updated with refetched values"),r.profile_image&&v(r.profile_image),console.log("Profile update completed successfully")}}catch(r){if(console.error("Error refetching profile:",r),l.data&&l.data.profile){const e=l.data.profile,t=(e.full_name||"").split(" ");V(r=>(0,p.A)((0,p.A)({},r),{},{firstName:t[0]||"",lastName:t.slice(1).join(" ")||"",address:e.address||r.address||""}))}}}else console.error("Update failed - response.success is false"),console.error("Response message:",l.message),console.error("Full response:",l),alert(l.message||"Failed to update profile"),console.log("Re-enabling editing mode"),u(!0)}catch(n){console.error("=== Error in handleSave ==="),console.error("Error updating profile:",n),console.error("Error message:",n.message),console.error("Error stack:",n.stack),alert(n.message||"Failed to update profile. Please try again."),console.log("Re-enabling editing mode due to error"),u(!0)}console.log("=== handleSave function completed ===")}else console.log("Validation failed - returning without saving")},Z=[{id:"personal",label:"Personal Info",icon:(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2M12 11a4 4 0 100-8 4 4 0 000 8z",stroke:"currentColor",strokeWidth:"2"})})}];return g?(0,s.jsx)("div",{className:"seller-profile",style:{display:"flex",justifyContent:"center",alignItems:"center",minHeight:"400px"},children:(0,s.jsxs)("div",{style:{textAlign:"center"},children:[(0,s.jsx)("div",{className:"spinner",style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #003B73",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 1rem"}}),(0,s.jsx)("p",{children:"Loading profile..."}),(0,s.jsx)("style",{children:"\n            @keyframes spin {\n              0% { transform: rotate(0deg); }\n              100% { transform: rotate(360deg); }\n            }\n          "})]})}):(0,s.jsxs)("div",{className:"seller-profile",children:[d&&(0,s.jsxs)("div",{className:"seller-profile-success-toast",children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Profile updated successfully!"]}),(0,s.jsxs)("div",{className:"seller-profile-header",children:[(0,s.jsx)("h1",{children:"Profile Settings"}),(0,s.jsx)("p",{className:"seller-profile-subtitle",children:"Manage your account information and preferences"})]}),(0,s.jsxs)("div",{className:"seller-profile-layout",children:[(0,s.jsxs)("div",{className:"seller-profile-card",children:[(0,s.jsx)("div",{className:"seller-profile-cover"}),(0,s.jsxs)("div",{className:"seller-seller-profile-avatar-img-section",children:[(0,s.jsxs)("div",{className:"seller-seller-profile-avatar-img-wrapper",ref:B,children:[(0,s.jsx)("input",{type:"file",ref:D,accept:"image/jpeg,image/jpg,image/png,image/webp",onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&H(r)},style:{display:"none"}}),(0,s.jsx)("input",{type:"file",ref:F,accept:"image/*",capture:"environment",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&H(r)},style:{display:"none"}}),_&&!k?(0,s.jsx)("img",{src:_,alt:"Profile",className:"seller-profile-avatar-img",onError:()=>A(!0)}):(0,s.jsxs)("div",{className:"seller-profile-avatar-initials",children:[U.firstName?U.firstName.charAt(0).toUpperCase():"",U.lastName?U.lastName.charAt(0).toUpperCase():"",U.firstName||U.lastName?"":"U"]}),(0,s.jsxs)("div",{className:"seller-avatar-upload-wrapper",children:[(0,s.jsx)("button",{className:"seller-profile-avatar-seller-profile-edit-btn",onClick:()=>E(!C),disabled:x,title:"Change profile photo",children:x?(0,s.jsx)("div",{className:"spinner-small"}):(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]})}),C&&!x&&(0,s.jsxs)("div",{className:"seller-image-upload-menu",children:[(0,s.jsxs)("button",{onClick:()=>{var e;E(!1),null===(e=D.current)||void 0===e||e.click()},className:"seller-upload-menu-item",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Upload from Device"})]}),(0,s.jsxs)("button",{onClick:async()=>{E(!1);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void alert("Camera is not supported on this device. Please use gallery upload instead.");const r={video:{facingMode:{exact:"environment"},width:{ideal:1920},height:{ideal:1080}}};let n;try{n=await navigator.mediaDevices.getUserMedia(r)}catch(e){try{n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}})}catch(t){n=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080}}})}}z.current=n,R("environment"),I(!0),setTimeout(()=>{O.current&&n&&(O.current.srcObject=n,O.current.play())},100)}catch(r){console.error("Error accessing camera:",r),"NotAllowedError"===r.name||"PermissionDeniedError"===r.name?alert("Camera permission denied. Please allow camera access and try again."):"NotFoundError"===r.name||"DevicesNotFoundError"===r.name?alert("No camera found on this device. Please use gallery upload instead."):alert("Failed to access camera. Please try again or use gallery upload.")}},className:"seller-upload-menu-item",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Take Photo"})]})]})]})]}),(0,s.jsx)("h2",{children:U.firstName||U.lastName?"".concat(U.firstName," ").concat(U.lastName).trim():"Your Name"}),(0,s.jsx)("p",{className:"seller-profile-role",children:"Seller"}),S&&(0,s.jsx)("div",{className:"seller-profile-badges",children:(0,s.jsxs)("span",{className:"seller-profile-badge verified",children:[(0,s.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})}),"Verified"]})})]}),(0,s.jsxs)("div",{className:"seller-profile-stats-grid",children:[(0,s.jsxs)("div",{className:"seller-profile-stat-box",children:[(0,s.jsx)("span",{className:"seller-profile-stat-value",children:n.totalProperties||0}),(0,s.jsx)("span",{className:"seller-profile-stat-label",children:"Listed"})]}),(0,s.jsxs)("div",{className:"seller-profile-stat-box",children:[(0,s.jsx)("span",{className:"seller-profile-stat-value",children:n.totalInquiries||0}),(0,s.jsx)("span",{className:"seller-profile-stat-label",children:"Inquiries"})]})]}),(0,s.jsxs)("div",{className:"seller-profile-member-since",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"4",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M16 2v4M8 2v4M3 10h18",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(e=>{if(!e)return"Member since recently";try{const t=new Date(e),r=t.toLocaleDateString("en-US",{month:"long"}),n=t.getFullYear();return"Member since ".concat(r," ").concat(n)}catch(t){return"Member since recently"}})(w)]})]}),(0,s.jsxs)("div",{className:"seller-profile-settings-content",children:[(0,s.jsx)("div",{className:"seller-profile-settings-tabs",children:Z.map(e=>(0,s.jsxs)("button",{className:"seller-profile-tab-btn ".concat(o===e.id?"active":""),onClick:()=>a(e.id),children:[e.icon,(0,s.jsx)("span",{children:e.label})]},e.id))}),(0,s.jsx)("div",{className:"seller-profile-tab-content",children:"personal"===o&&(0,s.jsxs)("div",{className:"seller-profile-settings-section",children:[(0,s.jsxs)("div",{className:"seller-profile-section-header",children:[(0,s.jsx)("h3",{children:"Personal Information"}),!c&&(0,s.jsxs)("button",{className:"seller-profile-edit-btn",onClick:()=>{console.log("Edit button clicked - Setting isEditing to true"),u(!0)},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]}),"Edit"]})]}),(0,s.jsxs)("div",{className:"seller-profile-form-grid",children:[(0,s.jsxs)("div",{className:"seller-profile-form-group",children:[(0,s.jsx)("label",{children:"First Name"}),(0,s.jsx)("input",{type:"text",name:"firstName",value:U.firstName,onChange:q,disabled:!c,className:m.firstName?"error":""}),m.firstName&&(0,s.jsx)("span",{className:"seller-profile-error-text",children:m.firstName})]}),(0,s.jsxs)("div",{className:"seller-profile-form-group",children:[(0,s.jsx)("label",{children:"Last Name"}),(0,s.jsx)("input",{type:"text",name:"lastName",value:U.lastName,onChange:q,disabled:!c,className:m.lastName?"error":""}),m.lastName&&(0,s.jsx)("span",{className:"seller-profile-error-text",children:m.lastName})]}),(0,s.jsxs)("div",{className:"seller-profile-form-group",children:[(0,s.jsx)("label",{children:"Email Address"}),(0,s.jsxs)("div",{className:"seller-profile-input-with-icon",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M22 6l-10 7L2 6",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("input",{type:"email",name:"email",value:U.email,readOnly:!0,disabled:!0,style:{backgroundColor:"#f3f4f6",cursor:"not-allowed"},className:m.email?"error":""})]})]}),(0,s.jsxs)("div",{className:"seller-profile-form-group",children:[(0,s.jsx)("label",{children:"Phone Number"}),(0,s.jsxs)("div",{className:"seller-profile-input-with-icon",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"phone",value:U.phone,readOnly:!0,disabled:!0,style:{backgroundColor:"#f3f4f6",cursor:"not-allowed"},className:m.phone?"error":"",placeholder:"+917276*****"})]}),(0,s.jsx)("small",{style:{color:"#6b7280",fontSize:"0.75rem",marginTop:"0.25rem",display:"block"},children:"Login mobile number (cannot be changed)"})]}),(0,s.jsxs)("div",{className:"seller-profile-form-group",children:[(0,s.jsxs)("label",{children:["WhatsApp Number ",(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"normal"},children:"(Optional)"})]}),(0,s.jsxs)("div",{className:"seller-profile-input-with-icon",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"whatsappNumber",value:U.whatsappNumber,onChange:q,disabled:!c,placeholder:"+917276*****",className:m.whatsappNumber?"error":""})]}),m.whatsappNumber&&(0,s.jsx)("span",{className:"seller-profile-error-text",children:m.whatsappNumber})]}),(0,s.jsxs)("div",{className:"seller-profile-form-group",children:[(0,s.jsxs)("label",{children:["Alternate Mobile Number ",(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"normal"},children:"(Optional)"})]}),(0,s.jsxs)("div",{className:"seller-profile-input-with-icon",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"alternateMobile",value:U.alternateMobile,onChange:q,disabled:!c,placeholder:"+917276*****",className:m.alternateMobile?"error":""})]}),m.alternateMobile&&(0,s.jsx)("span",{className:"seller-profile-error-text",children:m.alternateMobile})]}),(0,s.jsxs)("div",{className:"seller-profile-form-group seller-profile-full-width",children:[(0,s.jsx)("label",{children:"Address"}),(0,s.jsx)("textarea",{name:"address",value:U.address,onChange:q,disabled:!c,rows:3,className:m.address?"error":""}),m.address&&(0,s.jsx)("span",{className:"seller-profile-error-text",children:m.address})]})]}),c&&(0,s.jsxs)("div",{className:"seller-profile-form-actions",children:[(0,s.jsx)("button",{type:"button",className:"seller-profile-cancel-btn",onClick:()=>{console.log("Cancel button clicked - Setting isEditing to false"),u(!1)},children:"Cancel"}),(0,s.jsxs)("button",{type:"button",className:"seller-profile-save-btn",onClick:()=>{console.log("Save Changes button clicked"),console.log("Current formData:",U),console.log("Current isEditing state:",c),G()},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M19 21H5a2 2 0 01-2-2V5a2 2 0 012-2h11l5 5v11a2 2 0 01-2 2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M17 21v-8H7v8M7 3v5h8",stroke:"currentColor",strokeWidth:"2"})]}),"Save Changes"]})]})]})})]})]}),N&&(0,s.jsx)("div",{className:"seller-camera-modal-overlay",onClick:W,children:(0,s.jsxs)("div",{className:"seller-camera-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"seller-camera-modal-header",children:[(0,s.jsx)("h3",{children:"Take Photo"}),(0,s.jsx)("button",{className:"seller-camera-close-btn",onClick:W,"aria-label":"Close camera",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"seller-camera-content",children:P?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:URL.createObjectURL(P),alt:"Captured",className:"seller-camera-preview"}),(0,s.jsxs)("div",{className:"seller-camera-preview-controls",children:[(0,s.jsxs)("button",{className:"seller-camera-retake-btn",onClick:()=>{M(null)},children:[(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Retake"]}),(0,s.jsx)("button",{className:"seller-camera-use-btn",onClick:()=>{P&&(H(P),W())},disabled:x,children:x?(0,s.jsx)("div",{className:"spinner-small"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Use Photo"]})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("video",{ref:O,autoPlay:!0,playsInline:!0,muted:!0,className:"seller-camera-video"}),(0,s.jsxs)("div",{className:"seller-camera-controls",children:[(0,s.jsx)("button",{className:"seller-camera-flip-btn",onClick:async()=>{const e="environment"===L?"user":"environment";z.current&&(z.current.getTracks().forEach(e=>e.stop()),z.current=null);try{const r={video:{facingMode:{exact:e},width:{ideal:1920},height:{ideal:1080}}};let n;try{n=await navigator.mediaDevices.getUserMedia(r)}catch(t){n=await navigator.mediaDevices.getUserMedia({video:{facingMode:e,width:{ideal:1920},height:{ideal:1080}}})}R(e),z.current=n,O.current&&(O.current.srcObject=n,O.current.play())}catch(r){console.error("Error flipping camera:",r),alert("Failed to switch camera. Please try again.")}},"aria-label":"Flip camera",title:"Flip camera",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M17 1l4 4-4 4M21 5H11M7 23l-4-4 4-4M3 19h10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 12a3 3 0 11-6 0 3 3 0 016 0z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{className:"seller-camera-capture-btn",onClick:()=>{if(O.current){const e=O.current,t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t.getContext("2d").drawImage(e,0,0),t.toBlob(e=>{if(e){const t=new File([e],"camera-photo.jpg",{type:"image/jpeg"});M(t)}},"image/jpeg",.9)}},"aria-label":"Capture photo",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"white",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"4",fill:"white"})]})}),(0,s.jsx)("button",{className:"seller-camera-cancel-btn",onClick:W,"aria-label":"Cancel",children:"Cancel"})]})]})})]})})]})},Xt=e=>{let{variant:t="default",onNavigate:r,subscriptionPath:i="/seller-dashboard/subscription"}=e;const o=(0,n.Zp)();return(0,s.jsx)("div",{className:"subscription-pricing-card subscription-pricing-card--".concat(t),children:(0,s.jsxs)("div",{className:"subscription-pricing-card__inner",children:[(0,s.jsx)("h3",{className:"subscription-pricing-card__title",children:"Property Listing Subscription"}),(0,s.jsxs)("p",{className:"subscription-pricing-card__message",children:["List your property for just"," ",(0,s.jsx)("span",{className:"subscription-pricing-card__price",children:"\u20b999"})," per month per property ",(0,s.jsx)("span",{className:"subscription-pricing-card__gst",children:"+ GST"})]}),(0,s.jsxs)("ul",{className:"subscription-pricing-card__features",children:[(0,s.jsx)("li",{children:"Upload and manage properties easily"}),(0,s.jsx)("li",{children:"Get verified buyer leads"}),(0,s.jsx)("li",{children:"Increase visibility across India"}),(0,s.jsx)("li",{children:"Pay only for the properties you list"})]}),(0,s.jsx)("button",{type:"button",className:"subscription-pricing-card__cta",onClick:()=>{r?r("subscription"):o(i)},children:"Activate Listing Plan"}),(0,s.jsx)("p",{className:"subscription-pricing-card__note",children:"No long-term commitment. Cancel anytime."})]})})},Jt=()=>{const[t,r]=(0,e.useState)({days:0,hours:0,minutes:0,seconds:0}),[n,o]=(0,e.useState)(!0),a=(0,e.useRef)(null);return(0,e.useEffect)(()=>((async()=>{try{var e,t;const n=await i.S3.getStats();let s;if(n.success&&null!==(e=n.data)&&void 0!==e&&null!==(t=e.subscription)&&void 0!==t&&t.end_date){if(s=new Date(n.data.subscription.end_date),isNaN(s.getTime()))throw new Error("Invalid end date format")}else s=new Date,s.setMonth(s.getMonth()+3);a.current&&clearInterval(a.current),a.current=setInterval(()=>{const e=(new Date).getTime(),t=s.getTime()-e;t<0?(a.current&&clearInterval(a.current),r({days:0,hours:0,minutes:0,seconds:0})):r({days:Math.floor(t/864e5),hours:Math.floor(t%864e5/36e5),minutes:Math.floor(t%36e5/6e4),seconds:Math.floor(t%6e4/1e3)})},1e3),o(!1)}catch(n){console.error("Error fetching subscription data:",n);const e=new Date;e.setMonth(e.getMonth()+3),a.current&&clearInterval(a.current),a.current=setInterval(()=>{const t=(new Date).getTime(),n=e.getTime()-t;n<0?(a.current&&clearInterval(a.current),r({days:0,hours:0,minutes:0,seconds:0})):r({days:Math.floor(n/864e5),hours:Math.floor(n%864e5/36e5),minutes:Math.floor(n%36e5/6e4),seconds:Math.floor(n%6e4/1e3)})},1e3),o(!1)}})(),()=>{a.current&&clearInterval(a.current)}),[]),n?(0,s.jsx)("div",{className:"seller-timer-page",children:(0,s.jsx)("div",{className:"seller-timer-content",children:(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading subscription data..."})})})}):(0,s.jsx)("div",{className:"seller-timer-page",children:(0,s.jsxs)("div",{className:"seller-timer-content",children:[(0,s.jsx)("div",{className:"seller-timer-badge",children:"LIMITED TIME OFFER"}),(0,s.jsxs)("h1",{className:"seller-timer-title",children:[(0,s.jsx)("span",{className:"seller-timer-title-purple",children:"3 Months Free"}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"seller-timer-title-white",children:"Premium Property Upload Access"})]}),(0,s.jsxs)("div",{className:"seller-timer-card",children:[(0,s.jsxs)("div",{className:"seller-timer-header",children:[(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",className:"seller-timer-clock-icon",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsx)("h2",{children:"Your Trial Expires In"})]}),(0,s.jsx)("div",{className:"seller-timer-display",children:["days","hours","minutes","seconds"].map((r,n)=>(0,s.jsxs)(e.Fragment,{children:[(0,s.jsxs)("div",{className:"seller-timer-time-block",children:[(0,s.jsx)("div",{className:"seller-timer-time-box",children:String(t[r]).padStart(2,"0")}),(0,s.jsx)("div",{className:"seller-timer-time-label",children:r.toUpperCase()})]}),n<3&&(0,s.jsx)("div",{className:"seller-timer-separator",children:":"})]},r))})]}),(0,s.jsxs)("div",{className:"seller-timer-pricing-section",children:[(0,s.jsx)("h2",{className:"seller-timer-pricing-heading",children:"After your trial"}),(0,s.jsx)(Xt,{variant:"page"})]})]})})};function Qt(){const t=(0,e.useRef)(null),[r,n]=(0,e.useState)({name:"",email:"",phone:"",message:""}),[i,o]=(0,e.useState)(!1),[a,l]=(0,e.useState)(!1),[c,u]=(0,e.useState)(null),d=(0,e.useCallback)(e=>{const{name:t,value:r}=e.target;n(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r}))},[]);return(0,s.jsx)("div",{className:"seller-contact-main",children:(0,s.jsxs)("div",{className:"seller-contact-container",children:[(0,s.jsxs)("div",{className:"seller-contact-header",children:[(0,s.jsx)("h1",{className:"seller-contact-title",children:"Get In Touch"}),(0,s.jsx)("p",{className:"seller-header-text",children:"Contact us for a free quote or emergency service"})]}),(0,s.jsxs)("div",{className:"seller-contact-two-column",children:[(0,s.jsxs)("div",{className:"seller-contact-info-card",children:[(0,s.jsx)("h2",{className:"seller-contact-info-title",children:"Contact Information"}),(0,s.jsxs)("div",{className:"seller-contact-info-item",children:[(0,s.jsx)("div",{className:"seller-contact-info-label",children:"Phone"}),(0,s.jsx)("a",{href:"tel:+919371316019",className:"seller-contact-info-link",children:"+919371316019"})]}),(0,s.jsxs)("div",{className:"seller-contact-info-item",children:[(0,s.jsx)("div",{className:"seller-contact-info-label",children:"Email"}),(0,s.jsx)("a",{href:"mailto:info@360coordinates.com",className:"seller-contact-info-link",children:"info@360coordinates.com"})]}),(0,s.jsxs)("div",{className:"seller-contact-info-item",children:[(0,s.jsx)("div",{className:"seller-contact-info-label",children:"Address"}),(0,s.jsxs)("a",{href:"https://www.google.com/maps/search/?api=1&query=Office+No.21+%26+22,+3rd+Floor,+S%2FNo.+56,+Aston+Plaza,+Ambegaon+Bk.,+Pune,+Maharashtra+411046",target:"_blank",rel:"noopener noreferrer",className:"seller-contact-info-address",children:["Office No.21 & 22, 3rd Floor, S/No. 56",(0,s.jsx)("br",{}),"Aston Plaza, Ambegaon Bk.",(0,s.jsx)("br",{}),"Pune, Maharashtra\u2013 411046"]})]})]}),(0,s.jsxs)("div",{className:"seller-form-card",children:[(0,s.jsx)("h2",{className:"seller-form-title",children:"Send Us a Message"}),a&&(0,s.jsx)("div",{className:"seller-success-box",children:"Message sent successfully!"}),(0,s.jsxs)("form",{ref:t,className:"seller-form-inputs",onSubmit:e=>{e&&(e.preventDefault(),e.stopPropagation());const t=window.pageYOffset||document.documentElement.scrollTop;if(!r.name||!r.email||!r.phone||!r.message)return alert("Please fill all fields"),void window.scrollTo({top:t,behavior:"auto"});o(!0),setTimeout(()=>{o(!1),l(!0),n({name:"",email:"",phone:"",message:""}),requestAnimationFrame(()=>{window.scrollTo({top:t,behavior:"auto"})}),setTimeout(()=>l(!1),2500)},1500)},onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[(0,s.jsx)("input",{type:"text",name:"name",value:r.name,onChange:d,placeholder:"Your Name"}),(0,s.jsx)("input",{type:"email",name:"email",value:r.email,onChange:d,placeholder:"Your Email"}),(0,s.jsx)("input",{type:"text",name:"phone",value:r.phone,onChange:d,placeholder:"Phone Number"}),(0,s.jsx)("textarea",{name:"message",rows:"4",value:r.message,onChange:d,placeholder:"Message"}),(0,s.jsx)("button",{type:"submit",disabled:i,children:i?"Sending...":"Send Message"})]})]})]}),(0,s.jsxs)("div",{className:"seller-faq-section",children:[(0,s.jsx)("h2",{className:"seller-faq-title",children:"Frequently Asked Questions"}),(0,s.jsx)("div",{className:"seller-faq-list",children:[{question:"How do I list a property?",answer:"To list your property, log in to your seller dashboard and click on 'My Properties'. Then click the 'Add Property' button and fill in all the required details including property type, location, price, and images. Once submitted, your property will be reviewed and published."},{question:"How can I contact the property owner?",answer:"You can contact property owners directly through our chat feature. Simply click on the 'Chat' button on any property listing page, or use the ChatUs page in your dashboard. Property owners will receive your message and can respond to your inquiries."},{question:"Is my data secure?",answer:"Yes, we take data security seriously. All your personal information, including contact details and property data, is encrypted and stored securely. We follow industry-standard security practices and never share your information with third parties without your consent."},{question:"How do I edit my profile?",answer:"To edit your profile, go to your dashboard and click on 'Profile' in the navigation menu. From there, you can update your personal information, contact details, profile picture, and other settings. Remember to save your changes before leaving the page."},{question:"How can I get support?",answer:"You can get support by filling out the contact form on this page, or by emailing us directly at info@360coordinates.com. Our support team typically responds within 24 hours. You can also call us at +919371316019 during business hours."}].map((e,t)=>(0,s.jsxs)("div",{className:"seller-faq-item ".concat(c===t?"open":""),children:[(0,s.jsxs)("button",{className:"seller-faq-question",onClick:()=>u(c===t?null:t),children:[(0,s.jsx)("span",{children:e.question}),(0,s.jsx)(P,{size:20,className:"seller-faq-icon ".concat(c===t?"open":"")})]}),c===t&&(0,s.jsx)("div",{className:"seller-faq-answer",children:(0,s.jsx)("p",{children:e.answer})})]},t))})]})]})})}const $t=()=>{var t,r,o,a,c,u,d,h;const{user:p,logout:m,switchRole:f,token:g}=l(),[y,_]=(0,e.useState)("overview"),[v,x]=(0,e.useState)(!1),[b,w]=(0,e.useState)(!1),[j,S]=(0,e.useState)(89),[T,k]=(0,e.useState)(!1),[A,C]=(0,e.useState)(!1),E=(0,e.useRef)(null),N=(0,n.Zp)(),I=(0,n.zy)(),P=(0,e.useRef)(I.pathname),{inquiries:M}=gt(),[L,R]=(0,e.useState)(0),D=(0,e.useMemo)(()=>L,[L]);(0,e.useEffect)(()=>{if(P.current===I.pathname)return;P.current=I.pathname;if(I.pathname.includes("/seller-pro-details/")||I.pathname.includes("/details/"))return;let e=null;I.pathname.includes("/properties")||"/seller-dashboard/properties"===I.pathname?e="properties":I.pathname.includes("/inquiries")||"/seller-dashboard/inquiries"===I.pathname?e="inquiries":I.pathname.includes("/profile")||"/seller-dashboard/profile"===I.pathname?e="profile":I.pathname.includes("/subscription")||"/seller-dashboard/subscription"===I.pathname?e="subscription":I.pathname.includes("/support")||"/seller-dashboard/support"===I.pathname?e="support":"/seller-dashboard"!==I.pathname&&"/seller-dashboard/"!==I.pathname||(e="overview"),e&&_(t=>t!==e?e:t)},[I.pathname]),(0,e.useEffect)(()=>{let e=!1,t=!1;const r=()=>{e||(window.requestAnimationFrame(()=>{const r=window.scrollY>10;r!==t&&(t=r,w(r)),e=!1}),e=!0)};return window.addEventListener("scroll",r,{passive:!0}),()=>window.removeEventListener("scroll",r)},[]),(0,e.useEffect)(()=>{const e=e=>{E.current&&!E.current.contains(e.target)&&k(!1)};return T&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[T]);(0,e.useEffect)(()=>{const e=async()=>{try{var e,t;const r=await i.S3.getStats();if(r.success&&null!==(e=r.data)&&void 0!==e&&null!==(t=e.subscription)&&void 0!==t&&t.end_date){const e=new Date(r.data.subscription.end_date),t=new Date,n=e.getTime()-t.getTime(),i=Math.ceil(n/864e5);S(Math.max(0,i))}else{const e=localStorage.getItem("trialStartDate");if(e){const t=new Date(e),r=new Date(t);r.setMonth(r.getMonth()+3);const n=r-new Date,i=Math.ceil(n/864e5);S(Math.max(0,i))}}}catch(r){console.error("Error fetching subscription data:",r);const e=localStorage.getItem("trialStartDate");if(e){const t=new Date(e),r=new Date(t);r.setMonth(r.getMonth()+3);const n=r-new Date,i=Math.ceil(n/864e5);S(Math.max(0,i))}}};e();const t=setInterval(()=>{e()},6e4);return()=>clearInterval(t)},[]);const F=()=>{m(),window.location.href="/"},O=async()=>{if(console.log("\ud83d\udd04 Switch to Buyer button clicked"),!p||!g)return console.log("\u274c No token or user - redirecting to login"),void N("/login");try{console.log("\ud83d\udd04 Calling switchRole API to switch to buyer...");const e=await f("buyer");e.success?(console.log("\u2705 Role switched to buyer successfully"),N("/buyer-dashboard",{replace:!1})):(console.error("\u274c Role switch failed:",e.message),N("/buyer-dashboard",{replace:!1}))}catch(e){console.error("\u274c Error switching role:",e),N("/buyer-dashboard",{replace:!1})}},z=e=>{console.log("Tab changed to:",e),_(e),x(!1),window.scrollTo({top:0,behavior:"smooth"}),"overview"===e?N("/seller-dashboard"):"properties"===e?N("/seller-dashboard/properties"):"inquiries"===e?N("/seller-dashboard/inquiries"):"profile"===e?N("/seller-dashboard/profile"):"subscription"===e?N("/seller-dashboard/subscription"):"support"===e&&N("/seller-dashboard/support")},B=[{id:"overview",label:"Dashboard",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]})},{id:"properties",label:"My Properties",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})},{id:"inquiries",label:"Inquiries",icon:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})},{id:"profile",label:"Profile",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]})},{id:"subscription",label:"Subscription",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M6 15h4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M14 15h4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}];return(0,s.jsxs)("div",{className:"seller-dashboard",children:[(0,s.jsxs)("header",{className:"seller-header ".concat(b?"scrolled":""),children:[(0,s.jsxs)("div",{className:"header-left",children:[(0,s.jsxs)("button",{className:"menu-toggle ".concat(v?"active":""),onClick:()=>x(!v),"aria-label":"Toggle menu",children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{}),(0,s.jsx)("span",{})]}),(0,s.jsx)("div",{className:"logo",onClick:()=>z("overview"),style:{cursor:"pointer"},title:"Go to Dashboard",children:(0,s.jsx)("div",{className:"logo-icon-wrapper",children:(0,s.jsx)("img",{src:"/finallogo.png",alt:"logo"})})})]}),(0,s.jsx)("nav",{className:"header-nav",children:B.map(e=>{const t=!(I.pathname.includes("/seller-pro-details/")||I.pathname.includes("/details/"))&&y===e.id;return(0,s.jsxs)("button",{className:"nav-btn ".concat(t?"active":""),onClick:t=>{t.preventDefault(),t.stopPropagation(),z(e.id)},type:"button",children:[(0,s.jsx)("span",{className:"nav-icon",children:e.icon}),(0,s.jsx)("span",{className:"nav-label",children:e.label}),"inquiries"===e.id&&D>0&&(0,s.jsx)("span",{className:"nav-badge",children:D})]},e.id)})}),(0,s.jsxs)("div",{className:"header-right",children:[(0,s.jsxs)("button",{className:"free-trial-badge ".concat(j<=7?"urgent":""),onClick:()=>z("subscription"),children:[(0,s.jsx)("span",{className:"trial-text",children:"Free Trial"}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"trial-days",children:j}),(0,s.jsx)("span",{className:"trial-text",children:"days left"})]}),(0,s.jsxs)("button",{className:"seller-switch-buyer-btn",title:"Switch to Buyer Dashboard",onClick:O,children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",style:{marginRight:"6px"},children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]}),(0,s.jsx)("span",{children:"Buy Property"})]}),(0,s.jsxs)("div",{className:"seller-user-header",ref:E,onClick:()=>{k(!T)},children:[(0,s.jsx)("div",{className:"seller-user-avatar",children:null!==p&&void 0!==p&&p.profile_image&&!A?(0,s.jsx)("img",{src:p.profile_image,alt:(null===p||void 0===p?void 0:p.full_name)||(null===p||void 0===p?void 0:p.name)||"User",onError:()=>C(!0)}):(0,s.jsx)("span",{children:(null===p||void 0===p||null===(t=p.full_name)||void 0===t||null===(r=t.charAt(0))||void 0===r?void 0:r.toUpperCase())||(null===p||void 0===p||null===(o=p.name)||void 0===o||null===(a=o.charAt(0))||void 0===a?void 0:a.toUpperCase())||(null===p||void 0===p||null===(c=p.email)||void 0===c||null===(u=c.charAt(0))||void 0===u?void 0:u.toUpperCase())||"U"})}),T&&(0,s.jsxs)("div",{className:"seller-user-dropdown",children:[(0,s.jsxs)("button",{onClick:()=>{k(!1),z("profile")},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),"My Profile"]}),(0,s.jsxs)("button",{onClick:()=>{k(!1),z("support")},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M13 7H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M17 11H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Support"]}),(0,s.jsxs)("button",{onClick:F,children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Logout"]})]})]})]})]}),(0,s.jsx)("div",{className:"sidebar-overlay ".concat(v?"active":""),onClick:()=>x(!1)}),(0,s.jsxs)("aside",{className:"mobile-sidebar ".concat(v?"open":""),children:[(0,s.jsxs)("div",{className:"mobile-sidebar-header",children:[(0,s.jsxs)("div",{className:"logo",onClick:()=>z("overview"),style:{cursor:"pointer"},children:[(0,s.jsx)("div",{className:"logo-icon-wrapper",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",fill:"white",stroke:"white",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M9 22V12h6v10",stroke:"#003B73",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"logo-text",children:"360Coordinates"})]}),(0,s.jsx)("button",{className:"close-sidebar",onClick:()=>x(!1),"aria-label":"Close menu",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsxs)("div",{className:"mobile-user-section",onClick:()=>z("profile"),style:{cursor:"pointer"},children:[(0,s.jsx)("div",{className:"mobile-user-avatar",children:null!==p&&void 0!==p&&p.name?p.name.charAt(0).toUpperCase():(null===p||void 0===p||null===(d=p.email)||void 0===d?void 0:d.charAt(0).toUpperCase())||"U"}),(0,s.jsxs)("div",{className:"mobile-user-info",children:[(0,s.jsx)("span",{className:"mobile-user-name",children:(null===p||void 0===p?void 0:p.full_name)||(null===p||void 0===p||null===(h=p.email)||void 0===h?void 0:h.split("@")[0])||"User"}),(0,s.jsx)("span",{className:"mobile-user-role",children:"agent"===(null===p||void 0===p?void 0:p.user_type)?"Agent/Builder":"Seller"})]})]}),(0,s.jsxs)("nav",{className:"mobile-nav",children:[B.map(e=>(0,s.jsxs)("button",{className:"mobile-nav-btn ".concat(y===e.id?"active":""),onClick:()=>z(e.id),children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:e.icon}),(0,s.jsx)("span",{className:"mobile-nav-label",children:e.label}),"inquiries"===e.id&&D>0&&(0,s.jsx)("span",{className:"mobile-nav-badge",children:D})]},e.id)),(0,s.jsx)("div",{className:"mobile-nav-divider"}),(0,s.jsxs)("button",{className:"seller-mobile-switch-btn",onClick:O,title:"Switch to Buyer Dashboard",children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)("span",{className:"mobile-nav-label",children:"Switch to Buyer"})]}),(0,s.jsxs)("button",{className:"mobile-nav-btn",onClick:()=>z("support"),children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M13 7H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M17 11H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"mobile-nav-label",children:"Support"})]}),(0,s.jsx)("div",{className:"mobile-nav-divider"}),(0,s.jsxs)("button",{className:"mobile-nav-btn logout",onClick:F,children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("span",{className:"mobile-nav-label",children:"Logout"})]})]})]}),(0,s.jsx)("main",{className:"seller-main",children:(0,s.jsx)("div",{className:"main-content-wrapper",children:(()=>{if(I.pathname.includes("/seller-pro-details/")||I.pathname.includes("/details/"))return(0,s.jsx)(Ve,{});switch(y){case"overview":return console.log("\ud83d\udcca Rendering SellerOverview"),(0,s.jsx)(Ht,{onNavigate:z});case"properties":return console.log("\ud83c\udfe0 Rendering SellerProperties"),(0,s.jsx)(Zt,{});case"inquiries":return console.log("\ud83d\udcac Rendering SellerInquiries"),(0,s.jsx)(Kt,{onUnreadCountChange:R});case"profile":return console.log("\ud83d\udc64 Rendering SellerProfile"),(0,s.jsx)(Yt,{});case"subscription":return console.log("\ud83d\udcb3 Rendering Subscription"),(0,s.jsx)(Jt,{});case"support":return console.log("\ud83d\udcde Rendering Support/Contact"),(0,s.jsx)(Qt,{});default:return console.log("\ud83d\udcca Rendering SellerOverview (default)"),(0,s.jsx)(Ht,{onNavigate:z})}})()})})]})},er=()=>(0,s.jsx)(ft,{children:(0,s.jsx)($t,{})}),tr=t=>{let{children:r,allowedRoles:i}=t;const{user:o,loading:a,isVerified:c,verificationError:u,retryVerification:d}=l(),h=(0,n.zy)(),[p,m]=(0,e.useState)(!1);if(a)return(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"1rem"},children:[(0,s.jsx)("div",{className:"spinner",style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0077C0",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,s.jsx)("p",{children:"Loading..."}),(0,s.jsx)("style",{children:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        "})]});if(!o)return(0,s.jsx)(n.C5,{to:"/login",replace:!0});const f=o.user_type||o.role,g=h.pathname.startsWith("/seller-dashboard"),y="buyer"===f&&g;if(i&&!i.includes(f)&&!y)return(0,s.jsx)(n.C5,{to:"/",replace:!0});const _=!c&&u;return(0,s.jsxs)(s.Fragment,{children:[_&&(0,s.jsxs)("div",{style:{backgroundColor:"#fff3cd",border:"1px solid #ffc107",color:"#856404",padding:"12px 16px",display:"flex",justifyContent:"space-between",alignItems:"center",position:"sticky",top:0,zIndex:1e3,boxShadow:"0 2px 4px rgba(0,0,0,0.1)"},children:[(0,s.jsxs)("div",{style:{flex:1},children:[(0,s.jsx)("strong",{children:"\u26a0\ufe0f Connection Issue:"})," Unable to verify your session. You're using cached credentials.",(null===u||void 0===u?void 0:u.message)&&(0,s.jsx)("div",{style:{fontSize:"0.9em",marginTop:"4px"},children:u.message})]}),(0,s.jsx)("button",{onClick:async()=>{m(!0);try{await d()}finally{m(!1)}},disabled:p,style:{marginLeft:"16px",padding:"8px 16px",backgroundColor:"#ffc107",color:"#856404",border:"1px solid #ffc107",borderRadius:"4px",cursor:p?"not-allowed":"pointer",fontWeight:"bold",opacity:p?.6:1},children:p?"Retrying...":"Retry Verification"})]}),r]})},rr=e=>{let{children:t,allowAgents:r=!1}=e;const{user:i,loading:o}=l();if(o)return(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"1rem"},children:[(0,s.jsx)("div",{className:"spinner",style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0077C0",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,s.jsx)("p",{children:"Loading..."}),(0,s.jsx)("style",{children:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        "})]});if(!i)return t;const a=i.user_type||i.role;return"buyer"!==a?r&&"agent"===a?t:"agent"===a?(0,s.jsx)(n.C5,{to:"/agent-dashboard",replace:!0}):"seller"===a?(0,s.jsx)(n.C5,{to:"/seller-dashboard",replace:!0}):(0,s.jsx)(n.C5,{to:"/",replace:!0}):t},nr=e=>{let{children:t}=e;const{user:r,loading:i,isAuthenticated:o}=l(),a=(0,n.zy)();if(i)return(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh",flexDirection:"column",gap:"1rem"},children:[(0,s.jsx)("div",{className:"spinner",style:{width:"40px",height:"40px",border:"4px solid #f3f3f3",borderTop:"4px solid #0077C0",borderRadius:"50%",animation:"spin 1s linear infinite"}}),(0,s.jsx)("p",{children:"Loading..."}),(0,s.jsx)("style",{children:"\n          @keyframes spin {\n            0% { transform: rotate(0deg); }\n            100% { transform: rotate(360deg); }\n          }\n        "})]});const c=["/about","/contact","/privacy-policy","/terms-conditions"].some(e=>a.pathname===e||a.pathname.toLowerCase()===e);if(o&&r&&!c){switch(r.user_type||r.role){case"buyer":return(0,s.jsx)(n.C5,{to:"/buyer-dashboard",replace:!0});case"seller":return(0,s.jsx)(n.C5,{to:"/seller-dashboard",replace:!0});case"agent":return(0,s.jsx)(n.C5,{to:"/agent-dashboard",replace:!0});default:return(0,s.jsx)(n.C5,{to:"/dashboard",replace:!0})}}return t},ir=(0,e.createContext)(),sr=e=>{var t,r,n;return{id:e.id,title:e.title,location:e.location,price:e.price.toString(),bedrooms:e.bedrooms,bathrooms:e.bathrooms,area:e.area.toString(),status:e.status,propertyType:e.property_type,projectType:e.project_type||null,upcomingProjectData:e.upcoming_project_data||null,furnishing:e.furnishing||"",facing:e.facing||"",floor:e.floor||"",totalFloors:e.total_floors||"",age:e.age||"",amenities:Array.isArray(e.amenities)?e.amenities:e.amenities?e.amenities.split(","):[],description:e.description||"",images:Array.isArray(e.images)&&e.images.length>0?e.images:e.cover_image?[e.cover_image]:[],createdAt:e.created_at,views:e.views_count||0,inquiries:e.inquiry_count||0,featured:!1,latitude:e.latitude,longitude:e.longitude,state:e.state||null,additionalAddress:e.additional_address||null,carpetArea:(null===(t=e.carpet_area)||void 0===t?void 0:t.toString())||"",balconies:e.balconies||"",priceNegotiable:e.price_negotiable||!1,maintenanceCharges:(null===(r=e.maintenance_charges)||void 0===r?void 0:r.toString())||"",depositAmount:(null===(n=e.deposit_amount)||void 0===n?void 0:n.toString())||"",videoUrl:e.video_url,brochureUrl:e.brochure_url}},or=e=>{if(!e||!e.id)return console.warn("Invalid inquiry object:",e),null;try{var t,r,n,i,s;const o=(null===(t=e.buyer)||void 0===t?void 0:t.name)||e.name||"Unknown";return{id:e.id,propertyId:e.property_id,buyerId:e.buyer_id||(null===(r=e.buyer)||void 0===r?void 0:r.id)||null,propertyTitle:(null===(n=e.property)||void 0===n?void 0:n.title)||e.property_title||"Unknown Property",buyerName:o,buyerEmail:(null===(i=e.buyer)||void 0===i?void 0:i.email)||e.email||"",buyerPhone:(null===(s=e.buyer)||void 0===s?void 0:s.phone)||e.mobile||"",message:e.message||"",status:e.status||"new",createdAt:e.created_at||(new Date).toISOString(),avatar:o[0].toUpperCase()}}catch(o){return console.error("Error transforming inquiry:",o,e),null}},ar=t=>{let{children:r}=t;const[n,o]=(0,e.useState)([]),[a,l]=(0,e.useState)(!0),[c,u]=(0,e.useState)([]),[d,h]=(0,e.useState)(!1),[m,f]=(0,e.useState)(null),[g,y]=(0,e.useState)(null),_=(0,e.useRef)(null),v=(0,e.useRef)(!1),x=(0,e.useRef)(!1),b=(0,e.useCallback)(async function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];if(!v.current)try{v.current=!0,e&&l(!0),f(null);const t=await i.NY.list();if(t.success&&t.data&&t.data.properties){const e=t.data.properties.map(sr);o(e),console.log("\u2705 Agent: Loaded",e.length,"properties from backend")}else o([]),t.message&&f(t.message)}catch(m){console.error("Error fetching properties:",m),o([]),f(m.message||"Failed to fetch properties. Please check your connection.")}finally{l(!1),v.current=!1}},[]),w=(0,e.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];if(!x.current)try{x.current=!0,e&&h(!0),y(null);const t=await i.r7.list();if(t.success&&t.data&&t.data.inquiries){const e=t.data.inquiries.map(or).filter(e=>null!==e);u(e),console.log("\u2705 Agent: Loaded",e.length,"inquiries from backend")}else u([]),t.message&&y(t.message)}catch(m){var t;console.error("Error fetching inquiries:",m),u([]);const r=(null===m||void 0===m?void 0:m.message)||(null===m||void 0===m||null===(t=m.data)||void 0===t?void 0:t.message)||"Failed to fetch inquiries. Please check your connection.";y("string"===typeof r?r:"Failed to fetch inquiries. Please check your connection.")}finally{h(!1),x.current=!1}},[]);(0,e.useEffect)(()=>{b(!0),w(!1)},[b,w]),(0,e.useEffect)(()=>{const e=()=>{_.current&&clearInterval(_.current),_.current=setInterval(()=>{document.hidden||(b(!1),w(!1))},3e4)},t=()=>{document.hidden?_.current&&(clearInterval(_.current),_.current=null):(b(!1),w(!1),e())};return e(),document.addEventListener("visibilitychange",t),()=>{_.current&&(clearInterval(_.current),_.current=null),document.removeEventListener("visibilitychange",t)}},[b,w]);const j=(0,e.useCallback)(async()=>{await Promise.all([b(!0),w(!0)])},[b,w]);return(0,s.jsx)(ir.Provider,{value:{properties:n,setProperties:o,inquiries:c,setInquiries:u,addProperty:async e=>{try{const n={title:e.title,status:e.status,property_type:e.property_type||e.propertyType,location:e.location,latitude:e.latitude||null,longitude:e.longitude||null,state:e.state||null,additional_address:e.additional_address||e.additionalAddress||null,bedrooms:e.bedrooms||0,bathrooms:e.bathrooms||0,balconies:e.balconies||"",area:parseFloat(e.area)||0,carpet_area:e.carpetArea?parseFloat(e.carpetArea):null,floor:e.floor||"",total_floors:e.totalFloors?parseInt(e.totalFloors):null,facing:e.facing||"",age:e.age||"",furnishing:e.furnishing||"",description:e.description,price:parseFloat(e.price)||0,price_negotiable:e.priceNegotiable||!1,maintenance_charges:e.maintenanceCharges?parseFloat(e.maintenanceCharges):null,deposit_amount:e.depositAmount?parseFloat(e.depositAmount):null,images:e.images||[],video_url:e.videoUrl||e.video_url||null,brochure_url:e.brochureUrl||e.brochure_url||null,amenities:e.amenities||[],project_type:e.project_type||null,upcoming_project_data:e.upcoming_project_data||null,available_for_bachelors:e.availableForBachelors||!1};console.log("PropertyContext: Sending property data:",n);const s=await i.NY.add(n);var t;if(console.log("PropertyContext: API response:",s),console.log("PropertyContext: Response success:",s.success),console.log("PropertyContext: Response data:",s.data),!0===s.success||s.data&&s.data.property)return await b(!1),(null===(t=s.data)||void 0===t?void 0:t.property)||s.property||null;{var r;let e=s.message||"Failed to add property";if(null!==(r=s.data)&&void 0!==r&&r.errors){const t=s.data.errors,r=Object.values(t).join(", ");e="Validation failed: ".concat(r)}throw console.error("PropertyContext: API returned error:",s),new Error(e)}}catch(m){var n,s;console.error("PropertyContext: Error adding property - Full error:",m),console.error("PropertyContext: Error details:",{message:m.message,status:m.status,errors:m.errors,data:m.data,response:m.response});let t="Failed to save property to database. Please check your connection and try again.";if(m.message)t=m.message;else if(m.errors&&"object"===typeof m.errors){const r=Object.values(m.errors).join(", ");t="Validation failed: ".concat(r)}else if(null!==(n=m.data)&&void 0!==n&&n.errors&&"object"===typeof m.data.errors){const r=Object.values(m.data.errors).join(", ");t="Validation failed: ".concat(r)}else null!==(s=m.data)&&void 0!==s&&s.message&&(t=m.data.message);throw console.error("PropertyContext: Final error message:",t),f(t),new Error(t)}},updateProperty:async(e,t)=>{try{const r={title:t.title,status:t.status,property_type:t.propertyType,location:t.location,latitude:t.latitude||null,longitude:t.longitude||null,state:t.state||null,additional_address:t.additionalAddress||null,bedrooms:t.bedrooms,bathrooms:t.bathrooms,balconies:t.balconies||"",area:t.area?parseFloat(t.area):null,carpet_area:t.carpetArea?parseFloat(t.carpetArea):null,floor:t.floor||"",total_floors:t.totalFloors?parseInt(t.totalFloors):null,facing:t.facing||"",age:t.age||"",furnishing:t.furnishing||"",description:t.description,price:t.price?parseFloat(t.price):null,price_negotiable:t.priceNegotiable,maintenance_charges:t.maintenanceCharges?parseFloat(t.maintenanceCharges):null,deposit_amount:t.depositAmount?parseFloat(t.depositAmount):null,images:t.images||[],video_url:t.videoUrl||null,brochure_url:t.brochureUrl||null,amenities:t.amenities||[],project_type:t.project_type||null,upcoming_project_data:t.upcoming_project_data||null,available_for_bachelors:t.availableForBachelors||!1},n=await i.NY.update(e,r);if(!n.success)throw new Error(n.message||"Failed to update property");await b(!1)}catch(m){throw console.error("Error updating property:",m),f(m.message||"Failed to update property. Please try again."),m}},deleteProperty:async e=>{try{const t=await i.NY.delete(e);if(!t.success)throw new Error(t.message||"Failed to delete property");await b(!1),await w(!1)}catch(m){throw console.error("Error deleting property:",m),f(m.message||"Failed to delete property. Please try again."),m}},updateInquiryStatus:async(e,t)=>{try{const r=await i.r7.updateStatus(e,t);if(!r.success)throw new Error(r.message||"Failed to update inquiry status");u(r=>r.map(r=>r.id===e?(0,p.A)((0,p.A)({},r),{},{status:t}):r))}catch(m){throw console.error("Error updating inquiry status:",m),y(m.message||"Failed to update inquiry status. Please try again."),await w(!1),m}},deleteInquiry:e=>{u(t=>t.filter(t=>t.id!==e))},getStats:()=>({totalProperties:n.length,forSale:n.filter(e=>"sale"===e.status).length,forRent:n.filter(e=>"rent"===e.status).length,totalViews:n.reduce((e,t)=>e+(t.views||0),0),totalInquiries:c.length,newInquiries:c.filter(e=>"new"===e.status).length}),loading:a,inquiriesLoading:d,error:m,inquiriesError:g,refreshData:j,fetchProperties:b,fetchInquiries:w},children:r})},lr=()=>{const t=(0,e.useContext)(ir);if(!t)throw new Error("useProperty must be used within a PropertyProvider");return t},cr=[{id:1,title:"Basic Info",icon:"\ud83d\udcdd"},{id:2,title:"Property Details",icon:"\ud83c\udfe0"},{id:3,title:"Amenities",icon:"\u2728"},{id:4,title:"Photos",icon:"\ud83d\udcf7"},{id:5,title:"Pricing",icon:"\ud83d\udcb0"}],ur=[{value:"Apartment",icon:"\ud83c\udfe2",category:"residential",subCategory:"standard"},{value:"Flat",icon:"\ud83c\udfe0",category:"residential",subCategory:"standard"},{value:"Villa",icon:"\ud83c\udfe1",category:"residential",subCategory:"independent"},{value:"Independent House",icon:"\ud83c\udfd8\ufe0f",category:"residential",subCategory:"independent"},{value:"Row House",icon:"\ud83c\udfd8\ufe0f",category:"residential",subCategory:"standard"},{value:"Penthouse",icon:"\ud83c\udf06",category:"residential",subCategory:"luxury"},{value:"Studio Apartment",icon:"\ud83d\udecf\ufe0f",category:"residential",subCategory:"studio"},{value:"Farm House",icon:"\ud83c\udf33",category:"residential",subCategory:"independent"},{value:"Plot / Land",icon:"\ud83d\udcd0",category:"land",subCategory:"plot"},{value:"Commercial Office",icon:"\ud83c\udfe2",category:"commercial",subCategory:"office"},{value:"Commercial Shop",icon:"\ud83c\udfea",category:"commercial",subCategory:"shop"},{value:"PG / Hostel",icon:"\ud83d\udecf\ufe0f",category:"pg",subCategory:"accommodation"}],dr={residential_standard:{showBedrooms:!0,showBathrooms:!0,showBalconies:!0,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0},residential_independent:{showBedrooms:!0,showBathrooms:!0,showBalconies:!0,showFloor:!1,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0},residential_studio:{showBedrooms:!1,showBathrooms:!0,showBalconies:!0,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!1,bathroomsRequired:!0},residential_farmhouse:{showBedrooms:!0,showBathrooms:!0,showBalconies:!1,showFloor:!1,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0},commercial_office:{showBedrooms:!1,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!1,bathroomsRequired:!1},commercial_shop:{showBedrooms:!1,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!1,showAge:!0,showCarpetArea:!0,bedroomsRequired:!1,bathroomsRequired:!1},land_plot:{showBedrooms:!1,showBathrooms:!1,showBalconies:!1,showFloor:!1,showTotalFloors:!1,showFacing:!0,showFurnishing:!1,showAge:!1,showCarpetArea:!1,bedroomsRequired:!1,bathroomsRequired:!1},pg_accommodation:{showBedrooms:!0,showBathrooms:!0,showBalconies:!1,showFloor:!0,showTotalFloors:!0,showFacing:!0,showFurnishing:!0,showAge:!0,showCarpetArea:!0,bedroomsRequired:!0,bathroomsRequired:!0}},hr=[{id:"parking",label:"Parking",icon:"\ud83d\ude97"},{id:"lift",label:"Lift",icon:"\ud83d\uded7"},{id:"security",label:"24x7 Security",icon:"\ud83d\udc6e"},{id:"power_backup",label:"Power Backup",icon:"\u26a1"},{id:"gym",label:"Gym",icon:"\ud83c\udfcb\ufe0f"},{id:"swimming_pool",label:"Swimming Pool",icon:"\ud83c\udfca"},{id:"garden",label:"Garden",icon:"\ud83c\udf33"},{id:"clubhouse",label:"Club House",icon:"\ud83c\udfdb\ufe0f"},{id:"playground",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"cctv",label:"CCTV",icon:"\ud83d\udcf9"},{id:"intercom",label:"Intercom",icon:"\ud83d\udcde"},{id:"fire_safety",label:"Fire Safety",icon:"\ud83d\udd25"},{id:"water_supply",label:"24x7 Water",icon:"\ud83d\udca7"},{id:"gas_pipeline",label:"Gas Pipeline",icon:"\ud83d\udd25"},{id:"wifi",label:"WiFi",icon:"\ud83d\udcf6"},{id:"ac",label:"Air Conditioning",icon:"\u2744\ufe0f"}],pr={residential:["parking","lift","security","power_backup","gym","swimming_pool","garden","clubhouse","playground","cctv","intercom","fire_safety","water_supply","gas_pipeline","wifi","ac"],residential_farmhouse:["parking","security","power_backup","gym","swimming_pool","garden","clubhouse","playground","cctv","fire_safety","water_supply","gas_pipeline","wifi","ac"],commercial_office:["parking","lift","security","power_backup","cctv","fire_safety","water_supply","wifi","ac","intercom"],commercial_shop:["parking","security","power_backup","cctv","fire_safety","water_supply","wifi","ac"],land_plot:["security","water_supply","cctv"],pg_accommodation:["parking","security","power_backup","cctv","fire_safety","water_supply","wifi","ac","intercom"]},mr=["Unfurnished","Semi-Furnished","Fully-Furnished"],fr=["North","South","East","West","North-East","North-West","South-East","South-West"],gr=["New Construction","Less than 1 Year","1-5 Years","5-10 Years","10+ Years"];function yr(t){let{onClose:r,editIndex:n=null,initialData:o=null}=t;const{addProperty:a,updateProperty:l,properties:c}=lr(),[u,d]=(0,e.useState)(1),[h,m]=(0,e.useState)(!1),[f,g]=(0,e.useState)(!1),[y,v]=(0,e.useState)(!1),[x,b]=(0,e.useState)(!1),[w,j]=(0,e.useState)(!1),[S,T]=(0,e.useState)(!1),[k,A]=(0,e.useState)({}),[C,E]=(0,e.useState)(null),[N,I]=(0,e.useState)(!1),[P,M]=(0,e.useState)([]),[L,R]=(0,e.useState)([]),[D,F]=(0,e.useState)(!1),[O,z]=(0,e.useState)(!1),[B,U]=(0,e.useState)(!1),[V,W]=(0,e.useState)(!1),[H,G]=(0,e.useState)(null),[Z,K]=(0,e.useState)("environment"),Y=(0,e.useRef)(),X=(0,e.useRef)(),J=(0,e.useRef)(),Q=(0,e.useRef)(null),$=(0,e.useRef)(null),ee=(0,e.useRef)(null),te=(0,e.useRef)(null),re=(()=>{if(null===n||null===o||void 0===o||!o.createdAt)return!1;const e=new Date(o.createdAt);return((new Date).getTime()-e.getTime())/36e5>=24})(),[ne,ie]=(0,e.useState)(o||{title:"",status:"sale",propertyType:"",location:"",latitude:"",longitude:"",state:"",additionalAddress:"",bedrooms:"",bathrooms:"",balconies:"",area:"",carpetArea:"",floor:"",totalFloors:"",facing:"",age:"",furnishing:"",amenities:[],description:"",images:[],video:null,brochure:null,price:"",priceNegotiable:!1,maintenanceCharges:"",depositAmount:"",availableForBachelors:!1}),se=(0,e.useCallback)(()=>{ie(o||{title:"",status:"sale",propertyType:"",location:"",latitude:"",longitude:"",state:"",additionalAddress:"",bedrooms:"",bathrooms:"",balconies:"",area:"",carpetArea:"",floor:"",totalFloors:"",facing:"",age:"",furnishing:"",amenities:[],description:"",images:[],video:null,brochure:null,price:"",priceNegotiable:!1,maintenanceCharges:"",depositAmount:"",availableForBachelors:!1}),d(1),A({}),E(null),M([]),R([]),F(!1),z(!1),m(!1),g(!1),b(!1)},[o]),oe=((0,e.useCallback)(()=>{T(!0),se(),j(!1),r()},[se,r]),(0,e.useCallback)(()=>{u===cr.length&&!x?j(!0):r()},[u,x,r]));(0,e.useEffect)(()=>{if(y||w)return;const e=e=>{"Escape"===e.key&&oe()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[oe,y,w]),(0,e.useEffect)(()=>{const e=te.current;if(!e)return;const t=t=>{"number"===t.target.type&&e.contains(t.target)&&document.activeElement===t.target&&t.preventDefault()},r=t=>{"ArrowUp"!==t.key&&"ArrowDown"!==t.key||"number"!==t.target.type||!e.contains(t.target)||t.preventDefault()};return e.addEventListener("wheel",t,{passive:!1}),e.addEventListener("keydown",r),()=>{e.removeEventListener("wheel",t),e.removeEventListener("keydown",r)}},[]),(0,e.useEffect)(()=>()=>{ne.images&&ne.images.forEach(e=>{"string"===typeof e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)})},[]);const ae=(e,t)=>{ie(r=>{const n=(0,p.A)((0,p.A)({},r),{},{[e]:t});if("propertyType"===e&&"Studio Apartment"===t&&(n.bedrooms="0"),"propertyType"===e&&"Studio Apartment"!==t&&"0"===r.bedrooms&&(n.bedrooms=""),"propertyType"===e){const e=ur.find(e=>e.value===t);let i=[];if(e)if("Farm House"===t)i=pr.residential_farmhouse;else if("Plot / Land"===t)i=pr.land_plot;else if("residential"===e.category)i=pr.residential;else if("commercial"===e.category){const t="".concat(e.category,"_").concat(e.subCategory);i=pr[t]||pr.commercial_office}else"pg"===e.category?i=pr.pg_accommodation:"land"===e.category&&(i=pr.land_plot);i.length>0&&r.amenities&&(n.amenities=r.amenities.filter(e=>i.includes(e)))}return n}),k[e]&&A(t=>(0,p.A)((0,p.A)({},t),{},{[e]:null})),C&&E(null)},le=()=>{if(!ne.propertyType)return dr.residential_standard;const e=ur.find(e=>e.value===ne.propertyType);if(!e)return dr.residential_standard;if("Farm House"===ne.propertyType)return dr.residential_farmhouse;const t="".concat(e.category,"_").concat(e.subCategory);return dr[t]||dr.residential_standard},ce=(0,e.useCallback)((e,t)=>{const r="string"===typeof t?t.trim():t,n=le();switch(e){case"title":case"location":return r&&r.length>=3;case"status":return"sale"===t||"rent"===t||"pg-hostel"===t;case"propertyType":return!!t&&ur.some(e=>e.value===t);case"state":return r&&r.length>=2;case"area":if(!t)return!1;const e="Plot / Land"===ne.propertyType;return bt(t,100,e?xt:void 0).valid;case"carpetArea":if(!t)return!0;if(!ne.area)return!0;return kt(t,ne.area).valid;case"bedrooms":return!n.showBedrooms||!n.bedroomsRequired||!!t;case"bathrooms":return!n.showBathrooms||!n.bathroomsRequired||!!t;case"floor":if(!t||!ne.totalFloors)return!0;return At(t,ne.totalFloors).valid;case"facing":return!n.showFacing||r&&r.length>=2;case"furnishing":return!n.showFurnishing||r&&r.length>=2;case"description":return!!r&&(r.length>=100&&r.length<=1e3);case"price":if(!t)return!1;return wt(t,ne.status).valid;case"depositAmount":if(!t||"rent"!==ne.status)return!0;if(!ne.price)return!0;return Tt(t,ne.price).valid;default:return!1}},[ne.area,ne.totalFloors,ne.status,ne.price]),ue=(0,e.useCallback)(e=>{const t=le();switch(e){case 1:return["title","status","propertyType"];case 2:const e=["location","state"];return t.showBedrooms&&t.bedroomsRequired&&e.push("bedrooms"),t.showBathrooms&&t.bathroomsRequired&&e.push("bathrooms"),e.push("area"),t.showCarpetArea&&e.push("carpetArea"),t.showFloor&&e.push("floor","totalFloors"),t.showFacing&&e.push("facing"),t.showFurnishing&&e.push("furnishing"),e;case 3:return["description"];case 4:default:return[];case 5:const r=["price"];return"rent"===ne.status&&r.push("depositAmount"),r}},[ne.propertyType,ne.status])(u);Lt({formData:ne,errors:k,validateField:ce,fieldOrder:ue,formRef:ee,enabled:u<=3,scrollOffset:50,scrollDelay:400});const de=async e=>{var t;U(!1);const r=Array.from(e.target.files||[]),n=(null===(t=ne.images)||void 0===t?void 0:t.length)||0;if(n+r.length>10)return void A(e=>(0,p.A)((0,p.A)({},e),{},{images:"Maximum 10 photos allowed. You have ".concat(n," and trying to add ").concat(r.length)}));const i=[];for(const c of r){const e=St(c);e.valid?i.push(c):A(t=>(0,p.A)((0,p.A)({},t),{},{images:e.message}))}if(0===i.length)return;const s=i.map(e=>({file:e,preview:URL.createObjectURL(e),status:"pending",errorMessage:"",imageId:null,imageUrl:null}));M(e=>[...e,...i].slice(0,10)),R(e=>[...e,...s].slice(0,10));const o=i.map(e=>URL.createObjectURL(e));ie(e=>(0,p.A)((0,p.A)({},e),{},{images:[...e.images||[],...o].slice(0,10)})),k.images&&A(e=>(0,p.A)((0,p.A)({},e),{},{images:null})),F(!0);const a=L.length,l=s.map((e,t)=>he(e,a+t));await Promise.all(l),F(!1)},he=async(e,t)=>{R(e=>{const r=[...e];return r[t]&&(r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"checking"})),r});try{var r,i;const o=null!==n?null===(r=c[n])||void 0===r?void 0:r.id:0,a=o<=0,l=new FormData;l.append("image",e.file),l.append("property_id",o),a&&l.append("validate_only","true");const u=localStorage.getItem("authToken");console.log("[Image ".concat(t+1,"] Starting validation..."));const d=await fetch("".concat(q.JR).concat(q.Sn.MODERATE_AND_UPLOAD),{method:"POST",headers:{Authorization:"Bearer ".concat(u)},body:l});if(console.log("[Image ".concat(t+1,"] Response status:"),d.status),!d.ok){const e=await d.text();let r;console.error("[Image ".concat(t+1,"] HTTP Error ").concat(d.status,":"),e);try{r=JSON.parse(e)}catch(s){r={message:e||"HTTP ".concat(d.status," Error")}}return void R(e=>{const n=[...e];return n[t]&&(n[t]=(0,p.A)((0,p.A)({},n[t]),{},{status:"rejected",errorMessage:r.message||"Validation failed",fullErrorMessage:r.message||"HTTP ".concat(d.status," Error")})),n})}const h=await d.json();console.log("[Image ".concat(t+1,"] API Response:"),h);const m=null===(i=h.data)||void 0===i?void 0:i.moderation_status;R(e=>{const r=[...e];var n,i,s;if(r[t])if("success"===h.status&&null!==(n=h.data)&&void 0!==n&&n.image_url)console.log("[Image ".concat(t+1,"] \u2705 Auto-approved for Agent (moderation_status: ").concat(m||"N/A",")")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(i=h.data)||void 0===i?void 0:i.image_id,imageUrl:null===(s=h.data)||void 0===s?void 0:s.image_url,moderationStatus:m||"SAFE"});else if("SAFE"===m){var o,a;console.log("[Image ".concat(t+1,"] \u2705 Approved (SAFE)")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(o=h.data)||void 0===o?void 0:o.image_id,imageUrl:null===(a=h.data)||void 0===a?void 0:a.image_url,moderationStatus:"SAFE"})}else if("error"===h.status||"REJECTED"===m||"UNSAFE"===m){let e=h.message||"Image was rejected";if(console.log("[Image ".concat(t+1,"] \u274c Rejected:"),e),e.includes("animal appearance")){const t=e.match(/\(([^)]+)\)/);e=t?"".concat(t[1]," detected"):"Animal detected"}else e.includes("human appearance")?e="Human detected":e.includes("blurry")?e="Image is too blurry":e.includes("low quality")&&(e="Image quality too low");r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"rejected",errorMessage:e,fullErrorMessage:h.message||"Image was rejected"})}else if("success"===h.status){var l;console.log("[Image ".concat(t+1,"] \u2705 Auto-approved (response missing moderation_status)")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",moderationStatus:"SAFE",imageUrl:(null===(l=h.data)||void 0===l?void 0:l.image_url)||null})}return r}),setTimeout(()=>{pe()},500)}catch(o){console.error("[Image ".concat(t+1,"] \u274c Validation error:"),o),console.error("[Image ".concat(t+1,"] Error details:"),{name:o.name,message:o.message,stack:o.stack}),R(e=>{const r=[...e];return r[t]&&(r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"rejected",errorMessage:o.message||"Validation failed. Please check console for details.",fullErrorMessage:o.message||"Failed to validate image. Please try again."})),r})}},pe=()=>{if(4===u&&L.length>0){const e=L.every(e=>"approved"===e.status),t=!L.some(e=>"checking"===e.status),r=!L.some(e=>"rejected"===e.status);e&&t&&r&&L.length>0&&setTimeout(()=>{Se()},1e3)}},me=()=>{U(!0)},fe=e=>{var t;(U(!1),"gallery"===e)?null===(t=Y.current)||void 0===t||t.click():"camera"===e&&ge()},ge=async()=>{try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void alert("Camera is not supported on this device. Please use gallery upload instead.");const e={video:{facingMode:Z,width:{ideal:1920},height:{ideal:1080}}},t=await navigator.mediaDevices.getUserMedia(e);G(t),W(!0),Q.current&&(Q.current.srcObject=t,Q.current.play())}catch(e){console.error("Error accessing camera:",e),"NotAllowedError"===e.name||"PermissionDeniedError"===e.name?alert("Camera permission denied. Please allow camera access and try again."):"NotFoundError"===e.name||"DevicesNotFoundError"===e.name?alert("No camera found on this device. Please use gallery upload instead."):alert("Failed to access camera. Please try again or use gallery upload.")}},ye=()=>{H&&(H.getTracks().forEach(e=>e.stop()),G(null)),Q.current&&(Q.current.srcObject=null),W(!1)};(0,e.useEffect)(()=>()=>{H&&H.getTracks().forEach(e=>e.stop())},[H]);const _e=e=>{var t;ne.images&&ne.images[e]&&ne.images[e].startsWith("blob:")&&URL.revokeObjectURL(ne.images[e]),null!==(t=L[e])&&void 0!==t&&t.preview&&L[e].preview.startsWith("blob:")&&URL.revokeObjectURL(L[e].preview),ie(t=>(0,p.A)((0,p.A)({},t),{},{images:t.images.filter((t,r)=>r!==e)})),M(t=>t.filter((t,r)=>r!==e)),R(t=>t.filter((t,r)=>r!==e))},ve=e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if(!["video/mp4","video/webm","video/quicktime","video/x-m4v","video/ogg"].includes(r.type))return void A(e=>(0,p.A)((0,p.A)({},e),{},{video:"Unsupported video format"}));if(r.size>52428800)return void A(e=>(0,p.A)((0,p.A)({},e),{},{video:"Video must be <= 50MB"}));const n=URL.createObjectURL(r);ie(e=>(0,p.A)((0,p.A)({},e),{},{video:{file:r,url:n,name:r.name,size:r.size}})),A(e=>(0,p.A)((0,p.A)({},e),{},{video:null}))},xe=()=>{var e;null!==(e=ne.video)&&void 0!==e&&e.url&&URL.revokeObjectURL(ne.video.url),ie(e=>(0,p.A)((0,p.A)({},e),{},{video:null}))},be=e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(!r)return;if("application/pdf"!==r.type)return void A(e=>(0,p.A)((0,p.A)({},e),{},{brochure:"Only PDF files are allowed"}));if(r.size>10485760)return void A(e=>(0,p.A)((0,p.A)({},e),{},{brochure:"PDF must be <= 10MB"}));const n=URL.createObjectURL(r);ie(e=>(0,p.A)((0,p.A)({},e),{},{brochure:{file:r,url:n,name:r.name,size:r.size}})),A(e=>(0,p.A)((0,p.A)({},e),{},{brochure:null}))},we=()=>{var e;null!==(e=ne.brochure)&&void 0!==e&&e.url&&URL.revokeObjectURL(ne.brochure.url),ie(e=>(0,p.A)((0,p.A)({},e),{},{brochure:null}))},je=e=>{var t,r,n,i,s,o,a;const l={};let c=null;switch(e){case 1:null!==(t=ne.title)&&void 0!==t&&t.trim()||(l.title="Property name is required"),ne.status||(l.status="Sell / Rent / PG-Hostel not selected"),ne.propertyType||(l.propertyType="Property type not selected"),Object.keys(l).length>0&&(c="Please complete all required fields before proceeding");break;case 2:if(null!==(r=ne.location)&&void 0!==r&&r.trim()||(l.location="Location is required"),ne.area){const e="Plot / Land"===ne.propertyType?xt:void 0,t=bt(ne.area,100,e);t.valid||(l.area=t.message)}else l.area="Area / Carpet area missing";if(ne.carpetArea&&ne.area){const e=kt(ne.carpetArea,ne.area);e.valid||(l.carpetArea=e.message)}if(ne.floor&&ne.totalFloors){const e=At(ne.floor,ne.totalFloors);e.valid||(l.floor=e.message)}const e=le();if(e.bedroomsRequired&&!ne.bedrooms&&(l.bedrooms="Bedroom / Bathroom not selected"),e.bathroomsRequired&&!ne.bathrooms)l.bathrooms="Bedroom / Bathroom not selected";else if(ne.bathrooms&&"4+"!==ne.bathrooms){const t=parseInt(ne.bathrooms,10),r=e.bathroomsRequired?1:0;(isNaN(t)||t<r||t>10)&&(l.bathrooms="Invalid bathroom count")}e.showBalconies&&!ne.balconies&&(l.balconies="Balconies is required"),e.showFloor&&!ne.floor&&(l.floor="Floor number is required"),e.showTotalFloors&&!ne.totalFloors&&(l.totalFloors="Total floors is required"),null!==(n=ne.state)&&void 0!==n&&n.trim()||(l.state="State is required"),!e.showFacing||null!==(i=ne.facing)&&void 0!==i&&i.trim()||(l.facing="Facing is required"),!e.showAge||null!==(s=ne.age)&&void 0!==s&&s.trim()||(l.age="Property age is required"),!e.showFurnishing||null!==(o=ne.furnishing)&&void 0!==o&&o.trim()||(l.furnishing="Furnishing status missing"),Object.keys(l).length>0&&(c=l.floor?l.floor:l.carpetArea?l.carpetArea:l.area?l.area:"Please complete all required fields before proceeding");break;case 3:if(ne.description&&ne.description.trim()){const e=ne.description.trim().length;e<100&&(l.description="Description must contain at least 100 characters. Currently: ".concat(e," characters."));/(\+91[\s-]?)?[6-9]\d{9}/g.test(ne.description)&&(l.description="Description cannot contain mobile numbers. Please remove any phone numbers.");/[a-zA-Z0-9._%+-]+@[a-zA-Z0-9.-]+\.[a-zA-Z]{2,}/g.test(ne.description)&&(l.description="Description cannot contain email addresses. Please remove any email addresses."),ne.description.length>1e3&&(l.description="Description cannot exceed 1000 characters.")}else l.description="Description is required";(!ne.amenities||ne.amenities.length<2)&&(l.amenities="Select at least 2 amenities"),Object.keys(l).length>0&&(c=l.amenities?l.amenities:"Please complete the description with valid content before proceeding");break;case 4:const u=Math.max(L.length,(null===(a=ne.images)||void 0===a?void 0:a.length)||0);if(0===u)l.images="Upload at least 3 property images",c="Upload at least 3 property images";else if(u<3)l.images="Upload at least 3 property images (".concat(u,"/3 uploaded)"),c="Upload at least 3 property images (".concat(u,"/3 uploaded)");else{D&&(l.images="Please wait for all images to be validated",c="Please wait for all images to be validated before proceeding");const e=L.filter(e=>"rejected"===e.status).length;e>0&&(l.images="Please remove ".concat(e," rejected image(s) before proceeding"),c="Please remove ".concat(e," rejected image(s) before proceeding"));const t=L.filter(e=>"approved"===e.status).length;t<3&&L.length>0&&!D&&(l.images="At least 3 images must be approved (".concat(t,"/").concat(u," approved)"),c="At least 3 images must be approved (".concat(t,"/").concat(u," approved)"))}break;case 5:if(ne.price){const e=wt(ne.price,ne.status);e.valid||(l.price=e.message,c=e.message)}else l.price="Price / Rent / Budget missing",c="Price / Rent / Budget missing";if("rent"===ne.status&&ne.depositAmount&&ne.price){const e=Tt(ne.depositAmount,ne.price);e.valid||(l.depositAmount=e.message,c||(c=e.message))}}return A(l),E(c),0===Object.keys(l).length},Se=()=>{je(u)?(E(null),d(e=>Math.min(e+1,5))):setTimeout(()=>{if(ee.current){const e=ee.current.querySelector(".error, .error-text");e?e.scrollIntoView({behavior:"smooth",block:"center"}):ee.current.scrollTop=0}},100)};(0,e.useEffect)(()=>{ee.current&&(ee.current.scrollTop=0),E(null)},[u]);const Te=()=>(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("h3",{className:"step-heading",children:"Basic Information"}),(0,s.jsx)("p",{className:"step-subheading",children:"Let's start with the basic details of your property"}),C&&(0,s.jsx)("span",{className:"error-text agent-popup-step-error",children:C}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Property Title ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"text",name:"title",placeholder:"e.g., Spacious 3BHK Apartment with Sea View",value:ne.title,onChange:e=>ae("title",e.target.value),className:k.title?"error":""}),k.title&&(0,s.jsx)("span",{className:"error-text error-message",children:k.title})]}),(0,s.jsxs)("div",{className:"form-group","data-field":"status",children:[(0,s.jsx)("label",{children:"I want to"}),(0,s.jsxs)("div",{className:"toggle-buttons ".concat(k.status?"error":""),children:[(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat("sale"===ne.status?"active":""),onClick:()=>ae("status","sale"),children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\ud83c\udff7\ufe0f"}),"Sell"]}),(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat("rent"===ne.status?"active":""),onClick:()=>ae("status","rent"),children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\ud83d\udd11"}),"Rent / Lease"]})]}),k.status&&(0,s.jsx)("span",{className:"error-text error-message",children:k.status})]}),(0,s.jsxs)("div",{className:"form-group","data-field":"propertyType",children:[(0,s.jsxs)("label",{children:["Property Type ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"property-type-grid ".concat(k.propertyType?"error":""),children:ur.map(e=>(0,s.jsxs)("button",{type:"button",className:"property-type-btn ".concat(ne.propertyType===e.value?"active":""),onClick:()=>ae("propertyType",e.value),children:[(0,s.jsx)("span",{className:"type-icon",children:e.icon}),(0,s.jsx)("span",{className:"type-label",children:e.value})]},e.value))}),k.propertyType&&(0,s.jsx)("span",{className:"error-text error-message",children:k.propertyType})]}),"rent"===ne.status&&["Apartment","Flat","Independent House","Penthouse","Villa","Farm House","Studio Apartment"].includes(ne.propertyType)&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Available for Bachelors"}),(0,s.jsxs)("div",{className:"toggle-buttons",children:[(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat(ne.availableForBachelors?"active":""),onClick:()=>ae("availableForBachelors",!0),children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\u2713"}),"Yes"]}),(0,s.jsxs)("button",{type:"button",className:"toggle-btn ".concat(ne.availableForBachelors?"":"active"),onClick:()=>ae("availableForBachelors",!1),children:[(0,s.jsx)("span",{className:"toggle-icon",children:"\u2717"}),"No"]})]})]})]}),ke=()=>{const e=(()=>{if(!ne.propertyType)return hr;const e=ur.find(e=>e.value===ne.propertyType);if(!e)return hr;if("Farm House"===ne.propertyType){const e=pr.residential_farmhouse;return hr.filter(t=>e.includes(t.id))}if("Plot / Land"===ne.propertyType){const e=pr.land_plot;return hr.filter(t=>e.includes(t.id))}if("residential"===e.category){const e=pr.residential;return hr.filter(t=>e.includes(t.id))}if("commercial"===e.category){const t="".concat(e.category,"_").concat(e.subCategory),r=pr[t]||pr.commercial_office;return hr.filter(e=>r.includes(e.id))}if("pg"===e.category){const e=pr.pg_accommodation;return hr.filter(t=>e.includes(t.id))}if("land"===e.category){const e=pr.land_plot;return hr.filter(t=>e.includes(t.id))}return hr})();return(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("h3",{className:"step-heading",children:"Amenities & Description"}),(0,s.jsx)("p",{className:"step-subheading",children:"Select the amenities available and describe your property"}),C&&(0,s.jsx)("span",{className:"error-text agent-popup-step-error",children:C}),(0,s.jsxs)("div",{className:"form-group","data-field":"amenities",children:[(0,s.jsxs)("label",{children:["Select Amenities ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"amenities-grid ".concat(k.amenities?"error":""),children:e.map(e=>(0,s.jsxs)("button",{type:"button",className:"amenity-btn ".concat(ne.amenities.includes(e.id)?"active":""),onClick:()=>{return t=e.id,ie(e=>(0,p.A)((0,p.A)({},e),{},{amenities:e.amenities.includes(t)?e.amenities.filter(e=>e!==t):[...e.amenities,t]})),k.amenities&&A(e=>(0,p.A)((0,p.A)({},e),{},{amenities:null})),void(C&&E(null));var t},children:[(0,s.jsx)("span",{className:"amenity-icon",children:e.icon}),(0,s.jsx)("span",{className:"amenity-label",children:e.label}),ne.amenities.includes(e.id)&&(0,s.jsx)("span",{className:"check-icon",children:"\u2713"})]},e.id))}),k.amenities&&(0,s.jsx)("span",{className:"error-text error-message",children:k.amenities})]}),(0,s.jsxs)("div",{className:"form-group","data-field":"description",children:[(0,s.jsxs)("label",{children:["Property Description ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("textarea",{name:"description",placeholder:"Describe your property in detail (minimum 100 characters required). Mention unique features, nearby landmarks, connectivity, etc. Note: Mobile numbers and email addresses are not allowed.",value:ne.description,onChange:e=>ae("description",e.target.value),rows:5,className:k.description?"error":""}),(0,s.jsxs)("span",{className:"char-count",children:["Characters: ",(ne.description||"").length,"/1000 (min: 100)"]}),k.description&&(0,s.jsx)("span",{className:"error-text",children:k.description})]})]})},Ae=e=>{const t=parseFloat(e);return isNaN(t)?"":t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Crore"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lakh"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(2)," Thousand"):"\u20b9".concat(t)};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(Mt,{isOpen:y,redirectPath:"/agent-dashboard/properties",onClose:()=>{v(!1),r()}}),w&&(0,s.jsx)("div",{className:"popup-overlay",style:{zIndex:1e4},children:(0,s.jsxs)("div",{className:"popup-container",style:{maxWidth:"500px"},children:[(0,s.jsxs)("div",{className:"popup-header",children:[(0,s.jsx)("h2",{children:"Publishing Not Completed"}),(0,s.jsx)("button",{className:"close-btn",onClick:()=>j(!1),"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"popup-body",style:{padding:"2rem"},children:(0,s.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",style:{margin:"0 auto 1rem",color:"var(--warning-color, #f59e0b)"},children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsxs)("p",{style:{fontSize:"1rem",lineHeight:"1.6",color:"var(--text-color, #333)"},children:["You haven't published this property yet.",(0,s.jsx)("br",{}),"Please publish before closing, or your data will be lost."]})]})}),(0,s.jsx)("div",{className:"popup-footer",style:{justifyContent:"center",gap:"1rem"},children:(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>j(!1),children:"Continue Editing"})})]})}),!y&&!w&&(0,s.jsx)("div",{className:"popup-overlay",children:(0,s.jsxs)("div",{className:"popup-container",ref:te,role:"dialog","aria-modal":"true",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"popup-header",children:[(0,s.jsx)("h2",{children:null!==n?"Edit Property":"List Your Property"}),(0,s.jsx)("button",{className:"close-btn",onClick:oe,"aria-label":"Close",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"step-indicator",children:cr.map((e,t)=>{const r=(n=e.id,u>n);var n;const i=r||e.id===u;return(0,s.jsxs)("div",{className:"step-item ".concat(u===e.id?"active":""," ").concat(r?"completed":""," ").concat(i?"clickable":""),children:[(0,s.jsx)("div",{className:"step-circle",onClick:()=>i&&(e=>{e!==u&&e<u&&d(e)})(e.id),style:{cursor:i?"pointer":"default"},title:!i&&e.id>u?"Complete current step first":i&&r?"Click to go back to this step":"",children:r?(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,s.jsx)("span",{children:e.icon})}),(0,s.jsx)("span",{className:"step-title",children:e.title}),t<cr.length-1&&(0,s.jsx)("div",{className:"step-line"})]},e.id)})}),(0,s.jsx)("div",{className:"popup-body",ref:ee,children:(()=>{switch(u){case 1:default:return Te();case 2:return(()=>{const e=le();return(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("h3",{className:"step-heading",children:"Property Details"}),(0,s.jsx)("p",{className:"step-subheading",children:"Tell us more about your property specifications"}),C&&(0,s.jsx)("span",{className:"error-text agent-popup-step-error",children:C}),(0,s.jsxs)("div",{className:"seller-popup-form-group","data-field":"location",children:[(0,s.jsxs)("label",{children:["Location ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)(_,{placeholder:"Enter locality, area or landmark",value:ne.location,onChange:e=>{if(re)return;if(!e)return ie(e=>(0,p.A)((0,p.A)({},e),{},{location:"",latitude:"",longitude:""})),void z(!1);const t=e.state||"",r=!!t;ie(r=>{var n,i,s,o;return(0,p.A)((0,p.A)({},r),{},{location:e.fullAddress||e.placeName||"",latitude:null!==(n=null===(i=e.coordinates)||void 0===i?void 0:i.lat)&&void 0!==n?n:"",longitude:null!==(s=null===(o=e.coordinates)||void 0===o?void 0:o.lng)&&void 0!==s?s:"",state:t})}),z(r),(k.location||k.state)&&A(e=>(0,p.A)((0,p.A)({},e),{},{location:null,state:null})),C&&E(null)},className:k.location?"seller-location-error":"",error:k.location,disabled:re})]}),(0,s.jsxs)("div",{className:"seller-popup-form-group",children:[(0,s.jsx)("label",{children:"Property Location on Map (Optional)"}),ne.latitude&&ne.longitude?(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,s.jsx)("span",{className:"location-icon",style:{fontSize:"18px"},children:"\ud83d\udccd"}),(0,s.jsx)("div",{style:{flex:1},children:(0,s.jsx)("span",{style:{fontSize:"0.875rem",color:"#059669",fontWeight:"500"},children:"Location set on map"})})]}),(0,s.jsxs)("small",{className:"location-picker-coordinates",style:{marginLeft:"26px",fontSize:"0.75rem",color:"#059669",fontFamily:"monospace"},children:["Coordinates: ",parseFloat(ne.latitude).toFixed(6),", ",parseFloat(ne.longitude).toFixed(6)]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,s.jsx)("button",{type:"button",className:"location-picker-change-btn",onClick:()=>!re&&I(!0),disabled:re,title:re?"Location cannot be changed after 24 hours":"Change location",style:{padding:"6px 12px",fontSize:"0.875rem",backgroundColor:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"6px",cursor:re?"not-allowed":"pointer",color:re?"#9ca3af":"#374151",fontWeight:"500",opacity:re?.5:1},children:"Change Location"}),(0,s.jsx)("button",{type:"button",onClick:()=>{re||ie(e=>(0,p.A)((0,p.A)({},e),{},{latitude:"",longitude:""}))},disabled:re,title:re?"Location cannot be removed after 24 hours":"Remove location",style:{padding:"6px 12px",fontSize:"0.875rem",backgroundColor:"#fee2e2",border:"1px solid #fecaca",borderRadius:"6px",cursor:re?"not-allowed":"pointer",color:re?"#d1d5db":"#991b1b",fontWeight:"500",opacity:re?.5:1},children:"Remove"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{type:"button",className:"location-picker-btn",onClick:()=>!re&&I(!0),disabled:re,style:{opacity:re?.5:1,cursor:re?"not-allowed":"pointer"},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",style:{marginRight:"8px"},children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Add Location on Map"})]}),(0,s.jsx)("span",{className:"seller-popup-hint",children:"Select exact location on map for better visibility"})]})]}),(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"form-group","data-field":"state",children:[(0,s.jsxs)("label",{children:["State ",(0,s.jsx)("span",{className:"required",children:"*"}),O&&!re&&(0,s.jsx)("span",{style:{fontSize:"0.75rem",color:"#059669",marginLeft:"8px",fontWeight:"normal"},children:"(Auto-filled from map)"})]}),(0,s.jsxs)("div",{style:{position:"relative"},children:[(0,s.jsx)(Pt,{placeholder:"Enter state",value:ne.state||"",onChange:e=>{re||(ae("state",e),O&&e!==ne.state&&z(!1))},className:k.state?"seller-state-error":"",error:k.state,disabled:re,readOnly:O&&!re}),O&&!re&&(0,s.jsx)("button",{type:"button",onClick:()=>{z(!1)},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"#7c3aed",cursor:"pointer",fontSize:"0.75rem",fontWeight:"600",padding:"4px 8px",borderRadius:"4px",zIndex:10},title:"Edit state manually",children:"Edit"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Additional Address (Optional)"}),(0,s.jsx)("input",{type:"text",placeholder:"Enter additional address details",value:ne.additionalAddress||"",onChange:e=>!re&&ae("additionalAddress",e.target.value),disabled:re})]})]}),(e.showBedrooms||e.showBathrooms||e.showBalconies)&&(0,s.jsxs)("div",{className:"form-row three-cols",children:[e.showBedrooms&&(0,s.jsxs)("div",{className:"form-group","data-field":"bedrooms",children:[(0,s.jsxs)("label",{children:["Studio Apartment"===ne.propertyType?"Studio":"Bedrooms",e.bedroomsRequired&&(0,s.jsx)("span",{className:"required",children:"*"})]}),"Studio Apartment"===ne.propertyType?(0,s.jsx)("div",{className:"number-selector",children:(0,s.jsx)("button",{type:"button",className:"num-btn active",disabled:!0,style:{cursor:"not-allowed",opacity:.7},children:"Studio"})}):(0,s.jsx)("div",{className:"number-selector ".concat(k.bedrooms?"error":""),children:["1","2","3","4","5","5+"].map(e=>(0,s.jsx)("button",{type:"button",className:"num-btn ".concat(ne.bedrooms===e?"active":""),onClick:()=>ae("bedrooms",e),children:e},e))}),k.bedrooms&&(0,s.jsx)("span",{className:"error-text error-message",children:k.bedrooms})]}),e.showBathrooms&&(0,s.jsxs)("div",{className:"form-group","data-field":"bathrooms",children:[(0,s.jsxs)("label",{children:["Bathrooms ",e.bathroomsRequired&&(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"number-selector ".concat(k.bathrooms?"error":""),children:(e.bathroomsRequired?["1","2","3","4","4+"]:["0","1","2","3","4","4+"]).map(e=>(0,s.jsx)("button",{type:"button",className:"num-btn ".concat(ne.bathrooms===e?"active":""),onClick:()=>ae("bathrooms",e),children:e},e))}),k.bathrooms&&(0,s.jsx)("span",{className:"error-text error-message",children:k.bathrooms})]}),e.showBalconies&&(0,s.jsxs)("div",{className:"form-group","data-field":"balconies",children:[(0,s.jsxs)("label",{children:["Balconies ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"number-selector ".concat(k.balconies?"error":""),children:["0","1","2","3","3+"].map(e=>(0,s.jsx)("button",{type:"button",className:"num-btn ".concat(ne.balconies===e?"active":""),onClick:()=>ae("balconies",e),children:e},e))}),k.balconies&&(0,s.jsx)("span",{className:"error-text error-message",children:k.balconies})]})]}),(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"form-group","data-field":"area",children:[(0,s.jsxs)("label",{children:["Plot / Land"===ne.propertyType?"Plot Area":"Built-up Area",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("div",{className:"input-with-suffix",children:[(0,s.jsx)("input",{type:"number",name:"area",placeholder:"Plot / Land"===ne.propertyType?"Enter plot area":"Enter area",value:ne.area,onChange:e=>ae("area",e.target.value),className:k.area?"error":""}),(0,s.jsx)("span",{className:"suffix",children:"sq.ft"})]}),k.area&&(0,s.jsx)("span",{className:"error-text",children:k.area})]}),e.showCarpetArea&&(0,s.jsxs)("div",{className:"form-group","data-field":"carpetArea",children:[(0,s.jsx)("label",{children:"Carpet Area"}),(0,s.jsxs)("div",{className:"input-with-suffix",children:[(0,s.jsx)("input",{type:"number",name:"carpetArea",placeholder:"Enter area",value:ne.carpetArea,onChange:e=>ae("carpetArea",e.target.value),className:k.carpetArea?"error":""}),(0,s.jsx)("span",{className:"suffix",children:"sq.ft"})]}),k.carpetArea&&(0,s.jsx)("span",{className:"error-text",children:k.carpetArea})]})]}),(e.showFloor||e.showTotalFloors)&&(0,s.jsxs)("div",{className:"form-row two-cols",children:[e.showFloor&&(0,s.jsxs)("div",{className:"form-group","data-field":"floor",children:[(0,s.jsxs)("label",{children:["Floor Number ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"number",name:"floor",min:0,step:1,placeholder:"e.g., 5",value:ne.floor,onChange:e=>{const t=e.target.value;(""===t||/^\d+$/.test(t))&&ae("floor",t)},className:k.floor?"error":""}),k.floor&&(0,s.jsx)("span",{className:"error-text",children:k.floor})]}),e.showTotalFloors&&(0,s.jsxs)("div",{className:"form-group","data-field":"totalFloors",children:[(0,s.jsxs)("label",{children:["Total Floors ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"number",placeholder:"Total floors in building",value:ne.totalFloors,onChange:e=>ae("totalFloors",e.target.value)}),k.totalFloors&&(0,s.jsx)("span",{className:"error-text",children:k.totalFloors})]})]}),(e.showFacing||e.showAge||e.showFurnishing)&&(0,s.jsxs)("div",{className:"form-row three-cols",children:[e.showFacing&&(0,s.jsxs)("div",{className:"form-group","data-field":"facing",children:[(0,s.jsxs)("label",{children:["Facing ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("select",{name:"facing",value:ne.facing,onChange:e=>ae("facing",e.target.value),className:k.facing?"error":"",children:[(0,s.jsx)("option",{value:"",children:"Select"}),fr.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),k.facing&&(0,s.jsx)("span",{className:"error-text",children:k.facing})]}),e.showAge&&(0,s.jsxs)("div",{className:"form-group","data-field":"age",children:[(0,s.jsxs)("label",{children:["Property Age ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("select",{value:ne.age,onChange:e=>ae("age",e.target.value),children:[(0,s.jsx)("option",{value:"",children:"Select"}),gr.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),k.age&&(0,s.jsx)("span",{className:"error-text",children:k.age})]}),e.showFurnishing&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Furnishing ",e.showFurnishing&&(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("select",{value:ne.furnishing,onChange:e=>ae("furnishing",e.target.value),className:k.furnishing?"error":"",children:[(0,s.jsx)("option",{value:"",children:"Select"}),mr.map(e=>(0,s.jsx)("option",{value:e,children:e},e))]}),k.furnishing&&(0,s.jsx)("span",{className:"error-text",children:k.furnishing})]})]})]})})();case 3:return ke();case 4:return(()=>{var e;return(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("h3",{className:"step-heading",children:"Upload Photos, Video & Brochure"}),(0,s.jsx)("p",{className:"step-subheading",children:"Add up to 10 high-quality photos, optional video and brochure"}),C&&(0,s.jsx)("span",{className:"error-text agent-popup-step-error",children:C}),(0,s.jsxs)("div",{className:"media-upload-row",children:[(0,s.jsxs)("div",{className:"upload-zone media-upload ".concat(k.images?"error":""),onClick:me,role:"button",tabIndex:0,"aria-label":"Upload Images",children:[(0,s.jsx)("input",{ref:Y,type:"file",accept:"image/*",multiple:!0,onChange:de,style:{display:"none"}}),(0,s.jsx)("canvas",{ref:$,style:{display:"none"}}),(0,s.jsxs)("div",{className:"upload-content",children:[(0,s.jsx)("div",{className:"upload-icon",children:(0,s.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("h4",{children:"Upload Photos"}),(0,s.jsx)("p",{children:"JPG, PNG, WEBP \u2014 Max 5MB each"})]})]}),(0,s.jsxs)("div",{className:"upload-zone media-upload ".concat(k.video?"error":""),onClick:()=>{var e;return null===(e=X.current)||void 0===e?void 0:e.click()},role:"button",tabIndex:0,"aria-label":"Upload Video",children:[(0,s.jsx)("input",{ref:X,type:"file",accept:"video/mp4,video/webm,video/quicktime,video/x-m4v,video/ogg",onChange:ve,style:{display:"none"}}),(0,s.jsxs)("div",{className:"upload-content",children:[(0,s.jsx)("div",{className:"upload-icon",children:(0,s.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M23 7v10a2 2 0 01-2 2H3a2 2 0 01-2-2V7a2 2 0 012-2h18a2 2 0 012 2zM10 8l6 4-6 4V8z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("h4",{children:"Upload Video (Optional)"}),(0,s.jsx)("p",{children:"MP4, WEBM, MOV \u2014 Max 50MB"}),k.video&&(0,s.jsx)("span",{className:"error-text small",children:k.video})]})]}),(0,s.jsxs)("div",{className:"upload-zone media-upload ".concat(k.brochure?"error":""),onClick:()=>{var e;return null===(e=J.current)||void 0===e?void 0:e.click()},role:"button",tabIndex:0,"aria-label":"Upload Brochure",children:[(0,s.jsx)("input",{ref:J,type:"file",accept:"application/pdf",onChange:be,style:{display:"none"}}),(0,s.jsxs)("div",{className:"upload-content",children:[(0,s.jsx)("div",{className:"upload-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M14 2v6h6",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),(0,s.jsx)("h4",{children:"Upload Brochure (PDF)"}),(0,s.jsx)("p",{children:"PDF \u2014 Max 10MB"}),k.brochure&&(0,s.jsx)("span",{className:"error-text small",children:k.brochure})]})]})]}),(0,s.jsxs)("div",{className:"media-preview-row",children:[ne.video&&(0,s.jsxs)("div",{className:"video-preview-card preview-item media-card",children:[(0,s.jsx)("video",{controls:!0,src:ne.video.url,className:"video-player"}),(0,s.jsxs)("div",{className:"media-card-footer",children:[(0,s.jsxs)("div",{className:"media-info",children:[(0,s.jsx)("strong",{children:ne.video.name}),(0,s.jsxs)("span",{className:"media-size",children:[Math.round(ne.video.size/1024/1024*100)/100," MB"]})]}),(0,s.jsx)("div",{className:"media-actions",children:(0,s.jsx)("button",{type:"button",className:"remove-btn small",onClick:xe,"aria-label":"Remove video",children:(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})})]})]}),ne.brochure&&(0,s.jsx)("div",{className:"brochure-preview-card preview-item media-card",children:(0,s.jsxs)("div",{className:"brochure-card",children:[(0,s.jsx)("div",{className:"pdf-icon",children:"\ud83d\udcc4"}),(0,s.jsxs)("div",{className:"brochure-info",children:[(0,s.jsx)("strong",{className:"brochure-name",children:ne.brochure.name}),(0,s.jsxs)("span",{className:"media-size",children:[Math.round(ne.brochure.size/1024)," KB"]})]}),(0,s.jsx)("div",{className:"media-actions",children:(0,s.jsx)("button",{type:"button",className:"remove-btn small",onClick:we,"aria-label":"Remove brochure",children:(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})})]})})]}),k.images&&(0,s.jsx)("span",{className:"error-text center",children:k.images}),(null===(e=ne.images)||void 0===e?void 0:e.length)>0&&(0,s.jsxs)("div",{className:"image-preview-section",children:[(0,s.jsxs)("div",{className:"preview-header",children:[(0,s.jsxs)("span",{children:["Uploaded Photos (",ne.images.length,"/10)"]}),(0,s.jsx)("div",{children:(0,s.jsx)("button",{type:"button",className:"add-more-btn",onClick:()=>{var e;return null===(e=Y.current)||void 0===e?void 0:e.click()},disabled:D,children:"+ Add More"})})]}),(0,s.jsx)("div",{className:"image-preview-grid",children:ne.images.map((e,t)=>{const r=L[t]||{status:"pending",errorMessage:""};return(0,s.jsxs)("div",{className:"preview-item image-validation-item ".concat(r.status),children:[(0,s.jsx)("img",{src:e,alt:"Preview ".concat(t+1)}),0===t&&(0,s.jsx)("span",{className:"cover-badge",children:"Cover"}),"checking"===r.status&&(0,s.jsx)("div",{className:"validation-overlay checking-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("p",{className:"status-message-text",children:"Checking..."})]})}),"approved"===r.status&&(0,s.jsx)("div",{className:"validation-overlay approved-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("svg",{className:"checkmark",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("p",{className:"approved-text",children:"Approved"})]})}),"rejected"===r.status&&(0,s.jsx)("div",{className:"validation-overlay rejected-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("svg",{className:"x-icon",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})}),(0,s.jsx)("p",{className:"rejected-title",children:"REJECTED"}),(0,s.jsx)("p",{className:"rejected-message",children:r.errorMessage||"Image rejected"}),(0,s.jsx)("button",{type:"button",className:"remove-rejected-btn",onClick:()=>!re&&_e(t),disabled:re,children:"Remove & Try Again"})]})}),"approved"===r.status&&(0,s.jsx)("div",{className:"status-badge approved-badge",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),"rejected"===r.status&&(0,s.jsx)("div",{className:"status-badge rejected-badge",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),"checking"!==r.status&&(0,s.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>!re&&_e(t),disabled:re,title:"Remove image",children:"\u2715"})]},t)})}),L.some(e=>"rejected"===e.status)&&(0,s.jsxs)("div",{className:"image-validation-warning",children:[(0,s.jsx)("strong",{children:"\u26a0\ufe0f Remove rejected images to continue"}),(0,s.jsxs)("p",{style:{margin:"4px 0 0 0",fontSize:"13px"},children:[L.filter(e=>"rejected"===e.status).length," image(s) were rejected. Please remove them and upload valid property images only."]})]}),L.length>0&&L.every(e=>"approved"===e.status)&&!D&&(0,s.jsxs)("div",{className:"image-validation-success",style:{background:"#e8f5e9",color:"#2e7d32",padding:"12px",borderRadius:"4px",marginTop:"16px",fontSize:"14px",border:"1px solid #4CAF50",display:"flex",alignItems:"center",gap:"8px"},children:[(0,s.jsx)("span",{children:"\u2705"}),(0,s.jsx)("span",{children:"All images approved! Proceeding to next step..."})]})]})]})})();case 5:return(()=>{var e;return(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("h3",{className:"step-heading",children:"Pricing Details"}),(0,s.jsx)("p",{className:"step-subheading",children:"Set the right price for your property"}),C&&(0,s.jsx)("span",{className:"error-text agent-popup-step-error",children:C}),(0,s.jsxs)("div",{className:"form-group","data-field":"price",children:[(0,s.jsxs)("label",{children:["sale"===ne.status?"Expected Price":"Monthly Rent",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",name:"price",placeholder:"sale"===ne.status?"Enter expected price":"Enter monthly rent",value:ne.price,onChange:e=>ae("price",e.target.value),className:k.price?"error":""})]}),ne.price&&(0,s.jsx)("span",{className:"price-words",children:Ae(ne.price)}),k.price&&(0,s.jsx)("span",{className:"error-text",children:k.price})]}),(0,s.jsx)("div",{className:"form-group",children:(0,s.jsxs)("label",{className:"checkbox-label",children:[(0,s.jsx)("input",{type:"checkbox",checked:ne.priceNegotiable,onChange:e=>ae("priceNegotiable",e.target.checked)}),(0,s.jsx)("span",{className:"checkmark"}),"Price is negotiable"]})}),"rent"===ne.status&&(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"form-group","data-field":"depositAmount",children:[(0,s.jsx)("label",{children:"Security Deposit"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",name:"depositAmount",placeholder:"Enter deposit amount",value:ne.depositAmount,onChange:e=>ae("depositAmount",e.target.value),className:k.depositAmount?"error":""})]}),ne.depositAmount&&(0,s.jsx)("span",{className:"price-words",children:Ae(ne.depositAmount)}),k.depositAmount&&(0,s.jsx)("span",{className:"error-text",children:k.depositAmount})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Maintenance (per month)"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",placeholder:"Enter maintenance",value:ne.maintenanceCharges,onChange:e=>ae("maintenanceCharges",e.target.value)})]}),ne.maintenanceCharges&&(0,s.jsx)("span",{className:"price-words",children:Ae(ne.maintenanceCharges)})]})]}),"sale"===ne.status&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Maintenance (per month)"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"number",placeholder:"Enter monthly maintenance",value:ne.maintenanceCharges,onChange:e=>ae("maintenanceCharges",e.target.value)})]}),ne.maintenanceCharges&&(0,s.jsx)("span",{className:"price-words",children:Ae(ne.maintenanceCharges)})]}),(0,s.jsxs)("div",{className:"listing-summary",children:[(0,s.jsx)("h4",{children:"Listing Summary"}),(0,s.jsxs)("div",{className:"summary-grid",children:[(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Property"}),(0,s.jsx)("span",{className:"summary-value",children:ne.title||"-"})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Type"}),(0,s.jsx)("span",{className:"summary-value",children:ne.propertyType||"-"})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Location"}),(0,s.jsx)("span",{className:"summary-value",children:ne.location||"-"})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Configuration"}),(0,s.jsx)("span",{className:"summary-value",children:ne.bedrooms?"".concat(ne.bedrooms," BHK"):"-"})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Area"}),(0,s.jsx)("span",{className:"summary-value",children:ne.area?"".concat(ne.area," sq.ft"):"-"})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Photos"}),(0,s.jsxs)("span",{className:"summary-value",children:[(null===(e=ne.images)||void 0===e?void 0:e.length)||0," uploaded"]})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Video"}),(0,s.jsx)("span",{className:"summary-value",children:ne.video?ne.video.name:"\u2014"})]}),(0,s.jsxs)("div",{className:"summary-item",children:[(0,s.jsx)("span",{className:"summary-label",children:"Brochure"}),(0,s.jsx)("span",{className:"summary-value",children:ne.brochure?ne.brochure.name:"\u2014"})]})]})]})]})})()}})()}),(0,s.jsxs)("div",{className:"popup-footer",children:[u>1&&(0,s.jsxs)("button",{type:"button",className:"back-btn",onClick:()=>{d(e=>Math.max(e-1,1))},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Back"]}),(0,s.jsxs)("div",{className:"footer-right",children:[(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:oe,children:"Cancel"}),u<5?(0,s.jsxs)("button",{type:"button",className:"next-btn",onClick:Se,children:["Next",(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}):(0,s.jsx)("button",{type:"button",className:"submit-btn",onClick:async()=>{if(S)console.log("Publishing blocked: Form was discarded");else if(je(u)){m(!0),g(!0);try{let u=[],y=null;var e;if(null!==n)y=null===(e=c[n])||void 0===e?void 0:e.id;if(null!==n){const e=L.filter(e=>"approved"===e.status&&e.imageUrl).map(e=>e.imageUrl);u=[...(ne.images||[]).filter(e=>"string"===typeof e&&!e.startsWith("blob:")),...e],ne.images=u}if(g(!1),null===n){const e=(0,p.A)((0,p.A)({},ne),{},{images:[]});let r;try{r=await a(e)}catch(o){throw console.error("Property creation failed:",o),new Error("Failed to create property. Please try again.")}if(!r||!r.id)throw new Error("Failed to get property ID after creation. Please refresh and try again.");y=r.id;const n=L.filter(e=>"approved"===e.status);if(!(n.length>0))return g(!1),m(!1),void v(!0);g(!0);try{const e=n.map(async(e,t)=>{try{const r=await i.NY.uploadImage(e.file,y);return r.success&&r.data&&r.data.url?{success:!0,url:r.data.url||r.data.image_url,index:t}:{success:!1,index:t,error:r.message||"Upload failed"}}catch(o){return console.error("Image ".concat(t+1," upload error:"),o),{success:!1,index:t,error:o.message||"Upload failed"}}}),r=await Promise.all(e),s=r.filter(e=>e.success);if(r.filter(e=>!e.success).length>0)return s.length>0&&(u=s.map(e=>e.url),await i.NY.update(y,{images:u})),g(!1),m(!1),b(!0),void v(!0);if(u=s.map(e=>e.url),u.length>0)try{await i.NY.update(y,{images:u})}catch(d){console.error("Failed to update property with images:",d)}if(ne.video&&ne.video.file&&y)try{var t;console.log("Uploading video for property ID:",y);const e=await i.NY.uploadVideo(ne.video.file,y);e.success&&null!==(t=e.data)&&void 0!==t&&t.url&&console.log("Video uploaded successfully:",e.data.url)}catch(h){console.error("Video upload error:",h)}return g(!1),m(!1),void v(!0)}catch(f){return console.error("Image upload error:",f),g(!1),m(!1),void v(!0)}}else{var r;const e=null===(r=c[n])||void 0===r?void 0:r.id;if(e){if(ne.video&&ne.video.file)try{var s;console.log("Uploading video for property ID:",e);const t=await i.NY.uploadVideo(ne.video.file,e);t.success&&null!==(s=t.data)&&void 0!==s&&s.url&&(ne.videoUrl=t.data.url,console.log("Video uploaded successfully:",t.data.url))}catch(h){console.error("Video upload error:",h)}return await l(e,ne),g(!1),m(!1),b(!0),void v(!0)}}}catch(o){g(!1);const e=o.message||401===o.status?"Authentication required. Please log in to add properties.":403===o.status?"Access denied. Please check your permissions.":"Failed to save property. Please check your connection and try again.";alert(e),console.error("Property save error:",o)}finally{m(!1)}}},disabled:h||S,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner"}),"Publishing..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),null!==n?"Update Property":"Publish Listing"]})})]})]})]})}),B&&(0,s.jsx)("div",{className:"camera-action-selector-overlay",onClick:e=>{e.target.classList.contains("camera-action-selector-overlay")&&U(!1)},children:(0,s.jsxs)("div",{className:"camera-action-selector-modal",children:[(0,s.jsx)("h3",{children:"Choose Upload Method"}),(0,s.jsxs)("div",{className:"camera-action-buttons",children:[(0,s.jsxs)("button",{type:"button",className:"camera-action-btn gallery-btn",onClick:()=>fe("gallery"),children:[(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 19V5a2 2 0 00-2-2H5a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2zM8.5 13.5l2.5 3.01L14.5 12l4.5 6H5l3.5-4.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Upload from Gallery"})]}),(0,s.jsxs)("button",{type:"button",className:"camera-action-btn camera-btn",onClick:()=>fe("camera"),children:[(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Use Camera"})]})]}),(0,s.jsx)("button",{type:"button",className:"camera-action-close-btn",onClick:()=>U(!1),children:"Cancel"})]})}),V&&(0,s.jsx)("div",{className:"camera-capture-overlay",children:(0,s.jsxs)("div",{className:"camera-capture-modal",children:[(0,s.jsxs)("div",{className:"camera-capture-header",children:[(0,s.jsx)("h3",{children:"Take Photo"}),(0,s.jsx)("button",{type:"button",className:"camera-close-btn",onClick:ye,"aria-label":"Close camera",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"camera-preview-container",children:(0,s.jsx)("video",{ref:Q,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-preview-video"})}),(0,s.jsxs)("div",{className:"camera-controls",children:[(0,s.jsx)("button",{type:"button",className:"camera-flip-btn",onClick:async()=>{const e="environment"===Z?"user":"environment";K(e),H&&H.getTracks().forEach(e=>e.stop());try{const t={video:{facingMode:e,width:{ideal:1920},height:{ideal:1080}}},r=await navigator.mediaDevices.getUserMedia(t);G(r),Q.current&&(Q.current.srcObject=r,Q.current.play())}catch(t){console.error("Error flipping camera:",t),alert("Failed to switch camera. Please try again.")}},"aria-label":"Flip camera",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M17 1l4 4-4 4M21 5H11M7 23l-4-4 4-4M3 19h10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 12a3 3 0 11-6 0 3 3 0 016 0z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{type:"button",className:"camera-capture-btn",onClick:()=>{if(!Q.current||!$.current)return;const e=Q.current,t=$.current,r=t.getContext("2d");t.width=e.videoWidth,t.height=e.videoHeight,r.drawImage(e,0,0,t.width,t.height),t.toBlob(e=>{if(!e)return void alert("Failed to capture image. Please try again.");const t={target:{files:[new File([e],"camera-capture-".concat(Date.now(),".jpg"),{type:"image/jpeg",lastModified:Date.now()})]}};ye(),de(t)},"image/jpeg",.95)},"aria-label":"Capture photo",children:(0,s.jsx)("div",{className:"camera-capture-circle",children:(0,s.jsx)("div",{className:"camera-capture-inner"})})}),(0,s.jsx)("button",{type:"button",className:"camera-cancel-btn",onClick:ye,"aria-label":"Cancel",children:"Cancel"})]})]})}),N&&(0,s.jsx)("div",{className:"location-picker-modal-overlay",onClick:e=>{e.target.classList.contains("location-picker-modal-overlay")&&I(!1)},children:(0,s.jsx)(Et,{initialLocation:ne.latitude&&ne.longitude?{latitude:parseFloat(ne.latitude),longitude:parseFloat(ne.longitude),fullAddress:ne.location}:null,onLocationChange:e=>{if(re)return;const t=e.state||"",r=!!t;ie(r=>(0,p.A)((0,p.A)({},r),{},{latitude:e.latitude.toString(),longitude:e.longitude.toString(),location:e.fullAddress||r.location,state:t})),z(r),I(!1),(k.location||k.state)&&A(e=>(0,p.A)((0,p.A)({},e),{},{location:null,state:null})),C&&E(null)},onClose:()=>I(!1)})})]})}const _r=(0,I.A)("calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]),vr=(0,I.A)("chevron-left",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]),xr=(0,I.A)("chevron-right",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]),br=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];function wr(t){let{value:r,onChange:n,placeholder:i="Select date",id:o,onOpenChange:a}=t;const[l,c]=(0,e.useState)(!1),[u,d]=(0,e.useState)(()=>{if(r){const[e,t]=r.split("-").map(Number);return new Date(e,t-1,1)}return new Date}),h=(0,e.useRef)(null);(0,e.useEffect)(()=>{if(r){const[e,t]=r.split("-").map(Number);d(new Date(e,t-1,1))}},[r]),(0,e.useEffect)(()=>{const e=e=>{h.current&&!h.current.contains(e.target)&&c(!1)};if(l)return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[l]),(0,e.useEffect)(()=>{a&&a(l)},[l,a]);const p=e=>{const t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),n=String(e.getDate()).padStart(2,"0");return"".concat(t,"-").concat(r,"-").concat(n)},m=u.getFullYear(),f=u.getMonth(),g=new Date(m,f,1),y=new Date(m,f+1,0),_=g.getDay(),v=y.getDate(),x=[];for(let e=0;e<_;e++)x.push(null);for(let e=1;e<=v;e++)x.push(e);const b=r?r.split("-").map(Number):null;return(0,s.jsxs)("div",{className:"modern-date-picker",ref:h,children:[(0,s.jsxs)("button",{type:"button",className:"modern-date-picker-input",onClick:()=>c(e=>!e),"aria-haspopup":"dialog","aria-expanded":l,"aria-label":i,id:o,children:[(0,s.jsx)(_r,{size:18,className:"modern-date-picker-icon"}),(0,s.jsx)("span",{className:r?"":"modern-date-picker-placeholder",children:r?(e=>{if(!e)return"";const[t,r,n]=e.split("-").map(Number);return"".concat(n," ").concat(br[r-1]," ").concat(t)})(r):i})]}),l&&(0,s.jsxs)("div",{className:"modern-date-picker-dropdown",role:"dialog","aria-modal":"true",children:[(0,s.jsxs)("div",{className:"modern-date-picker-header",children:[(0,s.jsx)("button",{type:"button",className:"modern-date-picker-nav",onClick:()=>d(new Date(m,f-1,1)),"aria-label":"Previous month",children:(0,s.jsx)(vr,{size:18})}),(0,s.jsxs)("div",{className:"modern-date-picker-selectors",children:[(0,s.jsx)("select",{className:"modern-date-picker-select",value:f,onChange:e=>d(new Date(m,parseInt(e.target.value),1)),children:br.map((e,t)=>(0,s.jsx)("option",{value:t,children:e},e))}),(0,s.jsx)("select",{className:"modern-date-picker-select",value:m,onChange:e=>d(new Date(parseInt(e.target.value),f,1)),children:Array.from({length:10},(e,t)=>(new Date).getFullYear()-3+t).map(e=>(0,s.jsx)("option",{value:e,children:e},e))})]}),(0,s.jsx)("button",{type:"button",className:"modern-date-picker-nav",onClick:()=>d(new Date(m,f+1,1)),"aria-label":"Next month",children:(0,s.jsx)(xr,{size:18})})]}),(0,s.jsx)("div",{className:"modern-date-picker-weekdays",children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(e=>(0,s.jsx)("span",{className:"modern-date-picker-weekday",children:e},e))}),(0,s.jsx)("div",{className:"modern-date-picker-grid",children:x.map((e,t)=>{const r=b&&b[0]===m&&b[1]===f+1&&b[2]===e,i=(()=>{const t=new Date;return e&&t.getFullYear()===m&&t.getMonth()===f&&t.getDate()===e})();return(0,s.jsx)("button",{type:"button",className:"modern-date-picker-day ".concat(e?"":"empty"," ").concat(r?"selected":""," ").concat(i?"today":""),onClick:()=>(e=>{if(!e)return;const t=new Date(m,f,e);n(p(t)),c(!1)})(e),disabled:!e,children:e||""},t)})}),(0,s.jsx)("div",{className:"modern-date-picker-footer",children:(0,s.jsx)("button",{type:"button",className:"modern-date-picker-today",onClick:()=>{n(p(new Date)),c(!1)},children:"Today"})})]})]})}const jr=[{id:1,title:"Basic Details",icon:"\ud83d\udcdd"},{id:2,title:"Location",icon:"\ud83d\udccd"},{id:3,title:"Configuration",icon:"\ud83c\udfd7\ufe0f"},{id:4,title:"Pricing & Amenities",icon:"\ud83d\udcb0"},{id:5,title:"Media & Contact",icon:"\ud83d\udcf7"}],Sr=[{value:"Apartment",icon:"\ud83c\udfe2"},{value:"Villa / Banglow",icon:"\ud83c\udfe1"},{value:"Independent House",icon:"\ud83c\udfd8\ufe0f"},{value:"Row House/ Farm House",icon:"\ud83c\udfd8\ufe0f"},{value:"Penthouse",icon:"\ud83c\udf06"},{value:"Studio Apartment",icon:"\ud83d\udecf\ufe0f"},{value:"Plot / Land / Indusrtial Property",icon:"\ud83d\udcd0"},{value:"Commercial Office",icon:"\ud83c\udfe2"},{value:"Commercial Shop",icon:"\ud83c\udfea"},{value:"PG / Hostel",icon:"\ud83d\udecf\ufe0f"},{value:"Warehouse / Godown",icon:"\ud83c\udfea"}],Tr=[{value:"UNDER CONSTRUCTION",label:"UNDER CONSTRUCTION"},{value:"PRE-LAUNCH",label:"PRE-LAUNCH"},{value:"COMPLETED",label:"COMPLETED"}],kr={Apartment:["Studio Apartment","1BHK","2BHK","3BHK","4BHK","5+BHK","Duplex Apartment","Penthouse"],"Villa / Banglow":["2BHK Villa","3BHK Villa","4BHK Villa","5+BHK Villa","Luxury Villa"],"Independent House":["1BHK Independent House","2BHK Independent House","3BHK Independent House","4+BHK Independent House"],"Row House/ Farm House":["2BHK Row House","3BHK Row House","4BHK Row House","Farm House Plot","Luxury Farm House"],Penthouse:["3BHK Penthouse","4BHK Penthouse","5+BHK Penthouse"],"Studio Apartment":["Studio Unit","Studio + Balcony","Studio Deluxe"],"Plot / Land / Indusrtial Property":["Residential Plot","Commercial Plot","Industrial Plot","NA Plot","Agricultural Land"],"Commercial Office":["Office Space (Bare Shell)","Furnished Office","Co-working Space","IT / Tech Park Office","Business Center Office"],"Commercial Shop":["Retail Shop","Showroom","Food Court Shop","Kiosk","Mall Shop"],"PG / Hostel":["Single Sharing","Double Sharing","Triple Sharing","Dormitory","Girls Hostel / Boys Hostel"],"Warehouse / Godown":["Small Warehouse","Medium Warehouse","Large Warehouse","Cold Storage","Logistics Warehouse"]},Ar=[{id:"parking",label:"Parking",icon:"\ud83d\ude97"},{id:"lift",label:"Lift",icon:"\ud83d\uded7"},{id:"security",label:"24x7 Security",icon:"\ud83d\udc6e"},{id:"power_backup",label:"Power Backup",icon:"\u26a1"},{id:"gym",label:"Gym",icon:"\ud83c\udfcb\ufe0f"},{id:"swimming_pool",label:"Swimming Pool",icon:"\ud83c\udfca"},{id:"garden",label:"Garden",icon:"\ud83c\udf33"},{id:"clubhouse",label:"Club House",icon:"\ud83c\udfdb\ufe0f"},{id:"playground",label:"Children's Play Area",icon:"\ud83c\udfa2"},{id:"cctv",label:"CCTV",icon:"\ud83d\udcf9"},{id:"intercom",label:"Intercom",icon:"\ud83d\udcde"},{id:"fire_safety",label:"Fire Safety",icon:"\ud83d\udd25"},{id:"water_supply",label:"24x7 Water",icon:"\ud83d\udca7"},{id:"gas_pipeline",label:"Gas Pipeline",icon:"\ud83d\udd25"},{id:"wifi",label:"WiFi",icon:"\ud83d\udcf6"},{id:"ac",label:"Air Conditioning",icon:"\u2744\ufe0f"},{id:"electricity",label:"Electricity",icon:"\u26a1"}],Cr=["Andhra Pradesh","Arunachal Pradesh","Assam","Bihar","Chhattisgarh","Goa","Gujarat","Haryana","Himachal Pradesh","Jharkhand","Karnataka","Kerala","Madhya Pradesh","Maharashtra","Manipur","Meghalaya","Mizoram","Nagaland","Odisha","Punjab","Rajasthan","Sikkim","Tamil Nadu","Telangana","Tripura","Uttar Pradesh","Uttarakhand","West Bengal","Andaman and Nicobar Islands","Chandigarh","Dadra and Nagar Haveli and Daman and Diu","Delhi","Jammu and Kashmir","Ladakh","Lakshadweep","Puducherry"];function Er(t){var r,n,o,a,l,c;let{onClose:u,editData:d=null}=t;const{addProperty:h,updateProperty:m,refreshData:f}=lr(),g=!!d,[y,v]=(0,e.useState)(1),[x,b]=(0,e.useState)(!1),[w,j]=(0,e.useState)(!1),[S,T]=(0,e.useState)({}),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(!1),[N,I]=(0,e.useState)(!1),[P,M]=(0,e.useState)(!1),[L,R]=(0,e.useState)([]),[D,F]=(0,e.useState)([]),[O,z]=(0,e.useState)(!1),[B,U]=(0,e.useState)(""),[V,W]=(0,e.useState)(!1),[H,G]=(0,e.useState)(!1),[Z,K]=(0,e.useState)(!1),[Y,X]=(0,e.useState)(!1),J=(0,e.useRef)(null),Q=(0,e.useRef)(),$=(0,e.useRef)(null),ee=(0,e.useRef)(null);(0,e.useEffect)(()=>{const e=i.R2.getUser();e&&e.full_name&&U(e.full_name)},[]),(0,e.useEffect)(()=>{if(d&&g){let t={};try{"string"===typeof d.upcomingProjectData?t=JSON.parse(d.upcomingProjectData):"object"===typeof d.upcomingProjectData&&d.upcomingProjectData&&(t=d.upcomingProjectData)}catch(e){console.warn("Failed to parse upcoming_project_data:",e)}const r={Villa:"Villa / Banglow",Plot:"Plot / Land / Indusrtial Property",Commercial:"Commercial Office"}[d.propertyType]||d.propertyType||"",n=(Array.isArray(d.amenities)?d.amenities:[]).map(e=>"play_area"===e?"playground":e);if(re({projectName:d.title||"",builderName:t.builderName||B||"",projectType:r,projectStatus:t.projectStatus||"UNDER CONSTRUCTION",reraNumber:t.reraNumber||"",description:d.description||"",city:"",area:d.location||"",location:d.location||"",fullAddress:d.additionalAddress||"",latitude:d.latitude||"",longitude:d.longitude||"",state:d.state||"",pincode:t.pincode||"",mapLink:t.mapLink||"",configurations:Array.isArray(t.configurations)?t.configurations:[],carpetAreaRange:t.carpetAreaRange||"",numberOfTowers:t.numberOfTowers||"",totalUnits:t.totalUnits||"",floorsCount:t.floorsCount||"",unitsPerFloor:t.unitsPerFloor||"",numberOfVillas:t.numberOfVillas||"",numberOfPlots:t.numberOfPlots||"",bedCapacity:t.bedCapacity||"",loadingDocks:t.loadingDocks||"",startingPrice:d.price?(parseFloat(d.price)/1e7).toFixed(2)+" Cr":"",pricePerSqft:t.pricePerSqft||"",bookingAmount:t.bookingAmount||"",expectedLaunchDate:t.expectedLaunchDate||"",expectedPossessionDate:t.expectedPossessionDate||"",amenities:n,reraStatus:t.reraStatus||"",landOwnershipType:t.landOwnershipType||"",bankApproved:t.bankApproved||"",approvedBanks:Array.isArray(t.approvedBanks)?t.approvedBanks:[],otherBankName:"",coverImage:d.images&&d.images.length>0?{url:d.images[0]}:null,projectImages:Array.isArray(d.images)?d.images:[],brochure:null,salesPersons:Array.isArray(t.salesPersons)&&t.salesPersons.length>0?t.salesPersons.map(e=>({name:e.name||"",number:e.number||"",email:e.email||"",landlineNumber:e.landlineNumber||"",whatsappNumber:e.whatsappNumber||"",alternativeNumber:e.alternativeNumber||""})):[{name:t.salesName||"",number:t.salesNumber||"",email:t.emailId||"",landlineNumber:t.landlineNumber||t.mobileNumber||"",whatsappNumber:t.whatsappNumber||"",alternativeNumber:t.alternativeNumber||""}].filter(e=>e.name||e.number||e.email).length>0?[{name:t.salesName||"",number:t.salesNumber||"",email:t.emailId||"",landlineNumber:t.landlineNumber||t.mobileNumber||"",whatsappNumber:t.whatsappNumber||"",alternativeNumber:t.alternativeNumber||""}]:[{name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}],landlineNumber:t.landlineNumber||t.mobileNumber||"",whatsappNumber:t.whatsappNumber||"",alternativeNumber:t.alternativeNumber||"",projectHighlights:t.projectHighlights||"",usp:t.usp||""}),d.images&&Array.isArray(d.images)&&d.images.length>0){const e=d.images.map(e=>({file:null,preview:e,status:"approved",errorMessage:"",imageId:null,imageUrl:e}));F(e)}}},[d,g,B]);const[te,re]=(0,e.useState)({projectName:"",builderName:"",projectType:"",projectStatus:"UNDER CONSTRUCTION",reraNumber:"",description:"",city:"",area:"",fullAddress:"",latitude:"",longitude:"",state:"",pincode:"",mapLink:"",configurations:[],carpetAreaRange:"",numberOfTowers:"",totalUnits:"",floorsCount:"",unitsPerFloor:"",numberOfVillas:"",numberOfPlots:"",bedCapacity:"",loadingDocks:"",startingPrice:"",pricePerSqft:"",bookingAmount:"",expectedLaunchDate:"",expectedPossessionDate:"",amenities:[],reraStatus:"",landOwnershipType:"",bankApproved:"",approvedBanks:[],otherBankName:"",coverImage:null,projectImages:[],brochure:null,salesPersons:[{name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}],landlineNumber:"",whatsappNumber:"",alternativeNumber:"",projectHighlights:"",usp:""}),ne=(0,e.useCallback)(()=>{re({projectName:"",builderName:"",projectType:"",projectStatus:"UNDER CONSTRUCTION",reraNumber:"",description:"",city:"",area:"",fullAddress:"",latitude:"",longitude:"",state:"",pincode:"",mapLink:"",configurations:[],carpetAreaRange:"",numberOfTowers:"",totalUnits:"",floorsCount:"",unitsPerFloor:"",numberOfVillas:"",numberOfPlots:"",bedCapacity:"",loadingDocks:"",startingPrice:"",pricePerSqft:"",bookingAmount:"",expectedLaunchDate:"",expectedPossessionDate:"",amenities:[],reraStatus:"",landOwnershipType:"",bankApproved:"",approvedBanks:[],otherBankName:"",coverImage:null,projectImages:[],brochure:null,salesPersons:[{name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}],landlineNumber:"",whatsappNumber:"",alternativeNumber:"",projectHighlights:"",usp:""}),v(1),T({}),R([]),F([]),z(!1),W(!1),b(!1),j(!1),A(!1)},[]),ie=((0,e.useCallback)(()=>{I(!0),ne(),E(!1),u()},[ne,u]),(0,e.useCallback)(()=>{y===jr.length&&!k?E(!0):u()},[y,k,u]));(0,e.useEffect)(()=>{if(C)return;const e=e=>{"Escape"===e.key&&ie()};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[ie,C]),(0,e.useEffect)(()=>{const e=e=>{J.current&&!J.current.contains(e.target)&&G(!1)};return document.addEventListener("mousedown",e),()=>document.removeEventListener("mousedown",e)},[]),(0,e.useEffect)(()=>()=>{te.projectImages&&te.projectImages.forEach(e=>{"string"===typeof e&&e.startsWith("blob:")&&URL.revokeObjectURL(e)})},[]);const se=(e,t)=>{re(r=>{const n=(0,p.A)((0,p.A)({},r),{},{[e]:t});if("projectType"===e){const e=kr[t]||[];n.configurations=(r.configurations||[]).filter(t=>e.includes(t))}return n}),S[e]&&T(t=>(0,p.A)((0,p.A)({},t),{},{[e]:null}))},oe=(e,t)=>{const r=t.replace(/[^\d.\-\s,]/g,"");se(e,r)},ae=(e,t,r)=>{re(n=>{const i=[...n.salesPersons||[{name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}]];return i[e]||(i[e]={name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}),i[e]=(0,p.A)((0,p.A)({},i[e]),{},{[t]:r}),(0,p.A)((0,p.A)({},n),{},{salesPersons:i})}),T(t=>{const r=(0,p.A)({},t);return["name","number","email"].forEach(t=>{r["salesPerson_".concat(t,"_").concat(e)]&&delete r["salesPerson_".concat(t,"_").concat(e)]}),r})},le=()=>{re(e=>{const t=e.salesPersons||[];return t.length>=5?e:(0,p.A)((0,p.A)({},e),{},{salesPersons:[...t,{name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}]})})},ce=e=>{if(!e)return re(e=>(0,p.A)((0,p.A)({},e),{},{location:"",area:"",state:"",latitude:"",longitude:""})),W(!1),void((S.location||S.area||S.state)&&T(e=>(0,p.A)((0,p.A)({},e),{},{location:null,area:null,state:null})));const t=e.state||"",r=!!t;re(r=>{var n,i,s,o;return(0,p.A)((0,p.A)({},r),{},{location:e.placeName||e.fullAddress||r.location||r.area,area:e.placeName||e.fullAddress||r.area,latitude:(null===(n=e.coordinates)||void 0===n||null===(i=n.lat)||void 0===i?void 0:i.toString())||r.latitude||"",longitude:(null===(s=e.coordinates)||void 0===s||null===(o=s.lng)||void 0===o?void 0:o.toString())||r.longitude||"",state:t})}),W(r),(S.location||S.area||S.state)&&T(e=>(0,p.A)((0,p.A)({},e),{},{location:null,area:null,state:null}))},ue=async e=>{var t;const r=Array.from(e.target.files||[]),n=(null===(t=te.projectImages)||void 0===t?void 0:t.length)||0;if(n+r.length>20)return void T(e=>(0,p.A)((0,p.A)({},e),{},{projectImages:"You can upload a maximum of 20 images. You have ".concat(n," and trying to add ").concat(r.length)}));const i=[];for(const c of r){const e=St(c);e.valid?i.push(c):T(t=>(0,p.A)((0,p.A)({},t),{},{projectImages:e.message}))}if(0===i.length)return;const s=i.map(e=>({file:e,preview:URL.createObjectURL(e),status:"pending",errorMessage:"",imageId:null,imageUrl:null}));R(e=>[...e,...i].slice(0,20)),F(e=>[...e,...s].slice(0,20));const o=i.map(e=>URL.createObjectURL(e));re(e=>(0,p.A)((0,p.A)({},e),{},{projectImages:[...e.projectImages||[],...o].slice(0,20)})),S.projectImages&&T(e=>(0,p.A)((0,p.A)({},e),{},{projectImages:null})),z(!0);const a=D.length,l=s.map((e,t)=>de(e,a+t));await Promise.all(l),z(!1)},de=async(e,t)=>{F(e=>{const r=[...e];return r[t]&&(r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"checking"})),r});try{var r;const i=0,s=new FormData;s.append("image",e.file),s.append("property_id",i),s.append("validate_only","true");const o=localStorage.getItem("authToken");console.log("[Image ".concat(t+1,"] Starting validation..."));const a=await fetch("".concat(q.JR).concat(q.Sn.MODERATE_AND_UPLOAD),{method:"POST",headers:{Authorization:"Bearer ".concat(o)},body:s});if(console.log("[Image ".concat(t+1,"] Response status:"),a.status),!a.ok){const e=await a.text();let r;console.error("[Image ".concat(t+1,"] HTTP Error ").concat(a.status,":"),e);try{r=JSON.parse(e)}catch(n){r={message:e||"HTTP ".concat(a.status," Error")}}return void F(e=>{const n=[...e];return n[t]&&(n[t]=(0,p.A)((0,p.A)({},n[t]),{},{status:"rejected",errorMessage:r.message||"Validation failed",fullErrorMessage:r.message||"HTTP ".concat(a.status," Error")})),n})}const l=await a.json();console.log("[Image ".concat(t+1,"] API Response:"),l);const c=null===(r=l.data)||void 0===r?void 0:r.moderation_status;F(e=>{const r=[...e];var n,i,s;if(r[t])if("success"===l.status&&null!==(n=l.data)&&void 0!==n&&n.image_url)console.log("[Image ".concat(t+1,"] \u2705 Auto-approved for Agent (moderation_status: ").concat(c||"N/A",")")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(i=l.data)||void 0===i?void 0:i.image_id,imageUrl:null===(s=l.data)||void 0===s?void 0:s.image_url,moderationStatus:c||"SAFE"});else if("SAFE"===c){var o,a;console.log("[Image ".concat(t+1,"] \u2705 Approved (SAFE)")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(o=l.data)||void 0===o?void 0:o.image_id,imageUrl:null===(a=l.data)||void 0===a?void 0:a.image_url,moderationStatus:"SAFE"})}else if("PENDING"===c||"NEEDS_REVIEW"===c||"pending_review"===l.status){var u;console.log("[Image ".concat(t+1,"] \u23f3 Under Review (").concat(c||"PENDING",")")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"pending",errorMessage:l.message||"Image is under review",moderationStatus:c||"PENDING",imageUrl:(null===(u=l.data)||void 0===u?void 0:u.image_url)||null})}else if("success"===l.status){var d,h;console.log("[Image ".concat(t+1,"] \u2705 Auto-approved for Agent (missing moderation_status, treating as approved)")),r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"approved",imageId:null===(d=l.data)||void 0===d?void 0:d.image_id,imageUrl:(null===(h=l.data)||void 0===h?void 0:h.image_url)||null,moderationStatus:"SAFE"})}else{let e=l.message||"Image was rejected";if(console.log("[Image ".concat(t+1,"] \u274c Rejected:"),e),e.includes("animal appearance")){const t=e.match(/\(([^)]+)\)/);e=t?"".concat(t[1]," detected"):"Animal detected"}else e.includes("human appearance")?e="Human detected":e.includes("blurry")?e="Image is too blurry":e.includes("low quality")&&(e="Image quality too low");r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"rejected",errorMessage:e,fullErrorMessage:l.message||"Image was rejected"})}return r})}catch(i){console.error("[Image ".concat(t+1,"] \u274c Validation error:"),i),console.error("[Image ".concat(t+1,"] Error details:"),{name:i.name,message:i.message,stack:i.stack}),F(e=>{const r=[...e];return r[t]&&(r[t]=(0,p.A)((0,p.A)({},r[t]),{},{status:"rejected",errorMessage:i.message||"Validation failed. Please check console for details.",fullErrorMessage:i.message||"Failed to validate image. Please try again."})),r})}},he=e=>{var t;te.projectImages&&te.projectImages[e]&&te.projectImages[e].startsWith("blob:")&&URL.revokeObjectURL(te.projectImages[e]),null!==(t=D[e])&&void 0!==t&&t.preview&&D[e].preview.startsWith("blob:")&&URL.revokeObjectURL(D[e].preview),re(t=>(0,p.A)((0,p.A)({},t),{},{projectImages:t.projectImages.filter((t,r)=>r!==e)})),R(t=>t.filter((t,r)=>r!==e)),F(t=>t.filter((t,r)=>r!==e))},pe=e=>{var t,r,n,i,s,o,a,l;const c={};switch(e){case 1:null!==(t=te.projectName)&&void 0!==t&&t.trim()||(c.projectName="Project name is required"),te.projectType||(c.projectType="Project type is required"),te.projectStatus||(c.projectStatus="Project status is required"),null!==(r=te.description)&&void 0!==r&&r.trim()?te.description.trim().length<100&&(c.description="Project description must be at least 100 characters"):c.description="Project description is required";break;case 2:null!==(n=te.location)&&void 0!==n&&n.trim()||null!==(i=te.area)&&void 0!==i&&i.trim()||(c.location="Location is required"),null!==(s=te.state)&&void 0!==s&&s.trim()||(c.state="State is required"),null!==(o=te.fullAddress)&&void 0!==o&&o.trim()||(c.fullAddress="Additional address is required"),null!==(a=te.pincode)&&void 0!==a&&a.trim()?/^\d{6}$/.test(te.pincode.trim())||(c.pincode="Pincode must be 6 digits"):c.pincode="Pincode is required";break;case 3:var u;0===(te.projectType&&kr[te.projectType]||[]).length?c.configurations="Select a project type in Step 1 first.":0===te.configurations.length&&(c.configurations="At least one configuration is required"),null!==(u=te.carpetAreaRange)&&void 0!==u&&u.trim()||(c.carpetAreaRange="Area range is required");break;case 4:null!==(l=te.startingPrice)&&void 0!==l&&l.trim()||(c.startingPrice="Starting price is required"),te.amenities&&0!==te.amenities.length||(c.amenities="At least one amenity must be selected");break;case 5:const e=Math.max(D.length,te.projectImages.length||0);if(e<2)c.projectImages="Please upload at least 2 images. Currently uploaded: ".concat(e);else if(e>20)c.projectImages="You can upload a maximum of 20 images. Currently uploaded: ".concat(e);else{O&&(c.projectImages="Please wait for all images to be validated");const e=D.filter(e=>"rejected"===e.status).length;e>0&&(c.projectImages="Please remove ".concat(e," rejected image(s) before proceeding"));0===D.filter(e=>"approved"===e.status).length&&D.length>0&&!O&&(c.projectImages="At least one image must be approved")}const d=te.salesPersons||[];0===d.length?c.salesPersons="At least one sales person is required":d.forEach((e,t)=>{var r,n,i;null!==(r=e.name)&&void 0!==r&&r.trim()?/[^a-zA-Z\s]/.test(e.name)&&(c["salesPerson_name_".concat(t)]="Name should contain only letters"):c["salesPerson_name_".concat(t)]="Sales person name is required",null!==(n=e.number)&&void 0!==n&&n.trim()?10!==e.number.replace(/\D/g,"").length&&(c["salesPerson_number_".concat(t)]="Sales number must be 10 digits"):c["salesPerson_number_".concat(t)]="Sales number is required",null!==(i=e.email)&&void 0!==i&&i.trim()||(c["salesPerson_email_".concat(t)]="Email ID is required")})}return T(c),0===Object.keys(c).length};(0,e.useEffect)(()=>{ee.current&&(ee.current.scrollTop=0)},[y]);const me=e=>{if(!e)return"";if(/[-\u2013\u2014]|to/i.test(e)){const t=e.split(/[-\u2013\u2014]|to/i).map(e=>e.trim()).filter(e=>e);if(2===t.length){const e=fe(t[0]),r=fe(t[1]);if(e&&r)return"".concat(e," - ").concat(r)}}return fe(e)},fe=e=>{if(!e)return"";let t=0;const r=e.toString().replace(/[^\d.]/g,"");return t=parseFloat(r)||0,e.toString().toLowerCase().includes("lakh")||e.toString().toLowerCase().includes("lac")?t*=1e5:(e.toString().toLowerCase().includes("crore")||e.toString().toLowerCase().includes("cr"))&&(t*=1e7),isNaN(t)||0===t?"":t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Crore"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lakh"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(2)," Thousand"):"\u20b9".concat(t)},ge=()=>(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("div",{style:{marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid var(--border-color)"},children:(0,s.jsxs)("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)",fontWeight:"500"},children:["Step ",y," of ",jr.length," \u2014 ",jr[y-1].title]})}),(0,s.jsx)("h3",{className:"step-heading",children:"Basic Details"}),(0,s.jsx)("p",{className:"step-subheading",children:"Let's start with the basic details of your upcoming project"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Project Name ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:te.projectName,onChange:e=>se("projectName",e.target.value),placeholder:"e.g., Green Valley Residency",className:S.projectName?"error":""}),S.projectName&&(0,s.jsx)("span",{className:"error-text",children:S.projectName})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Builder / Developer Name"}),(0,s.jsx)("input",{type:"text",value:te.builderName||B,onChange:e=>se("builderName",e.target.value),placeholder:"Auto-filled from your account",disabled:!0,style:{background:"#f3f4f6",cursor:"not-allowed"}})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Project Type ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"property-type-grid ".concat(S.projectType?"error":""),children:Sr.map(e=>(0,s.jsxs)("button",{type:"button",className:"property-type-btn ".concat(te.projectType===e.value?"active":""),onClick:()=>se("projectType",e.value),children:[(0,s.jsx)("span",{className:"type-icon",children:e.icon}),(0,s.jsx)("span",{className:"type-label",children:e.value})]},e.value))}),S.projectType&&(0,s.jsx)("span",{className:"error-text",children:S.projectType})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Project Status ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("select",{value:te.projectStatus,onChange:e=>se("projectStatus",e.target.value),className:S.projectStatus?"error":"",children:Tr.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),S.projectStatus&&(0,s.jsx)("span",{className:"error-text",children:S.projectStatus})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"RERA Number (Optional but recommended)"}),(0,s.jsx)("input",{type:"text",value:te.reraNumber,onChange:e=>se("reraNumber",e.target.value),placeholder:"e.g., RERA/PKR/2019/001234"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Project Description ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("textarea",{value:te.description,onChange:e=>se("description",e.target.value),placeholder:"Provide a detailed overview of your project (minimum 100 characters)",rows:6,maxLength:1e3,className:S.description?"error":""}),(0,s.jsxs)("div",{className:"char-count",style:{color:te.description.length<100?"#dc2626":"inherit"},children:[te.description.length,"/1000 ",te.description.length<100&&"(minimum 100 required)"]}),S.description&&(0,s.jsx)("span",{className:"error-text",children:S.description})]})]}),ye=te.projectType&&kr[te.projectType]||[],_e=te.projectType,ve="Plot / Land / Indusrtial Property"===_e,xe="Warehouse / Godown"===_e,be="Commercial Office"===_e,we="Villa / Banglow"===_e,je="Independent House"===_e,Se="PG / Hostel"===_e,Te="Apartment"===_e,ke=ve?"Plot Size Range (sq.ft)":be||"Commercial Shop"===_e?"Area Range":xe?"Built-up Area Range":Se?"Carpet Area Range":"Carpet Area Range (sq.ft)",Ae=()=>(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("div",{style:{marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid var(--border-color)"},children:(0,s.jsxs)("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)",fontWeight:"500"},children:["Step ",y," of ",jr.length," \u2014 ",jr[y-1].title]})}),(0,s.jsx)("h3",{className:"step-heading",children:"Configuration"}),(0,s.jsx)("p",{className:"step-subheading",children:te.projectType?"Configurations for ".concat(te.projectType):"Select project type in Step 1 to see configuration options"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Property Configurations ",(0,s.jsx)("span",{className:"required",children:"*"})]}),ye.length>0?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("div",{className:"amenities-grid ".concat(S.configurations?"error":""),children:ye.map(e=>(0,s.jsx)("button",{type:"button",className:"amenity-btn ".concat(te.configurations.includes(e)?"active":""),onClick:()=>(e=>{re(t=>(0,p.A)((0,p.A)({},t),{},{configurations:t.configurations.includes(e)?t.configurations.filter(t=>t!==e):[...t.configurations,e]})),S.configurations&&T(e=>(0,p.A)((0,p.A)({},e),{},{configurations:null}))})(e),children:e},e))}),S.configurations&&(0,s.jsx)("span",{className:"error-text",children:S.configurations})]}):(0,s.jsx)("p",{className:"step-subheading",style:{marginTop:"0.5rem",color:"var(--text-muted)"},children:"Please select a project type in Step 1 (Basic Details) first."})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:[ke," ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("div",{className:"input-with-suffix",children:[(0,s.jsx)("input",{type:"text",value:te.carpetAreaRange,onChange:e=>(e=>{const t=e.replace(/\s*sq\.ft\s*/gi,"").trim();se("carpetAreaRange",t)})(e.target.value),placeholder:ve?"e.g., 500 - 2000":"e.g., 650 - 1200",className:S.carpetAreaRange?"error":""}),(0,s.jsx)("span",{className:"suffix",children:"sq.ft"})]}),S.carpetAreaRange&&(0,s.jsx)("span",{className:"error-text",children:S.carpetAreaRange})]}),Te&&(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Number of Towers"}),(0,s.jsx)("input",{type:"number",value:te.numberOfTowers,onChange:e=>se("numberOfTowers",e.target.value),placeholder:"e.g., 3",min:"1"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Units per floor (optional)"}),(0,s.jsx)("input",{type:"number",value:te.unitsPerFloor,onChange:e=>se("unitsPerFloor",e.target.value),placeholder:"e.g., 4",min:"1"})]})]}),we&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Number of Villas"}),(0,s.jsx)("input",{type:"number",value:te.numberOfVillas,onChange:e=>se("numberOfVillas",e.target.value),placeholder:"e.g., 24",min:"1"})]}),je&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Total Units"}),(0,s.jsx)("input",{type:"number",value:te.totalUnits,onChange:e=>se("totalUnits",e.target.value),placeholder:"e.g., 50",min:"1"})]}),"Row House/ Farm House"===_e&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Total Units"}),(0,s.jsx)("input",{type:"number",value:te.totalUnits,onChange:e=>se("totalUnits",e.target.value),placeholder:"e.g., 30",min:"1"})]}),"Penthouse"===_e&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Number of Towers"}),(0,s.jsx)("input",{type:"number",value:te.numberOfTowers,onChange:e=>se("numberOfTowers",e.target.value),placeholder:"e.g., 2",min:"1"})]}),"Studio Apartment"===_e&&(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Number of Towers"}),(0,s.jsx)("input",{type:"number",value:te.numberOfTowers,onChange:e=>se("numberOfTowers",e.target.value),placeholder:"e.g., 1",min:"1"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Units per floor (optional)"}),(0,s.jsx)("input",{type:"number",value:te.unitsPerFloor,onChange:e=>se("unitsPerFloor",e.target.value),placeholder:"e.g., 8",min:"1"})]})]}),ve&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Number of Plots"}),(0,s.jsx)("input",{type:"number",value:te.numberOfPlots,onChange:e=>se("numberOfPlots",e.target.value),placeholder:"e.g., 100",min:"1"})]}),be&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Number of Floors / Towers"}),(0,s.jsx)("input",{type:"number",value:te.numberOfTowers,onChange:e=>se("numberOfTowers",e.target.value),placeholder:"e.g., 5",min:"1"})]}),Se&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Bed Capacity"}),(0,s.jsx)("input",{type:"number",value:te.bedCapacity,onChange:e=>se("bedCapacity",e.target.value),placeholder:"e.g., 50",min:"1"})]}),xe&&(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Loading Docks (optional)"}),(0,s.jsx)("input",{type:"number",value:te.loadingDocks,onChange:e=>se("loadingDocks",e.target.value),placeholder:"e.g., 4",min:"0"})]})]}),Ce=()=>(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("div",{style:{marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid var(--border-color)"},children:(0,s.jsxs)("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)",fontWeight:"500"},children:["Step ",y," of ",jr.length," \u2014 ",jr[y-1].title]})}),(0,s.jsx)("h3",{className:"step-heading",children:"Pricing & Amenities"}),(0,s.jsx)("p",{className:"step-subheading",children:"Set pricing details and select amenities for your project"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Starting Price ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"text",value:te.startingPrice,onChange:e=>oe("startingPrice",e.target.value),placeholder:"e.g., 4500000 or 45-60",className:S.startingPrice?"error":""})]}),te.startingPrice&&(0,s.jsxs)("span",{className:"price-words",children:["Price: ",me(te.startingPrice)]}),S.startingPrice&&(0,s.jsx)("span",{className:"error-text",children:S.startingPrice})]}),(0,s.jsxs)("div",{className:"form-row",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Price per Sq.ft (Optional)"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"text",value:te.pricePerSqft,onChange:e=>oe("pricePerSqft",e.target.value),placeholder:"e.g., 5000 or 5000-6000"})]}),te.pricePerSqft&&(0,s.jsxs)("span",{className:"price-words",children:["Price: ",me(te.pricePerSqft),"/sq.ft"]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Booking Amount Price (Optional)"}),(0,s.jsxs)("div",{className:"price-input-wrapper",children:[(0,s.jsx)("span",{className:"currency",children:"\u20b9"}),(0,s.jsx)("input",{type:"text",value:te.bookingAmount,onChange:e=>oe("bookingAmount",e.target.value),placeholder:"e.g., 200000 or 1.5-2.5"})]}),te.bookingAmount&&(0,s.jsxs)("span",{className:"price-words",children:["Price: ",me(te.bookingAmount)]})]})]}),(0,s.jsxs)("div",{className:"form-row ".concat(Z||Y?"state-dropdown-row-active":""),children:[(0,s.jsxs)("div",{className:"form-group ".concat(Z?"state-dropdown-open":""),children:[(0,s.jsx)("label",{children:"Launch Date"}),(0,s.jsx)(wr,{value:te.expectedLaunchDate,onChange:e=>se("expectedLaunchDate",e),placeholder:"Select launch date",onOpenChange:K})]}),(0,s.jsxs)("div",{className:"form-group ".concat(Y?"state-dropdown-open":""),children:[(0,s.jsx)("label",{children:"Expected Possession Date"}),(0,s.jsx)(wr,{value:te.expectedPossessionDate,onChange:e=>se("expectedPossessionDate",e),placeholder:"Select possession date",onOpenChange:X})]})]}),(0,s.jsxs)("div",{className:"form-group",style:{marginTop:"2rem"},children:[(0,s.jsxs)("label",{children:["Amenities ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("div",{className:"amenities-grid ".concat(S.amenities?"error":""),children:Ar.map(e=>(0,s.jsxs)("button",{type:"button",className:"amenity-btn ".concat(te.amenities.includes(e.id)?"active":""),onClick:()=>{return t=e.id,re(e=>(0,p.A)((0,p.A)({},e),{},{amenities:e.amenities.includes(t)?e.amenities.filter(e=>e!==t):[...e.amenities,t]})),void(S.amenities&&T(e=>(0,p.A)((0,p.A)({},e),{},{amenities:null})));var t},children:[(0,s.jsx)("span",{className:"amenity-icon",children:e.icon}),(0,s.jsx)("span",{className:"amenity-label",children:e.label}),te.amenities.includes(e.id)&&(0,s.jsx)("span",{className:"check-icon",children:"\u2713"})]},e.id))}),S.amenities&&(0,s.jsx)("span",{className:"error-text",children:S.amenities})]})]}),Ee=()=>{var e,t,r,n,i,o,a,l;return(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("div",{style:{marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid var(--border-color)"},children:(0,s.jsxs)("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)",fontWeight:"500"},children:["Step ",y," of ",jr.length," \u2014 ",jr[y-1].title]})}),(0,s.jsx)("h3",{className:"step-heading",children:"Media & Contact"}),(0,s.jsx)("p",{className:"step-subheading",children:"Upload project images and provide contact information"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Project Cover Image"}),(0,s.jsx)("input",{type:"file",accept:"image/*",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){const e=URL.createObjectURL(r);se("coverImage",{file:r,url:e})}}}),te.coverImage&&(0,s.jsx)("div",{style:{marginTop:"10px"},children:(0,s.jsx)("img",{src:te.coverImage.url,alt:"Cover",style:{maxWidth:"200px",maxHeight:"200px",borderRadius:"8px"}})})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Project Images ",(0,s.jsx)("span",{className:"required",children:"*"})," (Concept images / 3D renders allowed)"]}),(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"12px",marginBottom:"8px"},children:[(0,s.jsx)("input",{ref:Q,type:"file",accept:"image/*",multiple:!0,onChange:ue,style:{display:"none"},disabled:(null===(e=te.projectImages)||void 0===e?void 0:e.length)>=20}),(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>{var e;return null===(e=Q.current)||void 0===e?void 0:e.click()},disabled:(null===(t=te.projectImages)||void 0===t?void 0:t.length)>=20,style:{background:(null===(r=te.projectImages)||void 0===r?void 0:r.length)>=20?"#f3f4f6":"white",border:"2px solid var(--border-color)",cursor:(null===(n=te.projectImages)||void 0===n?void 0:n.length)>=20?"not-allowed":"pointer",opacity:(null===(i=te.projectImages)||void 0===i?void 0:i.length)>=20?.6:1},children:"\ud83d\udcf7 Upload Images (Max 20)"}),(0,s.jsxs)("span",{style:{fontSize:"0.875rem",color:(null===(o=te.projectImages)||void 0===o?void 0:o.length)<2?"#dc2626":"#059669",fontWeight:"500"},children:["Images uploaded: ",(null===(a=te.projectImages)||void 0===a?void 0:a.length)||0," / 20"]})]}),(null===(l=te.projectImages)||void 0===l?void 0:l.length)<2&&(0,s.jsx)("div",{style:{marginBottom:"8px",padding:"8px 12px",background:"#fef2f2",border:"1px solid #fecaca",borderRadius:"4px",color:"#991b1b",fontSize:"0.875rem"},children:"\u26a0\ufe0f Please upload at least 2 images to continue."}),S.projectImages&&(0,s.jsx)("span",{className:"error-text",children:S.projectImages}),(0,s.jsx)("div",{className:"image-preview-grid",style:{marginTop:"15px"},children:te.projectImages.map((e,t)=>{const r=D[t]||{status:"pending",errorMessage:""};return(0,s.jsxs)("div",{className:"preview-item image-validation-item ".concat(r.status),children:[(0,s.jsx)("img",{src:e,alt:"Project ".concat(t+1)}),"checking"===r.status&&(0,s.jsx)("div",{className:"validation-overlay checking-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("div",{className:"spinner"}),(0,s.jsx)("p",{className:"status-message-text",children:"Checking..."})]})}),"approved"===r.status&&(0,s.jsx)("div",{className:"validation-overlay approved-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("svg",{className:"checkmark",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("p",{className:"approved-text",children:"Approved"})]})}),"rejected"===r.status&&(0,s.jsx)("div",{className:"validation-overlay rejected-overlay",children:(0,s.jsxs)("div",{className:"overlay-content",children:[(0,s.jsx)("svg",{className:"x-icon",width:"32",height:"32",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round"})}),(0,s.jsx)("p",{className:"rejected-title",children:"REJECTED"}),(0,s.jsx)("p",{className:"rejected-message",children:r.errorMessage||"Image rejected"}),(0,s.jsx)("button",{type:"button",className:"remove-rejected-btn",onClick:()=>he(t),children:"Remove & Try Again"})]})}),"approved"===r.status&&(0,s.jsx)("div",{className:"status-badge approved-badge",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17L4 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),"rejected"===r.status&&(0,s.jsx)("div",{className:"status-badge rejected-badge",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),"checking"!==r.status&&(0,s.jsx)("button",{type:"button",className:"remove-image-btn",onClick:()=>he(t),title:"Remove image",children:"\u2715"})]},t)})}),D.some(e=>"rejected"===e.status)&&(0,s.jsxs)("div",{className:"image-validation-warning",children:[(0,s.jsx)("strong",{children:"\u26a0\ufe0f Remove rejected images to continue"}),(0,s.jsxs)("p",{style:{margin:"4px 0 0 0",fontSize:"13px"},children:[D.filter(e=>"rejected"===e.status).length," image(s) were rejected. Please remove them and upload valid property images only."]})]}),D.length>0&&D.every(e=>"approved"===e.status)&&!O&&(0,s.jsxs)("div",{className:"image-validation-success",style:{background:"#e8f5e9",color:"#2e7d32",padding:"12px",borderRadius:"4px",marginTop:"16px",fontSize:"14px",border:"1px solid #4CAF50",display:"flex",alignItems:"center",gap:"8px"},children:[(0,s.jsx)("span",{children:"\u2705"}),(0,s.jsx)("span",{children:"All images approved!"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Brochure (PDF)"}),(0,s.jsx)("input",{ref:$,type:"file",accept:".pdf",onChange:e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&se("brochure",{file:r,name:r.name})},style:{display:"none"}}),(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>{var e;return null===(e=$.current)||void 0===e?void 0:e.click()},style:{background:"white",border:"2px solid var(--border-color)"},children:"\ud83d\udcd1 Upload Brochure"}),te.brochure&&(0,s.jsxs)("div",{style:{marginTop:"10px"},children:["\ud83d\udcc4 ",te.brochure.name]})]}),(0,s.jsxs)("div",{className:"form-group",style:{marginTop:"2rem",paddingTop:"2rem",borderTop:"1px solid var(--border-color)"},children:[(0,s.jsx)("h3",{className:"step-heading",style:{fontSize:"1.1rem",marginBottom:"1rem"},children:"Contact Information"}),(0,s.jsx)("p",{className:"step-subheading",style:{fontSize:"0.9rem",marginBottom:"1.25rem"},children:"How can buyers reach you? Add one or more sales person details."}),(te.salesPersons||[{name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}]).map((e,t)=>{var r,n,i;return(0,s.jsxs)("div",{style:{marginBottom:"1.5rem",padding:"1rem",border:"1px solid var(--border-color)",borderRadius:"8px",background:"#fafafa"},children:[(0,s.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"0.75rem"},children:[(0,s.jsxs)("span",{style:{fontWeight:"600",fontSize:"0.9rem"},children:["Sales Person ",t+1]}),(te.salesPersons||[]).length>1&&(0,s.jsx)("button",{type:"button",onClick:()=>{return e=t,re(t=>{const r=(t.salesPersons||[]).filter((t,r)=>r!==e);return 0===r.length&&r.push({name:"",number:"",email:"",landlineNumber:"",whatsappNumber:"",alternativeNumber:""}),(0,p.A)((0,p.A)({},t),{},{salesPersons:r})}),void T(e=>{const t=(0,p.A)({},e);return Object.keys(t).forEach(e=>{e.startsWith("salesPerson_")&&delete t[e]}),t});var e},style:{padding:"4px 10px",fontSize:"0.8rem",background:"#fee2e2",color:"#991b1b",border:"none",borderRadius:"6px",cursor:"pointer"},children:"Remove"})]}),(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Name ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:e.name,onChange:e=>ae(t,"name",e.target.value.replace(/[^a-zA-Z\s]/g,"")),placeholder:"Sales person name (letters only)",className:S["salesPerson_name_".concat(t)]?"error":""}),S["salesPerson_name_".concat(t)]&&(0,s.jsx)("span",{className:"error-text",children:S["salesPerson_name_".concat(t)]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Contact Number ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"tel",value:e.number,onChange:e=>ae(t,"number",e.target.value.replace(/\D/g,"").slice(0,10)),placeholder:"10-digit mobile number",maxLength:10,className:S["salesPerson_number_".concat(t)]?"error":""}),S["salesPerson_number_".concat(t)]&&(0,s.jsx)("span",{className:"error-text",children:S["salesPerson_number_".concat(t)]})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Email ID ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"email",value:e.email,onChange:e=>ae(t,"email",e.target.value),placeholder:"Email address",className:S["salesPerson_email_".concat(t)]?"error":""}),S["salesPerson_email_".concat(t)]&&(0,s.jsx)("span",{className:"error-text",children:S["salesPerson_email_".concat(t)]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Landline Number (Optional)"}),(0,s.jsx)("input",{type:"tel",value:null!==(r=e.landlineNumber)&&void 0!==r?r:"",onChange:e=>ae(t,"landlineNumber",e.target.value.replace(/[^\d\s\-]/g,"")),placeholder:"e.g. 020-12345678 or 0123-1234567",maxLength:15})]}),(0,s.jsxs)("div",{className:"form-row two-cols",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"WhatsApp Number (Optional)"}),(0,s.jsx)("input",{type:"tel",value:null!==(n=e.whatsappNumber)&&void 0!==n?n:"",onChange:e=>ae(t,"whatsappNumber",e.target.value.replace(/\D/g,"").slice(0,10)),placeholder:"10-digit Mobile number",maxLength:10})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Alternative Number (Optional)"}),(0,s.jsx)("input",{type:"tel",value:null!==(i=e.alternativeNumber)&&void 0!==i?i:"",onChange:e=>ae(t,"alternativeNumber",e.target.value.replace(/\D/g,"").slice(0,10)),placeholder:"10-digit mobile number",maxLength:10})]})]})]},t)}),(te.salesPersons||[]).length<5&&(0,s.jsx)("button",{type:"button",onClick:le,style:{display:"inline-flex",alignItems:"center",gap:"8px",padding:"10px 16px",marginBottom:"1.25rem",background:"white",border:"2px dashed var(--border-color)",borderRadius:"8px",cursor:"pointer",fontSize:"0.9rem",fontWeight:"600",color:"var(--accent-color, #7c3aed)"},children:(0,s.jsx)("span",{children:"+ Add another sales person"})})]})]})};return(0,s.jsxs)(s.Fragment,{children:[C&&(0,s.jsx)("div",{className:"popup-overlay",style:{zIndex:1e4},children:(0,s.jsxs)("div",{className:"popup-container",style:{maxWidth:"500px"},children:[(0,s.jsxs)("div",{className:"popup-header",children:[(0,s.jsx)("h2",{children:"Publishing Not Completed"}),(0,s.jsx)("button",{className:"close-btn",onClick:()=>E(!1),"aria-label":"Close",children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"popup-body",style:{padding:"2rem"},children:(0,s.jsxs)("div",{style:{textAlign:"center",marginBottom:"1.5rem"},children:[(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",style:{margin:"0 auto 1rem",color:"var(--warning-color, #f59e0b)"},children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 8v4M12 16h.01",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsxs)("p",{style:{fontSize:"1rem",lineHeight:"1.6",color:"var(--text-color, #333)"},children:["You haven't published this project yet.",(0,s.jsx)("br",{}),"Please publish before closing, or your data will be lost."]})]})}),(0,s.jsx)("div",{className:"popup-footer",style:{justifyContent:"center",gap:"1rem"},children:(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:()=>E(!1),children:"Continue Editing"})})]})}),!C&&(0,s.jsx)("div",{className:"popup-overlay",children:(0,s.jsxs)("div",{className:"popup-container",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"popup-header",children:[(0,s.jsx)("h2",{children:g?"Edit Upcoming Project":"Add Upcoming Project"}),(0,s.jsx)("button",{className:"close-btn",onClick:ie,children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"step-indicator",children:jr.map((e,t)=>{const r=(n=e.id,y>n);var n;const i=r||e.id===y;return(0,s.jsxs)("div",{className:"step-item ".concat(y===e.id?"active":""," ").concat(r?"completed":""," ").concat(i?"clickable":""),children:[(0,s.jsx)("div",{className:"step-circle",onClick:()=>i&&(e=>{e!==y&&e<y&&v(e)})(e.id),style:{cursor:i?"pointer":"default"},children:r?(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"3",strokeLinecap:"round",strokeLinejoin:"round"})}):(0,s.jsx)("span",{children:e.icon})}),(0,s.jsx)("span",{className:"step-title",children:e.title}),t<jr.length-1&&(0,s.jsx)("div",{className:"step-line"})]},e.id)})}),(0,s.jsx)("div",{className:"popup-body",ref:ee,children:(()=>{switch(y){case 1:default:return ge();case 2:return(0,s.jsxs)("div",{className:"step-content",children:[(0,s.jsx)("div",{style:{marginBottom:"1.5rem",paddingBottom:"1rem",borderBottom:"1px solid var(--border-color)"},children:(0,s.jsxs)("span",{style:{fontSize:"0.85rem",color:"var(--text-muted)",fontWeight:"500"},children:["Step ",y," of ",jr.length," \u2014 ",jr[y-1].title]})}),(0,s.jsx)("h3",{className:"step-heading",children:"Location"}),(0,s.jsx)("p",{className:"step-subheading",children:"Where is your project located?"}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Location ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)(_,{placeholder:"Enter locality, area or landmark",value:te.location||te.area||"",onChange:ce,className:S.location||S.area?"error":"",error:S.location||S.area}),(S.location||S.area)&&(0,s.jsx)("span",{className:"error-text",children:S.location||S.area})]}),(0,s.jsxs)("div",{className:"form-group-map",children:[(0,s.jsx)("label",{children:"Project Location on Map (Optional)"}),te.latitude&&te.longitude?(0,s.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:"8px"},children:[(0,s.jsxs)("div",{style:{display:"flex",alignItems:"center",gap:"8px"},children:[(0,s.jsx)("span",{className:"location-icon",style:{fontSize:"18px"},children:"\ud83d\udccd"}),(0,s.jsx)("div",{style:{flex:1},children:(0,s.jsx)("span",{style:{fontSize:"0.875rem",color:"#059669",fontWeight:"500"},children:"Location set on map"})})]}),(0,s.jsxs)("small",{className:"location-picker-coordinates",style:{marginLeft:"26px",fontSize:"0.75rem",color:"#059669",fontFamily:"monospace"},children:["Coordinates: ",parseFloat(te.latitude).toFixed(6),", ",parseFloat(te.longitude).toFixed(6)]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"8px",alignItems:"center"},children:[(0,s.jsx)("button",{type:"button",className:"location-picker-change-btn",onClick:()=>M(!0),style:{padding:"6px 12px",fontSize:"0.875rem",backgroundColor:"#f3f4f6",border:"1px solid #d1d5db",borderRadius:"6px",cursor:"pointer",color:"#374151",fontWeight:"500"},children:"Change Location"}),(0,s.jsx)("button",{type:"button",onClick:()=>{re(e=>(0,p.A)((0,p.A)({},e),{},{latitude:"",longitude:""}))},style:{padding:"6px 12px",fontSize:"0.875rem",backgroundColor:"#fee2e2",border:"1px solid #fecaca",borderRadius:"6px",cursor:"pointer",color:"#991b1b",fontWeight:"500"},children:"Remove"})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("button",{type:"button",className:"location-picker-btn",onClick:()=>M(!0),style:{width:"100%",padding:"0.875rem 1rem",display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",background:"white",border:"2px solid var(--border-color)",borderRadius:"var(--radius-md)",cursor:"pointer",fontSize:"0.95rem",fontWeight:"600",color:"var(--text-primary)",transition:"all var(--transition-fast)"},onMouseEnter:e=>{e.currentTarget.style.borderColor="var(--accent-color)",e.currentTarget.style.color="var(--accent-color)"},onMouseLeave:e=>{e.currentTarget.style.borderColor="var(--border-color)",e.currentTarget.style.color="var(--text-primary)"},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Add Location on Map"})]}),(0,s.jsx)("span",{className:"hint-text",style:{display:"block",marginTop:"0.5rem",fontSize:"0.85rem",color:"var(--text-muted)"},children:"Select exact location on map for better visibility"})]})]}),(0,s.jsxs)("div",{className:"form-row two-cols ".concat(H?"state-dropdown-row-active":""),children:[(0,s.jsxs)("div",{className:"form-group ".concat(H?"state-dropdown-open":""),children:[(0,s.jsxs)("label",{children:["State ",(0,s.jsx)("span",{className:"required",children:"*"}),V&&(0,s.jsx)("span",{style:{fontSize:"0.75rem",color:"#059669",marginLeft:"8px",fontWeight:"normal"},children:"(Auto-filled from location)"})]}),(0,s.jsxs)("div",{style:{position:"relative"},ref:J,children:[(0,s.jsx)("input",{type:"text",placeholder:"Enter state or select from list",value:te.state||"",onChange:e=>{se("state",e.target.value),V&&e.target.value!==te.state&&W(!1),G(!0)},onFocus:()=>!V&&G(!0),className:S.state?"error":"",readOnly:V,disabled:V,style:V?{background:"#f3f4f6",cursor:"not-allowed",color:"#374151"}:{},autoComplete:"off"}),V&&(0,s.jsx)("button",{type:"button",onClick:()=>{W(!1),G(!0)},style:{position:"absolute",right:"8px",top:"50%",transform:"translateY(-50%)",background:"none",border:"none",color:"#7c3aed",cursor:"pointer",fontSize:"0.75rem",fontWeight:"600",padding:"4px 8px",borderRadius:"4px",zIndex:10},title:"Edit state manually",children:"Edit"}),!V&&H&&(te.state||"").trim().length>=2&&(0,s.jsxs)("ul",{className:"state-suggestions-dropdown",style:{position:"absolute",top:"100%",left:0,right:0,margin:0,padding:0,listStyle:"none",background:"#fff",border:"1px solid var(--border-color)",borderRadius:"8px",boxShadow:"0 4px 12px rgba(0,0,0,0.1)",maxHeight:"220px",overflowY:"auto",zIndex:100},children:[Cr.filter(e=>e.toLowerCase().includes((te.state||"").toLowerCase())).slice(0,15).map(e=>(0,s.jsx)("li",{onClick:()=>{se("state",e),G(!1),S.state&&T(e=>(0,p.A)((0,p.A)({},e),{},{state:null}))},style:{padding:"10px 12px",cursor:"pointer",fontSize:"0.9rem",borderBottom:"1px solid #f3f4f6"},onMouseEnter:e=>{e.currentTarget.style.background="#f3f4f6"},onMouseLeave:e=>{e.currentTarget.style.background="#fff"},children:e},e)),0===Cr.filter(e=>e.toLowerCase().includes((te.state||"").toLowerCase())).length&&(0,s.jsx)("li",{style:{padding:"10px 12px",color:"#6b7280",fontSize:"0.9rem"},children:"No matching state"})]})]}),S.state&&(0,s.jsx)("span",{className:"error-text",children:S.state})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Additional Address ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Enter additional address details",value:te.fullAddress||"",onChange:e=>se("fullAddress",e.target.value),className:S.fullAddress?"error":""}),S.fullAddress&&(0,s.jsx)("span",{className:"error-text",children:S.fullAddress})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Pincode ",(0,s.jsx)("span",{className:"required",children:"*"})]}),(0,s.jsx)("input",{type:"text",value:te.pincode||"",onChange:e=>se("pincode",e.target.value.replace(/\D/g,"")),placeholder:"Enter 6-digit pincode",maxLength:6,className:S.pincode?"error":""}),S.pincode&&(0,s.jsx)("span",{className:"error-text",children:S.pincode})]})]});case 3:return Ae();case 4:return Ce();case 5:return Ee()}})()}),(0,s.jsxs)("div",{className:"popup-footer",children:[y>1&&(0,s.jsxs)("button",{type:"button",className:"back-btn",onClick:()=>{v(e=>Math.max(e-1,1))},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Back"]}),(0,s.jsxs)("div",{className:"footer-right",children:[(0,s.jsx)("button",{type:"button",className:"cancel-btn",onClick:ie,children:"Cancel"}),y<5?(0,s.jsxs)("button",{type:"button",className:"next-btn",onClick:()=>{pe(y)?v(e=>Math.min(e+1,5)):setTimeout(()=>{if(ee.current){const e=ee.current.querySelector(".error, .error-text");e?e.scrollIntoView({behavior:"smooth",block:"center"}):ee.current.scrollTop=0}},100)},children:["Next",(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]}):(0,s.jsx)("button",{type:"button",className:"submit-btn",onClick:async()=>{if(N)console.log("Publishing blocked: Form was discarded");else if(pe(5)){b(!0),j(!0);try{var e,t,r,n,s,o,a,l,c,p,m,y,_,x,w;let v=0;if(te.startingPrice){const e=te.startingPrice.replace(/[^\d.]/g,"");v=parseFloat(e)||0,te.startingPrice.toLowerCase().includes("lakh")||te.startingPrice.toLowerCase().includes("lac")?v*=1e5:(te.startingPrice.toLowerCase().includes("crore")||te.startingPrice.toLowerCase().includes("cr"))&&(v*=1e7)}if(!v||v<=0)throw new Error("Starting price is required and must be greater than 0");const b={title:te.projectName,property_type:te.projectType,status:"sale",location:te.location||te.area||"",latitude:te.latitude||null,longitude:te.longitude||null,state:te.state||null,additional_address:te.fullAddress||null,description:te.description,price:v,area:1,project_type:"upcoming",upcoming_project_data:{builderName:te.builderName||B,projectStatus:te.projectStatus,startingPrice:te.startingPrice||null,reraNumber:te.reraNumber||null,configurations:te.configurations,carpetAreaRange:te.carpetAreaRange||null,numberOfTowers:te.numberOfTowers||null,totalUnits:te.totalUnits||null,floorsCount:te.floorsCount||null,unitsPerFloor:te.unitsPerFloor||null,numberOfVillas:te.numberOfVillas||null,numberOfPlots:te.numberOfPlots||null,bedCapacity:te.bedCapacity||null,loadingDocks:te.loadingDocks||null,pricePerSqft:te.pricePerSqft||null,bookingAmount:te.bookingAmount||null,expectedLaunchDate:te.expectedLaunchDate||null,expectedPossessionDate:te.expectedPossessionDate||null,reraStatus:te.reraStatus||null,landOwnershipType:te.landOwnershipType||null,bankApproved:te.bankApproved||null,approvedBanks:(()=>{const e=[...te.approvedBanks||[]].filter(e=>"Other"!==e);if(te.otherBankName&&te.otherBankName.trim()){const t=te.otherBankName.split(",").map(e=>e.trim()).filter(e=>e);e.push(...t)}return e})(),salesPersons:(te.salesPersons||[]).filter(e=>{var t,r,n;return(null===(t=e.name)||void 0===t?void 0:t.trim())||(null===(r=e.number)||void 0===r?void 0:r.trim())||(null===(n=e.email)||void 0===n?void 0:n.trim())}).map(e=>{var t,r,n;return{name:e.name||null,number:e.number||null,email:e.email||null,landlineNumber:(null===(t=e.landlineNumber)||void 0===t?void 0:t.trim())||null,whatsappNumber:(null===(r=e.whatsappNumber)||void 0===r?void 0:r.trim())||null,alternativeNumber:(null===(n=e.alternativeNumber)||void 0===n?void 0:n.trim())||null}}),salesName:(null===(e=te.salesPersons)||void 0===e||null===(t=e[0])||void 0===t?void 0:t.name)||null,salesNumber:(null===(r=te.salesPersons)||void 0===r||null===(n=r[0])||void 0===n?void 0:n.number)||null,emailId:(null===(s=te.salesPersons)||void 0===s||null===(o=s[0])||void 0===o?void 0:o.email)||null,landlineNumber:(null===(a=te.salesPersons)||void 0===a||null===(l=a[0])||void 0===l||null===(c=l.landlineNumber)||void 0===c?void 0:c.trim())||te.landlineNumber||null,whatsappNumber:(null===(p=te.salesPersons)||void 0===p||null===(m=p[0])||void 0===m||null===(y=m.whatsappNumber)||void 0===y?void 0:y.trim())||te.whatsappNumber||null,alternativeNumber:(null===(_=te.salesPersons)||void 0===_||null===(x=_[0])||void 0===x||null===(w=x.alternativeNumber)||void 0===w?void 0:w.trim())||te.alternativeNumber||null,projectHighlights:te.projectHighlights||null,usp:te.usp||null,pincode:te.pincode||null,mapLink:te.mapLink||null},images:[],amenities:te.amenities||[]};let N;if(g&&d&&d.id)try{console.log("Updating upcoming project:",d.id,b);const e=await i.NY.update(d.id,b);if(!e.success)throw new Error(e.message||"Failed to update upcoming project");N=d.id,console.log("Upcoming project updated successfully:",N),f&&await f()}catch(U){var S,T,k,C,E,I;console.error("Upcoming project update failed - Full error:",U),console.error("Error details:",{message:U.message,status:U.status,errors:U.errors,data:U.data,response:U.response});let e="Failed to update project. Please try again.";if(U.message)e=U.message;else if(U.errors&&"object"===typeof U.errors){const t=Object.values(U.errors).join(", ");e="Validation failed: ".concat(t)}else if(null!==(S=U.data)&&void 0!==S&&S.errors&&"object"===typeof U.data.errors){const t=Object.values(U.data.errors).join(", ");e="Validation failed: ".concat(t)}else if(null!==(T=U.data)&&void 0!==T&&T.message)e=U.data.message;else if(null!==(k=U.response)&&void 0!==k&&null!==(C=k.data)&&void 0!==C&&C.errors){const t=Object.values(U.response.data.errors).join(", ");e="Validation failed: ".concat(t)}else null!==(E=U.response)&&void 0!==E&&null!==(I=E.data)&&void 0!==I&&I.message&&(e=U.response.data.message);throw console.error("Final error message:",e),new Error(e)}else{let e;try{console.log("Submitting property data:",b),e=await h(b),console.log("Property created successfully:",e)}catch(U){var P,M,R,F,O,z;console.error("Property creation failed - Full error:",U),console.error("Error details:",{message:U.message,status:U.status,errors:U.errors,data:U.data,response:U.response});let e="Failed to create project. Please try again.";if(U.message)e=U.message;else if(U.errors&&"object"===typeof U.errors){const t=Object.values(U.errors).join(", ");e="Validation failed: ".concat(t)}else if(null!==(P=U.data)&&void 0!==P&&P.errors&&"object"===typeof U.data.errors){const t=Object.values(U.data.errors).join(", ");e="Validation failed: ".concat(t)}else if(null!==(M=U.data)&&void 0!==M&&M.message)e=U.data.message;else if(null!==(R=U.response)&&void 0!==R&&null!==(F=R.data)&&void 0!==F&&F.errors){const t=Object.values(U.response.data.errors).join(", ");e="Validation failed: ".concat(t)}else null!==(O=U.response)&&void 0!==O&&null!==(z=O.data)&&void 0!==z&&z.message&&(e=U.response.data.message);throw console.error("Final error message:",e),new Error(e)}if(!e||!e.id)throw new Error("Failed to get project ID after creation.");N=e.id}const q=D.filter(e=>"approved"===e.status);if(q.length>0){j(!0);try{const e=q.map(async(e,t)=>{try{console.log("Uploading image ".concat(t+1,"/").concat(q.length,":"),e.file.name);const r=await i.NY.uploadImage(e.file,N);if(console.log("Image ".concat(t+1," upload response:"),r),r.success&&r.data){const e=r.data.image_url||r.data.url;if(e)return{success:!0,url:e}}return{success:!1,error:r.message||"Upload failed - no URL returned"}}catch(U){return console.error("Image ".concat(t+1," upload error:"),U),{success:!1,error:U.message||U.status||"Upload failed",details:U}}}),t=await Promise.all(e),r=t.filter(e=>e.success),n=t.filter(e=>!e.success);if(console.log("Image upload results: ".concat(r.length," successful, ").concat(n.length," failed")),n.length>0){console.warn("Failed image uploads:",n);const e=n.map((e,t)=>"Image ".concat(t+1,": ").concat(e.error)).join("; ");console.warn("Some images failed to upload: ".concat(e))}0===r.length&&q.length>0&&console.warn("All images failed to upload, but project was created successfully")}catch(V){console.error("Image upload batch error:",V)}finally{j(!1)}}else L.length>0&&console.warn("No approved images found. Project created without images.");j(!1),A(!0),alert(g?"Upcoming project updated successfully!":"Upcoming project published successfully! It is now visible to buyers."),f&&await f(),u()}catch(U){console.error("Project save error:",U),alert(U.message||"Failed to save project. Please try again.")}finally{b(!1),j(!1)}}else v(5)},disabled:x||N||((null===(r=te.projectImages)||void 0===r?void 0:r.length)||0)<2||((null===(n=te.projectImages)||void 0===n?void 0:n.length)||0)>20,style:{opacity:x||N||((null===(o=te.projectImages)||void 0===o?void 0:o.length)||0)<2||((null===(a=te.projectImages)||void 0===a?void 0:a.length)||0)>20?.6:1,cursor:x||N||((null===(l=te.projectImages)||void 0===l?void 0:l.length)||0)<2||((null===(c=te.projectImages)||void 0===c?void 0:c.length)||0)>20?"not-allowed":"pointer"},children:x?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("span",{className:"spinner"}),"Submitting..."]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Publish Project"]})})]})]})]})}),P&&(0,s.jsx)("div",{className:"location-picker-modal-overlay",onClick:e=>{e.target.classList.contains("location-picker-modal-overlay")&&M(!1)},children:(0,s.jsx)(Et,{initialLocation:te.latitude&&te.longitude?{latitude:parseFloat(te.latitude),longitude:parseFloat(te.longitude),fullAddress:te.location||te.fullAddress}:null,onLocationChange:e=>{const t=e.state||"",r=!!t;re(r=>(0,p.A)((0,p.A)({},r),{},{latitude:e.latitude.toString(),longitude:e.longitude.toString(),location:e.fullAddress||r.location||r.area,state:t})),W(r),M(!1),(S.location||S.area||S.state)&&T(e=>(0,p.A)((0,p.A)({},e),{},{location:null,area:null,state:null}))},onClose:()=>M(!1)})})]})}const Nr=t=>{let{onNavigate:r}=t;const o=(0,n.Zp)(),{user:a}=l(),{properties:c,inquiries:u,getStats:d,loading:h,error:m,inquiriesLoading:f,inquiriesError:g,refreshData:y}=lr(),[_,v]=(0,e.useState)(!1),[x,b]=(0,e.useState)(!1),[w,j]=(0,e.useState)(""),[S,T]=(0,e.useState)(0),[k,A]=(0,e.useState)([]),[C,E]=(0,e.useState)(!1);(0,e.useEffect)(()=>{const e=i.R2.getUser();if(e&&e.full_name){const t=e.full_name.split(" ");j(t[0]||"User")}else j("User")},[]),(0,e.useEffect)(()=>{const e=async()=>{try{const e=await i.S3.getStats();e.success&&e.data&&void 0!==e.data.views_percentage_change&&T(e.data.views_percentage_change)}catch(m){console.error("Error fetching views percentage:",m)}};e();const t=setInterval(e,3e5);return()=>clearInterval(t)},[]),(0,e.useEffect)(()=>{if(!a)return void A([]);const e=async()=>{try{E(!0);const e=(await(0,M.ix)(a.id)).filter(e=>e.receiverId===String(a.id)||e.receiverId===a.id);A(e),console.log("[AgentOverview] Loaded",e.length,"Firebase chat rooms")}catch(m){console.error("[AgentOverview] Error fetching chat rooms:",m),A([])}finally{E(!1)}};e();const t=setInterval(e,3e4);return()=>clearInterval(t)},[a]);const N=(0,e.useMemo)(()=>{const e=new Map;u.forEach(t=>{const r=t.conversationKey||"".concat(t.buyerId||"guest","_").concat(t.propertyId),n=e.get(r);if(n){const i=new Date(n.createdAt||0);new Date(t.createdAt||0)>i&&e.set(r,t)}else e.set(r,t)});const t=e.size;if(!a||!k.length)return t;return t+k.filter(t=>{const r="".concat(t.buyerId||"guest","_").concat(t.propertyId);return!e.has(r)}).length},[u,k,a]),I=(0,e.useMemo)(()=>{const e=new Map;u.forEach(t=>{const r=t.conversationKey||"".concat(t.buyerId||"guest","_").concat(t.propertyId),n=e.get(r);if(n){const i=new Date(n.createdAt||0);new Date(t.createdAt||0)>i&&e.set(r,t)}else e.set(r,t)});const t=Array.from(e.values()).filter(e=>"new"===e.status).length;if(!a||!k.length)return t;return t+k.filter(t=>{const r="".concat(t.buyerId||"guest","_").concat(t.propertyId);if(e.has(r))return!1;if(t.readStatus&&"object"===typeof t.readStatus){const e=t.readStatus[String(a.id)];return"new"===e||!e}return!0}).length},[u,k,a]),P=d(),L=(0,p.A)((0,p.A)({},P),{},{totalInquiries:N,newInquiries:I}),R=()=>{c.length>=10?alert("You can add maximum ".concat(10," properties.")):v(!0)},D=e=>{const t=parseFloat(e);return t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Cr"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lac"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(1),"K"):"\u20b9".concat(t)},F=e=>{const t=new Date(e),r=new Date-t,n=Math.floor(r/6e4),i=Math.floor(r/36e5),s=Math.floor(r/864e5);return n<60?"".concat(n,"m ago"):i<24?"".concat(i,"h ago"):s<7?"".concat(s,"d ago"):t.toLocaleDateString("en-IN",{day:"numeric",month:"short"})},O=u.filter(e=>"new"===e.status).slice(0,4);return(0,s.jsxs)("div",{className:"agent-overview",children:[(0,s.jsx)("div",{className:"agent-overview-header",children:(0,s.jsxs)("div",{className:"agent-overview-header-content",children:[(0,s.jsxs)("div",{className:"agent-overview-greeting",children:[(0,s.jsxs)("h1",{children:["Welcome Back, ",w,(0,s.jsx)("span",{style:{color:"red"},children:"\u2764\ufe0f"})]}),(0,s.jsx)("p",{className:"agent-overview-subtitle",children:h?"Loading dashboard...":"Here's what's happening with your properties today"})]}),(0,s.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(m||g)&&(0,s.jsx)("button",{onClick:y,title:"Refresh data",style:{padding:"8px 12px",background:"#f0f0f0",border:"1px solid #ddd",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},children:"\ud83d\udd04 Refresh"}),(0,s.jsxs)("button",{className:"agent-overview-add-btn",onClick:R,children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),(0,s.jsx)("span",{children:"Add New Property"})]}),(0,s.jsxs)("button",{className:"agent-overview-add-btn",onClick:()=>{c.length>=10?alert("You can add maximum ".concat(10," properties.")):b(!0)},children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),(0,s.jsx)("span",{children:"Add New project"})]})]})]})}),m&&(0,s.jsxs)("div",{style:{margin:"16px",padding:"12px",background:"#fee",border:"1px solid #fcc",borderRadius:"6px",color:"#c33"},children:["\u26a0\ufe0f ",m]}),g&&(0,s.jsxs)("div",{style:{margin:"16px",padding:"12px",background:"#fee",border:"1px solid #fcc",borderRadius:"6px",color:"#c33"},children:["\u26a0\ufe0f Inquiries: ",g]}),(0,s.jsxs)("div",{className:"agent-overview-stats-grid",children:[(0,s.jsxs)("div",{className:"agent-overview-stat-card agent-overview-stat-primary",children:[(0,s.jsx)("div",{className:"agent-overview-stat-icon-wrapper",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsxs)("div",{className:"agent-overview-stat-content",children:[(0,s.jsx)("span",{className:"agent-overview-stat-label",children:"Total Properties"}),(0,s.jsxs)("div",{className:"agent-overview-stat-value-row",children:[(0,s.jsx)("span",{className:"agent-overview-stat-value",children:L.totalProperties}),(0,s.jsx)("span",{className:"agent-overview-stat-badge agent-overview-badge-success",children:"Active"})]})]})]}),(0,s.jsxs)("div",{className:"agent-overview-stat-card",children:[(0,s.jsx)("div",{className:"agent-overview-stat-icon-wrapper agent-overview-icon-blue",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsxs)("div",{className:"agent-overview-stat-content",children:[(0,s.jsx)("span",{className:"agent-overview-stat-label",children:"Total Views"}),(0,s.jsxs)("div",{className:"agent-overview-stat-value-row",children:[(0,s.jsx)("span",{className:"agent-overview-stat-value",children:(z=L.totalViews,z>=1e3?"".concat((z/1e3).toFixed(1),"K"):z)}),0!==S&&(0,s.jsxs)("span",{className:"agent-overview-stat-change ".concat(S>=0?"agent-overview-change-positive":"agent-overview-change-negative"),children:[(0,s.jsx)("svg",{width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",children:S>=0?(0,s.jsx)("path",{d:"M18 15l-6-6-6 6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}):(0,s.jsx)("path",{d:"M6 9l6 6 6-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),Math.abs(S),"%"]})]})]})]}),(0,s.jsxs)("div",{className:"agent-overview-stat-card",children:[(0,s.jsx)("div",{className:"agent-overview-stat-icon-wrapper agent-overview-icon-green",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})})}),(0,s.jsxs)("div",{className:"agent-overview-stat-content",children:[(0,s.jsx)("span",{className:"agent-overview-stat-label",children:"Total Inquiries"}),(0,s.jsxs)("div",{className:"agent-overview-stat-value-row",children:[(0,s.jsx)("span",{className:"agent-overview-stat-value",children:L.totalInquiries}),L.newInquiries>0&&(0,s.jsxs)("span",{className:"agent-overview-stat-badge agent-overview-badge-warning",children:[L.newInquiries," New"]})]})]})]}),(0,s.jsxs)("div",{className:"agent-overview-stat-card",children:[(0,s.jsx)("div",{className:"agent-overview-stat-icon-wrapper agent-overview-icon-orange",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 2v4M12 18v4M4.93 4.93l2.83 2.83M16.24 16.24l2.83 2.83M2 12h4M18 12h4M4.93 19.07l2.83-2.83M16.24 7.76l2.83-2.83",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"agent-overview-stat-content",children:[(0,s.jsx)("span",{className:"agent-overview-stat-label",children:"Listing Status"}),(0,s.jsxs)("div",{className:"agent-overview-status-pills",children:[(0,s.jsxs)("span",{className:"agent-overview-status-pill agent-overview-pill-sale",children:[L.forSale," Sale"]}),(0,s.jsxs)("span",{className:"agent-overview-status-pill agent-overview-pill-rent",children:[L.forRent," Rent"]})]})]})]})]}),(0,s.jsxs)("div",{className:"agent-overview-quick-actions",children:[(0,s.jsx)("h2",{className:"agent-overview-section-title",children:"Quick Actions"}),(0,s.jsxs)("div",{className:"agent-overview-actions-grid",children:[(0,s.jsxs)("button",{className:"agent-overview-action-card",onClick:R,children:[(0,s.jsx)("div",{className:"agent-overview-action-icon agent-overview-action-add",children:(0,s.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsx)("span",{className:"agent-overview-action-title",children:"Add New Property"}),(0,s.jsx)("span",{className:"agent-overview-action-desc",children:"List a new property for sale or rent"})]}),(0,s.jsxs)("button",{className:"agent-overview-action-card",onClick:()=>r&&r("properties"),children:[(0,s.jsx)("div",{className:"agent-overview-action-icon agent-overview-action-manage",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"agent-overview-action-title",children:"Manage Properties"}),(0,s.jsx)("span",{className:"agent-overview-action-desc",children:"Edit, update or remove listings"})]}),(0,s.jsxs)("button",{className:"agent-overview-action-card",onClick:()=>r&&r("inquiries"),children:[(0,s.jsx)("div",{className:"agent-overview-action-icon agent-overview-action-inquiries",children:(0,s.jsx)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 11.5a8.38 8.38 0 01-.9 3.8 8.5 8.5 0 01-7.6 4.7 8.38 8.38 0 01-3.8-.9L3 21l1.9-5.7a8.38 8.38 0 01-.9-3.8 8.5 8.5 0 014.7-7.6 8.38 8.38 0 013.8-.9h.5a8.48 8.48 0 018 8v.5z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsx)("span",{className:"agent-overview-action-title",children:"View Inquiries"}),(0,s.jsx)("span",{className:"agent-overview-action-desc",children:"Respond to buyer inquiries"})]}),(0,s.jsxs)("button",{className:"agent-overview-action-card",onClick:()=>r&&r("profile"),children:[(0,s.jsx)("div",{className:"agent-overview-action-icon agent-overview-action-profile",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"agent-overview-action-title",children:"Update Profile"}),(0,s.jsx)("span",{className:"agent-overview-action-desc",children:"Manage your account settings"})]}),(0,s.jsxs)("button",{type:"button",className:"agent-overview-action-card agent-leads-stat-btn",onClick:()=>o("/agent-dashboard/inquiries"),title:"View leads from buyers who viewed your contact details",children:[(0,s.jsx)("div",{className:"agent-overview-action-icon agent-overview-action-leads",children:(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"agent-overview-action-title",children:"Leads"}),(0,s.jsx)("span",{className:"agent-overview-action-desc",children:"View leads from buyers who viewed your contact details"})]})]})]}),(0,s.jsxs)("div",{className:"agent-overview-content-grid",children:[(0,s.jsxs)("div",{className:"agent-overview-properties-section",children:[(0,s.jsxs)("div",{className:"agent-overview-section-header",children:[(0,s.jsx)("h2",{className:"agent-overview-section-title",children:"Your Properties"}),(0,s.jsxs)("button",{className:"agent-overview-view-all-btn",onClick:()=>r&&r("properties"),children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]})]}),(0,s.jsx)("div",{className:"agent-overview-properties-list",children:h&&0===c.length?(0,s.jsxs)("div",{className:"agent-overview-loading-state",children:[(0,s.jsx)("div",{className:"agent-overview-loading-spinner"}),(0,s.jsx)("h3",{children:"Loading Properties..."}),(0,s.jsx)("p",{children:"Please wait while we fetch your properties"})]}):0===c.length?(0,s.jsxs)("div",{className:"agent-overview-empty-state",children:[(0,s.jsx)("div",{className:"agent-overview-empty-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("path",{d:"M9 22V12h6v10",stroke:"currentColor",strokeWidth:"1.5"})]})}),(0,s.jsx)("h3",{children:"No Properties Listed"}),(0,s.jsx)("p",{children:"Start by adding your first property"}),(0,s.jsx)("button",{className:"agent-overview-empty-action-btn",onClick:R,children:"Add Property"})]}):c.slice(0,3).map((e,t)=>(0,s.jsxs)("div",{className:"agent-overview-property-item",style:{animationDelay:"".concat(.1*t,"s"),cursor:"pointer"},onClick:()=>window.open("/agent-dashboard/details/".concat(e.id),"_blank","noopener,noreferrer"),children:[(0,s.jsxs)("div",{className:"agent-overview-property-thumbnail",children:[(0,s.jsx)("img",{src:(t=>{const r=e.display_image||(null===(t=e.images)||void 0===t?void 0:t[0])||e.cover_image;return r?r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?"".concat(q.JR.replace("/api","")).concat(r):"".concat(q.JR.replace("/api",""),"/uploads/").concat(r):"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"})(),alt:e.title,onError:t=>{console.error("Image load failed for property:",e.id,"URL:",t.target.src),t.target.src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"}}),(0,s.jsx)("span",{className:"agent-overview-property-badge ".concat("sale"===e.status?"agent-overview-badge-sale":"agent-overview-badge-rent"),children:"sale"===e.status?"For Sale":"For Rent"})]}),(0,s.jsxs)("div",{className:"agent-overview-property-info",children:[(0,s.jsx)("h4",{className:"agent-overview-property-title",children:e.title}),(0,s.jsxs)("p",{className:"agent-overview-property-location",children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.location]}),(0,s.jsxs)("div",{className:"agent-overview-property-stats",children:[(0,s.jsxs)("span",{className:"agent-overview-property-stat-item",children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.views||0]}),(0,s.jsxs)("span",{className:"agent-overview-property-stat-item",children:[(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),e.inquiries||0]})]})]}),(0,s.jsxs)("div",{className:"agent-overview-property-price",children:[(0,s.jsx)("span",{className:"agent-overview-price",children:D(e.price)}),"rent"===e.status&&(0,s.jsx)("span",{className:"agent-overview-per-month",children:"/month"})]})]},e.id))})]}),(0,s.jsxs)("div",{className:"agent-overview-inquiries-section",children:[(0,s.jsxs)("div",{className:"agent-overview-section-header",children:[(0,s.jsxs)("h2",{className:"agent-overview-section-title",children:["Recent Inquiries",L.newInquiries>0&&(0,s.jsx)("span",{className:"agent-overview-title-badge",children:L.newInquiries})]}),(0,s.jsxs)("button",{className:"agent-overview-view-all-btn",onClick:()=>r&&r("inquiries"),children:["View All",(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M5 12h14M12 5l7 7-7 7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})]})]}),(0,s.jsx)("div",{className:"agent-overview-inquiries-list",children:f&&0===u.length?(0,s.jsxs)("div",{className:"agent-overview-empty-state agent-overview-empty-small",style:{padding:"30px 20px"},children:[(0,s.jsx)("div",{className:"agent-overview-loading-spinner",style:{width:"32px",height:"32px",borderWidth:3,margin:"0 auto 10px"}}),(0,s.jsx)("p",{children:"Loading inquiries..."})]}):0===O.length?(0,s.jsx)("div",{className:"agent-overview-empty-state agent-overview-empty-small",children:(0,s.jsx)("p",{children:"No new inquiries"})}):O.map((e,t)=>(0,s.jsxs)("div",{className:"agent-overview-inquiry-item",style:{animationDelay:"".concat(.1*t,"s"),cursor:"pointer"},onClick:()=>{o("/agent-dashboard/inquiries?inquiryId=".concat(e.id))},children:[(0,s.jsx)("div",{className:"agent-overview-inquiry-avatar",children:e.buyerProfileImage?(0,s.jsx)("img",{src:e.buyerProfileImage,alt:e.buyerName}):e.avatar&&"string"===typeof e.avatar&&(e.avatar.startsWith("http://")||e.avatar.startsWith("https://"))?(0,s.jsx)("img",{src:e.avatar,alt:e.buyerName}):e.avatar||(e.buyerName?e.buyerName.charAt(0).toUpperCase():"U")}),(0,s.jsxs)("div",{className:"agent-overview-inquiry-content",children:[(0,s.jsxs)("div",{className:"agent-overview-inquiry-header",children:[(0,s.jsx)("span",{className:"agent-overview-inquiry-name",children:e.buyerName}),(0,s.jsx)("span",{className:"agent-overview-inquiry-time",children:F(e.createdAt)})]}),(0,s.jsx)("p",{className:"agent-overview-inquiry-property",children:e.propertyTitle}),(0,s.jsx)("p",{className:"agent-overview-inquiry-message",children:e.message})]})]},e.id))})]})]}),_&&(0,s.jsx)(yr,{onClose:()=>v(!1)}),x&&(0,s.jsx)(Er,{onClose:()=>b(!1)})]});var z},Ir=[{value:"UNDER CONSTRUCTION",label:"Under Construction"},{value:"PRE-LAUNCH",label:"Pre-Launch"},{value:"COMPLETED",label:"Completed"}],Pr=()=>{(0,n.Zp)();const{properties:t,deleteProperty:r,loading:o,error:a,refreshData:l}=lr(),[c,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)(!1),[m,f]=(0,e.useState)(null),[g,y]=(0,e.useState)(null),[_,v]=(0,e.useState)("all"),[x,b]=(0,e.useState)("newest"),[w,j]=(0,e.useState)(""),[S,T]=(0,e.useState)(null),[k,A]=(0,e.useState)(!1),[C,E]=(0,e.useState)(null),[N,I]=(0,e.useState)(null),P=t.filter(e=>{const t="all"===_||e.status===_,r=e.title.toLowerCase().includes(w.toLowerCase())||e.location.toLowerCase().includes(w.toLowerCase());return t&&r}).sort((e,t)=>{switch(x){case"newest":return new Date(t.createdAt)-new Date(e.createdAt);case"oldest":return new Date(e.createdAt)-new Date(t.createdAt);case"price-high":return parseFloat(t.price)-parseFloat(e.price);case"price-low":return parseFloat(e.price)-parseFloat(t.price);default:return 0}}),M=P.filter(e=>!e.projectType||"upcoming"!==e.projectType),L=P.filter(e=>"upcoming"===e.projectType),R=e=>{const r=t[e];r&&"upcoming"===r.projectType?(y(r),h(!0),u(!1)):(f(e),y(null),u(!0),h(!1))},D=e=>{E(e),A(!0)},F=async(e,r)=>{const n=t.find(t=>t.id===e);if(!n||"upcoming"!==n.projectType)return;let s=n.upcomingProjectData;if("string"===typeof s)try{s=JSON.parse(s)}catch(c){s={}}s&&"object"===typeof s||(s={});const o=(0,p.A)((0,p.A)({},s),{},{projectStatus:r});try{I(e);const t=await i.NY.update(e,{upcoming_project_data:o});if(!t.success||!l)throw new Error(t.message||"Failed to update status");await l()}catch(a){console.error("Error updating project status:",a),alert(a.message||"Failed to update project status. Please try again.")}finally{I(null)}},O=e=>{const t=e.upcomingProjectData;if(!t)return"UNDER CONSTRUCTION";return("string"===typeof t?(()=>{try{return JSON.parse(t)}catch(e){return{}}})():t).projectStatus||"UNDER CONSTRUCTION"},z=e=>{const t=parseFloat(e);return t>=1e7?"\u20b9".concat((t/1e7).toFixed(2)," Cr"):t>=1e5?"\u20b9".concat((t/1e5).toFixed(2)," Lac"):t>=1e3?"\u20b9".concat((t/1e3).toFixed(1),"K"):"\u20b9".concat(t)},B=e=>t.findIndex(t=>t.id===e),U=e=>{console.log("Navigating to property:",e);const r=t.find(t=>t.id===e);console.log("Found property:",r),console.log("Property projectType:",null===r||void 0===r?void 0:r.projectType),console.log("Is upcoming?",r&&"upcoming"===r.projectType),r&&"upcoming"===r.projectType?(console.log("Navigating to upcoming project view"),window.open("/agent-dashboard/upcoming-project/".concat(e),"_blank","noopener,noreferrer")):(console.log("Navigating to regular property view"),window.open("/agent-dashboard/details/".concat(e),"_blank","noopener,noreferrer"))},V=e=>{const t=[],r=e.propertyType||"";return["Apartment","Flat","Villa","Independent House","Row House","Penthouse","Farm House"].includes(r)?(e.bedrooms&&t.push({label:"".concat(e.bedrooms," Beds"),icon:"bed"}),e.bathrooms&&t.push({label:"".concat(e.bathrooms," Baths"),icon:"bath"}),e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"}),e.floor&&e.totalFloors&&t.push({label:"Floor ".concat(e.floor,"/").concat(e.totalFloors),icon:"floor"}),e.furnishing&&t.push({label:e.furnishing,icon:"furnishing"}),e.balconies&&t.push({label:"".concat(e.balconies," Balconies"),icon:"balcony"})):"Studio Apartment"===r?(e.bathrooms&&t.push({label:"".concat(e.bathrooms," Baths"),icon:"bath"}),e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"}),e.floor&&e.totalFloors&&t.push({label:"Floor ".concat(e.floor,"/").concat(e.totalFloors),icon:"floor"}),e.furnishing&&t.push({label:e.furnishing,icon:"furnishing"}),e.balconies&&t.push({label:"".concat(e.balconies," Balconies"),icon:"balcony"})):"Commercial Office"===r?(e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"}),e.floor&&e.totalFloors&&t.push({label:"Floor ".concat(e.floor,"/").concat(e.totalFloors),icon:"floor"}),e.furnishing&&t.push({label:e.furnishing,icon:"furnishing"}),e.bathrooms&&t.push({label:"".concat(e.bathrooms," Baths"),icon:"bath"})):"Commercial Shop"===r?(e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"}),e.floor&&e.totalFloors&&t.push({label:"Floor ".concat(e.floor,"/").concat(e.totalFloors),icon:"floor"}),e.facing&&t.push({label:e.facing,icon:"facing"})):"Plot / Land"===r?(e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"}),e.facing&&t.push({label:e.facing,icon:"facing"})):"PG / Hostel"===r?(e.bedrooms&&t.push({label:"".concat(e.bedrooms," Beds"),icon:"bed"}),e.bathrooms&&t.push({label:"".concat(e.bathrooms," Baths"),icon:"bath"}),e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"}),e.floor&&e.totalFloors&&t.push({label:"Floor ".concat(e.floor,"/").concat(e.totalFloors),icon:"floor"})):(e.bedrooms&&t.push({label:"".concat(e.bedrooms," Beds"),icon:"bed"}),e.bathrooms&&t.push({label:"".concat(e.bathrooms," Baths"),icon:"bath"}),e.area&&t.push({label:"".concat(e.area," sqft"),icon:"area"})),t};return(0,s.jsxs)("div",{className:"seller-properties",children:[(0,s.jsx)("div",{className:"seller-props-header",children:(0,s.jsxs)("div",{className:"seller-props-header-content",children:[(0,s.jsxs)("div",{children:[(0,s.jsx)("h1",{children:"My Properties"}),(0,s.jsx)("p",{className:"seller-props-subtitle",children:o?"Loading...":"".concat(t.length," properties listed")})]}),(0,s.jsxs)("div",{className:"seller-props-header-buttons",children:[(0,s.jsxs)("button",{className:"seller-props-add-btn",onClick:()=>{f(null),y(null),u(!0),h(!1)},children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Add Property"]}),(0,s.jsxs)("button",{className:"seller-props-add-btn",onClick:()=>{y(null),h(!0),u(!1)},children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M12 5v14M5 12h14",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),(0,s.jsx)("span",{children:"Add New project"})]})]})]})}),(0,s.jsxs)("div",{className:"seller-props-toolbar",children:[(0,s.jsxs)("div",{className:"seller-props-search-box",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Search properties...",value:w,onChange:e=>j(e.target.value)})]}),(0,s.jsx)("div",{className:"seller-props-toolbar-actions",children:(0,s.jsxs)("div",{className:"seller-props-filter-group",children:[(0,s.jsxs)("select",{value:_,onChange:e=>v(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Status"}),(0,s.jsx)("option",{value:"sale",children:"For Sale"}),(0,s.jsx)("option",{value:"rent",children:"For Rent"})]}),(0,s.jsxs)("select",{value:x,onChange:e=>b(e.target.value),children:[(0,s.jsx)("option",{value:"newest",children:"Newest First"}),(0,s.jsx)("option",{value:"oldest",children:"Oldest First"}),(0,s.jsx)("option",{value:"price-high",children:"Price: High to Low"}),(0,s.jsx)("option",{value:"price-low",children:"Price: Low to High"})]})]})})]}),(0,s.jsxs)("div",{className:"agent-props-sections",children:[(0,s.jsxs)("div",{className:"agent-props-section",children:[(0,s.jsx)("h2",{className:"agent-props-section-heading",children:"Properties"}),0===M.length?(0,s.jsx)("div",{className:"agent-props-empty-message",children:(0,s.jsx)("p",{children:"No properties found"})}):(0,s.jsx)("div",{className:"agent-props-horizontal-scroll",children:M.map((e,t)=>(0,s.jsxs)("div",{className:"seller-props-card grid",style:{animationDelay:"".concat(.05*t,"s"),cursor:"pointer",flexShrink:0},onClick:()=>U(e.id),children:[(0,s.jsxs)("div",{className:"seller-props-image",children:[(0,s.jsx)("img",{src:(t=>{const r=e.display_image||(null===(t=e.images)||void 0===t?void 0:t[0])||e.cover_image;return r?r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?"".concat(q.JR.replace("/api","")).concat(r):"".concat(q.JR.replace("/api",""),"/uploads/").concat(r):"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"})(),alt:e.title,onError:t=>{console.error("Image load failed for property:",e.id,"URL:",t.target.src),t.target.src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"}}),(0,s.jsxs)("div",{className:"seller-props-image-overlay",children:[(0,s.jsx)("button",{className:"seller-props-overlay-btn",onClick:t=>{t.stopPropagation(),R(B(e.id))},children:(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{className:"seller-props-overlay-btn delete",onClick:t=>{t.stopPropagation(),D(e.id)},disabled:S===e.id,title:S===e.id?"Deleting...":"Delete property",children:S===e.id?(0,s.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #fff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.6s linear infinite",display:"inline-block"}}):(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6",stroke:"currentColor",strokeWidth:"2"})})})]}),(0,s.jsx)("span",{className:"seller-props-badge ".concat(e.status),children:"sale"===e.status?"For Sale":"For Rent"}),"upcoming"===e.projectType&&(0,s.jsx)("select",{className:"seller-props-project-status-select",value:O(e),onChange:t=>{t.stopPropagation(),F(e.id,t.target.value)},onClick:e=>e.stopPropagation(),disabled:N===e.id,title:"Change project status",children:Ir.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),e.featured&&(0,s.jsx)("span",{className:"seller-props-featured-badge",children:"Featured"})]}),(0,s.jsxs)("div",{className:"seller-props-content",children:[(0,s.jsx)("h3",{className:"seller-props-title",children:e.title}),(0,s.jsxs)("p",{className:"seller-props-location",children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.location]}),(0,s.jsx)("div",{className:"seller-props-features",children:V(e).slice(0,3).map((e,t)=>(0,s.jsxs)("span",{className:"seller-props-feature",children:["bed"===e.icon&&(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 22V8l9-6 9 6v14H3z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M9 22v-6h6v6",stroke:"currentColor",strokeWidth:"2"})]}),"bath"===e.icon&&(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 12h16v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M6 12V5a2 2 0 012-2h2v9",stroke:"currentColor",strokeWidth:"2"})]}),"area"===e.icon&&(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M3 9h18M9 21V9",stroke:"currentColor",strokeWidth:"2"})]}),e.label]},t))}),(0,s.jsxs)("div",{className:"seller-props-stats",children:[(0,s.jsxs)("div",{className:"seller-props-stat-item",title:"".concat(e.views||0," people showed interest in this property"),children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsxs)("span",{children:[e.views||0," ",1===e.views?"person":"people"," interested"]})]}),(0,s.jsxs)("div",{className:"seller-props-stat-item",children:[(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsxs)("span",{children:[e.inquiries||0," inquiries"]})]})]}),(0,s.jsxs)("div",{className:"seller-props-footer",children:[(0,s.jsxs)("div",{className:"seller-props-price-section",children:[(0,s.jsx)("span",{className:"seller-props-price",children:z(e.price)}),"rent"===e.status&&(0,s.jsx)("span",{className:"seller-props-per-month",children:"/month"})]}),(0,s.jsxs)("div",{className:"seller-props-action-btns",children:[(0,s.jsxs)("button",{className:"seller-props-view-details-btn",onClick:t=>{t.stopPropagation(),U(e.id)},title:"View Details",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),"View"]}),(0,s.jsxs)("button",{className:"seller-props-edit-btn",onClick:t=>{t.stopPropagation(),R(B(e.id))},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]}),"Edit"]}),(0,s.jsxs)("button",{className:"seller-props-delete-btn",onClick:t=>{t.stopPropagation(),D(e.id)},children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6",stroke:"currentColor",strokeWidth:"2"})}),"Delete"]})]})]})]})]},e.id))})]}),(0,s.jsxs)("div",{className:"agent-props-section",children:[(0,s.jsx)("h2",{className:"agent-props-section-heading",children:"Projects"}),0===L.length?(0,s.jsx)("div",{className:"agent-props-empty-message",children:(0,s.jsx)("p",{children:"No upcoming projects found"})}):(0,s.jsx)("div",{className:"agent-props-horizontal-scroll",children:L.map((e,t)=>(0,s.jsxs)("div",{className:"seller-props-card grid",style:{animationDelay:"".concat(.05*t,"s"),cursor:"pointer",flexShrink:0},onClick:()=>U(e.id),children:[(0,s.jsxs)("div",{className:"seller-props-image",children:[(0,s.jsx)("img",{src:(t=>{const r=e.display_image||(null===(t=e.images)||void 0===t?void 0:t[0])||e.cover_image;return r?r.startsWith("http://")||r.startsWith("https://")?r:r.startsWith("/")?"".concat(q.JR.replace("/api","")).concat(r):"".concat(q.JR.replace("/api",""),"/uploads/").concat(r):"https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"})(),alt:e.title,onError:t=>{console.error("Image load failed for property:",e.id,"URL:",t.target.src),t.target.src="https://images.unsplash.com/photo-1600596542815-ffad4c1539a9?w=500"}}),(0,s.jsxs)("div",{className:"seller-props-image-overlay",children:[(0,s.jsx)("button",{className:"seller-props-overlay-btn",onClick:t=>{t.stopPropagation(),R(B(e.id))},children:(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{className:"seller-props-overlay-btn delete",onClick:t=>{t.stopPropagation(),D(e.id)},disabled:S===e.id,title:S===e.id?"Deleting...":"Delete property",children:S===e.id?(0,s.jsx)("div",{style:{width:"16px",height:"16px",border:"2px solid #fff",borderTop:"2px solid transparent",borderRadius:"50%",animation:"spin 0.6s linear infinite",display:"inline-block"}}):(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6",stroke:"currentColor",strokeWidth:"2"})})})]}),(0,s.jsx)("span",{className:"seller-props-badge ".concat(e.status),children:"sale"===e.status?"For Sale":"For Rent"}),"upcoming"===e.projectType&&(0,s.jsx)("select",{className:"seller-props-project-status-select",value:O(e),onChange:t=>{t.stopPropagation(),F(e.id,t.target.value)},onClick:e=>e.stopPropagation(),disabled:N===e.id,title:"Change project status",children:Ir.map(e=>(0,s.jsx)("option",{value:e.value,children:e.label},e.value))}),e.featured&&(0,s.jsx)("span",{className:"seller-props-featured-badge",children:"Featured"})]}),(0,s.jsxs)("div",{className:"seller-props-content",children:[(0,s.jsx)("h3",{className:"seller-props-title",children:e.title}),(0,s.jsxs)("p",{className:"seller-props-location",children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),e.location]}),(0,s.jsx)("div",{className:"seller-props-features",children:V(e).slice(0,3).map((e,t)=>(0,s.jsxs)("span",{className:"seller-props-feature",children:["bed"===e.icon&&(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 22V8l9-6 9 6v14H3z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M9 22v-6h6v6",stroke:"currentColor",strokeWidth:"2"})]}),"bath"===e.icon&&(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 12h16v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M6 12V5a2 2 0 012-2h2v9",stroke:"currentColor",strokeWidth:"2"})]}),"area"===e.icon&&(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"18",height:"18",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M3 9h18M9 21V9",stroke:"currentColor",strokeWidth:"2"})]}),e.label]},t))}),(0,s.jsxs)("div",{className:"seller-props-stats",children:[(0,s.jsxs)("div",{className:"seller-props-stat-item",title:"".concat(e.views||0," people showed interest in this property"),children:[(0,s.jsxs)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsxs)("span",{children:[e.views||0," ",1===e.views?"person":"people"," interested"]})]}),(0,s.jsxs)("div",{className:"seller-props-stat-item",children:[(0,s.jsx)("svg",{width:"14",height:"14",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsxs)("span",{children:[e.inquiries||0," inquiries"]})]})]}),(0,s.jsxs)("div",{className:"seller-props-footer",children:[(0,s.jsxs)("div",{className:"seller-props-price-section",children:[(0,s.jsx)("span",{className:"seller-props-price",children:z(e.price)}),"rent"===e.status&&(0,s.jsx)("span",{className:"seller-props-per-month",children:"/month"})]}),(0,s.jsxs)("div",{className:"seller-props-action-btns",children:[(0,s.jsxs)("button",{className:"seller-props-view-details-btn",onClick:t=>{t.stopPropagation(),U(e.id)},title:"View Details",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),"View"]}),(0,s.jsxs)("button",{className:"seller-props-edit-btn",onClick:t=>{t.stopPropagation(),R(B(e.id))},children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M11 4H4a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2v-7",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M18.5 2.5a2.121 2.121 0 013 3L12 15l-4 1 1-4 9.5-9.5z",stroke:"currentColor",strokeWidth:"2"})]}),"Edit"]}),(0,s.jsxs)("button",{className:"seller-props-delete-btn",onClick:t=>{t.stopPropagation(),D(e.id)},children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M3 6h18M8 6V4a2 2 0 012-2h4a2 2 0 012 2v2M19 6v14a2 2 0 01-2 2H7a2 2 0 01-2-2V6",stroke:"currentColor",strokeWidth:"2"})}),"Delete"]})]})]})]})]},e.id))})]})]}),c&&(0,s.jsx)(yr,{onClose:()=>{u(!1),f(null),y(null)},editIndex:m,initialData:null!==m?t[m]:null}),d&&(0,s.jsx)(Er,{onClose:()=>{h(!1),y(null)},editData:g}),(0,s.jsx)(Gt.A,{isOpen:k,onClose:()=>{A(!1),E(null)},onConfirm:async()=>{if(C)try{T(C),await r(C),E(null)}catch(a){console.error("Error deleting property:",a),alert(a.message||"Failed to delete property. Please try again.")}finally{T(null)}}})]})},Mr=t=>{let{onUnreadCountChange:r}=t;const o=(0,n.zy)(),a=(0,n.Zp)(),{inquiries:c,properties:u,updateInquiryStatus:d,inquiriesLoading:h,inquiriesError:m,refreshData:f}=lr(),{user:g}=l(),[y,_]=(0,e.useState)(null),[v,x]=(0,e.useState)("all"),[b,w]=(0,e.useState)("all"),[j,S]=(0,e.useState)(""),[T,k]=(0,e.useState)(""),[A,C]=(0,e.useState)(!1),[E,N]=(0,e.useState)(""),[I,P]=(0,e.useState)({}),[L,R]=(0,e.useState)({}),[D,F]=(0,e.useState)("details"),[O,z]=(0,e.useState)(null),[B,U]=(0,e.useState)(null),[V,q]=(0,e.useState)([]),[W,H]=(0,e.useState)([]),[G,Z]=(0,e.useState)(!1),K=(0,e.useRef)(null),Y=(0,e.useRef)(null),X=(0,e.useRef)(null),J=Array.isArray(c)?c:[],Q=Array.isArray(u)?u:[],$=(0,e.useMemo)(()=>{if(!g)return 0;let e=0;return Object.keys(I).forEach(t=>{const r=I[t]||[];if(!Array.isArray(r)||0===r.length)return;if((null===y||void 0===y?void 0:y.id)===t&&"chat"===D)return;const n=r.filter(e=>!e.id||!e.id.toString().startsWith("initial-"));if(0===n.length)return;const i=L[t];if(i){const t=i.toDate?i.toDate():new Date(i),r=n.filter(e=>{if("buyer"!==e.sender)return!1;return new Date(e.timestamp)>t}).length;e+=r}else{const t=n.filter(e=>"buyer"===e.sender);e+=t.length}}),e},[I,L,y,D,g]);(0,e.useEffect)(()=>{r&&r($)},[$,r]),(0,e.useEffect)(()=>{if(!y||!O||!g)return void console.log("\u23f8\ufe0f Agent: Listener not starting - missing requirements:",{hasInquiry:!!y,hasChatRoomId:!!O,chatRoomId:O,hasUser:!!g});console.log("\u25b6\ufe0f Agent: Starting message listener for chat room:",O,"inquiry:",y.id);(async()=>{try{const e=await(0,M.getChatRoomDetails)(O);if(e&&e.lastReadAt&&e.lastReadAt[String(g.id)]){const t=e.lastReadAt[String(g.id)];R(e=>(0,p.A)((0,p.A)({},e),{},{[y.id]:t})),console.log("\ud83d\udcd6 Agent: Loaded lastReadAt for inquiry:",y.id,t)}}catch(e){console.warn("\u26a0\ufe0f Agent: Failed to fetch chat room details for lastReadAt:",e)}})();const e=(0,M.dP)(O,(e,t)=>{if(t)return void console.error("\u274c Error in agent chat listener:",t);if(!e||!Array.isArray(e))return void console.error("\u274c Error in agent chat listener: Invalid messages received");console.log("\ud83d\udce8 Agent: Received",e.length,"messages for inquiry:",y.id);const r=e.map((e,t)=>{var r;let n;n=e.timestamp instanceof Date?e.timestamp:e.timestamp?new Date(e.timestamp):new Date;const i="agent"===e.senderRole?"agent":"buyer";return console.log("  Message ".concat(t+1,": ").concat(i," (role: ").concat(e.senderRole,') - "').concat(null===(r=e.text)||void 0===r?void 0:r.substring(0,50),'..."')),{id:e.id||"".concat(y.id,"-").concat(n.getTime(),"-").concat(t,"-").concat(Math.random()),text:e.text||"",sender:i,timestamp:n.toISOString()}});P(e=>{const t=(0,p.A)((0,p.A)({},e),{},{[y.id]:r});return console.log("\ud83d\udcbe Agent: Updated chatMessages for inquiry:",y.id,"Total messages:",r.length),t})});return()=>{console.log("\ud83d\udd0c Agent: Cleaning up listener for chat room:",O),e&&"function"===typeof e&&e()}},[y,O,g]),(0,e.useEffect)(()=>{if(!g||!V.length)return;(async()=>{const e={};for(const n of V)if(n.chatRoomId)try{var t;const r=await(0,M.getChatRoomDetails)(n.chatRoomId);null!==r&&void 0!==r&&null!==(t=r.lastReadAt)&&void 0!==t&&t[String(g.id)]&&(e[n.id]=r.lastReadAt[String(g.id)])}catch(r){console.warn("Failed to load lastReadAt for inquiry ".concat(n.id,":"),r)}R(t=>(0,p.A)((0,p.A)({},t),e))})()},[g,V]),(0,e.useEffect)(()=>{if(y&&"chat"===D&&O&&g){const e=y.id,t=I[e]||[];if(Array.isArray(t)&&t.length>0){const t=new Date;R(r=>(0,p.A)((0,p.A)({},r),{},{[e]:t})),(0,M.BR)(O,g.id,"read").then(()=>(0,M.getChatRoomDetails)(O)).then(t=>{if(t&&t.lastReadAt&&t.lastReadAt[String(g.id)]){const r=t.lastReadAt[String(g.id)];R(t=>(0,p.A)((0,p.A)({},t),{},{[e]:r}))}}).catch(e=>{console.warn("Failed to sync lastReadAt from Firebase:",e)})}}},[y,D,I,O,g]),(0,e.useEffect)(()=>{var e;null===(e=K.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},[I,y,D]),(0,e.useEffect)(()=>{if(!y||!g||!O)return;if("new"===y.status&&("chat"===D||I[y.id]&&I[y.id].length>0)){(async()=>{try{await(0,M.BR)(O,g.id,"read"),_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null),q(e=>e.map(e=>e.id===y.id||e.conversationKey===y.conversationKey||e.buyerId===y.buyerId&&e.propertyId===y.propertyId?(0,p.A)((0,p.A)({},e),{},{status:"read",firebaseReadStatus:"read"}):e));try{await d(y.id,"read")}catch(e){console.warn("Failed to update MySQL status, but Firebase status updated:",e)}}catch(t){console.error("Failed to mark inquiry as read:",t)}})()}},[y,D,I,g,O,d]),(0,e.useEffect)(()=>{if(y){const e=V.find(e=>e.id===y.id||e.conversationKey===y.conversationKey||e.buyerId===y.buyerId&&e.propertyId===y.propertyId);e&&(e.status===y.status&&e.lastMessage===y.lastMessage&&e.buyerName===y.buyerName&&e.buyerProfileImage===y.buyerProfileImage||_(e))}},[V,null===y||void 0===y?void 0:y.id,null===y||void 0===y?void 0:y.conversationKey]),(0,e.useEffect)(()=>{if(!g)return void q(J);(async()=>{try{const e=await(0,M.ix)(g.id);console.log("[AgentInquiries] Loaded",e.length,"Firebase chat rooms");const t=new Map;J.forEach(e=>{const r=e.conversationKey||"".concat(e.buyerId||"guest","_").concat(e.propertyId),n=t.get(r);if(n){const i=new Date(n.createdAt||0);new Date(e.createdAt||0)>i&&t.set(r,e)}else t.set(r,e)});const r=new Map;J.forEach(e=>{e.buyerId&&(r.has(e.buyerId)||r.set(e.buyerId,{buyerName:e.buyerName,buyerEmail:e.buyerEmail,buyerPhone:e.buyerPhone,buyerProfileImage:e.buyerProfileImage,avatar:e.avatar}))});const n=new Map;e.forEach(e=>{const t="".concat(e.buyerId,"_").concat(e.propertyId);n.set(t,e)});const s=Array.from(t.values()),o=new Map;V.forEach(e=>{const t=e.conversationKey||"".concat(e.buyerId||"guest","_").concat(e.propertyId);o.set(t,e)});const a=s.map(e=>{const t=e.conversationKey||"".concat(e.buyerId||"guest","_").concat(e.propertyId),r=n.get(t),i=o.get(t);if(r){let t=e.status;if(r.readStatus&&"object"===typeof r.readStatus&&g){const e=r.readStatus[String(g.id)];e&&(t=e)}return i&&"replied"===i.status&&"replied"!==t&&(t="replied"),(0,p.A)((0,p.A)({},e),{},{lastMessage:r.lastMessage||e.message,lastActivity:r.updatedAt?new Date(r.updatedAt):new Date(e.createdAt),chatRoomId:r.id,firebaseReadStatus:t,status:t})}const s=i&&"replied"===i.status?"replied":e.status;return(0,p.A)((0,p.A)({},e),{},{lastMessage:e.message,lastActivity:new Date(e.createdAt),status:s,firebaseReadStatus:s})}),l=[],c=[];e.forEach(e=>{const n="".concat(e.buyerId,"_").concat(e.propertyId),s=t.has(n),o=a.some(t=>(t.conversationKey||"".concat(t.buyerId||"guest","_").concat(t.propertyId))===n||t.buyerId===e.buyerId&&t.propertyId===e.propertyId);if(s||o){const r=t.get(n),i=a.findIndex(t=>(t.conversationKey||"".concat(t.buyerId||"guest","_").concat(t.propertyId))===n||t.buyerId===e.buyerId&&t.propertyId===e.propertyId);i>=0&&r&&(a[i]=(0,p.A)((0,p.A)({},a[i]),{},{buyerName:r.buyerName||a[i].buyerName,buyerEmail:r.buyerEmail||a[i].buyerEmail,buyerPhone:r.buyerPhone||a[i].buyerPhone,buyerProfileImage:r.buyerProfileImage||a[i].buyerProfileImage,avatar:r.buyerProfileImage||r.avatar||a[i].avatar}))}else{const t=Q.find(t=>t.id===parseInt(e.propertyId));e.receiverId===String(g.id)||e.receiverId===g.id?(c.push({room:e,conversationKey:n,property:t}),!r.has(e.buyerId)&&e.buyerId&&l.push(i.r7.getBuyer(e.buyerId).then(t=>{var n;if(t.success&&null!==(n=t.data)&&void 0!==n&&n.buyer){var i,s;const n=t.data.buyer;r.set(e.buyerId,{buyerName:n.name||"Buyer",buyerEmail:n.email||"",buyerPhone:n.phone||"",buyerProfileImage:n.profile_image||null,avatar:n.profile_image||(null===(i=n.name)||void 0===i||null===(s=i[0])||void 0===s?void 0:s.toUpperCase())||"B"})}}).catch(t=>{console.warn("Failed to fetch buyer info for buyerId ".concat(e.buyerId,":"),t)}))):console.warn("[AgentInquiries] Chat room receiverId mismatch:",{roomId:e.id,roomReceiverId:e.receiverId,currentUserId:g.id,roomBuyerId:e.buyerId,roomPropertyId:e.propertyId})}}),await Promise.all(l),c.forEach(e=>{var t;let{room:n,conversationKey:i,property:s}=e,l="new";if(n.readStatus&&"object"===typeof n.readStatus&&g){const e=n.readStatus[String(g.id)];e&&(l=e)}const c=o.get(i);c&&"replied"===c.status&&"replied"!==l&&(l="replied");const u=r.get(n.buyerId),d=(null===u||void 0===u?void 0:u.buyerName)||"Buyer",h=(null===u||void 0===u?void 0:u.buyerEmail)||"",p=(null===u||void 0===u?void 0:u.buyerPhone)||"",m=(null===u||void 0===u?void 0:u.buyerProfileImage)||null,f=m||(null===u||void 0===u?void 0:u.avatar)||(null===(t=d[0])||void 0===t?void 0:t.toUpperCase())||"B";a.push({id:"chat_".concat(n.id),conversationKey:i,propertyId:n.propertyId,buyerId:n.buyerId,propertyTitle:(null===s||void 0===s?void 0:s.title)||"Property",buyerName:d,buyerEmail:h,buyerPhone:p,buyerProfileImage:m,message:n.lastMessage||"",status:l,createdAt:n.createdAt?n.createdAt instanceof Date?n.createdAt:new Date(n.createdAt):new Date,avatar:f,lastMessage:n.lastMessage||"",lastActivity:n.updatedAt?n.updatedAt instanceof Date?n.updatedAt:new Date(n.updatedAt):new Date,chatRoomId:n.id,firebaseReadStatus:l,isChatOnly:!0})}),a.forEach((e,t)=>{if(e.isChatOnly&&e.buyerId){const i=r.get(e.buyerId);var n;if(i&&"Buyer"!==i.buyerName)a[t]=(0,p.A)((0,p.A)({},e),{},{buyerName:i.buyerName,buyerEmail:i.buyerEmail,buyerPhone:i.buyerPhone,buyerProfileImage:i.buyerProfileImage,avatar:i.buyerProfileImage||i.avatar||(null===(n=i.buyerName[0])||void 0===n?void 0:n.toUpperCase())||"B"})}}),a.sort((e,t)=>{const r=e.lastActivity instanceof Date?e.lastActivity:new Date(e.lastActivity);return(t.lastActivity instanceof Date?t.lastActivity:new Date(t.lastActivity))-r}),q(a)}catch(e){console.error("[AgentInquiries] Error enriching inquiries:",e),q(J)}})()},[J,Q,g]),(0,e.useEffect)(()=>{if(!g)return;(async()=>{Z(!0);try{var e;const t=await i.BZ.list();t.success&&null!==(e=t.data)&&void 0!==e&&e.leads?H(t.data.leads):H([])}catch(t){console.warn("Failed to fetch leads:",t),H([])}finally{Z(!1)}})()},[g]);const ee=V.filter(e=>{if(!e)return!1;const t="all"===v||e.status===v,r="all"===b||e.propertyId===parseInt(b),n=j.toLowerCase(),i=(e.buyerName||"").toLowerCase(),s=(e.message||"").toLowerCase(),o=(e.propertyTitle||"").toLowerCase(),a=i.includes(n)||s.includes(n)||o.includes(n);return t&&r&&a}),te=(0,e.useMemo)(()=>({total:V.length,new:V.filter(e=>e&&("new"===e.status||"new"===e.firebaseReadStatus)).length,read:V.filter(e=>e&&("read"===e.status||"read"===e.firebaseReadStatus)).length,replied:V.filter(e=>e&&("replied"===e.status||"replied"===e.firebaseReadStatus)).length}),[V]),re=e=>{if(!e)return"Unknown time";try{const t=new Date(e);if(isNaN(t.getTime()))return"Invalid date";const r=new Date-t,n=Math.floor(r/6e4),i=Math.floor(r/36e5),s=Math.floor(r/864e5);return n<1?"Just now":n<60?"".concat(n," min ago"):i<24?"".concat(i," hours ago"):s<7?"".concat(s," days ago"):t.toLocaleDateString("en-IN",{day:"numeric",month:"short",year:"numeric"})}catch(t){return console.error("Error formatting date:",t),"Invalid date"}},ne=async e=>{if(!e||!e.id)return void console.error("Invalid inquiry selected:",e);let t=e.chatRoomId||null;if(!t&&g&&e.buyerId&&e.propertyId&&(t=(0,M.generateChatRoomId)(e.buyerId,g.id,e.propertyId)),z(t),t&&g)try{const r=await(0,M.Wj)(t,g.id);r.status&&r.status!==e.status&&(e=(0,p.A)((0,p.A)({},e),{},{status:r.status}))}catch(r){console.warn("Failed to get Firebase status, using inquiry status:",r)}if(_(e),F("details"),"new"===e.status&&t&&g)try{_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null),await(0,M.BR)(t,g.id,"read"),q(t=>t.map(t=>t.id===e.id||t.conversationKey===e.conversationKey||t.buyerId===e.buyerId&&t.propertyId===e.propertyId?(0,p.A)((0,p.A)({},t),{},{status:"read",firebaseReadStatus:"read"}):t));try{await d(e.id,"read")}catch(n){console.warn("Failed to update MySQL status, but Firebase status updated:",n)}_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null)}catch(r){console.error("Failed to mark inquiry as read in Firebase:",r),_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"new"}):null)}};(0,e.useEffect)(()=>{const e=new URLSearchParams(o.search).get("inquiryId");if(e&&V.length>0&&!y){const t=parseInt(e,10),r=V.find(e=>e.id===t);if(r){ne(r);const e=new URLSearchParams(o.search);e.delete("inquiryId");const t=e.toString();a(o.pathname+(t?"?".concat(t):""),{replace:!0})}}},[V.length,o.search]);const ie=async()=>{if(!E.trim()||!y||!g)return void console.warn("\u26a0\ufe0f Cannot send message - missing data:",{hasMessage:!!E.trim(),hasInquiry:!!y,hasUser:!!g});if(!y.buyerId||!y.propertyId)return void alert("Buyer or property information not available for chat.");const e=E.trim();N("");try{U(y.id),console.log("\ud83d\udce4 Agent: Creating/getting chat room before sending message...");const n=await(0,M.createOrGetChatRoom)(y.buyerId,g.id,"agent",y.propertyId);console.log("\ud83d\udce4 Agent: Chat room ID:",n),n!==O&&(console.log("\ud83d\udd04 Agent: Updating selectedChatRoomId to:",n),z(n)),console.log("\ud83d\udce4 Agent: Sending message to Firebase..."),await(0,M._z)(n,g.id,"agent",e),console.log("\u2705 Agent: Message sent successfully");try{await(0,M.BR)(n,g.id,"replied");const e=await(0,M.getChatRoomDetails)(n);let r="replied";if(e&&e.readStatus&&"object"===typeof e.readStatus&&g){const t=e.readStatus[String(g.id)];t&&(r=t)}_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:r}):null),q(e=>e.map(e=>e.id===y.id||e.conversationKey===y.conversationKey||e.buyerId===y.buyerId&&e.propertyId===y.propertyId?(0,p.A)((0,p.A)({},e),{},{status:r,firebaseReadStatus:r}):e));try{await d(y.id,"replied")}catch(t){console.warn("Failed to update MySQL status, but Firebase status updated:",t)}}catch(r){console.error("Failed to mark inquiry as replied:",r)}P(t=>{const r=t[y.id]||[],n=new Date,i={id:"temp-".concat(n.getTime()),text:e,sender:"agent",timestamp:n.toISOString()},s=(0,p.A)((0,p.A)({},t),{},{[y.id]:[...r,i]});return console.log("\ud83d\udcbe Agent: Optimistically added message to state"),s})}catch(r){console.error("\u274c Error sending chat message:",r),N(e),alert(r.message||"Failed to send message. Please try again.")}finally{U(null)}},se=e=>{let t=e.status||"new";if(e.firebaseReadStatus&&"string"===typeof e.firebaseReadStatus)t=e.firebaseReadStatus;else if(e.firebaseReadStatus&&"object"===typeof e.firebaseReadStatus&&g){const r=e.firebaseReadStatus[String(g.id)];r&&(t=r)}const r={new:{label:"New",class:"new"},read:{label:"Read",class:"read"},replied:{label:"Replied",class:"replied"},contacted:{label:"Contacted",class:"replied"},interested:{label:"Interested",class:"replied"},not_interested:{label:"Not Interested",class:"read"},closed:{label:"Closed",class:"read"}};return r[t]||r.new};return(0,s.jsxs)("div",{className:"agent-inquiries",children:[(0,s.jsxs)("div",{className:"inquiries-header",children:[(0,s.jsxs)("div",{className:"header-content",children:[(0,s.jsx)("h1",{children:"Property Inquiries"}),(0,s.jsx)("p",{className:"subtitle",children:h?"Loading inquiries...":"Manage and respond to buyer inquiries"})]}),m&&(0,s.jsxs)("div",{style:{marginTop:"10px",padding:"10px",background:"#fee",border:"1px solid #fcc",borderRadius:"6px",color:"#c33",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,s.jsxs)("span",{children:["\u26a0\ufe0f ","string"===typeof m?m:(null===m||void 0===m?void 0:m.message)||"An error occurred"]}),(0,s.jsx)("button",{onClick:f,style:{padding:"6px 12px",background:"#fff",border:"1px solid #ddd",borderRadius:"4px",cursor:"pointer",marginLeft:"10px"},children:"\ud83d\udd04 Refresh"})]})]}),(0,s.jsxs)("div",{className:"inquiry-stats",children:[(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-icon total",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})})}),(0,s.jsxs)("div",{className:"stat-info",children:[(0,s.jsx)("span",{className:"stat-value",children:te.total}),(0,s.jsx)("span",{className:"stat-label",children:"Total Inquiries"})]})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-icon new",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"stat-info",children:[(0,s.jsx)("span",{className:"stat-value",children:te.new}),(0,s.jsx)("span",{className:"stat-label",children:"New / Pending"})]})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-icon read",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"3",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsxs)("div",{className:"stat-info",children:[(0,s.jsx)("span",{className:"stat-value",children:te.read}),(0,s.jsx)("span",{className:"stat-label",children:"Read"})]})]}),(0,s.jsxs)("div",{className:"stat-card",children:[(0,s.jsx)("div",{className:"stat-icon replied",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M9 10l-5 5 5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M20 4v7a4 4 0 01-4 4H4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"stat-info",children:[(0,s.jsx)("span",{className:"stat-value",children:te.replied}),(0,s.jsx)("span",{className:"stat-label",children:"Replied"})]})]}),(0,s.jsxs)("button",{type:"button",className:"agent-stat-card agent-leads-stat-btn",onClick:()=>{var e;null===(e=X.current)||void 0===e||e.scrollIntoView({behavior:"smooth"})},title:"View leads from buyers who viewed your contact details",children:[(0,s.jsx)("div",{className:"agent-stat-icon agent-leads",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M16 21v-2a4 4 0 00-4-4H5a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"8.5",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M20 8v6M23 11h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsxs)("div",{className:"agent-stat-info",children:[(0,s.jsx)("span",{className:"agent-stat-value",children:G?"\u2014":W.length}),(0,s.jsx)("span",{className:"agent-stat-label",children:"Leads"})]})]})]}),(0,s.jsxs)("div",{ref:X,className:"agent-leads-section",children:[(0,s.jsx)("h2",{className:"agent-leads-heading",children:"Leads"}),G?(0,s.jsx)("div",{className:"agent-leads-loading",children:"Loading leads..."}):0===W.length?(0,s.jsx)("div",{className:"agent-leads-empty",children:(0,s.jsx)("p",{children:"No leads yet. Leads will appear when buyers view your contact details."})}):(0,s.jsx)("ol",{className:"agent-leads-list",children:W.map((e,t)=>(0,s.jsx)("li",{className:"agent-lead-item",children:(0,s.jsxs)("div",{className:"agent-leads-grid",children:[(0,s.jsx)("span",{className:"agent-leads-property-title",children:e.property_title||"Property"}),(0,s.jsx)("span",{className:"agent-leads-separator",children:"|"}),(0,s.jsx)("span",{className:"agent-leads-buyer-name",children:e.buyer_name||"Buyer"}),(0,s.jsx)("span",{className:"agent-leads-separator",children:"|"}),(0,s.jsx)("span",{className:"agent-leads-phone",children:e.buyer_phone?(0,s.jsx)("a",{href:"tel:".concat(e.buyer_phone),className:"agent-leads-link",children:e.buyer_phone}):(0,s.jsx)("span",{className:"agent-leads-empty-text",children:"\u2014"})}),(0,s.jsx)("span",{className:"agent-leads-separator",children:"|"}),(0,s.jsx)("span",{className:"agent-leads-email",children:e.buyer_email?(0,s.jsx)("a",{href:"mailto:".concat(e.buyer_email),className:"agent-leads-link",children:e.buyer_email}):(0,s.jsx)("span",{className:"agent-leads-empty-text",children:"\u2014"})}),(0,s.jsx)("span",{className:"agent-leads-separator",children:"|"}),(0,s.jsx)("span",{className:"agent-leads-timestamp",children:e.created_at?re(e.created_at):"\u2014"})]})},"".concat(e.buyer_id,"-").concat(e.property_id,"-").concat(t)))})]}),(0,s.jsxs)("div",{className:"filters-section",children:[(0,s.jsxs)("div",{className:"search-box",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"11",cy:"11",r:"8",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M21 21l-4.35-4.35",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsx)("input",{type:"text",placeholder:"Search inquiries...",value:j,onChange:e=>S(e.target.value)})]}),(0,s.jsxs)("div",{className:"filter-group",children:[(0,s.jsxs)("select",{value:v,onChange:e=>x(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Status"}),(0,s.jsx)("option",{value:"new",children:"New"}),(0,s.jsx)("option",{value:"read",children:"Read"}),(0,s.jsx)("option",{value:"replied",children:"Replied"})]}),(0,s.jsxs)("select",{value:b,onChange:e=>w(e.target.value),children:[(0,s.jsx)("option",{value:"all",children:"All Properties"}),Q.map(e=>e&&(0,s.jsx)("option",{value:e.id,children:(e.title||"Unknown Property").toUpperCase()},e.id))]})]})]}),(0,s.jsxs)("div",{className:"inquiries-container",children:[(0,s.jsx)("div",{className:"inquiries-list",children:h&&0===V.length?(0,s.jsxs)("div",{className:"loading-state",children:[(0,s.jsx)("div",{className:"loading-spinner"}),(0,s.jsx)("h3",{children:"Loading Inquiries..."}),(0,s.jsx)("p",{children:"Please wait while we fetch your inquiries"})]}):0===ee.length?(0,s.jsxs)("div",{className:"empty-state",children:[(0,s.jsx)("div",{className:"empty-icon",children:(0,s.jsx)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"1.5"})})}),(0,s.jsx)("h3",{children:"No Inquiries Found"}),(0,s.jsx)("p",{children:j||"all"!==v||"all"!==b?"Try adjusting your filters":"You haven't received any inquiries yet"})]}):ee.map((e,t)=>(0,s.jsxs)("div",{className:"inquiry-card ".concat((null===y||void 0===y?void 0:y.id)===e.id?"selected":""," ").concat("new"===e.status?"unread":""),onClick:()=>ne(e),style:{animationDelay:"".concat(.05*t,"s"),opacity:B===e.id?.6:1,pointerEvents:B===e.id?"none":"auto"},children:[(0,s.jsx)("div",{className:"inquiry-avatar",children:e.avatar}),(0,s.jsxs)("div",{className:"inquiry-content",children:[(0,s.jsxs)("div",{className:"inquiry-header",children:[(0,s.jsx)("span",{className:"inquiry-name",children:e.buyerName||"Unknown Buyer"}),(0,s.jsx)("span",{className:"inquiry-time",children:re(e.lastActivity||e.createdAt)})]}),(0,s.jsx)("p",{className:"inquiry-property",children:e.propertyTitle||"Unknown Property"}),(0,s.jsx)("p",{className:"inquiry-preview",children:e.lastMessage||e.message||"No message"})]}),(0,s.jsx)("div",{className:"inquiry-status",children:(0,s.jsx)("span",{className:"status-badge ".concat(se(e).class),children:se(e).label})})]},e.id))}),(0,s.jsx)("div",{className:"inquiry-detail ".concat(y?"active":""),children:y?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsxs)("div",{className:"detail-header",children:[(0,s.jsx)("button",{className:"back-btn-mobile",onClick:()=>_(null),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M19 12H5M12 19l-7-7 7-7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})}),(0,s.jsxs)("div",{className:"detail-user",children:[(0,s.jsx)("div",{className:"detail-avatar",children:y.avatar}),(0,s.jsxs)("div",{className:"detail-user-info",children:[(0,s.jsx)("h3",{children:y.buyerName||"Unknown Buyer"}),(0,s.jsx)("span",{className:"status-badge ".concat(se(y||{status:"new"}).class),children:se(y||{status:"new"}).label})]})]})]}),(0,s.jsxs)("div",{className:"detail-body",children:[(0,s.jsxs)("div",{className:"detail-tabs",children:[(0,s.jsxs)("button",{className:"tab-btn ".concat("details"===D?"active":""),onClick:()=>F("details"),children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M14 2v6h6M16 13H8M16 17H8M10 9H8",stroke:"currentColor",strokeWidth:"2"})]}),"Details"]}),(0,s.jsxs)("button",{className:"tab-btn ".concat("chat"===D?"active":""),onClick:()=>{(async e=>{if(F(e),"chat"===e&&y&&"new"===y.status&&O&&g)try{await(0,M.BR)(O,g.id,"read"),_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"read"}):null),q(e=>e.map(e=>e.id===y.id||e.conversationKey===y.conversationKey||e.buyerId===y.buyerId&&e.propertyId===y.propertyId?(0,p.A)((0,p.A)({},e),{},{status:"read",firebaseReadStatus:"read"}):e));try{await d(y.id,"read")}catch(t){console.warn("Failed to update MySQL status, but Firebase status updated:",t)}}catch(r){console.error("Failed to mark inquiry as read on tab switch:",r)}})("chat")},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})}),"Live Chat",(()=>{const e=null===y||void 0===y?void 0:y.id;if(!e||!g)return null;const t=(I[e]||[]).filter(e=>!e.id||!e.id.toString().startsWith("initial-")),r=L[e];let n=0;if(r){const e=r.toDate?r.toDate():new Date(r);n=t.filter(t=>{if("buyer"!==t.sender)return!1;return new Date(t.timestamp)>e}).length}else n=t.filter(e=>"buyer"===e.sender).length;return n>0?(0,s.jsx)("span",{className:"chat-badge",children:n}):null})()]})]}),"details"===D?(0,s.jsxs)("div",{className:"details-content",children:[(0,s.jsxs)("div",{className:"property-info-card",children:[(0,s.jsx)("h4",{children:"Property Inquiry"}),(0,s.jsx)("p",{className:"property-name",children:y.propertyTitle||"Unknown Property"})]}),(0,s.jsxs)("div",{className:"contact-info-card",children:[(0,s.jsx)("h4",{children:"Contact Information"}),(0,s.jsxs)("div",{className:"contact-item",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M22 6l-10 7L2 6",stroke:"currentColor",strokeWidth:"2"})]}),y.buyerEmail?(0,s.jsx)("a",{href:"mailto:".concat(y.buyerEmail),children:y.buyerEmail}):(0,s.jsx)("span",{children:"No email provided"})]}),(0,s.jsxs)("div",{className:"contact-item",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),y.buyerPhone?(0,s.jsx)("a",{href:"tel:".concat(y.buyerPhone),children:y.buyerPhone}):(0,s.jsx)("span",{children:"No phone provided"})]})]}),(0,s.jsxs)("div",{className:"message-card",children:[(0,s.jsx)("h4",{children:"Message"}),(0,s.jsxs)("div",{className:"message-content",children:[(0,s.jsx)("p",{children:y.message||"No message provided"}),(0,s.jsx)("span",{className:"message-time",children:re(y.createdAt)})]})]})]}):(0,s.jsxs)("div",{className:"chat-container",children:[(0,s.jsxs)("div",{className:"chat-messages",children:[(!I[y.id]||0===I[y.id].length)&&(0,s.jsxs)("div",{className:"chat-message buyer",children:[(0,s.jsx)("div",{className:"message-avatar",children:y.avatar||"U"}),(0,s.jsxs)("div",{className:"message-bubble",children:[(0,s.jsxs)("div",{className:"message-header",children:[(0,s.jsx)("span",{className:"message-sender",children:y.buyerName||"Unknown Buyer"}),(0,s.jsx)("span",{className:"message-timestamp",children:re(y.createdAt)})]}),(0,s.jsx)("p",{children:y.message||"No message provided"})]})]}),(I[y.id]||[]).map((e,t)=>{const r=y.id,n=L[r];let i=!1;if(n){const t=n.toDate?n.toDate():new Date(n),r=new Date(e.timestamp);i="buyer"===e.sender&&r>t}else i="buyer"===e.sender;return(0,s.jsxs)("div",{className:"chat-message ".concat(e.sender," ").concat(i?"unread":""),children:["buyer"===e.sender&&(0,s.jsx)("div",{className:"message-avatar",children:y.avatar||"U"}),(0,s.jsxs)("div",{className:"message-bubble",children:[(0,s.jsxs)("div",{className:"message-header",children:[(0,s.jsx)("span",{className:"message-sender",children:"agent"===e.sender?"You":y.buyerName||"Unknown Buyer"}),(0,s.jsx)("span",{className:"message-timestamp",children:re(e.timestamp)})]}),(0,s.jsx)("p",{children:e.text||""})]}),"agent"===e.sender&&(0,s.jsx)("div",{className:"message-avatar agent-avatar",children:"A"})]},e.id)}),I[y.id]&&0===I[y.id].length&&(0,s.jsxs)("div",{className:"chat-empty",children:[(0,s.jsx)("div",{className:"chat-empty-icon",children:(0,s.jsxs)("svg",{width:"48",height:"48",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"1.5"}),(0,s.jsx)("circle",{cx:"9",cy:"10",r:"1",fill:"currentColor"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"1",fill:"currentColor"}),(0,s.jsx)("circle",{cx:"15",cy:"10",r:"1",fill:"currentColor"})]})}),(0,s.jsxs)("h4",{children:["Start chatting with ",y.buyerName||"the buyer"]}),(0,s.jsx)("p",{children:"Send a message to begin the conversation"})]}),(0,s.jsx)("div",{ref:K})]}),(0,s.jsx)("div",{className:"chat-input-wrapper",children:(0,s.jsxs)("div",{className:"chat-input-container",children:[(0,s.jsx)("input",{type:"file",ref:Y,onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];if(r){console.log("File selected:",r.name);const t={id:Date.now(),text:"\ud83d\udcce ".concat(r.name),sender:"agent",timestamp:(new Date).toISOString(),type:"file"};P(e=>(0,p.A)((0,p.A)({},e),{},{[y.id]:[...e[y.id]||[],t]}));try{if(O&&g){await(0,M.BR)(O,g.id,"replied");const e=await(0,M.getChatRoomDetails)(O);let t="replied";if(e&&e.readStatus&&"object"===typeof e.readStatus&&g){const r=e.readStatus[String(g.id)];r&&(t=r)}_(e=>e?(0,p.A)((0,p.A)({},e),{},{status:t}):null),q(e=>e.map(e=>e.id===y.id||e.conversationKey===y.conversationKey||e.buyerId===y.buyerId&&e.propertyId===y.propertyId?(0,p.A)((0,p.A)({},e),{},{status:t,firebaseReadStatus:t}):e))}else _(e=>e?(0,p.A)((0,p.A)({},e),{},{status:"replied"}):null);try{await d(y.id,"replied")}catch(n){console.warn("Failed to update MySQL status, but Firebase status updated:",n)}}catch(i){console.error("Failed to mark inquiry as replied:",i)}e.target.value=""}},style:{display:"none"},accept:"image/*,.pdf,.doc,.docx"}),(0,s.jsx)("button",{className:"attach-btn",title:"Attach file",onClick:()=>{var e;null===(e=Y.current)||void 0===e||e.click()},children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21.44 11.05l-9.19 9.19a6 6 0 01-8.49-8.49l9.19-9.19a4 4 0 015.66 5.66l-9.2 9.19a2 2 0 01-2.83-2.83l8.49-8.48",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("input",{type:"text",className:"chat-input",placeholder:"Type your message...",value:E,onChange:e=>N(e.target.value),onKeyPress:e=>{"Enter"!==e.key||e.shiftKey||(e.preventDefault(),ie())}}),(0,s.jsx)("button",{className:"send-message-btn",onClick:ie,disabled:!E.trim(),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]})})]})]}),"details"===D&&(0,s.jsxs)("div",{className:"detail-footer",children:[(0,s.jsxs)("button",{className:"reply-btn primary",onClick:()=>C(!0),children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M9 10l-5 5 5 5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M20 4v7a4 4 0 01-4 4H4",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Reply via Email"]}),y.buyerPhone?(0,s.jsxs)("a",{href:"tel:".concat(y.buyerPhone),className:"call-btn",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),"Call Now"]}):(0,s.jsxs)("button",{className:"call-btn",disabled:!0,title:"No phone number available",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),"Call Now"]})]})]}):(0,s.jsxs)("div",{className:"no-selection",children:[(0,s.jsx)("div",{className:"no-selection-icon",children:(0,s.jsx)("svg",{width:"64",height:"64",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"1.5"})})}),(0,s.jsx)("h3",{children:"Select an Inquiry"}),(0,s.jsx)("p",{children:"Choose an inquiry from the list to view details and respond"})]})})]}),A&&(0,s.jsx)("div",{className:"modal-overlay",onClick:()=>C(!1),children:(0,s.jsxs)("div",{className:"reply-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"modal-header",children:[(0,s.jsxs)("h3",{children:["Reply to ",null===y||void 0===y?void 0:y.buyerName]}),(0,s.jsx)("button",{className:"close-btn",onClick:()=>C(!1),children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsxs)("div",{className:"modal-body",children:[(0,s.jsxs)("div",{className:"reply-to-info",children:[(0,s.jsxs)("span",{children:["To: ",null===y||void 0===y?void 0:y.buyerEmail]}),(0,s.jsxs)("span",{children:["RE: ",null===y||void 0===y?void 0:y.propertyTitle]})]}),(0,s.jsx)("textarea",{placeholder:"Type your reply here...",value:T,onChange:e=>k(e.target.value),rows:6})]}),(0,s.jsxs)("div",{className:"modal-footer",children:[(0,s.jsx)("button",{className:"cancel-btn",onClick:()=>C(!1),children:"Cancel"}),(0,s.jsxs)("button",{className:"send-btn",onClick:async()=>{if(T.trim()&&y)try{U(y.id),await d(y.id,"replied"),k(""),C(!1)}catch(e){console.error("Error updating inquiry status:",e),alert("Failed to update inquiry status. Please try again.")}finally{U(null)}},children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})}),"Send Reply"]})]})]})})]})},Lr=()=>{const{getStats:t}=lr(),[r,n]=(0,e.useState)("personal"),[o,a]=(0,e.useState)(!1),[l,c]=(0,e.useState)(!1),[u,d]=(0,e.useState)(!1),[h,m]=(0,e.useState)(!0),[f,g]=(0,e.useState)(null),[y,_]=(0,e.useState)(!1),[v,x]=(0,e.useState)(!1),[b,w]=(0,e.useState)(!1),[j,S]=(0,e.useState)(null),[T,k]=(0,e.useState)("environment"),A=(0,e.useRef)(null),C=(0,e.useRef)(null),E=(0,e.useRef)(null),N=(0,e.useRef)(null),[I,P]=(0,e.useState)({firstName:"",lastName:"",email:"",phone:"",location:"",alternatePhone:"",whatsappNumber:"",alternateMobile:"",agencyName:"",agencyAddress:"",gstNumber:"",reraNumber:"",website:"",profileImage:""}),[M,L]=(0,e.useState)(null),[R,D]=(0,e.useState)(!1),[F,O]=(0,e.useState)(!1);(0,e.useEffect)(()=>{(async()=>{try{m(!0),g(null),D(!1);const e=await i.v5.get();if(e.success&&e.data&&e.data.profile){const t=e.data.profile,r=(t.full_name||"").split(" "),n=r[0]||"",i=r.slice(1).join(" ")||"",s=t.address?t.address.split(",")[0]+(t.address.split(",")[1]?", "+t.address.split(",")[1]:""):"";P({firstName:n,lastName:i,email:t.email||"",phone:t.phone||"",location:s,alternatePhone:"",whatsappNumber:t.whatsapp_number||"",alternateMobile:t.alternate_mobile||"",agencyName:t.company_name||"",agencyAddress:t.address||"",gstNumber:"",reraNumber:t.license_number||"",website:t.website||"",profileImage:t.profile_image||""}),t.created_at&&L(t.created_at),O(1===t.agent_verified||!0===t.agent_verified)}else{const e=i.R2.getUser();if(e){const t=(e.full_name||"").split(" ");P(r=>(0,p.A)((0,p.A)({},r),{},{firstName:t[0]||"",lastName:t.slice(1).join(" ")||"",email:e.email||"",phone:e.phone||"",profileImage:e.profile_image||""})),e.created_at&&L(e.created_at),void 0!==e.agent_verified&&O(1===e.agent_verified||!0===e.agent_verified)}}}catch(f){console.error("Error fetching profile:",f),g(f.message||"Failed to load profile data");const t=i.R2.getUser();if(t){const e=(t.full_name||"").split(" ");P(r=>(0,p.A)((0,p.A)({},r),{},{firstName:e[0]||"",lastName:e.slice(1).join(" ")||"",email:t.email||"",phone:t.phone||"",profileImage:t.profile_image||""})),t.created_at&&L(t.created_at),void 0!==t.agent_verified&&O(1===t.agent_verified||!0===t.agent_verified)}}finally{m(!1)}})()},[]);const z=e=>{const{name:t,value:r}=e.target;let n=r;"firstName"===t||"lastName"===t?n=r.toUpperCase():["address","agencyName","agencyAddress"].includes(t)&&(n=r),P((0,p.A)((0,p.A)({},I),{},{[t]:n}))},B=async()=>{try{a(!1),g(null);const e="".concat(I.firstName," ").concat(I.lastName).trim(),t=I.whatsappNumber?I.whatsappNumber.trim():"",r=I.alternateMobile?I.alternateMobile.trim():"",n={full_name:e,address:(I.agencyAddress||"").trim(),company_name:(I.agencyName||"").trim(),license_number:(I.reraNumber||"").trim(),website:(I.website||"").trim(),whatsapp_number:t,alternate_mobile:r},s=await i.v5.update(n);if(s.success){if(d(!0),setTimeout(()=>d(!1),3e3),s.data&&s.data.profile){const e=s.data.profile,t=(e.full_name||"").split(" ");P(r=>(0,p.A)((0,p.A)({},r),{},{firstName:t[0]||"",lastName:t.slice(1).join(" ")||"",email:e.email||r.email,phone:e.phone||r.phone,whatsappNumber:e.whatsapp_number||"",alternateMobile:e.alternate_mobile||""})),void 0!==e.agent_verified&&O(1===e.agent_verified||!0===e.agent_verified);const r=i.R2.getUser();if(r){const t=(0,p.A)((0,p.A)({},r),{},{full_name:e.full_name||r.full_name,email:e.email||r.email,phone:e.phone||r.phone,profile_image:e.profile_image||r.profile_image,address:e.address||r.address,company_name:e.company_name||r.company_name,agent_verified:void 0!==e.agent_verified?e.agent_verified:r.agent_verified});localStorage.setItem("userData",JSON.stringify(t)),window.dispatchEvent(new CustomEvent("userDataUpdated"))}}}else g(s.message||"Failed to update profile"),a(!0)}catch(f){console.error("Error updating profile:",f),g(f.message||"Failed to update profile. Please try again."),a(!0)}},U=()=>{E.current&&(E.current.getTracks().forEach(e=>e.stop()),E.current=null),C.current&&(C.current.srcObject=null),w(!1),S(null)},V=async e=>{if(e)if(e.type.startsWith("image/"))if(e.size>5242880)alert("Image size should be less than 5MB");else{_(!0),x(!1);try{const t=await i.v5.uploadProfileImage(e);if(t.success&&t.data&&t.data.url){P(e=>(0,p.A)((0,p.A)({},e),{},{profileImage:t.data.url})),D(!1),d(!0),setTimeout(()=>d(!1),3e3);const e=i.R2.getUser();if(e){const r=(0,p.A)((0,p.A)({},e),{},{profile_image:t.data.url});localStorage.setItem("userData",JSON.stringify(r)),window.dispatchEvent(new CustomEvent("userDataUpdated"))}}else alert(t.message||"Failed to upload image")}catch(f){console.error("Error uploading image:",f),alert(f.message||"Failed to upload image. Please try again.")}finally{_(!1),A.current&&(A.current.value="")}}else alert("Please select an image file")};(0,e.useEffect)(()=>{const e=e=>{v&&N.current&&!N.current.contains(e.target)&&x(!1)};return document.addEventListener("mousedown",e),document.addEventListener("click",e),()=>{document.removeEventListener("mousedown",e),document.removeEventListener("click",e)}},[v]),(0,e.useEffect)(()=>()=>{E.current&&(E.current.getTracks().forEach(e=>e.stop()),E.current=null),C.current&&(C.current.srcObject=null)},[]);return(0,s.jsxs)("div",{className:"agent-profile",children:[u&&(0,s.jsxs)("div",{className:"success-toast",children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2"})}),"Profile updated successfully!"]}),(0,s.jsxs)("div",{className:"profile-header",children:[(0,s.jsx)("h1",{children:"Profile Settings"}),(0,s.jsx)("p",{className:"subtitle",children:"Manage your account information and preferences"})]}),(0,s.jsxs)("div",{className:"profile-layout",children:[(0,s.jsxs)("div",{className:"profile-card",children:[(0,s.jsx)("div",{className:"profile-cover"}),(0,s.jsxs)("div",{className:"profile-avatar-section",children:[(0,s.jsxs)("div",{className:"avatar-wrapper",ref:N,children:[I.profileImage&&!R?(0,s.jsx)("img",{src:I.profileImage,alt:"Profile",className:"profile-avatar",onError:()=>D(!0)}):(0,s.jsxs)("div",{className:"profile-avatar-initials",children:[I.firstName?I.firstName.charAt(0).toUpperCase():"",I.lastName?I.lastName.charAt(0).toUpperCase():"",I.firstName||I.lastName?"":"U"]}),(0,s.jsx)("input",{ref:A,type:"file",id:"profileImageInput",accept:"image/jpeg,image/jpg,image/png,image/webp",style:{display:"none"},onChange:async e=>{var t;const r=null===(t=e.target.files)||void 0===t?void 0:t[0];r&&V(r)}}),(0,s.jsxs)("div",{className:"avatar-upload-wrapper",children:[(0,s.jsx)("button",{className:"avatar-edit-btn",onClick:()=>x(!v),disabled:y,title:y?"Uploading...":"Change profile picture",children:y?(0,s.jsx)("div",{className:"spinner-small"}):(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]})}),v&&!y&&(0,s.jsxs)("div",{className:"image-upload-menu",children:[(0,s.jsxs)("button",{onClick:()=>{var e;x(!1),null===(e=A.current)||void 0===e||e.click()},className:"upload-menu-item",children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M17 8l-5-5-5 5M12 3v12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),(0,s.jsx)("span",{children:"Upload from Device"})]}),(0,s.jsxs)("button",{onClick:async()=>{x(!1);try{if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)return void alert("Camera is not supported on this device. Please use gallery upload instead.");const r={video:{facingMode:{exact:"environment"},width:{ideal:1920},height:{ideal:1080}}};let n;try{n=await navigator.mediaDevices.getUserMedia(r)}catch(e){try{n=await navigator.mediaDevices.getUserMedia({video:{facingMode:"environment",width:{ideal:1920},height:{ideal:1080}}})}catch(t){n=await navigator.mediaDevices.getUserMedia({video:{width:{ideal:1920},height:{ideal:1080}}})}}E.current=n,k("environment"),w(!0),setTimeout(()=>{C.current&&n&&(C.current.srcObject=n,C.current.play())},100)}catch(f){console.error("Error accessing camera:",f),"NotAllowedError"===f.name||"PermissionDeniedError"===f.name?alert("Camera permission denied. Please allow camera access and try again."):"NotFoundError"===f.name||"DevicesNotFoundError"===f.name?alert("No camera found on this device. Please use gallery upload instead."):alert("Failed to access camera. Please try again or use gallery upload.")}},className:"upload-menu-item",children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M23 19a2 2 0 01-2 2H3a2 2 0 01-2-2V8a2 2 0 012-2h4l2-3h6l2 3h4a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"13",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("span",{children:"Take Photo"})]})]})]})]}),(0,s.jsxs)("h2",{children:[I.firstName," ",I.lastName]}),(0,s.jsx)("p",{className:"profile-role",children:I.agencyName})]}),(0,s.jsxs)("div",{className:"profile-stats-grid",children:[(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("span",{className:"stat-value",children:t().totalProperties}),(0,s.jsx)("span",{className:"stat-label",children:"Listed"})]}),(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("span",{className:"stat-value",children:t().totalInquiries}),(0,s.jsx)("span",{className:"stat-label",children:"Inquiries"})]}),(0,s.jsxs)("div",{className:"stat-box",children:[(0,s.jsx)("span",{className:"stat-value",children:t().totalViews}),(0,s.jsx)("span",{className:"stat-label",children:"Views"})]})]}),(0,s.jsx)("div",{className:"member-since",children:(()=>{if(!M)return I.email,"Loading...";try{const e=new Date(M),t=e.toLocaleString("default",{month:"long"}),r=e.getFullYear();return"Member since ".concat(t," ").concat(r)}catch(e){return I.email?"Member since ".concat((new Date).getFullYear()):"Loading..."}})()})]}),(0,s.jsxs)("div",{className:"settings-content",children:[(0,s.jsx)("div",{className:"settings-tabs",children:[{id:"personal",label:"Personal Info"},{id:"business",label:"Business Info"}].map(e=>(0,s.jsx)("button",{className:"tab-btn ".concat(r===e.id?"active":""),onClick:()=>n(e.id),children:(0,s.jsx)("span",{children:e.label})},e.id))}),(0,s.jsxs)("div",{className:"tab-content",children:[h&&!I.email?(0,s.jsxs)("div",{className:"settings-section",style:{padding:"60px 20px",textAlign:"center"},children:[(0,s.jsx)("div",{style:{width:"48px",height:"48px",border:"4px solid #f3f3f3",borderTop:"4px solid #3498db",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px"}}),(0,s.jsx)("p",{children:"Loading profile data..."})]}):"personal"===r&&(0,s.jsxs)("div",{className:"settings-section",children:[(0,s.jsxs)("div",{className:"section-header",children:[(0,s.jsx)("h3",{children:"Personal Information"}),!o&&(0,s.jsx)("button",{className:"edit-btn",onClick:()=>a(!0),children:"Edit"})]}),(0,s.jsxs)("div",{className:"form-grid",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"First Name"}),(0,s.jsx)("input",{type:"text",name:"firstName",value:I.firstName,onChange:z,disabled:!o})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Last Name"}),(0,s.jsx)("input",{type:"text",name:"lastName",value:I.lastName,onChange:z,disabled:!o})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Email Address"}),(0,s.jsx)("input",{type:"email",name:"email",value:I.email,readOnly:!0,disabled:!0,style:{backgroundColor:"#f3f4f6",cursor:"not-allowed"}})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Phone Number"}),(0,s.jsx)("input",{type:"text",name:"phone",value:I.phone,readOnly:!0,disabled:!0,style:{backgroundColor:"#f3f4f6",cursor:"not-allowed"}})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["WhatsApp Number ",(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"normal"},children:"(Optional)"})]}),(0,s.jsxs)("div",{className:"input-with-icon",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"whatsappNumber",value:I.whatsappNumber,onChange:z,disabled:!o,placeholder:"+917276*****"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsxs)("label",{children:["Alternate Mobile Number ",(0,s.jsx)("span",{style:{color:"#6b7280",fontWeight:"normal"},children:"(Optional)"})]}),(0,s.jsxs)("div",{className:"input-with-icon",children:[(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M22 16.92v3a2 2 0 01-2.18 2 19.79 19.79 0 01-8.63-3.07 19.5 19.5 0 01-6-6 19.79 19.79 0 01-3.07-8.67A2 2 0 014.11 2h3a2 2 0 012 1.72 12.84 12.84 0 00.7 2.81 2 2 0 01-.45 2.11L8.09 9.91a16 16 0 006 6l1.27-1.27a2 2 0 012.11-.45 12.84 12.84 0 002.81.7A2 2 0 0122 16.92z",stroke:"currentColor",strokeWidth:"2"})}),(0,s.jsx)("input",{type:"tel",name:"alternateMobile",value:I.alternateMobile,onChange:z,disabled:!o,placeholder:"+917276*****"})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Location"}),(0,s.jsx)("input",{type:"text",name:"location",value:I.location,onChange:z,disabled:!o,placeholder:"City, State"})]})]}),o&&(0,s.jsxs)("div",{className:"form-actions",children:[(0,s.jsx)("button",{className:"cancel-btn",onClick:()=>a(!1),children:"Cancel"}),(0,s.jsx)("button",{className:"save-btn",onClick:B,disabled:h,children:h?"Saving...":"Save Changes"})]})]}),"business"===r&&(0,s.jsxs)("div",{className:"settings-section",children:[(0,s.jsx)("div",{className:"section-header",children:(0,s.jsx)("h3",{children:"Business Information"})}),(0,s.jsxs)("div",{className:"form-grid",children:[(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Agency/Company Name"}),(0,s.jsx)("input",{type:"text",name:"agencyName",value:I.agencyName,onChange:z})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"Website"}),(0,s.jsxs)("div",{className:"input-with-icon",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M2 12h20M12 2a15.3 15.3 0 014 10 15.3 15.3 0 01-4 10 15.3 15.3 0 01-4-10 15.3 15.3 0 014-10z",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("input",{type:"text",name:"website",value:I.website,onChange:z})]})]}),(0,s.jsxs)("div",{className:"form-group full-width",children:[(0,s.jsx)("label",{children:"Business Address"}),(0,s.jsxs)("div",{className:"input-with-icon",children:[(0,s.jsxs)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0118 0z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"10",r:"3",stroke:"currentColor",strokeWidth:"2"})]}),(0,s.jsx)("input",{type:"text",name:"agencyAddress",value:I.agencyAddress,onChange:z})]})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"GST Number (Optional)"}),(0,s.jsx)("input",{type:"text",name:"gstNumber",value:I.gstNumber,onChange:z,placeholder:"Enter GST number"})]}),(0,s.jsxs)("div",{className:"form-group",children:[(0,s.jsx)("label",{children:"RERA Number (Optional)"}),(0,s.jsx)("input",{type:"text",name:"reraNumber",value:I.reraNumber,onChange:z,placeholder:"Enter RERA number"})]})]}),(0,s.jsx)("div",{className:"form-actions",children:(0,s.jsx)("button",{className:"save-btn",onClick:B,disabled:h,children:h?"Saving...":"Save Changes"})})]})]})]})]}),b&&(0,s.jsx)("div",{className:"camera-modal-overlay",onClick:U,children:(0,s.jsxs)("div",{className:"camera-modal",onClick:e=>e.stopPropagation(),children:[(0,s.jsxs)("div",{className:"camera-modal-header",children:[(0,s.jsx)("h3",{children:"Take Photo"}),(0,s.jsx)("button",{className:"camera-close-btn",onClick:U,"aria-label":"Close camera",children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsx)("div",{className:"camera-content",children:j?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("img",{src:URL.createObjectURL(j),alt:"Captured",className:"camera-preview"}),(0,s.jsxs)("div",{className:"camera-preview-controls",children:[(0,s.jsxs)("button",{className:"camera-retake-btn",onClick:()=>{S(null)},children:[(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M1 4v6h6M23 20v-6h-6",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M3.51 9a9 9 0 0114.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0020.49 15",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Retake"]}),(0,s.jsx)("button",{className:"camera-use-btn",onClick:()=>{j&&(V(j),U())},disabled:y,children:y?(0,s.jsx)("div",{className:"spinner-small"}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M20 6L9 17l-5-5",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Use Photo"]})})]})]}):(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)("video",{ref:C,autoPlay:!0,playsInline:!0,muted:!0,className:"camera-video"}),(0,s.jsxs)("div",{className:"camera-controls",children:[(0,s.jsx)("button",{className:"camera-flip-btn",onClick:async()=>{const e="environment"===T?"user":"environment";E.current&&(E.current.getTracks().forEach(e=>e.stop()),E.current=null);try{const r={video:{facingMode:{exact:e},width:{ideal:1920},height:{ideal:1080}}};let n;try{n=await navigator.mediaDevices.getUserMedia(r)}catch(t){n=await navigator.mediaDevices.getUserMedia({video:{facingMode:e,width:{ideal:1920},height:{ideal:1080}}})}k(e),E.current=n,C.current&&(C.current.srcObject=n,C.current.play())}catch(f){console.error("Error flipping camera:",f),alert("Failed to switch camera. Please try again.")}},"aria-label":"Flip camera",title:"Flip camera",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M17 1l4 4-4 4M21 5H11M7 23l-4-4 4-4M3 19h10",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M12 12a3 3 0 11-6 0 3 3 0 016 0z",stroke:"currentColor",strokeWidth:"2"})]})}),(0,s.jsx)("button",{className:"camera-capture-btn",onClick:()=>{if(C.current){const e=C.current,t=document.createElement("canvas");t.width=e.videoWidth,t.height=e.videoHeight;t.getContext("2d").drawImage(e,0,0),t.toBlob(e=>{if(e){const t=new File([e],"camera-photo.jpg",{type:"image/jpeg"});S(t)}},"image/jpeg",.9)}},"aria-label":"Capture photo",children:(0,s.jsxs)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"white",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"12",r:"4",fill:"white"})]})}),(0,s.jsx)("button",{className:"camera-cancel-btn",onClick:U,"aria-label":"Cancel",children:"Cancel"})]})]})})]})})]})},Rr=()=>{const[t,r]=(0,e.useState)({days:0,hours:0,minutes:0,seconds:0}),[n,o]=(0,e.useState)(!0),a=(0,e.useRef)(null);return(0,e.useEffect)(()=>((async()=>{try{var e,t;const n=await i.S3.getStats();let s;if(n.success&&null!==(e=n.data)&&void 0!==e&&null!==(t=e.subscription)&&void 0!==t&&t.end_date){if(s=new Date(n.data.subscription.end_date),isNaN(s.getTime()))throw new Error("Invalid end date format")}else s=new Date,s.setMonth(s.getMonth()+3);a.current&&clearInterval(a.current),a.current=setInterval(()=>{const e=(new Date).getTime(),t=s.getTime()-e;t<0?(a.current&&clearInterval(a.current),r({days:0,hours:0,minutes:0,seconds:0})):r({days:Math.floor(t/864e5),hours:Math.floor(t%864e5/36e5),minutes:Math.floor(t%36e5/6e4),seconds:Math.floor(t%6e4/1e3)})},1e3),o(!1)}catch(n){console.error("Error fetching subscription data:",n);const e=new Date;e.setMonth(e.getMonth()+3),a.current&&clearInterval(a.current),a.current=setInterval(()=>{const t=(new Date).getTime(),n=e.getTime()-t;n<0?(a.current&&clearInterval(a.current),r({days:0,hours:0,minutes:0,seconds:0})):r({days:Math.floor(n/864e5),hours:Math.floor(n%864e5/36e5),minutes:Math.floor(n%36e5/6e4),seconds:Math.floor(n%6e4/1e3)})},1e3),o(!1)}})(),()=>{a.current&&clearInterval(a.current)}),[]),n?(0,s.jsx)("div",{className:"seller-timer-page",children:(0,s.jsx)("div",{className:"seller-timer-content",children:(0,s.jsx)("div",{style:{textAlign:"center",padding:"2rem"},children:(0,s.jsx)("p",{children:"Loading subscription data..."})})})}):(0,s.jsx)("div",{className:"seller-timer-page",children:(0,s.jsxs)("div",{className:"seller-timer-content",children:[(0,s.jsx)("div",{className:"seller-timer-badge",children:"LIMITED TIME OFFER"}),(0,s.jsxs)("h1",{className:"seller-timer-title",children:[(0,s.jsx)("span",{className:"seller-timer-title-purple",children:"3 Months Free"}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"seller-timer-title-white",children:"Premium Property Upload Access"})]}),(0,s.jsxs)("div",{className:"seller-timer-card",children:[(0,s.jsxs)("div",{className:"seller-timer-header",children:[(0,s.jsxs)("svg",{width:"28",height:"28",viewBox:"0 0 24 24",fill:"none",className:"seller-timer-clock-icon",children:[(0,s.jsx)("circle",{cx:"12",cy:"12",r:"10",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M12 6v6l4 2",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),(0,s.jsx)("h2",{children:"Your Trial Expires In"})]}),(0,s.jsx)("div",{className:"seller-timer-display",children:["days","hours","minutes","seconds"].map((r,n)=>(0,s.jsxs)(e.Fragment,{children:[(0,s.jsxs)("div",{className:"seller-timer-time-block",children:[(0,s.jsx)("div",{className:"seller-timer-time-box",children:String(t[r]).padStart(2,"0")}),(0,s.jsx)("div",{className:"seller-timer-time-label",children:r.toUpperCase()})]}),n<3&&(0,s.jsx)("div",{className:"seller-timer-separator",children:":"})]},r))})]}),(0,s.jsxs)("div",{className:"seller-timer-pricing-section",children:[(0,s.jsx)("h2",{className:"seller-timer-pricing-heading",children:"After your trial"}),(0,s.jsx)(Xt,{subscriptionPath:"/agent-dashboard/subscription",variant:"page"})]})]})})};function Dr(){const t=(0,e.useRef)(null),[r,n]=(0,e.useState)({name:"",email:"",phone:"",message:""}),[i,o]=(0,e.useState)(!1),[a,l]=(0,e.useState)(!1),[c,u]=(0,e.useState)(null),d=(0,e.useCallback)(e=>{const{name:t,value:r}=e.target;n(e=>(0,p.A)((0,p.A)({},e),{},{[t]:r}))},[]);return(0,s.jsx)("div",{className:"agent-contact-main",children:(0,s.jsxs)("div",{className:"agent-contact-container",children:[(0,s.jsxs)("div",{className:"agent-contact-header",children:[(0,s.jsx)("h1",{className:"agent-contact-title",children:"Get In Touch"}),(0,s.jsx)("p",{className:"agent-header-text",children:"Contact us for a free quote or emergency service"})]}),(0,s.jsxs)("div",{className:"agent-contact-two-column",children:[(0,s.jsxs)("div",{className:"agent-contact-info-card",children:[(0,s.jsx)("h2",{className:"agent-contact-info-title",children:"Contact Information"}),(0,s.jsxs)("div",{className:"agent-contact-info-item",children:[(0,s.jsx)("div",{className:"agent-contact-info-label",children:"Phone"}),(0,s.jsx)("a",{href:"tel:+919371316019",className:"agent-contact-info-link",children:"+919371316019"})]}),(0,s.jsxs)("div",{className:"agent-contact-info-item",children:[(0,s.jsx)("div",{className:"agent-contact-info-label",children:"Email"}),(0,s.jsx)("a",{href:"mailto:info@360coordinates.com",className:"agent-contact-info-link",children:"info@360coordinates.com"})]}),(0,s.jsxs)("div",{className:"agent-contact-info-item",children:[(0,s.jsx)("div",{className:"agent-contact-info-label",children:"Address"}),(0,s.jsxs)("a",{href:"https://www.google.com/maps/search/?api=1&query=Office+No.21+%26+22,+3rd+Floor,+S%2FNo.+56,+Aston+Plaza,+Ambegaon+Bk.,+Pune,+Maharashtra+411046",target:"_blank",rel:"noopener noreferrer",className:"agent-contact-info-address",children:["Office No.21 & 22, 3rd Floor, S/No. 56",(0,s.jsx)("br",{}),"Aston Plaza, Ambegaon Bk.",(0,s.jsx)("br",{}),"Pune, Maharashtra\u2013 411046"]})]})]}),(0,s.jsxs)("div",{className:"agent-form-card",children:[(0,s.jsx)("h2",{className:"agent-form-title",children:"Send Us a Message"}),a&&(0,s.jsx)("div",{className:"agent-success-box",children:"Message sent successfully!"}),(0,s.jsxs)("form",{ref:t,className:"agent-form-inputs",onSubmit:e=>{e&&(e.preventDefault(),e.stopPropagation());const t=window.pageYOffset||document.documentElement.scrollTop;if(!r.name||!r.email||!r.phone||!r.message)return alert("Please fill all fields"),void window.scrollTo({top:t,behavior:"auto"});o(!0),setTimeout(()=>{o(!1),l(!0),n({name:"",email:"",phone:"",message:""}),requestAnimationFrame(()=>{window.scrollTo({top:t,behavior:"auto"})}),setTimeout(()=>l(!1),2500)},1500)},onKeyDown:e=>{"Enter"===e.key&&"TEXTAREA"!==e.target.tagName&&e.preventDefault()},children:[(0,s.jsx)("input",{type:"text",name:"name",value:r.name,onChange:d,placeholder:"Your Name"}),(0,s.jsx)("input",{type:"email",name:"email",value:r.email,onChange:d,placeholder:"Your Email"}),(0,s.jsx)("input",{type:"text",name:"phone",value:r.phone,onChange:d,placeholder:"Phone Number"}),(0,s.jsx)("textarea",{name:"message",rows:"4",value:r.message,onChange:d,placeholder:"Message"}),(0,s.jsx)("button",{type:"submit",disabled:i,children:i?"Sending...":"Send Message"})]})]})]}),(0,s.jsxs)("div",{className:"agent-faq-section",children:[(0,s.jsx)("h2",{className:"agent-faq-title",children:"Frequently Asked Questions"}),(0,s.jsx)("div",{className:"agent-faq-list",children:[{question:"How do I list a property?",answer:"To list your property, log in to your agent dashboard and click on 'My Properties'. Then click the 'Add Property' button and fill in all the required details including property type, location, price, and images. Once submitted, your property will be reviewed and published."},{question:"How can I contact the property owner?",answer:"You can contact property owners directly through our chat feature. Simply click on the 'Chat' button on any property listing page, or use the ChatUs page in your dashboard. Property owners will receive your message and can respond to your inquiries."},{question:"Is my data secure?",answer:"Yes, we take data security seriously. All your personal information, including contact details and property data, is encrypted and stored securely. We follow industry-standard security practices and never share your information with third parties without your consent."},{question:"How do I edit my profile?",answer:"To edit your profile, go to your dashboard and click on 'Profile' in the navigation menu. From there, you can update your personal information, contact details, profile picture, and other settings. Remember to save your changes before leaving the page."},{question:"How can I get support?",answer:"You can get support by filling out the contact form on this page, or by emailing us directly at info@360coordinates.com. Our support team typically responds within 24 hours. You can also call us at +919371316019 during business hours."}].map((e,t)=>(0,s.jsxs)("div",{className:"agent-faq-item ".concat(c===t?"open":""),children:[(0,s.jsxs)("button",{className:"agent-faq-question",onClick:()=>u(c===t?null:t),children:[(0,s.jsx)("span",{children:e.question}),(0,s.jsx)(P,{size:20,className:"agent-faq-icon ".concat(c===t?"open":"")})]}),c===t&&(0,s.jsx)("div",{className:"agent-faq-answer",children:(0,s.jsx)("p",{children:e.answer})})]},t))})]})]})})}const Fr=()=>{const[t,r]=(0,e.useState)("overview"),[o,a]=(0,e.useState)(!1),[c,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)(null),[p,m]=(0,e.useState)(!1),[f,g]=(0,e.useState)(!1),y=(0,n.Zp)(),_=(0,n.zy)(),{getStats:v,inquiries:x}=lr(),{logout:b}=l(),w=(0,e.useRef)(null),[j,S]=(0,e.useState)(0),T=(0,e.useMemo)(()=>j,[j]),k=async()=>{let e=i.R2.getUser();if(!e&&i.R2.isAuthenticated())try{const t=await i.R2.verifyToken();t.success&&t.data&&(e=t.data.user)}catch(t){console.error("Error verifying token:",t)}h(e),m(!1)};(0,e.useEffect)(()=>{k()},[]),(0,e.useEffect)(()=>{"profile"===t&&k()},[t]),(0,e.useEffect)(()=>{const e=()=>{k()};return window.addEventListener("userDataUpdated",e),()=>{window.removeEventListener("userDataUpdated",e)}},[]);const[A,C]=(0,e.useState)(89);(0,e.useEffect)(()=>{_.pathname.includes("/agent-pro-details/")||_.pathname.includes("/details/")||_.pathname.includes("/upcoming-project/")||(_.pathname.includes("/properties")||"/agent-dashboard/properties"===_.pathname?r("properties"):_.pathname.includes("/inquiries")||"/agent-dashboard/inquiries"===_.pathname?r("inquiries"):_.pathname.includes("/profile")||"/agent-dashboard/profile"===_.pathname?r("profile"):_.pathname.includes("/subscription")||"/agent-dashboard/subscription"===_.pathname?r("subscription"):_.pathname.includes("/support")||"/agent-dashboard/support"===_.pathname?r("support"):"/agent-dashboard"!==_.pathname&&"/agent-dashboard/"!==_.pathname||r("overview"))},[_.pathname]),(0,e.useEffect)(()=>{const e=async()=>{try{var e,t;const r=await i.S3.getStats();if(r.success&&null!==(e=r.data)&&void 0!==e&&null!==(t=e.subscription)&&void 0!==t&&t.end_date){const e=new Date(r.data.subscription.end_date),t=new Date,n=e.getTime()-t.getTime(),i=Math.ceil(n/864e5);C(Math.max(0,i))}else{const e=localStorage.getItem("trialStartDate");if(e){const t=new Date(e),r=new Date(t);r.setMonth(r.getMonth()+3);const n=r-new Date,i=Math.ceil(n/864e5);C(Math.max(0,i))}}}catch(r){console.error("Error fetching subscription data:",r);const e=localStorage.getItem("trialStartDate");if(e){const t=new Date(e),r=new Date(t);r.setMonth(r.getMonth()+3);const n=r-new Date,i=Math.ceil(n/864e5);C(Math.max(0,i))}}};e();const t=setInterval(()=>{e()},6e4);return()=>clearInterval(t)},[]),(0,e.useEffect)(()=>{const e=()=>{u(window.scrollY>10)};return window.addEventListener("scroll",e),()=>window.removeEventListener("scroll",e)},[]),(0,e.useEffect)(()=>{const e=e=>{"Escape"===e.key&&o&&a(!1)};return window.addEventListener("keydown",e),()=>window.removeEventListener("keydown",e)},[o]),(0,e.useEffect)(()=>{const e=()=>{window.innerWidth>1024&&o&&a(!1)};return window.addEventListener("resize",e),()=>window.removeEventListener("resize",e)},[o]);const E=()=>{b(),window.location.href="/"};(0,e.useEffect)(()=>{const e=e=>{w.current&&!w.current.contains(e.target)&&g(!1)};return f&&document.addEventListener("mousedown",e),()=>{document.removeEventListener("mousedown",e)}},[f]);const N=e=>{r(e),a(!1),window.scrollTo({top:0,behavior:"smooth"}),"overview"===e?y("/agent-dashboard"):"properties"===e?y("/agent-dashboard/properties"):"inquiries"===e?y("/agent-dashboard/inquiries"):"profile"===e?y("/agent-dashboard/profile"):"subscription"===e?y("/agent-dashboard/subscription"):"support"===e&&y("/agent-dashboard/support")},I=[{id:"overview",label:"Dashboard",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"3",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"14",y:"3",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"3",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("rect",{x:"14",y:"14",width:"7",height:"7",rx:"1",stroke:"currentColor",strokeWidth:"2"})]})},{id:"properties",label:"My Properties",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M3 9l9-7 9 7v11a2 2 0 01-2 2H5a2 2 0 01-2-2z",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("polyline",{points:"9,22 9,12 15,12 15,22",stroke:"currentColor",strokeWidth:"2"})]})},{id:"inquiries",label:"Inquiries",icon:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2"})})},{id:"profile",label:"Profile",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]})},{id:"subscription",label:"Subscription",icon:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("rect",{x:"2",y:"5",width:"20",height:"14",rx:"2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M2 10h20",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M6 15h4",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("path",{d:"M14 15h4",stroke:"currentColor",strokeWidth:"2"})]})}];return(0,s.jsxs)("div",{className:"agent-dashboard",children:[(0,s.jsxs)("header",{className:"agent-header ".concat(c?"scrolled":""),children:[(0,s.jsxs)("div",{className:"header-left",children:[(0,s.jsxs)("button",{className:"menu-toggle ".concat(o?"active":""),onClick:()=>a(!o),children:[(0,s.jsx)("span",{}),(0,s.jsx)("span",{}),(0,s.jsx)("span",{})]}),(0,s.jsx)(n.N_,{to:"/agent-dashboard",className:"agent-logo-link",children:(0,s.jsx)("div",{className:"logo",children:(0,s.jsx)("div",{className:"logo-icon-wrapper",children:(0,s.jsx)("img",{src:"/finallogo.png",alt:"India Propertys",className:"agent-logo-image"})})})})]}),(0,s.jsx)("nav",{className:"header-nav",children:I.map(e=>{const r=!(_.pathname.includes("/agent-pro-details/")||_.pathname.includes("/details/"))&&t===e.id;return(0,s.jsxs)("button",{className:"nav-btn ".concat(r?"active":""),onClick:t=>{t.preventDefault(),t.stopPropagation(),N(e.id)},type:"button",children:[(0,s.jsx)("span",{className:"nav-icon",children:e.icon}),(0,s.jsx)("span",{className:"nav-label",children:e.label}),"inquiries"===e.id&&T>0&&(0,s.jsx)("span",{className:"nav-badge",children:T})]},e.id)})}),(0,s.jsxs)("div",{className:"header-right",children:[(0,s.jsxs)("button",{className:"free-trial-badge ".concat(A<=7?"urgent":""),onClick:()=>N("subscription"),children:[(0,s.jsx)("span",{className:"trial-text",children:"Free Trial"}),(0,s.jsx)("br",{}),(0,s.jsx)("span",{className:"trial-days",children:A}),(0,s.jsx)("span",{className:"trial-text",children:"days left"})]}),(0,s.jsxs)("button",{className:"notification-btn",onClick:()=>{N("inquiries")},children:[(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 8A6 6 0 106 8c0 7-3 9-3 9h18s-3-2-3-9",stroke:"currentColor",strokeWidth:"2"})}),T>0&&(0,s.jsx)("span",{className:"notification-badge",children:T})]}),(0,s.jsxs)("div",{className:"user-profile",ref:w,onClick:e=>{e.stopPropagation(),g(!f)},children:[(0,s.jsxs)("div",{className:"user-avatar",children:[null!==d&&void 0!==d&&d.profile_image&&!p?(0,s.jsx)("img",{src:d.profile_image,alt:d.full_name||"User",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"},onError:()=>m(!0)}):(0,s.jsx)("span",{children:null!==d&&void 0!==d&&d.full_name?d.full_name.charAt(0).toUpperCase():"U"}),(0,s.jsx)("span",{className:"online-dot"})]}),(0,s.jsxs)("div",{className:"user-info",children:[(0,s.jsx)("span",{className:"user-name",children:(null===d||void 0===d?void 0:d.full_name)||"Loading..."}),(0,s.jsx)("span",{className:"user-role",children:"Pro Agent"})]}),(0,s.jsx)("button",{className:"dropdown-btn",children:(0,s.jsx)("svg",{width:"16",height:"16",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M6 9l6 6 6-6",stroke:"currentColor",strokeWidth:"2"})})}),f&&(0,s.jsxs)("div",{className:"user-dropdown",children:[(0,s.jsxs)("button",{onClick:()=>{N("profile"),g(!1)},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M20 21v-2a4 4 0 00-4-4H8a4 4 0 00-4 4v2",stroke:"currentColor",strokeWidth:"2"}),(0,s.jsx)("circle",{cx:"12",cy:"7",r:"4",stroke:"currentColor",strokeWidth:"2"})]}),"My Profile"]}),(0,s.jsxs)("button",{onClick:()=>{g(!1),N("support")},children:[(0,s.jsxs)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M13 7H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M17 11H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]}),"Support"]}),(0,s.jsxs)("button",{onClick:E,children:[(0,s.jsx)("svg",{width:"18",height:"18",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})}),"Logout"]})]})]})]})]}),(0,s.jsx)("div",{className:"sidebar-overlay ".concat(o?"active":""),onClick:()=>a(!1)}),(0,s.jsxs)("div",{className:"mobile-sidebar ".concat(o?"open":""),children:[(0,s.jsxs)("div",{className:"mobile-sidebar-header",children:[(0,s.jsx)(n.N_,{to:"/agent-dashboard",className:"agent-logo-link",children:(0,s.jsx)("div",{className:"logo",children:(0,s.jsx)("div",{className:"logo-icon-wrapper",children:(0,s.jsx)("img",{src:"/logoswhite.png",alt:"India Propertys",className:"agent-logo-image"})})})}),(0,s.jsx)("button",{className:"close-sidebar",onClick:()=>a(!1),children:(0,s.jsx)("svg",{width:"24",height:"24",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M18 6L6 18M6 6l12 12",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})})})]}),(0,s.jsxs)("div",{className:"mobile-user-section",children:[(0,s.jsx)("div",{className:"mobile-user-avatar",children:null!==d&&void 0!==d&&d.profile_image&&!p?(0,s.jsx)("img",{src:d.profile_image,alt:d.full_name||"User",style:{width:"100%",height:"100%",borderRadius:"50%",objectFit:"cover"},onError:()=>m(!0)}):(0,s.jsx)("span",{children:null!==d&&void 0!==d&&d.full_name?d.full_name.charAt(0).toUpperCase():"U"})}),(0,s.jsxs)("div",{className:"mobile-user-info",children:[(0,s.jsx)("div",{className:"mobile-user-name",children:(null===d||void 0===d?void 0:d.full_name)||"Loading..."}),(0,s.jsx)("div",{className:"mobile-user-role",children:"Pro Agent"})]})]}),(0,s.jsxs)("nav",{className:"mobile-nav",children:[I.map(e=>{const r=!(_.pathname.includes("/agent-pro-details/")||_.pathname.includes("/details/"))&&t===e.id;return(0,s.jsxs)("button",{className:"mobile-nav-btn ".concat(r?"active":""),onClick:()=>{N(e.id),a(!1)},children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:e.icon}),(0,s.jsx)("span",{className:"mobile-nav-label",children:e.label}),"inquiries"===e.id&&T>0&&(0,s.jsx)("span",{className:"mobile-nav-badge",children:T})]},e.id)}),(0,s.jsx)("div",{className:"mobile-nav-divider"}),(0,s.jsxs)("button",{className:"mobile-nav-btn",onClick:()=>N("support"),children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:(0,s.jsxs)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:[(0,s.jsx)("path",{d:"M21 15a2 2 0 01-2 2H7l-4 4V5a2 2 0 012-2h14a2 2 0 012 2z",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"}),(0,s.jsx)("path",{d:"M13 7H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"}),(0,s.jsx)("path",{d:"M17 11H7",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round"})]})}),(0,s.jsx)("span",{className:"mobile-nav-label",children:"Support"})]}),(0,s.jsx)("div",{className:"mobile-nav-divider"}),(0,s.jsxs)("button",{className:"mobile-nav-btn logout",onClick:()=>{E(),a(!1)},children:[(0,s.jsx)("span",{className:"mobile-nav-icon",children:(0,s.jsx)("svg",{width:"20",height:"20",viewBox:"0 0 24 24",fill:"none",children:(0,s.jsx)("path",{d:"M9 21H5a2 2 0 01-2-2V5a2 2 0 012-2h4M16 17l5-5-5-5M21 12H9",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round"})})}),(0,s.jsx)("span",{className:"mobile-nav-label",children:"Logout"})]})]})]}),(0,s.jsx)("main",{className:"agent-main",children:(0,s.jsx)("div",{className:"main-content-wrapper",children:(()=>{if(_.pathname.includes("/agent-pro-details/")||_.pathname.includes("/details/")||_.pathname.includes("/upcoming-project/"))return _.pathname.includes("/upcoming-project/")?(0,s.jsx)(Ye,{}):(0,s.jsx)(Ve,{});switch(t){case"overview":default:return(0,s.jsx)(Nr,{onNavigate:N});case"properties":return(0,s.jsx)(Pr,{});case"inquiries":return(0,s.jsx)(Mr,{onUnreadCountChange:S});case"profile":return(0,s.jsx)(Lr,{});case"subscription":return(0,s.jsx)(Rr,{});case"support":return(0,s.jsx)(Dr,{})}})()})})]})},Or=()=>(0,s.jsx)(ar,{children:(0,s.jsx)(Fr,{})}),zr=(0,I.A)("shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);var Br=r(118),Ur=r(254),Vr=r(669),qr=r(995);const Wr=(0,I.A)("menu",[["path",{d:"M4 5h16",key:"1tepv9"}],["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 19h16",key:"1djgab"}]]),Hr=(0,I.A)("log-out",[["path",{d:"m16 17 5-5-5-5",key:"1bji2h"}],["path",{d:"M21 12H9",key:"dn1m92"}],["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}]]),Gr=(0,e.lazy)(()=>r.e(352).then(r.bind(r,352))),Zr=(0,e.lazy)(()=>r.e(796).then(r.bind(r,796))),Kr=(0,e.lazy)(()=>r.e(321).then(r.bind(r,321))),Yr=(0,e.lazy)(()=>r.e(566).then(r.bind(r,566))),Xr=(0,e.lazy)(()=>r.e(676).then(r.bind(r,676))),Jr=(0,e.lazy)(()=>r.e(211).then(r.bind(r,211))),Qr=(0,e.lazy)(()=>r.e(110).then(r.bind(r,110))),$r=(0,e.lazy)(()=>r.e(557).then(r.bind(r,557))),en=()=>{var t;const[r,i]=(0,e.useState)(!1),o=(0,n.Zp)(),a=(0,n.zy)(),l="/admin/login"===a.pathname,[c,u]=(0,e.useState)(!1),[d,h]=(0,e.useState)(!0),[p,m]=(0,e.useState)(null),[f,g]=(0,e.useState)([]),y=[{path:"/admin/dashboard",icon:D,label:"Dashboard",roles:["super_admin","admin","moderator"]},{path:"/admin/properties",icon:F.A,label:"Properties",roles:["super_admin","admin","moderator"]},{path:"/admin/moderation-queue",icon:zr,label:"Image Moderation",roles:["super_admin","admin","moderator"]},{path:"/admin/users",icon:Br.A,label:"Users",roles:["super_admin","admin"]},{path:"/admin/agents",icon:Ur.A,label:"Agent / Builder",roles:["super_admin","admin"]},{path:"/admin/inquiries",icon:Vr.A,label:"Inquiries",roles:["super_admin","admin","moderator"]},{path:"/admin/subscriptions",icon:qr.A,label:"Subscriptions",roles:["super_admin","admin"]}];(0,e.useEffect)(()=>{(async()=>{try{const t=await fetch("".concat(q.JR).concat(q.Sn.ADMIN_VERIFY),{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"});if(401===t.status)return u(!1),l||o("/admin/login",{replace:!0}),void h(!1);const r=t.headers.get("content-type");if(!r||!r.includes("application/json"))return u(!1),l||o("/admin/login",{replace:!0}),void h(!1);const n=await t.json();if(n.success&&n.data&&n.data.admin){const t=n.data.admin;m(t),g((e=t.role)?y.filter(t=>t.roles.includes(e)):[]),u(!0),l&&o("/admin/dashboard",{replace:!0})}else u(!1),l||o("/admin/login",{replace:!0})}catch(t){u(!1),l||o("/admin/login",{replace:!0})}finally{h(!1)}var e})()},[l,o]);const _=async()=>{try{await fetch("".concat(q.JR,"/admin/auth/logout.php"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include"})}catch(e){console.error("Logout error:",e)}window.location.href="/"},v=()=>{i(!1)},x=()=>(0,s.jsx)("div",{style:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,s.jsx)("div",{children:"Loading..."})});return d?(0,s.jsx)(x,{}):l?(0,s.jsx)(e.Suspense,{fallback:(0,s.jsx)(x,{}),children:(0,s.jsx)(n.BV,{children:(0,s.jsx)(n.qh,{path:"/login",element:(0,s.jsx)($r,{})})})}):c?(0,s.jsxs)("div",{className:"admin-layout",children:[(0,s.jsx)("nav",{className:"admin-navbar",children:(0,s.jsxs)("div",{className:"admin-navbar-container",children:[(0,s.jsx)("div",{className:"admin-navbar-logo",onClick:()=>o("/admin/dashboard"),children:(0,s.jsx)("span",{className:"admin-logo-text",children:(0,s.jsx)("img",{src:"/finallogo.png",style:{height:"5.5rem",minWidth:"140px",width:"auto",objectFit:"contain"},alt:"Logo"})})}),(0,s.jsx)("button",{className:"admin-mobile-menu-btn",onClick:()=>{i(!r)},children:r?(0,s.jsx)(B.A,{}):(0,s.jsx)(Wr,{})}),(0,s.jsxs)("div",{className:"admin-navbar-menu ".concat(r?"admin-mobile-open":""),children:[f.length>0?f.map(e=>{const t=e.icon,r=a.pathname===e.path;return(0,s.jsxs)(n.N_,{to:e.path,className:"admin-nav-item ".concat(r?"admin-active":""),onClick:v,children:[(0,s.jsx)(t,{className:"admin-nav-icon"}),(0,s.jsx)("span",{children:e.label})]},e.path)}):y.map(e=>{const t=e.icon,r=a.pathname===e.path;return(0,s.jsxs)(n.N_,{to:e.path,className:"admin-nav-item ".concat(r?"admin-active":""),onClick:v,children:[(0,s.jsx)(t,{className:"admin-nav-icon"}),(0,s.jsx)("span",{children:e.label})]},e.path)}),p&&(0,s.jsxs)("div",{style:{marginTop:"auto",padding:"12px",borderTop:"1px solid rgba(255,255,255,0.1)",fontSize:"12px",color:"rgba(255,255,255,0.8)"},children:[(0,s.jsx)("div",{style:{fontWeight:"600",marginBottom:"4px"},children:p.full_name||p.username}),(0,s.jsx)("div",{style:{fontSize:"11px",textTransform:"capitalize"},children:null===(t=p.role)||void 0===t?void 0:t.replace("_"," ")})]}),(0,s.jsxs)("button",{className:"admin-logout-btn admin-mobile-logout",onClick:_,children:[(0,s.jsx)(Hr,{}),(0,s.jsx)("span",{children:"Logout"})]})]}),(0,s.jsxs)("button",{className:"admin-logout-btn admin-desktop-logout",onClick:_,children:[(0,s.jsx)(Hr,{}),(0,s.jsx)("span",{children:"Logout"})]})]})}),r&&(0,s.jsx)("div",{className:"admin-mobile-overlay",onClick:v}),(0,s.jsx)("div",{className:"admin-main",children:(0,s.jsx)("div",{className:"admin-content",children:(0,s.jsx)(e.Suspense,{fallback:(0,s.jsx)(x,{}),children:(0,s.jsxs)(n.BV,{children:[(0,s.jsx)(n.qh,{path:"/",element:(0,s.jsx)(Gr,{})}),(0,s.jsx)(n.qh,{path:"/dashboard",element:(0,s.jsx)(Gr,{})}),(0,s.jsx)(n.qh,{path:"/properties",element:(0,s.jsx)(Zr,{})}),(0,s.jsx)(n.qh,{path:"/moderation-queue",element:(0,s.jsx)(Qr,{})}),(0,s.jsx)(n.qh,{path:"/users",element:(0,s.jsx)(Kr,{})}),(0,s.jsx)(n.qh,{path:"/agents",element:(0,s.jsx)(Yr,{})}),(0,s.jsx)(n.qh,{path:"/inquiries",element:(0,s.jsx)(Xr,{})}),(0,s.jsx)(n.qh,{path:"/subscriptions",element:(0,s.jsx)(Jr,{})}),(0,s.jsx)(n.qh,{path:"/login",element:(0,s.jsx)($r,{})})]})})})})]}):null};function tn(){const{pathname:t}=(0,n.zy)();return(0,e.useEffect)(()=>{const e="360Coordinates - Buy, Rent & Sell Properties in India";document.title=e;let t=document.querySelector('meta[name="description"]');t||(t=document.createElement("meta"),t.setAttribute("name","description"),document.head.appendChild(t)),t.setAttribute("content","360Coordinates - Find your dream property. Buy, Rent, or Sell properties across India. Real estate listings with verified sellers and agents.");let r=document.querySelector('meta[property="og:title"]');r||(r=document.createElement("meta"),r.setAttribute("property","og:title"),document.head.appendChild(r)),r.setAttribute("content",e);let n=document.querySelector('meta[property="twitter:title"]');n||(n=document.createElement("meta"),n.setAttribute("property","twitter:title"),document.head.appendChild(n)),n.setAttribute("content",e)},[t]),null}function rn(){const{pathname:t}=(0,n.zy)(),r=e.useRef(t);return(0,e.useEffect)(()=>{const e=t.startsWith("/seller-dashboard"),n=t.startsWith("/agent-dashboard")||t.startsWith("/Agent-dashboard"),i=t.startsWith("/buy")||t.startsWith("/rent")||t.startsWith("/pghostel")||t.startsWith("/projects")||t.startsWith("/BuyerHome")||t.startsWith("/BuyerProfile")||t.startsWith("/BuyerContactPage")||t.startsWith("/ChatUs")||t.startsWith("/chatus")||t.startsWith("/buyer-about")||t.startsWith("/buyer-privacy-policy")||t.startsWith("/buyer-terms-conditions")||t.startsWith("/buyer-dashboard"),s="/buyer-dashboard"===t||"/BuyerHome"===t||"/buyer-dashboard/"===t,o=r.current,a=o.startsWith("/buy")||o.startsWith("/rent")||o.startsWith("/pghostel")||o.startsWith("/projects")||o.startsWith("/BuyerProfile")||o.startsWith("/BuyerContactPage")||o.startsWith("/ChatUs")||o.startsWith("/chatus")||o.startsWith("/buyer-dashboard/buy")||o.startsWith("/buyer-dashboard/rent")||o.startsWith("/buyer-dashboard/pghostel")||o.startsWith("/buyer-dashboard/projects")||o.startsWith("/buyer-dashboard/profile")||o.startsWith("/buyer-dashboard/chat")||o.startsWith("/buyer-dashboard/BuyerContactPage");r.current!==t&&(e||n||i?s&&a&&window.scrollTo({top:0,behavior:"instant"}):window.scrollTo({top:0,behavior:"instant"})),r.current=t},[t]),null}const nn=e=>{let{children:t}=e;const r=(0,n.zy)(),i="/chatus"===r.pathname.toLowerCase()||r.pathname.toLowerCase().startsWith("/chatus?")||"/ChatUs"===r.pathname||r.pathname.startsWith("/ChatUs?")||"/buyer-dashboard/chat"===r.pathname||r.pathname.startsWith("/buyer-dashboard/chat?");return(0,s.jsxs)("div",{className:"buyer-dashboard-app",children:[(0,s.jsx)($,{}),(0,s.jsx)("main",{className:"buyer-main-content",children:t}),!i&&(0,s.jsx)(ee,{})]})};const sn=function(){return(0,s.jsx)(a,{children:(0,s.jsxs)(n.Kd,{children:[(0,s.jsx)(tn,{})," ",(0,s.jsx)(rn,{})," ",(0,s.jsx)("div",{className:"App",children:(0,s.jsxs)(n.BV,{children:[(0,s.jsx)(n.qh,{path:"/searchresults",element:(0,s.jsx)(nr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)($e,{})})})}),(0,s.jsx)(n.qh,{path:"/details/:id",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(Ve,{})})})}),(0,s.jsx)(n.qh,{path:"/upcoming-project/:id",element:(0,s.jsx)(rr,{allowAgents:!0,children:(0,s.jsx)(nn,{children:(0,s.jsx)(Ye,{})})})}),(0,s.jsx)(n.qh,{path:"/*",element:(0,s.jsx)(nr,{children:(0,s.jsx)(J,{})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(se,{})})})}),(0,s.jsx)(n.qh,{path:"/buy",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(et,{})})})}),(0,s.jsx)(n.qh,{path:"/rent",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(tt,{})})})}),(0,s.jsx)(n.qh,{path:"/pghostel",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(rt,{})})})}),(0,s.jsx)(n.qh,{path:"/projects",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(nt,{})})})}),(0,s.jsx)(n.qh,{path:"/BuyerProfile",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(oe,{})})})}),(0,s.jsx)(n.qh,{path:"/ChatUs",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ut,{})})})}),(0,s.jsx)(n.qh,{path:"/chatus",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ut,{})})})}),(0,s.jsx)(n.qh,{path:"/BuyerContactPage",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ae,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-about",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(dt,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-privacy-policy",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ht,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-terms-conditions",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(pt,{})})})}),(0,s.jsx)(n.qh,{path:"/BuyerHome",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(se,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/buy",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(et,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/rent",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(tt,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/pghostel",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(rt,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/projects",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(nt,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/profile",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(oe,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/chat",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ut,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/BuyerContactPage",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ae,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/about",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(dt,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/privacy-policy",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(ht,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/terms-conditions",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(pt,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/search",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)($e,{})})})}),(0,s.jsx)(n.qh,{path:"/buyer-dashboard/details/:id",element:(0,s.jsx)(rr,{children:(0,s.jsx)(nn,{children:(0,s.jsx)(Ve,{})})})}),(0,s.jsx)(n.qh,{path:"/admin/*",element:(0,s.jsx)(en,{})}),(0,s.jsx)(n.qh,{path:"/seller-dashboard/*",element:(0,s.jsx)(tr,{allowedRoles:["seller","agent"],children:(0,s.jsx)(er,{})})}),(0,s.jsx)(n.qh,{path:"/agent-dashboard/*",element:(0,s.jsx)(tr,{allowedRoles:["agent"],children:(0,s.jsx)(Or,{})})}),(0,s.jsx)(n.qh,{path:"/Agent-dashboard/*",element:(0,s.jsx)(tr,{allowedRoles:["agent"],children:(0,s.jsx)(Or,{})})})]})})]})})},on=e=>{e&&e instanceof Function&&r.e(453).then(r.bind(r,453)).then(t=>{let{getCLS:r,getFID:n,getFCP:i,getLCP:s,getTTFB:o}=t;r(e),n(e),i(e),s(e),o(e)})},an=console.error;console.error=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.join(" ").toLowerCase(),i=(n.includes("/admin/auth/verify.php")||n.includes("verify.php"))&&(n.includes("401")||n.includes("unauthorized")),s=n.includes("msg91")&&(n.includes("ipblocked")||n.includes("ip blocked")||n.includes("code: '408'")),o=n.includes("api.db-ip.com")||n.includes("db-ip.com")||n.includes("cors")&&n.includes("x-requested-with"),a=n.includes("api.db-ip.com")&&(n.includes("net::err_failed")||n.includes("failed to load resource")),l=n.includes("otp-provider.js")&&(n.includes("401")||n.includes("verify.php")||n.includes("api.db-ip.com"));i||s||o||a||l||an.apply(console,t)};const ln=console.warn;console.warn=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.join(" ").toLowerCase(),i=(n.includes("/admin/auth/verify.php")||n.includes("verify.php"))&&(n.includes("401")||n.includes("unauthorized")),s=n.includes("feature_collector")||n.includes("deprecated parameters"),o=n.includes("recaptchacompat")||n.includes("recaptcha")||n.includes("hcaptcha"),a=n.includes("api.db-ip.com")||n.includes("db-ip.com")||n.includes("cors")&&n.includes("x-requested-with");i||s||o||a||ln.apply(console,t)},window.addEventListener("unhandledrejection",e=>{var t,r;const n=((null===(t=e.reason)||void 0===t?void 0:t.message)||(null===(r=e.reason)||void 0===r?void 0:r.toString())||"").toLowerCase(),i=(n.includes("/admin/auth/verify.php")||n.includes("verify.php"))&&(n.includes("401")||n.includes("unauthorized")),s=n.includes("api.db-ip.com")||n.includes("db-ip.com")||n.includes("cors"),o=n.includes("msg91")&&(n.includes("ipblocked")||n.includes("ip blocked"));(i||s||o)&&e.preventDefault()});const cn=console.log;console.log=function(){for(var e=arguments.length,t=new Array(e),r=0;r<e;r++)t[r]=arguments[r];const n=t.join(" ").toLowerCase();n.includes("failed to load resource")&&(n.includes("verify.php")||n.includes("api.db-ip.com")||n.includes("401"))||cn.apply(console,t)};t.createRoot(document.getElementById("root")).render((0,s.jsx)(e.StrictMode,{children:(0,s.jsx)(sn,{})})),on()})()})();
//# sourceMappingURL=main.ec53f691.js.map