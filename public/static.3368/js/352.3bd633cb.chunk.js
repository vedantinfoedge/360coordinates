"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[352],{352(e,s,t){t.r(s),t.d(s,{default:()=>x});var a=t(555),n=t(43),i=t(685),r=t(639),o=t(118),l=t(254),d=t(669),c=t(995),p=t(819),h=t(375),u=t(579);const x=()=>{const e=(0,i.Zp)(),[s,t]=(0,n.useState)(null),[x,m]=(0,n.useState)(!0),[g,v]=(0,n.useState)(null),[b,y]=(0,n.useState)([]),[f,j]=(0,n.useState)([]),[N,S]=(0,n.useState)([]),[k,A]=(0,n.useState)("7d");(0,n.useEffect)(()=>{_();const e=setInterval(()=>{_()},3e4);return()=>clearInterval(e)},[k]);const _=async()=>{m(!0),v(null);try{const m=new URLSearchParams;"all"!==k&&m.append("date_range",k);const A="".concat(h.JR).concat(h.Sn.ADMIN_DASHBOARD_STATS).concat(m.toString()?"?"+m.toString():""),_=await fetch(A,{method:"GET",headers:{"Content-Type":"application/json"},credentials:"include"}),T=await _.text();if(console.log("Dashboard API Response Status:",_.status),console.log("Dashboard API Raw Response:",T.substring(0,500)),!_.ok){var e,s,a;let t=null;try{t=JSON.parse(T)}catch(N){}const n=(null===(e=t)||void 0===e?void 0:e.message)||(null===(s=t)||void 0===s||null===(a=s.data)||void 0===a?void 0:a.message)||(401===_.status?"Authentication required. Please log in again.":403===_.status?"Access denied. Insufficient permissions.":500===_.status?"Server error. Please try again later.":"HTTP error! status: ".concat(_.status));return void v(n)}let w;try{w=JSON.parse(T)}catch(N){return console.error("Failed to parse JSON:",N),console.error("Response text:",T),void v("Invalid JSON response from server: "+T.substring(0,200))}if(console.log("Dashboard API Parsed Response:",w),w.success){var n,i,p,u,x,g,b,f;const e=w.data,s=[{title:"Total Properties",value:(null===(n=e.total_properties)||void 0===n?void 0:n.toString())||"0",change:"".concat(e.pending_properties||0," pending"),trend:"up",icon:r.A,color:"#3b82f6",path:"/admin/properties"},{title:"Total Users",value:(null===(i=e.total_users)||void 0===i?void 0:i.toString())||"0",change:"".concat((null===(p=e.users_by_type)||void 0===p?void 0:p.buyer)||0," buyers, ").concat((null===(u=e.users_by_type)||void 0===u?void 0:u.seller)||0," sellers"),trend:"up",icon:o.A,color:"#8b5cf6",path:"/admin/users"},{title:"Active Agents",value:(null===(x=e.total_agents)||void 0===x?void 0:x.toString())||"0",change:"".concat(null!==(g=e.total_agents)&&void 0!==g?g:0," total agents"),trend:"up",icon:l.A,color:"#06b6d4",path:"/admin/agents"},{title:"Total Inquiries",value:(null===(b=e.total_inquiries)||void 0===b?void 0:b.toString())||"0",change:"".concat(e.new_inquiries||0," new this week"),trend:"up",icon:d.A,color:"#10b981",path:"/admin/inquiries"},{title:"Active Subscriptions",value:(null===(f=e.active_subscriptions)||void 0===f?void 0:f.toString())||"0",change:"".concat(e.expired_subscriptions||0," expired"),trend:"up",icon:c.A,color:"#8b5cf6",path:"/admin/subscriptions"}];t(s),y(e.property_types_distribution||[]),j(e.recent_properties||[]),S(e.recent_inquiries||[])}else v(w.message||"Failed to load stats")}catch(A){console.error("Error fetching dashboard stats:",A),"TypeError"===A.name&&A.message.includes("fetch")?v("Network error. Please check your connection and ensure the backend server is running."):A.message?v(A.message):v("Failed to load dashboard data. Please try again later.")}finally{m(!1)}},T=e=>({Apartment:"#3b82f6",House:"#10b981",Villa:"#8b5cf6",Commercial:"#f59e0b",Land:"#06b6d4",Plot:"#ef4444",Office:"#6366f1"}[e]||(e=>{if(!e)return"#64748b";let s=0;for(let i=0;i<e.length;i++)s=e.charCodeAt(i)+((s<<5)-s);const t=Math.abs(s)%360,a=60+Math.abs(s)%20,n=45+Math.abs(s)%15;return"hsl(".concat(t,", ").concat(a,"%, ").concat(n,"%)")})(e)),w=(()=>{if(!b||0===b.length)return null;const e=b.reduce((e,s)=>e+s.count,0);if(0===e)return null;const s=2*Math.PI*80;let t=0;return b.map((n,i)=>{const r=n.count/e*100,o=r/100*s,l=-t;return t+=o,(0,a.A)((0,a.A)({},n),{},{percentage:r.toFixed(1),dashArray:"".concat(o," ").concat(s),dashOffset:l,color:T(n.name)})})})();return x?(0,u.jsxs)("div",{className:"admin-dashboard",children:[(0,u.jsx)("div",{className:"admin-dashboard-header",children:(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{children:"Dashboard"}),(0,u.jsx)("p",{children:"Loading dashboard data..."})]})}),(0,u.jsx)("div",{className:"admin-stats-grid",children:[1,2,3,4,5,6].map(e=>(0,u.jsxs)("div",{className:"admin-stat-card",style:{opacity:.6},children:[(0,u.jsxs)("div",{className:"admin-stat-header",children:[(0,u.jsx)("div",{className:"admin-stat-title",style:{background:"#e2e8f0",height:"16px",width:"100px",borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),(0,u.jsx)("div",{className:"admin-stat-icon",style:{background:"#e2e8f0",animation:"pulse 1.5s ease-in-out infinite"}})]}),(0,u.jsx)("div",{className:"admin-stat-value",style:{background:"#e2e8f0",height:"32px",width:"80px",borderRadius:"4px",animation:"pulse 1.5s ease-in-out infinite"}}),(0,u.jsx)("div",{style:{background:"#e2e8f0",height:"14px",width:"120px",borderRadius:"4px",marginTop:"8px",animation:"pulse 1.5s ease-in-out infinite"}})]},e))}),(0,u.jsx)("style",{children:"\n          @keyframes pulse {\n            0%, 100% { opacity: 1; }\n            50% { opacity: 0.5; }\n          }\n        "})]}):g?(0,u.jsx)("div",{className:"admin-dashboard",children:(0,u.jsxs)("div",{className:"admin-dashboard-header",children:[(0,u.jsx)("h1",{children:"Dashboard"}),(0,u.jsxs)("div",{style:{color:"#ef4444",marginTop:"20px"},children:[(0,u.jsx)(p.A,{size:20,style:{marginRight:"8px",verticalAlign:"middle"}}),g]})]})}):(0,u.jsxs)("div",{className:"admin-dashboard",children:[(0,u.jsxs)("div",{className:"admin-dashboard-header",children:[(0,u.jsxs)("div",{children:[(0,u.jsx)("h1",{children:"Dashboard"}),(0,u.jsxs)("p",{children:["Welcome back! Here's an overview of your platform. ",(0,u.jsx)("span",{style:{fontSize:"12px",color:"#64748b"},children:"(Auto-refreshes every 30s)"})]})]}),(0,u.jsxs)("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[(0,u.jsxs)("select",{value:k,onChange:e=>A(e.target.value),style:{padding:"8px 12px",border:"1px solid #e2e8f0",borderRadius:"6px",fontSize:"14px",cursor:"pointer",background:"white"},children:[(0,u.jsx)("option",{value:"7d",children:"Last 7 days"}),(0,u.jsx)("option",{value:"30d",children:"Last 30 days"}),(0,u.jsx)("option",{value:"90d",children:"Last 90 days"}),(0,u.jsx)("option",{value:"all",children:"All time"})]}),(0,u.jsx)("button",{onClick:_,style:{padding:"8px 16px",background:"#3b82f6",color:"white",border:"none",borderRadius:"6px",cursor:"pointer",fontSize:"14px"},disabled:x,children:x?"Refreshing...":"Refresh"})]})]}),s&&(0,u.jsx)("div",{className:"admin-stats-grid",children:s.map((s,t)=>{const a=s.icon,n=null!==s.path;return(0,u.jsx)("div",{className:"admin-stat-card ".concat(n?"admin-stat-card-clickable":""),onClick:()=>{n&&s.path&&e(s.path)},style:{cursor:n?"pointer":"default",transition:"all 0.2s ease"},onMouseEnter:e=>{n&&(e.currentTarget.style.transform="translateY(-2px)",e.currentTarget.style.boxShadow="0 4px 12px rgba(0, 0, 0, 0.1)")},onMouseLeave:e=>{n&&(e.currentTarget.style.transform="translateY(0)",e.currentTarget.style.boxShadow="")},children:(0,u.jsxs)("div",{className:"admin-stat-content",children:[(0,u.jsxs)("div",{className:"admin-stat-header",children:[(0,u.jsx)("span",{className:"admin-stat-title",children:s.title}),(0,u.jsx)("div",{className:"admin-stat-icon",style:{background:"".concat(s.color,"20")},children:(0,u.jsx)(a,{style:{color:s.color}})})]}),(0,u.jsx)("div",{className:"admin-stat-value",children:s.value}),s.change&&(0,u.jsx)("div",{className:"admin-stat-change ".concat(s.trend),children:(0,u.jsx)("span",{children:s.change})}),n&&(0,u.jsx)("div",{style:{marginTop:"8px",fontSize:"12px",color:s.color,fontWeight:"500",opacity:.8},children:"Click to view \u2192"})]})},t)})}),(0,u.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr 1fr",gap:"20px",marginTop:"20px"},children:[(0,u.jsxs)("div",{className:"admin-dashboard-card",children:[(0,u.jsx)("h2",{children:"Recent Properties"}),f.length>0?(0,u.jsx)("div",{style:{marginTop:"15px"},children:f.map((e,s)=>{var t;return(0,u.jsxs)("div",{style:{padding:"12px",borderBottom:s<f.length-1?"1px solid #e2e8f0":"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("div",{style:{flex:1},children:[(0,u.jsx)("div",{style:{fontWeight:"600",color:"#1e293b",marginBottom:"4px"},children:e.title||"Untitled Property"}),(0,u.jsxs)("div",{style:{fontSize:"12px",color:"#64748b"},children:[e.seller_name||"Unknown"," \u2022 \u20b9",(null===(t=e.price)||void 0===t?void 0:t.toLocaleString("en-IN"))||"0"]})]}),(0,u.jsx)("div",{style:{padding:"4px 8px",borderRadius:"4px",background:e.is_active?"#10b98120":"#f59e0b20",color:e.is_active?"#10b981":"#f59e0b",fontSize:"11px",fontWeight:"500"},children:e.is_active?"Active":"Pending"})]},e.id||s)})}):(0,u.jsx)("p",{style:{textAlign:"center",color:"#64748b",padding:"20px"},children:"No recent properties"})]}),(0,u.jsxs)("div",{className:"admin-dashboard-card",children:[(0,u.jsx)("h2",{children:"Recent Inquiries"}),N.length>0?(0,u.jsx)("div",{style:{marginTop:"15px"},children:N.map((e,s)=>(0,u.jsxs)("div",{style:{padding:"12px",borderBottom:s<N.length-1?"1px solid #e2e8f0":"none",display:"flex",justifyContent:"space-between",alignItems:"center"},children:[(0,u.jsxs)("div",{style:{flex:1},children:[(0,u.jsx)("div",{style:{fontWeight:"600",color:"#1e293b",marginBottom:"4px"},children:e.property_title||"Property Inquiry"}),(0,u.jsx)("div",{style:{fontSize:"12px",color:"#64748b"},children:e.buyer_name||"Unknown Buyer"})]}),(0,u.jsx)("div",{style:{padding:"4px 8px",borderRadius:"4px",background:"pending"===e.status?"#f59e0b20":"#10b98120",color:"pending"===e.status?"#f59e0b":"#10b981",fontSize:"11px",fontWeight:"500"},children:e.status||"Pending"})]},e.id||s))}):(0,u.jsx)("p",{style:{textAlign:"center",color:"#64748b",padding:"20px"},children:"No recent inquiries"})]})]}),w&&w.length>0?(0,u.jsxs)("div",{className:"admin-dashboard-card",style:{marginTop:"20px"},children:[(0,u.jsx)("h2",{children:"Property Types Distribution"}),(0,u.jsxs)("div",{className:"admin-pie-chart-container",children:[(0,u.jsx)("svg",{viewBox:"0 0 200 200",className:"admin-pie-chart",children:w.map((e,s)=>(0,u.jsx)("circle",{cx:"100",cy:"100",r:"80",fill:"none",stroke:e.color,strokeWidth:"40",strokeDasharray:e.dashArray,strokeDashoffset:e.dashOffset,transform:"rotate(-90 100 100)"},s))}),(0,u.jsx)("div",{className:"admin-pie-labels",children:w.map((e,s)=>(0,u.jsxs)("div",{className:"admin-pie-label",children:[(0,u.jsx)("span",{className:"admin-pie-color",style:{background:e.color}}),(0,u.jsxs)("span",{className:"admin-pie-text",children:[e.name," ",e.percentage,"% (",e.count,")"]})]},s))})]})]}):(0,u.jsxs)("div",{className:"admin-dashboard-card",style:{marginTop:"20px"},children:[(0,u.jsx)("h2",{children:"Property Types Distribution"}),(0,u.jsx)("p",{style:{textAlign:"center",color:"#64748b",padding:"40px"},children:"No property data available"})]})]})}}}]);
//# sourceMappingURL=352.3bd633cb.chunk.js.map