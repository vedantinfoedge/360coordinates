"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[557],{557(e,t,n){n.r(t),n.d(t,{default:()=>l});var i=n(43),r=n(685),o=n(375),a=n(579);const s="+917888076881",l=()=>{const e=(0,r.Zp)(),[t,n]=(0,i.useState)("mobile"),[l,c]=(0,i.useState)(""),[d,u]=(0,i.useState)(null),[m,p]=(0,i.useState)(""),[f,g]=(0,i.useState)(null),[h,b]=(0,i.useState)(""),[v,y]=(0,i.useState)(!1),[S,w]=(0,i.useState)(!1),P=(0,i.useRef)(!1),T=e=>e?e.replace(/[^0-9+]/g,""):"";(0,i.useEffect)(()=>{(async()=>{try{const t=await fetch("".concat(o.JR,"/admin/auth/verify.php"),{method:"GET",credentials:"include",headers:{"Content-Type":"application/json"}});if(401===t.status)return;const n=t.headers.get("content-type");if(n&&n.includes("application/json")&&t.ok){const n=await t.json();n.success&&n.data&&n.data.admin&&e("/admin/dashboard",{replace:!0})}}catch(t){}})()},[e]);const j=(0,i.useCallback)(async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null;if(P.current)return;try{await new Promise((e,t)=>{if(window.initSendOTP&&"function"===typeof window.initSendOTP)return void e();const n=document.querySelector('script[src*="otp-provider.js"]');if(n)return n.addEventListener("load",()=>e()),void n.addEventListener("error",()=>t(new Error("Failed to load MSG91 script")));const i=document.createElement("script");i.type="text/javascript",i.src="https://verify.msg91.com/otp-provider.js",i.async=!0,i.onload=()=>{setTimeout(()=>{window.initSendOTP&&"function"===typeof window.initSendOTP?e():t(new Error("MSG91 script loaded but initSendOTP function not available"))},100)},i.onerror=()=>{t(new Error("Failed to load MSG91 script"))},document.head.appendChild(i)})}catch(r){console.warn("Failed to load MSG91 script dynamically, waiting for existing script:",r);try{await function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:20,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:200;return new Promise((n,i)=>{let r=0;const o=()=>{r++,window.initSendOTP&&"function"===typeof window.initSendOTP?n(!0):r>=e?i(new Error("MSG91 script failed to load after multiple attempts")):setTimeout(o,t)};o()})}(20,200)}catch(o){return console.error("MSG91 script loading error:",o),b("MSG91 widget is not loaded. Please refresh the page and try again."),void(P.current=!1)}}if(!window.initSendOTP||"function"!==typeof window.initSendOTP)return b("MSG91 widget is not loaded. Please refresh the page and try again."),void(P.current=!1);const t=e||d;if(!t)return void b("Mobile number validation missing. Please restart the login process.");P.current=!0;const n=t.replace(/[^0-9]/g,""),i=n.startsWith("91")?n:"91"+n.slice(-10);try{const e={widgetId:"356c786a314c303532313736",tokenAuth:"481618TheXzNLL2u694bc65aP1",identifier:i,success:async e=>{var t;console.log("MSG91 Widget Success:",e);let n=null;n="string"===typeof e?e:null!==e&&void 0!==e&&e.token?e.token:null!==e&&void 0!==e&&e.verificationToken?e.verificationToken:null!==e&&void 0!==e&&null!==(t=e.data)&&void 0!==t&&t.token?e.data.token:JSON.stringify(e),await O(n)},failure:e=>{let t="OTP verification failed. Please try again.";if(e)if("string"===typeof e)t=e;else if(e.message)t=e.message;else if(e.error)t="string"===typeof e.error?e.error:e.error.message||t;else if(e.reason)t=e.reason;else if(e.description)t=e.description;else if("object"===typeof e)try{const n=JSON.stringify(e);"{}"!==n&&(t="OTP verification failed: ".concat(n))}catch(n){t=e.toString()||t}else t=e.toString()||t;t.toLowerCase().includes("ipblocked")||t.toLowerCase().includes("ip blocked")||e&&"object"===typeof e&&("408"===e.code||"IPBlocked"===e.message)||console.error("MSG91 Widget Error:",e),b(t),P.current=!1}};window.initSendOTP(e)}catch(h){console.error("Error initializing MSG91 widget:",h),b("Failed to open OTP widget. Please try again."),P.current=!1}},[d]),O=async t=>{if(b(""),y(!0),!d||!t)return b("Missing verification data. Please restart the login process."),void y(!1);if(T(d)!==T(s))return b("Invalid mobile number. Access denied."),n("mobile"),g(null),w(!1),void y(!1);try{const s=await fetch("".concat(o.JR,"/admin/auth/verify-otp.php"),{method:"POST",headers:{"Content-Type":"application/json"},credentials:"include",body:JSON.stringify({validationToken:f||"frontend_validated",mobile:d,widgetToken:t})});if(!s.ok){let e="OTP verification failed. Please try again.";try{const t=s.headers.get("content-type");if(t&&t.includes("application/json")){e=(await s.json()).message||e}else{const t=await s.text();if(t)try{e=JSON.parse(t).message||e}catch(i){e=t.substring(0,200)||e}}}catch(r){500===s.status?e="Server error occurred. Please try again or contact support.":403===s.status&&(e="Access denied. Please check your credentials.")}return b(e),n("mobile"),g(null),w(!1),void y(!1)}const l=s.headers.get("content-type");if(!l||!l.includes("application/json")){const e=await s.text();return console.error("Non-JSON response:",e.substring(0,500)),b("Server returned an invalid response. Please try again or contact support."),n("mobile"),g(null),w(!1),void y(!1)}let c;try{const e=await s.text();if(!e||""===e.trim())return b("Server returned an empty response. Please try again."),n("mobile"),g(null),w(!1),void y(!1);c=JSON.parse(e)}catch(a){return console.error("JSON parse error:",a),b("Server returned an invalid response. Please try again or contact support."),n("mobile"),g(null),w(!1),void y(!1)}c.success?(y(!1),console.log("Admin login successful, redirecting to dashboard"),e("/admin/dashboard",{replace:!0})):(b(c.message||"OTP verification failed. Please try again."),n("mobile"),g(null),w(!1))}catch(l){console.error("OTP verification error:",l),l.message&&l.message.includes("JSON")?b("Server returned an invalid response. The API endpoint may not be available."):b("Connection error. Please check your internet connection and try again."),n("mobile"),g(null),w(!1)}y(!1)};(0,i.useEffect)(()=>{if("otp"===t&&d&&!v&&!P.current){const e=setTimeout(async()=>{await j(d)},500);return()=>clearTimeout(e)}},[t,d,v,j]);return(0,a.jsx)("div",{className:"admin-login-page",children:(0,a.jsx)("div",{className:"admin-login-container",children:(0,a.jsxs)("div",{className:"admin-login-card",children:[(0,a.jsx)("h1",{children:"Admin Login"}),(0,a.jsx)("p",{className:"admin-login-subtitle",children:"mobile"===t?"Enter your mobile number to receive OTP":"Enter the OTP sent to your mobile number"}),h&&(0,a.jsx)("div",{className:"admin-error-alert",children:h}),"mobile"===t&&(0,a.jsxs)("form",{onSubmit:e=>{if(e.preventDefault(),b(""),y(!0),!l||0===l.trim().length)return b("Please enter your mobile number"),void y(!1);if(T(l.trim())!==T(s))return b("Invalid mobile number. Access denied."),void y(!1);const t="local_"+Date.now();g(t);const i=l.trim();u(i),p((e=>{if(!e)return"";const t=e.replace(/[^0-9+]/g,"");if(t.length>=6)return t.substring(0,4)+"****"+t.substring(t.length-4);return"****"+t.substring(Math.max(0,t.length-4))})(i)),c(""),w(!0),n("otp"),y(!1)},className:"admin-login-form",children:[(0,a.jsxs)("div",{className:"admin-form-group",children:[(0,a.jsx)("label",{htmlFor:"mobile",children:"Mobile Number"}),(0,a.jsx)("input",{type:"tel",id:"mobile",name:"mobile",value:l,onChange:e=>{S||c(e.target.value)},required:!0,autoComplete:"tel",disabled:v||S,pattern:"^\\+91[6-9]\\d{9}$"})]}),(0,a.jsx)("button",{type:"submit",className:"admin-login-button",disabled:v||!l||S,children:v?"Validating...":"Send OTP"})]}),"otp"===t&&(0,a.jsxs)("div",{className:"admin-login-form",children:[(0,a.jsxs)("div",{className:"admin-form-group",children:[(0,a.jsx)("label",{children:"Mobile Number Verified"}),(0,a.jsx)("input",{type:"text",value:m||"****",disabled:!0,className:"admin-mobile-locked",readOnly:!0})]}),v&&(0,a.jsx)("div",{className:"admin-loading",children:(0,a.jsx)("p",{children:"Verifying OTP..."})}),(0,a.jsx)("button",{type:"button",className:"admin-back-link",onClick:()=>{n("mobile"),c(""),u(null),p(""),g(null),w(!1),b(""),P.current=!1},disabled:v,children:"\u2190 Change Mobile Number"})]})]})})})}}}]);
//# sourceMappingURL=557.9acd8978.chunk.js.map