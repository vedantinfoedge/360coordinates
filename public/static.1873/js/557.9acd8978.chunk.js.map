{"version":3,"file":"static/js/557.9acd8978.chunk.js","mappings":"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","sources":["Admin/Pages/AdminLogin.jsx"],"sourcesContent":["import React, { useState, useEffect, useCallback, useRef } from 'react';\r\nimport { useNavigate } from 'react-router-dom';\r\nimport { API_BASE_URL } from '../../config/api.config';\r\nimport '../style/AdminLogin.css';\r\n\r\n// MSG91 Widget Configuration\r\n// These should match backend config\r\nconst MSG91_WIDGET_ID = '356c786a314c303532313736';\r\nconst MSG91_AUTH_TOKEN = '481618TheXzNLL2u694bc65aP1';\r\n\r\n// HARDCODED ADMIN MOBILE NUMBER - Only this number can login\r\nconst ADMIN_MOBILE_NUMBER = '+917888076881';\r\n\r\nconst AdminLogin = () => {\r\n  const navigate = useNavigate();\r\n  const [step, setStep] = useState('mobile'); // 'mobile', 'otp'\r\n  const [mobile, setMobile] = useState('');\r\n  const [validatedMobile, setValidatedMobile] = useState(null); // Store validated mobile (internal use only)\r\n  const [maskedMobile, setMaskedMobile] = useState(''); // Masked version to display\r\n  const [validationToken, setValidationToken] = useState(null);\r\n  const [error, setError] = useState('');\r\n  const [loading, setLoading] = useState(false);\r\n  const [mobileLocked, setMobileLocked] = useState(false);\r\n  const widgetInitializedRef = useRef(false); // Track if widget was already initialized\r\n\r\n  // Helper function to load MSG91 script dynamically if not already loaded\r\n  const loadMSG91Script = () => {\r\n    return new Promise((resolve, reject) => {\r\n      // Check if script is already loaded\r\n      if (window.initSendOTP && typeof window.initSendOTP === 'function') {\r\n        resolve();\r\n        return;\r\n      }\r\n\r\n      // Check if script tag already exists\r\n      const existingScript = document.querySelector('script[src*=\"otp-provider.js\"]');\r\n      if (existingScript) {\r\n        // Script tag exists, wait for it to load\r\n        existingScript.addEventListener('load', () => resolve());\r\n        existingScript.addEventListener('error', () => reject(new Error('Failed to load MSG91 script')));\r\n        return;\r\n      }\r\n\r\n      // Load script dynamically\r\n      const script = document.createElement('script');\r\n      script.type = 'text/javascript';\r\n      script.src = 'https://verify.msg91.com/otp-provider.js';\r\n      script.async = true;\r\n      \r\n      script.onload = () => {\r\n        // Wait a bit more for the function to be available\r\n        setTimeout(() => {\r\n          if (window.initSendOTP && typeof window.initSendOTP === 'function') {\r\n            resolve();\r\n          } else {\r\n            reject(new Error('MSG91 script loaded but initSendOTP function not available'));\r\n          }\r\n        }, 100);\r\n      };\r\n      \r\n      script.onerror = () => {\r\n        reject(new Error('Failed to load MSG91 script'));\r\n      };\r\n      \r\n      document.head.appendChild(script);\r\n    });\r\n  };\r\n\r\n  // Helper function to normalize mobile number for comparison (remove spaces, dashes, etc.)\r\n  const normalizeMobile = (mobileNumber) => {\r\n    if (!mobileNumber) return '';\r\n    // Remove all non-digit characters except +\r\n    return mobileNumber.replace(/[^0-9+]/g, '');\r\n  };\r\n\r\n  // Helper function to mask mobile number\r\n  const maskMobileNumber = (mobileNumber) => {\r\n    if (!mobileNumber) return '';\r\n    const cleaned = mobileNumber.replace(/[^0-9+]/g, '');\r\n    if (cleaned.length >= 6) {\r\n      // Show first 4 chars and last 4 chars, mask the middle\r\n      const start = cleaned.substring(0, 4);\r\n      const end = cleaned.substring(cleaned.length - 4);\r\n      return start + '****' + end;\r\n    }\r\n    return '****' + cleaned.substring(Math.max(0, cleaned.length - 4));\r\n  };\r\n\r\n  // Check if already authenticated\r\n  useEffect(() => {\r\n    const checkAuth = async () => {\r\n      try {\r\n        const response = await fetch(`${API_BASE_URL}/admin/auth/verify.php`, {\r\n          method: 'GET',\r\n          credentials: 'include',\r\n          headers: {\r\n            'Content-Type': 'application/json',\r\n          },\r\n        });\r\n\r\n        // 401 is expected when not authenticated - handle silently\r\n        if (response.status === 401) {\r\n          // Not authenticated, continue to login page\r\n          return;\r\n        }\r\n\r\n        // Check if response is JSON before parsing\r\n        const contentType = response.headers.get('content-type');\r\n        if (contentType && contentType.includes('application/json') && response.ok) {\r\n          const data = await response.json();\r\n          if (data.success && data.data && data.data.admin) {\r\n            navigate('/admin/dashboard', { replace: true });\r\n          }\r\n        }\r\n      } catch (err) {\r\n        // Not authenticated or network error, continue to login\r\n        // Silently ignore - 401 is expected behavior\r\n      }\r\n    };\r\n\r\n    checkAuth();\r\n  }, [navigate]);\r\n\r\n  // Step 1: Validate mobile number against hardcoded admin number (frontend-only validation)\r\n  const handleValidateMobile = (e) => {\r\n    e.preventDefault();\r\n    setError('');\r\n    setLoading(true);\r\n\r\n    if (!mobile || mobile.trim().length === 0) {\r\n      setError('Please enter your mobile number');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Normalize both mobile numbers for comparison\r\n    const enteredMobile = normalizeMobile(mobile.trim());\r\n    const adminMobile = normalizeMobile(ADMIN_MOBILE_NUMBER);\r\n\r\n    // Compare the normalized mobile numbers\r\n    if (enteredMobile !== adminMobile) {\r\n      // Mobile number doesn't match - show error popup\r\n      setError('Invalid mobile number. Access denied.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Mobile number matches - proceed to OTP widget\r\n    // Generate a simple local validation token (not used by backend, just for local state)\r\n    const localToken = 'local_' + Date.now();\r\n    setValidationToken(localToken);\r\n    \r\n    // Store the validated mobile (keep it for internal use but don't display it)\r\n    const mobileToStore = mobile.trim();\r\n    setValidatedMobile(mobileToStore);\r\n    \r\n    // Create masked version for display only\r\n    setMaskedMobile(maskMobileNumber(mobileToStore));\r\n    \r\n    // Clear the actual mobile number from the input field\r\n    setMobile('');\r\n    setMobileLocked(true); // Lock mobile number\r\n    setStep('otp');\r\n    setLoading(false);\r\n    \r\n    // Widget will be initialized by useEffect when step changes to 'otp'\r\n  };\r\n\r\n  // Helper function to wait for MSG91 script to load\r\n  const waitForMSG91Script = (maxAttempts = 20, delay = 200) => {\r\n    return new Promise((resolve, reject) => {\r\n      let attempts = 0;\r\n      \r\n      const checkScript = () => {\r\n        attempts++;\r\n        \r\n        if (window.initSendOTP && typeof window.initSendOTP === 'function') {\r\n          resolve(true);\r\n          return;\r\n        }\r\n        \r\n        if (attempts >= maxAttempts) {\r\n          reject(new Error('MSG91 script failed to load after multiple attempts'));\r\n          return;\r\n        }\r\n        \r\n        setTimeout(checkScript, delay);\r\n      };\r\n      \r\n      checkScript();\r\n    });\r\n  };\r\n\r\n  // Step 2: Initialize MSG91 Widget (after frontend validation)\r\n  const initializeMSG91Widget = useCallback(async (mobileNumber = null) => {\r\n    // Prevent double initialization\r\n    if (widgetInitializedRef.current) {\r\n      return;\r\n    }\r\n\r\n    // Try to load MSG91 script if not already loaded\r\n    try {\r\n      // First try to load script dynamically\r\n      await loadMSG91Script();\r\n    } catch (loadError) {\r\n      console.warn('Failed to load MSG91 script dynamically, waiting for existing script:', loadError);\r\n      // If dynamic load fails, wait for existing script to load\r\n      try {\r\n        await waitForMSG91Script(20, 200); // Wait up to 4 seconds (20 * 200ms)\r\n      } catch (waitError) {\r\n        console.error('MSG91 script loading error:', waitError);\r\n        setError('MSG91 widget is not loaded. Please refresh the page and try again.');\r\n        widgetInitializedRef.current = false;\r\n        return;\r\n      }\r\n    }\r\n\r\n    // Final check\r\n    if (!window.initSendOTP || typeof window.initSendOTP !== 'function') {\r\n      setError('MSG91 widget is not loaded. Please refresh the page and try again.');\r\n      widgetInitializedRef.current = false;\r\n      return;\r\n    }\r\n\r\n    // Use passed mobile number or fallback to state\r\n    const mobileToUse = mobileNumber || validatedMobile;\r\n\r\n    if (!mobileToUse) {\r\n      setError('Mobile number validation missing. Please restart the login process.');\r\n      return;\r\n    }\r\n\r\n    // Mark as initialized\r\n    widgetInitializedRef.current = true;\r\n    \r\n    // Format mobile for MSG91 (remove + and spaces)\r\n    const formattedMobile = mobileToUse.replace(/[^0-9]/g, '');\r\n    // MSG91 expects format: 91XXXXXXXXXX (country code + number, no + sign)\r\n    const msg91Mobile = formattedMobile.startsWith('91') ? formattedMobile : '91' + formattedMobile.slice(-10);\r\n\r\n    try {\r\n      const configuration = {\r\n        widgetId: MSG91_WIDGET_ID,\r\n        tokenAuth: MSG91_AUTH_TOKEN,\r\n        identifier: msg91Mobile, // Mobile number for OTP\r\n        success: async (widgetData) => {\r\n          // Widget OTP verification successful\r\n          console.log('MSG91 Widget Success:', widgetData);\r\n          \r\n          // Extract widget token\r\n          let widgetToken = null;\r\n          if (typeof widgetData === 'string') {\r\n            widgetToken = widgetData;\r\n          } else if (widgetData?.token) {\r\n            widgetToken = widgetData.token;\r\n          } else if (widgetData?.verificationToken) {\r\n            widgetToken = widgetData.verificationToken;\r\n          } else if (widgetData?.data?.token) {\r\n            widgetToken = widgetData.data.token;\r\n          } else {\r\n            widgetToken = JSON.stringify(widgetData);\r\n          }\r\n\r\n          // Step 3: Verify OTP with backend\r\n          await handleVerifyOTP(widgetToken);\r\n        },\r\n        failure: (error) => {\r\n          // Extract error message from various possible formats\r\n          let errorMessage = 'OTP verification failed. Please try again.';\r\n          \r\n          if (error) {\r\n            if (typeof error === 'string') {\r\n              errorMessage = error;\r\n            } else if (error.message) {\r\n              errorMessage = error.message;\r\n            } else if (error.error) {\r\n              errorMessage = typeof error.error === 'string' ? error.error : error.error.message || errorMessage;\r\n            } else if (error.reason) {\r\n              errorMessage = error.reason;\r\n            } else if (error.description) {\r\n              errorMessage = error.description;\r\n            } else if (typeof error === 'object') {\r\n              // Try to stringify and extract meaningful info\r\n              try {\r\n                const errorStr = JSON.stringify(error);\r\n                if (errorStr !== '{}') {\r\n                  errorMessage = `OTP verification failed: ${errorStr}`;\r\n                }\r\n              } catch (e) {\r\n                errorMessage = error.toString() || errorMessage;\r\n              }\r\n            } else {\r\n              errorMessage = error.toString() || errorMessage;\r\n            }\r\n          }\r\n          \r\n          // Don't log IPBlocked errors (they're expected and handled gracefully)\r\n          const isIPBlocked = \r\n            errorMessage.toLowerCase().includes('ipblocked') || \r\n            errorMessage.toLowerCase().includes('ip blocked') ||\r\n            (error && typeof error === 'object' && (error.code === '408' || error.message === 'IPBlocked'));\r\n          \r\n          if (!isIPBlocked) {\r\n            console.error('MSG91 Widget Error:', error);\r\n          }\r\n          \r\n          setError(errorMessage);\r\n          widgetInitializedRef.current = false; // Reset on failure so user can retry\r\n        },\r\n      };\r\n\r\n      window.initSendOTP(configuration);\r\n    } catch (error) {\r\n      console.error('Error initializing MSG91 widget:', error);\r\n      setError('Failed to open OTP widget. Please try again.');\r\n      widgetInitializedRef.current = false; // Reset on error\r\n    }\r\n  }, [validatedMobile]);\r\n\r\n  // Step 3: Verify OTP with backend and create session\r\n  const handleVerifyOTP = async (widgetToken) => {\r\n    setError('');\r\n    setLoading(true);\r\n\r\n    if (!validatedMobile || !widgetToken) {\r\n      setError('Missing verification data. Please restart the login process.');\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    // Re-validate mobile number against hardcoded admin number before sending to backend\r\n    const enteredMobile = normalizeMobile(validatedMobile);\r\n    const adminMobile = normalizeMobile(ADMIN_MOBILE_NUMBER);\r\n    \r\n    if (enteredMobile !== adminMobile) {\r\n      setError('Invalid mobile number. Access denied.');\r\n      setStep('mobile');\r\n      setValidationToken(null);\r\n      setMobileLocked(false);\r\n      setLoading(false);\r\n      return;\r\n    }\r\n\r\n    try {\r\n      // Send to backend for session creation (backend will still verify mobile against whitelist)\r\n      const response = await fetch(`${API_BASE_URL}/admin/auth/verify-otp.php`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n        },\r\n        credentials: 'include',\r\n        body: JSON.stringify({\r\n          validationToken: validationToken || 'frontend_validated', // Use local token or fallback\r\n          mobile: validatedMobile, // Use validated mobile\r\n          widgetToken: widgetToken,\r\n        }),\r\n      });\r\n\r\n      // Check response status first\r\n      if (!response.ok) {\r\n        // Try to get error message from response\r\n        let errorMessage = 'OTP verification failed. Please try again.';\r\n        try {\r\n          const contentType = response.headers.get('content-type');\r\n          if (contentType && contentType.includes('application/json')) {\r\n            const errorData = await response.json();\r\n            errorMessage = errorData.message || errorMessage;\r\n          } else {\r\n            const text = await response.text();\r\n            if (text) {\r\n              // Try to parse as JSON even if content-type is wrong\r\n              try {\r\n                const errorData = JSON.parse(text);\r\n                errorMessage = errorData.message || errorMessage;\r\n              } catch (e) {\r\n                // Not JSON, use text or default message\r\n                errorMessage = text.substring(0, 200) || errorMessage;\r\n              }\r\n            }\r\n          }\r\n        } catch (parseError) {\r\n          // If we can't parse the error, use status-based message\r\n          if (response.status === 500) {\r\n            errorMessage = 'Server error occurred. Please try again or contact support.';\r\n          } else if (response.status === 403) {\r\n            errorMessage = 'Access denied. Please check your credentials.';\r\n          }\r\n        }\r\n        \r\n        setError(errorMessage);\r\n        setStep('mobile');\r\n        setValidationToken(null);\r\n        setMobileLocked(false);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Check if response is JSON before parsing\r\n      const contentType = response.headers.get('content-type');\r\n      if (!contentType || !contentType.includes('application/json')) {\r\n        const text = await response.text();\r\n        console.error('Non-JSON response:', text.substring(0, 500));\r\n        setError('Server returned an invalid response. Please try again or contact support.');\r\n        setStep('mobile');\r\n        setValidationToken(null);\r\n        setMobileLocked(false);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      // Try to parse JSON, handle empty responses\r\n      let data;\r\n      try {\r\n        const text = await response.text();\r\n        if (!text || text.trim() === '') {\r\n          setError('Server returned an empty response. Please try again.');\r\n          setStep('mobile');\r\n          setValidationToken(null);\r\n          setMobileLocked(false);\r\n          setLoading(false);\r\n          return;\r\n        }\r\n        data = JSON.parse(text);\r\n      } catch (jsonError) {\r\n        console.error('JSON parse error:', jsonError);\r\n        setError('Server returned an invalid response. Please try again or contact support.');\r\n        setStep('mobile');\r\n        setValidationToken(null);\r\n        setMobileLocked(false);\r\n        setLoading(false);\r\n        return;\r\n      }\r\n\r\n      if (data.success) {\r\n        // Login successful - session created via HTTP-only cookie\r\n        // Clear loading state\r\n        setLoading(false);\r\n        \r\n        // Redirect immediately - session is already created and will be verified by dashboard\r\n        // No need to verify immediately as it can cause race conditions\r\n        console.log('Admin login successful, redirecting to dashboard');\r\n        navigate('/admin/dashboard', { replace: true });\r\n      } else {\r\n        setError(data.message || 'OTP verification failed. Please try again.');\r\n        // Reset to mobile step on failure\r\n        setStep('mobile');\r\n        setValidationToken(null);\r\n        setMobileLocked(false);\r\n      }\r\n    } catch (err) {\r\n      console.error('OTP verification error:', err);\r\n      if (err.message && err.message.includes('JSON')) {\r\n        setError('Server returned an invalid response. The API endpoint may not be available.');\r\n      } else {\r\n        setError('Connection error. Please check your internet connection and try again.');\r\n      }\r\n      setStep('mobile');\r\n      setValidationToken(null);\r\n      setMobileLocked(false);\r\n    }\r\n\r\n    setLoading(false);\r\n  };\r\n\r\n  // Handle mobile input change (only if not locked)\r\n  const handleMobileChange = (e) => {\r\n    if (!mobileLocked) {\r\n      setMobile(e.target.value);\r\n    }\r\n  };\r\n\r\n  // Initialize widget when step changes to OTP and validatedMobile is set\r\n  useEffect(() => {\r\n    if (step === 'otp' && validatedMobile && !loading && !widgetInitializedRef.current) {\r\n      // Small delay to ensure DOM is ready and state is fully updated\r\n      const timer = setTimeout(async () => {\r\n        await initializeMSG91Widget(validatedMobile);\r\n      }, 500); // Increased delay to ensure script is loaded\r\n      return () => clearTimeout(timer);\r\n    }\r\n  }, [step, validatedMobile, loading, initializeMSG91Widget]); // Include all dependencies\r\n\r\n  // Reset form\r\n  const handleReset = () => {\r\n    setStep('mobile');\r\n    setMobile('');\r\n    setValidatedMobile(null);\r\n    setMaskedMobile('');\r\n    setValidationToken(null);\r\n    setMobileLocked(false);\r\n    setError('');\r\n    widgetInitializedRef.current = false; // Reset widget initialization flag\r\n  };\r\n\r\n  return (\r\n    <div className=\"admin-login-page\">\r\n      <div className=\"admin-login-container\">\r\n        <div className=\"admin-login-card\">\r\n          <h1>Admin Login</h1>\r\n          <p className=\"admin-login-subtitle\">\r\n            {step === 'mobile'\r\n              ? 'Enter your mobile number to receive OTP'\r\n              : 'Enter the OTP sent to your mobile number'}\r\n          </p>\r\n\r\n          {error && (\r\n            <div className=\"admin-error-alert\">\r\n              {error}\r\n            </div>\r\n          )}\r\n\r\n          {step === 'mobile' && (\r\n            <form onSubmit={handleValidateMobile} className=\"admin-login-form\">\r\n              <div className=\"admin-form-group\">\r\n                <label htmlFor=\"mobile\">Mobile Number</label>\r\n                <input\r\n                  type=\"tel\"\r\n                  id=\"mobile\"\r\n                  name=\"mobile\"\r\n                  value={mobile}\r\n                  onChange={handleMobileChange}\r\n                  required\r\n                  autoComplete=\"tel\"\r\n                  disabled={loading || mobileLocked}\r\n                  pattern=\"^\\+91[6-9]\\d{9}$\"\r\n                />\r\n              </div>\r\n\r\n              <button\r\n                type=\"submit\"\r\n                className=\"admin-login-button\"\r\n                disabled={loading || !mobile || mobileLocked}\r\n              >\r\n                {loading ? 'Validating...' : 'Send OTP'}\r\n              </button>\r\n            </form>\r\n          )}\r\n\r\n          {step === 'otp' && (\r\n            <div className=\"admin-login-form\">\r\n              <div className=\"admin-form-group\">\r\n                <label>Mobile Number Verified</label>\r\n                <input\r\n                  type=\"text\"\r\n                  value={maskedMobile || '****'}\r\n                  disabled\r\n                  className=\"admin-mobile-locked\"\r\n                  readOnly\r\n                />\r\n              </div>\r\n\r\n              {loading && (\r\n                <div className=\"admin-loading\">\r\n                  <p>Verifying OTP...</p>\r\n                </div>\r\n              )}\r\n\r\n              <button\r\n                type=\"button\"\r\n                className=\"admin-back-link\"\r\n                onClick={handleReset}\r\n                disabled={loading}\r\n              >\r\n                ‚Üê Change Mobile Number\r\n              </button>\r\n            </div>\r\n          )}\r\n        </div>\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default AdminLogin;\r\n"],"names":["ADMIN_MOBILE_NUMBER","AdminLogin","navigate","useNavigate","step","setStep","useState","mobile","setMobile","validatedMobile","setValidatedMobile","maskedMobile","setMaskedMobile","validationToken","setValidationToken","error","setError","loading","setLoading","mobileLocked","setMobileLocked","widgetInitializedRef","useRef","normalizeMobile","mobileNumber","replace","useEffect","async","response","fetch","concat","API_BASE_URL","method","credentials","headers","status","contentType","get","includes","ok","data","json","success","admin","err","checkAuth","initializeMSG91Widget","useCallback","arguments","length","undefined","current","Promise","resolve","reject","window","initSendOTP","existingScript","document","querySelector","addEventListener","Error","script","createElement","type","src","onload","setTimeout","onerror","head","appendChild","loadError","console","warn","maxAttempts","delay","attempts","checkScript","waitForMSG91Script","waitError","mobileToUse","formattedMobile","msg91Mobile","startsWith","slice","configuration","widgetId","tokenAuth","identifier","_widgetData$data","log","widgetData","widgetToken","token","verificationToken","JSON","stringify","handleVerifyOTP","failure","errorMessage","message","reason","description","errorStr","e","toString","toLowerCase","code","body","text","parse","substring","parseError","trim","jsonError","timer","clearTimeout","_jsx","className","children","_jsxs","onSubmit","preventDefault","localToken","Date","now","mobileToStore","cleaned","Math","max","maskMobileNumber","htmlFor","id","name","value","onChange","target","required","autoComplete","disabled","pattern","readOnly","onClick","handleReset"],"ignoreList":[],"sourceRoot":""}